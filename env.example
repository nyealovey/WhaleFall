# 服务器正式环境配置示例（x86，有代理）
# 复制此文件为 .env 并修改相应配置
# 注意：此文件为示例模板，禁止写入真实密钥/口令并提交到仓库；生产环境请通过部署系统注入或仅写入未跟踪的 .env

# ============================================================================
# 代理配置
# ============================================================================
# HTTP代理
HTTP_PROXY=http://proxy.company.com:8080
HTTPS_PROXY=http://proxy.company.com:8080

# 不使用代理的地址
NO_PROXY=localhost,127.0.0.1,::1,internal.company.com

# 小写版本（某些工具需要）
http_proxy=http://proxy.company.com:8080
https_proxy=http://proxy.company.com:8080
no_proxy=localhost,127.0.0.1,::1,internal.company.com

# ============================================================================
# 数据库配置
# ============================================================================
POSTGRES_DB=whalefall_prod
POSTGRES_USER=whalefall_user
POSTGRES_PASSWORD=

# ============================================================================
# Redis配置
# ============================================================================
REDIS_PASSWORD=

# ============================================================================
# 应用安全配置
# ============================================================================
# SECRET_KEY/JWT_SECRET_KEY 用于会话/JWT 签名，生产必须固定且随机生成
# 生成示例: python -c "import secrets; print(secrets.token_urlsafe(32))"
SECRET_KEY=
JWT_SECRET_KEY=
BCRYPT_LOG_ROUNDS=12
# 用于数据库凭据加/解密(生产环境必须固定,否则重启后无法解密已存储的密码)
# 生成示例: python -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
PASSWORD_ENCRYPTION_KEY=

# ============================================================================
# 应用配置
# ============================================================================
APP_NAME=鲸落
APP_VERSION=1.4.0
# ============================================================================
# 可观测性(部署维度) - 建议生产环境注入
# ============================================================================
# 用于关联发布与定位节点问题（wide events / canonical log lines）
# 示例: BUILD_HASH=9d606135649b55a70cd87d0ea966b700 或 git 短 hash
BUILD_HASH=
# 部署区域/机房/region（示例: cn-hz1 / us-east-1）
DEPLOY_REGION=unknown
# 运行时实例标识（示例: k8s pod name / hostname）
RUNTIME_INSTANCE_ID=
FLASK_ENV=production
FLASK_DEBUG=0
LOG_LEVEL=INFO
# http_request_completed wide event 策略（避免日志中心被请求日志淹没）
# - all: 每个请求都记录（成功/失败）
# - slow_or_error: 仅记录慢请求或错误请求（默认）
# - errors_only: 仅记录错误请求（status_code>=400）
# - off: 完全不记录 http_request_completed
LOG_HTTP_REQUEST_COMPLETED_MODE=slow_or_error
# 慢请求阈值(毫秒)，当 mode=slow_or_error 时生效；设置为 0 表示所有请求都视为“慢请求”
LOG_HTTP_REQUEST_COMPLETED_SLOW_MS=1000
# 是否启用内置定时任务调度器(APScheduler)
# - 单进程/单容器部署: 保持 true 即可
# - Web/Scheduler 分进程部署: Web 进程建议 false, Scheduler 进程设置 true
ENABLE_SCHEDULER=true

# ============================================================================
# API v1 (Flask-RESTX/OpenAPI)
# ============================================================================
# 是否启用 Swagger UI: /api/v1/docs (建议生产环境关闭)
API_V1_DOCS_ENABLED=false

# ============================================================================
# Account Permissions (Snapshot v4)
# ============================================================================
# Phase 1: 双写 snapshot 列
ACCOUNT_PERMISSION_SNAPSHOT_WRITE=false
# Phase 2: 切读(金丝雀)
ACCOUNT_PERMISSION_SNAPSHOT_READ=false

# ============================================================================
# 反向代理(入站) / ProxyFix
# ============================================================================
# 说明:
# - 当应用处于 Nginx/负载均衡反向代理后方时,需要让 Flask 正确解析 X-Forwarded-* 获取真实 IP/协议.
# - 下列配置默认适配“容器内置 Nginx → 127.0.0.1:5001”模式.
PROXY_FIX_X_FOR=1
PROXY_FIX_X_PROTO=1
PROXY_FIX_X_HOST=0
PROXY_FIX_X_PORT=0
PROXY_FIX_X_PREFIX=0
# 仅信任来自这些代理 IP 的 X-Forwarded-* 头部,防止直连暴露端口时被伪造
PROXY_FIX_TRUSTED_IPS=127.0.0.1,::1

# ============================================================================
# 缓存配置
# ============================================================================
CACHE_TYPE=redis
# 使用容器服务名连接
CACHE_REDIS_URL=redis://:${REDIS_PASSWORD}@redis:6379/0
# Options 下拉/筛选项缓存 TTL(秒). 建议短 TTL 以达成最终一致.
CACHE_OPTIONS_TTL=60

# ============================================================================
# 数据库连接配置
# ============================================================================
# 使用容器服务名连接
DATABASE_URL=postgresql+psycopg://whalefall_user:${POSTGRES_PASSWORD}@postgres:5432/whalefall_prod

# ============================================================================
# 会话配置
# ============================================================================
PERMANENT_SESSION_LIFETIME=3600
# Flask-Login remember_token 过期时间(秒),用于控制“记住我/长期登录”的最长时长
REMEMBER_COOKIE_DURATION=604800

# ============================================================================
# 其他配置
# ============================================================================
DEBUG=false
TESTING=false
