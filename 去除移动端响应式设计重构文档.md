# 去除移动端响应式设计重构方案

面向版本：Taifishing V4（Flask + Bootstrap Flatly 主题）  
撰写日期：2025-XX-XX

---

## 1. 背景与目标
- 业务方确认 **仅支持桌面端访问**，移动/平板体验不再维护。
- 现有前端依赖 Bootstrap 的响应式栅格与多处自定义媒体查询，双栈样式导致维护成本高（调试两套布局、测试覆盖难）、部分桌面样式被手机特化逻辑“牵制”。
- 本轮重构目标：
  1. 移除或固化所有基于视口宽度的样式与行为，使 UI 只面向 ≥1280px 的桌面屏。
  2. 清理模板中的响应式栅格类，改为固定列宽或自定义布局。
  3. 精简后续开发规范，避免新代码重新引入移动端特化。
  4. **保持桌面端视觉不变**：移除移动端代码后，1440px 等桌面视口的布局、间距、字号需与当前版本保持一致，必要时通过对比截图/浏览器双开逐步确认。

---

## 2. 现状盘点

### 2.1 视口与布局基线
- `app/templates/base.html:6` 含 `<meta name="viewport" ...>`，使浏览器按设备宽度缩放；移除后桌面默认缩放即可。
- 所有页面包裹在 `.container` 宽度内（`app/templates/base.html:39`、`app/static/vendor/bootstrap/bootstrap-flatly.min.css`），在 ≥1400px 视口时 `max-width: 1320px`；是桌面布局的最大内容宽。

### 2.2 CSS 响应式规则（25 处）

| 文件 | @media 次数 | 说明 |
| --- | --- | --- |
| `app/static/css/global.css` | 4 | 页头/按钮/导航在 576、768、992px 下调整间距与字号 |
| `app/static/css/components/filters/filter_common.css` | 2 | 筛选面板在 992px 改按钮排布，在 1200px 重新对齐 |
| 页面级样式 | 19 | 涉及 about、accounts、admin/scheduler、instances/*、credentials/*、dashboard、history/logs、tags/batch_assign 等 |

> 统计命令：`python3 - <<'PY' ...`，详见仓库操作记录。

其它桌面固定宽度：例如 `app/static/css/pages/tags/batch_assign.css:7` 将容器限制在 `max-width: 1200px`，需确认是否跟全局 1320px 对齐。

### 2.3 模板中的栅格/断点类
- 共有 **27 个模板** 引用了 `col-sm|md|lg|xl|xxl` 类，累计 **245 处**。
- 重灾区：`app/templates/components/filters/macros.html`（35 处）、`app/templates/accounts/account_classification.html`（33 处）、`app/templates/admin/scheduler.html`（29 处），需要统一改成固定列布局。
- 导航栏使用 `navbar-expand-lg` + `navbar-toggler`（`app/templates/base.html:32`），折叠逻辑即移动端特化。

### 2.4 JavaScript
- `app/static/js/**` 未出现 `window.innerWidth` / `matchMedia` / 自定义断点逻辑，仅第三方库（Bootstrap、SweetAlert2）内部包含响应式代码，可保持默认。

---

## 3. 重构策略

### 3.1 CSS 层面
1. **移除 meta viewport：** 让桌面浏览器按照固定缩放渲染，避免页面因设备宽度被压缩。
2. **删除全部 `@media` 块** 或将其内容上移到常规选择器，使任意视口都使用同一桌面规则。
3. **固化容器宽度：** 在 `global.css` 或新建 `desktop.css` 中设置 `.container` / `.main-content` 的固定 `max-width`（如 1320px 或业务指定值），必要时为特定页面覆盖。
4. **梳理组件样式：** 像 `.filter-actions`、`.card` 这类在小屏下改方向/间距的逻辑统一回退；同时确认桌面下的间距是否需要重新定义，保证最终效果与现有桌面版本一致。

### 3.2 模板与组件
1. **替换响应式栅格类：**
   - 对 `col-12 col-lg-3` 的写法，根据桌面目标布局直接改成单一 `col-3` 或自定义 `flex: 0 0 25%`。
   - 若不再使用 Bootstrap 栅格，可在 `global.css` 中提供语义化的布局工具类（如 `.layout-quarter`, `.layout-third`）。
2. **导航栏与折叠菜单：**
   - 去除 `navbar-toggler`、`data-bs-toggle="collapse"`，将菜单始终呈现为横向布局；或保留折叠结构但删除触发按钮，避免残留逻辑。
3. **筛选组件宏：**
   - `app/templates/components/filters/macros.html` 的 `col-12 col-lg-2` 参数需要抽象成桌面固定栅格，例如 `filter-col-2`。
4. **表格/卡片布局：**
   - 检查 `.row` `g-3` 等语法，确保在桌面宽度下排列合理，不依赖断点。

### 3.3 资源与依赖
- Bootstrap Flatly 可保留（仍提供基础变量），但在文档中注明“不再使用响应式栅格/断点”；如需进一步瘦身，可在后续版本考虑自定义构建或替换为桌面主题。

---

## 4. 实施步骤
1. **基线配置**
   - 移除 `<meta name="viewport">`。
   - 在 `global.css` 中声明桌面基准（容器宽度、默认按钮宽、最小字体）。
2. **CSS 媒体查询清理**
   - 逐个文件移除 `@media`。建议先处理 `global.css` 和 `filter_common.css`，再按页面优先级（Dashboard → 账号/实例 → 其他页面）推进；每完成一处删减，立即在 1440px 视口对比旧版本，确认视觉无差异。
3. **模板栅格重写**
   - 先改公共宏（筛选器、通用表单），再处理页面模板，避免重复劳动。
   - 使用 `rg "col-(sm|md|lg|xl|xxl)" app/templates` 作为收尾检查。
4. **交互验证**
   - 本地运行 `make dev start-flask`，以 1440×900 为基准尺寸检查主要页面。无需再做移动端模拟，但可缩放至 1024px 确认不会出现致命错位。
5. **文档与规范更新**
   - 在 `docs/` 或 `AGENTS.md` 中新增条目，明确“禁止引入移动端断点”。

---

## 5. 风险与缓解
- **桌面窄屏用户（如 1024px）体验下降**：提前设计最小可用宽度（建议 1200px），并在登录页/页头提示“推荐 ≥1280px”。
- **历史代码回滚困难**：保留本方案文档与 Git tag，必要时可通过 `git show <tag>` 恢复。
- **第三方组件样式冲突**：Bootstrap 仍可能基于断点调整内部组件（如 modal 最大宽度）。若观察到异常，考虑覆盖 `.modal-dialog` 等宽度。
- **测试基线变更**：CI/UI 自动化脚本若依赖移动视口，需要同步调整（例如 Playwright/ Selenium 的 viewport 设置）。

---

## 6. 验证清单
1. `rg "@media" app/static/css` 返回 0。
2. `rg "col-(sm|md|lg|xl|xxl)" app/templates` 返回 0。
3. 导航栏在 1280px/1440px 下完整展示，无折叠按钮。
4. Dashboard、实例管理、账号管理、日志页面在桌面分辨率下无重叠/溢出。
5. `make test`、`make quality` 通过，确保样式调整未影响后端逻辑。
6. 在 README 或用户指南中更新“仅支持桌面端”的说明。

---

## 7. 后续建议
- 引入视觉基准说明（Figma/截图），指导今后只设计桌面稿。
- 若未来需要再次支持移动端，可基于当前提交新建分支，重新引入响应式栅格或改用独立的移动界面。
