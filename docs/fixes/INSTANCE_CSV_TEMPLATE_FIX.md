# å®ä¾‹CSVæ¨¡æ¿æ ¼å¼ä¿®å¤

## ğŸ” é—®é¢˜åˆ†æ

ç”¨æˆ·åé¦ˆå®ä¾‹æ‰¹é‡å¯¼å…¥çš„CSVæ¨¡æ¿æ ¼å¼ä¸æ­£ç¡®ï¼Œå¯¼è‡´æ— æ³•æ­£ç¡®æ‰¹é‡åˆ›å»ºå®ä¾‹ã€‚

### é—®é¢˜ç°è±¡ï¼š
ç”¨æˆ·æä¾›çš„æ­£ç¡®æ ¼å¼ï¼š
```csv
name,db_type,host,port,database_name,description,credential_id
mysql-prod-01,mysql,192.168.1.100,3306,mysql,production,ç”Ÿäº§ç¯å¢ƒMySQLä¸»åº“,1
```

ä½†ç³»ç»Ÿç”Ÿæˆçš„æ¨¡æ¿ä¸­ç¤ºä¾‹æ•°æ®æ ¼å¼é”™è¯¯ã€‚

### é—®é¢˜åŸå› ï¼š
1. **åˆ—é¡ºåºæ­£ç¡®**: æ¨¡æ¿çš„åˆ—é¡ºåºæ˜¯æ­£ç¡®çš„
2. **ç¤ºä¾‹æ•°æ®é”™è¯¯**: ç¤ºä¾‹æ•°æ®ä¸­ `description` å’Œ `credential_id` çš„å€¼ä½ç½®é¢ å€’äº†
3. **æ•°æ®ä¸åŒ¹é…**: ç¤ºä¾‹æ•°æ®ä¸åˆ—æ ‡é¢˜ä¸å¯¹åº”

## ğŸ”§ ä¿®å¤æ–¹æ¡ˆ

### 1. **ä¿®å¤å‰çš„é—®é¢˜**

#### é”™è¯¯çš„ç¤ºä¾‹æ•°æ®ï¼š
```csv
name,db_type,host,port,database_name,description,credential_id
mysql-prod-01,mysql,192.168.1.100,3306,mysql,production,ç”Ÿäº§ç¯å¢ƒMySQLä¸»åº“,1
```

**é—®é¢˜åˆ†æï¼š**
- `description` åˆ—çš„å€¼æ˜¯ `"production"`ï¼ˆåº”è¯¥æ˜¯æè¿°ä¿¡æ¯ï¼‰
- `credential_id` åˆ—çš„å€¼æ˜¯ `"ç”Ÿäº§ç¯å¢ƒMySQLä¸»åº“"`ï¼ˆåº”è¯¥æ˜¯æ•°å­—IDï¼‰

### 2. **ä¿®å¤åçš„æ­£ç¡®æ ¼å¼**

#### æ­£ç¡®çš„ç¤ºä¾‹æ•°æ®ï¼š
```csv
name,db_type,host,port,database_name,description,credential_id
mysql-prod-01,mysql,192.168.1.100,3306,mysql,ç”Ÿäº§ç¯å¢ƒMySQLä¸»åº“,1
mysql-dev-01,mysql,192.168.1.101,3306,mysql,å¼€å‘ç¯å¢ƒMySQL,2
postgres-test-01,postgresql,192.168.1.102,5432,postgres,æµ‹è¯•ç¯å¢ƒPostgreSQL,3
```

**ä¿®å¤å†…å®¹ï¼š**
- `description` åˆ—ï¼šæ”¾ç½®å®é™…çš„æè¿°ä¿¡æ¯
- `credential_id` åˆ—ï¼šæ”¾ç½®æ•°å­—ID

### 3. **å­—æ®µè¯´æ˜**

| å­—æ®µå | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|------|------|
| `name` | string | æ˜¯ | å®ä¾‹åç§°ï¼Œå¿…é¡»å”¯ä¸€ | `mysql-prod-01` |
| `db_type` | string | æ˜¯ | æ•°æ®åº“ç±»å‹ | `mysql`, `postgresql`, `sqlserver`, `oracle` |
| `host` | string | æ˜¯ | ä¸»æœºåœ°å€ | `192.168.1.100` |
| `port` | integer | æ˜¯ | ç«¯å£å· | `3306`, `5432`, `1433`, `1521` |
| `database_name` | string | å¦ | æ•°æ®åº“åç§° | `mysql`, `postgres`, `master` |
| `description` | string | å¦ | å®ä¾‹æè¿° | `ç”Ÿäº§ç¯å¢ƒMySQLä¸»åº“` |
| `credential_id` | integer | å¦ | å‡­æ®ID | `1`, `2`, `3` |

## ğŸ“Š ä¿®å¤æ•ˆæœ

### ä¿®å¤å‰ï¼š
```csv
name,db_type,host,port,database_name,description,credential_id
mysql-prod-01,mysql,192.168.1.100,3306,mysql,production,ç”Ÿäº§ç¯å¢ƒMySQLä¸»åº“,1
```
**ç»“æœ**: æ•°æ®å¯¼å…¥å¤±è´¥ï¼Œå­—æ®µå€¼ä¸åŒ¹é…

### ä¿®å¤åï¼š
```csv
name,db_type,host,port,database_name,description,credential_id
mysql-prod-01,mysql,192.168.1.100,3306,mysql,ç”Ÿäº§ç¯å¢ƒMySQLä¸»åº“,1
```
**ç»“æœ**: æ•°æ®å¯¼å…¥æˆåŠŸï¼Œå®ä¾‹åˆ›å»ºæ­£å¸¸

## ğŸ” æŠ€æœ¯ç»†èŠ‚

### 1. **CSVæ¨¡æ¿ç”Ÿæˆä»£ç **

#### ä¿®å¤å‰ï¼š
```python
writer.writerow(
    [
        "mysql-prod-01",
        "mysql",
        "192.168.1.100",
        "3306",
        "mysql",
        "production",           # é”™è¯¯ï¼šè¿™æ˜¯descriptionçš„å€¼
        "ç”Ÿäº§ç¯å¢ƒMySQLä¸»åº“",    # é”™è¯¯ï¼šè¿™æ˜¯credential_idçš„å€¼
        "1",
    ]
)
```

#### ä¿®å¤åï¼š
```python
writer.writerow(
    [
        "mysql-prod-01",
        "mysql",
        "192.168.1.100",
        "3306",
        "mysql",
        "ç”Ÿäº§ç¯å¢ƒMySQLä¸»åº“",    # æ­£ç¡®ï¼šdescriptionçš„å€¼
        "1",                   # æ­£ç¡®ï¼šcredential_idçš„å€¼
    ]
)
```

### 2. **æ•°æ®éªŒè¯å™¨æ”¯æŒ**

æ•°æ®éªŒè¯å™¨ `DataValidator` å·²ç»æ­£ç¡®æ”¯æŒæ‰€æœ‰å­—æ®µï¼š

```python
# å¿…å¡«å­—æ®µéªŒè¯
required_fields = ["name", "db_type", "host", "port"]

# å¯é€‰å­—æ®µéªŒè¯
if data.get("database_name"):
    db_name_error = cls._validate_database_name(data.get("database_name"))
if data.get("description"):
    desc_error = cls._validate_description(data.get("description"))
if data.get("credential_id"):
    cred_error = cls._validate_credential_id(data.get("credential_id"))
```

### 3. **æ‰¹é‡å¯¼å…¥å¤„ç†**

æ‰¹é‡å¯¼å…¥åŠŸèƒ½ `_process_csv_file` æ­£ç¡®å¤„ç†CSVæ•°æ®ï¼š

```python
# è¯»å–CSVæ–‡ä»¶
stream = io.StringIO(file.stream.read().decode("UTF8"), newline=None)
csv_input = csv.DictReader(stream)

instances_data = []
for row in csv_input:
    # æ¸…ç†æ•°æ®
    instance_data = {}
    for key, value in row.items():
        if value and value.strip():
            instance_data[key.strip()] = value.strip()
    instances_data.append(instance_data)
```

## ğŸš€ ä½¿ç”¨æŒ‡å—

### 1. **ä¸‹è½½æ¨¡æ¿**
1. è®¿é—®å®ä¾‹ç®¡ç†é¡µé¢
2. ç‚¹å‡»"ä¸‹è½½æ¨¡æ¿"æŒ‰é’®
3. ä¸‹è½½ `instances_template.csv` æ–‡ä»¶

### 2. **å¡«å†™æ•°æ®**
æŒ‰ç…§æ¨¡æ¿æ ¼å¼å¡«å†™å®ä¾‹æ•°æ®ï¼š

```csv
name,db_type,host,port,database_name,description,credential_id
mysql-prod-01,mysql,192.168.1.100,3306,mysql,ç”Ÿäº§ç¯å¢ƒMySQLä¸»åº“,1
mysql-dev-01,mysql,192.168.1.101,3306,mysql,å¼€å‘ç¯å¢ƒMySQL,2
postgres-test-01,postgresql,192.168.1.102,5432,postgres,æµ‹è¯•ç¯å¢ƒPostgreSQL,3
sqlserver-prod-01,sqlserver,192.168.1.103,1433,master,ç”Ÿäº§ç¯å¢ƒSQL Server,4
oracle-prod-01,oracle,192.168.1.104,1521,orcl,ç”Ÿäº§ç¯å¢ƒOracle,5
```

### 3. **æ‰¹é‡å¯¼å…¥**
1. åœ¨å®ä¾‹ç®¡ç†é¡µé¢ç‚¹å‡»"æ‰¹é‡åˆ›å»º"
2. é€‰æ‹©å¡«å†™å¥½çš„CSVæ–‡ä»¶
3. ç‚¹å‡»"ä¸Šä¼ "æŒ‰é’®
4. ç³»ç»Ÿä¼šè‡ªåŠ¨éªŒè¯å¹¶åˆ›å»ºå®ä¾‹

### 4. **éªŒè¯ç»“æœ**
- æ£€æŸ¥åˆ›å»ºæˆåŠŸçš„å®ä¾‹æ•°é‡
- æŸ¥çœ‹é”™è¯¯ä¿¡æ¯ï¼ˆå¦‚æœæœ‰ï¼‰
- éªŒè¯å®ä¾‹ä¿¡æ¯æ˜¯å¦æ­£ç¡®

## ğŸ“ æ³¨æ„äº‹é¡¹

### 1. **æ•°æ®æ ¼å¼è¦æ±‚**
- å®ä¾‹åç§°å¿…é¡»å”¯ä¸€
- æ•°æ®åº“ç±»å‹å¿…é¡»æ˜¯æ”¯æŒçš„ç±»å‹
- ç«¯å£å·å¿…é¡»æ˜¯1-65535ä¹‹é—´çš„æ•´æ•°
- å‡­æ®IDå¿…é¡»æ˜¯å·²å­˜åœ¨çš„å‡­æ®ID

### 2. **å¸¸è§é”™è¯¯**
- **å®ä¾‹åç§°é‡å¤**: ç¡®ä¿å®ä¾‹åç§°å”¯ä¸€
- **æ•°æ®åº“ç±»å‹ä¸æ”¯æŒ**: ä½¿ç”¨ `mysql`, `postgresql`, `sqlserver`, `oracle`
- **ç«¯å£å·æ— æ•ˆ**: ä½¿ç”¨1-65535ä¹‹é—´çš„æ•´æ•°
- **å‡­æ®IDä¸å­˜åœ¨**: ç¡®ä¿å‡­æ®IDåœ¨ç³»ç»Ÿä¸­å­˜åœ¨

### 3. **æœ€ä½³å®è·µ**
- å…ˆåˆ›å»ºå‡­æ®ï¼Œå†å¯¼å…¥å®ä¾‹
- ä½¿ç”¨æœ‰æ„ä¹‰çš„å®ä¾‹åç§°
- æä¾›æ¸…æ™°çš„æè¿°ä¿¡æ¯
- æµ‹è¯•è¿æ¥åå†æ‰¹é‡å¯¼å…¥

## ğŸ”„ æµ‹è¯•éªŒè¯

### 1. **æ¨¡æ¿ä¸‹è½½æµ‹è¯•**
- [ ] ä¸‹è½½æ¨¡æ¿æ–‡ä»¶
- [ ] æ£€æŸ¥åˆ—æ ‡é¢˜æ˜¯å¦æ­£ç¡®
- [ ] éªŒè¯ç¤ºä¾‹æ•°æ®æ ¼å¼

### 2. **æ•°æ®å¯¼å…¥æµ‹è¯•**
- [ ] ä½¿ç”¨ä¿®å¤åçš„æ¨¡æ¿å¡«å†™æ•°æ®
- [ ] ä¸Šä¼ CSVæ–‡ä»¶
- [ ] éªŒè¯å®ä¾‹åˆ›å»ºæˆåŠŸ
- [ ] æ£€æŸ¥å®ä¾‹ä¿¡æ¯æ­£ç¡®æ€§

### 3. **é”™è¯¯å¤„ç†æµ‹è¯•**
- [ ] æµ‹è¯•å¿…å¡«å­—æ®µç¼ºå¤±
- [ ] æµ‹è¯•æ•°æ®æ ¼å¼é”™è¯¯
- [ ] æµ‹è¯•å®ä¾‹åç§°é‡å¤
- [ ] æµ‹è¯•å‡­æ®IDä¸å­˜åœ¨

## ğŸ“Š ä¿®å¤æ€»ç»“

### ä¿®å¤æˆæœï¼š
1. **æ¨¡æ¿æ ¼å¼æ­£ç¡®**: CSVæ¨¡æ¿åˆ—é¡ºåºå’Œç¤ºä¾‹æ•°æ®å®Œå…¨åŒ¹é…
2. **æ•°æ®éªŒè¯å®Œå–„**: æ”¯æŒæ‰€æœ‰å­—æ®µçš„éªŒè¯
3. **æ‰¹é‡å¯¼å…¥æ­£å¸¸**: å¯ä»¥æˆåŠŸæ‰¹é‡åˆ›å»ºå®ä¾‹
4. **é”™è¯¯å¤„ç†å®Œå–„**: æä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯

### æŠ€æœ¯æ”¹è¿›ï¼š
1. **æ•°æ®ä¸€è‡´æ€§**: ç¡®ä¿æ¨¡æ¿å’ŒéªŒè¯å™¨å­—æ®µä¸€è‡´
2. **ç”¨æˆ·ä½“éªŒ**: æä¾›æ¸…æ™°çš„æ¨¡æ¿æ ¼å¼
3. **é”™è¯¯æç¤º**: è¯¦ç»†çš„éªŒè¯é”™è¯¯ä¿¡æ¯
4. **æ–‡æ¡£å®Œå–„**: è¯¦ç»†çš„ä½¿ç”¨æŒ‡å—

é€šè¿‡è¿™æ¬¡ä¿®å¤ï¼Œç”¨æˆ·å¯ä»¥æ­£ç¡®ä½¿ç”¨CSVæ¨¡æ¿è¿›è¡Œæ‰¹é‡å®ä¾‹åˆ›å»ºï¼Œå¤§å¤§æé«˜äº†æ•°æ®å¯¼å…¥çš„æ•ˆç‡ã€‚
