# ğŸŸ é²¸è½é¡¹ç›®éƒ¨ç½²æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

é²¸è½é¡¹ç›®æ”¯æŒå¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒçš„Dockerå®¹å™¨åŒ–éƒ¨ç½²ï¼Œæœ¬æ–‡æ¡£æä¾›å®Œæ•´çš„éƒ¨ç½²ã€é…ç½®å’Œè¿ç»´æŒ‡å—ã€‚

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### å¼€å‘ç¯å¢ƒæ¶æ„
```mermaid
graph TB
    D[å¼€å‘è€…] --> N1[Nginx:80]
    N1 --> F1[Flask App:5001]
    F1 --> P1[PostgreSQL:5432]
    F1 --> R1[Redis:6379]
```

### ç”Ÿäº§ç¯å¢ƒæ¶æ„
```mermaid
graph TB
    U[ç”¨æˆ·] --> LB[è´Ÿè½½å‡è¡¡å™¨]
    LB --> N2[Nginx:80/443]
    N2 --> F2[Flask App:5001]
    F2 --> P2[PostgreSQL:5432]
    F2 --> R2[Redis:6379]
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å¼€å‘ç¯å¢ƒ
```bash
# 1. å…‹éš†é¡¹ç›®
git clone https://github.com/your-org/TaifishingV4.git
cd TaifishingV4

# 2. é…ç½®ç¯å¢ƒå˜é‡
cp env.development .env

# 3. å¯åŠ¨å¼€å‘ç¯å¢ƒ
make dev start

# 4. è®¿é—®åº”ç”¨
open http://localhost
```

### ç”Ÿäº§ç¯å¢ƒ
```bash
# 1. é…ç½®ç”Ÿäº§ç¯å¢ƒ
cp env.production .env

# 2. éƒ¨ç½²ç”Ÿäº§ç¯å¢ƒ
make prod deploy

# 3. éªŒè¯éƒ¨ç½²
make prod health

# 4. è®¿é—®åº”ç”¨
open http://localhost
```

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡
| ç¯å¢ƒ | é…ç½®æ–‡ä»¶ | è¯´æ˜ |
|------|----------|------|
| å¼€å‘ç¯å¢ƒ | `env.development` | å¼€å‘ç¯å¢ƒé…ç½® |
| ç”Ÿäº§ç¯å¢ƒ | `env.production` | ç”Ÿäº§ç¯å¢ƒé…ç½® |

### æœåŠ¡ç»„ä»¶
| æœåŠ¡ | ç‰ˆæœ¬ | ç«¯å£ | åŠŸèƒ½ |
|------|------|------|------|
| Nginx | 1.18+ | 80, 443 | åå‘ä»£ç†ã€é™æ€æ–‡ä»¶æœåŠ¡ |
| Flask | 3.1.2 | 5001 | Webåº”ç”¨æœåŠ¡ |
| PostgreSQL | 15-alpine | 5432 | ä¸»æ•°æ®åº“ |
| Redis | 7.4.0 | 6379 | ç¼“å­˜å’Œä¼šè¯å­˜å‚¨ |
| APScheduler | 3.11.0 | - | å®šæ—¶ä»»åŠ¡è°ƒåº¦å™¨ |

## ğŸ› ï¸ è¿ç»´å‘½ä»¤

### å¼€å‘ç¯å¢ƒ
```bash
make dev start      # å¯åŠ¨å¼€å‘ç¯å¢ƒ
make dev stop       # åœæ­¢å¼€å‘ç¯å¢ƒ
make dev restart    # é‡å¯å¼€å‘ç¯å¢ƒ
make dev status     # æŸ¥çœ‹æœåŠ¡çŠ¶æ€
make dev logs       # æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—
make dev health     # å¥åº·æ£€æŸ¥
```

### ç”Ÿäº§ç¯å¢ƒ
```bash
make prod deploy    # éƒ¨ç½²ç”Ÿäº§ç¯å¢ƒ
make prod start     # å¯åŠ¨ç”Ÿäº§ç¯å¢ƒ
make prod stop      # åœæ­¢ç”Ÿäº§ç¯å¢ƒ
make prod restart   # é‡å¯ç”Ÿäº§ç¯å¢ƒ
make prod status    # æŸ¥çœ‹æœåŠ¡çŠ¶æ€
make prod logs      # æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—
make prod health    # å¥åº·æ£€æŸ¥
make prod backup    # å¤‡ä»½æ•°æ®
```

## ğŸ”’ å®‰å…¨é…ç½®

- ä½¿ç”¨é˜²ç«å¢™é™åˆ¶ç«¯å£è®¿é—®
- é…ç½®HTTPSè¯ä¹¦ï¼ˆæ¨èï¼‰
- ä½¿ç”¨å¼ºå¯†ç å’Œå¯†é’¥
- å®šæœŸæ›´æ–°ä¾èµ–åŒ…
- æ•°æ®åº“è¿æ¥åŠ å¯†
- å®šæœŸå¤‡ä»½æ•°æ®

## ğŸ“ˆ ç›‘æ§å’Œè¿ç»´

### å¥åº·æ£€æŸ¥
```bash
curl -f http://localhost/health
```

### æ—¥å¿—ç®¡ç†
| æœåŠ¡ | æ—¥å¿—æ–‡ä»¶ | è¯´æ˜ |
|------|----------|------|
| Nginx | `/var/log/nginx/whalefall_access.log` | è®¿é—®æ—¥å¿— |
| Flask | `/app/userdata/logs/whalefall.log` | åº”ç”¨æ—¥å¿— |

### æ€§èƒ½ç›‘æ§
| æŒ‡æ ‡ | é˜ˆå€¼ | è¯´æ˜ |
|------|------|------|
| CPUä½¿ç”¨ç‡ | < 80% | é¿å…è¿‡è½½ |
| å†…å­˜ä½¿ç”¨ç‡ | < 85% | é˜²æ­¢OOM |
| å“åº”æ—¶é—´ | < 2s | ç”¨æˆ·ä½“éªŒ |

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜
1. **å®¹å™¨å¯åŠ¨å¤±è´¥** - æ£€æŸ¥å®¹å™¨æ—¥å¿—: `docker logs container_name`
2. **æ•°æ®åº“è¿æ¥å¤±è´¥** - æ£€æŸ¥æ•°æ®åº“çŠ¶æ€: `docker-compose exec postgres pg_isready`
3. **åº”ç”¨æ— æ³•è®¿é—®** - æ£€æŸ¥ç«¯å£æ˜ å°„: `docker port container_name`

## ğŸ“š å‚è€ƒèµ„æº

- [Dockerå®˜æ–¹æ–‡æ¡£](https://docs.docker.com/)
- [Nginxé…ç½®æŒ‡å—](https://nginx.org/en/docs/)
- [PostgreSQLæ–‡æ¡£](https://www.postgresql.org/docs/)
- [Redisæ–‡æ¡£](https://redis.io/documentation)

---

**æ³¨æ„**: æœ¬æ–‡æ¡£ä¼šéšç€é¡¹ç›®å‘å±•æŒç»­æ›´æ–°ï¼Œè¯·å®šæœŸæŸ¥çœ‹æœ€æ–°ç‰ˆæœ¬ã€‚
