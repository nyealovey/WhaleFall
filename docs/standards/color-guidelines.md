# 界面色彩与视觉疲劳控制指南

## 背景
- 近期在“实例列表”“账户台账”等核心页面中同时存在多种高饱和语义色块（状态、标签、数据库类型、批量操作按钮），用户长时间浏览出现视觉疲劳与信息噪声。
- 设计规范要求禁止硬编码颜色但缺乏“如何精简色彩层级”的操作指引，本指南用于统一项目内色彩配比、组件实现与质检流程。

## 总体目标
1. **降低颜色数量**：在单一视区内，非图表信息的可视色彩 ≤ 7（含灰阶）。
2. **强化语义映射**：同一语义状态绑定固定 token（例如“正常”= `var(--success-color)`）。
3. **构建可复用组件**：状态、标签、数据库类型等均复用 `status-pill`、`chip-outline`、`ledger-chip-stack`，禁止页面自定义样式。
4. **提升阅读节奏**：通过字重、留白与交替行背景承载层级，颜色只做辅助提示。

## 色彩 2-3-4 规则
- **主色 ≤ 2**：品牌主色 `var(--accent-primary)` 与一种中性色（通常 `var(--text-primary)` 或 `var(--surface-contrast)`）。
- **辅助色 ≤ 3**：用于导航、次级按钮或图表；推荐从 `--orange-muted`、`--sidebar-accent`、`--surface-muted` 中择优；不得另行定义新 token。
- **语义色 ≤ 4**：固定使用 `--success-color`、`--warning-color`、`--danger-color`、`--info-color`；当页面不包含对应语义时，不得“装饰性”使用这四类颜色。
- **执行方式**：在设计稿与前端落地前完成色彩盘点，超过阈值需删减或合并信息层级。

## 组件级指导
### 状态与徽章
1. 统一使用 `status-pill` 组件（背景=token 20% 透明度，字色=token），支持 `success|warning|danger|muted|info`。
2. 状态列默认 70px 宽；`status-pill` 文案仅用“正常/锁定/删除/否”等短语。
3. 数据库类型、标签、分类采用 `chip-outline` 或 `ledger-chip`，白底+描边，不得自定义背景色。
4. 多个标签使用 `ledger-chip-stack`，默认展示全部，必要时使用 `+N` 计数，与 chip 同色。

### 列表与卡片
1. 行背景：默认白底，偶数行 `color-mix(in srgb, var(--surface-muted) 10%, transparent)`，hover 20%。
2. 批量操作：仅首要操作使用主色按钮，其余为描边；图标按钮保持 `--text-muted`。
3. 统一列宽策略：状态列 70px，chip 列 ≥200px，操作列 70px（可参考账户台账实现）。

### 导航与筛选
1. 顶部导航背景= `--surface-base`，激活项才使用主色底；其他入口使用描边/文字按钮。
2. 筛选卡片沿用 `ledger-chip` 视觉，选中态仅改变描边和字重，不改变背景。
3. 过滤按钮同时只允许 1 个主色 CTA，其余 outline。

### 图标与文本
1. 通用图标颜色固定为 `--text-muted`，仅在异常/危险语义中引用语义色。
2. 文本层级采用字号/字重：标题 18px/600、正文 14px/400、辅助 12px/400；禁止靠颜色深浅区分层级。
3. 表格中不再为 IP、版本等常驻字段配色，保持纯文本。

## 研发与质检流程
1. **设计交付检查**：UI 需附上“色彩清单”+ 组件表（使用了哪些 chip/pill）；评审时根据 2-3-4 规则确认通过。
2. **开发自检**：落地前运行 `./scripts/refactor_naming.sh --dry-run`，并通过 `rg` 检查是否存在 HEX/RGB；仅允许引用 token 或组件 class。
3. **质检表**（新增“视觉疲劳”项）：
   - 2 分钟注视表格页面后，焦点是否自然停留在主任务区域？
   - 页面内是否存在超出语义的语义色使用？
   - 同一行内多于 3 个彩色块是否可以合并？
4. **可用性回归**：试点页面上线前组织 ≥5 名内部用户体验 48 小时，记录完成任务时间、误点击率及主观疲劳反馈。

## 实施步骤
1. **试点复盘**：账户台账已完成治理；其它表格页面上线前需对照本文检查。
2. **推广**：将 `ledger-chip`、`status-pill` 提炼为公共组件，在 `app/static/css/components/` 中引用；页面如需自定义 chip，必须先在指南登记。
3. **文档维护**：任何新增 token 或例外方案，必须补充“场景+来源+退场计划”；若 2 个版本内未使用，需回收该 token。

## 附：推荐 token 映射
| 语义 | token | 场景 |
| --- | --- | --- |
| 品牌主色 | `var(--accent-primary)` | 主 CTA、激活导航 |
| 次级背景 | `var(--surface-muted)` | 筛选面板、交替行底色 |
| 成功 | `var(--success-color)` | 状态=正常/完成 |
| 告警 | `var(--warning-color)` | 状态=延迟/需关注 |
| 错误 | `var(--danger-color)` | 状态=禁用/失败 |
| 信息 | `var(--info-color)` | 异常但可继续操作的提示 |
| 状态 chip | `status-pill status-pill--<variant>` | 表格状态列（账户台账样式） |
| 标签/分类 | `ledger-chip` / `chip-outline` | 标签列、分类列遵循账户台账实现 |
| 中性文字 | `var(--text-muted)` | 次级说明、图标 |

> 注：若确需新增颜色，请先在设计评审会上给出“原因 + 退场机制”，并在 `app/static/css/variables.css` 定义 token；未经审批严禁在 CSS/HTML/JS 中硬编码。
