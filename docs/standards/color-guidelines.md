# 界面色彩与视觉疲劳控制指南

## 背景
- 近期在“实例列表”“账户台账”等核心页面中同时存在多种高饱和语义色块（状态、标签、数据库类型、批量操作按钮），用户长时间浏览出现视觉疲劳与信息噪声。
- 设计规范要求禁止硬编码颜色但缺乏“如何精简色彩层级”的操作指引，本指南用于统一项目内色彩配比、组件实现与质检流程。

## 总体目标
1. **降低颜色数量**：在单一视区内，非图表信息的可视色彩不超过 7 种（含灰阶）。
2. **强化语义映射**：同一语义状态必须绑定同一 token（例如“正常”= `var(--success-color)`），禁止同义多色。
3. **减少高对比背景**：除主要 CTA 与重要提醒外，优先使用描边/浅底表达信息，降低大面积纯色块。
4. **提升阅读节奏**：通过字重、留白与行间距承载层级，颜色只做辅助提示。

## 色彩 2-3-4 规则
- **主色 ≤ 2**：品牌主色 `var(--accent-primary)` 与一种中性色（通常 `var(--text-primary)` 或 `var(--surface-contrast)`）。
- **辅助色 ≤ 3**：用于导航、次级按钮或图表；推荐从 `--orange-muted`、`--sidebar-accent`、`--surface-muted` 中择优；不得另行定义新 token。
- **语义色 ≤ 4**：固定使用 `--success-color`、`--warning-color`、`--danger-color`、`--info-color`；当页面不包含对应语义时，不得“装饰性”使用这四类颜色。
- **执行方式**：在设计稿与前端落地前完成色彩盘点，超过阈值需删减或合并信息层级。

## 组件级指导
### 状态与徽章
1. “可用性/活跃度/版本”使用**单色文字+图标**，不再重复彩色胶囊；仅当状态为“异常/危险”时使用实心红色。
2. 数据库类型、标签等非关键语义改用**描边胶囊**：白底、`border-color: currentColor`，颜色来自 `--accent-primary` 或灰阶 token。
3. 同一行内的多个标签需合并成“分组标签”：例如“主从 / 生产环境”组合在一个胶囊内，内部用竖线或圆点区隔。

### 列表与卡片
1. 行背景颜色仅允许使用 `var(--surface-elevated)` 与 `var(--surface-muted)` 的 5% alpha 交错；禁止行内铺设额外渐变或色块。
2. 批量操作按钮遵循：首要操作（例：导入）使用实心主色，其余按钮使用描边或浅底（`background-color: var(--accent-primary-soft)`）。
3. “查看”“同步”等次级行为改为 icon-only，保持单一中性色。

### 导航与筛选
1. 顶部导航背景限定为 `--surface-base`，激活态采用主色底+白字；不得将某一导航项换成独立红色。
2. 筛选卡片的 chips 使用灰底+主色文字（`color: var(--accent-primary)`），选中态在描边上加粗即可，避免块状高饱和底色。
3. 过滤按钮同一时间只能有一个实心主色 CTA，其余均为描边风格。

### 图标与文本
1. 通用图标颜色固定为 `--text-muted`，仅在异常/危险语义中引用语义色。
2. 文本层级采用字号/字重：标题 18px/600、正文 14px/400、辅助 12px/400；禁止靠颜色深浅区分层级。
3. 表格中不再为 IP、版本等常驻字段配色，保持纯文本。

## 研发与质检流程
1. **设计交付检查**：UI 需附上“色彩清单”，列出所用 token、语义及出现次数；产品/前端评审阶段检查是否符合 2-3-4 规则。
2. **开发自检**：落地前运行 `./scripts/refactor_naming.sh --dry-run`（保持零命名违规），并通过 `rg` 检查是否存在 HEX/RGB；新样式必须引用 `app/static/css/variables.css` 中的 token。
3. **质检表**（新增“视觉疲劳”项）：
   - 2 分钟注视表格页面后，焦点是否自然停留在主任务区域？
   - 页面内是否存在超出语义的语义色使用？
   - 同一行内多于 3 个彩色块是否可以合并？
4. **可用性回归**：试点页面上线前组织 ≥5 名内部用户体验 48 小时，记录完成任务时间、误点击率及主观疲劳反馈。

## 实施步骤
1. **试点**：优先在“账户台账”视图套用本指南，清理多余标签色彩并记录效果。
2. **推广**：试点通过后，将改动总结写入 PR 描述并关联本文件；其他页面在收到设计需求时自动引用。
3. **文档维护**：任何新增 token 或例外方案，必须在本指南补充“使用场景 + 颜色来源 + 过期策略”。若 2 个版本内未使用，需回收该 token。

## 附：推荐 token 映射
| 语义 | token | 场景 |
| --- | --- | --- |
| 品牌主色 | `var(--accent-primary)` | 主 CTA、激活导航 |
| 次级背景 | `var(--surface-muted)` | 筛选面板、交替行底色 |
| 成功 | `var(--success-color)` | 状态=正常/完成 |
| 告警 | `var(--warning-color)` | 状态=延迟/需关注 |
| 错误 | `var(--danger-color)` | 状态=禁用/失败 |
| 信息 | `var(--info-color)` | 异常但可继续操作的提示 |
| 中性文字 | `var(--text-muted)` | 次级说明、图标 |

> 注：若确需新增颜色，请先在设计评审会上给出“原因 + 退场机制”，并在 `app/static/css/variables.css` 定义 token；未经审批严禁在 CSS/HTML/JS 中硬编码。
