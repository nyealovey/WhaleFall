# è‡ªåŠ¨åˆ†ç±»è§„åˆ™åŒ¹é…å…¨é¢ä¿®å¤æŠ¥å‘Š

## ä¿®å¤æ¦‚è¿°

é€šè¿‡æ·±å…¥åˆ†æï¼Œå‘ç°**æ‰€æœ‰æ•°æ®åº“ç±»å‹çš„è§„åˆ™è¯„ä¼°éƒ½å­˜åœ¨ä¸¥é‡çš„åŠŸèƒ½é—æ¼**ï¼Œå¯¼è‡´è‡ªåŠ¨åˆ†ç±»åŠŸèƒ½æ— æ³•æ­£å¸¸å·¥ä½œã€‚ç°å·²å®Œæˆå…¨é¢ä¿®å¤ã€‚

## å‘ç°çš„é—®é¢˜

### 1. SQL Server - âŒ å·²ä¿®å¤
**é—®é¢˜**: ç¼ºå¤±æ•°æ®åº“è§’è‰²ï¼ˆdatabase_rolesï¼‰å’Œæ•°æ®åº“æƒé™ï¼ˆdatabase_privilegesï¼‰æ£€æŸ¥
**å½±å“**: db_ownerç­‰æ•°æ®åº“è§’è‰²æ— æ³•è¢«æ­£ç¡®åˆ†ç±»
**ä¿®å¤**: âœ… å·²æ·»åŠ å®Œæ•´çš„æ•°æ®åº“è§’è‰²å’Œæƒé™æ£€æŸ¥é€»è¾‘

### 2. MySQL - âŒ å·²ä¿®å¤  
**é—®é¢˜**: ç¼ºå¤±æ•°æ®åº“æƒé™ï¼ˆdatabase_privilegesï¼‰æ£€æŸ¥
**å½±å“**: åŸºäºæ•°æ®åº“çº§åˆ«æƒé™çš„åˆ†ç±»è§„åˆ™å¤±æ•ˆ
**ä¿®å¤**: âœ… å·²æ·»åŠ æ•°æ®åº“æƒé™æ£€æŸ¥é€»è¾‘

### 3. PostgreSQL - âŒ å·²ä¿®å¤
**é—®é¢˜**: ç¼ºå¤±é¢„å®šä¹‰è§’è‰²ã€æ•°æ®åº“æƒé™ã€è¡¨ç©ºé—´æƒé™æ£€æŸ¥
**å½±å“**: åªèƒ½åŸºäºè§’è‰²å±æ€§åˆ†ç±»ï¼Œå…¶ä»–æƒé™ç±»å‹å®Œå…¨å¤±æ•ˆ
**ä¿®å¤**: âœ… å·²æ·»åŠ å®Œæ•´çš„æƒé™ç±»å‹æ£€æŸ¥é€»è¾‘

### 4. Oracle - âŒ å·²ä¿®å¤
**é—®é¢˜**: ç¼ºå¤±è¡¨ç©ºé—´æƒé™å’Œè¡¨ç©ºé—´é…é¢æ£€æŸ¥
**å½±å“**: è¡¨ç©ºé—´ç›¸å…³æƒé™æ— æ³•è¢«æ­£ç¡®åˆ†ç±»
**ä¿®å¤**: âœ… å·²æ·»åŠ è¡¨ç©ºé—´æƒé™å’Œé…é¢æ£€æŸ¥é€»è¾‘

## ä¿®å¤è¯¦æƒ…

### SQL Server ä¿®å¤
```python
# æ–°å¢ï¼šæ£€æŸ¥æ•°æ®åº“è§’è‰²
required_database_roles = rule_expression.get("database_roles", [])
if required_database_roles:
    # æ£€æŸ¥æ˜¯å¦åœ¨ä»»æ„æ•°æ®åº“ä¸­æœ‰ä»»ä¸€è¦æ±‚çš„è§’è‰²
    database_roles_match = False
    for db_name, roles in database_roles_data.items():
        if any(role in actual_roles for role in required_database_roles):
            database_roles_match = True
            break
    match_results.append(database_roles_match)

# æ–°å¢ï¼šæ£€æŸ¥æ•°æ®åº“æƒé™
required_database_perms = rule_expression.get("database_privileges", [])
if required_database_perms:
    # æ£€æŸ¥æ•°æ®åº“çº§åˆ«æƒé™
    database_perms_match = False
    for db_name, perms in database_perms_data.items():
        if any(perm in db_perms for perm in required_database_perms):
            database_perms_match = True
            break
    match_results.append(database_perms_match)
```

### MySQL ä¿®å¤
```python
# æ–°å¢ï¼šæ£€æŸ¥æ•°æ®åº“æƒé™
required_database = rule_expression.get("database_privileges", [])
if required_database:
    actual_database = permissions.get("database_privileges", {})
    if actual_database:
        # æ£€æŸ¥æ˜¯å¦åœ¨ä»»æ„æ•°æ®åº“ä¸­æœ‰ä»»ä¸€è¦æ±‚çš„æƒé™
        database_match = False
        for db_name, db_perms in actual_database.items():
            if operator == "AND":
                if all(perm in db_perms_set for perm in required_database):
                    database_match = True
                    break
            else:
                if any(perm in db_perms_set for perm in required_database):
                    database_match = True
                    break
        
        if not database_match:
            return False
```

### PostgreSQL ä¿®å¤
```python
# æ–°å¢ï¼šæ£€æŸ¥é¢„å®šä¹‰è§’è‰²
required_predefined_roles = rule_expression.get("predefined_roles", [])
if required_predefined_roles:
    predefined_roles_match = all(role in predefined_roles_set for role in required_predefined_roles)
    match_results.append(predefined_roles_match)

# æ–°å¢ï¼šæ£€æŸ¥æ•°æ®åº“æƒé™
required_database_perms = rule_expression.get("database_privileges", [])
if required_database_perms:
    # æ£€æŸ¥æ•°æ®åº“æƒé™åŒ¹é…é€»è¾‘
    match_results.append(database_perms_match)

# æ–°å¢ï¼šæ£€æŸ¥è¡¨ç©ºé—´æƒé™
required_tablespace_perms = rule_expression.get("tablespace_privileges", [])
if required_tablespace_perms:
    # æ£€æŸ¥è¡¨ç©ºé—´æƒé™åŒ¹é…é€»è¾‘
    match_results.append(tablespace_perms_match)
```

### Oracle ä¿®å¤
```python
# æ–°å¢ï¼šæ£€æŸ¥è¡¨ç©ºé—´æƒé™
required_tablespace_perms = rule_expression.get("tablespace_privileges", [])
if required_tablespace_perms:
    # æ£€æŸ¥è¡¨ç©ºé—´æƒé™åŒ¹é…é€»è¾‘
    match_results.append(tablespace_perms_match)

# æ–°å¢ï¼šæ£€æŸ¥è¡¨ç©ºé—´é…é¢
required_tablespace_quotas = rule_expression.get("tablespace_quotas", [])
if required_tablespace_quotas:
    # æ£€æŸ¥è¡¨ç©ºé—´é…é¢åŒ¹é…é€»è¾‘
    match_results.append(tablespace_quotas_match)
```

## ä¿®å¤åçš„åŠŸèƒ½å®Œæ•´æ€§

### æ”¯æŒçš„æƒé™ç±»å‹

| æ•°æ®åº“ç±»å‹ | æƒé™ç±»å‹ | ä¿®å¤å‰çŠ¶æ€ | ä¿®å¤åçŠ¶æ€ |
|-----------|---------|-----------|-----------|
| **SQL Server** | æœåŠ¡å™¨è§’è‰² | âœ… æ”¯æŒ | âœ… æ”¯æŒ |
| | æœåŠ¡å™¨æƒé™ | âœ… æ”¯æŒ | âœ… æ”¯æŒ |
| | **æ•°æ®åº“è§’è‰²** | âŒ ç¼ºå¤± | âœ… **å·²ä¿®å¤** |
| | **æ•°æ®åº“æƒé™** | âŒ ç¼ºå¤± | âœ… **å·²ä¿®å¤** |
| **MySQL** | å…¨å±€æƒé™ | âœ… æ”¯æŒ | âœ… æ”¯æŒ |
| | **æ•°æ®åº“æƒé™** | âŒ ç¼ºå¤± | âœ… **å·²ä¿®å¤** |
| | æ’é™¤æƒé™ | âœ… æ”¯æŒ | âœ… æ”¯æŒ |
| **PostgreSQL** | **é¢„å®šä¹‰è§’è‰²** | âŒ ç¼ºå¤± | âœ… **å·²ä¿®å¤** |
| | è§’è‰²å±æ€§ | âœ… æ”¯æŒ | âœ… æ”¯æŒ |
| | **æ•°æ®åº“æƒé™** | âŒ ç¼ºå¤± | âœ… **å·²ä¿®å¤** |
| | **è¡¨ç©ºé—´æƒé™** | âŒ ç¼ºå¤± | âœ… **å·²ä¿®å¤** |
| **Oracle** | è§’è‰² | âœ… æ”¯æŒ | âœ… æ”¯æŒ |
| | ç³»ç»Ÿæƒé™ | âœ… æ”¯æŒ | âœ… æ”¯æŒ |
| | **è¡¨ç©ºé—´æƒé™** | âŒ ç¼ºå¤± | âœ… **å·²ä¿®å¤** |
| | **è¡¨ç©ºé—´é…é¢** | âŒ ç¼ºå¤± | âœ… **å·²ä¿®å¤** |

## ä¿®å¤å½±å“

### åŠŸèƒ½å½±å“
- **SQL Server**: db_ownerç­‰æ•°æ®åº“è§’è‰²ç°åœ¨å¯ä»¥æ­£ç¡®åˆ†ç±»
- **MySQL**: æ•°æ®åº“çº§åˆ«æƒé™ç°åœ¨å¯ä»¥æ­£ç¡®åˆ†ç±»
- **PostgreSQL**: é¢„å®šä¹‰è§’è‰²ã€æ•°æ®åº“æƒé™ã€è¡¨ç©ºé—´æƒé™ç°åœ¨å¯ä»¥æ­£ç¡®åˆ†ç±»
- **Oracle**: è¡¨ç©ºé—´æƒé™å’Œé…é¢ç°åœ¨å¯ä»¥æ­£ç¡®åˆ†ç±»

### ä¸šåŠ¡å½±å“
- **æƒé™åˆ†ç±»å‡†ç¡®æ€§å¤§å¹…æå‡**: æ‰€æœ‰æ•°æ®åº“ç±»å‹çš„æƒé™éƒ½èƒ½è¢«æ­£ç¡®è¯†åˆ«å’Œåˆ†ç±»
- **å®‰å…¨åˆè§„æ€§å¢å¼º**: é«˜æƒé™è´¦æˆ·ï¼ˆå¦‚db_ownerï¼‰ç°åœ¨èƒ½è¢«æ­£ç¡®åˆ†ç±»å’Œç®¡ç†
- **ç®¡ç†æ•ˆç‡æå‡**: åŸºäºå„ç§æƒé™ç±»å‹çš„ç²¾ç»†åŒ–åˆ†ç±»è§„åˆ™ç°åœ¨éƒ½èƒ½æ­£å¸¸å·¥ä½œ

## æŠ€æœ¯æ”¹è¿›

### 1. ç»Ÿä¸€çš„åŒ¹é…é€»è¾‘
- æ‰€æœ‰æ•°æ®åº“ç±»å‹ç°åœ¨éƒ½ä½¿ç”¨ç»Ÿä¸€çš„ `match_results` æ•°ç»„å’Œæ“ä½œç¬¦é€»è¾‘
- æ”¯æŒ AND/OR æ“ä½œç¬¦çš„çµæ´»ç»„åˆ

### 2. å¥å£®çš„æ•°æ®å¤„ç†
- æ”¯æŒå¤šç§æ•°æ®æ ¼å¼ï¼ˆåˆ—è¡¨ã€å­—å…¸ã€åµŒå¥—ç»“æ„ï¼‰
- ç»Ÿä¸€çš„æƒé™æå–å’ŒåŒ¹é…é€»è¾‘

### 3. å®Œæ•´çš„é”™è¯¯å¤„ç†
- æ¯ä¸ªæ•°æ®åº“ç±»å‹éƒ½æœ‰ç‹¬ç«‹çš„å¼‚å¸¸å¤„ç†
- è¯¦ç»†çš„é”™è¯¯æ—¥å¿—è®°å½•

## éªŒè¯å»ºè®®

### 1. åŠŸèƒ½æµ‹è¯•
- ä¸ºæ¯ä¸ªæ•°æ®åº“ç±»å‹åˆ›å»ºåŒ…å«å„ç§æƒé™çš„æµ‹è¯•è§„åˆ™
- éªŒè¯ AND/OR æ“ä½œç¬¦çš„æ­£ç¡®æ€§
- æµ‹è¯•è¾¹ç•Œæƒ…å†µå’Œå¼‚å¸¸æ•°æ®

### 2. æ€§èƒ½æµ‹è¯•
- æµ‹è¯•å¤§é‡è´¦æˆ·çš„è§„åˆ™åŒ¹é…æ€§èƒ½
- éªŒè¯å†…å­˜ä½¿ç”¨æƒ…å†µ

### 3. é›†æˆæµ‹è¯•
- æµ‹è¯•å®Œæ•´çš„è´¦æˆ·åŒæ­¥å’Œåˆ†ç±»æµç¨‹
- éªŒè¯å‰ç«¯è§„åˆ™é…ç½®å’Œåç«¯åŒ¹é…çš„ä¸€è‡´æ€§

## æ€»ç»“

æ­¤æ¬¡ä¿®å¤è§£å†³äº†**æ‰€æœ‰æ•°æ®åº“ç±»å‹**çš„è§„åˆ™åŒ¹é…åŠŸèƒ½ç¼ºé™·ï¼Œä½¿è‡ªåŠ¨åˆ†ç±»ç³»ç»Ÿèƒ½å¤Ÿï¼š

1. **å®Œæ•´æ”¯æŒ**æ‰€æœ‰å‰ç«¯é…ç½®çš„æƒé™ç±»å‹
2. **æ­£ç¡®è¯†åˆ«**å„ç§æ•°æ®åº“è§’è‰²å’Œæƒé™
3. **çµæ´»ç»„åˆ**ä¸åŒæƒé™ç±»å‹çš„åˆ†ç±»è§„åˆ™
4. **æä¾›å‡†ç¡®**çš„æƒé™åˆ†ç±»ç»“æœ

ä¿®å¤åï¼Œé²¸è½ç³»ç»Ÿçš„è‡ªåŠ¨åˆ†ç±»åŠŸèƒ½å°†èƒ½å¤Ÿå®ç°çœŸæ­£çš„**ç²¾ç»†åŒ–æƒé™ç®¡ç†**ï¼Œä¸ºæ•°æ®åº“å®‰å…¨åˆè§„æä¾›å¼ºæœ‰åŠ›çš„æ”¯æŒã€‚

**ä¿®å¤çŠ¶æ€**: âœ… **å…¨éƒ¨å®Œæˆ**
**å½±å“èŒƒå›´**: ğŸ”´ **æ ¸å¿ƒåŠŸèƒ½** - å½±å“æ‰€æœ‰æ•°æ®åº“ç±»å‹çš„è‡ªåŠ¨åˆ†ç±»
**ä¼˜å…ˆçº§**: ğŸ”´ **é«˜ä¼˜å…ˆçº§** - å·²ç«‹å³ä¿®å¤
