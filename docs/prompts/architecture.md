通用输出约束（必须遵守）：
- 最终产出是一份 Markdown 审计报告（不是聊天回复/提纲），可直接保存到 `docs/reports/`。
- 文件名 MUST 使用英文 `kebab-case.md`，并建议带日期前缀：`YYYY-MM-DD_architecture-audit-report.md`。
- 报告结构 MUST 遵守 `docs/standards/documentation-standards.md` 的 `reports/*` 最小结构：摘要结论（先给结论）/范围与方法/发现清单（按 P0/P1/P2）/建议与后续行动/证据与数据来源（可链接到 `docs/reports/artifacts/`）。
- 标题下 MUST 包含元信息块：状态/负责人/创建/更新/范围/关联（用相对路径链接标准文档）。
- 每条发现 MUST 给出可定位证据（文件:行号/路由/函数/配置键），并包含修复建议与验证方法。

你现在是“资深架构师 + SRE/可观测性 + 安全审计 + 数据库专家 + 前端工程化负责人”的组合角色。请基于我给你的仓库与文档，做一次“查漏补缺式”的架构评审：不要重复我现有结论，除非你能补充更具体的证据、影响范围或更优解。

输入材料（我会提供其一或全部）：
- 现有评审文档：docs/architecture/architecture-review.md
- 仓库代码
- 相关辅助文档（如 docs/architecture/project-structure.md、docs/reference/api/api-routes-documentation.md、env.*、docker/make 脚本等）

你的目标：
1) 找出“我文档里没覆盖/覆盖不深”的架构问题（含隐性风险、未来演进阻力、线上可运维性问题）。
2) 每个问题都要给出：证据（文件/函数/配置/路由/调用链）、影响（坏了会怎样）、优先级（P0/P1/P2）、可落地的改进方案（短期止血/中期重构/长期演进）。
3) 补齐“缺失的架构决策与约束”：列出我需要写进文档的 ADR/规范（例如：配置策略、API 规范、任务调度拓扑、错误 schema、数据迁移策略等）。

工作方法（必须按步骤输出）：
A. 先读 docs/architecture/architecture-review.md，列出它已经覆盖的主题清单（只列标题/要点即可）。
B. 做“缺口地图”：对照下面的架构检查维度，指出哪些维度缺失/只有结论没有证据/只有现状没有决策。
C. 在代码/配置/脚本中找证据：每条新增问题必须至少给 1 个“可定位证据”（文件路径 + 行号或函数名/路由名/配置键）。
D. 输出“新增问题清单”（按 P0→P2 排序），并给出“最小可执行路线图”（最多 6 条行动项，每条都可在 1~3 天内独立完成或明确拆分）。

架构检查维度（逐项过一遍，不得跳过）：
1) 需求与边界
- 系统的核心用例/非核心用例是什么？哪些是“必须不出错”的关键链路？
- 系统边界：哪些属于 Web（页面/模板）、哪些属于 API、哪些属于任务/调度、哪些属于外部系统（远端 DB/第三方服务）？

2) 运行时拓扑与部署
- 进程模型：WSGI/worker 类型（gevent/gunicorn 等）、多进程/多实例时的行为差异
- Scheduler 是否会重复跑？jobstore 可靠性/一致性？任务幂等性/补偿机制？
- 启动顺序与依赖（DB/Redis）不可用时的降级策略是否“可观测且可控”（而不是静默失败）？
- 健康检查/ready/liveness、优雅关闭、连接池回收

3) 配置与环境一致性
- 配置来源是否唯一真实来源（SSOT）？是否存在 import-time 副作用/校验导致的不可预测启动失败？
- dev/staging/prod 的差异是否被显式声明（而不是散落 if/else 或默认值兜底）？
- 密钥/敏感配置是否有安全边界（.env、env.example、日志打印风险）

4) API 设计与契约治理
- 路由分区（页面 API vs 对外 API）是否可一眼识别？版本化策略？
- 错误 schema 是否统一？是否存在 message/error 漂移与前端互兜底导致长期不可治理？
- 鉴权/授权（RBAC/最小权限）、CSRF/CORS 策略是否与路由分区严格对齐？
- 输入校验与输出 DTO 是否稳定（TypedDict/DTO/序列化策略）

5) 数据与一致性
- 事务边界是否清晰（route/service/repo 谁负责 begin/commit）？失败回滚与重试策略？
- ORM 查询是否有 N+1/慢查询/缺索引风险？大表分页/排序白名单？
- migrations 策略：迁移脚本是否版本控制？向前/向后兼容（滚动发布）怎么做？
- 多数据库适配器：连接管理、超时、隔离级别、SQL 方言差异的封装边界是否稳定？

6) 可靠性与韧性（Resilience）
- 外部依赖（远端 DB/Redis/网络）失败时：超时、重试、熔断、降级、限流是否存在？
- 后台任务：幂等、去重、补偿、告警；任务执行失败是否会被“吞掉”？
- 缓存一致性：缓存击穿/雪崩/穿透，失效策略与观测指标

7) 安全（必须给出具体证据）
- 注入风险（SQL/命令/模板/XSS）、SSRF、文件上传、路径遍历
- 日志是否包含敏感数据？审计日志/操作留痕是否需要？
- 权限校验是否集中且可复用？是否存在“页面路由绕过 API 权限”的路径？

8) 可观测性与可运维性
- 结构化日志字段是否足够定位（module/action/context）？错误是否可关联到请求/任务？
- 指标：任务成功率、队列/调度延迟、DB 连接池、慢查询、缓存命中率
- 告警：哪些必须告警，阈值与责任人（即便只有你）怎么定义？
- Runbook：常见故障如何排查（缺 DB/Redis、任务不跑、迁移失败等）

9) 代码组织与演进成本
- 分层是否有破口（route 里写复杂查询/业务分支）？依赖方向是否稳定？
- 领域边界（services 模块划分）是否与业务一致？是否出现“横切工具”被当业务层使用？
- 测试策略：关键服务/数据转换是否可测？哪些地方缺测试会阻碍重构？

输出格式（严格遵守；按 `docs/standards/documentation-standards.md` 的 `reports/*` 模板组织）：
- 建议报告路径：`docs/reports/YYYY-MM-DD_architecture-audit-report.md`
- 标题下必须包含元信息块：状态/负责人/创建/更新/范围/关联

报告必须包含以下一级标题（顺序固定）：
I. 摘要结论（先给结论）
II. 范围与方法
III. 发现清单（按 P0/P1/P2）
IV. 建议与后续行动
V. 证据与数据来源

“范围与方法”中必须包含：
- 现有评审覆盖清单（只列主题，不展开）
- 缺口地图（按上述 1~9 维度逐条给：缺口描述 + 我应该补写的文档小节标题）

“发现清单（按 P0/P1/P2）”中必须包含：
- 新增架构问题清单（每条包含：标题/证据/影响/根因/建议/验证）

“建议与后续行动”中必须包含：
- 最小可执行路线图（最多 6 条行动项，每条 1~3 天内可独立完成或明确拆分）

附加要求（作为“发现清单”的一个子节输出）：扫描“防御/兼容/回退/适配”逻辑（重点关注 or / || / get('new') or get('old') 兜底）
- 识别标准：
  - 兼容：backward/forward compatibility, legacy, deprecation, polyfill, shim, wrapper, facade
  - 防御：guard clause, failsafe, resilience, workaround, graceful degradation
  - 回退：failsafe, failover
  - 适配：bridge, proxy
  - 数据特定：migration, versioning, serialization, canonicalization, coercion；模式如 data.get('new') or data.get('old')
- 输出格式（逐条）：
  - 位置：文件:行号
  - 类型：兼容/防御/回退/适配
  - 描述：例如“数据字段兼容，使用 or 兜底旧 key”
  - 建议：例如“完成迁移后删除兜底，并加监控/告警统计命中率”
