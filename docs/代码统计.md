# 代码统计报告

> 生成时间: 2025-11-14

## 总览

| 类型 | 文件数 | 代码行数 |
|------|--------|----------|
| Python (后端) | 193 | 31,445 |
| JavaScript (前端) | 62 | 17,360 |
| HTML (模板) | 36 | 7,325 |
| CSS (样式) | 28 | 3,475 |
| Python (测试) | 7 | 389 |
| **总计** | **326** | **59,994** |

## Python 后端代码 (31,445 行)

### 按模块分布

| 模块 | 文件数 | 代码行数 | 占比 |
|------|--------|----------|------|
| routes/ | 28 | 8,097 | 25.8% |
| services/ (含子目录) | 73 | 11,077 | 35.2% |
| utils/ | 14 | 2,998 | 9.5% |
| models/ | 20 | 2,078 | 6.6% |
| tasks/ | 6 | 1,866 | 5.9% |
| 其他 | 52 | 5,329 | 17.0% |

### 最大的 Python 文件 (Top 15)

| 文件 | 行数 | 说明 |
|------|------|------|
| tasks/capacity_collection_tasks.py | 678 | 容量采集任务 |
| services/aggregation/aggregation_service.py | 667 | 聚合服务 |
| tasks/capacity_aggregation_tasks.py | 663 | 容量聚合任务 |
| services/account_sync/adapters/sqlserver_adapter.py | 586 | SQL Server 适配器 |
| routes/instance.py | 585 | 实例路由 |
| routes/instance_detail.py | 581 | 实例详情路由 |
| services/account_sync/permission_manager.py | 571 | 权限管理器 |
| routes/account_classification.py | 568 | 账号分类路由 |
| services/partition_management_service.py | 565 | 分区管理服务 |
| \_\_init\_\_.py | 541 | 应用初始化 |
| routes/partition.py | 529 | 分区路由 |
| services/aggregation/database_aggregation_runner.py | 485 | 数据库聚合执行器 |
| utils/data_validator.py | 471 | 数据验证工具 |
| services/sync_session_service.py | 462 | 同步会话服务 |
| routes/scheduler.py | 446 | 调度器路由 |

### services/ 子模块详细分布

| 子模块 | 文件数 | 代码行数 |
|--------|--------|----------|
| aggregation/ | 7 | 1,970 |
| account_sync/ (含 adapters) | 14 | 2,979 |
| form_service/ | 10 | 1,213 |
| statistics/ | 5 | 925 |
| database_sync/ (含 adapters) | 11 | 1,504 |
| account_classification/ (含 classifiers) | 11 | 1,191 |
| connection_adapters/ (含 adapters) | 9 | 712 |
| instances/ | 2 | 278 |
| 其他 | 4 | 305 |

## JavaScript 前端代码 (17,360 行)

### 按目录分布

| 目录 | 文件数 | 代码行数 | 占比 |
|------|--------|----------|------|
| common/ | 9 | 2,410 | 13.9% |
| pages/instances/ | 4 | 1,890 | 10.9% |
| pages/admin/ | 3 | 1,864 | 10.7% |
| common/capacity_stats/ | 6 | 1,707 | 9.8% |
| components/ | 3 | 1,410 | 8.1% |
| pages/accounts/ | 2 | 1,394 | 8.0% |
| pages/tags/ | 3 | 1,340 | 7.7% |
| pages/history/ | 2 | 1,282 | 7.4% |
| modules/services/ | 13 | 886 | 5.1% |
| pages/credentials/ | 2 | 610 | 3.5% |
| 其他 | 15 | 2,567 | 14.9% |

### 最大的 JavaScript 文件 (Top 15)

| 文件 | 行数 | 说明 |
|------|------|------|
| components/tag_selector.js | 1,095 | 标签选择器组件 |
| pages/accounts/account_classification.js | 1,011 | 账号分类页面 |
| pages/admin/scheduler.js | 978 | 调度器管理页面 |
| pages/tags/batch_assign.js | 863 | 标签批量分配 |
| common/capacity_stats/manager.js | 801 | 容量统计管理器 |
| common/permission_policy_center.js | 722 | 权限策略中心 |
| pages/instances/list.js | 693 | 实例列表页面 |
| pages/instances/detail.js | 681 | 实例详情页面 |
| pages/history/sync_sessions.js | 667 | 同步会话历史 |
| pages/history/logs.js | 615 | 日志历史页面 |
| pages/admin/aggregations_chart.js | 614 | 聚合图表页面 |
| common/permission-modal.js | 561 | 权限模态框 |
| pages/credentials/list.js | 413 | 凭证列表页面 |
| components/filters/filter_utils.js | 406 | 过滤器工具 |
| utils/validation-rules.js | 386 | 验证规则工具 |

## HTML 模板 (7,325 行)

- 文件数: 36
- 平均每个文件: 203 行
- 位置: `app/templates/`

## CSS 样式 (3,475 行)

- 文件数: 28
- 平均每个文件: 124 行
- 位置: `app/static/css/`

## 测试代码 (389 行)

- 文件数: 7
- 位置: `tests/`
- **测试覆盖率较低，建议增加测试用例**

## 代码质量观察

### 需要关注的大文件 (>600 行)

**Python:**
- 3 个文件超过 650 行 (tasks、services)
- 建议拆分: `capacity_collection_tasks.py` (678 行)

**JavaScript:**
- 2 个文件超过 1000 行
- 建议重构: `tag_selector.js` (1,095 行)、`account_classification.js` (1,011 行)

### 模块化建议

1. **前端 pages/** 目录文件普遍较大 (600-1000 行)，建议:
   - 提取可复用组件到 `components/`
   - 将业务逻辑移至 `modules/services/`
   - 拆分视图层与数据层

2. **后端 routes/** 目录承载过多逻辑 (8,097 行)，建议:
   - 将业务逻辑下沉到 `services/`
   - 路由层只负责请求处理和响应

3. **测试覆盖不足**:
   - 测试代码仅 389 行，相对于 31,445 行后端代码
   - 建议补充单元测试和集成测试

## 统计方法

```bash
# Python 后端
find app -name "*.py" -type f -exec wc -l {} +

# JavaScript 前端
find app/static/js -name "*.js" -type f -exec wc -l {} +

# HTML 模板
find app/templates -name "*.html" -type f -exec wc -l {} +

# CSS 样式
find app/static/css -name "*.css" -type f -exec wc -l {} +

# 测试代码
find tests -name "*.py" -type f -exec wc -l {} +
```
