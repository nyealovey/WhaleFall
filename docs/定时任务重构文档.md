# 定时任务系统重构文档（方案 A）

文档版本：2025-11-04 v1.1  
维护者：平台开发组

---

## 一、问题诊断

### 1.1 现有任务配置概览

| 类别 | 任务 ID | 默认执行时间 | 功能 | 会话记录状态 |
|------|---------|--------------|------|--------------|
| 账户同步 | `sync_accounts` | 每天 01:00 | 全量同步账户信息 | ❌ 重构前缺失 |
| 日志清理 | `cleanup_old_logs` | 每天 02:00 | 清理 30 天前日志 | N/A |
| 容量同步 | `collect_database_sizes` | 每天 03:00 | 采集实例容量 | ✅ 正常 |
| 容量聚合 | `calculate_database_size_aggregations` | 每天 04:00 | 统计日/周/月/季数据 | ✅ 正常 |
| 分区监控 | `monitor_partition_health` | 每天 00:30 | 监控分区健康 | ✅ 正常 |

### 1.2 现象（重构前）

- `sync_accounts` 定时或手动执行后，`sync_instance_records` 无对应记录。
- 会话中心看不到实例级统计，难以排查失败实例。
- 手动“立即执行”会阻塞 Web 请求，超时后被 Gunicorn 杀掉。

### 1.3 根因

```python
result = account_sync_service.sync_accounts(
    instance,
    sync_type=SyncOperationType.SCHEDULED_TASK.value,
    session_id=session.session_id,  # ❌ 传入 session_id，服务层走“已有会话”分支
)
```

- 传入 `session_id` 后，`AccountSyncService` 直接进入 `_sync_with_existing_session`，不会更新会话与实例记录。
- 手动执行 API 直接在请求线程内运行任务，长时间阻塞导致 worker timeout。
- 硬编码回退配置与 YAML 不一致（30 分钟一次）。

---

## 二、方案概述

### 2.1 目标

1. **任务层管理会话记录**：仿照容量同步，在定时任务中创建会话、更新记录。
2. **协调器职责单一**：仅处理连接、两阶段同步、断开。
3. **手动执行异步化**：避免阻塞 Web 请求。
4. **硬编码配置对齐**：确保回退时执行计划一致。

### 2.2 架构对比

| 模块 | 重构前 | 重构后 |
|------|--------|--------|
| 任务入口 | 调用服务层并传 `session_id` | 任务层直接使用协调器 |
| 会话记录 | 被服务层跳过 | 在任务层调用 `sync_session_service` |
| 手动执行 | 同步执行，易超时 | 后台线程执行，API 立即返回 |
| 硬编码计划 | 30 分钟一次 | 每天 01:00，与 YAML 一致 |

---

## 三、实施步骤

### 3.1 任务层改造（`app/tasks/account_sync_tasks.py`）

核心逻辑示例：

```python
session = sync_session_service.create_session(
    sync_type=SyncOperationType.MANUAL_TASK.value if manual_run else SyncOperationType.SCHEDULED_TASK.value,
    sync_category=SyncCategory.ACCOUNT.value,
    created_by=created_by,
)

records = sync_session_service.add_instance_records(
    session.session_id,
    [inst.id for inst in instances],
    sync_category=SyncCategory.ACCOUNT.value,
)

for record, instance in zip(records, instances):
    sync_session_service.start_instance_sync(record.id)
    coordinator = AccountSyncCoordinator(instance)
    try:
        if not coordinator.connect():
            sync_session_service.fail_instance_sync(record.id, "无法建立数据库连接")
            continue

        summary = coordinator.sync_all(session_id=f"{session.session_id}_{instance.id}")
        inventory = summary.get("inventory", {})
        permissions = summary.get("permissions", {})

        sync_session_service.complete_instance_sync(
            record.id,
            items_synced=permissions.get("updated", 0) + permissions.get("created", 0),
            items_created=inventory.get("created", 0),
            items_updated=permissions.get("updated", 0),
            items_deleted=inventory.get("deactivated", 0),
            sync_details=summary,
        )
    except Exception as exc:
        sync_session_service.fail_instance_sync(record.id, str(exc))
    finally:
        coordinator.disconnect()
```

会话层的成功/失败统计统一在循环结束后写回 `sync_sessions`。

### 3.2 Scheduler 手动执行异步化（`app/routes/scheduler.py`）

```python
def run_job(job_id: str) -> Response:
    ...
    def _run_job_in_background() -> None:
        manual_kwargs = dict(job.kwargs) if job.kwargs else {}
        if job_id in ["sync_accounts", "calculate_database_size_aggregations"]:
            manual_kwargs["manual_run"] = True
            manual_kwargs["created_by"] = current_user.id if current_user.is_authenticated else None
        job.func(*job.args, **manual_kwargs)

    threading.Thread(target=_run_job_in_background, name=f"{job_id}_manual", daemon=True).start()
    return jsonify_unified_success(message="任务已提交后台执行")
```

### 3.3 硬编码计划修正（`app/scheduler.py/_add_hardcoded_default_jobs()`）

```python
scheduler.add_job(
    sync_accounts,
    CronTrigger(hour=1, minute=0, timezone="Asia/Shanghai"),
    id="sync_accounts",
    name="账户同步",
)
```

---

## 四、测试验证

### 4.1 自动化 / 手动流程

1. 重启 Flask & Scheduler：`make dev restart`
2. 通过 UI 或 `POST /scheduler/api/jobs/sync_accounts/run` 触发任务。
3. 查看会话中心是否记录新的会话与实例条目。

### 4.2 数据库校验

```sql
SELECT session_id, sync_type, status
FROM sync_sessions
WHERE sync_category = 'account'
ORDER BY created_at DESC
LIMIT 5;

SELECT instance_id, status, items_created, items_updated
FROM sync_instance_records
WHERE sync_category = 'account'
ORDER BY created_at DESC
LIMIT 10;
```

### 4.3 预期结果

- 会话表与实例记录表均出现最新条目，状态为 `completed` / `failed`。
- 失败实例不会阻断后续实例同步。
- 手动执行 API 即刻返回，日志中可见后台线程开始/结束记录。

---

## 五、注意事项与回滚

- **手动触发依赖 flask_login**：后台线程在触发时读取 `current_user`，需要在请求上下文内触发。系统服务调用时，继续传入 `manual_run=False` 即可。
- **回滚方案**：保留原任务文件备份，必要时将 `account_sync_tasks.py`、`scheduler.py`、`routes/scheduler.py` 恢复到重构前版本并重启服务。

---

## 六、后续优化建议

1. **简化 `AccountSyncService`**：重构后主要用于单实例同步，可把内部会话逻辑进一步收敛。
2. **统一任务配置来源**：进一步减少硬编码，仅在 YAML 缺失时抛出异常提示配置问题。
3. **增加重试与超时控制**：根据实例类型设置更细粒度的连接/查询超时，减少慢实例对整体任务的影响。
4. **引入任务执行指标**：如 Prometheus 指标或额外日志字段，用于监控成功率、耗时。

---

## 附录

### A. 受影响文件

- `app/tasks/account_sync_tasks.py`
- `app/routes/scheduler.py`
- `app/scheduler.py`

### B. 关键常量

- `SyncCategory.ACCOUNT`
- `SyncOperationType.MANUAL_TASK` / `SCHEDULED_TASK`
- `SyncSessionService`
- `AccountSyncCoordinator`

---

> 本方案已在 2025-11-04 合并至主分支。若后续出现新问题，请在合并请求中引用本方案并描述新增情况。***
 End Patch
PATCH] to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_applyPATCH to=functions_applyPATCH to=functions_applyPATCH to=functions_applyPATCH to=functions_applyPATCH to=functions_applyPATCH to=functions_applyPATCH to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply_patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patchiongozi to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patchоят to=functions.apply.patch to=functions.apply.patch to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_applyPATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions_apply_PATCH to=functions.apply_patch to=functions.apply_patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply.patch to=functions.apply*** End Patch
