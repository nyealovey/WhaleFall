I001 [*] Import block is un-sorted or un-formatted
  --> app/__init__.py:6:1
   |
 4 |   """
 5 |
 6 | / import logging
 7 | | from datetime import datetime
 8 | | from functools import lru_cache
 9 | | from importlib import import_module
10 | | from logging.handlers import RotatingFileHandler
11 | | from pathlib import Path
12 | | from typing import TYPE_CHECKING, Union
13 | |
14 | | from flask import Blueprint, Flask, jsonify, request
15 | | from flask.typing import ResponseReturnValue
16 | | from flask_bcrypt import Bcrypt
17 | | from flask_caching import Cache
18 | | from flask_cors import CORS
19 | | from flask_jwt_extended import JWTManager
20 | | from flask_migrate import Migrate
21 | | from flask_sqlalchemy import SQLAlchemy
22 | | from flask_wtf.csrf import CSRFProtect
23 | |
24 | | from app.api import register_api_blueprints
25 | | from app.core.constants import HttpHeaders, HttpStatus
26 | | from app.infra.flask_typing import WhaleFallFlask, WhaleFallLoginManager
27 | | from app.infra.error_mapping import map_exception_to_status
28 | | from app.scheduler import init_scheduler
29 | | from app.services.cache_service import init_cache_service
30 | | from app.settings import Settings
31 | | from app.utils.cache_utils import init_cache_manager
32 | | from app.utils.proxy_fix_middleware import TrustedProxyFix
33 | | from app.utils.rate_limiter import init_rate_limiter
34 | | from app.utils.response_utils import unified_error_response
35 | | from app.utils.structlog_config import (
36 | |     ErrorContext,
37 | |     configure_structlog,
38 | |     enhanced_error_handler,
39 | |     get_system_logger,
40 | | )
41 | | from app.utils.time_utils import time_utils
   | |___________________________________________^
42 |
43 |   if TYPE_CHECKING:
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/__init__.py:84:5
   |
83 |       # 注入跨模块共享的“基础设施配置”(避免散落读取 os.environ)
84 | /     from app.utils.password_crypto_utils import init_password_manager  # noqa: PLC0415
85 | |     from app.services.connection_adapters.adapters.oracle_adapter import (  # noqa: PLC0415
86 | |         init_oracle_client_settings,
87 | |     )
   | |_____^
88 |
89 |       init_password_manager(key=resolved_settings.password_encryption_key)
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/api/v1/namespaces/accounts.py:3:1
   |
 1 |   """Accounts namespace (Phase 2 核心域迁移 - Ledgers)."""
 2 |
 3 | / from __future__ import annotations
 4 | |
 5 | | from typing import ClassVar
 6 | |
 7 | | from flask import Response
 8 | | from flask_restx import Namespace, fields, marshal
 9 | |
10 | | from app.api.v1.models.envelope import get_error_envelope_model, make_success_envelope_model
11 | | from app.api.v1.resources.base import BaseResource
12 | | from app.api.v1.resources.decorators import api_login_required, api_permission_required
13 | | from app.api.v1.resources.query_parsers import bool_with_default, new_parser
14 | | from app.api.v1.restx_models.accounts import (
15 | |     ACCOUNT_CLASSIFICATION_RULE_STAT_ITEM_FIELDS,
16 | |     ACCOUNT_LEDGER_ITEM_FIELDS,
17 | |     ACCOUNT_LEDGER_PERMISSIONS_RESPONSE_FIELDS,
18 | |     ACCOUNT_STATISTICS_FIELDS,
19 | | )
20 | | from app.api.v1.restx_models.instances import (
21 | |     INSTANCE_ACCOUNT_CHANGE_HISTORY_ACCOUNT_FIELDS,
22 | |     INSTANCE_ACCOUNT_CHANGE_HISTORY_RESPONSE_FIELDS,
23 | |     INSTANCE_ACCOUNT_CHANGE_LOG_FIELDS,
24 | | )
25 | | from app.core.exceptions import ValidationError
26 | | from app.services.accounts.account_classifications_read_service import AccountClassificationsReadService
27 | | from app.services.accounts.accounts_statistics_read_service import AccountsStatisticsReadService
28 | | from app.services.files.account_export_service import AccountExportService
29 | | from app.services.ledgers.accounts_ledger_change_history_service import AccountsLedgerChangeHistoryService
30 | | from app.services.ledgers.accounts_ledger_list_service import AccountsLedgerListService
31 | | from app.services.ledgers.accounts_ledger_permissions_service import AccountsLedgerPermissionsService
32 | | from app.core.types.accounts_ledgers import AccountFilters
   | |__________________________________________________________^
33 |
34 |   ns = Namespace("accounts", description="账户管理")
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/api/v1/namespaces/auth.py:3:1
   |
 1 |   """Auth namespace (Phase 3 全量覆盖 - 认证模块)."""
 2 |
 3 | / from __future__ import annotations
 4 | |
 5 | | from typing import Any
 6 | |
 7 | | from flask import request
 8 | | from flask_jwt_extended import create_access_token, get_jwt_identity, jwt_required
 9 | | from flask_login import current_user, logout_user
10 | | from flask_restx import Namespace, fields
11 | | from flask_wtf.csrf import generate_csrf
12 | |
13 | | from app.api.v1.models.envelope import get_error_envelope_model, make_success_envelope_model
14 | | from app.api.v1.resources.base import BaseResource
15 | | from app.api.v1.resources.decorators import api_login_required
16 | | from app.core.constants import TimeConstants
17 | | from app.core.constants.system_constants import SuccessMessages
18 | | from app.services.auth import AuthMeReadService, ChangePasswordService, LoginService
19 | | from app.utils.decorators import require_csrf
20 | | from app.utils.request_payload import parse_payload
21 | | from app.utils.rate_limiter import login_rate_limit, password_reset_rate_limit
   | |______________________________________________________________________________^
22 |
23 |   ns = Namespace("auth", description="认证")
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/api/v1/namespaces/capacity.py:3:1
   |
 1 |   """Capacity namespace (Phase 2 核心域迁移)."""
 2 |
 3 | / from __future__ import annotations
 4 | |
 5 | | from datetime import date, timedelta
 6 | | from typing import ClassVar
 7 | |
 8 | | from flask import request
 9 | | from flask_restx import Namespace, fields, marshal
10 | |
11 | | from app.api.v1.models.envelope import get_error_envelope_model, make_success_envelope_model
12 | | from app.api.v1.resources.base import BaseResource
13 | | from app.api.v1.resources.decorators import api_login_required, api_permission_required
14 | | from app.api.v1.resources.query_parsers import bool_with_default, new_parser
15 | | from app.api.v1.restx_models.capacity import (
16 | |     CAPACITY_CURRENT_AGGREGATION_RESULT_FIELDS,
17 | |     CAPACITY_DATABASE_AGGREGATION_ITEM_FIELDS,
18 | |     CAPACITY_DATABASE_SUMMARY_FIELDS,
19 | |     CAPACITY_INSTANCE_AGGREGATION_ITEM_FIELDS,
20 | |     CAPACITY_INSTANCE_REF_FIELDS,
21 | |     CAPACITY_INSTANCE_SUMMARY_FIELDS,
22 | | )
23 | | from app.core.exceptions import ValidationError
24 | | from app.services.capacity.current_aggregation_service import CurrentAggregationService
25 | | from app.services.capacity.database_aggregations_read_service import DatabaseAggregationsReadService
26 | | from app.services.capacity.instance_aggregations_read_service import InstanceAggregationsReadService
27 | | from app.core.types.capacity_aggregations import CurrentAggregationRequest
28 | | from app.core.types.capacity_databases import DatabaseAggregationsFilters, DatabaseAggregationsSummaryFilters
29 | | from app.core.types.capacity_instances import InstanceAggregationsFilters, InstanceAggregationsSummaryFilters
30 | | from app.utils.decorators import require_csrf
31 | | from app.utils.time_utils import time_utils
   | |___________________________________________^
32 |
33 |   ns = Namespace("capacity", description="容量统计")
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/api/v1/namespaces/credentials.py:3:1
   |
 1 |   """Credentials namespace (Phase 2 核心域迁移)."""
 2 |
 3 | / from __future__ import annotations
 4 | |
 5 | | from typing import Any, ClassVar, cast
 6 | |
 7 | | from flask import request
 8 | | from flask_login import current_user
 9 | | from flask_restx import Namespace, fields, marshal
10 | |
11 | | from app.api.v1.models.envelope import get_error_envelope_model, make_success_envelope_model
12 | | from app.api.v1.resources.base import BaseResource
13 | | from app.api.v1.resources.decorators import api_login_required, api_permission_required
14 | | from app.api.v1.resources.query_parsers import new_parser
15 | | from app.api.v1.restx_models.credentials import CREDENTIAL_LIST_ITEM_FIELDS
16 | | from app.core.constants import HttpStatus
17 | | from app.core.constants.system_constants import SuccessMessages
18 | | from app.core.exceptions import NotFoundError
19 | | from app.services.credentials import CredentialDetailReadService, CredentialsListService, CredentialWriteService
20 | | from app.core.types.credentials import CredentialListFilters
21 | | from app.utils.decorators import require_csrf
22 | | from app.utils.request_payload import parse_payload
   | |___________________________________________________^
23 |
24 |   ns = Namespace("credentials", description="凭据管理")
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/api/v1/namespaces/databases.py:3:1
   |
 1 |   """Databases namespace (Phase 2 核心域迁移 - Ledgers)."""
 2 |
 3 | / from __future__ import annotations
 4 | |
 5 | | from datetime import date
 6 | | from typing import ClassVar, cast
 7 | |
 8 | | from flask import Response, request
 9 | | from flask_restx import Namespace, fields, marshal
10 | |
11 | | import app.services.database_sync as database_sync_module
12 | | from app.api.v1.models.envelope import get_error_envelope_model, make_success_envelope_model
13 | | from app.api.v1.resources.base import BaseResource
14 | | from app.api.v1.resources.decorators import api_login_required, api_permission_required
15 | | from app.api.v1.resources.query_parsers import bool_with_default, new_parser, split_comma_separated
16 | | from app.api.v1.restx_models.databases import (
17 | |     DATABASE_OPTION_ITEM_FIELDS,
18 | |     DATABASES_OPTIONS_RESPONSE_FIELDS,
19 | | )
20 | | from app.api.v1.restx_models.instances import (
21 | |     INSTANCE_DATABASE_SIZE_ENTRY_FIELDS,
22 | |     INSTANCE_DATABASE_TABLE_SIZE_ENTRY_FIELDS,
23 | | )
24 | | from app.core.constants import HttpStatus
25 | | from app.core.exceptions import NotFoundError, ValidationError
26 | | from app.services.common.filter_options_service import FilterOptionsService
27 | | from app.services.files.database_ledger_export_service import DatabaseLedgerExportService
28 | | from app.services.instances.instance_database_detail_read_service import (
29 | |     InstanceDatabaseDetailReadService,
30 | | )
31 | | from app.services.instances.instance_database_sizes_service import InstanceDatabaseSizesService
32 | | from app.services.instances.instance_database_table_sizes_service import (
33 | |     InstanceDatabaseTableSizesService,
34 | | )
35 | | from app.services.instances.instance_detail_read_service import InstanceDetailReadService
36 | | from app.services.ledgers.database_ledger_service import DatabaseLedgerService
37 | | from app.core.types.common_filter_options import CommonDatabasesOptionsFilters
38 | | from app.core.types.instance_database_sizes import InstanceDatabaseSizesQuery
39 | | from app.core.types.instance_database_table_sizes import InstanceDatabaseTableSizesQuery
40 | | from app.utils.decorators import require_csrf
41 | | from app.core.constants.validation_limits import DATABASE_TABLE_SIZES_LIMIT_MAX
42 | | from app.utils.time_utils import time_utils
   | |___________________________________________^
43 |
44 |   ns = Namespace("databases", description="数据库管理")
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/api/v1/namespaces/instances.py:3:1
   |
 1 |   """Instances namespace (Phase 2 核心域迁移)."""
 2 |
 3 | / from __future__ import annotations
 4 | |
 5 | | import csv
 6 | | import io
 7 | | from collections.abc import Mapping
 8 | | from typing import Any, ClassVar, cast
 9 | |
10 | | from flask import Response, request
11 | | from flask_login import current_user
12 | | from flask_restx import Namespace, fields, marshal
13 | |
14 | | from app.api.v1.models.envelope import get_error_envelope_model, make_success_envelope_model
15 | | from app.api.v1.resources.base import BaseResource
16 | | from app.api.v1.resources.decorators import api_login_required, api_permission_required
17 | | from app.api.v1.resources.query_parsers import bool_with_default, new_parser
18 | | from app.api.v1.restx_models.instances import (
19 | |     INSTANCE_ACCOUNT_CHANGE_HISTORY_ACCOUNT_FIELDS,
20 | |     INSTANCE_ACCOUNT_CHANGE_LOG_FIELDS,
21 | |     INSTANCE_ACCOUNT_INFO_FIELDS,
22 | |     INSTANCE_ACCOUNT_LIST_ITEM_FIELDS,
23 | |     INSTANCE_ACCOUNT_PERMISSIONS_FIELDS,
24 | |     INSTANCE_ACCOUNT_SUMMARY_FIELDS,
25 | |     INSTANCE_DATABASE_SIZE_ENTRY_FIELDS,
26 | |     INSTANCE_DATABASE_TABLE_SIZE_ENTRY_FIELDS,
27 | |     INSTANCE_LIST_ITEM_FIELDS,
28 | |     INSTANCE_OPTION_ITEM_FIELDS,
29 | |     INSTANCE_STATISTICS_FIELDS,
30 | |     INSTANCE_TAG_FIELDS,
31 | |     INSTANCES_OPTIONS_RESPONSE_FIELDS,
32 | | )
33 | | from app.core.constants import HttpHeaders, HttpStatus
34 | | from app.core.constants.import_templates import (
35 | |     INSTANCE_IMPORT_REQUIRED_FIELDS,
36 | |     INSTANCE_IMPORT_TEMPLATE_HEADERS,
37 | | )
38 | | from app.core.exceptions import ValidationError
39 | | from app.services.capacity.instance_capacity_sync_actions_service import InstanceCapacitySyncActionsService
40 | | from app.services.common.filter_options_service import FilterOptionsService
41 | | from app.services.files.instances_export_service import InstancesExportService
42 | | from app.services.files.instances_import_template_service import InstancesImportTemplateService
43 | | from app.services.instances.batch_service import InstanceBatchCreationService, InstanceBatchDeletionService
44 | | from app.services.instances.instance_detail_read_service import InstanceDetailReadService
45 | | from app.services.instances.instance_list_service import InstanceListService
46 | | from app.services.instances.instance_statistics_read_service import InstanceStatisticsReadService
47 | | from app.services.instances.instance_write_service import InstanceWriteService
48 | | from app.core.types.instances import InstanceListFilters
49 | | from app.utils.decorators import require_csrf
50 | | from app.utils.request_payload import parse_payload
   | |___________________________________________________^
51 |
52 |   ns = Namespace("instances", description="实例管理")
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/api/v1/namespaces/instances_connections.py:6:1
   |
 4 |   """
 5 |
 6 | / from __future__ import annotations
 7 | |
 8 | | from typing import ClassVar, cast
 9 | | from uuid import uuid4
10 | |
11 | | from flask import Response, request
12 | | from flask_restx import fields
13 | | from sqlalchemy.exc import SQLAlchemyError
14 | |
15 | | from app.api.v1.models.envelope import get_error_envelope_model, make_success_envelope_model
16 | | from app.api.v1.namespaces.instances import ns
17 | | from app.api.v1.resources.base import BaseResource
18 | | from app.api.v1.resources.decorators import api_login_required, api_permission_required
19 | | from app.core.constants.system_constants import ErrorMessages
20 | | from app.core.exceptions import NotFoundError, ValidationError
21 | | from app.services.connection_adapters.connection_test_service import ConnectionTestService
22 | | from app.services.connections.instance_connections_write_service import InstanceConnectionsWriteService
23 | | from app.services.connections.instance_connection_status_service import InstanceConnectionStatusService
24 | | from app.services.credentials import CredentialDetailReadService
25 | | from app.services.instances.instance_detail_read_service import InstanceDetailReadService
26 | | from app.core.types import JsonDict, JsonValue
27 | | from app.utils.decorators import require_csrf
28 | | from app.utils.response_utils import jsonify_unified_error_message
29 | | from app.infra.route_safety import log_with_context
   | |___________________________________________________^
30 |
31 |   ErrorEnvelope = get_error_envelope_model(ns)
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/api/v1/namespaces/logs.py:3:1
   |
 1 |   """Logs namespace (Phase 4A 日志中心)."""
 2 |
 3 | / from __future__ import annotations
 4 | |
 5 | | from collections.abc import Mapping
 6 | | from datetime import datetime
 7 | | from typing import ClassVar, cast
 8 | |
 9 | | from flask_restx import Namespace, fields, marshal
10 | |
11 | | from app.api.v1.models.envelope import get_error_envelope_model, make_success_envelope_model
12 | | from app.api.v1.resources.base import BaseResource
13 | | from app.api.v1.resources.decorators import api_login_required, api_permission_required
14 | | from app.api.v1.resources.query_parsers import new_parser
15 | | from app.api.v1.restx_models.history import (
16 | |     HISTORY_LOG_ITEM_FIELDS,
17 | |     HISTORY_LOG_MODULES_FIELDS,
18 | |     HISTORY_LOG_STATISTICS_FIELDS,
19 | |     HISTORY_LOG_TOP_MODULE_FIELDS,
20 | | )
21 | | from app.core.constants.system_constants import LogLevel
22 | | from app.core.exceptions import ValidationError
23 | | from app.services.history_logs.history_logs_extras_service import HistoryLogsExtrasService
24 | | from app.services.history_logs.history_logs_list_service import HistoryLogsListService
25 | | from app.core.types.history_logs import LogSearchFilters
26 | | from app.utils.structlog_config import log_info
   | |_______________________________________________^
27 |
28 |   ns = Namespace("history_logs", description="日志中心")
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/api/v1/namespaces/sessions.py:3:1
   |
 1 |   """Sessions namespace (Phase 4C 同步会话)."""
 2 |
 3 | / from __future__ import annotations
 4 | |
 5 | | from typing import ClassVar
 6 | |
 7 | | from flask_login import current_user
 8 | | from flask_restx import Namespace, fields, marshal
 9 | |
10 | | from app.api.v1.models.envelope import get_error_envelope_model, make_success_envelope_model
11 | | from app.api.v1.resources.base import BaseResource
12 | | from app.api.v1.resources.decorators import api_login_required, api_permission_required
13 | | from app.api.v1.resources.query_parsers import new_parser
14 | | from app.api.v1.restx_models.history import (
15 | |     SYNC_SESSION_DETAIL_RESPONSE_FIELDS,
16 | |     SYNC_SESSION_ERROR_LOGS_RESPONSE_FIELDS,
17 | |     SYNC_SESSION_ITEM_FIELDS,
18 | | )
19 | | from app.core.exceptions import NotFoundError
20 | | from app.services.history_sessions.history_sessions_read_service import HistorySessionsReadService
21 | | from app.services.sync_session_service import sync_session_service
22 | | from app.core.types.history_sessions import HistorySessionsListFilters
23 | | from app.utils.decorators import require_csrf
24 | | from app.utils.structlog_config import log_info
   | |_______________________________________________^
25 |
26 |   ns = Namespace("history_sessions", description="同步会话")
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/api/v1/namespaces/tags.py:3:1
   |
 1 |   """Tags namespace (Phase 2 核心域迁移)."""
 2 |
 3 | / from __future__ import annotations
 4 | |
 5 | | from dataclasses import asdict
 6 | | from typing import ClassVar, cast
 7 | |
 8 | | from flask import request
 9 | | from flask_login import current_user
10 | | from flask_restx import Namespace, fields, marshal
11 | |
12 | | from app.api.v1.models.envelope import get_error_envelope_model, make_success_envelope_model
13 | | from app.api.v1.resources.base import BaseResource
14 | | from app.api.v1.resources.decorators import api_login_required, api_permission_required
15 | | from app.api.v1.resources.query_parsers import new_parser
16 | | from app.api.v1.restx_models.tags import TAG_LIST_ITEM_FIELDS, TAG_OPTION_FIELDS, TAGGABLE_INSTANCE_FIELDS
17 | | from app.core.constants import HttpStatus
18 | | from app.core.constants.system_constants import ErrorMessages
19 | | from app.core.exceptions import ConflictError, NotFoundError, ValidationError
20 | | from app.services.tags.tag_list_service import TagListService
21 | | from app.services.tags.tag_options_service import TagOptionsService
22 | | from app.services.tags.tag_detail_read_service import TagDetailReadService
23 | | from app.services.tags.tag_write_service import TagWriteService
24 | | from app.services.tags.tags_bulk_actions_service import TagsBulkActionsService
25 | | from app.core.types import ResourcePayload
26 | | from app.core.types.tags import TagListFilters
27 | | from app.utils.decorators import require_csrf
28 | | from app.utils.request_payload import parse_payload
   | |___________________________________________________^
29 |
30 |   ns = Namespace("tags", description="标签管理")
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/api/v1/namespaces/users.py:3:1
   |
 1 |   """Users namespace."""
 2 |
 3 | / from __future__ import annotations
 4 | |
 5 | | from collections.abc import Mapping
 6 | | from typing import ClassVar, cast
 7 | |
 8 | | from flask import request
 9 | | from flask_login import current_user
10 | | from flask_restx import Namespace, fields, marshal
11 | |
12 | | from app.api.v1.models.envelope import get_error_envelope_model, make_success_envelope_model
13 | | from app.api.v1.resources.base import BaseResource
14 | | from app.api.v1.resources.decorators import api_login_required, api_permission_required
15 | | from app.api.v1.resources.query_parsers import new_parser
16 | | from app.core.exceptions import NotFoundError
17 | | from app.services.users import UserDetailReadService, UsersListService, UsersStatsService, UserWriteService
18 | | from app.core.types import ResourcePayload
19 | | from app.core.types.users import UserListFilters
20 | | from app.utils.decorators import require_csrf
21 | | from app.utils.request_payload import parse_payload
22 | | from app.utils.sensitive_data import scrub_sensitive_fields
23 | | from app.utils.structlog_config import log_info
   | |_______________________________________________^
24 |
25 |   ns = Namespace("users", description="用户管理")
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/api/v1/resources/base.py:3:1
   |
 1 |   """Base Resource helpers."""
 2 |
 3 | / from __future__ import annotations
 4 | |
 5 | | from collections.abc import Callable, Mapping
 6 | | from typing import TYPE_CHECKING, Any, TypeVar, Unpack, cast
 7 | |
 8 | | from flask import Response
 9 | | from flask_restx import Resource
10 | |
11 | | from app.core.constants import HttpStatus
12 | | from app.core.constants.system_constants import ErrorCategory, ErrorSeverity
13 | | from app.utils.response_utils import jsonify_unified_error_message, unified_success_response
14 | | from app.infra.route_safety import safe_route_call
   | |__________________________________________________^
15 |
16 |   if TYPE_CHECKING:
   |
help: Organize imports

D413 [*] Missing blank line after last section ("Args")
  --> app/core/exceptions.py:31:5
   |
29 |     """统一的基础业务异常.
30 |
31 |     Args:
   |     ^^^^
32 |         message: 自定义错误文案,若为空则根据 ``message_key`` 推导.
33 |         message_key: 自定义消息键.
   |
help: Add blank line after "Args"

D413 [*] Missing blank line after last section ("Args")
  --> app/core/exceptions.py:56:9
   |
54 |         """初始化基础业务异常.
55 |
56 |         Args:
   |         ^^^^
57 |             message: 直接使用的错误提示,缺省时会根据 message_key 推导.
58 |             message_key: 覆盖默认 message_key 的可选值.
   |
help: Add blank line after "Args"

D202 [*] No blank lines allowed after function docstring (found 1)
  --> app/core/exceptions.py:72:9
   |
70 |     @property
71 |     def recoverable(self) -> bool:
72 |         """表示该异常是否可恢复."""
   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^
73 |
74 |         return self.severity in (ErrorSeverity.LOW, ErrorSeverity.MEDIUM)
   |
help: Remove blank line(s) after function docstring

D202 [*] No blank lines allowed after function docstring (found 1)
  --> app/infra/error_mapping.py:36:5
   |
35 | def map_exception_to_status(error: Exception, default: int = HttpStatus.INTERNAL_SERVER_ERROR) -> int:
36 |     """根据异常类型推导 HTTP 状态码."""
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
37 |
38 |     for exc_type, status in _EXCEPTION_STATUS_MAP:
   |
help: Remove blank line(s) after function docstring

I001 [*] Import block is un-sorted or un-formatted
  --> app/models/account_classification.py:15:5
   |
14 |   if TYPE_CHECKING:
15 | /     from app.models.account_permission import AccountPermission
16 | |     from app.core.types.orm_kwargs import (
17 | |         AccountClassificationAssignmentOrmFields,
18 | |         AccountClassificationOrmFields,
19 | |         ClassificationRuleOrmFields,
20 | |     )
   | |_____^
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/repositories/capacity_databases_repository.py:8:1
   |
 6 |   """
 7 |
 8 | / from __future__ import annotations
 9 | |
10 | | from typing import Any, cast
11 | |
12 | | from sqlalchemy import and_, desc, func, tuple_
13 | | from sqlalchemy.orm import Query, Session
14 | |
15 | | from app import db
16 | | from app.models.database_size_aggregation import DatabaseSizeAggregation
17 | | from app.models.instance import Instance
18 | | from app.models.instance_database import InstanceDatabase
19 | | from app.core.types.capacity_databases import DatabaseAggregationsFilters, DatabaseAggregationsSummaryFilters
   | |_____________________________________________________________________________________________________________^
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/repositories/capacity_instances_repository.py:8:1
   |
 6 |   """
 7 |
 8 | / from __future__ import annotations
 9 | |
10 | | from typing import Any, cast
11 | |
12 | | from sqlalchemy import desc, func
13 | | from sqlalchemy.orm import Query, Session
14 | |
15 | | from app import db
16 | | from app.models.instance import Instance
17 | | from app.models.instance_size_aggregation import InstanceSizeAggregation
18 | | from app.models.instance_size_stat import InstanceSizeStat
19 | | from app.core.types.capacity_instances import InstanceAggregationsFilters, InstanceAggregationsSummaryFilters
   | |_____________________________________________________________________________________________________________^
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/repositories/credentials_repository.py:9:1
   |
 7 |   """
 8 |
 9 | / from __future__ import annotations
10 | |
11 | | from typing import Any, cast
12 | |
13 | | from sqlalchemy import or_
14 | | from sqlalchemy.orm import Query
15 | | from sqlalchemy.sql.elements import ColumnElement
16 | |
17 | | from app import db
18 | | from app.models.credential import Credential
19 | | from app.models.instance import Instance
20 | | from app.models.tag import Tag
21 | | from app.core.types.credentials import CredentialListFilters, CredentialListRowProjection
22 | | from app.core.types.listing import PaginatedResult
   | |__________________________________________________^
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/repositories/history_logs_repository.py:8:1
   |
 6 |   """
 7 |
 8 | / from __future__ import annotations
 9 | |
10 | | from datetime import datetime, timedelta
11 | | from typing import Any, cast
12 | |
13 | | from sqlalchemy import Text, asc, cast as sa_cast, desc, distinct, func, or_
14 | | from sqlalchemy.orm import Query
15 | |
16 | | from app import db
17 | | from app.core.constants.system_constants import LogLevel
18 | | from app.models.unified_log import UnifiedLog
19 | | from app.core.types.history_logs import LogSearchFilters
20 | | from app.core.types.listing import PaginatedResult
21 | | from app.utils.time_utils import time_utils
   | |___________________________________________^
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/repositories/history_sessions_repository.py:8:1
   |
 6 |   """
 7 |
 8 | / from __future__ import annotations
 9 | |
10 | | from typing import Any, cast
11 | |
12 | | from sqlalchemy.sql.elements import ColumnElement
13 | |
14 | | from app.core.exceptions import NotFoundError
15 | | from app.models.sync_instance_record import SyncInstanceRecord
16 | | from app.models.sync_session import SyncSession
17 | | from app.core.types.history_sessions import HistorySessionsListFilters
18 | | from app.core.types.listing import PaginatedResult
   | |__________________________________________________^
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/repositories/instance_accounts_repository.py:8:1
   |
 6 |   """
 7 |
 8 | / from __future__ import annotations
 9 | |
10 | | from typing import Any, cast
11 | |
12 | | from sqlalchemy import asc, desc, func
13 | | from sqlalchemy.orm import contains_eager, load_only
14 | |
15 | | from app import db
16 | | from app.models.account_change_log import AccountChangeLog
17 | | from app.models.account_permission import AccountPermission
18 | | from app.models.instance import Instance
19 | | from app.models.instance_account import InstanceAccount
20 | | from app.core.types.instance_accounts import InstanceAccountListFilters, InstanceAccountSummary
21 | | from app.core.types.listing import PaginatedResult
   | |__________________________________________________^
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/repositories/instance_database_sizes_repository.py:8:1
   |
 6 |   """
 7 |
 8 | / from __future__ import annotations
 9 | |
10 | | from datetime import date, datetime
11 | | from types import SimpleNamespace
12 | | from typing import Any, cast
13 | |
14 | | from sqlalchemy import func, or_
15 | | from sqlalchemy.sql.elements import ColumnElement
16 | |
17 | | from app import db
18 | | from app.models.database_size_stat import DatabaseSizeStat
19 | | from app.models.instance_database import InstanceDatabase
20 | | from app.core.types.instance_database_sizes import (
21 | |     InstanceDatabaseSizeEntry,
22 | |     InstanceDatabaseSizesHistoryResult,
23 | |     InstanceDatabaseSizesLatestResult,
24 | |     InstanceDatabaseSizesQuery,
25 | | )
   | |_^
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/repositories/instance_database_table_sizes_repository.py:8:1
   |
 6 |   """
 7 |
 8 | / from __future__ import annotations
 9 | |
10 | | from datetime import datetime
11 | | from typing import cast
12 | |
13 | | from sqlalchemy import func
14 | |
15 | | from app.models.database_table_size_stat import DatabaseTableSizeStat
16 | | from app.core.types.instance_database_table_sizes import (
17 | |     InstanceDatabaseTableSizeEntry,
18 | |     InstanceDatabaseTableSizesQuery,
19 | |     InstanceDatabaseTableSizesResult,
20 | | )
   | |_^
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/repositories/instances_repository.py:9:1
   |
 7 |   """
 8 |
 9 | / from __future__ import annotations
10 | |
11 | | from collections import defaultdict
12 | | from datetime import datetime
13 | | from typing import Any, cast
14 | |
15 | | from sqlalchemy import func, or_
16 | | from sqlalchemy.orm import Query
17 | | from sqlalchemy.sql.elements import ColumnElement
18 | | from sqlalchemy.sql.selectable import Subquery
19 | |
20 | | from app import db
21 | | from app.core.constants import SyncStatus
22 | | from app.models.instance import Instance
23 | | from app.models.instance_account import InstanceAccount
24 | | from app.models.instance_database import InstanceDatabase
25 | | from app.models.sync_instance_record import SyncInstanceRecord
26 | | from app.models.tag import Tag, instance_tags
27 | | from app.core.types.instances import InstanceListFilters, InstanceListMetrics
28 | | from app.core.types.listing import PaginatedResult
29 | | from app.core.types.tags import TagSummary
   | |__________________________________________^
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/repositories/ledgers/accounts_ledger_repository.py:8:1
   |
 6 |   """
 7 |
 8 | / from __future__ import annotations
 9 | |
10 | | from collections import defaultdict
11 | | from typing import Any, cast
12 | |
13 | | from sqlalchemy import or_
14 | | from sqlalchemy.exc import SQLAlchemyError
15 | | from sqlalchemy.orm import Query, contains_eager
16 | |
17 | | from app.models.account_change_log import AccountChangeLog
18 | | from app.models.account_classification import AccountClassification, AccountClassificationAssignment
19 | | from app.models.account_permission import AccountPermission
20 | | from app.models.instance import Instance
21 | | from app.models.instance_account import InstanceAccount
22 | | from app.models.tag import Tag, instance_tags
23 | | from app.core.types.accounts_ledgers import AccountClassificationSummary, AccountFilters, AccountLedgerMetrics
24 | | from app.core.types.listing import PaginatedResult
25 | | from app.core.types.tags import TagSummary
26 | | from app.utils.theme_color_utils import get_theme_color_value
27 | | from app.utils.structlog_config import log_warning
   | |__________________________________________________^
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/repositories/ledgers/database_ledger_repository.py:8:1
   |
 6 |   """
 7 |
 8 | / from __future__ import annotations
 9 | |
10 | | from collections import defaultdict
11 | | from datetime import datetime
12 | | from math import ceil
13 | | from typing import Any, cast
14 | |
15 | | from sqlalchemy import and_, func, or_
16 | | from sqlalchemy.orm import Query, Session
17 | | from sqlalchemy.orm.scoping import scoped_session
18 | |
19 | | from app import db
20 | | from app.models.database_size_stat import DatabaseSizeStat
21 | | from app.models.instance import Instance
22 | | from app.models.instance_database import InstanceDatabase
23 | | from app.models.tag import Tag, instance_tags
24 | | from app.core.types.ledgers import DatabaseLedgerFilters, DatabaseLedgerRowProjection
25 | | from app.core.types.listing import PaginatedResult
26 | | from app.core.types.tags import TagSummary
   | |__________________________________________^
27 |
28 |   SessionLike = Session | scoped_session[Any]
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/repositories/partition_repository.py:8:1
   |
 6 |   """
 7 |
 8 | / from __future__ import annotations
 9 | |
10 | | from datetime import date
11 | |
12 | | from sqlalchemy import func
13 | |
14 | | from app.models.database_size_aggregation import DatabaseSizeAggregation
15 | | from app.models.database_size_stat import DatabaseSizeStat
16 | | from app.models.instance_size_aggregation import InstanceSizeAggregation
17 | | from app.models.instance_size_stat import InstanceSizeStat
18 | | from app.core.types.partition import PeriodWindow
   | |_________________________________________________^
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/repositories/tags_repository.py:9:1
   |
 7 |   """
 8 |
 9 | / from __future__ import annotations
10 | |
11 | | from collections.abc import Sequence
12 | | from typing import TYPE_CHECKING, Any, cast
13 | |
14 | | from sqlalchemy.sql.elements import ColumnElement
15 | |
16 | | from app import db
17 | | from app.models.tag import Tag, instance_tags
18 | | from app.core.types.listing import PaginatedResult
19 | | from app.core.types.tags import TagListFilters, TagListRowProjection, TagStats
   | |______________________________________________________________________________^
20 |
21 |   if TYPE_CHECKING:
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/repositories/users_repository.py:9:1
   |
 7 |   """
 8 |
 9 | / from __future__ import annotations
10 | |
11 | | from typing import Any, cast
12 | |
13 | | from sqlalchemy.orm import Query
14 | | from sqlalchemy.sql.elements import ColumnElement
15 | |
16 | | from app import db
17 | | from app.core.constants import UserRole
18 | | from app.models.user import User
19 | | from app.core.types.listing import PaginatedResult
20 | | from app.core.types.users import UserListFilters
   | |________________________________________________^
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/routes/accounts/ledgers.py:3:1
   |
 1 |   """Accounts 域:账户台账(Ledgers)视图与 API."""
 2 |
 3 | / from __future__ import annotations
 4 | |
 5 | | from flask import Blueprint, render_template, request
 6 | | from flask_login import login_required
 7 | |
 8 | | from app.core.constants import DATABASE_TYPES
 9 | | from app.services.common.filter_options_service import FilterOptionsService
10 | | from app.core.types.accounts_ledgers import AccountFilters
11 | | from app.utils.decorators import view_required
12 | | from app.utils.pagination_utils import resolve_page, resolve_page_size
13 | | from app.infra.route_safety import safe_route_call
   | |__________________________________________________^
14 |
15 |   # 创建蓝图
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/routes/accounts/statistics.py:3:1
   |
 1 |   """Accounts 域:统计视图与 API."""
 2 |
 3 | / from typing import Any
 4 | |
 5 | | from flask import Blueprint, flash, render_template
 6 | | from flask_login import login_required
 7 | |
 8 | | from app.core.constants import FlashCategory
 9 | | from app.core.exceptions import SystemError
10 | | from app.services.statistics.accounts_statistics_page_service import AccountsStatisticsPageService
11 | | from app.utils.decorators import view_required
12 | | from app.infra.route_safety import safe_route_call
   | |__________________________________________________^
13 |
14 |   accounts_statistics_bp = Blueprint("accounts_statistics", __name__)
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/routes/auth.py:3:1
   |
 1 |   """鲸落 - 用户认证路由."""
 2 |
 3 | / from collections.abc import Callable
 4 | | from typing import cast
 5 | |
 6 | | from flask import Blueprint, flash, redirect, render_template, request, url_for
 7 | | from flask.typing import ResponseReturnValue
 8 | | from flask_login import current_user, login_required, login_user, logout_user
 9 | |
10 | | from app.core.constants import FlashCategory, HttpHeaders, HttpMethod
11 | | from app.services.auth.login_service import LoginService
12 | | from app.infra.flask_typing import RouteCallable, RouteReturn
13 | | from app.infra.route_safety import safe_route_call
14 | | from app.utils.decorators import require_csrf
15 | | from app.utils.rate_limiter import login_rate_limit, password_reset_rate_limit
16 | | from app.utils.redirect_safety import resolve_safe_redirect_target
17 | | from app.utils.structlog_config import get_auth_logger
18 | | from app.views.password_forms import ChangePasswordFormView
   | |___________________________________________________________^
19 |
20 |   # 创建蓝图
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/routes/capacity/databases.py:3:1
   |
 1 |   """数据库容量统计页面路由."""
 2 |
 3 | / from __future__ import annotations
 4 | |
 5 | | from flask import Blueprint, render_template, request
 6 | | from flask_login import login_required
 7 | |
 8 | | from app.core.constants import PERIOD_TYPES
 9 | | from app.services.capacity.capacity_databases_page_service import CapacityDatabasesPageService
10 | | from app.utils.decorators import view_required
11 | | from app.infra.route_safety import safe_route_call
   | |__________________________________________________^
12 |
13 |   # 创建蓝图
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/routes/capacity/instances.py:3:1
   |
 1 |   """实例容量统计页面路由."""
 2 |
 3 | / from __future__ import annotations
 4 | |
 5 | | from flask import Blueprint, render_template, request
 6 | | from flask_login import login_required
 7 | |
 8 | | from app.core.constants import DATABASE_TYPES, PERIOD_TYPES
 9 | | from app.services.common.filter_options_service import FilterOptionsService
10 | | from app.utils.decorators import view_required
11 | | from app.infra.route_safety import safe_route_call
   | |__________________________________________________^
12 |
13 |   # 创建蓝图
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/routes/credentials.py:3:1
   |
 1 |   """鲸落 - 凭据管理路由."""
 2 |
 3 | / from __future__ import annotations
 4 | |
 5 | | from typing import TYPE_CHECKING, Any
 6 | |
 7 | | from flask import Blueprint, Response, render_template, request
 8 | | from flask_login import login_required
 9 | |
10 | | from app.core.constants import (
11 | |     CREDENTIAL_TYPES,
12 | |     DATABASE_TYPES,
13 | |     STATUS_ACTIVE_OPTIONS,
14 | | )
15 | | from app.services.common.filter_options_service import FilterOptionsService
16 | | from app.services.credentials.credential_detail_page_service import CredentialDetailPageService
17 | | from app.core.types.credentials import CredentialListFilters
18 | | from app.utils.decorators import (
19 | |     view_required,
20 | | )
21 | | from app.utils.pagination_utils import resolve_page, resolve_page_size
22 | | from app.infra.route_safety import safe_route_call
   | |__________________________________________________^
23 |
24 |   if TYPE_CHECKING:
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/routes/dashboard.py:3:1
   |
 1 |   """鲸落 - 系统仪表板路由."""
 2 |
 3 | / from flask import Blueprint, render_template, request
 4 | | from flask_login import login_required
 5 | |
 6 | | from app.core.constants.system_constants import SuccessMessages
 7 | | from app.services.dashboard.dashboard_charts_service import get_chart_data
 8 | | from app.services.dashboard.dashboard_overview_service import get_system_overview, get_system_status
 9 | | from app.infra.flask_typing import RouteReturn
10 | | from app.utils.response_utils import jsonify_unified_success
11 | | from app.infra.route_safety import safe_route_call
   | |__________________________________________________^
12 |
13 |   # 创建蓝图
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/routes/databases/ledgers.py:6:1
   |
 4 |   """
 5 |
 6 | / from __future__ import annotations
 7 | |
 8 | | from typing import Any
 9 | |
10 | | from flask import Blueprint, render_template, request, url_for
11 | | from flask_login import login_required
12 | |
13 | | from app.core.constants import DATABASE_TYPES
14 | | from app.services.common.filter_options_service import FilterOptionsService
15 | | from app.utils.decorators import view_required
16 | | from app.infra.route_safety import safe_route_call
   | |__________________________________________________^
17 |
18 |   databases_ledgers_bp = Blueprint("databases_ledgers", __name__)
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/routes/history/logs.py:6:1
   |
 4 |   """
 5 |
 6 | / from __future__ import annotations
 7 | |
 8 | | from flask import Blueprint, render_template
 9 | |
10 | | from app.core.constants import LOG_LEVELS, TIME_RANGES
11 | | from app.services.history_logs.history_logs_extras_service import HistoryLogsExtrasService
12 | | from app.utils.decorators import admin_required
13 | | from app.infra.route_safety import safe_route_call
   | |__________________________________________________^
14 |
15 |   # 创建蓝图
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/routes/history/sessions.py:3:1
   |
 1 |   """鲸落 - 会话中心路由."""
 2 |
 3 | / from __future__ import annotations
 4 | |
 5 | | from flask import Blueprint, render_template
 6 | | from flask_login import login_required
 7 | |
 8 | | from app.core.constants import STATUS_SYNC_OPTIONS, SYNC_CATEGORIES, SYNC_TYPES
 9 | | from app.utils.decorators import view_required
10 | | from app.infra.route_safety import safe_route_call
   | |__________________________________________________^
11 |
12 |   history_sessions_bp = Blueprint("history_sessions", __name__)
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/routes/instances/detail.py:6:1
   |
 4 |   """
 5 |
 6 | / from __future__ import annotations
 7 | |
 8 | | from flask import Blueprint, render_template
 9 | | from flask_login import login_required
10 | |
11 | | from app.services.instances.instance_detail_page_service import InstanceDetailPageService
12 | | from app.infra.flask_typing import RouteReturn
13 | | from app.utils.decorators import view_required
14 | | from app.infra.route_safety import safe_route_call
   | |__________________________________________________^
15 |
16 |   instances_detail_bp = Blueprint("instances_detail", __name__, url_prefix="/instances")
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/routes/instances/manage.py:3:1
   |
 1 |   """鲸落 - 数据库实例管理路由."""
 2 |
 3 | / from __future__ import annotations
 4 | |
 5 | | from collections.abc import Callable
 6 | | from typing import cast
 7 | |
 8 | | from flask import Blueprint, render_template, request
 9 | | from flask.typing import ResponseReturnValue, RouteCallable
10 | | from flask_login import login_required
11 | |
12 | | from app.services.instances.instance_list_page_service import InstanceListPageService
13 | | from app.utils.decorators import create_required, require_csrf, update_required, view_required
14 | | from app.infra.route_safety import safe_route_call
15 | | from app.views.instance_forms import InstanceFormView
   | |_____________________________________________________^
16 |
17 |   # 创建蓝图
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/routes/instances/statistics.py:3:1
   |
 1 |   """实例容量与统计相关接口."""
 2 |
 3 | / from flask import flash, render_template
 4 | | from flask_login import login_required
 5 | |
 6 | | from app.core.constants import FlashCategory
 7 | | from app.core.exceptions import SystemError
 8 | | from app.routes.instances.manage import instances_bp
 9 | | from app.services.instances.instance_statistics_read_service import InstanceStatisticsReadService
10 | | from app.infra.flask_typing import RouteReturn
11 | | from app.core.types.instance_statistics import InstanceStatisticsResult
12 | | from app.utils.decorators import view_required
13 | | from app.infra.route_safety import safe_route_call
   | |__________________________________________________^
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/routes/partition.py:3:1
   |
 1 |   """分区管理路由."""
 2 |
 3 | / from __future__ import annotations
 4 | |
 5 | | from flask import Blueprint, render_template
 6 | | from flask_login import login_required
 7 | |
 8 | | from app.utils.decorators import view_required
 9 | | from app.infra.route_safety import safe_route_call
   | |__________________________________________________^
10 |
11 |   # 创建蓝图
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/routes/scheduler.py:3:1
   |
 1 |   """定时任务管理路由."""
 2 |
 3 | / from __future__ import annotations
 4 | |
 5 | | from flask import Blueprint, render_template
 6 | | from flask_login import login_required
 7 | |
 8 | | from app.utils.decorators import scheduler_view_required
 9 | | from app.infra.route_safety import safe_route_call
   | |__________________________________________________^
10 |
11 |   # 创建蓝图
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/routes/tags/manage.py:3:1
   |
 1 |   """鲸落 - 标签管理路由."""
 2 |
 3 | / from __future__ import annotations
 4 | |
 5 | | from flask import Blueprint, render_template, request
 6 | | from flask_login import login_required
 7 | |
 8 | | from app.core.constants import STATUS_ACTIVE_OPTIONS
 9 | | from app.core.exceptions import SystemError
10 | | from app.services.common.filter_options_service import FilterOptionsService
11 | | from app.services.tags.tag_stats_service import TagStatsService
12 | | from app.utils.decorators import view_required
13 | | from app.infra.route_safety import safe_route_call
   | |__________________________________________________^
14 |
15 |   # 创建蓝图
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/routes/users.py:3:1
   |
 1 |   """鲸落 - 用户管理路由."""
 2 |
 3 | / from __future__ import annotations
 4 | |
 5 | | from collections.abc import Callable
 6 | | from typing import cast
 7 | |
 8 | | from flask import Blueprint, flash, render_template, request
 9 | | from flask.typing import ResponseReturnValue, RouteCallable
10 | | from flask_login import login_required
11 | |
12 | | from app.core.constants import STATUS_ACTIVE_OPTIONS, FlashCategory, UserRole
13 | | from app.core.exceptions import SystemError
14 | | from app.utils.decorators import create_required, require_csrf, update_required, view_required
15 | | from app.infra.route_safety import safe_route_call
16 | | from app.utils.user_role_utils import get_user_role_display_name
17 | | from app.views.user_forms import UserFormView
   | |_____________________________________________^
18 |
19 |   # 创建蓝图
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/scheduler.py:6:1
   |
 4 |   """
 5 |
 6 | / from __future__ import annotations
 7 | |
 8 | | import atexit
 9 | | import fcntl  # type: ignore[attr-defined]
10 | | import os
11 | | import time
12 | | from collections.abc import Callable
13 | | from importlib import import_module
14 | | from pathlib import Path
15 | | from typing import IO, TYPE_CHECKING, Any
16 | |
17 | | import yaml
18 | | from apscheduler.events import EVENT_JOB_ERROR, EVENT_JOB_EXECUTED, JobExecutionEvent
19 | | from apscheduler.executors.pool import ThreadPoolExecutor
20 | | from apscheduler.jobstores.base import JobLookupError
21 | | from apscheduler.jobstores.sqlalchemy import SQLAlchemyJobStore
22 | | from apscheduler.schedulers.background import BackgroundScheduler
23 | | from apscheduler.triggers.base import BaseTrigger
24 | | from apscheduler.triggers.cron import CronTrigger
25 | | from sqlalchemy.exc import SQLAlchemyError
26 | | from yaml import YAMLError
27 | | from pydantic import ValidationError as PydanticValidationError
28 | |
29 | | from app.utils.structlog_config import get_system_logger
30 | | from app.schemas.yaml_configs import SchedulerTaskConfig, SchedulerTasksConfigFile
   | |__________________________________________________________________________________^
31 |
32 |   if TYPE_CHECKING:
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/scheduler.py:33:5
   |
32 |   if TYPE_CHECKING:
33 | /     from apscheduler.job import Job
34 | |     from flask import Flask
35 | |     from app.settings import Settings
   | |_____________________________________^
36 |
37 |   logger = get_system_logger()
   |
help: Organize imports

D417 Missing argument description in the docstring for `init_scheduler`: `settings`
   --> app/scheduler.py:432:5
    |
432 | def init_scheduler(app: Flask, settings: Settings) -> TaskScheduler | None:
    |     ^^^^^^^^^^^^^^
433 |     """初始化调度器(仅在允许的进程中启动).
    |

I001 [*] Import block is un-sorted or un-formatted
  --> app/schemas/credentials.py:3:1
   |
 1 |   """凭据写路径 schema."""
 2 |
 3 | / from __future__ import annotations
 4 | |
 5 | | import re
 6 | | from collections.abc import Mapping
 7 | | from typing import Any
 8 | |
 9 | | from pydantic import StrictStr, field_validator, model_validator
10 | |
11 | | from app.core.constants import DatabaseType
12 | | from app.core.constants.validation_limits import (
13 | |     CREDENTIAL_PASSWORD_MAX_LENGTH,
14 | |     CREDENTIAL_PASSWORD_MIN_LENGTH,
15 | |     CREDENTIAL_USERNAME_MAX_LENGTH,
16 | |     CREDENTIAL_USERNAME_MIN_LENGTH,
17 | | )
18 | | from app.schemas.base import PayloadSchema
19 | | from app.utils.payload_converters import as_bool
20 | | from app.utils.database_type_utils import normalize_database_type
   | |_________________________________________________________________^
21 |
22 |   _ALLOWED_CREDENTIAL_TYPES: set[str] = {"database", "ssh", "windows", "api", "ldap"}
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/schemas/instances.py:3:1
   |
 1 |   """实例写路径 schema."""
 2 |
 3 | / from __future__ import annotations
 4 | |
 5 | | import re
 6 | | from collections.abc import Mapping
 7 | | from typing import Any, Literal
 8 | |
 9 | | from pydantic import Field, StrictStr, field_validator, model_validator
10 | |
11 | | from app.core.constants import DatabaseType
12 | | from app.core.constants.validation_limits import (
13 | |     DATABASE_NAME_MAX_LENGTH,
14 | |     DESCRIPTION_MAX_LENGTH,
15 | |     HOST_MAX_LENGTH,
16 | |     INSTANCE_NAME_MAX_LENGTH,
17 | |     IPV4_OCTET_MAX,
18 | |     PORT_MAX,
19 | |     PORT_MIN,
20 | | )
21 | | from app.schemas.base import PayloadSchema
22 | | from app.utils.payload_converters import as_bool
23 | | from app.utils.database_type_utils import normalize_database_type
   | |_________________________________________________________________^
   |
help: Organize imports

D202 [*] No blank lines allowed after function docstring (found 1)
  --> app/schemas/internal_contracts/permission_snapshot_v4.py:35:5
   |
34 |   def normalize_permission_snapshot_categories_v4(db_type: str, categories: Mapping[str, object]) -> JsonDict:
35 | /     """Normalize v4 snapshot categories into canonical shapes (single entry).
36 | |
37 | |     当前收敛范围（与审计报告 P0 对齐）：
38 | |     - PostgreSQL: `predefined_roles` 允许 list[str] 或 list[{"role": str}]
39 | |     - SQL Server: `server_roles`/`database_roles` 允许 list[str] 或 list[{"name": str}]（以及 dict 映射到这些 list）
40 | |     - Oracle: `oracle_roles` 允许 list[str] 或 list[{"role": str}]
41 | |     """
   | |_______^
42 |
43 |       normalized: JsonDict = dict(categories)
   |
help: Remove blank line(s) after function docstring

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/account_classification/auto_classify_service.py:15:1
   |
13 |       from app.core.types.classification import ClassificationEngineResult
14 |
15 | / from app.services.account_classification.orchestrator import AccountClassificationService
16 | | from app.core.exceptions import AppError
17 | | from app.utils.structlog_config import log_error, log_info
   | |__________________________________________________________^
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/account_classification/orchestrator.py:3:1
   |
 1 |   """账户分类编排器."""
 2 |
 3 | / from __future__ import annotations
 4 | |
 5 | | import time
 6 | | from typing import TYPE_CHECKING, Any
 7 | |
 8 | | from sqlalchemy.exc import SQLAlchemyError
 9 | |
10 | | from app.core.exceptions import ConflictError, ValidationError
11 | | from app.services.account_classification.dsl_v4 import (
12 | |     DslV4Evaluator,
13 | |     collect_dsl_v4_validation_errors,
14 | |     is_dsl_v4_expression,
15 | | )
16 | | from app.repositories.account_classification_repository import ClassificationRepository
17 | | from app.utils.structlog_config import log_error, log_info
18 | |
19 | | from .cache import ClassificationCache
   | |______________________________________^
20 |
21 |   if TYPE_CHECKING:
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/accounts/account_classifications_read_service.py:8:1
   |
 6 |   """
 7 |
 8 | / from __future__ import annotations
 9 | |
10 | | from app.core.exceptions import NotFoundError, SystemError
11 | | from app.models.account_classification import AccountClassification, ClassificationRule
12 | | from app.repositories.accounts_classifications_repository import AccountsClassificationsRepository
13 | | from app.core.types.accounts_classifications import (
14 | |     AccountClassificationAssignmentItem,
15 | |     AccountClassificationListItem,
16 | |     AccountClassificationRuleFilterItem,
17 | |     AccountClassificationRuleListItem,
18 | |     AccountClassificationRuleStatItem,
19 | | )
20 | | from app.utils.structlog_config import log_error
   | |________________________________________________^
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/accounts/account_classifications_write_service.py:9:1
   |
 7 |   """
 8 |
 9 | / from __future__ import annotations
10 | |
11 | | from dataclasses import dataclass
12 | | from typing import TYPE_CHECKING
13 | |
14 | | from sqlalchemy.exc import SQLAlchemyError
15 | |
16 | | from app import db
17 | | from app.core.exceptions import DatabaseError, NotFoundError, ValidationError
18 | | from app.models.account_classification import (
19 | |     AccountClassification,
20 | |     AccountClassificationAssignment,
21 | |     ClassificationRule,
22 | | )
23 | | from app.repositories.accounts_classifications_repository import AccountsClassificationsRepository
24 | | from app.services.account_classification.orchestrator import CACHE_INVALIDATION_EXCEPTIONS, AccountClassificationService
25 | | from app.schemas.account_classifications import (
26 | |     AccountClassificationCreatePayload,
27 | |     AccountClassificationRuleCreatePayload,
28 | |     AccountClassificationRuleUpdatePayload,
29 | |     AccountClassificationUpdatePayload,
30 | | )
31 | | from app.schemas.validation import validate_or_raise
32 | | from app.utils.request_payload import parse_payload
33 | | from app.utils.structlog_config import log_info
   | |_______________________________________________^
34 |
35 |   if TYPE_CHECKING:
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/accounts/accounts_statistics_read_service.py:8:1
   |
 6 |   """
 7 |
 8 | / from __future__ import annotations
 9 | |
10 | | from typing import Any
11 | |
12 | | from app.repositories.account_statistics_repository import AccountStatisticsRepository
13 | | from app.core.types.accounts_statistics import AccountStatisticsResult
   | |______________________________________________________________________^
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/accounts_sync/accounts_sync_actions_service.py:8:1
   |
 6 |   """
 7 |
 8 | / from __future__ import annotations
 9 | |
10 | | import importlib
11 | | import threading
12 | | from collections.abc import Callable, Mapping
13 | | from dataclasses import dataclass
14 | | from typing import Any, Protocol, cast
15 | |
16 | | from sqlalchemy.exc import SQLAlchemyError
17 | |
18 | | from app.core.constants.sync_constants import SyncOperationType
19 | | from app.core.exceptions import NotFoundError, SystemError, ValidationError
20 | | from app.models.instance import Instance
21 | | from app.repositories.instances_repository import InstancesRepository
22 | | from app.services.sync_session_service import sync_session_service
23 | | from app.infra.route_safety import log_with_context
   | |___________________________________________________^
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/accounts_sync/accounts_sync_filters.py:6:1
   |
 4 |   """
 5 |
 6 | / from __future__ import annotations
 7 | |
 8 | | import re
 9 | | from collections.abc import Mapping, Sequence
10 | | from pathlib import Path
11 | | from typing import TYPE_CHECKING, Any, TypeAlias, cast
12 | |
13 | | import yaml
14 | | from pydantic import ValidationError as PydanticValidationError
15 | |
16 | | from app.utils.safe_query_builder import build_safe_filter_conditions
17 | | from app.utils.structlog_config import get_system_logger
18 | | from app.schemas.yaml_configs import AccountFiltersConfigFile
   | |_____________________________________________________________^
19 |
20 |   if TYPE_CHECKING:
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/accounts_sync/accounts_sync_service.py:20:5
   |
19 |   if TYPE_CHECKING:
20 | /     from app.models import Instance
21 | |     from app.core.types import (
22 | |         CollectionSummary,
23 | |         InventorySummary,
24 | |         StructlogEventDict,
25 | |         SyncOperationResult,
26 | |         SyncStagesSummary,
27 | |     )
   | |_____^
28 |   else:
29 |       CollectionSummary = dict[str, Any]
   |
help: Organize imports

D107 Missing docstring in `__init__`
  --> app/services/accounts_sync/accounts_sync_task_service.py:17:9
   |
15 |     """账户同步任务所需的数据读取服务."""
16 |
17 |     def __init__(self, repository: FilterOptionsRepository | None = None) -> None:
   |         ^^^^^^^^
18 |         self._repository = repository or FilterOptionsRepository()
   |

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/accounts_sync/adapters/base_adapter.py:10:5
   |
 9 |   if TYPE_CHECKING:
10 | /     from app.models.instance import Instance
11 | |     from app.core.types import RawAccount, RemoteAccount
   | |________________________________________________________^
12 |   else:
13 |       Instance = Any
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/accounts_sync/adapters/mysql_adapter.py:16:5
   |
15 |   if TYPE_CHECKING:
16 | /     from app.models.instance import Instance
17 | |     from app.core.types import JsonDict, JsonValue, PermissionSnapshot, RawAccount, RemoteAccount
   | |_________________________________________________________________________________________________^
18 |   else:
19 |       Instance = Any
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/accounts_sync/adapters/oracle_adapter.py:14:5
   |
13 |   if TYPE_CHECKING:
14 | /     from collections.abc import Sequence
15 | |
16 | |     from app.models.instance import Instance
17 | |     from app.core.types import JsonDict, PermissionSnapshot, RawAccount, RemoteAccount
   | |______________________________________________________________________________________^
18 |   else:
19 |       Instance = Any
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/accounts_sync/adapters/postgresql_adapter.py:15:5
   |
14 |   if TYPE_CHECKING:
15 | /     from collections.abc import Sequence
16 | |
17 | |     from app.models.instance import Instance
18 | |     from app.core.types import JsonDict, JsonValue, PermissionSnapshot, RawAccount, RemoteAccount
19 | |     from app.core.types.sync import SyncConnection
   | |__________________________________________________^
20 |   else:
21 |       Instance = Any
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/accounts_sync/adapters/sqlserver_adapter.py:19:5
   |
18 |   if TYPE_CHECKING:
19 | /     from re import Pattern
20 | |
21 | |     from app.models.instance import Instance
22 | |     from app.core.types import JsonDict, JsonValue, PermissionSnapshot, RawAccount, RemoteAccount
23 | |     from app.core.types.sync import SyncConnection
   | |__________________________________________________^
24 |   else:
25 |       Instance = Any
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/accounts_sync/coordinator.py:16:5
   |
15 |   if TYPE_CHECKING:
16 | /     from types import TracebackType
17 | |
18 | |     from app.models.instance import Instance
19 | |     from app.models.instance_account import InstanceAccount
20 | |     from app.core.types import (
21 | |         CollectionSummary,
22 | |         InventorySummary,
23 | |         RemoteAccount,
24 | |         RemoteAccountMap,
25 | |         SyncConnection,
26 | |         SyncStagesSummary,
27 | |     )
   | |_____^
28 |   else:
29 |       Instance = Any
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/accounts_sync/inventory_manager.py:16:5
   |
15 |   if TYPE_CHECKING:
16 | /     from collections.abc import Iterable
17 | |
18 | |     from app.models.instance import Instance
19 | |     from app.core.types import RemoteAccount
   | |____________________________________________^
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/accounts_sync/permission_manager.py:23:5
   |
22 |   if TYPE_CHECKING:
23 | /     from collections.abc import Iterable, Sequence
24 | |
25 | |     from app.models.instance import Instance
26 | |     from app.models.instance_account import InstanceAccount
27 | |     from app.core.types import (
28 | |         JsonDict,
29 | |         JsonValue,
30 | |         OtherDiffEntry,
31 | |         PermissionDiffPayload,
32 | |         PrivilegeDiffEntry,
33 | |         RemoteAccount,
34 | |         RemoteAccountMap,
35 | |         SyncSummary,
36 | |     )
   | |_____^
37 |   else:
38 |       Instance = Any
   |
help: Organize imports

D107 Missing docstring in `__init__`
  --> app/services/aggregation/aggregation_tasks_read_service.py:31:9
   |
29 |     """统计聚合任务读取服务."""
30 |
31 |     def __init__(
   |         ^^^^^^^^
32 |         self,
33 |         instances_repository: FilterOptionsRepository | None = None,
   |

D102 Missing docstring in public method
  --> app/services/aggregation/capacity_aggregation_task_runner.py:50:9
   |
49 |     @staticmethod
50 |     def list_active_instances() -> list[Instance]:
   |         ^^^^^^^^^^^^^^^^^^^^^
51 |         return AggregationTasksReadService().list_active_instances()
   |

D102 Missing docstring in public method
  --> app/services/aggregation/capacity_aggregation_task_runner.py:54:9
   |
53 |     @staticmethod
54 |     def select_periods(
   |         ^^^^^^^^^^^^^^
55 |         requested: Sequence[str] | None,
56 |         logger: structlog.BoundLogger,
   |

D102 Missing docstring in public method
  --> app/services/aggregation/capacity_aggregation_task_runner.py:91:9
   |
90 |     @staticmethod
91 |     def has_aggregation_for_period(period_type: str, period_start: date) -> bool:
   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^
92 |         return AggregationTasksReadService().has_aggregation_for_period(period_type=period_type, period_start=period_start)
   |

D102 Missing docstring in public method
  --> app/services/aggregation/capacity_aggregation_task_runner.py:94:9
   |
92 |         return AggregationTasksReadService().has_aggregation_for_period(period_type=period_type, period_start=period_start)
93 |
94 |     def filter_periods_already_aggregated(
   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
95 |         self,
96 |         *,
   |

D102 Missing docstring in public method
   --> app/services/aggregation/capacity_aggregation_task_runner.py:121:9
    |
120 |     @staticmethod
121 |     def build_skip_response(message: str) -> dict[str, Any]:
    |         ^^^^^^^^^^^^^^^^^^^
122 |         return {
123 |             "status": STATUS_SKIPPED,
    |

D102 Missing docstring in public method
   --> app/services/aggregation/capacity_aggregation_task_runner.py:133:9
    |
132 |     @staticmethod
133 |     def start_instance_sync(record_id: int) -> None:
    |         ^^^^^^^^^^^^^^^^^^^
134 |         sync_session_service.start_instance_sync(record_id)
    |

D102 Missing docstring in public method
   --> app/services/aggregation/capacity_aggregation_task_runner.py:137:9
    |
136 |     @staticmethod
137 |     def complete_instance_sync(
    |         ^^^^^^^^^^^^^^^^^^^^^^
138 |         record_id: int,
139 |         *,
    |

D102 Missing docstring in public method
   --> app/services/aggregation/capacity_aggregation_task_runner.py:160:9
    |
159 |     @staticmethod
160 |     def fail_instance_sync(record_id: int, error_message: str) -> None:
    |         ^^^^^^^^^^^^^^^^^^
161 |         sync_session_service.fail_instance_sync(record_id, error_message=error_message)
    |

D102 Missing docstring in public method
   --> app/services/aggregation/capacity_aggregation_task_runner.py:164:9
    |
163 |     @staticmethod
164 |     def init_aggregation_session(
    |         ^^^^^^^^^^^^^^^^^^^^^^^^
165 |         *,
166 |         manual_run: bool,
    |

D102 Missing docstring in public method
   --> app/services/aggregation/capacity_aggregation_task_runner.py:281:9
    |
279 |         return filtered_period_results, instance_errors, aggregated_count
280 |
281 |     def calculate_instance_aggregation(
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
282 |         self,
283 |         *,
    |

D102 Missing docstring in public method
   --> app/services/aggregation/capacity_aggregation_task_runner.py:336:9
    |
334 |         return details, success, aggregated_count
335 |
336 |     def summarize_database_periods(
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^
337 |         self,
338 |         *,
    |

D417 Missing argument description in the docstring for `__init__`: `repository`
  --> app/services/aggregation/database_aggregation_runner.py:65:9
   |
63 |     """
64 |
65 |     def __init__(
   |         ^^^^^^^^
66 |         self,
67 |         *,
   |

D417 Missing argument description in the docstring for `__init__`: `repository`
  --> app/services/aggregation/instance_aggregation_runner.py:68:9
   |
66 |     """
67 |
68 |     def __init__(
   |         ^^^^^^^^
69 |         self,
70 |         *,
   |

D107 Missing docstring in `__init__`
  --> app/services/aggregation/query_service.py:20:9
   |
18 |     """
19 |
20 |     def __init__(self, repository: AggregationRepository | None = None) -> None:
   |         ^^^^^^^^
21 |         self._repository = repository or AggregationRepository()
   |

D107 Missing docstring in `__init__`
  --> app/services/auth/auth_me_read_service.py:18:9
   |
16 |     """读取当前用户信息服务."""
17 |
18 |     def __init__(self, repository: UsersRepository | None = None) -> None:
   |         ^^^^^^^^
19 |         self._repository = repository or UsersRepository()
   |

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/cache/cache_actions_service.py:12:1
   |
10 |   """
11 |
12 | / from __future__ import annotations
13 | |
14 | | from dataclasses import dataclass
15 | | from typing import Protocol, cast
16 | |
17 | | import app.services.cache_service as cache_service_module
18 | | from app.core.exceptions import ConflictError, NotFoundError, SystemError, ValidationError
19 | | from app.repositories.instances_repository import InstancesRepository
20 | | from app.services.account_classification.orchestrator import AccountClassificationService
21 | | from app.infra.route_safety import log_with_context
22 | | from app.utils.structlog_config import log_info
   | |_______________________________________________^
23 |
24 |   _CLASSIFICATION_DB_TYPES: list[str] = ["mysql", "postgresql", "sqlserver", "oracle"]
   |
help: Organize imports

D107 Missing docstring in `__init__`
  --> app/services/capacity/capacity_collection_status_service.py:28:9
   |
26 |     """容量采集状态读取服务."""
27 |
28 |     def __init__(self, repository: CapacityCollectionStatusRepository | None = None) -> None:
   |         ^^^^^^^^
29 |         self._repository = repository or CapacityCollectionStatusRepository()
   |

D102 Missing docstring in public method
  --> app/services/capacity/capacity_collection_task_runner.py:95:9
   |
94 |     @staticmethod
95 |     def no_active_instances_result() -> dict[str, object]:
   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^
96 |         return {
97 |             "success": True,
   |

D102 Missing docstring in public method
   --> app/services/capacity/capacity_collection_task_runner.py:104:9
    |
103 |     @staticmethod
104 |     def start_instance_sync(record_id: int) -> None:
    |         ^^^^^^^^^^^^^^^^^^^
105 |         sync_session_service.start_instance_sync(record_id)
    |

D102 Missing docstring in public method
   --> app/services/capacity/capacity_collection_task_runner.py:108:9
    |
107 |     @staticmethod
108 |     def fail_instance_sync(record_id: int, error_message: str) -> None:
    |         ^^^^^^^^^^^^^^^^^^
109 |         sync_session_service.fail_instance_sync(record_id, error_message)
    |

D102 Missing docstring in public method
   --> app/services/capacity/capacity_collection_task_runner.py:112:9
    |
111 |     @staticmethod
112 |     def create_capacity_session(active_instances: list[Instance]) -> tuple[SyncSession, list[SyncInstanceRecord]]:
    |         ^^^^^^^^^^^^^^^^^^^^^^^
113 |         session = sync_session_service.create_session(
114 |             sync_type=SyncOperationType.SCHEDULED_TASK.value,
    |

D102 Missing docstring in public method
   --> app/services/capacity/capacity_collection_task_runner.py:245:9
    |
243 |         }, True
244 |
245 |     def process_capacity_instance(
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^
246 |         self,
247 |         *,
    |

D102 Missing docstring in public method
   --> app/services/capacity/capacity_collection_task_runner.py:440:9
    |
438 |             )
439 |
440 |     def collect_instance_database_sizes(
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
441 |         self,
442 |         *,
    |

D107 Missing docstring in `__init__`
  --> app/services/capacity/capacity_tasks_read_service.py:17:9
   |
15 |     """容量任务读取服务."""
16 |
17 |     def __init__(self, repository: FilterOptionsRepository | None = None) -> None:
   |         ^^^^^^^^
18 |         self._repository = repository or FilterOptionsRepository()
   |

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/capacity/current_aggregation_service.py:8:1
   |
 6 |   """
 7 |
 8 | / from __future__ import annotations
 9 | |
10 | | from dataclasses import dataclass
11 | | from typing import TYPE_CHECKING, Any
12 | |
13 | | from flask_login import current_user
14 | |
15 | | from app import db
16 | | from app.core.constants import SyncStatus
17 | | from app.core.constants.sync_constants import SyncCategory, SyncOperationType
18 | | from app.core.exceptions import SystemError as AppSystemError, ValidationError
19 | | from app.models.instance import Instance
20 | | from app.repositories.instances_repository import InstancesRepository
21 | | from app.services.aggregation.aggregation_service import AggregationService
22 | | from app.services.aggregation.results import AggregationStatus
23 | | from app.services.sync_session_service import SyncItemStats, sync_session_service
24 | | from app.core.types.capacity_aggregations import CurrentAggregationRequest
25 | | from app.utils.structlog_config import log_info
26 | | from app.utils.time_utils import time_utils
   | |___________________________________________^
27 |
28 |   if TYPE_CHECKING:
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/capacity/database_aggregations_read_service.py:8:1
   |
 6 |   """
 7 |
 8 | / from __future__ import annotations
 9 | |
10 | | from datetime import date, datetime
11 | | from decimal import Decimal
12 | | from typing import cast
13 | |
14 | | from app.repositories.capacity_databases_repository import CapacityDatabasesRepository
15 | | from app.core.types.capacity_common import CapacityInstanceRef
16 | | from app.core.types.capacity_databases import (
17 | |     DatabaseAggregationsFilters,
18 | |     DatabaseAggregationsItem,
19 | |     DatabaseAggregationsListResult,
20 | |     DatabaseAggregationsSummary,
21 | |     DatabaseAggregationsSummaryFilters,
22 | | )
   | |_^
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/capacity/instance_aggregations_read_service.py:8:1
   |
 6 |   """
 7 |
 8 | / from __future__ import annotations
 9 | |
10 | | from datetime import date, datetime
11 | | from decimal import Decimal
12 | | from typing import cast
13 | |
14 | | from app.repositories.capacity_instances_repository import CapacityInstancesRepository
15 | | from app.core.types.capacity_common import CapacityInstanceRef
16 | | from app.core.types.capacity_instances import (
17 | |     InstanceAggregationsFilters,
18 | |     InstanceAggregationsItem,
19 | |     InstanceAggregationsListResult,
20 | |     InstanceAggregationsSummary,
21 | |     InstanceAggregationsSummaryFilters,
22 | | )
   | |_^
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/common/filter_options_service.py:8:1
   |
 6 |   """
 7 |
 8 | / from __future__ import annotations
 9 | |
10 | | from typing import cast
11 | |
12 | | from app.core.constants import DatabaseType
13 | | from app.core.constants.tag_categories import TAG_CATEGORY_CHOICES
14 | | from app.repositories.filter_options_repository import FilterOptionsRepository
15 | | from app.core.types.common_filter_options import (
16 | |     CommonDatabaseOptionItem,
17 | |     CommonDatabasesOptionsFilters,
18 | |     CommonDatabasesOptionsResult,
19 | |     CommonDatabaseTypeOptionItem,
20 | |     CommonDatabaseTypesOptionsResult,
21 | |     CommonInstanceOptionItem,
22 | |     CommonInstancesOptionsResult,
23 | | )
24 | | from app.utils.query_filter_utils import (
25 | |     build_category_options,
26 | |     build_classification_options,
27 | |     build_database_select_options,
28 | |     build_instance_select_options,
29 | |     build_tag_options,
30 | | )
31 | | from app.utils.database_type_utils import (
32 | |     get_database_type_color,
33 | |     get_database_type_display_name,
34 | |     get_database_type_icon,
35 | | )
   | |_^
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/connection_adapters/adapters/oracle_adapter.py:3:1
   |
 1 |   """Oracle 数据库连接适配器."""
 2 |
 3 | / from __future__ import annotations
 4 | | from pathlib import Path
 5 | | from typing import TYPE_CHECKING, Any, cast
 6 | |
 7 | | import oracledb  # type: ignore[import-not-found]
 8 | |
 9 | | from app.core.types import DBAPIConnection, DBAPICursor
10 | |
11 | | from .base import ConnectionAdapterError, DatabaseConnection, QueryResult
   | |_________________________________________________________________________^
12 |
13 |   if TYPE_CHECKING:
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/connection_adapters/adapters/sqlserver_adapter.py:37:5
   |
36 |   if TYPE_CHECKING:
37 | /     from app.models.instance import Instance
38 | |     from app.core.types import JsonValue
   | |________________________________________^
39 |   else:
40 |       Instance = Any
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/connections/instance_connection_status_service.py:8:1
   |
 6 |   """
 7 |
 8 | / from __future__ import annotations
 9 | |
10 | | from datetime import datetime, timedelta
11 | |
12 | | from app.core.exceptions import NotFoundError
13 | | from app.repositories.instances_repository import InstancesRepository
14 | | from app.core.types import JsonDict
15 | | from app.utils.time_utils import time_utils
   | |___________________________________________^
   |
help: Organize imports

D107 Missing docstring in `__init__`
  --> app/services/credentials/credential_options_service.py:16:9
   |
14 |     """凭据下拉选项读取服务."""
15 |
16 |     def __init__(self, repository: CredentialsRepository | None = None) -> None:
   |         ^^^^^^^^
17 |         self._repository = repository or CredentialsRepository()
   |

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/credentials/credentials_list_service.py:8:1
   |
 6 |   """
 7 |
 8 | / from __future__ import annotations
 9 | |
10 | | from app.repositories.credentials_repository import CredentialsRepository
11 | | from app.core.types.credentials import CredentialListFilters, CredentialListItem
12 | | from app.core.types.listing import PaginatedResult
13 | | from app.utils.time_utils import time_utils
   | |___________________________________________^
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/dashboard/dashboard_overview_service.py:8:1
   |
 6 |   """
 7 |
 8 | / from __future__ import annotations
 9 | |
10 | | from datetime import timedelta
11 | |
12 | | import psutil
13 | | from sqlalchemy.exc import SQLAlchemyError
14 | |
15 | | from app import db
16 | | from app.repositories.account_statistics_repository import AccountStatisticsRepository
17 | | from app.repositories.capacity_instances_repository import CapacityInstancesRepository
18 | | from app.repositories.database_statistics_repository import DatabaseStatisticsRepository
19 | | from app.repositories.instance_statistics_repository import InstanceStatisticsRepository
20 | | from app.repositories.users_repository import UsersRepository
21 | | from app.services.health.health_checks_service import check_cache_health, check_database_health, get_system_uptime
22 | | from app.core.types.capacity_instances import InstanceAggregationsSummaryFilters
23 | | from app.utils.cache_utils import dashboard_cache
24 | | from app.utils.structlog_config import log_info, log_warning
25 | | from app.utils.time_utils import time_utils
   | |___________________________________________^
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/database_sync/adapters/factory.py:6:1
   |
 4 |   """
 5 |
 6 | / from __future__ import annotations
 7 | |
 8 | | from typing import TYPE_CHECKING
 9 | |
10 | | from app.core.constants import DatabaseType
11 | | from app.utils.database_type_utils import normalize_database_type
12 | | from app.services.database_sync.adapters.mysql_adapter import MySQLCapacityAdapter
13 | | from app.services.database_sync.adapters.oracle_adapter import OracleCapacityAdapter
14 | | from app.services.database_sync.adapters.postgresql_adapter import PostgreSQLCapacityAdapter
15 | | from app.services.database_sync.adapters.sqlserver_adapter import SQLServerCapacityAdapter
   | |__________________________________________________________________________________________^
16 |
17 |   if TYPE_CHECKING:
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/database_sync/database_filters.py:3:1
   |
 1 |   """容量同步使用的数据库级过滤工具."""
 2 |
 3 | / from __future__ import annotations
 4 | |
 5 | | import re
 6 | | from collections.abc import Iterable, Sequence
 7 | | from dataclasses import dataclass
 8 | | from pathlib import Path
 9 | | from typing import TYPE_CHECKING, Any, TypedDict
10 | |
11 | | import yaml
12 | | from pydantic import ValidationError as PydanticValidationError
13 | |
14 | | from app.utils.structlog_config import get_system_logger
15 | | from app.schemas.yaml_configs import DatabaseFiltersConfigFile
   | |______________________________________________________________^
16 |
17 |   if TYPE_CHECKING:
   |
help: Organize imports

D417 Missing argument description in the docstring for `__init__`: `repository`
  --> app/services/database_sync/table_size_coordinator.py:63:9
   |
61 |     """按需采集指定 database 的表容量并落库(仅保存最新快照)."""
62 |
63 |     def __init__(self, instance: Instance, repository: DatabaseTableSizeStatsRepository | None = None) -> None:
   |         ^^^^^^^^
64 |         """初始化协调器并选择适配器.
   |

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/files/account_export_service.py:8:1
   |
 6 |   """
 7 |
 8 | / from __future__ import annotations
 9 | |
10 | | import csv
11 | | import io
12 | | from collections.abc import Sequence
13 | | from dataclasses import dataclass
14 | |
15 | | from app.core.constants import DatabaseType
16 | | from app.repositories.ledgers.accounts_ledger_repository import AccountsLedgerRepository
17 | | from app.core.types.accounts_ledgers import AccountFilters, AccountLedgerMetrics
18 | | from app.utils.spreadsheet_formula_safety import sanitize_csv_row
19 | | from app.utils.time_utils import time_utils
   | |___________________________________________^
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/files/database_ledger_export_service.py:8:1
   |
 6 |   """
 7 |
 8 | / from __future__ import annotations
 9 | |
10 | | import csv
11 | | import io
12 | | from collections.abc import Iterable
13 | | from dataclasses import dataclass
14 | |
15 | | from app.services.ledgers.database_ledger_service import DatabaseLedgerService
16 | | from app.core.types.ledgers import DatabaseLedgerItem
17 | | from app.utils.spreadsheet_formula_safety import sanitize_csv_row
18 | | from app.utils.time_utils import time_utils
   | |___________________________________________^
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/health/health_checks_service.py:8:1
   |
 6 |   """
 7 |
 8 | / from __future__ import annotations
 9 | |
10 | | import time
11 | |
12 | | import psutil
13 | | from sqlalchemy.exc import SQLAlchemyError
14 | |
15 | | from app import app_start_time, cache
16 | | from app.core.constants import TimeConstants
17 | | from app.repositories.health_repository import HealthRepository
18 | | from app.services.cache_service import CACHE_EXCEPTIONS
19 | | from app.settings import APP_VERSION
20 | | from app.infra.route_safety import log_with_context
21 | | from app.utils.time_utils import time_utils
   | |___________________________________________^
22 |
23 |   RESOURCE_USAGE_THRESHOLD = 90
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/history_logs/history_logs_extras_service.py:6:1
   |
 4 |   """
 5 |
 6 | / from __future__ import annotations
 7 | |
 8 | | from datetime import timedelta
 9 | |
10 | | from app.repositories.history_logs_repository import HistoryLogsRepository
11 | | from app.core.types.history_logs import HistoryLogListItem, HistoryLogStatistics, HistoryLogTopModule
12 | | from app.utils.time_utils import time_utils
   | |___________________________________________^
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/history_logs/history_logs_list_service.py:8:1
   |
 6 |   """
 7 |
 8 | / from __future__ import annotations
 9 | |
10 | | from app.repositories.history_logs_repository import HistoryLogsRepository
11 | | from app.core.types.history_logs import HistoryLogListItem, LogSearchFilters
12 | | from app.core.types.listing import PaginatedResult
13 | | from app.utils.time_utils import time_utils
   | |___________________________________________^
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/history_sessions/history_sessions_read_service.py:8:1
   |
 6 |   """
 7 |
 8 | / from __future__ import annotations
 9 | |
10 | | from typing import Any, cast
11 | |
12 | | from app.core.constants import SyncStatus
13 | | from app.repositories.history_sessions_repository import HistorySessionsRepository
14 | | from app.core.types.history_sessions import (
15 | |     HistorySessionsListFilters,
16 | |     SyncInstanceRecordItem,
17 | |     SyncSessionDetailItem,
18 | |     SyncSessionDetailResult,
19 | |     SyncSessionErrorLogsResult,
20 | |     SyncSessionItem,
21 | | )
22 | | from app.core.types.listing import PaginatedResult
   | |__________________________________________________^
   |
help: Organize imports

D107 Missing docstring in `__init__`
  --> app/services/instances/batch_service.py:50:9
   |
48 |     """
49 |
50 |     def __init__(self, repository: InstancesBatchRepository | None = None) -> None:
   |         ^^^^^^^^
51 |         self._repository = repository or InstancesBatchRepository()
   |

D107 Missing docstring in `__init__`
   --> app/services/instances/batch_service.py:214:9
    |
212 |     """
213 |
214 |     def __init__(self, repository: InstancesBatchRepository | None = None) -> None:
    |         ^^^^^^^^
215 |         self._repository = repository or InstancesBatchRepository()
    |

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/instances/instance_accounts_service.py:8:1
   |
 6 |   """
 7 |
 8 | / from __future__ import annotations
 9 | |
10 | | from typing import Any, cast
11 | |
12 | | from app.core.constants import DatabaseType
13 | | from app.repositories.instance_accounts_repository import InstanceAccountsRepository
14 | | from app.services.accounts_permissions.snapshot_view import build_permission_snapshot_view
15 | | from app.core.types.instance_accounts import (
16 | |     InstanceAccountChangeHistoryAccount,
17 | |     InstanceAccountChangeHistoryResult,
18 | |     InstanceAccountChangeLogItem,
19 | |     InstanceAccountInfo,
20 | |     InstanceAccountListFilters,
21 | |     InstanceAccountListItem,
22 | |     InstanceAccountListResult,
23 | |     InstanceAccountPermissions,
24 | |     InstanceAccountPermissionsResult,
25 | | )
26 | | from app.utils.time_utils import time_utils
   | |___________________________________________^
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/instances/instance_database_sizes_service.py:8:1
   |
 6 |   """
 7 |
 8 | / from __future__ import annotations
 9 | |
10 | | from app.repositories.instance_database_sizes_repository import InstanceDatabaseSizesRepository
11 | | from app.core.types.instance_database_sizes import (
12 | |     InstanceDatabaseSizesHistoryResult,
13 | |     InstanceDatabaseSizesLatestResult,
14 | |     InstanceDatabaseSizesQuery,
15 | | )
   | |_^
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/instances/instance_database_table_sizes_service.py:8:1
   |
 6 |   """
 7 |
 8 | / from __future__ import annotations
 9 | |
10 | | from app.repositories.instance_database_table_sizes_repository import (
11 | |     InstanceDatabaseTableSizesRepository,
12 | | )
13 | | from app.core.types.instance_database_table_sizes import (
14 | |     InstanceDatabaseTableSizesQuery,
15 | |     InstanceDatabaseTableSizesResult,
16 | | )
   | |_^
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/instances/instance_detail_page_service.py:8:1
   |
 6 |   """
 7 |
 8 | / from __future__ import annotations
 9 | |
10 | | from dataclasses import dataclass
11 | |
12 | | from app.core.constants import DatabaseType
13 | | from app.utils.database_type_utils import get_database_type_display_name
14 | | from app.models.credential import Credential
15 | | from app.models.instance import Instance
16 | | from app.repositories.credentials_repository import CredentialsRepository
17 | | from app.repositories.instance_accounts_repository import InstanceAccountsRepository
18 | | from app.repositories.instances_repository import InstancesRepository
19 | | from app.core.types.instance_accounts import InstanceAccountSummary
20 | | from app.core.types.tags import TagSummary
   | |__________________________________________^
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/instances/instance_list_page_service.py:8:1
   |
 6 |   """
 7 |
 8 | / from __future__ import annotations
 9 | |
10 | | from dataclasses import dataclass
11 | | from typing import Any
12 | |
13 | | from app.core.constants import STATUS_ACTIVE_OPTIONS, DatabaseType
14 | | from app.utils.database_type_utils import (
15 | |     build_database_type_select_option,
16 | |     get_database_type_color,
17 | |     get_database_type_display_name,
18 | |     get_database_type_icon,
19 | | )
20 | | from app.models.credential import Credential
21 | | from app.repositories.credentials_repository import CredentialsRepository
22 | | from app.services.common.filter_options_service import FilterOptionsService
   | |___________________________________________________________________________^
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/instances/instance_list_service.py:8:1
   |
 6 |   """
 7 |
 8 | / from __future__ import annotations
 9 | |
10 | | from app.repositories.instances_repository import InstancesRepository
11 | | from app.core.types.instances import InstanceListFilters, InstanceListItem
12 | | from app.core.types.listing import PaginatedResult
   | |__________________________________________________^
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/instances/instance_statistics_read_service.py:8:1
   |
 6 |   """
 7 |
 8 | / from __future__ import annotations
 9 | |
10 | | from typing import cast
11 | |
12 | | from app.repositories.instance_statistics_repository import InstanceStatisticsRepository
13 | | from app.core.types.instance_statistics import (
14 | |     InstanceDbTypeStat,
15 | |     InstancePortStat,
16 | |     InstanceStatisticsResult,
17 | |     InstanceVersionStat,
18 | | )
   | |_^
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/ledgers/accounts_ledger_change_history_service.py:9:1
   |
 7 |   """
 8 |
 9 | / from __future__ import annotations
10 | |
11 | | from typing import cast
12 | |
13 | | from app.repositories.ledgers.accounts_ledger_repository import AccountsLedgerRepository
14 | | from app.core.types.instance_accounts import (
15 | |     InstanceAccountChangeHistoryAccount,
16 | |     InstanceAccountChangeHistoryResult,
17 | |     InstanceAccountChangeLogItem,
18 | | )
19 | | from app.utils.time_utils import time_utils
   | |___________________________________________^
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/ledgers/accounts_ledger_list_service.py:8:1
   |
 6 |   """
 7 |
 8 | / from __future__ import annotations
 9 | |
10 | | from app.repositories.ledgers.accounts_ledger_repository import AccountsLedgerRepository
11 | | from app.core.types.accounts_ledgers import AccountFilters, AccountLedgerItem
12 | | from app.core.types.listing import PaginatedResult
   | |__________________________________________________^
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/ledgers/accounts_ledger_permissions_service.py:8:1
   |
 6 |   """
 7 |
 8 | / from __future__ import annotations
 9 | |
10 | | from typing import cast
11 | |
12 | | from app.repositories.ledgers.accounts_ledger_repository import AccountsLedgerRepository
13 | | from app.services.accounts_permissions.snapshot_view import build_permission_snapshot_view
14 | | from app.core.types.accounts_permissions import (
15 | |     AccountLedgerPermissionAccount,
16 | |     AccountLedgerPermissions,
17 | |     AccountLedgerPermissionsResult,
18 | | )
19 | | from app.utils.time_utils import time_utils
   | |___________________________________________^
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/ledgers/database_ledger_service.py:6:1
   |
 4 |   """
 5 |
 6 | / from __future__ import annotations
 7 | |
 8 | | from datetime import datetime
 9 | | from typing import TYPE_CHECKING, Any, cast
10 | |
11 | | from app import db
12 | | from app.core.constants import SyncStatus
13 | | from app.core.exceptions import SystemError
14 | | from app.repositories.ledgers.database_ledger_repository import DatabaseLedgerRepository
15 | | from app.core.types.ledgers import (
16 | |     DatabaseLedgerCapacitySummary,
17 | |     DatabaseLedgerFilters,
18 | |     DatabaseLedgerInstanceSummary,
19 | |     DatabaseLedgerItem,
20 | |     DatabaseLedgerSyncStatusSummary,
21 | | )
22 | | from app.core.types.listing import PaginatedResult
23 | | from app.utils.structlog_config import log_error
24 | | from app.utils.time_utils import time_utils
   | |___________________________________________^
25 |
26 |   RECENT_SYNC_THRESHOLD_HOURS = 6
   |
help: Organize imports

D107 Missing docstring in `__init__`
  --> app/services/logging/log_cleanup_service.py:28:9
   |
26 |     """日志与同步数据清理服务."""
27 |
28 |     def __init__(self, repository: LogCleanupRepository | None = None) -> None:
   |         ^^^^^^^^
29 |         self._repository = repository or LogCleanupRepository()
   |

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/partition/partition_read_service.py:8:1
   |
 6 |   """
 7 |
 8 | / from __future__ import annotations
 9 | |
10 | | from collections import defaultdict
11 | | from collections.abc import Iterable
12 | | from datetime import date, timedelta
13 | | from typing import Any, cast
14 | |
15 | | from app.core.exceptions import SystemError, ValidationError
16 | | from app.repositories.partition_repository import PartitionRepository
17 | | from app.services.statistics.partition_statistics_service import PartitionStatisticsService
18 | | from app.core.types.listing import PaginatedResult
19 | | from app.core.types.partition import (
20 | |     PartitionCoreMetricsResult,
21 | |     PartitionEntry,
22 | |     PartitionInfoSnapshot,
23 | |     PartitionStatusSnapshot,
24 | |     PeriodWindow,
25 | | )
26 | | from app.utils.structlog_config import log_error
27 | | from app.utils.time_utils import time_utils
   | |___________________________________________^
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/scheduler/scheduler_job_write_service.py:8:1
   |
 6 |   """
 7 |
 8 | / from __future__ import annotations
 9 | |
10 | | from dataclasses import dataclass, field
11 | | from typing import TYPE_CHECKING, cast
12 | |
13 | | from apscheduler.triggers.cron import CronTrigger
14 | |
15 | | from app.core.constants.scheduler_jobs import BUILTIN_TASK_IDS
16 | | from app.core.exceptions import NotFoundError, SystemError, ValidationError
17 | | from app.scheduler import get_scheduler
18 | | from app.core.types import PayloadMapping, ResourceIdentifier, SupportsResourceId
19 | | from app.schemas.scheduler_jobs import SchedulerJobUpsertPayload
20 | | from app.schemas.validation import validate_or_raise
21 | | from app.utils.request_payload import parse_payload
22 | | from app.utils.structlog_config import log_error, log_info
   | |__________________________________________________________^
23 |
24 |   if TYPE_CHECKING:
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/scheduler/scheduler_jobs_read_service.py:8:1
   |
 6 |   """
 7 |
 8 | / from __future__ import annotations
 9 | |
10 | | from typing import TYPE_CHECKING, cast
11 | |
12 | | from app.core.constants.scheduler_jobs import BUILTIN_TASK_IDS
13 | | from app.core.constants.sync_constants import SyncCategory
14 | | from app.core.exceptions import NotFoundError, SystemError
15 | | from app.repositories.scheduler_jobs_repository import SchedulerJobsRepository
16 | | from app.core.types.scheduler import SchedulerJobDetail, SchedulerJobListItem
17 | | from app.utils.structlog_config import log_error
   | |________________________________________________^
18 |
19 |   if TYPE_CHECKING:
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/statistics/database_statistics_service.py:6:1
   |
 4 |   """
 5 |
 6 | / from __future__ import annotations
 7 | |
 8 | | from dataclasses import dataclass
 9 | | from datetime import date
10 | | from typing import Any
11 | |
12 | | from app.core.exceptions import SystemError
13 | | from app.repositories.capacity_databases_repository import CapacityDatabasesRepository
14 | | from app.repositories.database_statistics_repository import DatabaseStatisticsRepository
15 | | from app.core.types.capacity_databases import DatabaseAggregationsFilters, DatabaseAggregationsSummaryFilters
16 | | from app.utils.structlog_config import log_error
   | |________________________________________________^
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/tags/tag_list_service.py:8:1
   |
 6 |   """
 7 |
 8 | / from __future__ import annotations
 9 | |
10 | | from app.repositories.tags_repository import TagsRepository
11 | | from app.core.types.listing import PaginatedResult
12 | | from app.core.types.tags import TagListFilters, TagListItem, TagStats
   | |_____________________________________________________________________^
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/tags/tag_options_service.py:6:1
   |
 4 |   """
 5 |
 6 | / from __future__ import annotations
 7 | |
 8 | | from typing import Any, cast
 9 | |
10 | | from app.repositories.tags_options_repository import TagsOptionsRepository
11 | | from app.core.types.tags_options import (
12 | |     TaggableInstance,
13 | |     TagOptionItem,
14 | |     TagOptionsResult,
15 | |     TagsBulkInstancesResult,
16 | |     TagsBulkTagsResult,
17 | | )
   | |_^
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/tags/tag_stats_service.py:8:1
   |
 6 |   """
 7 |
 8 | / from __future__ import annotations
 9 | |
10 | | from app.repositories.tags_repository import TagsRepository
11 | | from app.core.types.tags import TagStats
   | |________________________________________^
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/tags/tag_write_service.py:10:1
   |
 8 |   """
 9 |
10 | / from __future__ import annotations
11 | |
12 | | from dataclasses import dataclass
13 | | from typing import TYPE_CHECKING, Any, Literal, cast
14 | |
15 | | from sqlalchemy.exc import SQLAlchemyError
16 | |
17 | | from app import db
18 | | from app.core.exceptions import NotFoundError, ValidationError
19 | | from app.models.tag import Tag
20 | | from app.repositories.tags_repository import TagsRepository
21 | | from app.schemas.tags import TagBatchDeletePayload, TagUpdatePayload, TagUpsertPayload
22 | | from app.schemas.validation import validate_or_raise
23 | | from app.utils.request_payload import parse_payload
24 | | from app.infra.route_safety import log_with_context
25 | | from app.utils.structlog_config import log_info
   | |_______________________________________________^
26 |
27 |   if TYPE_CHECKING:
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/tags/tags_bulk_actions_service.py:10:1
   |
 8 |   """
 9 |
10 | / from __future__ import annotations
11 | |
12 | | from dataclasses import dataclass
13 | | from typing import Any, cast
14 | |
15 | | from app.core.constants.tag_categories import TAG_CATEGORY_CHOICES
16 | | from app.core.constants.system_constants import ErrorMessages
17 | | from app.core.exceptions import NotFoundError, ValidationError
18 | | from app.models.instance import Instance
19 | | from app.models.tag import Tag
20 | | from app.repositories.instances_repository import InstancesRepository
21 | | from app.repositories.tags_repository import TagsRepository
22 | | from app.schemas.tags_bulk import TagsBulkAssignPayload, TagsBulkInstanceTagsPayload, TagsBulkRemoveAllPayload
23 | | from app.schemas.validation import validate_or_raise
24 | | from app.utils.request_payload import parse_payload
25 | | from app.utils.structlog_config import log_info
   | |_______________________________________________^
   |
help: Organize imports

D102 Missing docstring in public method
  --> app/services/tags/tags_bulk_actions_service.py:95:9
   |
93 |     """tags bulk actions 编排服务."""
94 |
95 |     def assign_from_payload(self, payload: object | None, *, actor_id: int | None) -> TagsBulkAssignOutcome:
   |         ^^^^^^^^^^^^^^^^^^^
96 |         sanitized = parse_payload(payload or {}, list_fields=["instance_ids", "tag_ids"])
97 |         if not sanitized:
   |

D102 Missing docstring in public method
   --> app/services/tags/tags_bulk_actions_service.py:107:9
    |
105 |         )
106 |
107 |     def remove_from_payload(self, payload: object | None, *, actor_id: int | None) -> TagsBulkRemoveOutcome:
    |         ^^^^^^^^^^^^^^^^^^^
108 |         sanitized = parse_payload(payload or {}, list_fields=["instance_ids", "tag_ids"])
109 |         if not sanitized:
    |

D102 Missing docstring in public method
   --> app/services/tags/tags_bulk_actions_service.py:119:9
    |
117 |         )
118 |
119 |     def remove_all_from_payload(self, payload: object | None, *, actor_id: int | None) -> TagsBulkRemoveAllOutcome:
    |         ^^^^^^^^^^^^^^^^^^^^^^^
120 |         sanitized = parse_payload(payload or {}, list_fields=["instance_ids"])
121 |         if not sanitized:
    |

D102 Missing docstring in public method
   --> app/services/tags/tags_bulk_actions_service.py:130:9
    |
128 |         )
129 |
130 |     def list_instance_tags_from_payload(self, payload: object | None) -> TagsBulkInstanceTagsOutcome:
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
131 |         sanitized = parse_payload(payload or {}, list_fields=["instance_ids"])
132 |         if not sanitized:
    |

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/users/users_list_service.py:8:1
   |
 6 |   """
 7 |
 8 | / from __future__ import annotations
 9 | |
10 | | from app.repositories.users_repository import UsersRepository
11 | | from app.core.types.listing import PaginatedResult
12 | | from app.core.types.users import UserListFilters, UserListItem
   | |______________________________________________________________^
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/tasks/accounts_sync_tasks.py:23:5
   |
22 |   if TYPE_CHECKING:
23 | /     from app.models.sync_instance_record import SyncInstanceRecord
24 | |     from app.models.sync_session import SyncSession
25 | |     from app.core.types.structures import JsonDict
26 | |     from app.core.types.sync import CollectionSummary, InventorySummary, SyncStagesSummary
   | |__________________________________________________________________________________________^
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
   --> app/tasks/capacity_collection_tasks.py:149:1
    |
147 |               return result
148 |
149 | / from app.tasks.capacity_collection_manual_tasks import collect_database_sizes_by_type, collect_specific_instance_database_sizes
150 | | from app.tasks.capacity_collection_status_tasks import get_collection_status, validate_collection_config
    | |________________________________________________________________________________________________________^
    |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/tasks/partition_management_tasks.py:6:1
   |
 4 |   """
 5 |
 6 | / from __future__ import annotations
 7 | |
 8 | | from contextlib import suppress
 9 | | from datetime import timedelta
10 | |
11 | | from sqlalchemy.exc import SQLAlchemyError
12 | |
13 | | from app import create_app, db
14 | | from app.core.exceptions import AppError, DatabaseError
15 | | from app.services.partition_management_service import PartitionManagementService
16 | | from app.services.statistics.partition_statistics_service import PartitionStatisticsService
17 | | from app.core.types.structures import JsonDict
18 | | from app.utils.response_utils import unified_error_response, unified_success_response
19 | | from app.utils.structlog_config import log_error, log_info, log_warning
20 | | from app.utils.time_utils import time_utils
   | |___________________________________________^
21 |
22 |   MODULE = "partition_tasks"
   |
help: Organize imports

D103 Missing docstring in public function
  --> app/utils/database_type_utils.py:26:5
   |
26 | def get_database_type_display_name(db_type: str) -> str:
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
27 |     normalized = normalize_database_type(db_type)
28 |     return DatabaseType.DISPLAY_NAMES.get(normalized, db_type)
   |

D103 Missing docstring in public function
  --> app/utils/database_type_utils.py:31:5
   |
31 | def get_database_type_icon(db_type: str) -> str:
   |     ^^^^^^^^^^^^^^^^^^^^^^
32 |     normalized = normalize_database_type(db_type)
33 |     return DatabaseType.ICONS.get(normalized, "fa-database")
   |

D103 Missing docstring in public function
  --> app/utils/database_type_utils.py:36:5
   |
36 | def get_database_type_color(db_type: str) -> str:
   |     ^^^^^^^^^^^^^^^^^^^^^^^
37 |     normalized = normalize_database_type(db_type)
38 |     return DatabaseType.COLORS.get(normalized, "primary")
   |

D103 Missing docstring in public function
  --> app/utils/database_type_utils.py:41:5
   |
41 | def get_database_type_default_port(db_type: str) -> int | None:
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
42 |     normalized = normalize_database_type(db_type)
43 |     return DatabaseType.DEFAULT_PORTS.get(normalized)
   |

D103 Missing docstring in public function
  --> app/utils/database_type_utils.py:46:5
   |
46 | def get_database_type_default_schema(db_type: str) -> str:
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
47 |     normalized = normalize_database_type(db_type)
48 |     return DatabaseType.DEFAULT_SCHEMAS.get(normalized, "")
   |

D103 Missing docstring in public function
  --> app/utils/database_type_utils.py:51:5
   |
51 | def database_type_requires_port(db_type: str) -> bool:
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^
52 |     return get_database_type_default_port(db_type) is not None
   |

D413 [*] Missing blank line after last section ("Args")
  --> app/utils/password_crypto_utils.py:38:9
   |
36 |         """初始化密码加密工具.
37 |
38 |         Args:
   |         ^^^^
39 |             key: Fernet key(bytes).
40 |         """
   |
help: Add blank line after "Args"

D413 [*] Missing blank line after last section ("Args")
   --> app/utils/password_crypto_utils.py:118:5
    |
116 |     """初始化全局 PasswordManager(由 create_app 调用).
117 |
118 |     Args:
    |     ^^^^
119 |         key: Fernet key 字符串.
120 |     """
    |
help: Add blank line after "Args"

D103 Missing docstring in public function
  --> app/utils/status_type_utils.py:11:5
   |
11 | def is_terminal_sync_status(status: str) -> bool:
   |     ^^^^^^^^^^^^^^^^^^^^^^^
12 |     return status in SyncStatus.TERMINAL
   |

D103 Missing docstring in public function
  --> app/utils/status_type_utils.py:15:5
   |
15 | def is_active_sync_status(status: str) -> bool:
   |     ^^^^^^^^^^^^^^^^^^^^^
16 |     return status in SyncStatus.ACTIVE
   |

D103 Missing docstring in public function
  --> app/utils/status_type_utils.py:19:5
   |
19 | def is_success_sync_status(status: str) -> bool:
   |     ^^^^^^^^^^^^^^^^^^^^^^
20 |     return status in SyncStatus.SUCCESS
   |

D103 Missing docstring in public function
  --> app/utils/status_type_utils.py:23:5
   |
23 | def is_error_sync_status(status: str) -> bool:
   |     ^^^^^^^^^^^^^^^^^^^^
24 |     return status in SyncStatus.ERROR
   |

D103 Missing docstring in public function
  --> app/utils/status_type_utils.py:27:5
   |
27 | def is_valid_sync_session_status(status: str) -> bool:
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
28 |     return status in SyncSessionStatus.ALL
   |

D103 Missing docstring in public function
  --> app/utils/status_type_utils.py:31:5
   |
31 | def is_completed_task_status(status: str) -> bool:
   |     ^^^^^^^^^^^^^^^^^^^^^^^^
32 |     return status in TaskStatus.COMPLETED
   |

D103 Missing docstring in public function
  --> app/utils/status_type_utils.py:35:5
   |
35 | def is_in_progress_task_status(status: str) -> bool:
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^
36 |     return status in TaskStatus.IN_PROGRESS
   |

D103 Missing docstring in public function
  --> app/utils/status_type_utils.py:39:5
   |
39 | def is_operational_instance_status(status: str) -> bool:
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
40 |     return status == InstanceStatus.ACTIVE
   |

I001 [*] Import block is un-sorted or un-formatted
  --> app/utils/structlog_config.py:3:1
   |
 1 |   """WhaleFall 项目的结构化日志配置与辅助函数."""
 2 |
 3 | / from __future__ import annotations
 4 | |
 5 | | import atexit
 6 | | import sys
 7 | | from contextlib import suppress
 8 | | from functools import wraps
 9 | | from typing import TYPE_CHECKING, ParamSpec, cast
10 | |
11 | | import structlog
12 | | from flask import Flask, current_app, g, has_request_context, jsonify
13 | | from flask_login import current_user
14 | |
15 | | from app.core.constants.system_constants import ErrorSeverity
16 | | from app.settings import APP_VERSION
17 | | from app.core.types import ContextDict, JsonValue, LoggerExtra, StructlogEventDict
18 | | from app.utils.logging.context_vars import request_id_var, user_id_var
19 | | from app.utils.logging.error_adapter import (
20 | |     ErrorContext,
21 | |     ErrorMetadata,
22 | |     build_public_context,
23 | |     derive_error_metadata,
24 | |     get_error_suggestions,
25 | | )
26 | | from app.utils.logging.handlers import DatabaseLogHandler, DebugFilter
27 | | from app.infra.logging.queue_worker import LogQueueWorker
   | |_________________________________________________________^
28 |
29 |   if TYPE_CHECKING:
   |
help: Organize imports

D103 Missing docstring in public function
  --> app/utils/theme_color_utils.py:15:5
   |
15 | def is_valid_theme_color(color_key: str) -> bool:
   |     ^^^^^^^^^^^^^^^^^^^^
16 |     return color_key in ThemeColors.COLOR_MAP
   |

D103 Missing docstring in public function
  --> app/utils/theme_color_utils.py:19:5
   |
19 | def get_theme_color_info(color_key: str) -> dict[str, str]:
   |     ^^^^^^^^^^^^^^^^^^^^
20 |     info = ThemeColors.COLOR_MAP.get(color_key) or ThemeColors.COLOR_MAP[_DEFAULT_COLOR_KEY]
21 |     return dict(info)
   |

D103 Missing docstring in public function
  --> app/utils/theme_color_utils.py:24:5
   |
24 | def get_theme_color_value(color_key: str) -> str:
   |     ^^^^^^^^^^^^^^^^^^^^^
25 |     return get_theme_color_info(color_key).get("value", ThemeColors.COLOR_MAP[_DEFAULT_COLOR_KEY]["value"])
   |

D103 Missing docstring in public function
  --> app/utils/theme_color_utils.py:28:5
   |
28 | def get_theme_color_name(color_key: str) -> str:
   |     ^^^^^^^^^^^^^^^^^^^^
29 |     return get_theme_color_info(color_key).get("name", ThemeColors.COLOR_MAP[_DEFAULT_COLOR_KEY]["name"])
   |

D103 Missing docstring in public function
  --> app/utils/theme_color_utils.py:32:5
   |
32 | def get_theme_color_css_class(color_key: str) -> str:
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^
33 |     return get_theme_color_info(color_key).get("css_class", ThemeColors.COLOR_MAP[_DEFAULT_COLOR_KEY]["css_class"])
   |

D103 Missing docstring in public function
  --> app/utils/theme_color_utils.py:36:5
   |
36 | def get_theme_color_choices() -> list[tuple[str, str]]:
   |     ^^^^^^^^^^^^^^^^^^^^^^^
37 |     return [
38 |         (key, f"{info['name']} - {info['description']}")
   |

D103 Missing docstring in public function
  --> app/utils/user_role_utils.py:11:5
   |
11 | def is_valid_user_role(role: str) -> bool:
   |     ^^^^^^^^^^^^^^^^^^
12 |     return role in UserRole.ALL
   |

D103 Missing docstring in public function
  --> app/utils/user_role_utils.py:15:5
   |
15 | def user_role_has_permission(role: str, permission: str) -> bool:
   |     ^^^^^^^^^^^^^^^^^^^^^^^^
16 |     return permission in UserRole.PERMISSIONS.get(role, ())
   |

D103 Missing docstring in public function
  --> app/utils/user_role_utils.py:19:5
   |
19 | def is_admin_role(role: str) -> bool:
   |     ^^^^^^^^^^^^^
20 |     return role == UserRole.ADMIN
   |

D103 Missing docstring in public function
  --> app/utils/user_role_utils.py:23:5
   |
23 | def can_create(role: str) -> bool:
   |     ^^^^^^^^^^
24 |     return user_role_has_permission(role, UserRole.PERM_CREATE)
   |

D103 Missing docstring in public function
  --> app/utils/user_role_utils.py:27:5
   |
27 | def can_update(role: str) -> bool:
   |     ^^^^^^^^^^
28 |     return user_role_has_permission(role, UserRole.PERM_UPDATE)
   |

D103 Missing docstring in public function
  --> app/utils/user_role_utils.py:31:5
   |
31 | def can_delete(role: str) -> bool:
   |     ^^^^^^^^^^
32 |     return user_role_has_permission(role, UserRole.PERM_DELETE)
   |

D103 Missing docstring in public function
  --> app/utils/user_role_utils.py:35:5
   |
35 | def can_admin(role: str) -> bool:
   |     ^^^^^^^^^
36 |     return user_role_has_permission(role, UserRole.PERM_ADMIN)
   |

D103 Missing docstring in public function
  --> app/utils/user_role_utils.py:39:5
   |
39 | def can_execute(role: str) -> bool:
   |     ^^^^^^^^^^^
40 |     return user_role_has_permission(role, UserRole.PERM_EXECUTE)
   |

D103 Missing docstring in public function
  --> app/utils/user_role_utils.py:43:5
   |
43 | def get_user_role_display_name(role: str) -> str:
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^
44 |     return UserRole.DISPLAY_NAMES.get(role, role)
   |

D103 Missing docstring in public function
  --> app/utils/user_role_utils.py:47:5
   |
47 | def get_user_role_description(role: str) -> str:
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^
48 |     return UserRole.DESCRIPTIONS.get(role, "")
   |

D103 Missing docstring in public function
  --> app/utils/user_role_utils.py:51:5
   |
51 | def get_user_role_permissions(role: str) -> list[str]:
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^
52 |     return list(UserRole.PERMISSIONS.get(role, ()))
   |

I001 [*] Import block is un-sorted or un-formatted
  --> app/views/form_handlers/account_classification_form_handler.py:3:1
   |
 1 |   """账户分类表单处理器(View layer)."""
 2 |
 3 | / from __future__ import annotations
 4 | |
 5 | | from typing import TYPE_CHECKING, cast
 6 | |
 7 | | from app.core.constants.classification_constants import ICON_OPTIONS, RISK_LEVEL_OPTIONS
 8 | | from app.core.constants.colors import ThemeColors
 9 | | from app.services.accounts.account_classifications_read_service import AccountClassificationsReadService
10 | | from app.services.accounts.account_classifications_write_service import AccountClassificationsWriteService
11 | | from app.core.types import ResourceContext, ResourceIdentifier, ResourcePayload
12 | | from app.utils.request_payload import parse_payload
   | |___________________________________________________^
13 |
14 |   if TYPE_CHECKING:
   |
help: Organize imports

D107 Missing docstring in `__init__`
  --> app/views/form_handlers/account_classification_form_handler.py:21:9
   |
19 |     """账户分类表单处理器."""
20 |
21 |     def __init__(
   |         ^^^^^^^^
22 |         self,
23 |         *,
   |

I001 [*] Import block is un-sorted or un-formatted
  --> app/views/form_handlers/account_classification_rule_form_handler.py:3:1
   |
 1 |   """账户分类规则表单处理器(View layer)."""
 2 |
 3 | / from __future__ import annotations
 4 | |
 5 | | from typing import TYPE_CHECKING, cast
 6 | |
 7 | | from app.core.constants import DatabaseType
 8 | | from app.core.constants.classification_constants import OPERATOR_OPTIONS
 9 | | from app.services.accounts.account_classifications_read_service import AccountClassificationsReadService
10 | | from app.services.accounts.account_classifications_write_service import AccountClassificationsWriteService
11 | | from app.services.common.filter_options_service import FilterOptionsService
12 | | from app.core.types import ResourceContext, ResourceIdentifier, ResourcePayload
13 | | from app.utils.database_type_utils import get_database_type_display_name
14 | | from app.utils.request_payload import parse_payload
   | |___________________________________________________^
15 |
16 |   if TYPE_CHECKING:
   |
help: Organize imports

D107 Missing docstring in `__init__`
  --> app/views/form_handlers/account_classification_rule_form_handler.py:23:9
   |
21 |     """账户分类规则表单处理器."""
22 |
23 |     def __init__(
   |         ^^^^^^^^
24 |         self,
25 |         *,
   |

I001 [*] Import block is un-sorted or un-formatted
  --> app/views/form_handlers/change_password_form_handler.py:3:1
   |
 1 |   """修改密码表单处理器(View layer)."""
 2 |
 3 | / from __future__ import annotations
 4 | |
 5 | | from typing import TYPE_CHECKING
 6 | |
 7 | | from app.services.auth.change_password_service import ChangePasswordService
 8 | | from app.core.types import ResourceContext, ResourceIdentifier, ResourcePayload
   | |_______________________________________________________________________________^
 9 |
10 |   if TYPE_CHECKING:
   |
help: Organize imports

D107 Missing docstring in `__init__`
  --> app/views/form_handlers/change_password_form_handler.py:21:9
   |
19 |     """
20 |
21 |     def __init__(self, service: ChangePasswordService | None = None) -> None:
   |         ^^^^^^^^
22 |         self._service = service or ChangePasswordService()
   |

I001 [*] Import block is un-sorted or un-formatted
  --> app/views/form_handlers/credential_form_handler.py:3:1
   |
 1 |   """凭据表单处理器(View layer)."""
 2 |
 3 | / from __future__ import annotations
 4 | |
 5 | | from typing import TYPE_CHECKING
 6 | |
 7 | | from app.core.constants import CREDENTIAL_TYPES, DATABASE_TYPES
 8 | | from app.services.credentials.credential_detail_read_service import CredentialDetailReadService
 9 | | from app.services.credentials.credential_write_service import CredentialWriteService
10 | | from app.core.types import ResourceContext, ResourceIdentifier, ResourcePayload
   | |_______________________________________________________________________________^
11 |
12 |   if TYPE_CHECKING:
   |
help: Organize imports

D107 Missing docstring in `__init__`
  --> app/views/form_handlers/credential_form_handler.py:24:9
   |
22 |     """
23 |
24 |     def __init__(
   |         ^^^^^^^^
25 |         self,
26 |         *,
   |

I001 [*] Import block is un-sorted or un-formatted
  --> app/views/form_handlers/instance_form_handler.py:3:1
   |
 1 |   """实例表单处理器(View layer)."""
 2 |
 3 | / from __future__ import annotations
 4 | |
 5 | | from typing import TYPE_CHECKING, cast
 6 | |
 7 | | from app.core.constants import DatabaseType
 8 | | from app.services.common.filter_options_service import FilterOptionsService
 9 | | from app.services.credentials.credential_options_service import CredentialOptionsService
10 | | from app.services.instances.instance_detail_read_service import InstanceDetailReadService
11 | | from app.services.instances.instance_write_service import InstanceWriteService
12 | | from app.core.types import ResourceContext, ResourceIdentifier, ResourcePayload
13 | | from app.utils.database_type_utils import get_database_type_display_name
   | |________________________________________________________________________^
14 |
15 |   if TYPE_CHECKING:
   |
help: Organize imports

D107 Missing docstring in `__init__`
  --> app/views/form_handlers/instance_form_handler.py:28:9
   |
26 |     """
27 |
28 |     def __init__(
   |         ^^^^^^^^
29 |         self,
30 |         *,
   |

I001 [*] Import block is un-sorted or un-formatted
  --> app/views/form_handlers/scheduler_job_form_handler.py:3:1
   |
 1 |   """定时任务表单处理器(View layer)."""
 2 |
 3 | / from __future__ import annotations
 4 | |
 5 | | from typing import TYPE_CHECKING
 6 | |
 7 | | from app.services.scheduler.scheduler_job_write_service import SchedulerJobWriteService
 8 | | from app.core.types import ResourceContext, ResourceIdentifier, ResourcePayload
   | |_______________________________________________________________________________^
 9 |
10 |   if TYPE_CHECKING:
   |
help: Organize imports

D107 Missing docstring in `__init__`
  --> app/views/form_handlers/scheduler_job_form_handler.py:17:9
   |
15 |     """定时任务表单处理器."""
16 |
17 |     def __init__(self, service: SchedulerJobWriteService | None = None) -> None:
   |         ^^^^^^^^
18 |         self._service = service or SchedulerJobWriteService()
   |

I001 [*] Import block is un-sorted or un-formatted
  --> app/views/form_handlers/tag_form_handler.py:3:1
   |
 1 |   """标签表单处理器(View layer)."""
 2 |
 3 | / from __future__ import annotations
 4 | |
 5 | | from typing import TYPE_CHECKING
 6 | |
 7 | | from app.core.constants.colors import ThemeColors
 8 | | from app.core.constants.tag_categories import TAG_CATEGORY_CHOICES
 9 | | from app.services.tags.tag_detail_read_service import TagDetailReadService
10 | | from app.services.tags.tag_write_service import TagWriteService
11 | | from app.core.types import ResourceContext, ResourceIdentifier, ResourcePayload
   | |_______________________________________________________________________________^
12 |
13 |   if TYPE_CHECKING:
   |
help: Organize imports

D107 Missing docstring in `__init__`
  --> app/views/form_handlers/tag_form_handler.py:25:9
   |
23 |     """
24 |
25 |     def __init__(
   |         ^^^^^^^^
26 |         self,
27 |         *,
   |

I001 [*] Import block is un-sorted or un-formatted
  --> app/views/form_handlers/user_form_handler.py:3:1
   |
 1 |   """用户表单处理器(View layer)."""
 2 |
 3 | / from __future__ import annotations
 4 | |
 5 | | from typing import TYPE_CHECKING
 6 | |
 7 | | from app.core.constants import UserRole
 8 | | from app.services.users.user_detail_read_service import UserDetailReadService
 9 | | from app.services.users.user_write_service import UserWriteService
10 | | from app.core.types import ResourceContext, ResourceIdentifier, ResourcePayload
   | |_______________________________________________________________________________^
11 |
12 |   if TYPE_CHECKING:
   |
help: Organize imports

D107 Missing docstring in `__init__`
  --> app/views/form_handlers/user_form_handler.py:24:9
   |
22 |     """
23 |
24 |     def __init__(
   |         ^^^^^^^^
25 |         self,
26 |         *,
   |

I001 [*] Import block is un-sorted or un-formatted
  --> app/views/scheduler_forms.py:3:1
   |
 1 |   """定时任务表单视图."""
 2 |
 3 | / from __future__ import annotations
 4 | |
 5 | | from typing import TYPE_CHECKING, Any, Never
 6 | |
 7 | | from flask import request
 8 | | from flask.typing import ResponseReturnValue
 9 | | from sqlalchemy.exc import SQLAlchemyError
10 | |
11 | | from app.core.exceptions import NotFoundError, SystemError, ValidationError
12 | | from app.forms.definitions.scheduler_job import SCHEDULER_JOB_FORM_DEFINITION
13 | | from app.utils.response_utils import jsonify_unified_error_message, jsonify_unified_success
14 | | from app.infra.route_safety import safe_route_call
15 | | from app.views.form_handlers.scheduler_job_form_handler import SchedulerJobFormHandler
16 | | from app.views.mixins.resource_forms import ResourceFormView
   | |____________________________________________________________^
17 |
18 |   if TYPE_CHECKING:
   |
help: Organize imports

Found 199 errors.
[*] 125 fixable with the `--fix` option.
