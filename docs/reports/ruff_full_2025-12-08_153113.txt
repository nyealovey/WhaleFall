D400 First line should end with a period
 --> app/__init__.py:1:1
  |
1 | / """鲸落 - Flask 应用初始化。
2 | |
3 | | 基于Flask的DBA数据库管理Web应用.
4 | | """
  | |___^
5 |
6 |   import logging
  |
help: Add period

D415 First line should end with a period, question mark, or exclamation point
 --> app/__init__.py:1:1
  |
1 | / """鲸落 - Flask 应用初始化。
2 | |
3 | | 基于Flask的DBA数据库管理Web应用.
4 | | """
  | |___^
5 |
6 |   import logging
  |
help: Add closing punctuation

D400 First line should end with a period
   --> app/__init__.py:105:5
    |
103 | @lru_cache(maxsize=1)
104 | def get_user_model() -> type["User"]:
105 |     """延迟加载 User 模型，避免循环导入。"""
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
106 |     return import_module("app.models.user").User
    |
help: Add period

D415 First line should end with a period, question mark, or exclamation point
   --> app/__init__.py:105:5
    |
103 | @lru_cache(maxsize=1)
104 | def get_user_model() -> type["User"]:
105 |     """延迟加载 User 模型，避免循环导入。"""
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
106 |     return import_module("app.models.user").User
    |
help: Add closing punctuation

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/__init__.py:105:20
    |
103 | @lru_cache(maxsize=1)
104 | def get_user_model() -> type["User"]:
105 |     """延迟加载 User 模型，避免循环导入。"""
    |                          ^^
106 |     return import_module("app.models.user").User
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/__init__.py:117:26
    |
116 |     Args:
117 |         config_name: 配置名称，默认为None
    |                              ^^
118 |         init_scheduler_on_start: 是否在创建应用时初始化调度器
    |

ANN202 Missing return type annotation for private function `handle_global_exception`
   --> app/__init__.py:152:9
    |
150 |     # 注册全局错误处理器
151 |     @app.errorhandler(Exception)
152 |     def handle_global_exception(error: Exception):
    |         ^^^^^^^^^^^^^^^^^^^^^^^
153 |         """全局错误处理."""
154 |         payload, status_code = unified_error_response(error, context=ErrorContext(error, request))
    |
help: Add return type annotation

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/__init__.py:168:49
    |
166 |             # 调度器初始化失败不影响应用启动
167 |             scheduler_logger = get_system_logger()
168 |             scheduler_logger.exception("调度器初始化失败，应用将继续启动")
    |                                                         ^^
169 |
170 |     return app
    |

C901 `configure_app` is too complex (11 > 10)
   --> app/__init__.py:173:5
    |
173 | def configure_app(app: Flask, config_name: str | None = None) -> None:  # noqa: ARG001, PLR0915
    |     ^^^^^^^^^^^^^
174 |     """配置 Flask 应用的核心参数。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/__init__.py:178:26
    |
176 |     Args:
177 |         app: Flask 应用实例。
178 |         config_name: 配置名称，保留以兼容历史接口。
    |                              ^^
179 |
180 |     Returns:
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/__init__.py:192:54
    |
190 |             # 开发环境使用随机生成的密钥
191 |             secret_key = secrets.token_urlsafe(32)
192 |             logger.warning("⚠️  开发环境使用随机生成的SECRET_KEY，生产环境请设置环境变量")
    |                                                                ^^
193 |         else:
194 |             error_msg = "SECRET_KEY environment variable must be set in production"
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/__init__.py:201:58
    |
199 |             # 开发环境使用随机生成的密钥
200 |             jwt_secret_key = secrets.token_urlsafe(32)
201 |             logger.warning("⚠️  开发环境使用随机生成的JWT_SECRET_KEY，生产环境请设置环境变量")
    |                                                                    ^^
202 |         else:
203 |             error_msg = "JWT_SECRET_KEY environment variable must be set in production"
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/__init__.py:214:21
    |
212 |     database_url = os.getenv("DATABASE_URL") or os.getenv("SQLALCHEMY_DATABASE_URI")
213 |     if not database_url:
214 |         # 默认使用SQLite，使用绝对路径
    |                         ^^
215 |         project_root = Path(__file__).parent.parent
216 |         db_path = project_root / "userdata" / "whalefall_dev.db"
    |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/__init__.py:260:18
    |
258 |         app.config["PREFERRED_URL_SCHEME"] = "http"
259 |
260 |     # 动态设置 URL 方案（基于请求头）
    |                        ^^
261 |     @app.before_request
262 |     def detect_protocol() -> None:
    |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/__init__.py:260:24
    |
258 |         app.config["PREFERRED_URL_SCHEME"] = "http"
259 |
260 |     # 动态设置 URL 方案（基于请求头）
    |                                    ^^
261 |     @app.before_request
262 |     def detect_protocol() -> None:
    |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/__init__.py:264:35
    |
262 |     def detect_protocol() -> None:
263 |         """动态检测请求协议."""
264 |         # 优先检查 X-Forwarded-Proto 头（Nginx 代理设置）
    |                                        ^^
265 |         if request.headers.get(HttpHeaders.X_FORWARDED_PROTO) == "https" or request.is_secure or request.headers.get(HttpHeaders.X_FO…
266 |             app.config["PREFERRED_URL_SCHEME"] = "https"
    |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/__init__.py:264:46
    |
262 |     def detect_protocol() -> None:
263 |         """动态检测请求协议."""
264 |         # 优先检查 X-Forwarded-Proto 头（Nginx 代理设置）
    |                                                        ^^
265 |         if request.headers.get(HttpHeaders.X_FORWARDED_PROTO) == "https" or request.is_secure or request.headers.get(HttpHeaders.X_FO…
266 |             app.config["PREFERRED_URL_SCHEME"] = "https"
    |

E501 Line too long (154 > 120)
   --> app/__init__.py:265:121
    |
263 | …
264 | …
265 | …" or request.is_secure or request.headers.get(HttpHeaders.X_FORWARDED_SSL) == "on":
    |                                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
266 | …
267 | …
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/__init__.py:307:20
    |
306 |     """
307 |     # 从环境变量读取会话超时时间，默认为1小时
    |                                 ^^
308 |     session_lifetime = int(os.getenv("PERMANENT_SESSION_LIFETIME", str(Config.SESSION_LIFETIME)))
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/__init__.py:312:63
    |
310 |     # 会话配置
311 |     app.config["PERMANENT_SESSION_LIFETIME"] = session_lifetime  # 会话超时时间
312 |     app.config["SESSION_COOKIE_SECURE"] = False  # 暂时禁用HTTPS要求，使用HTTP
    |                                                                     ^^
313 |     app.config["SESSION_COOKIE_HTTPONLY"] = True  # 防止XSS攻击
314 |     app.config["SESSION_COOKIE_SAMESITE"] = "Lax"  # CSRF保护
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/__init__.py:361:20
    |
359 |     # 会话安全配置
360 |     login_manager.session_protection = "basic"  # 基础会话保护
361 |     # 从环境变量读取会话超时时间，默认为1小时
    |                                 ^^
362 |     session_lifetime = int(os.getenv("PERMANENT_SESSION_LIFETIME", str(Config.SESSION_LIFETIME)))
363 |     login_manager.remember_cookie_duration = session_lifetime  # 记住我功能过期时间
    |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/__init__.py:390:15
    |
388 |     csrf.init_app(app)
389 |
390 |     # 初始化速率限制器（使用Flask-Caching）
    |                       ^^
391 |     init_rate_limiter(cache)
    |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/__init__.py:390:31
    |
388 |     csrf.init_app(app)
389 |
390 |     # 初始化速率限制器（使用Flask-Caching）
    |                                          ^^
391 |     init_rate_limiter(cache)
    |

D202 [*] No blank lines allowed after function docstring (found 1)
   --> app/__init__.py:396:5
    |
395 |   def register_blueprints(app: Flask) -> None:
396 | /     """注册所有蓝图以暴露路由。.
397 | |
398 | |     Args:
399 | |         app: Flask 应用实例。
400 | |
401 | |     Returns:
402 | |         None: 蓝图全部注册后返回。
403 | |
404 | |     """
    | |_______^
405 |
406 |       blueprints: list[tuple[Blueprint, str | None]] = [
    |
help: Remove blank line(s) after function docstring

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/__init__.py:478:15
    |
477 | def configure_error_handlers(app: Flask) -> None:
478 |     """配置错误处理器（保留占位，统一错误处理中使用）。.
    |                      ^^
479 |
480 |     Args:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/__init__.py:478:20
    |
477 | def configure_error_handlers(app: Flask) -> None:
478 |     """配置错误处理器（保留占位，统一错误处理中使用）。.
    |                                ^^
479 |
480 |     Args:
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/__init__.py:478:30
    |
477 | def configure_error_handlers(app: Flask) -> None:
478 |     """配置错误处理器（保留占位，统一错误处理中使用）。.
    |                                                    ^^
479 |
480 |     Args:
    |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/__init__.py:532:7
    |
532 | # 导入模型（确保模型被注册）
    |           ^^
533 | from app.models import (  # noqa: F401, E402
534 |     credential,
    |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/__init__.py:532:15
    |
532 | # 导入模型（确保模型被注册）
    |                           ^^
533 | from app.models import (  # noqa: F401, E402
534 |     credential,
    |

D205 1 blank line required between summary line and description
 --> app/config.py:1:1
  |
1 | / """鲸落 - 统一配置管理
2 | | 支持开发和生产环境，通过环境变量控制.
3 | |
4 | | 本文件只包含实际使用的配置项。
5 | | """
  | |___^
6 |
7 |   import os
  |
help: Insert single blank line

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/config.py:2:10
  |
1 | """鲸落 - 统一配置管理
2 | 支持开发和生产环境，通过环境变量控制.
  |                   ^^
3 |
4 | 本文件只包含实际使用的配置项。
  |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/config.py:14:19
   |
12 |     """统一配置类 - 支持开发和生产环境.
13 |
14 |     所有配置项优先从环境变量读取，如果环境变量不存在则使用默认值。
   |                                 ^^
15 |     只包含实际被代码使用的配置项。
16 |     """
   |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/config.py:19:14
   |
18 |     # ============================================================================
19 |     # 数据库连接配置（内部使用）
   |                     ^^
20 |     # ============================================================================
21 |     CONNECTION_TIMEOUT = int(os.getenv("DB_CONNECTION_TIMEOUT", "30"))
   |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/config.py:19:19
   |
18 |     # ============================================================================
19 |     # 数据库连接配置（内部使用）
   |                               ^^
20 |     # ============================================================================
21 |     CONNECTION_TIMEOUT = int(os.getenv("DB_CONNECTION_TIMEOUT", "30"))
   |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/config.py:25:11
   |
24 |     # ============================================================================
25 |     # 密码配置（内部使用）
   |               ^^
26 |     # ============================================================================
27 |     PASSWORD_HASH_ROUNDS = int(os.getenv("BCRYPT_LOG_ROUNDS", "12"))
   |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/config.py:25:16
   |
24 |     # ============================================================================
25 |     # 密码配置（内部使用）
   |                         ^^
26 |     # ============================================================================
27 |     PASSWORD_HASH_ROUNDS = int(os.getenv("BCRYPT_LOG_ROUNDS", "12"))
   |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/config.py:30:13
   |
29 |     # ============================================================================
30 |     # 文件上传配置（内部使用）
   |                   ^^
31 |     # ============================================================================
32 |     MAX_FILE_SIZE = int(os.getenv("MAX_FILE_SIZE", str(16 * 1024 * 1024)))  # 16MB
   |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/config.py:30:18
   |
29 |     # ============================================================================
30 |     # 文件上传配置（内部使用）
   |                             ^^
31 |     # ============================================================================
32 |     MAX_FILE_SIZE = int(os.getenv("MAX_FILE_SIZE", str(16 * 1024 * 1024)))  # 16MB
   |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/config.py:51:15
   |
49 |     # JWT配置
50 |     # ============================================================================
51 |     # 内部使用的秒数值（用于计算timedelta）
   |                       ^^
52 |     _JWT_ACCESS_TOKEN_EXPIRES_SECONDS = int(os.getenv("JWT_ACCESS_TOKEN_EXPIRES", "3600"))  # 1小时
53 |     _JWT_REFRESH_TOKEN_EXPIRES_SECONDS = int(os.getenv("JWT_REFRESH_TOKEN_EXPIRES_SECONDS", "2592000"))  # 30天
   |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/config.py:51:29
   |
49 |     # JWT配置
50 |     # ============================================================================
51 |     # 内部使用的秒数值（用于计算timedelta）
   |                                          ^^
52 |     _JWT_ACCESS_TOKEN_EXPIRES_SECONDS = int(os.getenv("JWT_ACCESS_TOKEN_EXPIRES", "3600"))  # 1小时
53 |     _JWT_REFRESH_TOKEN_EXPIRES_SECONDS = int(os.getenv("JWT_REFRESH_TOKEN_EXPIRES_SECONDS", "2592000"))  # 30天
   |

RUF012 Mutable class attributes should be annotated with `typing.ClassVar`
  --> app/config.py:79:33
   |
77 |           raise ValueError(msg)
78 |       SQLALCHEMY_TRACK_MODIFICATIONS = False
79 |       SQLALCHEMY_ENGINE_OPTIONS = {
   |  _________________________________^
80 | |         "pool_pre_ping": True,
81 | |         "pool_recycle": 300,
82 | |         "pool_timeout": CONNECTION_TIMEOUT,
83 | |         "max_overflow": 10,
84 | |         "pool_size": MAX_CONNECTIONS,
85 | |         "echo": DEBUG,  # 开发环境显示SQL，生产环境不显示
86 | |     }
   | |_____^
87 |
88 |       # ============================================================================
   |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/config.py:85:36
   |
83 |         "max_overflow": 10,
84 |         "pool_size": MAX_CONNECTIONS,
85 |         "echo": DEBUG,  # 开发环境显示SQL，生产环境不显示
   |                                          ^^
86 |     }
   |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/config.py:128:14
    |
127 |     # ============================================================================
128 |     # 缓存TTL配置（秒）
    |                  ^^
129 |     # ============================================================================
130 |     CACHE_DEFAULT_TTL = int(os.getenv("CACHE_DEFAULT_TTL", str(7 * 24 * 3600)))  # 7天
    |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/config.py:128:16
    |
127 |     # ============================================================================
128 |     # 缓存TTL配置（秒）
    |                      ^^
129 |     # ============================================================================
130 |     CACHE_DEFAULT_TTL = int(os.getenv("CACHE_DEFAULT_TTL", str(7 * 24 * 3600)))  # 7天
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/constants/__init__.py:3:11
  |
1 | """常量模块。.
2 |
3 | 集中管理所有系统常量，包括颜色、状态、错误消息、HTTP 相关常量等。
  |                     ^^
4 |
5 | 主要常量：
  |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
 --> app/constants/__init__.py:5:5
  |
3 | 集中管理所有系统常量，包括颜色、状态、错误消息、HTTP 相关常量等。
4 |
5 | 主要常量：
  |         ^^
6 | - ThemeColors: 主题颜色常量
7 | - DatabaseType: 数据库类型常量
  |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/constants/__init__.py:16:14
   |
15 | # 导入颜色常量
16 | # 导入HTTP状态码常量（使用Python标准库）
   |                     ^^
17 | from http import HTTPStatus as HttpStatus
   |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/constants/__init__.py:16:26
   |
15 | # 导入颜色常量
16 | # 导入HTTP状态码常量（使用Python标准库）
   |                                       ^^
17 | from http import HTTPStatus as HttpStatus
   |

RUF012 Mutable class attributes should be annotated with `typing.ClassVar`
  --> app/constants/colors.py:7:17
   |
 6 |       # Flatly主题标准颜色映射
 7 |       COLOR_MAP = {
   |  _________________^
 8 | |         "primary": {
 9 | |             "value": "#18bc9c",
10 | |             "name": "主色绿",
11 | |             "description": "主要操作和重要信息",
12 | |             "css_class": "bg-primary",
13 | |         },
14 | |         "danger": {
15 | |             "value": "#e74c3c",
16 | |             "name": "危险红",
17 | |             "description": "高风险和危险操作",
18 | |             "css_class": "bg-danger",
19 | |         },
20 | |         "warning": {
21 | |             "value": "#f39c12",
22 | |             "name": "警告橙",
23 | |             "description": "需要注意的操作",
24 | |             "css_class": "bg-warning",
25 | |         },
26 | |         "info": {
27 | |             "value": "#3498db",
28 | |             "name": "信息蓝",
29 | |             "description": "普通信息和标准操作",
30 | |             "css_class": "bg-info",
31 | |         },
32 | |         "secondary": {
33 | |             "value": "#95a5a6",
34 | |             "name": "次要灰",
35 | |             "description": "次要信息和禁用状态",
36 | |             "css_class": "bg-secondary",
37 | |         },
38 | |         "success": {
39 | |             "value": "#18bc9c",
40 | |             "name": "成功绿",
41 | |             "description": "成功状态和安全操作",
42 | |             "css_class": "bg-success",
43 | |         },
44 | |         "dark": {
45 | |             "value": "#2c3e50",
46 | |             "name": "深色",
47 | |             "description": "重要信息和标题",
48 | |             "css_class": "bg-dark",
49 | |         },
50 | |         "light": {
51 | |             "value": "#ecf0f1",
52 | |             "name": "浅色",
53 | |             "description": "背景和辅助信息",
54 | |             "css_class": "bg-light",
55 | |         },
56 | |     }
   | |_____^
57 |
58 |       @classmethod
   |

ANN206 Missing return type annotation for classmethod `get_color_value`
  --> app/constants/colors.py:59:9
   |
58 |     @classmethod
59 |     def get_color_value(cls, color_key):
   |         ^^^^^^^^^^^^^^^
60 |         """获取颜色值。.
   |
help: Add return type annotation

ANN001 Missing type annotation for function argument `color_key`
  --> app/constants/colors.py:59:30
   |
58 |     @classmethod
59 |     def get_color_value(cls, color_key):
   |                              ^^^^^^^^^
60 |         """获取颜色值。.
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/constants/colors.py:63:27
   |
62 |         Args:
63 |             color_key: 颜色键，例如 'primary'。
   |                              ^^
64 |
65 |         Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/constants/colors.py:66:22
   |
65 |         Returns:
66 |             HEX 颜色字符串，未匹配时返回默认信息蓝。
   |                           ^^
67 |
68 |         """
   |

ANN206 Missing return type annotation for classmethod `get_color_name`
  --> app/constants/colors.py:72:9
   |
71 |     @classmethod
72 |     def get_color_name(cls, color_key):
   |         ^^^^^^^^^^^^^^
73 |         """获取颜色名称。.
   |
help: Add return type annotation

ANN001 Missing type annotation for function argument `color_key`
  --> app/constants/colors.py:72:29
   |
71 |     @classmethod
72 |     def get_color_name(cls, color_key):
   |                             ^^^^^^^^^
73 |         """获取颜色名称。.
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/constants/colors.py:79:19
   |
78 |         Returns:
79 |             颜色中文名称，找不到时返回“信息蓝”。
   |                         ^^
80 |
81 |         """
   |

ANN206 Missing return type annotation for classmethod `get_color_choices`
  --> app/constants/colors.py:85:9
   |
84 |     @classmethod
85 |     def get_color_choices(cls):
   |         ^^^^^^^^^^^^^^^^^
86 |         """获取表单选择项。.
   |
help: Add return type annotation

ANN206 Missing return type annotation for classmethod `get_css_class`
  --> app/constants/colors.py:96:9
   |
95 |     @classmethod
96 |     def get_css_class(cls, color_key):
   |         ^^^^^^^^^^^^^
97 |         """获取 CSS 类名。.
   |
help: Add return type annotation

ANN001 Missing type annotation for function argument `color_key`
  --> app/constants/colors.py:96:28
   |
95 |     @classmethod
96 |     def get_css_class(cls, color_key):
   |                            ^^^^^^^^^
97 |         """获取 CSS 类名。.
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/constants/colors.py:103:29
    |
102 |         Returns:
103 |             与颜色对应的 CSS class，默认为 `bg-info`。
    |                                   ^^
104 |
105 |         """
    |

ANN206 Missing return type annotation for classmethod `is_valid_color`
   --> app/constants/colors.py:109:9
    |
108 |     @classmethod
109 |     def is_valid_color(cls, color_key):
    |         ^^^^^^^^^^^^^^
110 |         """验证颜色键是否有效。.
    |
help: Add return type annotation

ANN001 Missing type annotation for function argument `color_key`
   --> app/constants/colors.py:109:29
    |
108 |     @classmethod
109 |     def is_valid_color(cls, color_key):
    |                             ^^^^^^^^^
110 |         """验证颜色键是否有效。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/constants/colors.py:116:33
    |
115 |         Returns:
116 |             True 表示存在于 COLOR_MAP，False 表示未知颜色。
    |                                      ^^
117 |
118 |         """
    |

ANN206 Missing return type annotation for classmethod `get_color_info`
   --> app/constants/colors.py:122:9
    |
121 |     @classmethod
122 |     def get_color_info(cls, color_key):
    |         ^^^^^^^^^^^^^^
123 |         """获取完整颜色信息。.
    |
help: Add return type annotation

ANN001 Missing type annotation for function argument `color_key`
   --> app/constants/colors.py:122:29
    |
121 |     @classmethod
122 |     def get_color_info(cls, color_key):
    |                             ^^^^^^^^^
123 |         """获取完整颜色信息。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/constants/database_types.py:3:13
  |
1 | """数据库类型常量.
2 |
3 | 定义所有支持的数据库类型，避免魔法字符串。
  |                         ^^
4 | """
  |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/constants/database_types.py:10:18
   |
 8 |     """数据库类型常量.
 9 |
10 |     提供标准的数据库类型字符串，提高代码可读性和类型安全。
   |                               ^^
11 |     """
   |

RUF012 Mutable class attributes should be annotated with `typing.ClassVar`
  --> app/constants/database_types.py:23:11
   |
22 |     # 所有支持的类型
23 |     ALL = [MYSQL, POSTGRESQL, SQLSERVER, ORACLE, SQLITE]
   |           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
24 |
25 |     # 主流关系型数据库
   |

RUF012 Mutable class attributes should be annotated with `typing.ClassVar`
  --> app/constants/database_types.py:26:18
   |
25 |     # 主流关系型数据库
26 |     RELATIONAL = [MYSQL, POSTGRESQL, SQLSERVER, ORACLE]
   |                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
27 |
28 |     # ============================================================================
   |

RUF012 Mutable class attributes should be annotated with `typing.ClassVar`
  --> app/constants/database_types.py:31:21
   |
29 |       # 显示名称映射
30 |       # ============================================================================
31 |       DISPLAY_NAMES = {
   |  _____________________^
32 | |         MYSQL: "MySQL",
33 | |         POSTGRESQL: "PostgreSQL",
34 | |         SQLSERVER: "SQL Server",
35 | |         ORACLE: "Oracle Database",
36 | |         SQLITE: "SQLite",
37 | |     }
   | |_____^
38 |
39 |       # ============================================================================
   |

RUF012 Mutable class attributes should be annotated with `typing.ClassVar`
  --> app/constants/database_types.py:42:21
   |
40 |       # 默认端口映射
41 |       # ============================================================================
42 |       DEFAULT_PORTS = {
   |  _____________________^
43 | |         MYSQL: 3306,
44 | |         POSTGRESQL: 5432,
45 | |         SQLSERVER: 1433,
46 | |         ORACLE: 1521,
47 | |         SQLITE: None,  # SQLite不需要端口
48 | |     }
   | |_____^
49 |
50 |       # ============================================================================
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/constants/database_types.py:75:22
   |
74 |         Returns:
75 |             str: 显示名称（如果未知则返回原始类型）
   |                          ^^
76 |
77 |         """
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/constants/database_types.py:75:34
   |
74 |         Returns:
75 |             str: 显示名称（如果未知则返回原始类型）
   |                                                  ^^
76 |
77 |         """
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/constants/database_types.py:88:30
   |
87 |         Returns:
88 |             int | None: 默认端口号，如果没有则返回None
   |                                   ^^
89 |
90 |         """
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/constants/database_types.py:95:23
   |
93 |     @classmethod
94 |     def normalize(cls, db_type: str) -> str:
95 |         """规范化数据库类型字符串（转小写）.
   |                                  ^^
96 |
97 |         Args:
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/constants/database_types.py:95:27
   |
93 |     @classmethod
94 |     def normalize(cls, db_type: str) -> str:
95 |         """规范化数据库类型字符串（转小写）.
   |                                          ^^
96 |
97 |         Args:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/constants/filter_options.py:3:19
  |
1 | """统一搜索筛选器配置.
2 |
3 | 将所有纯枚举/常量型筛选项集中到此处，避免分散定义造成维护困难。
  |                                    ^^
4 | 动态数据请使用 ``app.utils.query_filter_utils`` 中的查询方法。
5 | """
  |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/constants/filter_options.py:13:8
   |
11 | from app.constants.sync_constants import SyncConstants
12 |
13 | # 数据库类型（默认配置，用作兜底或静态展示）
   |             ^^
14 | DATABASE_TYPES: Final[list[dict[str, str]]] = [
15 |     {"name": "mysql", "display_name": "MySQL", "icon": "fa-database", "color": "primary"},
   |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/constants/filter_options.py:13:13
   |
11 | from app.constants.sync_constants import SyncConstants
12 |
13 | # 数据库类型（默认配置，用作兜底或静态展示）
   |                       ^^
14 | DATABASE_TYPES: Final[list[dict[str, str]]] = [
15 |     {"name": "mysql", "display_name": "MySQL", "icon": "fa-database", "color": "primary"},
   |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/constants/filter_options.py:13:23
   |
11 | from app.constants.sync_constants import SyncConstants
12 |
13 | # 数据库类型（默认配置，用作兜底或静态展示）
   |                                           ^^
14 | DATABASE_TYPES: Final[list[dict[str, str]]] = [
15 |     {"name": "mysql", "display_name": "MySQL", "icon": "fa-database", "color": "primary"},
   |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/constants/filter_options.py:28:9
   |
26 | ]
27 |
28 | # 同步操作方式（使用已有常量生成，避免重复维护）
   |               ^^
29 | SYNC_TYPES: Final[list[dict[str, str]]] = [
30 |     {"value": item["value"], "label": item["label"]}
   |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/constants/filter_options.py:28:18
   |
26 | ]
27 |
28 | # 同步操作方式（使用已有常量生成，避免重复维护）
   |                                 ^^
29 | SYNC_TYPES: Final[list[dict[str, str]]] = [
30 |     {"value": item["value"], "label": item["label"]}
   |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/constants/filter_options.py:28:25
   |
26 | ]
27 |
28 | # 同步操作方式（使用已有常量生成，避免重复维护）
   |                                               ^^
29 | SYNC_TYPES: Final[list[dict[str, str]]] = [
30 |     {"value": item["value"], "label": item["label"]}
   |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/constants/filter_options.py:78:9
   |
76 | ]
77 |
78 | # 默认分页大小（供表单/路由使用）
   |               ^^
79 | PAGINATION_SIZES: Final[list[int]] = [10, 20, 50, 100]
   |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/constants/filter_options.py:78:18
   |
76 | ]
77 |
78 | # 默认分页大小（供表单/路由使用）
   |                                ^^
79 | PAGINATION_SIZES: Final[list[int]] = [10, 20, 50, 100]
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/constants/flash_categories.py:3:15
  |
1 | """Flask Flash消息类别常量.
2 |
3 | 定义Flash消息的标准类别，避免魔法字符串。
  |                        ^^
4 | """
  |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/constants/flash_categories.py:10:19
   |
 8 |     """Flask Flash消息类别常量.
 9 |
10 |     定义标准的Flash消息类别，用于前端显示不同样式的提示消息。
   |                            ^^
11 |     这些类别对应Bootstrap的alert样式类。
12 |     """
   |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/constants/flash_categories.py:15:11
   |
14 |     # ============================================================================
15 |     # 消息类别（对应Bootstrap alert类）
   |               ^^
16 |     # ============================================================================
17 |     SUCCESS = "success"     # 成功消息（绿色）
   |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/constants/flash_categories.py:15:30
   |
14 |     # ============================================================================
15 |     # 消息类别（对应Bootstrap alert类）
   |                                      ^^
16 |     # ============================================================================
17 |     SUCCESS = "success"     # 成功消息（绿色）
   |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/constants/flash_categories.py:17:35
   |
15 |     # 消息类别（对应Bootstrap alert类）
16 |     # ============================================================================
17 |     SUCCESS = "success"     # 成功消息（绿色）
   |                                       ^^
18 |     ERROR = "error"         # 错误消息（红色）
19 |     WARNING = "warning"     # 警告消息（黄色）
   |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/constants/flash_categories.py:17:38
   |
15 |     # 消息类别（对应Bootstrap alert类）
16 |     # ============================================================================
17 |     SUCCESS = "success"     # 成功消息（绿色）
   |                                             ^^
18 |     ERROR = "error"         # 错误消息（红色）
19 |     WARNING = "warning"     # 警告消息（黄色）
   |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/constants/flash_categories.py:18:35
   |
16 |     # ============================================================================
17 |     SUCCESS = "success"     # 成功消息（绿色）
18 |     ERROR = "error"         # 错误消息（红色）
   |                                       ^^
19 |     WARNING = "warning"     # 警告消息（黄色）
20 |     INFO = "info"           # 信息消息（蓝色）
   |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/constants/flash_categories.py:18:38
   |
16 |     # ============================================================================
17 |     SUCCESS = "success"     # 成功消息（绿色）
18 |     ERROR = "error"         # 错误消息（红色）
   |                                             ^^
19 |     WARNING = "warning"     # 警告消息（黄色）
20 |     INFO = "info"           # 信息消息（蓝色）
   |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/constants/flash_categories.py:19:35
   |
17 |     SUCCESS = "success"     # 成功消息（绿色）
18 |     ERROR = "error"         # 错误消息（红色）
19 |     WARNING = "warning"     # 警告消息（黄色）
   |                                       ^^
20 |     INFO = "info"           # 信息消息（蓝色）
21 |     DANGER = "danger"       # 危险消息（红色，同error）
   |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/constants/flash_categories.py:19:38
   |
17 |     SUCCESS = "success"     # 成功消息（绿色）
18 |     ERROR = "error"         # 错误消息（红色）
19 |     WARNING = "warning"     # 警告消息（黄色）
   |                                             ^^
20 |     INFO = "info"           # 信息消息（蓝色）
21 |     DANGER = "danger"       # 危险消息（红色，同error）
   |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/constants/flash_categories.py:20:35
   |
18 |     ERROR = "error"         # 错误消息（红色）
19 |     WARNING = "warning"     # 警告消息（黄色）
20 |     INFO = "info"           # 信息消息（蓝色）
   |                                       ^^
21 |     DANGER = "danger"       # 危险消息（红色，同error）
22 |     PRIMARY = "primary"     # 主要消息（蓝色）
   |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/constants/flash_categories.py:20:38
   |
18 |     ERROR = "error"         # 错误消息（红色）
19 |     WARNING = "warning"     # 警告消息（黄色）
20 |     INFO = "info"           # 信息消息（蓝色）
   |                                             ^^
21 |     DANGER = "danger"       # 危险消息（红色，同error）
22 |     PRIMARY = "primary"     # 主要消息（蓝色）
   |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/constants/flash_categories.py:21:35
   |
19 |     WARNING = "warning"     # 警告消息（黄色）
20 |     INFO = "info"           # 信息消息（蓝色）
21 |     DANGER = "danger"       # 危险消息（红色，同error）
   |                                       ^^
22 |     PRIMARY = "primary"     # 主要消息（蓝色）
23 |     SECONDARY = "secondary" # 次要消息（灰色）
   |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/constants/flash_categories.py:21:38
   |
19 |     WARNING = "warning"     # 警告消息（黄色）
20 |     INFO = "info"           # 信息消息（蓝色）
21 |     DANGER = "danger"       # 危险消息（红色，同error）
   |                                             ^^
22 |     PRIMARY = "primary"     # 主要消息（蓝色）
23 |     SECONDARY = "secondary" # 次要消息（灰色）
   |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/constants/flash_categories.py:21:45
   |
19 |     WARNING = "warning"     # 警告消息（黄色）
20 |     INFO = "info"           # 信息消息（蓝色）
21 |     DANGER = "danger"       # 危险消息（红色，同error）
   |                                                      ^^
22 |     PRIMARY = "primary"     # 主要消息（蓝色）
23 |     SECONDARY = "secondary" # 次要消息（灰色）
   |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/constants/flash_categories.py:22:35
   |
20 |     INFO = "info"           # 信息消息（蓝色）
21 |     DANGER = "danger"       # 危险消息（红色，同error）
22 |     PRIMARY = "primary"     # 主要消息（蓝色）
   |                                       ^^
23 |     SECONDARY = "secondary" # 次要消息（灰色）
   |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/constants/flash_categories.py:22:38
   |
20 |     INFO = "info"           # 信息消息（蓝色）
21 |     DANGER = "danger"       # 危险消息（红色，同error）
22 |     PRIMARY = "primary"     # 主要消息（蓝色）
   |                                             ^^
23 |     SECONDARY = "secondary" # 次要消息（灰色）
   |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/constants/flash_categories.py:23:35
   |
21 |     DANGER = "danger"       # 危险消息（红色，同error）
22 |     PRIMARY = "primary"     # 主要消息（蓝色）
23 |     SECONDARY = "secondary" # 次要消息（灰色）
   |                                       ^^
24 |
25 |     # 所有类别
   |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/constants/flash_categories.py:23:38
   |
21 |     DANGER = "danger"       # 危险消息（红色，同error）
22 |     PRIMARY = "primary"     # 主要消息（蓝色）
23 |     SECONDARY = "secondary" # 次要消息（灰色）
   |                                             ^^
24 |
25 |     # 所有类别
   |

RUF012 Mutable class attributes should be annotated with `typing.ClassVar`
  --> app/constants/flash_categories.py:26:11
   |
25 |     # 所有类别
26 |     ALL = [SUCCESS, ERROR, WARNING, INFO, DANGER, PRIMARY, SECONDARY]
   |           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
27 |
28 |     # Bootstrap对应的CSS类
   |

RUF012 Mutable class attributes should be annotated with `typing.ClassVar`
  --> app/constants/flash_categories.py:29:25
   |
28 |       # Bootstrap对应的CSS类
29 |       BOOTSTRAP_CLASSES = {
   |  _________________________^
30 | |         SUCCESS: "alert-success",
31 | |         ERROR: "alert-danger",
32 | |         WARNING: "alert-warning",
33 | |         INFO: "alert-info",
34 | |         DANGER: "alert-danger",
35 | |         PRIMARY: "alert-primary",
36 | |         SECONDARY: "alert-secondary",
37 | |     }
   | |_____^
38 |
39 |       # 类别对应的图标
   |

RUF012 Mutable class attributes should be annotated with `typing.ClassVar`
  --> app/constants/flash_categories.py:40:13
   |
39 |       # 类别对应的图标
40 |       ICONS = {
   |  _____________^
41 | |         SUCCESS: "check-circle",
42 | |         ERROR: "exclamation-circle",
43 | |         WARNING: "exclamation-triangle",
44 | |         INFO: "info-circle",
45 | |         DANGER: "times-circle",
46 | |         PRIMARY: "star",
47 | |         SECONDARY: "circle",
48 | |     }
   | |_____^
49 |
50 |       # ============================================================================
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/constants/http_headers.py:3:13
  |
1 | """HTTP头常量.
2 |
3 | 定义常用的HTTP头名称，避免魔法字符串。
  |                     ^^
4 | """
  |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/constants/http_headers.py:51:15
   |
50 |     # ============================================================================
51 |     # 自定义HTTP头（X-前缀）
   |                   ^^
52 |     # ============================================================================
   |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/constants/http_headers.py:51:20
   |
50 |     # ============================================================================
51 |     # 自定义HTTP头（X-前缀）
   |                           ^^
52 |     # ============================================================================
   |

S105 Possible hardcoded password assigned to: "X_CSRF_TOKEN"
  --> app/constants/http_headers.py:55:20
   |
54 |     # CSRF保护
55 |     X_CSRF_TOKEN = "X-CSRFToken"
   |                    ^^^^^^^^^^^^^
56 |     X_XSRF_TOKEN = "X-XSRF-TOKEN"
   |

S105 Possible hardcoded password assigned to: "X_XSRF_TOKEN"
  --> app/constants/http_headers.py:56:20
   |
54 |     # CSRF保护
55 |     X_CSRF_TOKEN = "X-CSRFToken"
56 |     X_XSRF_TOKEN = "X-XSRF-TOKEN"
   |                    ^^^^^^^^^^^^^^
57 |
58 |     # 速率限制
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/constants/http_methods.py:3:14
  |
1 | """HTTP方法常量.
2 |
3 | 定义标准的HTTP请求方法，避免魔法字符串。
  |                       ^^
4 | """
  |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/constants/http_methods.py:10:18
   |
 8 |     """HTTP方法常量.
 9 |
10 |     定义标准的HTTP请求方法（RFC 7231）。
   |                           ^^
11 |     """
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/constants/http_methods.py:10:27
   |
 8 |     """HTTP方法常量.
 9 |
10 |     定义标准的HTTP请求方法（RFC 7231）。
   |                                     ^^
11 |     """
   |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/constants/http_methods.py:18:33
   |
16 |     GET = "GET"           # 获取资源
17 |     POST = "POST"         # 创建资源
18 |     PUT = "PUT"           # 更新资源（完整）
   |                                     ^^
19 |     PATCH = "PATCH"       # 更新资源（部分）
20 |     DELETE = "DELETE"     # 删除资源
   |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/constants/http_methods.py:18:36
   |
16 |     GET = "GET"           # 获取资源
17 |     POST = "POST"         # 创建资源
18 |     PUT = "PUT"           # 更新资源（完整）
   |                                           ^^
19 |     PATCH = "PATCH"       # 更新资源（部分）
20 |     DELETE = "DELETE"     # 删除资源
   |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/constants/http_methods.py:19:33
   |
17 |     POST = "POST"         # 创建资源
18 |     PUT = "PUT"           # 更新资源（完整）
19 |     PATCH = "PATCH"       # 更新资源（部分）
   |                                     ^^
20 |     DELETE = "DELETE"     # 删除资源
21 |     HEAD = "HEAD"         # 获取资源头信息
   |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/constants/http_methods.py:19:36
   |
17 |     POST = "POST"         # 创建资源
18 |     PUT = "PUT"           # 更新资源（完整）
19 |     PATCH = "PATCH"       # 更新资源（部分）
   |                                           ^^
20 |     DELETE = "DELETE"     # 删除资源
21 |     HEAD = "HEAD"         # 获取资源头信息
   |

RUF012 Mutable class attributes should be annotated with `typing.ClassVar`
  --> app/constants/http_methods.py:27:11
   |
26 |     # 所有方法
27 |     ALL = [GET, POST, PUT, PATCH, DELETE, HEAD, OPTIONS, TRACE, CONNECT]
   |           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
28 |
29 |     # 安全方法（不修改资源）
   |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/constants/http_methods.py:29:11
   |
27 |     ALL = [GET, POST, PUT, PATCH, DELETE, HEAD, OPTIONS, TRACE, CONNECT]
28 |
29 |     # 安全方法（不修改资源）
   |               ^^
30 |     SAFE_METHODS = [GET, HEAD, OPTIONS]
   |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/constants/http_methods.py:29:17
   |
27 |     ALL = [GET, POST, PUT, PATCH, DELETE, HEAD, OPTIONS, TRACE, CONNECT]
28 |
29 |     # 安全方法（不修改资源）
   |                           ^^
30 |     SAFE_METHODS = [GET, HEAD, OPTIONS]
   |

RUF012 Mutable class attributes should be annotated with `typing.ClassVar`
  --> app/constants/http_methods.py:30:20
   |
29 |     # 安全方法（不修改资源）
30 |     SAFE_METHODS = [GET, HEAD, OPTIONS]
   |                    ^^^^^^^^^^^^^^^^^^^^
31 |
32 |     # 幂等方法（多次调用结果相同）
   |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/constants/http_methods.py:32:11
   |
30 |     SAFE_METHODS = [GET, HEAD, OPTIONS]
31 |
32 |     # 幂等方法（多次调用结果相同）
   |               ^^
33 |     IDEMPOTENT_METHODS = [GET, PUT, DELETE, HEAD, OPTIONS]
   |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/constants/http_methods.py:32:20
   |
30 |     SAFE_METHODS = [GET, HEAD, OPTIONS]
31 |
32 |     # 幂等方法（多次调用结果相同）
   |                                 ^^
33 |     IDEMPOTENT_METHODS = [GET, PUT, DELETE, HEAD, OPTIONS]
   |

RUF012 Mutable class attributes should be annotated with `typing.ClassVar`
  --> app/constants/http_methods.py:33:26
   |
32 |     # 幂等方法（多次调用结果相同）
33 |     IDEMPOTENT_METHODS = [GET, PUT, DELETE, HEAD, OPTIONS]
   |                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
34 |
35 |     # 写入方法（会修改资源）
   |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/constants/http_methods.py:35:11
   |
33 |     IDEMPOTENT_METHODS = [GET, PUT, DELETE, HEAD, OPTIONS]
34 |
35 |     # 写入方法（会修改资源）
   |               ^^
36 |     WRITE_METHODS = [POST, PUT, PATCH, DELETE]
   |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/constants/http_methods.py:35:17
   |
33 |     IDEMPOTENT_METHODS = [GET, PUT, DELETE, HEAD, OPTIONS]
34 |
35 |     # 写入方法（会修改资源）
   |                           ^^
36 |     WRITE_METHODS = [POST, PUT, PATCH, DELETE]
   |

RUF012 Mutable class attributes should be annotated with `typing.ClassVar`
  --> app/constants/http_methods.py:36:21
   |
35 |     # 写入方法（会修改资源）
36 |     WRITE_METHODS = [POST, PUT, PATCH, DELETE]
   |                     ^^^^^^^^^^^^^^^^^^^^^^^^^^
37 |
38 |     # 读取方法（不修改资源）
   |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/constants/http_methods.py:38:11
   |
36 |     WRITE_METHODS = [POST, PUT, PATCH, DELETE]
37 |
38 |     # 读取方法（不修改资源）
   |               ^^
39 |     READ_METHODS = [GET, HEAD, OPTIONS]
   |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/constants/http_methods.py:38:17
   |
36 |     WRITE_METHODS = [POST, PUT, PATCH, DELETE]
37 |
38 |     # 读取方法（不修改资源）
   |                           ^^
39 |     READ_METHODS = [GET, HEAD, OPTIONS]
   |

RUF012 Mutable class attributes should be annotated with `typing.ClassVar`
  --> app/constants/http_methods.py:39:20
   |
38 |     # 读取方法（不修改资源）
39 |     READ_METHODS = [GET, HEAD, OPTIONS]
   |                    ^^^^^^^^^^^^^^^^^^^^
40 |
41 |     # ============================================================================
   |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/constants/import_templates.py:5:12
  |
3 | from __future__ import annotations
4 |
5 | # 实例批量导入模板列，需与前端提示保持一致
  |                     ^^
6 | INSTANCE_IMPORT_TEMPLATE_HEADERS = [
7 |     "name",
  |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/constants/import_templates.py:19:8
   |
17 | INSTANCE_IMPORT_REQUIRED_FIELDS = {"name", "db_type", "host", "port"}
18 |
19 | # 模板示例行，帮助用户快速理解格式
   |             ^^
20 | INSTANCE_IMPORT_TEMPLATE_SAMPLE = [
21 |     "demo-mysql-01",
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/constants/status_types.py:3:10
  |
1 | """状态类型常量.
2 |
3 | 定义各种业务状态值，避免魔法字符串。
  |                   ^^
4 | """
  |

RUF012 Mutable class attributes should be annotated with `typing.ClassVar`
  --> app/constants/status_types.py:24:11
   |
23 |     # 所有状态
24 |     ALL = [PENDING, RUNNING, COMPLETED, FAILED, CANCELLED, PAUSED]
   |           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
25 |
26 |     # 活动状态（未结束）
   |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/constants/status_types.py:26:11
   |
24 |     ALL = [PENDING, RUNNING, COMPLETED, FAILED, CANCELLED, PAUSED]
25 |
26 |     # 活动状态（未结束）
   |               ^^
27 |     ACTIVE = [PENDING, RUNNING, PAUSED]
   |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/constants/status_types.py:26:15
   |
24 |     ALL = [PENDING, RUNNING, COMPLETED, FAILED, CANCELLED, PAUSED]
25 |
26 |     # 活动状态（未结束）
   |                       ^^
27 |     ACTIVE = [PENDING, RUNNING, PAUSED]
   |

RUF012 Mutable class attributes should be annotated with `typing.ClassVar`
  --> app/constants/status_types.py:27:14
   |
26 |     # 活动状态（未结束）
27 |     ACTIVE = [PENDING, RUNNING, PAUSED]
   |              ^^^^^^^^^^^^^^^^^^^^^^^^^^
28 |
29 |     # 终止状态（已结束）
   |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/constants/status_types.py:29:11
   |
27 |     ACTIVE = [PENDING, RUNNING, PAUSED]
28 |
29 |     # 终止状态（已结束）
   |               ^^
30 |     TERMINAL = [COMPLETED, FAILED, CANCELLED]
   |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/constants/status_types.py:29:15
   |
27 |     ACTIVE = [PENDING, RUNNING, PAUSED]
28 |
29 |     # 终止状态（已结束）
   |                       ^^
30 |     TERMINAL = [COMPLETED, FAILED, CANCELLED]
   |

RUF012 Mutable class attributes should be annotated with `typing.ClassVar`
  --> app/constants/status_types.py:30:16
   |
29 |     # 终止状态（已结束）
30 |     TERMINAL = [COMPLETED, FAILED, CANCELLED]
   |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
31 |
32 |     # 成功状态
   |

RUF012 Mutable class attributes should be annotated with `typing.ClassVar`
  --> app/constants/status_types.py:33:15
   |
32 |     # 成功状态
33 |     SUCCESS = [COMPLETED]
   |               ^^^^^^^^^^^
34 |
35 |     # 失败状态
   |

RUF012 Mutable class attributes should be annotated with `typing.ClassVar`
  --> app/constants/status_types.py:36:13
   |
35 |     # 失败状态
36 |     ERROR = [FAILED, CANCELLED]
   |             ^^^^^^^^^^^^^^^^^^^
37 |
38 |     # ============================================================================
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/constants/status_types.py:44:21
   |
42 |     @classmethod
43 |     def is_terminal(cls, status: str) -> bool:
44 |         """判断是否为终止状态（已结束）.
   |                              ^^
45 |
46 |         Args:
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/constants/status_types.py:44:25
   |
42 |     @classmethod
43 |     def is_terminal(cls, status: str) -> bool:
44 |         """判断是否为终止状态（已结束）.
   |                                      ^^
45 |
46 |         Args:
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/constants/status_types.py:57:21
   |
55 |     @classmethod
56 |     def is_active(cls, status: str) -> bool:
57 |         """判断是否为活动状态（未结束）.
   |                              ^^
58 |
59 |         Args:
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/constants/status_types.py:57:25
   |
55 |     @classmethod
56 |     def is_active(cls, status: str) -> bool:
57 |         """判断是否为活动状态（未结束）.
   |                                      ^^
58 |
59 |         Args:
   |

RUF012 Mutable class attributes should be annotated with `typing.ClassVar`
   --> app/constants/status_types.py:112:11
    |
111 |     # 所有状态
112 |     ALL = [SUCCESS, ERROR, WARNING, INFO, PENDING, RUNNING]
    |           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
113 |
114 |     # 完成状态
    |

RUF012 Mutable class attributes should be annotated with `typing.ClassVar`
   --> app/constants/status_types.py:115:17
    |
114 |     # 完成状态
115 |     COMPLETED = [SUCCESS, ERROR, WARNING]
    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^
116 |
117 |     # 进行中状态
    |

RUF012 Mutable class attributes should be annotated with `typing.ClassVar`
   --> app/constants/status_types.py:118:19
    |
117 |     # 进行中状态
118 |     IN_PROGRESS = [PENDING, RUNNING]
    |                   ^^^^^^^^^^^^^^^^^^
119 |
120 |     # ============================================================================
    |

RUF012 Mutable class attributes should be annotated with `typing.ClassVar`
   --> app/constants/status_types.py:166:11
    |
165 |     # 所有状态
166 |     ALL = [ACTIVE, INACTIVE, MAINTENANCE, ERROR]
    |           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
167 |
168 |     # ============================================================================
    |

RUF012 Mutable class attributes should be annotated with `typing.ClassVar`
   --> app/constants/status_types.py:201:11
    |
200 |     # 所有状态
201 |     ALL = [SCHEDULED, RUNNING, PAUSED, STOPPED]
    |           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |

D205 1 blank line required between summary line and description
 --> app/constants/sync_constants.py:1:1
  |
1 | / """鲸落 - 同步相关常量定义
2 | | 统一管理同步操作方式和同步分类的常量.
3 | | """
  | |___^
4 |
5 |   from enum import Enum
  |
help: Insert single blank line

RUF012 Mutable class attributes should be annotated with `typing.ClassVar`
  --> app/constants/sync_constants.py:31:30
   |
30 |       # 操作方式显示名称映射
31 |       OPERATION_TYPE_DISPLAY = {
   |  ______________________________^
32 | |         SyncOperationType.MANUAL_SINGLE: "手动单台",
33 | |         SyncOperationType.MANUAL_BATCH: "手动批量",
34 | |         SyncOperationType.MANUAL_TASK: "手动任务",
35 | |         SyncOperationType.SCHEDULED_TASK: "定时任务",
36 | |     }
   | |_____^
37 |
38 |       # 同步分类显示名称映射
   |

RUF012 Mutable class attributes should be annotated with `typing.ClassVar`
  --> app/constants/sync_constants.py:39:24
   |
38 |       # 同步分类显示名称映射
39 |       CATEGORY_DISPLAY = {
   |  ________________________^
40 | |         SyncCategory.ACCOUNT: "账户同步",
41 | |         SyncCategory.CAPACITY: "容量同步",
42 | |         SyncCategory.CONFIG: "配置同步",
43 | |         SyncCategory.AGGREGATION: "聚合统计",
44 | |         SyncCategory.OTHER: "其他",
45 | |     }
   | |_____^
46 |
47 |       # 操作方式英文描述
   |

RUF012 Mutable class attributes should be annotated with `typing.ClassVar`
  --> app/constants/sync_constants.py:48:35
   |
47 |       # 操作方式英文描述
48 |       OPERATION_TYPE_DESCRIPTIONS = {
   |  ___________________________________^
49 | |         SyncOperationType.MANUAL_SINGLE: "Manual Single Instance Operation",
50 | |         SyncOperationType.MANUAL_BATCH: "Manual Batch Operation",
51 | |         SyncOperationType.MANUAL_TASK: "Manual Task Operation",
52 | |         SyncOperationType.SCHEDULED_TASK: "Scheduled Task Operation",
53 | |     }
   | |_____^
54 |
55 |       # 同步分类英文描述
   |

RUF012 Mutable class attributes should be annotated with `typing.ClassVar`
  --> app/constants/sync_constants.py:56:29
   |
55 |       # 同步分类英文描述
56 |       CATEGORY_DESCRIPTIONS = {
   |  _____________________________^
57 | |         SyncCategory.ACCOUNT: "Account Synchronization",
58 | |         SyncCategory.CAPACITY: "Capacity Synchronization",
59 | |         SyncCategory.CONFIG: "Configuration Synchronization",
60 | |         SyncCategory.AGGREGATION: "Aggregation Statistics",
61 | |         SyncCategory.OTHER: "Other Operations",
62 | |     }
   | |_____^
63 |
64 |       # 数据库约束值列表
   |

RUF012 Mutable class attributes should be annotated with `typing.ClassVar`
  --> app/constants/sync_constants.py:65:29
   |
64 |     # 数据库约束值列表
65 |     OPERATION_TYPE_VALUES = [t.value for t in SyncOperationType]
   |                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
66 |     CATEGORY_VALUES = [c.value for c in SyncCategory]
   |

RUF012 Mutable class attributes should be annotated with `typing.ClassVar`
  --> app/constants/sync_constants.py:66:23
   |
64 |     # 数据库约束值列表
65 |     OPERATION_TYPE_VALUES = [t.value for t in SyncOperationType]
66 |     CATEGORY_VALUES = [c.value for c in SyncCategory]
   |                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
67 |
68 |     @staticmethod
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/constants/sync_constants.py:76:27
   |
75 |         Returns:
76 |             True 表示存在于支持列表，否则 False。
   |                                    ^^
77 |
78 |         """
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/constants/sync_constants.py:89:24
   |
88 |         Returns:
89 |             True 表示有效分类，否则 False。
   |                              ^^
90 |
91 |         """
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/constants/sync_constants.py:102:19
    |
101 |         Returns:
102 |             对应中文标签，无法解析时返回原值。
    |                         ^^
103 |
104 |         """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/constants/sync_constants.py:119:17
    |
118 |         Returns:
119 |             中文标签，未匹配时返回原值。
    |                     ^^
120 |
121 |         """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/constants/sync_constants.py:136:19
    |
135 |         Returns:
136 |             英文描述文本，未知值返回原值。
    |                         ^^
137 |
138 |         """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/constants/sync_constants.py:153:19
    |
152 |         Returns:
153 |             英文描述文本，未知值返回原值。
    |                         ^^
154 |
155 |         """
    |

D205 1 blank line required between summary line and description
 --> app/constants/system_constants.py:1:1
  |
1 | / """鲸落 - 常量定义模块
2 | | 统一管理所有魔法数字、硬编码值和配置常量.
3 | | """
  | |___^
4 |
5 |   # 移除循环导入
  |
help: Insert single blank line

S105 Possible hardcoded password assigned to: "TOKEN_EXPIRED"
  --> app/constants/system_constants.py:62:21
   |
60 |     # 认证错误
61 |     INVALID_CREDENTIALS = "用户名或密码错误"
62 |     TOKEN_EXPIRED = "令牌已过期"
   |                     ^^^^^^^^^^^^
63 |     TOKEN_INVALID = "无效的令牌"
64 |     ACCOUNT_DISABLED = "账户已被禁用"
   |

S105 Possible hardcoded password assigned to: "TOKEN_INVALID"
  --> app/constants/system_constants.py:63:21
   |
61 |     INVALID_CREDENTIALS = "用户名或密码错误"
62 |     TOKEN_EXPIRED = "令牌已过期"
63 |     TOKEN_INVALID = "无效的令牌"
   |                     ^^^^^^^^^^^^
64 |     ACCOUNT_DISABLED = "账户已被禁用"
65 |     ACCOUNT_LOCKED = "账户已被锁定"
   |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/constants/system_constants.py:66:34
   |
64 |     ACCOUNT_DISABLED = "账户已被禁用"
65 |     ACCOUNT_LOCKED = "账户已被锁定"
66 |     RATE_LIMIT_EXCEEDED = "请求过于频繁，请稍后再试"
   |                                        ^^
67 |
68 |     # 数据库错误
   |

S105 Possible hardcoded password assigned to: "PASSWORD_CHANGED"
   --> app/constants/system_constants.py:100:24
    |
 98 |     LOGIN_SUCCESS = "登录成功"
 99 |     LOGOUT_SUCCESS = "登出成功"
100 |     PASSWORD_CHANGED = "密码修改成功"
    |                        ^^^^^^^^^^^^^^
101 |     PROFILE_UPDATED = "资料更新成功"
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/constants/time_constants.py:3:14
  |
1 | """时间常量.
2 |
3 | 提供常用时间单位的秒数表示，提高代码可读性。
  |                           ^^
4 | """
  |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/constants/time_constants.py:8:12
   |
 7 | class TimeConstants:
 8 |     """时间常量（秒数）.
   |                ^^
 9 |
10 |     提供常用时间单位的秒数表示，避免在代码中使用魔法数字。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/constants/time_constants.py:8:15
   |
 7 | class TimeConstants:
 8 |     """时间常量（秒数）.
   |                      ^^
 9 |
10 |     提供常用时间单位的秒数表示，避免在代码中使用魔法数字。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/constants/time_constants.py:10:18
   |
 8 |     """时间常量（秒数）.
 9 |
10 |     提供常用时间单位的秒数表示，避免在代码中使用魔法数字。
   |                               ^^
11 |     """
   |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/constants/time_constants.py:14:13
   |
13 |     # ============================================================================
14 |     # 基础时间单位（分钟）
   |                   ^^
15 |     # ============================================================================
16 |     ONE_MINUTE = 60
   |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/constants/time_constants.py:14:16
   |
13 |     # ============================================================================
14 |     # 基础时间单位（分钟）
   |                         ^^
15 |     # ============================================================================
16 |     ONE_MINUTE = 60
   |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/constants/time_constants.py:40:10
   |
39 |     # ============================================================================
40 |     # 月和年（近似值）
   |             ^^
41 |     # ============================================================================
42 |     ONE_MONTH = 2592000    # 30天
   |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/constants/time_constants.py:40:14
   |
39 |     # ============================================================================
40 |     # 月和年（近似值）
   |                     ^^
41 |     # ============================================================================
42 |     ONE_MONTH = 2592000    # 30天
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/constants/user_roles.py:3:10
  |
1 | """用户角色常量.
2 |
3 | 定义用户角色和权限，避免魔法字符串。
  |                   ^^
4 | """
  |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/constants/user_roles.py:18:38
   |
16 |     ADMIN = "admin"             # 管理员
17 |     USER = "user"               # 普通用户
18 |     VIEWER = "viewer"           # 查看者（只读）
   |                                         ^^
19 |
20 |     # 所有角色
   |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/constants/user_roles.py:18:41
   |
16 |     ADMIN = "admin"             # 管理员
17 |     USER = "user"               # 普通用户
18 |     VIEWER = "viewer"           # 查看者（只读）
   |                                               ^^
19 |
20 |     # 所有角色
   |

RUF012 Mutable class attributes should be annotated with `typing.ClassVar`
  --> app/constants/user_roles.py:21:11
   |
20 |     # 所有角色
21 |     ALL = [ADMIN, USER, VIEWER]
   |           ^^^^^^^^^^^^^^^^^^^^^
22 |
23 |     # ============================================================================
   |

RUF012 Mutable class attributes should be annotated with `typing.ClassVar`
  --> app/constants/user_roles.py:36:19
   |
35 |       # 角色权限映射
36 |       PERMISSIONS = {
   |  ___________________^
37 | |         ADMIN: [PERM_READ, PERM_CREATE, PERM_UPDATE, PERM_DELETE, PERM_ADMIN, PERM_EXECUTE],
38 | |         USER: [PERM_READ, PERM_CREATE, PERM_UPDATE, PERM_DELETE, PERM_EXECUTE],
39 | |         VIEWER: [PERM_READ],
40 | |     }
   | |_____^
41 |
42 |       # 角色显示名称
   |

RUF012 Mutable class attributes should be annotated with `typing.ClassVar`
  --> app/constants/user_roles.py:43:21
   |
42 |       # 角色显示名称
43 |       DISPLAY_NAMES = {
   |  _____________________^
44 | |         ADMIN: "管理员",
45 | |         USER: "用户",
46 | |         VIEWER: "查看者",
47 | |     }
   | |_____^
48 |
49 |       # 角色描述
   |

RUF012 Mutable class attributes should be annotated with `typing.ClassVar`
  --> app/constants/user_roles.py:50:20
   |
49 |       # 角色描述
50 |       DESCRIPTIONS = {
   |  ____________________^
51 | |         ADMIN: "拥有系统所有权限，可以管理用户和系统配置",
52 | |         USER: "可以创建、修改、删除数据，执行同步任务",
53 | |         VIEWER: "只能查看数据，不能进行任何修改操作",
54 | |     }
   | |_____^
55 |
56 |       # ============================================================================
   |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/constants/user_roles.py:51:25
   |
49 |     # 角色描述
50 |     DESCRIPTIONS = {
51 |         ADMIN: "拥有系统所有权限，可以管理用户和系统配置",
   |                                 ^^
52 |         USER: "可以创建、修改、删除数据，执行同步任务",
53 |         VIEWER: "只能查看数据，不能进行任何修改操作",
   |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/constants/user_roles.py:52:28
   |
50 |     DESCRIPTIONS = {
51 |         ADMIN: "拥有系统所有权限，可以管理用户和系统配置",
52 |         USER: "可以创建、修改、删除数据，执行同步任务",
   |                                        ^^
53 |         VIEWER: "只能查看数据，不能进行任何修改操作",
54 |     }
   |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/constants/user_roles.py:53:24
   |
51 |         ADMIN: "拥有系统所有权限，可以管理用户和系统配置",
52 |         USER: "可以创建、修改、删除数据，执行同步任务",
53 |         VIEWER: "只能查看数据，不能进行任何修改操作",
   |                              ^^
54 |     }
   |

D205 1 blank line required between summary line and description
 --> app/errors/__init__.py:1:1
  |
1 | / """鲸落 - 统一异常定义
2 | | 集中维护业务异常类型、严重度与 HTTP 状态码映射.
3 | | """
  | |___^
4 |
5 |   from __future__ import annotations
  |
help: Insert single blank line

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/errors/__init__.py:53:25
   |
52 |     Args:
53 |         message: 自定义错误文案，若为空则根据 ``message_key`` 推导。
   |                                ^^
54 |         message_key: `ErrorMessages` 中的常量名称，便于统一管理/国际化。
55 |         extra: 附加的上下文信息字典（例如 instance_id、payload 等安全字段）。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/errors/__init__.py:54:44
   |
52 |     Args:
53 |         message: 自定义错误文案，若为空则根据 ``message_key`` 推导。
54 |         message_key: `ErrorMessages` 中的常量名称，便于统一管理/国际化。
   |                                                  ^^
55 |         extra: 附加的上下文信息字典（例如 instance_id、payload 等安全字段）。
56 |         severity: 可覆盖默认严重度，用于动态调整告警级别。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/errors/__init__.py:55:26
   |
53 |         message: 自定义错误文案，若为空则根据 ``message_key`` 推导。
54 |         message_key: `ErrorMessages` 中的常量名称，便于统一管理/国际化。
55 |         extra: 附加的上下文信息字典（例如 instance_id、payload 等安全字段）。
   |                                    ^^
56 |         severity: 可覆盖默认严重度，用于动态调整告警级别。
57 |         category: 可覆盖默认错误分类，便于统计。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/errors/__init__.py:55:55
   |
53 |         message: 自定义错误文案，若为空则根据 ``message_key`` 推导。
54 |         message_key: `ErrorMessages` 中的常量名称，便于统一管理/国际化。
55 |         extra: 附加的上下文信息字典（例如 instance_id、payload 等安全字段）。
   |                                                                          ^^
56 |         severity: 可覆盖默认严重度，用于动态调整告警级别。
57 |         category: 可覆盖默认错误分类，便于统计。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/errors/__init__.py:56:27
   |
54 |         message_key: `ErrorMessages` 中的常量名称，便于统一管理/国际化。
55 |         extra: 附加的上下文信息字典（例如 instance_id、payload 等安全字段）。
56 |         severity: 可覆盖默认严重度，用于动态调整告警级别。
   |                                   ^^
57 |         category: 可覆盖默认错误分类，便于统计。
58 |         status_code: HTTP 状态码，默认取 ``metadata`` 中的配置。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/errors/__init__.py:57:28
   |
55 |         extra: 附加的上下文信息字典（例如 instance_id、payload 等安全字段）。
56 |         severity: 可覆盖默认严重度，用于动态调整告警级别。
57 |         category: 可覆盖默认错误分类，便于统计。
   |                                     ^^
58 |         status_code: HTTP 状态码，默认取 ``metadata`` 中的配置。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/errors/__init__.py:58:30
   |
56 |         severity: 可覆盖默认严重度，用于动态调整告警级别。
57 |         category: 可覆盖默认错误分类，便于统计。
58 |         status_code: HTTP 状态码，默认取 ``metadata`` 中的配置。
   |                                 ^^
59 |
60 |     """
   |

PLR0913 Too many arguments in function definition (6 > 5)
  --> app/errors/__init__.py:69:9
   |
67 |     )
68 |
69 |     def __init__(
   |         ^^^^^^^^
70 |         self,
71 |         message: str | None = None,
   |

D107 Missing docstring in `__init__`
  --> app/errors/__init__.py:69:9
   |
67 |     )
68 |
69 |     def __init__(
   |         ^^^^^^^^
70 |         self,
71 |         message: str | None = None,
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/errors/__init__.py:102:35
    |
101 |         Returns:
102 |             ErrorCategory: 统一的错误分类，用于统计与监控。
    |                                          ^^
103 |
104 |         """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/errors/__init__.py:112:32
    |
111 |         Returns:
112 |             int: 对外暴露的 HTTP 状态码，默认为异常元数据配置。
    |                                        ^^
113 |
114 |         """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/errors/__init__.py:122:44
    |
121 |         Returns:
122 |             bool: 严重度为 LOW 或 MEDIUM 时为 True，表示可重试或自动修复。
    |                                                   ^^
123 |
124 |         """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/errors/__init__.py:131:24
    |
129 |     """表示输入参数或请求体验证失败。.
130 |
131 |     常用于表单校验、接口必填字段缺失等场景，默认返回 400。
    |                                           ^^
132 |     """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/errors/__init__.py:148:19
    |
146 |     """表示用户凭证无效或已过期。.
147 |
148 |     通常由登录、令牌刷新流程抛出，默认返回 401。
    |                                 ^^
149 |     """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/errors/__init__.py:162:23
    |
160 |     """表示当前主体缺少访问目标资源的权限。.
161 |
162 |     常见于权限校验或资源级 ACL 判断，默认返回 403。
    |                                    ^^
163 |     """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/errors/__init__.py:176:20
    |
174 |     """表示客户端请求的资源不存在或被删除。.
175 |
176 |     适用于实例/账户查找失败等情况，默认返回 404。
    |                                  ^^
177 |     """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/errors/__init__.py:190:21
    |
188 |     """表示资源状态冲突或违反唯一性约束。.
189 |
190 |     典型场景为重复创建、并发修改冲突，默认返回 409。
    |                                     ^^
191 |     """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/errors/__init__.py:204:17
    |
202 |     """表示触发网关或业务层的限流策略。.
203 |
204 |     当请求频率超出限制时抛出，默认返回 429。
    |                             ^^
205 |     """
    |

E501 Line too long (122 > 120)
   --> app/errors/__init__.py:211:121
    |
209 |         category=ErrorCategory.SECURITY,
210 |         severity=ErrorSeverity.MEDIUM,
211 |         default_message_key="RATE_LIMIT_EXCEEDED" if hasattr(ErrorMessages, "RATE_LIMIT_EXCEEDED") else "INVALID_REQUEST",
    |                                                                                                                         ^^
212 |     )
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/errors/__init__.py:216:14
    |
215 | class ExternalServiceError(AppError):
216 |     """表示下游依赖（如外部 API、服务）不可用或超时。.
    |                    ^^
217 |
218 |     抛出后提醒调用方重试或降级，默认返回 502。
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/errors/__init__.py:216:25
    |
215 | class ExternalServiceError(AppError):
216 |     """表示下游依赖（如外部 API、服务）不可用或超时。.
    |                                      ^^
217 |
218 |     抛出后提醒调用方重试或降级，默认返回 502。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/errors/__init__.py:218:18
    |
216 |     """表示下游依赖（如外部 API、服务）不可用或超时。.
217 |
218 |     抛出后提醒调用方重试或降级，默认返回 502。
    |                               ^^
219 |     """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/errors/__init__.py:232:23
    |
230 |     """表示数据库查询或事务执行失败。.
231 |
232 |     可用于 SQL 异常、连接失败等情况，默认返回 500。
    |                                    ^^
233 |     """
    |

A001 Variable `SystemError` is shadowing a Python builtin
   --> app/errors/__init__.py:243:7
    |
243 | class SystemError(AppError):
    |       ^^^^^^^^^^^
244 |     """表示系统级未知错误或底层故障。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/errors/__init__.py:246:16
    |
244 |     """表示系统级未知错误或底层故障。.
245 |
246 |     用于捕获无法归类的异常，默认返回 500。
    |                           ^^
247 |     """
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
 --> app/forms/__init__.py:3:12
  |
1 | """表单定义包.
2 |
3 | 集中管理资源级表单配置（字段、模板、服务映射等）。
  |                       ^^
4 | """
  |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
 --> app/forms/__init__.py:3:24
  |
1 | """表单定义包.
2 |
3 | 集中管理资源级表单配置（字段、模板、服务映射等）。
  |                                               ^^
4 | """
  |

TC006 [*] Add quotes to type expression in `typing.cast()`
  --> app/forms/definitions/__init__.py:46:17
   |
44 |     value = getattr(module, name)
45 |     globals()[name] = value
46 |     return cast(ResourceFormDefinition, value)
   |                 ^^^^^^^^^^^^^^^^^^^^^^
   |
help: Add quotes

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/forms/definitions/account_classification.py:47:33
   |
45 |             component=FieldComponent.NUMBER,
46 |             default=0,
47 |             help_text="数字越大优先级越高，用于控制显示顺序和规则匹配顺序",
   |                                          ^^
48 |         ),
49 |     ],
   |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/forms/definitions/account_classification_rule.py:41:37
   |
39 |             label="权限配置",
40 |             component=FieldComponent.TEXTAREA,
41 |             help_text="JSON 格式的权限表达式，由前端权限配置器生成",
   |                                             ^^
42 |         ),
43 |     ],
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/forms/definitions/base.py:3:24
  |
1 | """基础的资源表单定义模型。.
2 |
3 | 这些定义会被后端视图、服务层以及前端控制器共享，确保字段描述只有唯一来源。
  |                                               ^^
4 | """
  |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `resource`
  --> app/forms/definitions/base.py:64:37
   |
62 |     """
63 |
64 |     def __call__(self, *, resource: Any | None) -> Mapping[str, Any]:
   |                                     ^^^^^^^^^^
65 |         """构造模板渲染所需的上下文字典。.
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/forms/definitions/base.py:68:34
   |
67 |         Args:
68 |             resource: 当前正在编辑的资源实例，创建场景下可能为 None。
   |                                             ^^
69 |
70 |         Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/forms/definitions/base.py:71:19
   |
70 |         Returns:
71 |             一个映射对象，合并到模板上下文中。
   |                         ^^
72 |
73 |         """
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/forms/definitions/base.py:82:20
   |
81 |     Attributes:
82 |         name: 资源英文名（如 instance、credential）
   |                         ^^
83 |         template: 渲染所用的模板路径
84 |         service_class: 负责持久化的服务类型
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/forms/definitions/base.py:82:42
   |
81 |     Attributes:
82 |         name: 资源英文名（如 instance、credential）
   |                                                  ^^
83 |         template: 渲染所用的模板路径
84 |         service_class: 负责持久化的服务类型
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/forms/definitions/base.py:88:34
   |
86 |         success_message: 保存成功后的提示语
87 |         redirect_endpoint: 保存成功后跳转的端点
88 |         context_builder: 额外上下文构造器（可选）
   |                                          ^^
89 |         extra_config: 其他自定义配置
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/forms/definitions/base.py:88:37
   |
86 |         success_message: 保存成功后的提示语
87 |         redirect_endpoint: 保存成功后跳转的端点
88 |         context_builder: 额外上下文构造器（可选）
   |                                                ^^
89 |         extra_config: 其他自定义配置
   |

RUF001 String contains ambiguous `！` (FULLWIDTH EXCLAMATION MARK). Did you mean `!` (EXCLAMATION MARK)?
  --> app/forms/definitions/credential.py:10:28
   |
 8 |     template="credentials/form.html",
 9 |     service_class=CredentialFormService,
10 |     success_message="凭据保存成功！",
   |                                  ^^
11 |     redirect_endpoint="credentials.index",
12 |     fields=[
   |

RUF001 String contains ambiguous `！` (FULLWIDTH EXCLAMATION MARK). Did you mean `!` (EXCLAMATION MARK)?
  --> app/forms/definitions/instance.py:10:28
   |
 8 |     template="instances/form.html",
 9 |     service_class=InstanceFormService,
10 |     success_message="实例保存成功！",
   |                                  ^^
11 |     redirect_endpoint="instance.index",
12 |     fields=[
   |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/forms/definitions/instance.py:17:36
   |
15 |             label="实例名称",
16 |             required=True,
17 |             help_text="用于标识数据库实例的名称，必须唯一",
   |                                                ^^
18 |         ),
19 |         ResourceFormField(
   |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/forms/definitions/instance.py:49:35
   |
47 |             name="database_name",
48 |             label="数据库名称",
49 |             help_text="不同数据库会有默认名称，可根据实际情况调整",
   |                                              ^^
50 |         ),
51 |         ResourceFormField(
   |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/forms/definitions/scheduler_job.py:73:31
   |
71 |             label="运行时间",
72 |             component=FieldComponent.TEXT,
73 |             help_text="日期触发器使用，格式为 YYYY-MM-DD HH:MM",
   |                                      ^^
74 |         ),
75 |     ],
   |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/forms/definitions/user.py:17:36
   |
15 |             label="用户名",
16 |             required=True,
17 |             help_text="仅支持字母、数字和下划线，长度3-20位",
   |                                                ^^
18 |         ),
19 |         ResourceFormField(
   |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/forms/definitions/user.py:23:28
   |
21 |             label="密码",
22 |             required=True,
23 |             help_text="至少8位，包含大小写字母与数字",
   |                               ^^
24 |         ),
25 |         ResourceFormField(
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/models/__init__.py:3:10
  |
1 | """数据模型模块。.
2 |
3 | 定义所有数据库模型，包括用户、实例、凭据、账户权限、同步记录、统计数据等。
  |                   ^^
4 |
5 | 主要模型：
  |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
 --> app/models/__init__.py:5:5
  |
3 | 定义所有数据库模型，包括用户、实例、凭据、账户权限、同步记录、统计数据等。
4 |
5 | 主要模型：
  |         ^^
6 | - User: 用户模型
7 | - Instance: 数据库实例模型
  |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/__init__.py:41:15
   |
39 | from .permission_config import PermissionConfig
40 |
41 | # 移除SyncData导入，使用新的优化同步模型
   |                   ^^
42 | from .sync_instance_record import SyncInstanceRecord
43 | from .sync_session import SyncSession
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/account_change_log.py:10:14
   |
 8 |     """账户变更日志表。.
 9 |
10 |     记录账户的变更历史，包括新增、权限变更、其他修改和删除操作。
   |                       ^^
11 |     支持变更差异对比和会话关联。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/account_change_log.py:18:26
   |
16 |         db_type: 数据库类型。
17 |         username: 账户名。
18 |         change_type: 变更类型（add/modify_privilege/modify_other/delete）。
   |                              ^^
19 |         change_time: 变更时间。
20 |         session_id: 关联的同步会话 ID。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/account_change_log.py:18:67
   |
16 |         db_type: 数据库类型。
17 |         username: 账户名。
18 |         change_type: 变更类型（add/modify_privilege/modify_other/delete）。
   |                                                                        ^^
19 |         change_time: 变更时间。
20 |         session_id: 关联的同步会话 ID。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/account_change_log.py:21:21
   |
19 |         change_time: 变更时间。
20 |         session_id: 关联的同步会话 ID。
21 |         status: 变更状态（success/failed）。
   |                         ^^
22 |         message: 变更消息。
23 |         privilege_diff: 权限变更差异（JSON）。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/account_change_log.py:21:36
   |
19 |         change_time: 变更时间。
20 |         session_id: 关联的同步会话 ID。
21 |         status: 变更状态（success/failed）。
   |                                         ^^
22 |         message: 变更消息。
23 |         privilege_diff: 权限变更差异（JSON）。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/account_change_log.py:23:31
   |
21 |         status: 变更状态（success/failed）。
22 |         message: 变更消息。
23 |         privilege_diff: 权限变更差异（JSON）。
   |                                     ^^
24 |         other_diff: 其他字段变更差异（JSON）。
25 |         instance: 关联的实例对象。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/account_change_log.py:23:36
   |
21 |         status: 变更状态（success/failed）。
22 |         message: 变更消息。
23 |         privilege_diff: 权限变更差异（JSON）。
   |                                           ^^
24 |         other_diff: 其他字段变更差异（JSON）。
25 |         instance: 关联的实例对象。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/account_change_log.py:24:29
   |
22 |         message: 变更消息。
23 |         privilege_diff: 权限变更差异（JSON）。
24 |         other_diff: 其他字段变更差异（JSON）。
   |                                     ^^
25 |         instance: 关联的实例对象。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/account_change_log.py:24:34
   |
22 |         message: 变更消息。
23 |         privilege_diff: 权限变更差异（JSON）。
24 |         other_diff: 其他字段变更差异（JSON）。
   |                                           ^^
25 |         instance: 关联的实例对象。
   |

RUF003 Comment contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/models/account_change_log.py:38:14
   |
36 |         db.String(50),
37 |         nullable=False,
38 |     )  # 变更类型：add（新增）、modify_privilege（权限变更）、modify_other（其他修改）、delete（删除）
   |                  ^^
39 |     change_time = db.Column(db.DateTime(timezone=True), default=time_utils.now, index=True)
40 |     session_id = db.Column(db.String(36), nullable=True)
   |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/account_change_log.py:38:18
   |
36 |         db.String(50),
37 |         nullable=False,
38 |     )  # 变更类型：add（新增）、modify_privilege（权限变更）、modify_other（其他修改）、delete（删除）
   |                       ^^
39 |     change_time = db.Column(db.DateTime(timezone=True), default=time_utils.now, index=True)
40 |     session_id = db.Column(db.String(36), nullable=True)
   |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/account_change_log.py:38:21
   |
36 |         db.String(50),
37 |         nullable=False,
38 |     )  # 变更类型：add（新增）、modify_privilege（权限变更）、modify_other（其他修改）、delete（删除）
   |                             ^^
39 |     change_time = db.Column(db.DateTime(timezone=True), default=time_utils.now, index=True)
40 |     session_id = db.Column(db.String(36), nullable=True)
   |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/account_change_log.py:38:39
   |
36 |         db.String(50),
37 |         nullable=False,
38 |     )  # 变更类型：add（新增）、modify_privilege（权限变更）、modify_other（其他修改）、delete（删除）
   |                                                 ^^
39 |     change_time = db.Column(db.DateTime(timezone=True), default=time_utils.now, index=True)
40 |     session_id = db.Column(db.String(36), nullable=True)
   |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/account_change_log.py:38:44
   |
36 |         db.String(50),
37 |         nullable=False,
38 |     )  # 变更类型：add（新增）、modify_privilege（权限变更）、modify_other（其他修改）、delete（删除）
   |                                                           ^^
39 |     change_time = db.Column(db.DateTime(timezone=True), default=time_utils.now, index=True)
40 |     session_id = db.Column(db.String(36), nullable=True)
   |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/account_change_log.py:38:58
   |
36 |         db.String(50),
37 |         nullable=False,
38 |     )  # 变更类型：add（新增）、modify_privilege（权限变更）、modify_other（其他修改）、delete（删除）
   |                                                                           ^^
39 |     change_time = db.Column(db.DateTime(timezone=True), default=time_utils.now, index=True)
40 |     session_id = db.Column(db.String(36), nullable=True)
   |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/account_change_log.py:38:63
   |
36 |         db.String(50),
37 |         nullable=False,
38 |     )  # 变更类型：add（新增）、modify_privilege（权限变更）、modify_other（其他修改）、delete（删除）
   |                                                                                     ^^
39 |     change_time = db.Column(db.DateTime(timezone=True), default=time_utils.now, index=True)
40 |     session_id = db.Column(db.String(36), nullable=True)
   |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/account_change_log.py:38:71
   |
36 |         db.String(50),
37 |         nullable=False,
38 |     )  # 变更类型：add（新增）、modify_privilege（权限变更）、modify_other（其他修改）、delete（删除）
   |                                                                                               ^^
39 |     change_time = db.Column(db.DateTime(timezone=True), default=time_utils.now, index=True)
40 |     session_id = db.Column(db.String(36), nullable=True)
   |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/account_change_log.py:38:74
   |
36 |         db.String(50),
37 |         nullable=False,
38 |     )  # 变更类型：add（新增）、modify_privilege（权限变更）、modify_other（其他修改）、delete（删除）
   |                                                                                                     ^^
39 |     change_time = db.Column(db.DateTime(timezone=True), default=time_utils.now, index=True)
40 |     session_id = db.Column(db.String(36), nullable=True)
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/account_classification.py:13:14
   |
11 |     """账户分类模型。.
12 |
13 |     管理账户的分类信息，支持自定义分类、风险等级、颜色、图标等。
   |                       ^^
14 |     可以通过规则自动分类或手动分配。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/account_classification.py:18:19
   |
16 |     Attributes:
17 |         id: 主键 ID。
18 |         name: 分类名称，唯一。
   |                       ^^
19 |         description: 分类描述。
20 |         risk_level: 风险等级（low/medium/high/critical）。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/account_classification.py:20:25
   |
18 |         name: 分类名称，唯一。
19 |         description: 分类描述。
20 |         risk_level: 风险等级（low/medium/high/critical）。
   |                             ^^
21 |         color: 显示颜色。
22 |         icon_name: 图标名称（Font Awesome）。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/account_classification.py:20:50
   |
18 |         name: 分类名称，唯一。
19 |         description: 分类描述。
20 |         risk_level: 风险等级（low/medium/high/critical）。
   |                                                       ^^
21 |         color: 显示颜色。
22 |         icon_name: 图标名称（Font Awesome）。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/account_classification.py:22:24
   |
20 |         risk_level: 风险等级（low/medium/high/critical）。
21 |         color: 显示颜色。
22 |         icon_name: 图标名称（Font Awesome）。
   |                            ^^
23 |         priority: 优先级，数字越大优先级越高。
24 |         is_system: 是否为系统分类。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/account_classification.py:22:37
   |
20 |         risk_level: 风险等级（low/medium/high/critical）。
21 |         color: 显示颜色。
22 |         icon_name: 图标名称（Font Awesome）。
   |                                          ^^
23 |         priority: 优先级，数字越大优先级越高。
24 |         is_system: 是否为系统分类。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/account_classification.py:23:22
   |
21 |         color: 显示颜色。
22 |         icon_name: 图标名称（Font Awesome）。
23 |         priority: 优先级，数字越大优先级越高。
   |                         ^^
24 |         is_system: 是否为系统分类。
25 |         is_active: 是否启用。
   |

RUF003 Comment contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/models/account_classification.py:42:14
   |
40 |         nullable=False,
41 |         default="medium",
42 |     )  # 风险等级：low（低）、medium（中）、high（高）、critical（严重）
   |                  ^^
43 |     color = db.Column(db.String(20), nullable=True)  # 显示颜色
44 |     icon_name = db.Column(db.String(50), nullable=True, default="fa-tag")  # 图标名称
   |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/account_classification.py:42:18
   |
40 |         nullable=False,
41 |         default="medium",
42 |     )  # 风险等级：low（低）、medium（中）、high（高）、critical（严重）
   |                       ^^
43 |     color = db.Column(db.String(20), nullable=True)  # 显示颜色
44 |     icon_name = db.Column(db.String(50), nullable=True, default="fa-tag")  # 图标名称
   |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/account_classification.py:42:20
   |
40 |         nullable=False,
41 |         default="medium",
42 |     )  # 风险等级：low（低）、medium（中）、high（高）、critical（严重）
   |                           ^^
43 |     color = db.Column(db.String(20), nullable=True)  # 显示颜色
44 |     icon_name = db.Column(db.String(50), nullable=True, default="fa-tag")  # 图标名称
   |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/account_classification.py:42:28
   |
40 |         nullable=False,
41 |         default="medium",
42 |     )  # 风险等级：low（低）、medium（中）、high（高）、critical（严重）
   |                                     ^^
43 |     color = db.Column(db.String(20), nullable=True)  # 显示颜色
44 |     icon_name = db.Column(db.String(50), nullable=True, default="fa-tag")  # 图标名称
   |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/account_classification.py:42:30
   |
40 |         nullable=False,
41 |         default="medium",
42 |     )  # 风险等级：low（低）、medium（中）、high（高）、critical（严重）
   |                                         ^^
43 |     color = db.Column(db.String(20), nullable=True)  # 显示颜色
44 |     icon_name = db.Column(db.String(50), nullable=True, default="fa-tag")  # 图标名称
   |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/account_classification.py:42:36
   |
40 |         nullable=False,
41 |         default="medium",
42 |     )  # 风险等级：low（低）、medium（中）、high（高）、critical（严重）
   |                                                 ^^
43 |     color = db.Column(db.String(20), nullable=True)  # 显示颜色
44 |     icon_name = db.Column(db.String(50), nullable=True, default="fa-tag")  # 图标名称
   |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/account_classification.py:42:38
   |
40 |         nullable=False,
41 |         default="medium",
42 |     )  # 风险等级：low（低）、medium（中）、high（高）、critical（严重）
   |                                                     ^^
43 |     color = db.Column(db.String(20), nullable=True)  # 显示颜色
44 |     icon_name = db.Column(db.String(50), nullable=True, default="fa-tag")  # 图标名称
   |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/account_classification.py:42:48
   |
40 |         nullable=False,
41 |         default="medium",
42 |     )  # 风险等级：low（低）、medium（中）、high（高）、critical（严重）
   |                                                                 ^^
43 |     color = db.Column(db.String(20), nullable=True)  # 显示颜色
44 |     icon_name = db.Column(db.String(50), nullable=True, default="fa-tag")  # 图标名称
   |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/account_classification.py:42:51
   |
40 |         nullable=False,
41 |         default="medium",
42 |     )  # 风险等级：low（低）、medium（中）、high（高）、critical（严重）
   |                                                                       ^^
43 |     color = db.Column(db.String(20), nullable=True)  # 显示颜色
44 |     icon_name = db.Column(db.String(50), nullable=True, default="fa-tag")  # 图标名称
   |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/account_classification.py:45:55
   |
43 |     color = db.Column(db.String(20), nullable=True)  # 显示颜色
44 |     icon_name = db.Column(db.String(50), nullable=True, default="fa-tag")  # 图标名称
45 |     priority = db.Column(db.Integer, default=0)  # 优先级，数字越大优先级越高
   |                                                          ^^
46 |     is_system = db.Column(db.Boolean, default=False, nullable=False)  # 是否为系统分类
47 |     is_active = db.Column(db.Boolean, default=True, nullable=False)
   |

ANN201 Missing return type annotation for public function `color_value`
  --> app/models/account_classification.py:75:9
   |
74 |     @property
75 |     def color_value(self):
   |         ^^^^^^^^^^^
76 |         """获取实际颜色值。.
   |
help: Add return type annotation

ANN201 Missing return type annotation for public function `color_name`
  --> app/models/account_classification.py:85:9
   |
84 |     @property
85 |     def color_name(self):
   |         ^^^^^^^^^^
86 |         """获取颜色名称。.
   |
help: Add return type annotation

ANN201 Missing return type annotation for public function `css_class`
  --> app/models/account_classification.py:95:9
   |
94 |     @property
95 |     def css_class(self):
   |         ^^^^^^^^^
96 |         """获取 CSS 类名。.
   |
help: Add return type annotation

RUF003 Comment contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/models/account_classification.py:141:15
    |
139 |         db.String(20),
140 |         nullable=False,
141 |     )  # 数据库类型：mysql、postgresql、sqlserver、oracle
    |                    ^^
142 |     rule_name = db.Column(db.String(100), nullable=False)  # 规则名称
143 |     rule_expression = db.Column(db.Text, nullable=False)  # 规则表达式（JSON格式）
    |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/models/account_classification.py:143:66
    |
141 |     )  # 数据库类型：mysql、postgresql、sqlserver、oracle
142 |     rule_name = db.Column(db.String(100), nullable=False)  # 规则名称
143 |     rule_expression = db.Column(db.Text, nullable=False)  # 规则表达式（JSON格式）
    |                                                                       ^^
144 |     is_active = db.Column(db.Boolean, default=True, nullable=False)
145 |     created_at = db.Column(db.DateTime(timezone=True), default=time_utils.now)
    |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/models/account_classification.py:143:73
    |
141 |     )  # 数据库类型：mysql、postgresql、sqlserver、oracle
142 |     rule_name = db.Column(db.String(100), nullable=False)  # 规则名称
143 |     rule_expression = db.Column(db.Text, nullable=False)  # 规则表达式（JSON格式）
    |                                                                                 ^^
144 |     is_active = db.Column(db.Boolean, default=True, nullable=False)
145 |     created_at = db.Column(db.DateTime(timezone=True), default=time_utils.now)
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/models/account_classification.py:176:19
    |
175 |     def get_rule_expression(self) -> dict:
176 |         """获取规则表达式（解析 JSON）。.
    |                          ^^
177 |
178 |         Returns:
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/models/account_classification.py:176:27
    |
175 |     def get_rule_expression(self) -> dict:
176 |         """获取规则表达式（解析 JSON）。.
    |                                     ^^
177 |
178 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/models/account_classification.py:179:28
    |
178 |         Returns:
179 |             dict: 解析后的规则表达式，失败返回空字典。
    |                                     ^^
180 |
181 |         """
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/models/account_classification.py:188:19
    |
187 |     def set_rule_expression(self, expression: dict) -> None:
188 |         """设置规则表达式（保存为 JSON）。.
    |                          ^^
189 |
190 |         Args:
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/models/account_classification.py:188:28
    |
187 |     def set_rule_expression(self, expression: dict) -> None:
188 |         """设置规则表达式（保存为 JSON）。.
    |                                       ^^
189 |
190 |         Args:
    |

RUF003 Comment contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/models/account_classification.py:214:14
    |
212 |         nullable=False,
213 |         default="auto",
214 |     )  # 分配方式：auto（自动）、manual（手动）
    |                  ^^
215 |     confidence_score = db.Column(db.Float, nullable=True)  # 自动分配的置信度分数
216 |     notes = db.Column(db.Text, nullable=True)  # 备注
    |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/models/account_classification.py:214:19
    |
212 |         nullable=False,
213 |         default="auto",
214 |     )  # 分配方式：auto（自动）、manual（手动）
    |                        ^^
215 |     confidence_score = db.Column(db.Float, nullable=True)  # 自动分配的置信度分数
216 |     notes = db.Column(db.Text, nullable=True)  # 备注
    |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/models/account_classification.py:214:22
    |
212 |         nullable=False,
213 |         default="auto",
214 |     )  # 分配方式：auto（自动）、manual（手动）
    |                              ^^
215 |     confidence_score = db.Column(db.Float, nullable=True)  # 自动分配的置信度分数
216 |     notes = db.Column(db.Text, nullable=True)  # 备注
    |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/models/account_classification.py:214:30
    |
212 |         nullable=False,
213 |         default="auto",
214 |     )  # 分配方式：auto（自动）、manual（手动）
    |                                        ^^
215 |     confidence_score = db.Column(db.Float, nullable=True)  # 自动分配的置信度分数
216 |     notes = db.Column(db.Text, nullable=True)  # 备注
    |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/models/account_classification.py:214:33
    |
212 |         nullable=False,
213 |         default="auto",
214 |     )  # 分配方式：auto（自动）、manual（手动）
    |                                              ^^
215 |     confidence_score = db.Column(db.Float, nullable=True)  # 自动分配的置信度分数
216 |     notes = db.Column(db.Text, nullable=True)  # 备注
    |

RUF003 Comment contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/models/account_classification.py:222:11
    |
220 |     updated_at = db.Column(db.DateTime(timezone=True), default=time_utils.now, onupdate=time_utils.now)
221 |
222 |     # 唯一约束：一个账户在同一个批次中只能有一个分类分配
    |               ^^
223 |     __table_args__ = (
224 |         db.UniqueConstraint(
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/models/account_classification.py:260:59
    |
258 |             "created_at": self.created_at.isoformat(),
259 |             "updated_at": self.updated_at.isoformat(),
260 |             "account_username": self.account_id,  # 直接使用ID，避免关联查询
    |                                                               ^^
261 |             "classification_name": (self.classification.name if self.classification else None),
262 |         }
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/account_permission.py:10:14
   |
 9 | class AccountPermission(BaseSyncData):
10 |     """账户权限快照（支持复杂权限结构）。.
   |                    ^^
11 |
12 |     存储不同数据库类型账户的权限信息快照，支持 MySQL、PostgreSQL、
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/account_permission.py:10:23
   |
 9 | class AccountPermission(BaseSyncData):
10 |     """账户权限快照（支持复杂权限结构）。.
   |                                      ^^
11 |
12 |     存储不同数据库类型账户的权限信息快照，支持 MySQL、PostgreSQL、
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/account_permission.py:12:23
   |
10 |     """账户权限快照（支持复杂权限结构）。.
11 |
12 |     存储不同数据库类型账户的权限信息快照，支持 MySQL、PostgreSQL、
   |                                         ^^
13 |     SQL Server 和 Oracle 的权限结构。继承自 BaseSyncData。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/account_permission.py:20:38
   |
18 |         is_superuser: 是否为超级用户。
19 |         is_locked: 是否被锁定。
20 |         global_privileges: MySQL 全局权限（JSON）。
   |                                          ^^
21 |         database_privileges: MySQL 数据库权限（JSON）。
22 |         predefined_roles: PostgreSQL 预定义角色（JSON）。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/account_permission.py:20:43
   |
18 |         is_superuser: 是否为超级用户。
19 |         is_locked: 是否被锁定。
20 |         global_privileges: MySQL 全局权限（JSON）。
   |                                                ^^
21 |         database_privileges: MySQL 数据库权限（JSON）。
22 |         predefined_roles: PostgreSQL 预定义角色（JSON）。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/account_permission.py:21:41
   |
19 |         is_locked: 是否被锁定。
20 |         global_privileges: MySQL 全局权限（JSON）。
21 |         database_privileges: MySQL 数据库权限（JSON）。
   |                                              ^^
22 |         predefined_roles: PostgreSQL 预定义角色（JSON）。
23 |         role_attributes: PostgreSQL 角色属性（JSON）。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/account_permission.py:21:46
   |
19 |         is_locked: 是否被锁定。
20 |         global_privileges: MySQL 全局权限（JSON）。
21 |         database_privileges: MySQL 数据库权限（JSON）。
   |                                                    ^^
22 |         predefined_roles: PostgreSQL 预定义角色（JSON）。
23 |         role_attributes: PostgreSQL 角色属性（JSON）。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/account_permission.py:22:43
   |
20 |         global_privileges: MySQL 全局权限（JSON）。
21 |         database_privileges: MySQL 数据库权限（JSON）。
22 |         predefined_roles: PostgreSQL 预定义角色（JSON）。
   |                                                ^^
23 |         role_attributes: PostgreSQL 角色属性（JSON）。
24 |         database_privileges_pg: PostgreSQL 数据库权限（JSON）。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/account_permission.py:22:48
   |
20 |         global_privileges: MySQL 全局权限（JSON）。
21 |         database_privileges: MySQL 数据库权限（JSON）。
22 |         predefined_roles: PostgreSQL 预定义角色（JSON）。
   |                                                      ^^
23 |         role_attributes: PostgreSQL 角色属性（JSON）。
24 |         database_privileges_pg: PostgreSQL 数据库权限（JSON）。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/account_permission.py:23:41
   |
21 |         database_privileges: MySQL 数据库权限（JSON）。
22 |         predefined_roles: PostgreSQL 预定义角色（JSON）。
23 |         role_attributes: PostgreSQL 角色属性（JSON）。
   |                                             ^^
24 |         database_privileges_pg: PostgreSQL 数据库权限（JSON）。
25 |         tablespace_privileges: PostgreSQL 表空间权限（JSON）。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/account_permission.py:23:46
   |
21 |         database_privileges: MySQL 数据库权限（JSON）。
22 |         predefined_roles: PostgreSQL 预定义角色（JSON）。
23 |         role_attributes: PostgreSQL 角色属性（JSON）。
   |                                                   ^^
24 |         database_privileges_pg: PostgreSQL 数据库权限（JSON）。
25 |         tablespace_privileges: PostgreSQL 表空间权限（JSON）。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/account_permission.py:24:49
   |
22 |         predefined_roles: PostgreSQL 预定义角色（JSON）。
23 |         role_attributes: PostgreSQL 角色属性（JSON）。
24 |         database_privileges_pg: PostgreSQL 数据库权限（JSON）。
   |                                                      ^^
25 |         tablespace_privileges: PostgreSQL 表空间权限（JSON）。
26 |         server_roles: SQL Server 服务器角色（JSON）。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/account_permission.py:24:54
   |
22 |         predefined_roles: PostgreSQL 预定义角色（JSON）。
23 |         role_attributes: PostgreSQL 角色属性（JSON）。
24 |         database_privileges_pg: PostgreSQL 数据库权限（JSON）。
   |                                                            ^^
25 |         tablespace_privileges: PostgreSQL 表空间权限（JSON）。
26 |         server_roles: SQL Server 服务器角色（JSON）。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/account_permission.py:25:48
   |
23 |         role_attributes: PostgreSQL 角色属性（JSON）。
24 |         database_privileges_pg: PostgreSQL 数据库权限（JSON）。
25 |         tablespace_privileges: PostgreSQL 表空间权限（JSON）。
   |                                                     ^^
26 |         server_roles: SQL Server 服务器角色（JSON）。
27 |         server_permissions: SQL Server 服务器权限（JSON）。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/account_permission.py:25:53
   |
23 |         role_attributes: PostgreSQL 角色属性（JSON）。
24 |         database_privileges_pg: PostgreSQL 数据库权限（JSON）。
25 |         tablespace_privileges: PostgreSQL 表空间权限（JSON）。
   |                                                           ^^
26 |         server_roles: SQL Server 服务器角色（JSON）。
27 |         server_permissions: SQL Server 服务器权限（JSON）。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/account_permission.py:26:39
   |
24 |         database_privileges_pg: PostgreSQL 数据库权限（JSON）。
25 |         tablespace_privileges: PostgreSQL 表空间权限（JSON）。
26 |         server_roles: SQL Server 服务器角色（JSON）。
   |                                            ^^
27 |         server_permissions: SQL Server 服务器权限（JSON）。
28 |         database_roles: SQL Server 数据库角色（JSON）。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/account_permission.py:26:44
   |
24 |         database_privileges_pg: PostgreSQL 数据库权限（JSON）。
25 |         tablespace_privileges: PostgreSQL 表空间权限（JSON）。
26 |         server_roles: SQL Server 服务器角色（JSON）。
   |                                                  ^^
27 |         server_permissions: SQL Server 服务器权限（JSON）。
28 |         database_roles: SQL Server 数据库角色（JSON）。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/account_permission.py:27:45
   |
25 |         tablespace_privileges: PostgreSQL 表空间权限（JSON）。
26 |         server_roles: SQL Server 服务器角色（JSON）。
27 |         server_permissions: SQL Server 服务器权限（JSON）。
   |                                                  ^^
28 |         database_roles: SQL Server 数据库角色（JSON）。
29 |         database_permissions: SQL Server 数据库权限（JSON）。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/account_permission.py:27:50
   |
25 |         tablespace_privileges: PostgreSQL 表空间权限（JSON）。
26 |         server_roles: SQL Server 服务器角色（JSON）。
27 |         server_permissions: SQL Server 服务器权限（JSON）。
   |                                                        ^^
28 |         database_roles: SQL Server 数据库角色（JSON）。
29 |         database_permissions: SQL Server 数据库权限（JSON）。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/account_permission.py:28:41
   |
26 |         server_roles: SQL Server 服务器角色（JSON）。
27 |         server_permissions: SQL Server 服务器权限（JSON）。
28 |         database_roles: SQL Server 数据库角色（JSON）。
   |                                              ^^
29 |         database_permissions: SQL Server 数据库权限（JSON）。
30 |         oracle_roles: Oracle 角色（JSON）。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/account_permission.py:28:46
   |
26 |         server_roles: SQL Server 服务器角色（JSON）。
27 |         server_permissions: SQL Server 服务器权限（JSON）。
28 |         database_roles: SQL Server 数据库角色（JSON）。
   |                                                    ^^
29 |         database_permissions: SQL Server 数据库权限（JSON）。
30 |         oracle_roles: Oracle 角色（JSON）。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/account_permission.py:29:47
   |
27 |         server_permissions: SQL Server 服务器权限（JSON）。
28 |         database_roles: SQL Server 数据库角色（JSON）。
29 |         database_permissions: SQL Server 数据库权限（JSON）。
   |                                                    ^^
30 |         oracle_roles: Oracle 角色（JSON）。
31 |         system_privileges: Oracle 系统权限（JSON）。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/account_permission.py:29:52
   |
27 |         server_permissions: SQL Server 服务器权限（JSON）。
28 |         database_roles: SQL Server 数据库角色（JSON）。
29 |         database_permissions: SQL Server 数据库权限（JSON）。
   |                                                          ^^
30 |         oracle_roles: Oracle 角色（JSON）。
31 |         system_privileges: Oracle 系统权限（JSON）。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/account_permission.py:30:32
   |
28 |         database_roles: SQL Server 数据库角色（JSON）。
29 |         database_permissions: SQL Server 数据库权限（JSON）。
30 |         oracle_roles: Oracle 角色（JSON）。
   |                                  ^^
31 |         system_privileges: Oracle 系统权限（JSON）。
32 |         tablespace_privileges_oracle: Oracle 表空间权限（JSON）。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/account_permission.py:30:37
   |
28 |         database_roles: SQL Server 数据库角色（JSON）。
29 |         database_permissions: SQL Server 数据库权限（JSON）。
30 |         oracle_roles: Oracle 角色（JSON）。
   |                                        ^^
31 |         system_privileges: Oracle 系统权限（JSON）。
32 |         tablespace_privileges_oracle: Oracle 表空间权限（JSON）。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/account_permission.py:31:39
   |
29 |         database_permissions: SQL Server 数据库权限（JSON）。
30 |         oracle_roles: Oracle 角色（JSON）。
31 |         system_privileges: Oracle 系统权限（JSON）。
   |                                           ^^
32 |         tablespace_privileges_oracle: Oracle 表空间权限（JSON）。
33 |         type_specific: 其他类型特定字段（JSON）。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/account_permission.py:31:44
   |
29 |         database_permissions: SQL Server 数据库权限（JSON）。
30 |         oracle_roles: Oracle 角色（JSON）。
31 |         system_privileges: Oracle 系统权限（JSON）。
   |                                                 ^^
32 |         tablespace_privileges_oracle: Oracle 表空间权限（JSON）。
33 |         type_specific: 其他类型特定字段（JSON）。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/account_permission.py:32:51
   |
30 |         oracle_roles: Oracle 角色（JSON）。
31 |         system_privileges: Oracle 系统权限（JSON）。
32 |         tablespace_privileges_oracle: Oracle 表空间权限（JSON）。
   |                                                        ^^
33 |         type_specific: 其他类型特定字段（JSON）。
34 |         last_sync_time: 最后同步时间。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/account_permission.py:32:56
   |
30 |         oracle_roles: Oracle 角色（JSON）。
31 |         system_privileges: Oracle 系统权限（JSON）。
32 |         tablespace_privileges_oracle: Oracle 表空间权限（JSON）。
   |                                                              ^^
33 |         type_specific: 其他类型特定字段（JSON）。
34 |         last_sync_time: 最后同步时间。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/account_permission.py:33:32
   |
31 |         system_privileges: Oracle 系统权限（JSON）。
32 |         tablespace_privileges_oracle: Oracle 表空间权限（JSON）。
33 |         type_specific: 其他类型特定字段（JSON）。
   |                                        ^^
34 |         last_sync_time: 最后同步时间。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/account_permission.py:33:37
   |
31 |         system_privileges: Oracle 系统权限（JSON）。
32 |         tablespace_privileges_oracle: Oracle 表空间权限（JSON）。
33 |         type_specific: 其他类型特定字段（JSON）。
   |                                              ^^
34 |         last_sync_time: 最后同步时间。
   |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/account_permission.py:67:17
   |
65 |     database_permissions = db.Column(db.JSON, nullable=True)  # SQL Server数据库权限
66 |
67 |     # Oracle权限字段（移除表空间配额）
   |                     ^^
68 |     oracle_roles = db.Column(db.JSON, nullable=True)  # Oracle角色
69 |     system_privileges = db.Column(db.JSON, nullable=True)  # Oracle系统权限
   |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/account_permission.py:67:25
   |
65 |     database_permissions = db.Column(db.JSON, nullable=True)  # SQL Server数据库权限
66 |
67 |     # Oracle权限字段（移除表空间配额）
   |                                     ^^
68 |     oracle_roles = db.Column(db.JSON, nullable=True)  # Oracle角色
69 |     system_privileges = db.Column(db.JSON, nullable=True)  # Oracle系统权限
   |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/account_permission.py:80:11
   |
78 |     last_change_time = db.Column(db.DateTime(timezone=True), default=time_utils.now, index=True)
79 |
80 |     # 删除标记（不支持恢复）
   |               ^^
81 |     # 关联实例与账户
82 |     instance = db.relationship("Instance", backref="account_permissions")
   |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/account_permission.py:80:17
   |
78 |     last_change_time = db.Column(db.DateTime(timezone=True), default=time_utils.now, index=True)
79 |
80 |     # 删除标记（不支持恢复）
   |                           ^^
81 |     # 关联实例与账户
82 |     instance = db.relationship("Instance", backref="account_permissions")
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/base_sync_data.py:10:16
   |
 9 | class BaseSyncData(db.Model):
10 |     """基础同步数据模型（抽象基类）。.
   |                        ^^
11 |
12 |     为同步数据模型提供通用字段和方法的抽象基类。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/base_sync_data.py:10:21
   |
 9 | class BaseSyncData(db.Model):
10 |     """基础同步数据模型（抽象基类）。.
   |                                  ^^
11 |
12 |     为同步数据模型提供通用字段和方法的抽象基类。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/base_sync_data.py:13:14
   |
12 |     为同步数据模型提供通用字段和方法的抽象基类。
13 |     所有同步相关的模型（如 AccountPermission）都应继承此类。
   |                       ^^
14 |
15 |     Attributes:
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/base_sync_data.py:13:34
   |
12 |     为同步数据模型提供通用字段和方法的抽象基类。
13 |     所有同步相关的模型（如 AccountPermission）都应继承此类。
   |                                             ^^
14 |
15 |     Attributes:
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/base_sync_data.py:17:30
   |
15 |     Attributes:
16 |         id: 主键 ID。
17 |         instance_id: 关联的实例 ID（外键）。
   |                                   ^^
18 |         db_type: 数据库类型（mysql/postgresql/sqlserver/oracle）。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/base_sync_data.py:17:33
   |
15 |     Attributes:
16 |         id: 主键 ID。
17 |         instance_id: 关联的实例 ID（外键）。
   |                                         ^^
18 |         db_type: 数据库类型（mysql/postgresql/sqlserver/oracle）。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/base_sync_data.py:18:23
   |
16 |         id: 主键 ID。
17 |         instance_id: 关联的实例 ID（外键）。
18 |         db_type: 数据库类型（mysql/postgresql/sqlserver/oracle）。
   |                            ^^
19 |
20 |     """
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/base_sync_data.py:18:57
   |
16 |         id: 主键 ID。
17 |         instance_id: 关联的实例 ID（外键）。
18 |         db_type: 数据库类型（mysql/postgresql/sqlserver/oracle）。
   |                                                               ^^
19 |
20 |     """
   |

RUF003 Comment contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/models/base_sync_data.py:40:15
   |
38 |         nullable=False,
39 |         index=True,
40 |     )  # 数据库类型：mysql、postgresql、sqlserver、oracle
   |                    ^^
41 |
42 |     # 关联实例 - 在子类中定义
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/credential.py:11:14
   |
 9 |     """凭据模型。.
10 |
11 |     存储数据库连接凭据，支持密码加密存储。
   |                       ^^
12 |
13 |     Attributes:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/credential.py:15:19
   |
13 |     Attributes:
14 |         id: 凭据主键。
15 |         name: 凭据名称，唯一。
   |                       ^^
16 |         credential_type: 凭据类型（database、ssh、windows等）。
17 |         db_type: 数据库类型，可选。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/credential.py:16:30
   |
14 |         id: 凭据主键。
15 |         name: 凭据名称，唯一。
16 |         credential_type: 凭据类型（database、ssh、windows等）。
   |                                  ^^
17 |         db_type: 数据库类型，可选。
18 |         username: 用户名。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/credential.py:16:52
   |
14 |         id: 凭据主键。
15 |         name: 凭据名称，唯一。
16 |         credential_type: 凭据类型（database、ssh、windows等）。
   |                                                            ^^
17 |         db_type: 数据库类型，可选。
18 |         username: 用户名。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/credential.py:17:23
   |
15 |         name: 凭据名称，唯一。
16 |         credential_type: 凭据类型（database、ssh、windows等）。
17 |         db_type: 数据库类型，可选。
   |                            ^^
18 |         username: 用户名。
19 |         password: 加密后的密码。
   |

PLR0913 Too many arguments in function definition (8 > 5)
  --> app/models/credential.py:46:9
   |
44 |     deleted_at = db.Column(db.DateTime(timezone=True), nullable=True)
45 |
46 |     def __init__(
   |         ^^^^^^^^
47 |         self,
48 |         name: str,
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/credential.py:60:23
   |
59 |         Args:
60 |             name: 凭据名称，必须唯一。
   |                           ^^
61 |             credential_type: 凭据类型。
62 |             username: 用户名。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/credential.py:63:27
   |
61 |             credential_type: 凭据类型。
62 |             username: 用户名。
63 |             password: 原始密码（将被加密存储）。
   |                               ^^
64 |             db_type: 数据库类型，可选。
65 |             instance_ids: 关联实例ID列表，可选。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/credential.py:63:34
   |
61 |             credential_type: 凭据类型。
62 |             username: 用户名。
63 |             password: 原始密码（将被加密存储）。
   |                                             ^^
64 |             db_type: 数据库类型，可选。
65 |             instance_ids: 关联实例ID列表，可选。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/credential.py:64:27
   |
62 |             username: 用户名。
63 |             password: 原始密码（将被加密存储）。
64 |             db_type: 数据库类型，可选。
   |                                ^^
65 |             instance_ids: 关联实例ID列表，可选。
66 |             category_id: 分类ID，可选。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/credential.py:65:35
   |
63 |             password: 原始密码（将被加密存储）。
64 |             db_type: 数据库类型，可选。
65 |             instance_ids: 关联实例ID列表，可选。
   |                                         ^^
66 |             category_id: 分类ID，可选。
67 |             description: 描述信息，可选。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/credential.py:66:30
   |
64 |             db_type: 数据库类型，可选。
65 |             instance_ids: 关联实例ID列表，可选。
66 |             category_id: 分类ID，可选。
   |                                ^^
67 |             description: 描述信息，可选。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/credential.py:67:30
   |
65 |             instance_ids: 关联实例ID列表，可选。
66 |             category_id: 分类ID，可选。
67 |             description: 描述信息，可选。
   |                                  ^^
68 |
69 |         """
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/credential.py:80:16
   |
79 |     def set_password(self, password: str) -> None:
80 |         """设置密码（加密存储）。.
   |                    ^^
81 |
82 |         使用加密管理器对密码进行加密后存储。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/credential.py:80:21
   |
79 |     def set_password(self, password: str) -> None:
80 |         """设置密码（加密存储）。.
   |                              ^^
81 |
82 |         使用加密管理器对密码进行加密后存储。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/credential.py:88:23
   |
87 |         Returns:
88 |             None: 无返回值，方法执行完成即表示密码已加密存储。
   |                           ^^
89 |
90 |         """
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/models/credential.py:97:17
   |
95 |         """验证密码。.
96 |
97 |         支持多种密码格式：bcrypt 哈希（旧格式）、加密格式和明文。
   |                         ^^
98 |
99 |         Args:
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/credential.py:97:27
   |
95 |         """验证密码。.
96 |
97 |         支持多种密码格式：bcrypt 哈希（旧格式）、加密格式和明文。
   |                                      ^^
98 |
99 |         Args:
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/credential.py:97:31
   |
95 |         """验证密码。.
96 |
97 |         支持多种密码格式：bcrypt 哈希（旧格式）、加密格式和明文。
   |                                              ^^
98 |
99 |         Args:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/models/credential.py:103:24
    |
102 |         Returns:
103 |             密码正确返回 True，否则返回 False。
    |                              ^^
104 |
105 |         """
    |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/models/credential.py:106:22
    |
105 |         """
106 |         # 如果是bcrypt哈希（旧格式），使用bcrypt验证
    |                           ^^
107 |         if self.password.startswith("$2b$"):
108 |             return bcrypt.check_password_hash(self.password, password)
    |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/models/credential.py:106:26
    |
105 |         """
106 |         # 如果是bcrypt哈希（旧格式），使用bcrypt验证
    |                                   ^^
107 |         if self.password.startswith("$2b$"):
108 |             return bcrypt.check_password_hash(self.password, password)
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/models/credential.py:106:27
    |
105 |         """
106 |         # 如果是bcrypt哈希（旧格式），使用bcrypt验证
    |                                     ^^
107 |         if self.password.startswith("$2b$"):
108 |             return bcrypt.check_password_hash(self.password, password)
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/models/credential.py:110:21
    |
108 |             return bcrypt.check_password_hash(self.password, password)
109 |
110 |         # 如果是我们的加密格式，解密后比较
    |                               ^^
111 |         if get_password_manager().is_encrypted(self.password):
112 |             decrypted_password = get_password_manager().decrypt_password(self.password)
    |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/models/credential.py:115:18
    |
113 |             return decrypted_password == password
114 |
115 |         # 如果是明文密码（不安全），直接比较
    |                         ^^
116 |         return self.password == password
    |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/models/credential.py:115:22
    |
113 |             return decrypted_password == password
114 |
115 |         # 如果是明文密码（不安全），直接比较
    |                                 ^^
116 |         return self.password == password
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/models/credential.py:115:23
    |
113 |             return decrypted_password == password
114 |
115 |         # 如果是明文密码（不安全），直接比较
    |                                   ^^
116 |         return self.password == password
    |

PLR2004 Magic value used in comparison, consider replacing `8` with a constant variable
   --> app/models/credential.py:125:33
    |
124 |         """
125 |         if len(self.password) > 8:
    |                                 ^
126 |             return "*" * (len(self.password) - 4) + self.password[-4:]
127 |         return "*" * len(self.password)
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/models/credential.py:130:18
    |
129 |     def get_plain_password(self) -> str:
130 |         """获取原始密码（用于数据库连接）。.
    |                        ^^
131 |
132 |         解密存储的密码并返回明文。对于旧格式的 bcrypt 哈希，
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/models/credential.py:130:26
    |
129 |     def get_plain_password(self) -> str:
130 |         """获取原始密码（用于数据库连接）。.
    |                                        ^^
131 |
132 |         解密存储的密码并返回明文。对于旧格式的 bcrypt 哈希，
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/models/credential.py:132:38
    |
130 |         """获取原始密码（用于数据库连接）。.
131 |
132 |         解密存储的密码并返回明文。对于旧格式的 bcrypt 哈希，
    |                                                           ^^
133 |         尝试从环境变量获取默认密码。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/models/credential.py:136:21
    |
135 |         Returns:
136 |             解密后的原始密码，失败时返回空字符串。
    |                             ^^
137 |
138 |         """
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/models/credential.py:139:24
    |
138 |         """
139 |         # 如果密码是bcrypt哈希，说明是旧格式，需要特殊处理
    |                               ^^
140 |         if self.password.startswith("$2b$"):
141 |             # 对于旧格式，从环境变量获取密码，避免硬编码
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/models/credential.py:139:31
    |
138 |         """
139 |         # 如果密码是bcrypt哈希，说明是旧格式，需要特殊处理
    |                                             ^^
140 |         if self.password.startswith("$2b$"):
141 |             # 对于旧格式，从环境变量获取密码，避免硬编码
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/models/credential.py:141:20
    |
139 |         # 如果密码是bcrypt哈希，说明是旧格式，需要特殊处理
140 |         if self.password.startswith("$2b$"):
141 |             # 对于旧格式，从环境变量获取密码，避免硬编码
    |                         ^^
142 |             import os
143 |             default_password = os.getenv(f"DEFAULT_{self.db_type.upper()}_PASSWORD")
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/models/credential.py:141:30
    |
139 |         # 如果密码是bcrypt哈希，说明是旧格式，需要特殊处理
140 |         if self.password.startswith("$2b$"):
141 |             # 对于旧格式，从环境变量获取密码，避免硬编码
    |                                             ^^
142 |             import os
143 |             default_password = os.getenv(f"DEFAULT_{self.db_type.upper()}_PASSWORD")
    |

PLC0415 `import` should be at the top-level of a file
   --> app/models/credential.py:142:13
    |
140 |         if self.password.startswith("$2b$"):
141 |             # 对于旧格式，从环境变量获取密码，避免硬编码
142 |             import os
    |             ^^^^^^^^^
143 |             default_password = os.getenv(f"DEFAULT_{self.db_type.upper()}_PASSWORD")
144 |             if default_password:
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/models/credential.py:146:25
    |
144 |             if default_password:
145 |                 return default_password
146 |             # 如果没有设置环境变量，返回空字符串并记录警告
    |                                   ^^
147 |             from app.utils.structlog_config import get_system_logger
148 |             system_logger = get_system_logger()
    |

PLC0415 `import` should be at the top-level of a file
   --> app/models/credential.py:147:13
    |
145 |                 return default_password
146 |             # 如果没有设置环境变量，返回空字符串并记录警告
147 |             from app.utils.structlog_config import get_system_logger
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
148 |             system_logger = get_system_logger()
149 |             system_logger.warning(
    |

G004 Logging statement uses f-string
   --> app/models/credential.py:150:17
    |
148 |             system_logger = get_system_logger()
149 |             system_logger.warning(
150 |                 f"未设置环境变量 DEFAULT_{self.db_type.upper()}_PASSWORD，无法获取密码",
    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
151 |                 module="credential_model",
152 |                 db_type=self.db_type,
    |
help: Convert to lazy `%` formatting

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/models/credential.py:150:66
    |
148 |             system_logger = get_system_logger()
149 |             system_logger.warning(
150 |                 f"未设置环境变量 DEFAULT_{self.db_type.upper()}_PASSWORD，无法获取密码",
    |                                                                         ^^
151 |                 module="credential_model",
152 |                 db_type=self.db_type,
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/models/credential.py:156:21
    |
154 |             return ""
155 |
156 |         # 如果是我们的加密格式，尝试解密
    |                               ^^
157 |         if get_password_manager().is_encrypted(self.password):
158 |             return get_password_manager().decrypt_password(self.password)
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/models/credential.py:160:16
    |
158 |             return get_password_manager().decrypt_password(self.password)
159 |
160 |         # 如果都不是，可能是明文密码（不安全）
    |                     ^^
161 |         return self.password
    |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/models/credential.py:160:24
    |
158 |             return get_password_manager().decrypt_password(self.password)
159 |
160 |         # 如果都不是，可能是明文密码（不安全）
    |                                     ^^
161 |         return self.password
    |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/models/credential.py:160:28
    |
158 |             return get_password_manager().decrypt_password(self.password)
159 |
160 |         # 如果都不是，可能是明文密码（不安全）
    |                                             ^^
161 |         return self.password
    |

D205 1 blank line required between summary line and description
 --> app/models/database_size_aggregation.py:1:1
  |
1 | / """数据库大小聚合统计模型
2 | | 存储每周、每月、每季度的统计信息.
3 | | """
  | |___^
4 |
5 |   from sqlalchemy import (
  |
help: Insert single blank line

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:24:18
   |
23 | class DatabaseSizeAggregation(db.Model):
24 |     """数据库大小聚合统计表（分区表）。.
   |                            ^^
25 |
26 |     存储每周、每月、每季度的数据库大小聚合统计信息。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:24:22
   |
23 | class DatabaseSizeAggregation(db.Model):
24 |     """数据库大小聚合统计表（分区表）。.
   |                                    ^^
25 |
26 |     存储每周、每月、每季度的数据库大小聚合统计信息。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/database_size_aggregation.py:27:26
   |
26 |     存储每周、每月、每季度的数据库大小聚合统计信息。
27 |     按 period_start 字段按月分区，支持增量/减量统计。
   |                                 ^^
28 |
29 |     Attributes:
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:30:18
   |
29 |     Attributes:
30 |         id: 主键 ID（BigInteger）。
   |                    ^^
31 |         instance_id: 关联的实例 ID。
32 |         database_name: 数据库名称。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:30:29
   |
29 |     Attributes:
30 |         id: 主键 ID（BigInteger）。
   |                                ^^
31 |         instance_id: 关联的实例 ID。
32 |         database_name: 数据库名称。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:33:28
   |
31 |         instance_id: 关联的实例 ID。
32 |         database_name: 数据库名称。
33 |         period_type: 统计周期类型（weekly/monthly/quarterly）。
   |                                  ^^
34 |         period_start: 统计周期开始日期（用于分区）。
35 |         period_end: 统计周期结束日期。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:33:53
   |
31 |         instance_id: 关联的实例 ID。
32 |         database_name: 数据库名称。
33 |         period_type: 统计周期类型（weekly/monthly/quarterly）。
   |                                                            ^^
34 |         period_start: 统计周期开始日期（用于分区）。
35 |         period_end: 统计周期结束日期。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:34:31
   |
32 |         database_name: 数据库名称。
33 |         period_type: 统计周期类型（weekly/monthly/quarterly）。
34 |         period_start: 统计周期开始日期（用于分区）。
   |                                       ^^
35 |         period_end: 统计周期结束日期。
36 |         avg_size_mb: 平均大小（MB）。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:34:36
   |
32 |         database_name: 数据库名称。
33 |         period_type: 统计周期类型（weekly/monthly/quarterly）。
34 |         period_start: 统计周期开始日期（用于分区）。
   |                                                 ^^
35 |         period_end: 统计周期结束日期。
36 |         avg_size_mb: 平均大小（MB）。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:36:26
   |
34 |         period_start: 统计周期开始日期（用于分区）。
35 |         period_end: 统计周期结束日期。
36 |         avg_size_mb: 平均大小（MB）。
   |                              ^^
37 |         max_size_mb: 最大大小（MB）。
38 |         min_size_mb: 最小大小（MB）。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:36:29
   |
34 |         period_start: 统计周期开始日期（用于分区）。
35 |         period_end: 统计周期结束日期。
36 |         avg_size_mb: 平均大小（MB）。
   |                                  ^^
37 |         max_size_mb: 最大大小（MB）。
38 |         min_size_mb: 最小大小（MB）。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:37:26
   |
35 |         period_end: 统计周期结束日期。
36 |         avg_size_mb: 平均大小（MB）。
37 |         max_size_mb: 最大大小（MB）。
   |                              ^^
38 |         min_size_mb: 最小大小（MB）。
39 |         data_count: 统计的数据点数量。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:37:29
   |
35 |         period_end: 统计周期结束日期。
36 |         avg_size_mb: 平均大小（MB）。
37 |         max_size_mb: 最大大小（MB）。
   |                                  ^^
38 |         min_size_mb: 最小大小（MB）。
39 |         data_count: 统计的数据点数量。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:38:26
   |
36 |         avg_size_mb: 平均大小（MB）。
37 |         max_size_mb: 最大大小（MB）。
38 |         min_size_mb: 最小大小（MB）。
   |                              ^^
39 |         data_count: 统计的数据点数量。
40 |         avg_data_size_mb: 平均数据大小（MB）。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:38:29
   |
36 |         avg_size_mb: 平均大小（MB）。
37 |         max_size_mb: 最大大小（MB）。
38 |         min_size_mb: 最小大小（MB）。
   |                                  ^^
39 |         data_count: 统计的数据点数量。
40 |         avg_data_size_mb: 平均数据大小（MB）。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:40:33
   |
38 |         min_size_mb: 最小大小（MB）。
39 |         data_count: 统计的数据点数量。
40 |         avg_data_size_mb: 平均数据大小（MB）。
   |                                       ^^
41 |         max_data_size_mb: 最大数据大小（MB）。
42 |         min_data_size_mb: 最小数据大小（MB）。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:40:36
   |
38 |         min_size_mb: 最小大小（MB）。
39 |         data_count: 统计的数据点数量。
40 |         avg_data_size_mb: 平均数据大小（MB）。
   |                                           ^^
41 |         max_data_size_mb: 最大数据大小（MB）。
42 |         min_data_size_mb: 最小数据大小（MB）。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:41:33
   |
39 |         data_count: 统计的数据点数量。
40 |         avg_data_size_mb: 平均数据大小（MB）。
41 |         max_data_size_mb: 最大数据大小（MB）。
   |                                       ^^
42 |         min_data_size_mb: 最小数据大小（MB）。
43 |         avg_log_size_mb: 平均日志大小（MB，SQL Server）。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:41:36
   |
39 |         data_count: 统计的数据点数量。
40 |         avg_data_size_mb: 平均数据大小（MB）。
41 |         max_data_size_mb: 最大数据大小（MB）。
   |                                           ^^
42 |         min_data_size_mb: 最小数据大小（MB）。
43 |         avg_log_size_mb: 平均日志大小（MB，SQL Server）。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:42:33
   |
40 |         avg_data_size_mb: 平均数据大小（MB）。
41 |         max_data_size_mb: 最大数据大小（MB）。
42 |         min_data_size_mb: 最小数据大小（MB）。
   |                                       ^^
43 |         avg_log_size_mb: 平均日志大小（MB，SQL Server）。
44 |         max_log_size_mb: 最大日志大小（MB，SQL Server）。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:42:36
   |
40 |         avg_data_size_mb: 平均数据大小（MB）。
41 |         max_data_size_mb: 最大数据大小（MB）。
42 |         min_data_size_mb: 最小数据大小（MB）。
   |                                           ^^
43 |         avg_log_size_mb: 平均日志大小（MB，SQL Server）。
44 |         max_log_size_mb: 最大日志大小（MB，SQL Server）。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:43:32
   |
41 |         max_data_size_mb: 最大数据大小（MB）。
42 |         min_data_size_mb: 最小数据大小（MB）。
43 |         avg_log_size_mb: 平均日志大小（MB，SQL Server）。
   |                                      ^^
44 |         max_log_size_mb: 最大日志大小（MB，SQL Server）。
45 |         min_log_size_mb: 最小日志大小（MB，SQL Server）。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/database_size_aggregation.py:43:35
   |
41 |         max_data_size_mb: 最大数据大小（MB）。
42 |         min_data_size_mb: 最小数据大小（MB）。
43 |         avg_log_size_mb: 平均日志大小（MB，SQL Server）。
   |                                          ^^
44 |         max_log_size_mb: 最大日志大小（MB，SQL Server）。
45 |         min_log_size_mb: 最小日志大小（MB，SQL Server）。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:43:46
   |
41 |         max_data_size_mb: 最大数据大小（MB）。
42 |         min_data_size_mb: 最小数据大小（MB）。
43 |         avg_log_size_mb: 平均日志大小（MB，SQL Server）。
   |                                                      ^^
44 |         max_log_size_mb: 最大日志大小（MB，SQL Server）。
45 |         min_log_size_mb: 最小日志大小（MB，SQL Server）。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:44:32
   |
42 |         min_data_size_mb: 最小数据大小（MB）。
43 |         avg_log_size_mb: 平均日志大小（MB，SQL Server）。
44 |         max_log_size_mb: 最大日志大小（MB，SQL Server）。
   |                                      ^^
45 |         min_log_size_mb: 最小日志大小（MB，SQL Server）。
46 |         size_change_mb: 总大小变化量（MB，可为负值）。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/database_size_aggregation.py:44:35
   |
42 |         min_data_size_mb: 最小数据大小（MB）。
43 |         avg_log_size_mb: 平均日志大小（MB，SQL Server）。
44 |         max_log_size_mb: 最大日志大小（MB，SQL Server）。
   |                                          ^^
45 |         min_log_size_mb: 最小日志大小（MB，SQL Server）。
46 |         size_change_mb: 总大小变化量（MB，可为负值）。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:44:46
   |
42 |         min_data_size_mb: 最小数据大小（MB）。
43 |         avg_log_size_mb: 平均日志大小（MB，SQL Server）。
44 |         max_log_size_mb: 最大日志大小（MB，SQL Server）。
   |                                                      ^^
45 |         min_log_size_mb: 最小日志大小（MB，SQL Server）。
46 |         size_change_mb: 总大小变化量（MB，可为负值）。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:45:32
   |
43 |         avg_log_size_mb: 平均日志大小（MB，SQL Server）。
44 |         max_log_size_mb: 最大日志大小（MB，SQL Server）。
45 |         min_log_size_mb: 最小日志大小（MB，SQL Server）。
   |                                      ^^
46 |         size_change_mb: 总大小变化量（MB，可为负值）。
47 |         size_change_percent: 总大小变化百分比（%，可为负值）。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/database_size_aggregation.py:45:35
   |
43 |         avg_log_size_mb: 平均日志大小（MB，SQL Server）。
44 |         max_log_size_mb: 最大日志大小（MB，SQL Server）。
45 |         min_log_size_mb: 最小日志大小（MB，SQL Server）。
   |                                          ^^
46 |         size_change_mb: 总大小变化量（MB，可为负值）。
47 |         size_change_percent: 总大小变化百分比（%，可为负值）。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:45:46
   |
43 |         avg_log_size_mb: 平均日志大小（MB，SQL Server）。
44 |         max_log_size_mb: 最大日志大小（MB，SQL Server）。
45 |         min_log_size_mb: 最小日志大小（MB，SQL Server）。
   |                                                      ^^
46 |         size_change_mb: 总大小变化量（MB，可为负值）。
47 |         size_change_percent: 总大小变化百分比（%，可为负值）。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:46:31
   |
44 |         max_log_size_mb: 最大日志大小（MB，SQL Server）。
45 |         min_log_size_mb: 最小日志大小（MB，SQL Server）。
46 |         size_change_mb: 总大小变化量（MB，可为负值）。
   |                                     ^^
47 |         size_change_percent: 总大小变化百分比（%，可为负值）。
48 |         data_size_change_mb: 数据大小变化量（MB，可为负值）。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/database_size_aggregation.py:46:34
   |
44 |         max_log_size_mb: 最大日志大小（MB，SQL Server）。
45 |         min_log_size_mb: 最小日志大小（MB，SQL Server）。
46 |         size_change_mb: 总大小变化量（MB，可为负值）。
   |                                         ^^
47 |         size_change_percent: 总大小变化百分比（%，可为负值）。
48 |         data_size_change_mb: 数据大小变化量（MB，可为负值）。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:46:39
   |
44 |         max_log_size_mb: 最大日志大小（MB，SQL Server）。
45 |         min_log_size_mb: 最小日志大小（MB，SQL Server）。
46 |         size_change_mb: 总大小变化量（MB，可为负值）。
   |                                                   ^^
47 |         size_change_percent: 总大小变化百分比（%，可为负值）。
48 |         data_size_change_mb: 数据大小变化量（MB，可为负值）。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:47:38
   |
45 |         min_log_size_mb: 最小日志大小（MB，SQL Server）。
46 |         size_change_mb: 总大小变化量（MB，可为负值）。
47 |         size_change_percent: 总大小变化百分比（%，可为负值）。
   |                                              ^^
48 |         data_size_change_mb: 数据大小变化量（MB，可为负值）。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/database_size_aggregation.py:47:40
   |
45 |         min_log_size_mb: 最小日志大小（MB，SQL Server）。
46 |         size_change_mb: 总大小变化量（MB，可为负值）。
47 |         size_change_percent: 总大小变化百分比（%，可为负值）。
   |                                                 ^^
48 |         data_size_change_mb: 数据大小变化量（MB，可为负值）。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:47:45
   |
45 |         min_log_size_mb: 最小日志大小（MB，SQL Server）。
46 |         size_change_mb: 总大小变化量（MB，可为负值）。
47 |         size_change_percent: 总大小变化百分比（%，可为负值）。
   |                                                           ^^
48 |         data_size_change_mb: 数据大小变化量（MB，可为负值）。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:48:37
   |
46 |         size_change_mb: 总大小变化量（MB，可为负值）。
47 |         size_change_percent: 总大小变化百分比（%，可为负值）。
48 |         data_size_change_mb: 数据大小变化量（MB，可为负值）。
   |                                            ^^
49 |
50 |     """
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/database_size_aggregation.py:48:40
   |
46 |         size_change_mb: 总大小变化量（MB，可为负值）。
47 |         size_change_percent: 总大小变化百分比（%，可为负值）。
48 |         data_size_change_mb: 数据大小变化量（MB，可为负值）。
   |                                                ^^
49 |
50 |     """
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:48:45
   |
46 |         size_change_mb: 总大小变化量（MB，可为负值）。
47 |         size_change_percent: 总大小变化百分比（%，可为负值）。
48 |         data_size_change_mb: 数据大小变化量（MB，可为负值）。
   |                                                          ^^
49 |
50 |     """
   |

RUF001 String contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/models/database_size_aggregation.py:59:69
   |
58 |     # 统计周期
59 |     period_type = Column(String(20), nullable=False, comment="统计周期类型：weekly, monthly, quarterly")
   |                                                                           ^^
60 |     period_start = Column(Date, nullable=False, comment="统计周期开始日期（用于分区）")
61 |     period_end = Column(Date, nullable=False, comment="统计周期结束日期")
   |

RUF001 String contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:60:66
   |
58 |     # 统计周期
59 |     period_type = Column(String(20), nullable=False, comment="统计周期类型：weekly, monthly, quarterly")
60 |     period_start = Column(Date, nullable=False, comment="统计周期开始日期（用于分区）")
   |                                                                          ^^
61 |     period_end = Column(Date, nullable=False, comment="统计周期结束日期")
   |

RUF001 String contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:60:71
   |
58 |     # 统计周期
59 |     period_type = Column(String(20), nullable=False, comment="统计周期类型：weekly, monthly, quarterly")
60 |     period_start = Column(Date, nullable=False, comment="统计周期开始日期（用于分区）")
   |                                                                                    ^^
61 |     period_end = Column(Date, nullable=False, comment="统计周期结束日期")
   |

RUF001 String contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:64:67
   |
63 |     # 统计指标
64 |     avg_size_mb = Column(BigInteger, nullable=False, comment="平均大小（MB）")
   |                                                                       ^^
65 |     max_size_mb = Column(BigInteger, nullable=False, comment="最大大小（MB）")
66 |     min_size_mb = Column(BigInteger, nullable=False, comment="最小大小（MB）")
   |

RUF001 String contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:64:70
   |
63 |     # 统计指标
64 |     avg_size_mb = Column(BigInteger, nullable=False, comment="平均大小（MB）")
   |                                                                           ^^
65 |     max_size_mb = Column(BigInteger, nullable=False, comment="最大大小（MB）")
66 |     min_size_mb = Column(BigInteger, nullable=False, comment="最小大小（MB）")
   |

RUF001 String contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:65:67
   |
63 |     # 统计指标
64 |     avg_size_mb = Column(BigInteger, nullable=False, comment="平均大小（MB）")
65 |     max_size_mb = Column(BigInteger, nullable=False, comment="最大大小（MB）")
   |                                                                       ^^
66 |     min_size_mb = Column(BigInteger, nullable=False, comment="最小大小（MB）")
67 |     data_count = Column(Integer, nullable=False, comment="统计的数据点数量")
   |

RUF001 String contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:65:70
   |
63 |     # 统计指标
64 |     avg_size_mb = Column(BigInteger, nullable=False, comment="平均大小（MB）")
65 |     max_size_mb = Column(BigInteger, nullable=False, comment="最大大小（MB）")
   |                                                                           ^^
66 |     min_size_mb = Column(BigInteger, nullable=False, comment="最小大小（MB）")
67 |     data_count = Column(Integer, nullable=False, comment="统计的数据点数量")
   |

RUF001 String contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:66:67
   |
64 |     avg_size_mb = Column(BigInteger, nullable=False, comment="平均大小（MB）")
65 |     max_size_mb = Column(BigInteger, nullable=False, comment="最大大小（MB）")
66 |     min_size_mb = Column(BigInteger, nullable=False, comment="最小大小（MB）")
   |                                                                       ^^
67 |     data_count = Column(Integer, nullable=False, comment="统计的数据点数量")
   |

RUF001 String contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:66:70
   |
64 |     avg_size_mb = Column(BigInteger, nullable=False, comment="平均大小（MB）")
65 |     max_size_mb = Column(BigInteger, nullable=False, comment="最大大小（MB）")
66 |     min_size_mb = Column(BigInteger, nullable=False, comment="最小大小（MB）")
   |                                                                           ^^
67 |     data_count = Column(Integer, nullable=False, comment="统计的数据点数量")
   |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:69:13
   |
67 |     data_count = Column(Integer, nullable=False, comment="统计的数据点数量")
68 |
69 |     # 数据大小统计（如果可获取）
   |                   ^^
70 |     avg_data_size_mb = Column(BigInteger, nullable=True, comment="平均数据大小（MB）")
71 |     max_data_size_mb = Column(BigInteger, nullable=True, comment="最大数据大小（MB）")
   |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:69:19
   |
67 |     data_count = Column(Integer, nullable=False, comment="统计的数据点数量")
68 |
69 |     # 数据大小统计（如果可获取）
   |                               ^^
70 |     avg_data_size_mb = Column(BigInteger, nullable=True, comment="平均数据大小（MB）")
71 |     max_data_size_mb = Column(BigInteger, nullable=True, comment="最大数据大小（MB）")
   |

RUF001 String contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:70:73
   |
69 |     # 数据大小统计（如果可获取）
70 |     avg_data_size_mb = Column(BigInteger, nullable=True, comment="平均数据大小（MB）")
   |                                                                               ^^
71 |     max_data_size_mb = Column(BigInteger, nullable=True, comment="最大数据大小（MB）")
72 |     min_data_size_mb = Column(BigInteger, nullable=True, comment="最小数据大小（MB）")
   |

RUF001 String contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:70:76
   |
69 |     # 数据大小统计（如果可获取）
70 |     avg_data_size_mb = Column(BigInteger, nullable=True, comment="平均数据大小（MB）")
   |                                                                                   ^^
71 |     max_data_size_mb = Column(BigInteger, nullable=True, comment="最大数据大小（MB）")
72 |     min_data_size_mb = Column(BigInteger, nullable=True, comment="最小数据大小（MB）")
   |

RUF001 String contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:71:73
   |
69 |     # 数据大小统计（如果可获取）
70 |     avg_data_size_mb = Column(BigInteger, nullable=True, comment="平均数据大小（MB）")
71 |     max_data_size_mb = Column(BigInteger, nullable=True, comment="最大数据大小（MB）")
   |                                                                               ^^
72 |     min_data_size_mb = Column(BigInteger, nullable=True, comment="最小数据大小（MB）")
   |

RUF001 String contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:71:76
   |
69 |     # 数据大小统计（如果可获取）
70 |     avg_data_size_mb = Column(BigInteger, nullable=True, comment="平均数据大小（MB）")
71 |     max_data_size_mb = Column(BigInteger, nullable=True, comment="最大数据大小（MB）")
   |                                                                                   ^^
72 |     min_data_size_mb = Column(BigInteger, nullable=True, comment="最小数据大小（MB）")
   |

RUF001 String contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:72:73
   |
70 |     avg_data_size_mb = Column(BigInteger, nullable=True, comment="平均数据大小（MB）")
71 |     max_data_size_mb = Column(BigInteger, nullable=True, comment="最大数据大小（MB）")
72 |     min_data_size_mb = Column(BigInteger, nullable=True, comment="最小数据大小（MB）")
   |                                                                               ^^
73 |
74 |     # 日志大小统计（SQL Server）
   |

RUF001 String contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:72:76
   |
70 |     avg_data_size_mb = Column(BigInteger, nullable=True, comment="平均数据大小（MB）")
71 |     max_data_size_mb = Column(BigInteger, nullable=True, comment="最大数据大小（MB）")
72 |     min_data_size_mb = Column(BigInteger, nullable=True, comment="最小数据大小（MB）")
   |                                                                                   ^^
73 |
74 |     # 日志大小统计（SQL Server）
   |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:74:13
   |
72 |     min_data_size_mb = Column(BigInteger, nullable=True, comment="最小数据大小（MB）")
73 |
74 |     # 日志大小统计（SQL Server）
   |                   ^^
75 |     avg_log_size_mb = Column(BigInteger, nullable=True, comment="平均日志大小（MB）")
76 |     max_log_size_mb = Column(BigInteger, nullable=True, comment="最大日志大小（MB）")
   |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:74:24
   |
72 |     min_data_size_mb = Column(BigInteger, nullable=True, comment="最小数据大小（MB）")
73 |
74 |     # 日志大小统计（SQL Server）
   |                               ^^
75 |     avg_log_size_mb = Column(BigInteger, nullable=True, comment="平均日志大小（MB）")
76 |     max_log_size_mb = Column(BigInteger, nullable=True, comment="最大日志大小（MB）")
   |

RUF001 String contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:75:72
   |
74 |     # 日志大小统计（SQL Server）
75 |     avg_log_size_mb = Column(BigInteger, nullable=True, comment="平均日志大小（MB）")
   |                                                                              ^^
76 |     max_log_size_mb = Column(BigInteger, nullable=True, comment="最大日志大小（MB）")
77 |     min_log_size_mb = Column(BigInteger, nullable=True, comment="最小日志大小（MB）")
   |

RUF001 String contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:75:75
   |
74 |     # 日志大小统计（SQL Server）
75 |     avg_log_size_mb = Column(BigInteger, nullable=True, comment="平均日志大小（MB）")
   |                                                                                  ^^
76 |     max_log_size_mb = Column(BigInteger, nullable=True, comment="最大日志大小（MB）")
77 |     min_log_size_mb = Column(BigInteger, nullable=True, comment="最小日志大小（MB）")
   |

RUF001 String contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:76:72
   |
74 |     # 日志大小统计（SQL Server）
75 |     avg_log_size_mb = Column(BigInteger, nullable=True, comment="平均日志大小（MB）")
76 |     max_log_size_mb = Column(BigInteger, nullable=True, comment="最大日志大小（MB）")
   |                                                                              ^^
77 |     min_log_size_mb = Column(BigInteger, nullable=True, comment="最小日志大小（MB）")
   |

RUF001 String contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:76:75
   |
74 |     # 日志大小统计（SQL Server）
75 |     avg_log_size_mb = Column(BigInteger, nullable=True, comment="平均日志大小（MB）")
76 |     max_log_size_mb = Column(BigInteger, nullable=True, comment="最大日志大小（MB）")
   |                                                                                  ^^
77 |     min_log_size_mb = Column(BigInteger, nullable=True, comment="最小日志大小（MB）")
   |

RUF001 String contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:77:72
   |
75 |     avg_log_size_mb = Column(BigInteger, nullable=True, comment="平均日志大小（MB）")
76 |     max_log_size_mb = Column(BigInteger, nullable=True, comment="最大日志大小（MB）")
77 |     min_log_size_mb = Column(BigInteger, nullable=True, comment="最小日志大小（MB）")
   |                                                                              ^^
78 |
79 |     # 增量/减量统计字段
   |

RUF001 String contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:77:75
   |
75 |     avg_log_size_mb = Column(BigInteger, nullable=True, comment="平均日志大小（MB）")
76 |     max_log_size_mb = Column(BigInteger, nullable=True, comment="最大日志大小（MB）")
77 |     min_log_size_mb = Column(BigInteger, nullable=True, comment="最小日志大小（MB）")
   |                                                                                  ^^
78 |
79 |     # 增量/减量统计字段
   |

RUF001 String contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:80:83
   |
79 |     # 增量/减量统计字段
80 |     size_change_mb = Column(BigInteger, nullable=False, default=0, comment="总大小变化量（MB，可为负值）")
   |                                                                                         ^^
81 |     size_change_percent = Column(Numeric(10, 2), nullable=False, default=0, comment="总大小变化百分比（%，可为负值）")
82 |     data_size_change_mb = Column(BigInteger, nullable=True, comment="数据大小变化量（MB，可为负值）")
   |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/database_size_aggregation.py:80:86
   |
79 |     # 增量/减量统计字段
80 |     size_change_mb = Column(BigInteger, nullable=False, default=0, comment="总大小变化量（MB，可为负值）")
   |                                                                                             ^^
81 |     size_change_percent = Column(Numeric(10, 2), nullable=False, default=0, comment="总大小变化百分比（%，可为负值）")
82 |     data_size_change_mb = Column(BigInteger, nullable=True, comment="数据大小变化量（MB，可为负值）")
   |

RUF001 String contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:80:91
   |
79 |     # 增量/减量统计字段
80 |     size_change_mb = Column(BigInteger, nullable=False, default=0, comment="总大小变化量（MB，可为负值）")
   |                                                                                                       ^^
81 |     size_change_percent = Column(Numeric(10, 2), nullable=False, default=0, comment="总大小变化百分比（%，可为负值）")
82 |     data_size_change_mb = Column(BigInteger, nullable=True, comment="数据大小变化量（MB，可为负值）")
   |

RUF001 String contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:81:94
   |
79 |     # 增量/减量统计字段
80 |     size_change_mb = Column(BigInteger, nullable=False, default=0, comment="总大小变化量（MB，可为负值）")
81 |     size_change_percent = Column(Numeric(10, 2), nullable=False, default=0, comment="总大小变化百分比（%，可为负值）")
   |                                                                                                      ^^
82 |     data_size_change_mb = Column(BigInteger, nullable=True, comment="数据大小变化量（MB，可为负值）")
83 |     data_size_change_percent = Column(Numeric(10, 2), nullable=True, comment="数据大小变化百分比（%，可为负值）")
   |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/database_size_aggregation.py:81:96
   |
79 |     # 增量/减量统计字段
80 |     size_change_mb = Column(BigInteger, nullable=False, default=0, comment="总大小变化量（MB，可为负值）")
81 |     size_change_percent = Column(Numeric(10, 2), nullable=False, default=0, comment="总大小变化百分比（%，可为负值）")
   |                                                                                                         ^^
82 |     data_size_change_mb = Column(BigInteger, nullable=True, comment="数据大小变化量（MB，可为负值）")
83 |     data_size_change_percent = Column(Numeric(10, 2), nullable=True, comment="数据大小变化百分比（%，可为负值）")
   |

RUF001 String contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:81:101
   |
79 |     # 增量/减量统计字段
80 |     size_change_mb = Column(BigInteger, nullable=False, default=0, comment="总大小变化量（MB，可为负值）")
81 |     size_change_percent = Column(Numeric(10, 2), nullable=False, default=0, comment="总大小变化百分比（%，可为负值）")
   |                                                                                                                   ^^
82 |     data_size_change_mb = Column(BigInteger, nullable=True, comment="数据大小变化量（MB，可为负值）")
83 |     data_size_change_percent = Column(Numeric(10, 2), nullable=True, comment="数据大小变化百分比（%，可为负值）")
   |

RUF001 String contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:82:77
   |
80 |     size_change_mb = Column(BigInteger, nullable=False, default=0, comment="总大小变化量（MB，可为负值）")
81 |     size_change_percent = Column(Numeric(10, 2), nullable=False, default=0, comment="总大小变化百分比（%，可为负值）")
82 |     data_size_change_mb = Column(BigInteger, nullable=True, comment="数据大小变化量（MB，可为负值）")
   |                                                                                    ^^
83 |     data_size_change_percent = Column(Numeric(10, 2), nullable=True, comment="数据大小变化百分比（%，可为负值）")
84 |     log_size_change_mb = Column(BigInteger, nullable=True, comment="日志大小变化量（MB，可为负值）")
   |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/database_size_aggregation.py:82:80
   |
80 |     size_change_mb = Column(BigInteger, nullable=False, default=0, comment="总大小变化量（MB，可为负值）")
81 |     size_change_percent = Column(Numeric(10, 2), nullable=False, default=0, comment="总大小变化百分比（%，可为负值）")
82 |     data_size_change_mb = Column(BigInteger, nullable=True, comment="数据大小变化量（MB，可为负值）")
   |                                                                                        ^^
83 |     data_size_change_percent = Column(Numeric(10, 2), nullable=True, comment="数据大小变化百分比（%，可为负值）")
84 |     log_size_change_mb = Column(BigInteger, nullable=True, comment="日志大小变化量（MB，可为负值）")
   |

RUF001 String contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:82:85
   |
80 |     size_change_mb = Column(BigInteger, nullable=False, default=0, comment="总大小变化量（MB，可为负值）")
81 |     size_change_percent = Column(Numeric(10, 2), nullable=False, default=0, comment="总大小变化百分比（%，可为负值）")
82 |     data_size_change_mb = Column(BigInteger, nullable=True, comment="数据大小变化量（MB，可为负值）")
   |                                                                                                  ^^
83 |     data_size_change_percent = Column(Numeric(10, 2), nullable=True, comment="数据大小变化百分比（%，可为负值）")
84 |     log_size_change_mb = Column(BigInteger, nullable=True, comment="日志大小变化量（MB，可为负值）")
   |

RUF001 String contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:83:88
   |
81 |     size_change_percent = Column(Numeric(10, 2), nullable=False, default=0, comment="总大小变化百分比（%，可为负值）")
82 |     data_size_change_mb = Column(BigInteger, nullable=True, comment="数据大小变化量（MB，可为负值）")
83 |     data_size_change_percent = Column(Numeric(10, 2), nullable=True, comment="数据大小变化百分比（%，可为负值）")
   |                                                                                                 ^^
84 |     log_size_change_mb = Column(BigInteger, nullable=True, comment="日志大小变化量（MB，可为负值）")
85 |     log_size_change_percent = Column(Numeric(10, 2), nullable=True, comment="日志大小变化百分比（%，可为负值）")
   |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/database_size_aggregation.py:83:90
   |
81 |     size_change_percent = Column(Numeric(10, 2), nullable=False, default=0, comment="总大小变化百分比（%，可为负值）")
82 |     data_size_change_mb = Column(BigInteger, nullable=True, comment="数据大小变化量（MB，可为负值）")
83 |     data_size_change_percent = Column(Numeric(10, 2), nullable=True, comment="数据大小变化百分比（%，可为负值）")
   |                                                                                                    ^^
84 |     log_size_change_mb = Column(BigInteger, nullable=True, comment="日志大小变化量（MB，可为负值）")
85 |     log_size_change_percent = Column(Numeric(10, 2), nullable=True, comment="日志大小变化百分比（%，可为负值）")
   |

RUF001 String contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:83:95
   |
81 |     size_change_percent = Column(Numeric(10, 2), nullable=False, default=0, comment="总大小变化百分比（%，可为负值）")
82 |     data_size_change_mb = Column(BigInteger, nullable=True, comment="数据大小变化量（MB，可为负值）")
83 |     data_size_change_percent = Column(Numeric(10, 2), nullable=True, comment="数据大小变化百分比（%，可为负值）")
   |                                                                                                              ^^
84 |     log_size_change_mb = Column(BigInteger, nullable=True, comment="日志大小变化量（MB，可为负值）")
85 |     log_size_change_percent = Column(Numeric(10, 2), nullable=True, comment="日志大小变化百分比（%，可为负值）")
   |

RUF001 String contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:84:76
   |
82 |     data_size_change_mb = Column(BigInteger, nullable=True, comment="数据大小变化量（MB，可为负值）")
83 |     data_size_change_percent = Column(Numeric(10, 2), nullable=True, comment="数据大小变化百分比（%，可为负值）")
84 |     log_size_change_mb = Column(BigInteger, nullable=True, comment="日志大小变化量（MB，可为负值）")
   |                                                                                   ^^
85 |     log_size_change_percent = Column(Numeric(10, 2), nullable=True, comment="日志大小变化百分比（%，可为负值）")
   |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/database_size_aggregation.py:84:79
   |
82 |     data_size_change_mb = Column(BigInteger, nullable=True, comment="数据大小变化量（MB，可为负值）")
83 |     data_size_change_percent = Column(Numeric(10, 2), nullable=True, comment="数据大小变化百分比（%，可为负值）")
84 |     log_size_change_mb = Column(BigInteger, nullable=True, comment="日志大小变化量（MB，可为负值）")
   |                                                                                       ^^
85 |     log_size_change_percent = Column(Numeric(10, 2), nullable=True, comment="日志大小变化百分比（%，可为负值）")
   |

RUF001 String contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:84:84
   |
82 |     data_size_change_mb = Column(BigInteger, nullable=True, comment="数据大小变化量（MB，可为负值）")
83 |     data_size_change_percent = Column(Numeric(10, 2), nullable=True, comment="数据大小变化百分比（%，可为负值）")
84 |     log_size_change_mb = Column(BigInteger, nullable=True, comment="日志大小变化量（MB，可为负值）")
   |                                                                                                 ^^
85 |     log_size_change_percent = Column(Numeric(10, 2), nullable=True, comment="日志大小变化百分比（%，可为负值）")
   |

RUF001 String contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:85:87
   |
83 |     data_size_change_percent = Column(Numeric(10, 2), nullable=True, comment="数据大小变化百分比（%，可为负值）")
84 |     log_size_change_mb = Column(BigInteger, nullable=True, comment="日志大小变化量（MB，可为负值）")
85 |     log_size_change_percent = Column(Numeric(10, 2), nullable=True, comment="日志大小变化百分比（%，可为负值）")
   |                                                                                                ^^
86 |
87 |     # 增长率字段
   |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/database_size_aggregation.py:85:89
   |
83 |     data_size_change_percent = Column(Numeric(10, 2), nullable=True, comment="数据大小变化百分比（%，可为负值）")
84 |     log_size_change_mb = Column(BigInteger, nullable=True, comment="日志大小变化量（MB，可为负值）")
85 |     log_size_change_percent = Column(Numeric(10, 2), nullable=True, comment="日志大小变化百分比（%，可为负值）")
   |                                                                                                   ^^
86 |
87 |     # 增长率字段
   |

RUF001 String contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:85:94
   |
83 |     data_size_change_percent = Column(Numeric(10, 2), nullable=True, comment="数据大小变化百分比（%，可为负值）")
84 |     log_size_change_mb = Column(BigInteger, nullable=True, comment="日志大小变化量（MB，可为负值）")
85 |     log_size_change_percent = Column(Numeric(10, 2), nullable=True, comment="日志大小变化百分比（%，可为负值）")
   |                                                                                                             ^^
86 |
87 |     # 增长率字段
   |

RUF001 String contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:88:81
   |
87 |     # 增长率字段
88 |     growth_rate = Column(Numeric(10, 2), nullable=False, default=0, comment="增长率（%，可为负值）")
   |                                                                                    ^^
89 |
90 |     # 时间字段
   |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/database_size_aggregation.py:88:83
   |
87 |     # 增长率字段
88 |     growth_rate = Column(Numeric(10, 2), nullable=False, default=0, comment="增长率（%，可为负值）")
   |                                                                                       ^^
89 |
90 |     # 时间字段
   |

RUF001 String contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/database_size_aggregation.py:88:88
   |
87 |     # 增长率字段
88 |     growth_rate = Column(Numeric(10, 2), nullable=False, default=0, comment="增长率（%，可为负值）")
   |                                                                                                 ^^
89 |
90 |     # 时间字段
   |

RUF003 Comment contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/models/database_size_aggregation.py:98:13
    |
 96 |     __table_args__ = (
 97 |         # 分区表约束 - 主键必须包含分区键
 98 |         # 注意：在分区表中，主键约束会自动包含分区键
    |               ^^
 99 |         # 查询优化索引
100 |         Index(
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/models/database_size_aggregation.py:98:19
    |
 96 |     __table_args__ = (
 97 |         # 分区表约束 - 主键必须包含分区键
 98 |         # 注意：在分区表中，主键约束会自动包含分区键
    |                           ^^
 99 |         # 查询优化索引
100 |         Index(
    |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/models/database_size_aggregation.py:111:15
    |
109 |             "period_start",
110 |         ),
111 |         # 唯一约束（在分区表中，唯一约束会自动包含分区键）
    |                   ^^
112 |         UniqueConstraint(
113 |             "instance_id",
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/models/database_size_aggregation.py:111:21
    |
109 |             "period_start",
110 |         ),
111 |         # 唯一约束（在分区表中，唯一约束会自动包含分区键）
    |                               ^^
112 |         UniqueConstraint(
113 |             "instance_id",
    |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/models/database_size_aggregation.py:111:34
    |
109 |             "period_start",
110 |         ),
111 |         # 唯一约束（在分区表中，唯一约束会自动包含分区键）
    |                                                         ^^
112 |         UniqueConstraint(
113 |             "instance_id",
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/models/database_size_aggregation.py:136:41
    |
134 |         """序列化聚合记录。.
135 |
136 |         将日期与 Decimal 等字段转换为 JSON 友好的基础类型，便于响应体或日志输出。
    |                                                          ^^
137 |
138 |         Returns:
    |

D205 1 blank line required between summary line and description
 --> app/models/database_size_stat.py:1:1
  |
1 | / """数据库大小统计模型
2 | | 存储每个数据库在特定时间点的大小统计信息
3 | | 支持 PostgreSQL 分区表，按日期分区.
4 | | """
  | |___^
5 |
6 |   from sqlalchemy import (
  |
help: Insert single blank line

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/models/database_size_stat.py:3:18
  |
1 | """数据库大小统计模型
2 | 存储每个数据库在特定时间点的大小统计信息
3 | 支持 PostgreSQL 分区表，按日期分区.
  |                       ^^
4 | """
  |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/database_size_stat.py:27:22
   |
26 |     存储每个数据库在特定时间点的大小统计信息。
27 |     支持 PostgreSQL 分区表，按日期（collected_date）分区。
   |                           ^^
28 |
29 |     Attributes:
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/database_size_stat.py:27:26
   |
26 |     存储每个数据库在特定时间点的大小统计信息。
27 |     支持 PostgreSQL 分区表，按日期（collected_date）分区。
   |                                   ^^
28 |
29 |     Attributes:
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/database_size_stat.py:27:41
   |
26 |     存储每个数据库在特定时间点的大小统计信息。
27 |     支持 PostgreSQL 分区表，按日期（collected_date）分区。
   |                                                   ^^
28 |
29 |     Attributes:
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/database_size_stat.py:30:18
   |
29 |     Attributes:
30 |         id: 主键 ID（BigInteger）。
   |                    ^^
31 |         instance_id: 关联的实例 ID。
32 |         database_name: 数据库名称。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/database_size_stat.py:30:29
   |
29 |     Attributes:
30 |         id: 主键 ID（BigInteger）。
   |                                ^^
31 |         instance_id: 关联的实例 ID。
32 |         database_name: 数据库名称。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/database_size_stat.py:33:24
   |
31 |         instance_id: 关联的实例 ID。
32 |         database_name: 数据库名称。
33 |         size_mb: 数据库总大小（MB）。
   |                              ^^
34 |         data_size_mb: 数据部分大小（MB，如果可获取）。
35 |         log_size_mb: 日志部分大小（MB，SQL Server 特有）。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/database_size_stat.py:33:27
   |
31 |         instance_id: 关联的实例 ID。
32 |         database_name: 数据库名称。
33 |         size_mb: 数据库总大小（MB）。
   |                                  ^^
34 |         data_size_mb: 数据部分大小（MB，如果可获取）。
35 |         log_size_mb: 日志部分大小（MB，SQL Server 特有）。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/database_size_stat.py:34:29
   |
32 |         database_name: 数据库名称。
33 |         size_mb: 数据库总大小（MB）。
34 |         data_size_mb: 数据部分大小（MB，如果可获取）。
   |                                   ^^
35 |         log_size_mb: 日志部分大小（MB，SQL Server 特有）。
36 |         collected_date: 采集日期（用于分区）。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/database_size_stat.py:34:32
   |
32 |         database_name: 数据库名称。
33 |         size_mb: 数据库总大小（MB）。
34 |         data_size_mb: 数据部分大小（MB，如果可获取）。
   |                                       ^^
35 |         log_size_mb: 日志部分大小（MB，SQL Server 特有）。
36 |         collected_date: 采集日期（用于分区）。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/database_size_stat.py:34:38
   |
32 |         database_name: 数据库名称。
33 |         size_mb: 数据库总大小（MB）。
34 |         data_size_mb: 数据部分大小（MB，如果可获取）。
   |                                                   ^^
35 |         log_size_mb: 日志部分大小（MB，SQL Server 特有）。
36 |         collected_date: 采集日期（用于分区）。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/database_size_stat.py:35:28
   |
33 |         size_mb: 数据库总大小（MB）。
34 |         data_size_mb: 数据部分大小（MB，如果可获取）。
35 |         log_size_mb: 日志部分大小（MB，SQL Server 特有）。
   |                                  ^^
36 |         collected_date: 采集日期（用于分区）。
37 |         collected_at: 采集时间戳。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/database_size_stat.py:35:31
   |
33 |         size_mb: 数据库总大小（MB）。
34 |         data_size_mb: 数据部分大小（MB，如果可获取）。
35 |         log_size_mb: 日志部分大小（MB，SQL Server 特有）。
   |                                      ^^
36 |         collected_date: 采集日期（用于分区）。
37 |         collected_at: 采集时间戳。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/database_size_stat.py:35:45
   |
33 |         size_mb: 数据库总大小（MB）。
34 |         data_size_mb: 数据部分大小（MB，如果可获取）。
35 |         log_size_mb: 日志部分大小（MB，SQL Server 特有）。
   |                                                       ^^
36 |         collected_date: 采集日期（用于分区）。
37 |         collected_at: 采集时间戳。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/database_size_stat.py:36:29
   |
34 |         data_size_mb: 数据部分大小（MB，如果可获取）。
35 |         log_size_mb: 日志部分大小（MB，SQL Server 特有）。
36 |         collected_date: 采集日期（用于分区）。
   |                                 ^^
37 |         collected_at: 采集时间戳。
38 |         created_at: 记录创建时间。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/database_size_stat.py:36:34
   |
34 |         data_size_mb: 数据部分大小（MB，如果可获取）。
35 |         log_size_mb: 日志部分大小（MB，SQL Server 特有）。
36 |         collected_date: 采集日期（用于分区）。
   |                                           ^^
37 |         collected_at: 采集时间戳。
38 |         created_at: 记录创建时间。
   |

RUF001 String contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/database_size_stat.py:49:65
   |
47 |     instance_id = Column(Integer, ForeignKey("instances.id"), nullable=False)
48 |     database_name = Column(String(255), nullable=False, comment="数据库名称")
49 |     size_mb = Column(BigInteger, nullable=False, comment="数据库总大小（MB）")
   |                                                                       ^^
50 |     data_size_mb = Column(
51 |         BigInteger, nullable=True, comment="数据部分大小（MB），如果可获取",
   |

RUF001 String contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/database_size_stat.py:49:68
   |
47 |     instance_id = Column(Integer, ForeignKey("instances.id"), nullable=False)
48 |     database_name = Column(String(255), nullable=False, comment="数据库名称")
49 |     size_mb = Column(BigInteger, nullable=False, comment="数据库总大小（MB）")
   |                                                                           ^^
50 |     data_size_mb = Column(
51 |         BigInteger, nullable=True, comment="数据部分大小（MB），如果可获取",
   |

RUF001 String contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/database_size_stat.py:51:51
   |
49 |     size_mb = Column(BigInteger, nullable=False, comment="数据库总大小（MB）")
50 |     data_size_mb = Column(
51 |         BigInteger, nullable=True, comment="数据部分大小（MB），如果可获取",
   |                                                         ^^
52 |     )
53 |     log_size_mb = Column(
   |

RUF001 String contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/database_size_stat.py:51:54
   |
49 |     size_mb = Column(BigInteger, nullable=False, comment="数据库总大小（MB）")
50 |     data_size_mb = Column(
51 |         BigInteger, nullable=True, comment="数据部分大小（MB），如果可获取",
   |                                                             ^^
52 |     )
53 |     log_size_mb = Column(
   |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/database_size_stat.py:51:55
   |
49 |     size_mb = Column(BigInteger, nullable=False, comment="数据库总大小（MB）")
50 |     data_size_mb = Column(
51 |         BigInteger, nullable=True, comment="数据部分大小（MB），如果可获取",
   |                                                               ^^
52 |     )
53 |     log_size_mb = Column(
   |

RUF001 String contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/database_size_stat.py:54:51
   |
52 |     )
53 |     log_size_mb = Column(
54 |         BigInteger, nullable=True, comment="日志部分大小（MB），如果可获取（SQL Server）",
   |                                                         ^^
55 |     )
56 |     collected_date = Column(Date, nullable=False, comment="采集日期（用于分区）")
   |

RUF001 String contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/database_size_stat.py:54:54
   |
52 |     )
53 |     log_size_mb = Column(
54 |         BigInteger, nullable=True, comment="日志部分大小（MB），如果可获取（SQL Server）",
   |                                                             ^^
55 |     )
56 |     collected_date = Column(Date, nullable=False, comment="采集日期（用于分区）")
   |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/database_size_stat.py:54:55
   |
52 |     )
53 |     log_size_mb = Column(
54 |         BigInteger, nullable=True, comment="日志部分大小（MB），如果可获取（SQL Server）",
   |                                                               ^^
55 |     )
56 |     collected_date = Column(Date, nullable=False, comment="采集日期（用于分区）")
   |

RUF001 String contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/database_size_stat.py:54:61
   |
52 |     )
53 |     log_size_mb = Column(
54 |         BigInteger, nullable=True, comment="日志部分大小（MB），如果可获取（SQL Server）",
   |                                                                           ^^
55 |     )
56 |     collected_date = Column(Date, nullable=False, comment="采集日期（用于分区）")
   |

RUF001 String contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/database_size_stat.py:54:72
   |
52 |     )
53 |     log_size_mb = Column(
54 |         BigInteger, nullable=True, comment="日志部分大小（MB），如果可获取（SQL Server）",
   |                                                                                       ^^
55 |     )
56 |     collected_date = Column(Date, nullable=False, comment="采集日期（用于分区）")
   |

RUF001 String contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/database_size_stat.py:56:64
   |
54 |         BigInteger, nullable=True, comment="日志部分大小（MB），如果可获取（SQL Server）",
55 |     )
56 |     collected_date = Column(Date, nullable=False, comment="采集日期（用于分区）")
   |                                                                    ^^
57 |     collected_at = Column(
58 |         DateTime(timezone=True), nullable=False, default=time_utils.now, comment="采集时间戳",
   |

RUF001 String contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/database_size_stat.py:56:69
   |
54 |         BigInteger, nullable=True, comment="日志部分大小（MB），如果可获取（SQL Server）",
55 |     )
56 |     collected_date = Column(Date, nullable=False, comment="采集日期（用于分区）")
   |                                                                              ^^
57 |     collected_at = Column(
58 |         DateTime(timezone=True), nullable=False, default=time_utils.now, comment="采集时间戳",
   |

E501 Line too long (121 > 120)
  --> app/models/database_size_stat.py:64:115
   |
62 |     )
63 |     updated_at = Column(
64 |         DateTime(timezone=True), nullable=False, default=time_utils.now, onupdate=time_utils.now, comment="记录更新时间",
   |                                                                                                                         ^
65 |     )
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/models/database_size_stat.py:105:28
    |
103 |         """序列化统计记录。.
104 |
105 |         将日期与时间字段转换为 ISO 字符串，以便 API 响应或任务日志消费。
    |                                          ^^
106 |
107 |         Returns:
    |

D205 1 blank line required between summary line and description
 --> app/models/database_type_config.py:1:1
  |
1 | / """鲸落 - 数据库类型配置模型
2 | | 管理数据库类型的配置信息.
3 | | """
  | |___^
4 |
5 |   import json
  |
help: Insert single blank line

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/database_type_config.py:15:17
   |
13 |     """数据库类型配置模型。.
14 |
15 |     管理数据库类型的配置信息，包括连接参数、显示样式、特性列表等。
   |                             ^^
16 |     支持系统内置类型和自定义类型。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/database_type_config.py:20:22
   |
18 |     Attributes:
19 |         id: 主键 ID。
20 |         name: 数据库类型名称（唯一）。
   |                             ^^
21 |         display_name: 显示名称。
22 |         driver: 驱动名称。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/database_type_config.py:20:25
   |
18 |     Attributes:
19 |         id: 主键 ID。
20 |         name: 数据库类型名称（唯一）。
   |                                   ^^
21 |         display_name: 显示名称。
22 |         driver: 驱动名称。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/database_type_config.py:25:35
   |
23 |         default_port: 默认端口。
24 |         default_schema: 默认 Schema。
25 |         connection_timeout: 连接超时时间（秒）。
   |                                         ^^
26 |         description: 描述信息。
27 |         icon: 图标类名（Font Awesome）。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/database_type_config.py:25:37
   |
23 |         default_port: 默认端口。
24 |         default_schema: 默认 Schema。
25 |         connection_timeout: 连接超时时间（秒）。
   |                                             ^^
26 |         description: 描述信息。
27 |         icon: 图标类名（Font Awesome）。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/database_type_config.py:27:19
   |
25 |         connection_timeout: 连接超时时间（秒）。
26 |         description: 描述信息。
27 |         icon: 图标类名（Font Awesome）。
   |                       ^^
28 |         color: 主题颜色。
29 |         features: 特性列表（JSON 字符串）。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/database_type_config.py:27:32
   |
25 |         connection_timeout: 连接超时时间（秒）。
26 |         description: 描述信息。
27 |         icon: 图标类名（Font Awesome）。
   |                                     ^^
28 |         color: 主题颜色。
29 |         features: 特性列表（JSON 字符串）。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/database_type_config.py:29:23
   |
27 |         icon: 图标类名（Font Awesome）。
28 |         color: 主题颜色。
29 |         features: 特性列表（JSON 字符串）。
   |                           ^^
30 |         is_active: 是否启用。
31 |         is_system: 是否系统内置。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/database_type_config.py:29:32
   |
27 |         icon: 图标类名（Font Awesome）。
28 |         color: 主题颜色。
29 |         features: 特性列表（JSON 字符串）。
   |                                        ^^
30 |         is_active: 是否启用。
31 |         is_system: 是否系统内置。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/database_type_config.py:66:26
   |
65 |         Returns:
66 |             str: 含名称的可读文本，便于日志排查。
   |                                  ^^
67 |
68 |         """
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/database_type_config.py:76:32
   |
75 |         Returns:
76 |             list[str]: 解码后的特性集合，解析失败时返回空列表。
   |                                        ^^
77 |
78 |         """
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/models/database_type_config.py:143:41
    |
142 |         Returns:
143 |             DatabaseTypeConfig: 匹配到的配置实例，若不存在则返回 None。
    |                                                 ^^
144 |
145 |         """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/instance.py:10:17
   |
 8 |     """数据库实例模型。.
 9 |
10 |     存储数据库实例的基本信息，包括连接配置、版本信息、
   |                             ^^
11 |     关联的凭据和标签等。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/instance.py:15:19
   |
13 |     Attributes:
14 |         id: 实例主键。
15 |         name: 实例名称，唯一。
   |                       ^^
16 |         db_type: 数据库类型（mysql、postgresql、sqlserver、oracle等）。
17 |         host: 主机地址。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/instance.py:16:23
   |
14 |         id: 实例主键。
15 |         name: 实例名称，唯一。
16 |         db_type: 数据库类型（mysql、postgresql、sqlserver、oracle等）。
   |                            ^^
17 |         host: 主机地址。
18 |         port: 端口号。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/instance.py:16:58
   |
14 |         id: 实例主键。
15 |         name: 实例名称，唯一。
16 |         db_type: 数据库类型（mysql、postgresql、sqlserver、oracle等）。
   |                                                                    ^^
17 |         host: 主机地址。
18 |         port: 端口号。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/instance.py:19:29
   |
17 |         host: 主机地址。
18 |         port: 端口号。
19 |         database_name: 数据库名称，可选。
   |                                  ^^
20 |         database_version: 原始版本字符串。
21 |         main_version: 主版本号（如 8.0、13.4）。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/instance.py:21:27
   |
19 |         database_name: 数据库名称，可选。
20 |         database_version: 原始版本字符串。
21 |         main_version: 主版本号（如 8.0、13.4）。
   |                               ^^
22 |         detailed_version: 详细版本号（如 8.0.32、13.4）。
23 |         sync_count: 同步次数。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/instance.py:21:38
   |
19 |         database_name: 数据库名称，可选。
20 |         database_version: 原始版本字符串。
21 |         main_version: 主版本号（如 8.0、13.4）。
   |                                             ^^
22 |         detailed_version: 详细版本号（如 8.0.32、13.4）。
23 |         sync_count: 同步次数。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/instance.py:22:32
   |
20 |         database_version: 原始版本字符串。
21 |         main_version: 主版本号（如 8.0、13.4）。
22 |         detailed_version: 详细版本号（如 8.0.32、13.4）。
   |                                     ^^
23 |         sync_count: 同步次数。
24 |         credential_id: 关联的凭据ID。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/instance.py:22:46
   |
20 |         database_version: 原始版本字符串。
21 |         main_version: 主版本号（如 8.0、13.4）。
22 |         detailed_version: 详细版本号（如 8.0.32、13.4）。
   |                                                      ^^
23 |         sync_count: 同步次数。
24 |         credential_id: 关联的凭据ID。
   |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/instance.py:92:20
   |
90 |         cascade="all, delete-orphan",
91 |     )
92 |     # accounts关系已移除，因为Account模型已废弃，使用AccountPermission
   |                         ^^
93 |     # sync_data关系已移除，因为SyncData表已删除
   |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/instance.py:92:35
   |
90 |         cascade="all, delete-orphan",
91 |     )
92 |     # accounts关系已移除，因为Account模型已废弃，使用AccountPermission
   |                                                ^^
93 |     # sync_data关系已移除，因为SyncData表已删除
   |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/instance.py:93:21
   |
91 |     )
92 |     # accounts关系已移除，因为Account模型已废弃，使用AccountPermission
93 |     # sync_data关系已移除，因为SyncData表已删除
   |                          ^^
94 |
95 |     def __init__(
   |

PLR0913 Too many arguments in function definition (9 > 5)
  --> app/models/instance.py:95:9
   |
93 |     # sync_data关系已移除，因为SyncData表已删除
94 |
95 |     def __init__(
   |         ^^^^^^^^
96 |         self,
97 |         name: str,
   |

D417 Missing argument description in the docstring for `__init__`: `is_active`
  --> app/models/instance.py:95:9
   |
93 |     # sync_data关系已移除，因为SyncData表已删除
94 |
95 |     def __init__(
   |         ^^^^^^^^
96 |         self,
97 |         name: str,
   |

ARG002 Unused method argument: `tags`
   --> app/models/instance.py:104:9
    |
102 |         credential_id: int | None = None,
103 |         description: str | None = None,
104 |         tags: list | None = None,
    |         ^^^^
105 |         is_active: bool = True,
106 |     ) -> None:
    |

FBT001 Boolean-typed positional argument in function definition
   --> app/models/instance.py:105:9
    |
103 |         description: str | None = None,
104 |         tags: list | None = None,
105 |         is_active: bool = True,
    |         ^^^^^^^^^
106 |     ) -> None:
107 |         """初始化实例。.
    |

FBT002 Boolean default positional argument in function definition
   --> app/models/instance.py:105:9
    |
103 |         description: str | None = None,
104 |         tags: list | None = None,
105 |         is_active: bool = True,
    |         ^^^^^^^^^
106 |     ) -> None:
107 |         """初始化实例。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/models/instance.py:110:23
    |
109 |         Args:
110 |             name: 实例名称，必须唯一。
    |                           ^^
111 |             db_type: 数据库类型。
112 |             host: 主机地址。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/models/instance.py:114:33
    |
112 |             host: 主机地址。
113 |             port: 端口号。
114 |             database_name: 数据库名称，可选。
    |                                      ^^
115 |             credential_id: 凭据ID，可选。
116 |             description: 描述信息，可选。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/models/instance.py:115:32
    |
113 |             port: 端口号。
114 |             database_name: 数据库名称，可选。
115 |             credential_id: 凭据ID，可选。
    |                                  ^^
116 |             description: 描述信息，可选。
117 |             tags: 标签列表，可选（标签将在创建后通过关系添加）。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/models/instance.py:116:30
    |
114 |             database_name: 数据库名称，可选。
115 |             credential_id: 凭据ID，可选。
116 |             description: 描述信息，可选。
    |                                  ^^
117 |             tags: 标签列表，可选（标签将在创建后通过关系添加）。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/models/instance.py:117:23
    |
115 |             credential_id: 凭据ID，可选。
116 |             description: 描述信息，可选。
117 |             tags: 标签列表，可选（标签将在创建后通过关系添加）。
    |                           ^^
118 |
119 |         """
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/models/instance.py:117:26
    |
115 |             credential_id: 凭据ID，可选。
116 |             description: 描述信息，可选。
117 |             tags: 标签列表，可选（标签将在创建后通过关系添加）。
    |                                 ^^
118 |
119 |         """
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/models/instance.py:117:40
    |
115 |             credential_id: 凭据ID，可选。
116 |             description: 描述信息，可选。
117 |             tags: 标签列表，可选（标签将在创建后通过关系添加）。
    |                                                             ^^
118 |
119 |         """
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/models/instance.py:128:28
    |
126 |         self.description = description
127 |         self.is_active = is_active
128 |         # environment 字段已移除，使用标签系统替代
    |                                 ^^
129 |         # 标签将在创建后通过关系添加
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/models/instance.py:135:39
    |
134 |         Args:
135 |             include_password: 是否包含凭据密码，默认为 False（安全考虑）。
    |                                               ^^
136 |
137 |         Returns:
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/models/instance.py:135:49
    |
134 |         Args:
135 |             include_password: 是否包含凭据密码，默认为 False（安全考虑）。
    |                                                             ^^
136 |
137 |         Returns:
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/models/instance.py:135:54
    |
134 |         Args:
135 |             include_password: 是否包含凭据密码，默认为 False（安全考虑）。
    |                                                                       ^^
136 |
137 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/models/instance.py:138:24
    |
137 |         Returns:
138 |             包含实例完整信息的字典，包括关联的凭据和标签。
    |                                   ^^
139 |
140 |         """
    |

D205 1 blank line required between summary line and description
 --> app/models/instance_account.py:1:1
  |
1 | / """鲸落 - 实例账户关系模型
2 | | 用于维护实例包含哪些账户，以及账户的存在状态.
3 | | """
  | |___^
4 |
5 |   from app import db
  |
help: Insert single blank line

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/models/instance_account.py:2:13
  |
1 | """鲸落 - 实例账户关系模型
2 | 用于维护实例包含哪些账户，以及账户的存在状态.
  |                         ^^
3 | """
  |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/instance_account.py:12:16
   |
10 |     """实例-账户关系模型。.
11 |
12 |     维护实例包含的账户信息，跟踪账户的存在状态和生命周期。
   |                           ^^
13 |     支持账户的首次发现、持续存在和删除状态的记录。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/instance_account.py:18:22
   |
16 |         id: 主键 ID。
17 |         instance_id: 关联的实例 ID。
18 |         username: 账户名（含必要的主机信息）。
   |                         ^^
19 |         db_type: 数据库类型。
20 |         is_active: 账户是否活跃。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/instance_account.py:18:31
   |
16 |         id: 主键 ID。
17 |         instance_id: 关联的实例 ID。
18 |         username: 账户名（含必要的主机信息）。
   |                                           ^^
19 |         db_type: 数据库类型。
20 |         is_active: 账户是否活跃。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/instance_account.py:23:25
   |
21 |         first_seen_at: 首次发现时间。
22 |         last_seen_at: 最后发现时间。
23 |         deleted_at: 删除时间（软删除）。
   |                             ^^
24 |         created_at: 创建时间。
25 |         updated_at: 更新时间。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/instance_account.py:23:29
   |
21 |         first_seen_at: 首次发现时间。
22 |         last_seen_at: 最后发现时间。
23 |         deleted_at: 删除时间（软删除）。
   |                                     ^^
24 |         created_at: 创建时间。
25 |         updated_at: 更新时间。
   |

RUF001 String contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/instance_account.py:34:70
   |
32 |     id = db.Column(db.Integer, primary_key=True)
33 |     instance_id = db.Column(db.Integer, db.ForeignKey("instances.id"), nullable=False, index=True)
34 |     username = db.Column(db.String(255), nullable=False, comment="账户名（对外展示，含必要的主机信息）")
   |                                                                         ^^
35 |     db_type = db.Column(db.String(50), nullable=False, comment="数据库类型")
36 |     is_active = db.Column(db.Boolean, default=True, nullable=False, comment="账户是否活跃")
   |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/instance_account.py:34:75
   |
32 |     id = db.Column(db.Integer, primary_key=True)
33 |     instance_id = db.Column(db.Integer, db.ForeignKey("instances.id"), nullable=False, index=True)
34 |     username = db.Column(db.String(255), nullable=False, comment="账户名（对外展示，含必要的主机信息）")
   |                                                                                   ^^
35 |     db_type = db.Column(db.String(50), nullable=False, comment="数据库类型")
36 |     is_active = db.Column(db.Boolean, default=True, nullable=False, comment="账户是否活跃")
   |

RUF001 String contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/instance_account.py:34:84
   |
32 |     id = db.Column(db.Integer, primary_key=True)
33 |     instance_id = db.Column(db.Integer, db.ForeignKey("instances.id"), nullable=False, index=True)
34 |     username = db.Column(db.String(255), nullable=False, comment="账户名（对外展示，含必要的主机信息）")
   |                                                                                                     ^^
35 |     db_type = db.Column(db.String(50), nullable=False, comment="数据库类型")
36 |     is_active = db.Column(db.Boolean, default=True, nullable=False, comment="账户是否活跃")
   |

E501 Line too long (121 > 120)
  --> app/models/instance_account.py:37:115
   |
35 |     db_type = db.Column(db.String(50), nullable=False, comment="数据库类型")
36 |     is_active = db.Column(db.Boolean, default=True, nullable=False, comment="账户是否活跃")
37 |     first_seen_at = db.Column(db.DateTime(timezone=True), nullable=False, default=time_utils.now, comment="首次发现时间")
   |                                                                                                                         ^
38 |     last_seen_at = db.Column(db.DateTime(timezone=True), nullable=False, default=time_utils.now, comment="最后发现时间")
39 |     deleted_at = db.Column(db.DateTime(timezone=True), nullable=True, comment="删除时间")
   |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/instance_account.py:52:33
   |
50 |         db.Index("ix_instance_accounts_last_seen", "last_seen_at"),
51 |         {
52 |             "comment": "实例-账户关系表，维护账户存在状态",
   |                                        ^^
53 |         },
54 |     )
   |

D205 1 blank line required between summary line and description
 --> app/models/instance_database.py:1:1
  |
1 | / """鲸落 - 实例数据库关系模型
2 | | 用于维护实例包含哪些数据库，以及数据库的状态变化.
3 | | """
  | |___^
4 |
5 |   from datetime import date
  |
help: Insert single blank line

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/models/instance_database.py:2:14
  |
1 | """鲸落 - 实例数据库关系模型
2 | 用于维护实例包含哪些数据库，以及数据库的状态变化.
  |                           ^^
3 | """
  |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/instance_database.py:14:17
   |
12 |     """实例-数据库关系模型。.
13 |
14 |     维护实例包含的数据库信息，跟踪数据库的存在状态和生命周期。
   |                             ^^
15 |     支持数据库的首次发现、持续存在和删除状态的记录。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/instance_database.py:21:27
   |
19 |         instance_id: 关联的实例 ID。
20 |         database_name: 数据库名称。
21 |         is_active: 数据库是否活跃（未删除）。
   |                                  ^^
22 |         first_seen_date: 首次发现日期。
23 |         last_seen_date: 最后发现日期。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/instance_database.py:21:31
   |
19 |         instance_id: 关联的实例 ID。
20 |         database_name: 数据库名称。
21 |         is_active: 数据库是否活跃（未删除）。
   |                                          ^^
22 |         first_seen_date: 首次发现日期。
23 |         last_seen_date: 最后发现日期。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/instance_database.py:24:25
   |
22 |         first_seen_date: 首次发现日期。
23 |         last_seen_date: 最后发现日期。
24 |         deleted_at: 删除时间（软删除）。
   |                             ^^
25 |         created_at: 创建时间。
26 |         updated_at: 更新时间。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/instance_database.py:24:29
   |
22 |         first_seen_date: 首次发现日期。
23 |         last_seen_date: 最后发现日期。
24 |         deleted_at: 删除时间（软删除）。
   |                                     ^^
25 |         created_at: 创建时间。
26 |         updated_at: 更新时间。
   |

RUF001 String contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/instance_database.py:36:85
   |
34 |     instance_id = db.Column(db.Integer, db.ForeignKey("instances.id"), nullable=False, index=True)
35 |     database_name = db.Column(db.String(255), nullable=False, comment="数据库名称")
36 |     is_active = db.Column(db.Boolean, default=True, nullable=False, comment="数据库是否活跃（未删除）")
   |                                                                                            ^^
37 |     first_seen_date = db.Column(db.Date, nullable=False, default=date.today, comment="首次发现日期")
38 |     last_seen_date = db.Column(db.Date, nullable=False, default=date.today, comment="最后发现日期")
   |

RUF001 String contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/instance_database.py:36:89
   |
34 |     instance_id = db.Column(db.Integer, db.ForeignKey("instances.id"), nullable=False, index=True)
35 |     database_name = db.Column(db.String(255), nullable=False, comment="数据库名称")
36 |     is_active = db.Column(db.Boolean, default=True, nullable=False, comment="数据库是否活跃（未删除）")
   |                                                                                                    ^^
37 |     first_seen_date = db.Column(db.Date, nullable=False, default=date.today, comment="首次发现日期")
38 |     last_seen_date = db.Column(db.Date, nullable=False, default=date.today, comment="最后发现日期")
   |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/instance_database.py:52:34
   |
50 |         db.Index("ix_instance_databases_last_seen", "last_seen_date"),
51 |         {
52 |             "comment": "实例-数据库关系表，维护数据库的存在状态",
   |                                          ^^
53 |         },
54 |     )
   |

D205 1 blank line required between summary line and description
 --> app/models/instance_size_aggregation.py:1:1
  |
1 | / """实例大小聚合统计模型
2 | | 存储实例级别的每周、每月、每季度的统计信息.
3 | | """
  | |___^
4 |
5 |   from sqlalchemy import (
  |
help: Insert single blank line

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/instance_size_aggregation.py:24:17
   |
23 | class InstanceSizeAggregation(db.Model):
24 |     """实例大小聚合统计表（分区表）。.
   |                          ^^
25 |
26 |     存储实例级别的每日、每周、每月、每季度的聚合统计信息。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/instance_size_aggregation.py:24:21
   |
23 | class InstanceSizeAggregation(db.Model):
24 |     """实例大小聚合统计表（分区表）。.
   |                                  ^^
25 |
26 |     存储实例级别的每日、每周、每月、每季度的聚合统计信息。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/instance_size_aggregation.py:27:26
   |
26 |     存储实例级别的每日、每周、每月、每季度的聚合统计信息。
27 |     按 period_start 字段按月分区，支持容量变化和增长率统计。
   |                                 ^^
28 |
29 |     Attributes:
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/instance_size_aggregation.py:30:18
   |
29 |     Attributes:
30 |         id: 主键 ID（BigInteger）。
   |                    ^^
31 |         instance_id: 关联的实例 ID。
32 |         period_type: 统计周期类型（daily/weekly/monthly/quarterly）。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/instance_size_aggregation.py:30:29
   |
29 |     Attributes:
30 |         id: 主键 ID（BigInteger）。
   |                                ^^
31 |         instance_id: 关联的实例 ID。
32 |         period_type: 统计周期类型（daily/weekly/monthly/quarterly）。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/instance_size_aggregation.py:32:28
   |
30 |         id: 主键 ID（BigInteger）。
31 |         instance_id: 关联的实例 ID。
32 |         period_type: 统计周期类型（daily/weekly/monthly/quarterly）。
   |                                  ^^
33 |         period_start: 统计周期开始日期（用于分区）。
34 |         period_end: 统计周期结束日期。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/instance_size_aggregation.py:32:59
   |
30 |         id: 主键 ID（BigInteger）。
31 |         instance_id: 关联的实例 ID。
32 |         period_type: 统计周期类型（daily/weekly/monthly/quarterly）。
   |                                                                  ^^
33 |         period_start: 统计周期开始日期（用于分区）。
34 |         period_end: 统计周期结束日期。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/instance_size_aggregation.py:33:31
   |
31 |         instance_id: 关联的实例 ID。
32 |         period_type: 统计周期类型（daily/weekly/monthly/quarterly）。
33 |         period_start: 统计周期开始日期（用于分区）。
   |                                       ^^
34 |         period_end: 统计周期结束日期。
35 |         total_size_mb: 实例总大小（MB）。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/instance_size_aggregation.py:33:36
   |
31 |         instance_id: 关联的实例 ID。
32 |         period_type: 统计周期类型（daily/weekly/monthly/quarterly）。
33 |         period_start: 统计周期开始日期（用于分区）。
   |                                                 ^^
34 |         period_end: 统计周期结束日期。
35 |         total_size_mb: 实例总大小（MB）。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/instance_size_aggregation.py:35:29
   |
33 |         period_start: 统计周期开始日期（用于分区）。
34 |         period_end: 统计周期结束日期。
35 |         total_size_mb: 实例总大小（MB）。
   |                                  ^^
36 |         avg_size_mb: 平均大小（MB）。
37 |         max_size_mb: 最大大小（MB）。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/instance_size_aggregation.py:35:32
   |
33 |         period_start: 统计周期开始日期（用于分区）。
34 |         period_end: 统计周期结束日期。
35 |         total_size_mb: 实例总大小（MB）。
   |                                      ^^
36 |         avg_size_mb: 平均大小（MB）。
37 |         max_size_mb: 最大大小（MB）。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/instance_size_aggregation.py:36:26
   |
34 |         period_end: 统计周期结束日期。
35 |         total_size_mb: 实例总大小（MB）。
36 |         avg_size_mb: 平均大小（MB）。
   |                              ^^
37 |         max_size_mb: 最大大小（MB）。
38 |         min_size_mb: 最小大小（MB）。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/instance_size_aggregation.py:36:29
   |
34 |         period_end: 统计周期结束日期。
35 |         total_size_mb: 实例总大小（MB）。
36 |         avg_size_mb: 平均大小（MB）。
   |                                  ^^
37 |         max_size_mb: 最大大小（MB）。
38 |         min_size_mb: 最小大小（MB）。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/instance_size_aggregation.py:37:26
   |
35 |         total_size_mb: 实例总大小（MB）。
36 |         avg_size_mb: 平均大小（MB）。
37 |         max_size_mb: 最大大小（MB）。
   |                              ^^
38 |         min_size_mb: 最小大小（MB）。
39 |         data_count: 统计的数据点数量。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/instance_size_aggregation.py:37:29
   |
35 |         total_size_mb: 实例总大小（MB）。
36 |         avg_size_mb: 平均大小（MB）。
37 |         max_size_mb: 最大大小（MB）。
   |                                  ^^
38 |         min_size_mb: 最小大小（MB）。
39 |         data_count: 统计的数据点数量。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/instance_size_aggregation.py:38:26
   |
36 |         avg_size_mb: 平均大小（MB）。
37 |         max_size_mb: 最大大小（MB）。
38 |         min_size_mb: 最小大小（MB）。
   |                              ^^
39 |         data_count: 统计的数据点数量。
40 |         database_count: 数据库数量。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/instance_size_aggregation.py:38:29
   |
36 |         avg_size_mb: 平均大小（MB）。
37 |         max_size_mb: 最大大小（MB）。
38 |         min_size_mb: 最小大小（MB）。
   |                                  ^^
39 |         data_count: 统计的数据点数量。
40 |         database_count: 数据库数量。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/instance_size_aggregation.py:44:36
   |
42 |         max_database_count: 最大数据库数量。
43 |         min_database_count: 最小数据库数量。
44 |         total_size_change_mb: 总大小变化（MB）。
   |                                         ^^
45 |         total_size_change_percent: 总大小变化百分比。
46 |         database_count_change: 数据库数量变化。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/instance_size_aggregation.py:44:39
   |
42 |         max_database_count: 最大数据库数量。
43 |         min_database_count: 最小数据库数量。
44 |         total_size_change_mb: 总大小变化（MB）。
   |                                             ^^
45 |         total_size_change_percent: 总大小变化百分比。
46 |         database_count_change: 数据库数量变化。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/instance_size_aggregation.py:48:25
   |
46 |         database_count_change: 数据库数量变化。
47 |         database_count_change_percent: 数据库数量变化百分比。
48 |         growth_rate: 增长率（百分比）。
   |                            ^^
49 |
50 |     """
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/instance_size_aggregation.py:48:29
   |
46 |         database_count_change: 数据库数量变化。
47 |         database_count_change_percent: 数据库数量变化百分比。
48 |         growth_rate: 增长率（百分比）。
   |                                    ^^
49 |
50 |     """
   |

RUF001 String contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/models/instance_size_aggregation.py:58:69
   |
57 |     # 统计周期
58 |     period_type = Column(String(20), nullable=False, comment="统计周期类型：daily, weekly, monthly, quarterly")
   |                                                                           ^^
59 |     period_start = Column(Date, nullable=False, comment="统计周期开始日期（用于分区）")
60 |     period_end = Column(Date, nullable=False, comment="统计周期结束日期")
   |

RUF001 String contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/instance_size_aggregation.py:59:66
   |
57 |     # 统计周期
58 |     period_type = Column(String(20), nullable=False, comment="统计周期类型：daily, weekly, monthly, quarterly")
59 |     period_start = Column(Date, nullable=False, comment="统计周期开始日期（用于分区）")
   |                                                                          ^^
60 |     period_end = Column(Date, nullable=False, comment="统计周期结束日期")
   |

RUF001 String contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/instance_size_aggregation.py:59:71
   |
57 |     # 统计周期
58 |     period_type = Column(String(20), nullable=False, comment="统计周期类型：daily, weekly, monthly, quarterly")
59 |     period_start = Column(Date, nullable=False, comment="统计周期开始日期（用于分区）")
   |                                                                                    ^^
60 |     period_end = Column(Date, nullable=False, comment="统计周期结束日期")
   |

RUF001 String contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/instance_size_aggregation.py:63:70
   |
62 |     # 实例总大小统计
63 |     total_size_mb = Column(BigInteger, nullable=False, comment="实例总大小（MB）")
   |                                                                           ^^
64 |     avg_size_mb = Column(BigInteger, nullable=False, comment="平均大小（MB）")
65 |     max_size_mb = Column(BigInteger, nullable=False, comment="最大大小（MB）")
   |

RUF001 String contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/instance_size_aggregation.py:63:73
   |
62 |     # 实例总大小统计
63 |     total_size_mb = Column(BigInteger, nullable=False, comment="实例总大小（MB）")
   |                                                                               ^^
64 |     avg_size_mb = Column(BigInteger, nullable=False, comment="平均大小（MB）")
65 |     max_size_mb = Column(BigInteger, nullable=False, comment="最大大小（MB）")
   |

RUF001 String contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/instance_size_aggregation.py:64:67
   |
62 |     # 实例总大小统计
63 |     total_size_mb = Column(BigInteger, nullable=False, comment="实例总大小（MB）")
64 |     avg_size_mb = Column(BigInteger, nullable=False, comment="平均大小（MB）")
   |                                                                       ^^
65 |     max_size_mb = Column(BigInteger, nullable=False, comment="最大大小（MB）")
66 |     min_size_mb = Column(BigInteger, nullable=False, comment="最小大小（MB）")
   |

RUF001 String contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/instance_size_aggregation.py:64:70
   |
62 |     # 实例总大小统计
63 |     total_size_mb = Column(BigInteger, nullable=False, comment="实例总大小（MB）")
64 |     avg_size_mb = Column(BigInteger, nullable=False, comment="平均大小（MB）")
   |                                                                           ^^
65 |     max_size_mb = Column(BigInteger, nullable=False, comment="最大大小（MB）")
66 |     min_size_mb = Column(BigInteger, nullable=False, comment="最小大小（MB）")
   |

RUF001 String contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/instance_size_aggregation.py:65:67
   |
63 |     total_size_mb = Column(BigInteger, nullable=False, comment="实例总大小（MB）")
64 |     avg_size_mb = Column(BigInteger, nullable=False, comment="平均大小（MB）")
65 |     max_size_mb = Column(BigInteger, nullable=False, comment="最大大小（MB）")
   |                                                                       ^^
66 |     min_size_mb = Column(BigInteger, nullable=False, comment="最小大小（MB）")
67 |     data_count = Column(Integer, nullable=False, comment="统计的数据点数量")
   |

RUF001 String contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/instance_size_aggregation.py:65:70
   |
63 |     total_size_mb = Column(BigInteger, nullable=False, comment="实例总大小（MB）")
64 |     avg_size_mb = Column(BigInteger, nullable=False, comment="平均大小（MB）")
65 |     max_size_mb = Column(BigInteger, nullable=False, comment="最大大小（MB）")
   |                                                                           ^^
66 |     min_size_mb = Column(BigInteger, nullable=False, comment="最小大小（MB）")
67 |     data_count = Column(Integer, nullable=False, comment="统计的数据点数量")
   |

RUF001 String contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/instance_size_aggregation.py:66:67
   |
64 |     avg_size_mb = Column(BigInteger, nullable=False, comment="平均大小（MB）")
65 |     max_size_mb = Column(BigInteger, nullable=False, comment="最大大小（MB）")
66 |     min_size_mb = Column(BigInteger, nullable=False, comment="最小大小（MB）")
   |                                                                       ^^
67 |     data_count = Column(Integer, nullable=False, comment="统计的数据点数量")
   |

RUF001 String contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/instance_size_aggregation.py:66:70
   |
64 |     avg_size_mb = Column(BigInteger, nullable=False, comment="平均大小（MB）")
65 |     max_size_mb = Column(BigInteger, nullable=False, comment="最大大小（MB）")
66 |     min_size_mb = Column(BigInteger, nullable=False, comment="最小大小（MB）")
   |                                                                           ^^
67 |     data_count = Column(Integer, nullable=False, comment="统计的数据点数量")
   |

RUF001 String contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/instance_size_aggregation.py:76:76
   |
75 |     # 变化统计
76 |     total_size_change_mb = Column(BigInteger, nullable=True, comment="总大小变化（MB）")
   |                                                                                 ^^
77 |     total_size_change_percent = Column(Numeric(10, 2), nullable=True, comment="总大小变化百分比")
78 |     database_count_change = Column(Integer, nullable=True, comment="数据库数量变化")
   |

RUF001 String contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/instance_size_aggregation.py:76:79
   |
75 |     # 变化统计
76 |     total_size_change_mb = Column(BigInteger, nullable=True, comment="总大小变化（MB）")
   |                                                                                     ^^
77 |     total_size_change_percent = Column(Numeric(10, 2), nullable=True, comment="总大小变化百分比")
78 |     database_count_change = Column(Integer, nullable=True, comment="数据库数量变化")
   |

RUF001 String contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/instance_size_aggregation.py:82:69
   |
81 |     # 增长率
82 |     growth_rate = Column(Numeric(10, 2), nullable=True, comment="增长率（百分比）")
   |                                                                        ^^
83 |     trend_direction = Column(String(20), nullable=True, comment="趋势方向：growing, shrinking, stable")
   |

RUF001 String contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/instance_size_aggregation.py:82:73
   |
81 |     # 增长率
82 |     growth_rate = Column(Numeric(10, 2), nullable=True, comment="增长率（百分比）")
   |                                                                                ^^
83 |     trend_direction = Column(String(20), nullable=True, comment="趋势方向：growing, shrinking, stable")
   |

RUF001 String contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/models/instance_size_aggregation.py:83:70
   |
81 |     # 增长率
82 |     growth_rate = Column(Numeric(10, 2), nullable=True, comment="增长率（百分比）")
83 |     trend_direction = Column(String(20), nullable=True, comment="趋势方向：growing, shrinking, stable")
   |                                                                          ^^
84 |
85 |     # 时间戳
   |

RUF003 Comment contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/models/instance_size_aggregation.py:93:13
   |
91 |     __table_args__ = (
92 |         # 分区表约束 - 主键必须包含分区键
93 |         # 注意：在分区表中，主键约束会自动包含分区键
   |               ^^
94 |         # 查询优化索引
95 |         Index(
   |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/instance_size_aggregation.py:93:19
   |
91 |     __table_args__ = (
92 |         # 分区表约束 - 主键必须包含分区键
93 |         # 注意：在分区表中，主键约束会自动包含分区键
   |                           ^^
94 |         # 查询优化索引
95 |         Index(
   |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/models/instance_size_aggregation.py:106:15
    |
104 |             "period_start",
105 |         ),
106 |         # 唯一约束（在分区表中，唯一约束会自动包含分区键）
    |                   ^^
107 |         UniqueConstraint(
108 |             "instance_id",
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/models/instance_size_aggregation.py:106:21
    |
104 |             "period_start",
105 |         ),
106 |         # 唯一约束（在分区表中，唯一约束会自动包含分区键）
    |                               ^^
107 |         UniqueConstraint(
108 |             "instance_id",
    |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/models/instance_size_aggregation.py:106:34
    |
104 |             "period_start",
105 |         ),
106 |         # 唯一约束（在分区表中，唯一约束会自动包含分区键）
    |                                                         ^^
107 |         UniqueConstraint(
108 |             "instance_id",
    |

ANN202 Missing return type annotation for private function `_to_float`
   --> app/models/instance_size_aggregation.py:134:13
    |
133 |         """
134 |         def _to_float(value):
    |             ^^^^^^^^^
135 |             return float(value) if value is not None else None
    |
help: Add return type annotation

ANN001 Missing type annotation for function argument `value`
   --> app/models/instance_size_aggregation.py:134:23
    |
133 |         """
134 |         def _to_float(value):
    |                       ^^^^^
135 |             return float(value) if value is not None else None
    |

D205 1 blank line required between summary line and description
 --> app/models/instance_size_stat.py:1:1
  |
1 | / """鲸落 - 实例大小统计模型
2 | | 存储数据库实例的总大小统计数据.
3 | | """
  | |___^
4 |
5 |   from app import db
  |
help: Insert single blank line

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/instance_size_stat.py:12:20
   |
10 |     """实例大小统计模型。.
11 |
12 |     存储数据库实例的总大小统计数据，按日期记录实例的容量变化。
   |                                   ^^
13 |     支持软删除和历史数据追踪。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/instance_size_stat.py:18:29
   |
16 |         id: 主键 ID。
17 |         instance_id: 关联的实例 ID。
18 |         total_size_mb: 实例总大小（MB）。
   |                                  ^^
19 |         database_count: 数据库数量。
20 |         collected_date: 采集日期。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/instance_size_stat.py:18:32
   |
16 |         id: 主键 ID。
17 |         instance_id: 关联的实例 ID。
18 |         total_size_mb: 实例总大小（MB）。
   |                                      ^^
19 |         database_count: 数据库数量。
20 |         collected_date: 采集日期。
   |

RUF001 String contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/instance_size_stat.py:34:84
   |
32 |     id = db.Column(db.Integer, primary_key=True)
33 |     instance_id = db.Column(db.Integer, db.ForeignKey("instances.id"), nullable=False, index=True)
34 |     total_size_mb = db.Column(db.Integer, nullable=False, default=0, comment="实例总大小（MB）")
   |                                                                                         ^^
35 |     database_count = db.Column(db.Integer, nullable=False, default=0, comment="数据库数量")
36 |     collected_date = db.Column(db.Date, nullable=False, index=True, comment="采集日期")
   |

RUF001 String contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/instance_size_stat.py:34:87
   |
32 |     id = db.Column(db.Integer, primary_key=True)
33 |     instance_id = db.Column(db.Integer, db.ForeignKey("instances.id"), nullable=False, index=True)
34 |     total_size_mb = db.Column(db.Integer, nullable=False, default=0, comment="实例总大小（MB）")
   |                                                                                             ^^
35 |     database_count = db.Column(db.Integer, nullable=False, default=0, comment="数据库数量")
36 |     collected_date = db.Column(db.Date, nullable=False, index=True, comment="采集日期")
   |

E501 Line too long (123 > 120)
  --> app/models/instance_size_stat.py:41:118
   |
39 |     deleted_at = db.Column(db.DateTime(timezone=True), nullable=True, comment="删除时间")
40 |     created_at = db.Column(db.DateTime(timezone=True), default=time_utils.now, comment="创建时间")
41 |     updated_at = db.Column(db.DateTime(timezone=True), default=time_utils.now, onupdate=time_utils.now, comment="更新时间")
   |                                                                                                                          ^^
42 |
43 |     # 关系
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/models/permission_config.py:3:21
  |
1 | """鲸落 - 权限配置数据模型.
2 |
3 | 默认权限数据通过 SQL 初始化脚本下发，模型层仅负责读取/序列化。
  |                                    ^^
4 | """
  |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/permission_config.py:13:21
   |
11 |     """权限配置数据模型。.
12 |
13 |     存储不同数据库类型的权限配置信息，用于权限展示和验证。
   |                                     ^^
14 |     默认权限数据通过 SQL 初始化脚本下发，模型层仅负责读取和序列化。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/permission_config.py:14:25
   |
13 |     存储不同数据库类型的权限配置信息，用于权限展示和验证。
14 |     默认权限数据通过 SQL 初始化脚本下发，模型层仅负责读取和序列化。
   |                                        ^^
15 |
16 |     Attributes:
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/permission_config.py:18:23
   |
16 |     Attributes:
17 |         id: 主键 ID。
18 |         db_type: 数据库类型（mysql/postgresql/sqlserver/oracle）。
   |                            ^^
19 |         category: 权限分类（如 global_privileges、server_roles 等）。
20 |         permission_name: 权限名称。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/permission_config.py:18:57
   |
16 |     Attributes:
17 |         id: 主键 ID。
18 |         db_type: 数据库类型（mysql/postgresql/sqlserver/oracle）。
   |                                                               ^^
19 |         category: 权限分类（如 global_privileges、server_roles 等）。
20 |         permission_name: 权限名称。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/permission_config.py:19:23
   |
17 |         id: 主键 ID。
18 |         db_type: 数据库类型（mysql/postgresql/sqlserver/oracle）。
19 |         category: 权限分类（如 global_privileges、server_roles 等）。
   |                           ^^
20 |         permission_name: 权限名称。
21 |         description: 权限描述。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/permission_config.py:19:58
   |
17 |         id: 主键 ID。
18 |         db_type: 数据库类型（mysql/postgresql/sqlserver/oracle）。
19 |         category: 权限分类（如 global_privileges、server_roles 等）。
   |                                                                  ^^
20 |         permission_name: 权限名称。
21 |         description: 权限描述。
   |

RUF003 Comment contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/models/permission_config.py:35:15
   |
33 |         db.String(50),
34 |         nullable=False,
35 |     )  # 数据库类型：mysql/postgresql/sqlserver/oracle
   |                    ^^
36 |     category = db.Column(
37 |         db.String(50),
   |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/permission_config.py:39:14
   |
37 |         db.String(50),
38 |         nullable=False,
39 |     )  # 权限分类，如 global_privileges、server_roles 等
   |                  ^^
40 |     permission_name = db.Column(db.String(255), nullable=False)
41 |     description = db.Column(db.Text, nullable=True)
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/permission_config.py:83:24
   |
81 |     @classmethod
82 |     def get_permissions_by_db_type(cls, db_type: str) -> dict[str, list[dict[str, str | None]]]:
83 |         """按数据库类型返回权限配置，供 UI 展示。.
   |                                    ^^
84 |
85 |         Args:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/permission_config.py:89:25
   |
88 |         Returns:
89 |             按分类分组的权限配置字典，格式：
   |                                     ^^
90 |             {
91 |                 'category1': [{'name': 'perm1', 'description': 'desc1'}, ...],
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/models/permission_config.py:89:28
   |
88 |         Returns:
89 |             按分类分组的权限配置字典，格式：
   |                                           ^^
90 |             {
91 |                 'category1': [{'name': 'perm1', 'description': 'desc1'}, ...],
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/models/sync_instance_record.py:3:20
  |
1 | """同步实例记录模型。.
2 |
3 | 记录每个实例在同步会话中的详细执行情况，包括状态、统计数据和错误信息。
  |                                       ^^
4 | """
  |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/sync_instance_record.py:13:16
   |
11 |     """同步实例记录模型。.
12 |
13 |     记录每个实例的同步详情，包括同步状态、时间、统计数据和错误信息。
   |                           ^^
14 |
15 |     Attributes:
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/sync_instance_record.py:20:28
   |
18 |         instance_id: 关联的实例 ID。
19 |         instance_name: 实例名称。
20 |         sync_category: 同步分类（account、capacity、aggregation、config、other）。
   |                                ^^
21 |         status: 同步状态（pending、running、completed、failed）。
22 |         started_at: 同步开始时间。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/sync_instance_record.py:20:70
   |
18 |         instance_id: 关联的实例 ID。
19 |         instance_name: 实例名称。
20 |         sync_category: 同步分类（account、capacity、aggregation、config、other）。
   |                                                                               ^^
21 |         status: 同步状态（pending、running、completed、failed）。
22 |         started_at: 同步开始时间。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/sync_instance_record.py:21:21
   |
19 |         instance_name: 实例名称。
20 |         sync_category: 同步分类（account、capacity、aggregation、config、other）。
21 |         status: 同步状态（pending、running、completed、failed）。
   |                         ^^
22 |         started_at: 同步开始时间。
23 |         completed_at: 同步完成时间。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/sync_instance_record.py:21:54
   |
19 |         instance_name: 实例名称。
20 |         sync_category: 同步分类（account、capacity、aggregation、config、other）。
21 |         status: 同步状态（pending、running、completed、failed）。
   |                                                              ^^
22 |         started_at: 同步开始时间。
23 |         completed_at: 同步完成时间。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/sync_instance_record.py:29:29
   |
27 |         items_deleted: 删除的项目数量。
28 |         error_message: 错误消息。
29 |         sync_details: 同步详细信息（JSON）。
   |                                   ^^
30 |         created_at: 记录创建时间。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/sync_instance_record.py:29:34
   |
27 |         items_deleted: 删除的项目数量。
28 |         error_message: 错误消息。
29 |         sync_details: 同步详细信息（JSON）。
   |                                         ^^
30 |         created_at: 记录创建时间。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/models/sync_instance_record.py:186:19
    |
185 |         Returns:
186 |             同步持续时间（秒），如果未完成则返回 None。
    |                         ^^
187 |
188 |         """
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/models/sync_instance_record.py:186:21
    |
185 |         Returns:
186 |             同步持续时间（秒），如果未完成则返回 None。
    |                             ^^
187 |
188 |         """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/models/sync_instance_record.py:186:22
    |
185 |         Returns:
186 |             同步持续时间（秒），如果未完成则返回 None。
    |                               ^^
187 |
188 |         """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/models/sync_instance_record.py:201:19
    |
200 |         Returns:
201 |             实例记录列表，按创建时间升序排列。
    |                         ^^
202 |
203 |         """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/sync_session.py:12:18
   |
10 |     """同步会话模型 - 管理批量同步会话。.
11 |
12 |     记录批量同步任务的会话信息，包括同步类型、状态、时间、
   |                               ^^
13 |     实例统计等。支持账户同步、容量采集、聚合等多种同步类型。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/sync_session.py:17:27
   |
15 |     Attributes:
16 |         id: 主键 ID。
17 |         session_id: 会话唯一标识（UUID）。
   |                                 ^^
18 |         sync_type: 同步操作方式（manual_single/manual_batch/manual_task/scheduled_task）。
19 |         sync_category: 同步分类（account/capacity/config/aggregation/other）。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/sync_session.py:17:32
   |
15 |     Attributes:
16 |         id: 主键 ID。
17 |         session_id: 会话唯一标识（UUID）。
   |                                       ^^
18 |         sync_type: 同步操作方式（manual_single/manual_batch/manual_task/scheduled_task）。
19 |         sync_category: 同步分类（account/capacity/config/aggregation/other）。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/sync_session.py:18:26
   |
16 |         id: 主键 ID。
17 |         session_id: 会话唯一标识（UUID）。
18 |         sync_type: 同步操作方式（manual_single/manual_batch/manual_task/scheduled_task）。
   |                                ^^
19 |         sync_category: 同步分类（account/capacity/config/aggregation/other）。
20 |         status: 会话状态（pending/running/completed/failed）。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/sync_session.py:18:80
   |
16 |         id: 主键 ID。
17 |         session_id: 会话唯一标识（UUID）。
18 |         sync_type: 同步操作方式（manual_single/manual_batch/manual_task/scheduled_task）。
   |                                                                                       ^^
19 |         sync_category: 同步分类（account/capacity/config/aggregation/other）。
20 |         status: 会话状态（pending/running/completed/failed）。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/sync_session.py:19:28
   |
17 |         session_id: 会话唯一标识（UUID）。
18 |         sync_type: 同步操作方式（manual_single/manual_batch/manual_task/scheduled_task）。
19 |         sync_category: 同步分类（account/capacity/config/aggregation/other）。
   |                                ^^
20 |         status: 会话状态（pending/running/completed/failed）。
21 |         started_at: 开始时间。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/sync_session.py:19:70
   |
17 |         session_id: 会话唯一标识（UUID）。
18 |         sync_type: 同步操作方式（manual_single/manual_batch/manual_task/scheduled_task）。
19 |         sync_category: 同步分类（account/capacity/config/aggregation/other）。
   |                                                                           ^^
20 |         status: 会话状态（pending/running/completed/failed）。
21 |         started_at: 开始时间。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/sync_session.py:20:21
   |
18 |         sync_type: 同步操作方式（manual_single/manual_batch/manual_task/scheduled_task）。
19 |         sync_category: 同步分类（account/capacity/config/aggregation/other）。
20 |         status: 会话状态（pending/running/completed/failed）。
   |                         ^^
21 |         started_at: 开始时间。
22 |         completed_at: 完成时间。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/sync_session.py:20:54
   |
18 |         sync_type: 同步操作方式（manual_single/manual_batch/manual_task/scheduled_task）。
19 |         sync_category: 同步分类（account/capacity/config/aggregation/other）。
20 |         status: 会话状态（pending/running/completed/failed）。
   |                                                           ^^
21 |         started_at: 开始时间。
22 |         completed_at: 完成时间。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/sync_session.py:26:28
   |
24 |         successful_instances: 成功实例数。
25 |         failed_instances: 失败实例数。
26 |         created_by: 创建用户 ID（手动同步时）。
   |                                ^^
27 |         created_at: 创建时间。
28 |         updated_at: 更新时间。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/sync_session.py:26:34
   |
24 |         successful_instances: 成功实例数。
25 |         failed_instances: 失败实例数。
26 |         created_by: 创建用户 ID（手动同步时）。
   |                                            ^^
27 |         created_at: 创建时间。
28 |         updated_at: 更新时间。
   |

RUF003 Comment contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/models/sync_session.py:48:34
   |
46 |         db.String(20),
47 |         nullable=False,
48 |         default="pending",  # 可选值：pending（待处理）、running（执行中）、completed（已完成）、failed（失败）
   |                                     ^^
49 |     )
50 |     started_at = db.Column(db.DateTime(timezone=True))
   |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/sync_session.py:48:42
   |
46 |         db.String(20),
47 |         nullable=False,
48 |         default="pending",  # 可选值：pending（待处理）、running（执行中）、completed（已完成）、failed（失败）
   |                                              ^^
49 |     )
50 |     started_at = db.Column(db.DateTime(timezone=True))
   |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/sync_session.py:48:46
   |
46 |         db.String(20),
47 |         nullable=False,
48 |         default="pending",  # 可选值：pending（待处理）、running（执行中）、completed（已完成）、failed（失败）
   |                                                      ^^
49 |     )
50 |     started_at = db.Column(db.DateTime(timezone=True))
   |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/sync_session.py:48:55
   |
46 |         db.String(20),
47 |         nullable=False,
48 |         default="pending",  # 可选值：pending（待处理）、running（执行中）、completed（已完成）、failed（失败）
   |                                                                 ^^
49 |     )
50 |     started_at = db.Column(db.DateTime(timezone=True))
   |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/sync_session.py:48:59
   |
46 |         db.String(20),
47 |         nullable=False,
48 |         default="pending",  # 可选值：pending（待处理）、running（执行中）、completed（已完成）、failed（失败）
   |                                                                         ^^
49 |     )
50 |     started_at = db.Column(db.DateTime(timezone=True))
   |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/sync_session.py:48:70
   |
46 |         db.String(20),
47 |         nullable=False,
48 |         default="pending",  # 可选值：pending（待处理）、running（执行中）、completed（已完成）、failed（失败）
   |                                                                                      ^^
49 |     )
50 |     started_at = db.Column(db.DateTime(timezone=True))
   |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/sync_session.py:48:74
   |
46 |         db.String(20),
47 |         nullable=False,
48 |         default="pending",  # 可选值：pending（待处理）、running（执行中）、completed（已完成）、failed（失败）
   |                                                                                              ^^
49 |     )
50 |     started_at = db.Column(db.DateTime(timezone=True))
   |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/sync_session.py:48:82
   |
46 |         db.String(20),
47 |         nullable=False,
48 |         default="pending",  # 可选值：pending（待处理）、running（执行中）、completed（已完成）、failed（失败）
   |                                                                                                        ^^
49 |     )
50 |     started_at = db.Column(db.DateTime(timezone=True))
   |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/sync_session.py:48:85
   |
46 |         db.String(20),
47 |         nullable=False,
48 |         default="pending",  # 可选值：pending（待处理）、running（执行中）、completed（已完成）、failed（失败）
   |                                                                                                              ^^
49 |     )
50 |     started_at = db.Column(db.DateTime(timezone=True))
   |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/sync_session.py:55:47
   |
53 |     successful_instances = db.Column(db.Integer, default=0)
54 |     failed_instances = db.Column(db.Integer, default=0)
55 |     created_by = db.Column(db.Integer)  # 用户ID（手动同步时）
   |                                                 ^^
56 |     created_at = db.Column(db.DateTime(timezone=True), default=time_utils.now)
57 |     updated_at = db.Column(db.DateTime(timezone=True), default=time_utils.now, onupdate=time_utils.now)
   |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/sync_session.py:55:53
   |
53 |     successful_instances = db.Column(db.Integer, default=0)
54 |     failed_instances = db.Column(db.Integer, default=0)
55 |     created_by = db.Column(db.Integer)  # 用户ID（手动同步时）
   |                                                             ^^
56 |     created_at = db.Column(db.DateTime(timezone=True), default=time_utils.now)
57 |     updated_at = db.Column(db.DateTime(timezone=True), default=time_utils.now, onupdate=time_utils.now)
   |

ARG002 Unused method argument: `created_by`
  --> app/models/sync_session.py:67:72
   |
65 |     )
66 |
67 |     def __init__(self, sync_type: str, sync_category: str = "account", created_by: int | None = None) -> None:
   |                                                                        ^^^^^^^^^^
68 |         """初始化同步会话.
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/models/sync_session.py:132:30
    |
131 |         Returns:
132 |             int: 0-100 的进度百分比（保留两位小数）。
    |                                    ^^
133 |
134 |         """
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/models/sync_session.py:132:37
    |
131 |         Returns:
132 |             int: 0-100 的进度百分比（保留两位小数）。
    |                                                  ^^
133 |
134 |         """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/models/sync_session.py:149:41
    |
148 |         Returns:
149 |             list[SyncSession]: 满足条件的会话集合，按创建时间倒序。
    |                                                  ^^
150 |
151 |         """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/models/sync_session.py:165:41
    |
164 |         Returns:
165 |             list[SyncSession]: 满足条件的会话集合，按创建时间倒序。
    |                                                  ^^
166 |
167 |         """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/tag.py:11:17
   |
 9 |     """标签模型。.
10 |
11 |     用于对实例进行分类和标记，支持多种分类（地区、环境、项目等）。
   |                             ^^
12 |
13 |     Attributes:
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/tag.py:11:24
   |
 9 |     """标签模型。.
10 |
11 |     用于对实例进行分类和标记，支持多种分类（地区、环境、项目等）。
   |                                           ^^
12 |
13 |     Attributes:
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/tag.py:11:34
   |
 9 |     """标签模型。.
10 |
11 |     用于对实例进行分类和标记，支持多种分类（地区、环境、项目等）。
   |                                                               ^^
12 |
13 |     Attributes:
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/tag.py:15:19
   |
13 |     Attributes:
14 |         id: 标签主键。
15 |         name: 标签代码（如 wenzhou），唯一。
   |                       ^^
16 |         display_name: 显示名称（如 温州）。
17 |         category: 标签分类（如 location、environment）。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/tag.py:15:29
   |
13 |     Attributes:
14 |         id: 标签主键。
15 |         name: 标签代码（如 wenzhou），唯一。
   |                                   ^^
16 |         display_name: 显示名称（如 温州）。
17 |         category: 标签分类（如 location、environment）。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/tag.py:15:30
   |
13 |     Attributes:
14 |         id: 标签主键。
15 |         name: 标签代码（如 wenzhou），唯一。
   |                                     ^^
16 |         display_name: 显示名称（如 温州）。
17 |         category: 标签分类（如 location、environment）。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/tag.py:16:27
   |
14 |         id: 标签主键。
15 |         name: 标签代码（如 wenzhou），唯一。
16 |         display_name: 显示名称（如 温州）。
   |                               ^^
17 |         category: 标签分类（如 location、environment）。
18 |         color: 标签颜色（如 primary、success）。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/tag.py:16:32
   |
14 |         id: 标签主键。
15 |         name: 标签代码（如 wenzhou），唯一。
16 |         display_name: 显示名称（如 温州）。
   |                                        ^^
17 |         category: 标签分类（如 location、environment）。
18 |         color: 标签颜色（如 primary、success）。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/tag.py:17:23
   |
15 |         name: 标签代码（如 wenzhou），唯一。
16 |         display_name: 显示名称（如 温州）。
17 |         category: 标签分类（如 location、environment）。
   |                           ^^
18 |         color: 标签颜色（如 primary、success）。
19 |         is_active: 是否激活。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/tag.py:17:46
   |
15 |         name: 标签代码（如 wenzhou），唯一。
16 |         display_name: 显示名称（如 温州）。
17 |         category: 标签分类（如 location、environment）。
   |                                                     ^^
18 |         color: 标签颜色（如 primary、success）。
19 |         is_active: 是否激活。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/tag.py:18:20
   |
16 |         display_name: 显示名称（如 温州）。
17 |         category: 标签分类（如 location、environment）。
18 |         color: 标签颜色（如 primary、success）。
   |                        ^^
19 |         is_active: 是否激活。
20 |         created_at: 创建时间。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/tag.py:18:38
   |
16 |         display_name: 显示名称（如 温州）。
17 |         category: 标签分类（如 location、environment）。
18 |         color: 标签颜色（如 primary、success）。
   |                                             ^^
19 |         is_active: 是否激活。
20 |         created_at: 创建时间。
   |

FBT001 Boolean-typed positional argument in function definition
  --> app/models/tag.py:45:9
   |
43 |         category: str,
44 |         color: str = "primary",
45 |         is_active: bool = True,
   |         ^^^^^^^^^
46 |     ) -> None:
47 |         """初始化标签。.
   |

FBT002 Boolean default positional argument in function definition
  --> app/models/tag.py:45:9
   |
43 |         category: str,
44 |         color: str = "primary",
45 |         is_active: bool = True,
   |         ^^^^^^^^^
46 |     ) -> None:
47 |         """初始化标签。.
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/tag.py:50:23
   |
49 |         Args:
50 |             name: 标签代码（如 wenzhou），必须唯一。
   |                           ^^
51 |             display_name: 显示名称（如 温州）。
52 |             category: 标签分类（如 location=地区、environment=环境）。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/tag.py:50:33
   |
49 |         Args:
50 |             name: 标签代码（如 wenzhou），必须唯一。
   |                                       ^^
51 |             display_name: 显示名称（如 温州）。
52 |             category: 标签分类（如 location=地区、environment=环境）。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/tag.py:50:34
   |
49 |         Args:
50 |             name: 标签代码（如 wenzhou），必须唯一。
   |                                         ^^
51 |             display_name: 显示名称（如 温州）。
52 |             category: 标签分类（如 location=地区、environment=环境）。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/tag.py:51:31
   |
49 |         Args:
50 |             name: 标签代码（如 wenzhou），必须唯一。
51 |             display_name: 显示名称（如 温州）。
   |                                   ^^
52 |             category: 标签分类（如 location=地区、environment=环境）。
53 |             color: 标签颜色（如 primary=蓝色、success=绿色），默认为 primary。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/tag.py:51:36
   |
49 |         Args:
50 |             name: 标签代码（如 wenzhou），必须唯一。
51 |             display_name: 显示名称（如 温州）。
   |                                            ^^
52 |             category: 标签分类（如 location=地区、environment=环境）。
53 |             color: 标签颜色（如 primary=蓝色、success=绿色），默认为 primary。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/tag.py:52:27
   |
50 |             name: 标签代码（如 wenzhou），必须唯一。
51 |             display_name: 显示名称（如 温州）。
52 |             category: 标签分类（如 location=地区、environment=环境）。
   |                               ^^
53 |             color: 标签颜色（如 primary=蓝色、success=绿色），默认为 primary。
54 |             is_active: 是否激活，默认为 True。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/tag.py:52:56
   |
50 |             name: 标签代码（如 wenzhou），必须唯一。
51 |             display_name: 显示名称（如 温州）。
52 |             category: 标签分类（如 location=地区、environment=环境）。
   |                                                                   ^^
53 |             color: 标签颜色（如 primary=蓝色、success=绿色），默认为 primary。
54 |             is_active: 是否激活，默认为 True。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/tag.py:53:24
   |
51 |             display_name: 显示名称（如 温州）。
52 |             category: 标签分类（如 location=地区、environment=环境）。
53 |             color: 标签颜色（如 primary=蓝色、success=绿色），默认为 primary。
   |                            ^^
54 |             is_active: 是否激活，默认为 True。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/tag.py:53:48
   |
51 |             display_name: 显示名称（如 温州）。
52 |             category: 标签分类（如 location=地区、environment=环境）。
53 |             color: 标签颜色（如 primary=蓝色、success=绿色），默认为 primary。
   |                                                           ^^
54 |             is_active: 是否激活，默认为 True。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/tag.py:53:49
   |
51 |             display_name: 显示名称（如 温州）。
52 |             category: 标签分类（如 location=地区、environment=环境）。
53 |             color: 标签颜色（如 primary=蓝色、success=绿色），默认为 primary。
   |                                                             ^^
54 |             is_active: 是否激活，默认为 True。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/tag.py:54:28
   |
52 |             category: 标签分类（如 location=地区、environment=环境）。
53 |             color: 标签颜色（如 primary=蓝色、success=绿色），默认为 primary。
54 |             is_active: 是否激活，默认为 True。
   |                                ^^
55 |
56 |         """
   |

ANN201 Missing return type annotation for public function `color_value`
  --> app/models/tag.py:64:9
   |
63 |     @property
64 |     def color_value(self):
   |         ^^^^^^^^^^^
65 |         """获取实际颜色值。.
   |
help: Add return type annotation

ANN201 Missing return type annotation for public function `color_name`
  --> app/models/tag.py:74:9
   |
73 |     @property
74 |     def color_name(self):
   |         ^^^^^^^^^^
75 |         """获取颜色名称。.
   |
help: Add return type annotation

ANN201 Missing return type annotation for public function `css_class`
  --> app/models/tag.py:84:9
   |
83 |     @property
84 |     def css_class(self):
   |         ^^^^^^^^^
85 |         """获取 CSS 类名。.
   |
help: Add return type annotation

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/models/tag.py:150:20
    |
149 |         Returns:
150 |             匹配的标签对象，不存在时返回 None。
    |                           ^^
151 |
152 |         """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/models/tag.py:160:22
    |
159 |         Returns:
160 |             标签分类的选项列表，每项包含分类代码和显示名称。
    |                               ^^
161 |
162 |         """
    |

D205 1 blank line required between summary line and description
 --> app/models/unified_log.py:1:1
  |
1 | / """鲸落 - 统一日志系统数据模型
2 | | 基于structlog的统一日志存储模型.
3 | | """
  | |___^
4 |
5 |   from datetime import datetime, timedelta
  |
help: Insert single blank line

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/unified_log.py:18:27
   |
16 |     """统一日志表。.
17 |
18 |     基于 structlog 的统一日志存储模型，记录系统运行过程中的所有日志信息。
   |                                      ^^
19 |     支持多级别日志、模块分类、错误追踪和上下文信息存储。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/unified_log.py:23:25
   |
21 |     Attributes:
22 |         id: 主键 ID。
23 |         timestamp: 日志时间戳（UTC）。
   |                              ^^
24 |         level: 日志级别（DEBUG/INFO/WARNING/ERROR/CRITICAL）。
25 |         module: 模块/组件名。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/unified_log.py:23:29
   |
21 |     Attributes:
22 |         id: 主键 ID。
23 |         timestamp: 日志时间戳（UTC）。
   |                                   ^^
24 |         level: 日志级别（DEBUG/INFO/WARNING/ERROR/CRITICAL）。
25 |         module: 模块/组件名。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/unified_log.py:24:20
   |
22 |         id: 主键 ID。
23 |         timestamp: 日志时间戳（UTC）。
24 |         level: 日志级别（DEBUG/INFO/WARNING/ERROR/CRITICAL）。
   |                        ^^
25 |         module: 模块/组件名。
26 |         message: 日志消息。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/unified_log.py:24:54
   |
22 |         id: 主键 ID。
23 |         timestamp: 日志时间戳（UTC）。
24 |         level: 日志级别（DEBUG/INFO/WARNING/ERROR/CRITICAL）。
   |                                                           ^^
25 |         module: 模块/组件名。
26 |         message: 日志消息。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/unified_log.py:27:26
   |
25 |         module: 模块/组件名。
26 |         message: 日志消息。
27 |         traceback: 错误堆栈追踪（仅 ERROR/CRITICAL）。
   |                                ^^
28 |         context: 附加上下文（JSON 格式）。
29 |         created_at: 记录创建时间。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/unified_log.py:27:43
   |
25 |         module: 模块/组件名。
26 |         message: 日志消息。
27 |         traceback: 错误堆栈追踪（仅 ERROR/CRITICAL）。
   |                                                   ^^
28 |         context: 附加上下文（JSON 格式）。
29 |         created_at: 记录创建时间。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/unified_log.py:28:23
   |
26 |         message: 日志消息。
27 |         traceback: 错误堆栈追踪（仅 ERROR/CRITICAL）。
28 |         context: 附加上下文（JSON 格式）。
   |                            ^^
29 |         created_at: 记录创建时间。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/unified_log.py:28:31
   |
26 |         message: 日志消息。
27 |         traceback: 错误堆栈追踪（仅 ERROR/CRITICAL）。
28 |         context: 附加上下文（JSON 格式）。
   |                                       ^^
29 |         created_at: 记录创建时间。
   |

ERA001 Found commented-out code
  --> app/models/unified_log.py:38:5
   |
36 |     id = Column(Integer, primary_key=True, autoincrement=True)
37 |
38 |     # 日志时间戳 (UTC)
   |     ^^^^^^^^^^^^^^^^^^
39 |     timestamp = Column(DateTime(timezone=True), nullable=False, index=True)
   |
help: Remove commented-out code

ERA001 Found commented-out code
  --> app/models/unified_log.py:50:5
   |
48 |     message = Column(Text, nullable=False)
49 |
50 |     # 错误堆栈追踪 (仅ERROR/CRITICAL)
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
51 |     traceback = Column(Text, nullable=True)
   |
help: Remove commented-out code

ERA001 Found commented-out code
  --> app/models/unified_log.py:53:5
   |
51 |     traceback = Column(Text, nullable=True)
52 |
53 |     # 附加上下文 (JSON格式)
   |     ^^^^^^^^^^^^^^^^^^^^^^^
54 |     context = Column(JSON, nullable=True)
   |
help: Remove commented-out code

PLR0913 Too many arguments in function definition (6 > 5)
   --> app/models/unified_log.py:98:9
    |
 97 |     @classmethod
 98 |     def create_log_entry(
    |         ^^^^^^^^^^^^^^^^
 99 |         cls,
100 |         level: LogLevel,
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/models/unified_log.py:113:30
    |
111 |             module: 记录来源模块。
112 |             message: 日志消息。
113 |             traceback: 错误堆栈信息，可选。
    |                                    ^^
114 |             context: 额外上下文字典，可选。
115 |             timestamp: 指定日志时间，未提供时使用当前时间。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/models/unified_log.py:114:29
    |
112 |             message: 日志消息。
113 |             traceback: 错误堆栈信息，可选。
114 |             context: 额外上下文字典，可选。
    |                                    ^^
115 |             timestamp: 指定日志时间，未提供时使用当前时间。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/models/unified_log.py:115:30
    |
113 |             traceback: 错误堆栈信息，可选。
114 |             context: 额外上下文字典，可选。
115 |             timestamp: 指定日志时间，未提供时使用当前时间。
    |                                    ^^
116 |
117 |         Returns:
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/models/unified_log.py:125:23
    |
123 |             timestamp = time_utils.now()
124 |         elif timestamp.tzinfo is None:
125 |             # 如果没有时区信息，假设为UTC时间
    |                               ^^
126 |             from app.utils.time_utils import UTC_TZ
    |

PLC0415 `import` should be at the top-level of a file
   --> app/models/unified_log.py:126:13
    |
124 |         elif timestamp.tzinfo is None:
125 |             # 如果没有时区信息，假设为UTC时间
126 |             from app.utils.time_utils import UTC_TZ
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
127 |
128 |             timestamp = timestamp.replace(tzinfo=UTC_TZ)
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/models/unified_log.py:144:27
    |
143 |         Args:
144 |             hours: 统计的时间范围（小时），默认 24 小时。
    |                                  ^^
145 |
146 |         Returns:
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/models/unified_log.py:144:30
    |
143 |         Args:
144 |             hours: 统计的时间范围（小时），默认 24 小时。
    |                                        ^^
145 |
146 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/models/unified_log.py:144:31
    |
143 |         Args:
144 |             hours: 统计的时间范围（小时），默认 24 小时。
    |                                          ^^
145 |
146 |         Returns:
    |

PLC0415 `import` should be at the top-level of a file
   --> app/models/unified_log.py:150:9
    |
149 |         """
150 |         from sqlalchemy import func
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^
151 |
152 |         start_time = time_utils.now() - timedelta(hours=hours)
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/user.py:13:19
   |
11 |     """用户模型。.
12 |
13 |     管理系统用户的认证和授权信息，包括用户名、密码、角色等。
   |                                 ^^
14 |     继承 Flask-Login 的 UserMixin 提供会话管理功能。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/user.py:17:18
   |
16 |     Attributes:
17 |         id: 用户 ID，主键。
   |                    ^^
18 |         username: 用户名，唯一索引。
19 |         password: 加密后的密码（bcrypt）。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/user.py:18:22
   |
16 |     Attributes:
17 |         id: 用户 ID，主键。
18 |         username: 用户名，唯一索引。
   |                         ^^
19 |         password: 加密后的密码（bcrypt）。
20 |         role: 用户角色，可选值：admin、user。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/user.py:19:25
   |
17 |         id: 用户 ID，主键。
18 |         username: 用户名，唯一索引。
19 |         password: 加密后的密码（bcrypt）。
   |                               ^^
20 |         role: 用户角色，可选值：admin、user。
21 |         created_at: 创建时间。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/user.py:19:32
   |
17 |         id: 用户 ID，主键。
18 |         username: 用户名，唯一索引。
19 |         password: 加密后的密码（bcrypt）。
   |                                       ^^
20 |         role: 用户角色，可选值：admin、user。
21 |         created_at: 创建时间。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/models/user.py:20:19
   |
18 |         username: 用户名，唯一索引。
19 |         password: 加密后的密码（bcrypt）。
20 |         role: 用户角色，可选值：admin、user。
   |                       ^^
21 |         created_at: 创建时间。
22 |         last_login: 最后登录时间。
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/models/user.py:20:23
   |
18 |         username: 用户名，唯一索引。
19 |         password: 加密后的密码（bcrypt）。
20 |         role: 用户角色，可选值：admin、user。
   |                               ^^
21 |         created_at: 创建时间。
22 |         last_login: 最后登录时间。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/models/user.py:56:16
   |
55 |     def set_password(self, password: str) -> None:
56 |         """设置密码（加密）。.
   |                    ^^
57 |
58 |         Args:
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/models/user.py:56:19
   |
55 |     def set_password(self, password: str) -> None:
56 |         """设置密码（加密）。.
   |                          ^^
57 |
58 |         Args:
   |

PLR2004 Magic value used in comparison, consider replacing `8` with a constant variable
  --> app/models/user.py:69:28
   |
67 |         """
68 |         # 增加密码强度验证
69 |         if len(password) < 8:
   |                            ^
70 |             error_msg = "密码长度至少8位"
71 |             raise ValueError(error_msg)
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/models/user.py:124:23
    |
122 |     @classmethod
123 |     def active_admin_count(cls, *, exclude_user_id: int | None = None) -> int:
124 |         """统计当前活跃管理员数量，可选排除指定用户。.
    |                                  ^^
125 |
126 |         Args:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/models/user.py:127:40
    |
126 |         Args:
127 |             exclude_user_id: 需要排除的用户 ID，用于编辑场景。
    |                                               ^^
128 |
129 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/routes/__init__.py:3:15
  |
1 | """路由模块。.
2 |
3 | 定义所有 HTTP 路由端点，处理客户端请求并返回响应。
  |                       ^^
  |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
 --> app/routes/__init__.py:6:5
  |
6 | 主要路由：
  |         ^^
7 | - auth: 认证相关路由（登录、登出、修改密码）
8 | - instances: 实例管理路由
  |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
 --> app/routes/__init__.py:7:15
  |
6 | 主要路由：
7 | - auth: 认证相关路由（登录、登出、修改密码）
  |                     ^^
8 | - instances: 实例管理路由
9 | - credentials: 凭据管理路由
  |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
 --> app/routes/__init__.py:7:26
  |
6 | 主要路由：
7 | - auth: 认证相关路由（登录、登出、修改密码）
  |                                           ^^
8 | - instances: 实例管理路由
9 | - credentials: 凭据管理路由
  |

F401 `flask.Blueprint` imported but unused
  --> app/routes/__init__.py:22:19
   |
20 | """
21 |
22 | from flask import Blueprint
   |                   ^^^^^^^^^
23 |
24 | # 创建主蓝图
   |
help: Remove unused import: `flask.Blueprint`

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/__init__.py:26:12
   |
24 | # 创建主蓝图
25 |
26 | # 该文件仅作为包标识，避免在导入阶段引入循环依赖。
   |                     ^^
   |

INP001 File `app/routes/accounts/classifications.py` is part of an implicit namespace package. Add an `__init__.py`.
--> app/routes/accounts/classifications.py:1:1

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
 --> app/routes/accounts/classifications.py:2:14
  |
2 | """Accounts 域：账户分类管理路由。."""
  |               ^^
3 |
4 | import json
  |

A004 Import `SystemError` is shadowing a Python builtin
  --> app/routes/accounts/classifications.py:12:24
   |
10 | from app.constants import HttpStatus
11 | from app.constants.colors import ThemeColors
12 | from app.errors import SystemError, ValidationError
   |                        ^^^^^^^^^^^
13 | from app.models.account_classification import (
14 |     AccountClassification,
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/accounts/classifications.py:97:16
   |
95 |     """获取所有账户分类。.
96 |
97 |     按优先级和创建时间排序，包含规则数量统计。
   |                           ^^
98 |
99 |     Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/accounts/classifications.py:100:28
    |
 99 |     Returns:
100 |         (JSON 响应, HTTP 状态码)，包含分类列表。
    |                                 ^^
101 |
102 |     Raises:
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/accounts/classifications.py:268:20
    |
266 |     if rule_count or assignment_count:
267 |         return jsonify_unified_error_message(
268 |             "分类仍在使用，请先迁移关联规则/账户后再删除",
    |                          ^^
269 |             status_code=HttpStatus.CONFLICT,
270 |             message_key="CLASSIFICATION_IN_USE",
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/accounts/classifications.py:304:28
    |
303 |     Returns:
304 |         (JSON 响应, HTTP 状态码)，包含规则列表。
    |                                 ^^
305 |
306 |     Raises:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/accounts/classifications.py:310:36
    |
309 |     Query Parameters:
310 |         classification_id: 分类 ID 筛选，可选。
    |                                        ^^
311 |         db_type: 数据库类型筛选，可选。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/accounts/classifications.py:311:25
    |
309 |     Query Parameters:
310 |         classification_id: 分类 ID 筛选，可选。
311 |         db_type: 数据库类型筛选，可选。
    |                                ^^
312 |
313 |     """
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/accounts/classifications.py:354:16
    |
352 | @view_required
353 | def list_rules() -> tuple[Response, int]:
354 |     """获取所有规则列表（按数据库类型分组）。.
    |                        ^^
355 |
356 |     Returns:
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/accounts/classifications.py:354:25
    |
352 | @view_required
353 | def list_rules() -> tuple[Response, int]:
354 |     """获取所有规则列表（按数据库类型分组）。.
    |                                          ^^
355 |
356 |     Returns:
    |

PERF401 Use a list comprehension to create a transformed list
   --> app/routes/accounts/classifications.py:376:9
    |
374 |       result = []
375 |       for rule in rules:
376 | /         result.append(
377 | |             {
378 | |                 "id": rule.id,
379 | |                 "rule_name": rule.rule_name,
380 | |                 "classification_id": rule.classification_id,
381 | |                 "classification_name": rule.classification.name if rule.classification else None,
382 | |                 "db_type": rule.db_type,
383 | |                 "rule_expression": rule.rule_expression,
384 | |                 "is_active": rule.is_active,
385 | |                 "matched_accounts_count": 0,
386 | |                 "created_at": rule.created_at.isoformat() if rule.created_at else None,
387 | |                 "updated_at": rule.updated_at.isoformat() if rule.updated_at else None,
388 | |             },
389 | |         )
    | |_________^
390 |
391 |       rules_by_db_type: dict[str, list[dict[str, object]]] = {}
    |
help: Replace for loop with list comprehension

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/accounts/classifications.py:427:38
    |
425 |             ]
426 |         except ValueError as exc:
427 |             msg = "rule_ids 参数必须为整数ID，使用逗号分隔"
    |                                             ^^
428 |             raise ValidationError(msg) from exc
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/accounts/classifications.py:580:28
    |
579 |     Returns:
580 |         (JSON 响应, HTTP 状态码)，包含分类结果统计。
    |                                 ^^
581 |
582 |     Raises:
    |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/accounts/classifications.py:722:7
    |
721 | # ---------------------------------------------------------------------------
722 | # 表单路由（独立页面）
    |           ^^
723 | # ---------------------------------------------------------------------------
724 | _classification_create_view = AccountClassificationFormView.as_view("classification_create_form")
    |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/accounts/classifications.py:722:12
    |
721 | # ---------------------------------------------------------------------------
722 | # 表单路由（独立页面）
    |                     ^^
723 | # ---------------------------------------------------------------------------
724 | _classification_create_view = AccountClassificationFormView.as_view("classification_create_form")
    |

PLC0415 `import` should be at the top-level of a file
   --> app/routes/accounts/classifications.py:773:5
    |
772 |     """
773 |     from app.models.permission_config import PermissionConfig
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
774 |
775 |     # 从数据库获取权限配置
    |

INP001 File `app/routes/accounts/ledgers.py` is part of an implicit namespace package. Add an `__init__.py`.
--> app/routes/accounts/ledgers.py:1:1

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
 --> app/routes/accounts/ledgers.py:2:14
  |
2 | """Accounts 域：账户台账（Ledgers）视图与 API。."""
  |               ^^
3 |
4 | from flask import Blueprint, Response, render_template, request
  |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
 --> app/routes/accounts/ledgers.py:2:19
  |
2 | """Accounts 域：账户台账（Ledgers）视图与 API。."""
  |                         ^^
3 |
4 | from flask import Blueprint, Response, render_template, request
  |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
 --> app/routes/accounts/ledgers.py:2:27
  |
2 | """Accounts 域：账户台账（Ledgers）视图与 API。."""
  |                                  ^^
3 |
4 | from flask import Blueprint, Response, render_template, request
  |

A004 Import `SystemError` is shadowing a Python builtin
  --> app/routes/accounts/ledgers.py:9:24
   |
 8 | from app.constants import DATABASE_TYPES, DatabaseType
 9 | from app.errors import SystemError
   |                        ^^^^^^^^^^^
10 | from app.models.account_classification import (
11 |     AccountClassification,
   |

C901 `list_accounts` is too complex (18 > 10)
  --> app/routes/accounts/ledgers.py:32:5
   |
30 | @login_required
31 | @view_required
32 | def list_accounts(db_type: str | None = None) -> str | tuple[Response, int]:
   |     ^^^^^^^^^^^^^
33 |     """账户列表页面。.
   |

PLR0912 Too many branches (17 > 12)
  --> app/routes/accounts/ledgers.py:32:5
   |
30 | @login_required
31 | @view_required
32 | def list_accounts(db_type: str | None = None) -> str | tuple[Response, int]:
   |     ^^^^^^^^^^^^^
33 |     """账户列表页面。.
   |

PLR0915 Too many statements (65 > 50)
  --> app/routes/accounts/ledgers.py:32:5
   |
30 | @login_required
31 | @view_required
32 | def list_accounts(db_type: str | None = None) -> str | tuple[Response, int]:
   |     ^^^^^^^^^^^^^
33 |     """账户列表页面。.
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/accounts/ledgers.py:35:11
   |
33 |     """账户列表页面。.
34 |
35 |     显示账户列表，支持按数据库类型、实例、搜索关键词、锁定状态、
   |                 ^^
36 |     超级用户状态、插件、标签和分类进行筛选。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/accounts/ledgers.py:39:25
   |
38 |     Args:
39 |         db_type: 数据库类型筛选，可选值：mysql/postgresql/oracle/sqlserver/all。
   |                                ^^
40 |
41 |     Returns:
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/routes/accounts/ledgers.py:39:29
   |
38 |     Args:
39 |         db_type: 数据库类型筛选，可选值：mysql/postgresql/oracle/sqlserver/all。
   |                                        ^^
40 |
41 |     Returns:
   |

PLC0415 `import` should be at the top-level of a file
  --> app/routes/accounts/ledgers.py:76:9
   |
74 |     # 搜索过滤 - 支持用户名、实例名称、IP地址搜索
75 |     if search:
76 |         from app import db
   |         ^^^^^^^^^^^^^^^^^^
77 |         # 通过JOIN实例表来搜索实例名称和IP地址
78 |         query = query.join(Instance, AccountPermission.instance_id == Instance.id)
   |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/routes/accounts/ledgers.py:87:13
   |
85 |         )
86 |
87 |     # 锁定状态过滤（基于 AccountPermission.is_locked）
   |                   ^^
88 |     if is_locked is not None:
89 |         if is_locked == "true":
   |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/routes/accounts/ledgers.py:87:44
   |
85 |         )
86 |
87 |     # 锁定状态过滤（基于 AccountPermission.is_locked）
   |                                                     ^^
88 |     if is_locked is not None:
89 |         if is_locked == "true":
   |

BLE001 Do not catch blind exception: `Exception`
   --> app/routes/accounts/ledgers.py:104:16
    |
102 |             query = query.join(Instance).join(Instance.tags).filter(Tag.name.in_(tags))
103 |             # 应用标签过滤
104 |         except Exception as e:
    |                ^^^^^^^^^
105 |             log_error(
106 |                 "标签过滤失败",
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/accounts/ledgers.py:111:23
    |
109 |                 error=str(e),
110 |             )
111 |             # 如果标签过滤失败，继续执行但不进行标签过滤
    |                               ^^
112 |     # 标签过滤逻辑
    |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/accounts/ledgers.py:114:21
    |
112 |     # 标签过滤逻辑
113 |
114 |     # 分类过滤 - 使用分配表查询（现在分配表数据是准确的）
    |                                ^^
115 |     if classification_filter:
116 |         from app.models.account_classification import AccountClassification, AccountClassificationAssignment
    |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/accounts/ledgers.py:114:33
    |
112 |     # 标签过滤逻辑
113 |
114 |     # 分类过滤 - 使用分配表查询（现在分配表数据是准确的）
    |                                                        ^^
115 |     if classification_filter:
116 |         from app.models.account_classification import AccountClassification, AccountClassificationAssignment
    |

PLC0415 `import` should be at the top-level of a file
   --> app/routes/accounts/ledgers.py:116:9
    |
114 |     # 分类过滤 - 使用分配表查询（现在分配表数据是准确的）
115 |     if classification_filter:
116 |         from app.models.account_classification import AccountClassification, AccountClassificationAssignment
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
117 |
118 |         try:
    |

E501 Line too long (123 > 120)
   --> app/routes/accounts/ledgers.py:126:121
    |
124 |                 query.join(AccountClassificationAssignment)
125 |                 .join(AccountClassification)
126 |                 .filter(AccountClassification.id == classification_id, AccountClassificationAssignment.is_active.is_(True))
    |                                                                                                                         ^^^
127 |             )
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/accounts/ledgers.py:136:21
    |
134 |                 error=str(e),
135 |             )
136 |             # 如果转换失败，忽略分类过滤
    |                           ^^
137 |
138 |     # 排序
    |

PLC0415 `import` should be at the top-level of a file
   --> app/routes/accounts/ledgers.py:169:5
    |
168 |     # 获取账户分类信息
169 |     from app.models.account_classification import AccountClassificationAssignment
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
170 |
171 |     classifications = {}
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/accounts/ledgers.py:248:35
    |
247 |     Returns:
248 |         (payload, status_code) 的元组，成功时包含权限详情。
    |                                      ^^
249 |
250 |     """
    |

C901 `list_accounts_data` is too complex (18 > 10)
   --> app/routes/accounts/ledgers.py:313:5
    |
311 | @login_required
312 | @view_required
313 | def list_accounts_data() -> Response:
    |     ^^^^^^^^^^^^^^^^^^
314 |     """Grid.js 账户列表 API。.
    |

PLR0912 Too many branches (17 > 12)
   --> app/routes/accounts/ledgers.py:313:5
    |
311 | @login_required
312 | @view_required
313 | def list_accounts_data() -> Response:
    |     ^^^^^^^^^^^^^^^^^^
314 |     """Grid.js 账户列表 API。.
    |

PLR0915 Too many statements (62 > 50)
   --> app/routes/accounts/ledgers.py:313:5
    |
311 | @login_required
312 | @view_required
313 | def list_accounts_data() -> Response:
    |     ^^^^^^^^^^^^^^^^^^
314 |     """Grid.js 账户列表 API。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/accounts/ledgers.py:317:18
    |
316 |     Returns:
317 |         JSON 响应对象，包含分页后的账户数据。
    |                      ^^
318 |
319 |     """
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/routes/accounts/ledgers.py:369:16
    |
367 |         try:
368 |             query = query.join(Instance).join(Instance.tags).filter(Tag.name.in_(tags))
369 |         except Exception as exc:
    |                ^^^^^^^^^
370 |             log_error(
371 |                 "标签过滤失败",
    |

INP001 File `app/routes/accounts/statistics.py` is part of an implicit namespace package. Add an `__init__.py`.
--> app/routes/accounts/statistics.py:1:1

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
 --> app/routes/accounts/statistics.py:1:14
  |
1 | """Accounts 域：统计视图与 API。."""
  |               ^^
2 |
3 | from flask import Blueprint, Response, flash, render_template, request
  |

A004 Import `SystemError` is shadowing a Python builtin
 --> app/routes/accounts/statistics.py:7:24
  |
6 | from app.constants import FlashCategory
7 | from app.errors import SystemError
  |                        ^^^^^^^^^^^
8 | from app.models.instance import Instance
9 | from app.services.statistics.account_statistics_service import (
  |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/accounts/statistics.py:30:18
   |
29 |     Returns:
30 |         渲染的账户统计页面，包含统计数据、最近同步记录和活跃实例列表。
   |                           ^^
31 |
32 |     """
   |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/accounts/statistics.py:37:26
   |
35 |     except SystemError:
36 |         stats = empty_statistics()
37 |         flash("获取账户统计信息失败，请稍后重试", FlashCategory.ERROR)
   |                                    ^^
38 |
39 |     from app.models.sync_session import SyncSession
   |

PLC0415 `import` should be at the top-level of a file
  --> app/routes/accounts/statistics.py:39:5
   |
37 |         flash("获取账户统计信息失败，请稍后重试", FlashCategory.ERROR)
38 |
39 |     from app.models.sync_session import SyncSession
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
40 |
41 |     recent_syncs = SyncSession.query.order_by(SyncSession.created_at.desc()).limit(10).all()
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/accounts/statistics.py:60:28
   |
59 |     Returns:
60 |         (JSON 响应, HTTP 状态码)，包含聚合统计数据。
   |                                 ^^
61 |
62 |     Raises:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/accounts/statistics.py:86:28
   |
85 |     Returns:
86 |         (JSON 响应, HTTP 状态码)，包含统计汇总数据。
   |                                 ^^
87 |
88 |     Query Parameters:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/accounts/statistics.py:89:30
   |
88 |     Query Parameters:
89 |         instance_id: 实例 ID 筛选，可选。
   |                                  ^^
90 |         db_type: 数据库类型筛选，可选。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/accounts/statistics.py:90:25
   |
88 |     Query Parameters:
89 |         instance_id: 实例 ID 筛选，可选。
90 |         db_type: 数据库类型筛选，可选。
   |                                ^^
91 |
92 |     """
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/accounts/statistics.py:107:28
    |
106 |     Returns:
107 |         (JSON 响应, HTTP 状态码)，包含各数据库类型的账户统计。
    |                                 ^^
108 |
109 |     """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/accounts/statistics.py:121:28
    |
120 |     Returns:
121 |         (JSON 响应, HTTP 状态码)，包含各分类的账户统计。
    |                                 ^^
122 |
123 |     """
    |

INP001 File `app/routes/accounts/sync.py` is part of an implicit namespace package. Add an `__init__.py`.
--> app/routes/accounts/sync.py:1:1

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
 --> app/routes/accounts/sync.py:2:14
  |
2 | """Accounts 域：账户同步 API 路由。."""
  |               ^^
3 |
4 | import threading
  |

A004 Import `SystemError` is shadowing a Python builtin
  --> app/routes/accounts/sync.py:11:39
   |
 9 | from app import db
10 | from app.constants.sync_constants import SyncOperationType
11 | from app.errors import NotFoundError, SystemError, ValidationError as AppValidationError
   |                                       ^^^^^^^^^^^
12 | from app.models.instance import Instance
13 | from app.services.accounts_sync import accounts_sync_service
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/accounts/sync.py:52:23
   |
51 |     Args:
52 |         result: 同步结果字典，可能为 None。
   |                             ^^
53 |         context: 上下文描述，用于生成默认消息。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/accounts/sync.py:53:23
   |
51 |     Args:
52 |         result: 同步结果字典，可能为 None。
53 |         context: 上下文描述，用于生成默认消息。
   |                            ^^
54 |
55 |     Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/accounts/sync.py:81:19
   |
79 |     """触发后台批量同步所有实例的账户信息。.
80 |
81 |     在后台线程中启动批量同步任务，不阻塞请求。
   |                                 ^^
82 |
83 |     Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/accounts/sync.py:84:16
   |
83 |     Returns:
84 |         JSON 响应，包含任务 ID。
   |                  ^^
85 |
86 |     Raises:
   |

TRY301 Abstract `raise` to an inner function
   --> app/routes/accounts/sync.py:102:13
    |
100 |             )
101 |             msg = "没有找到活跃的数据库实例"
102 |             raise AppValidationError(msg)
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
103 |
104 |         created_by = getattr(current_user, "id", None)
    |

PLC0415 `import` should be at the top-level of a file
   --> app/routes/accounts/sync.py:107:13
    |
106 |         def _run_sync_task(captured_created_by: int | None) -> None:
107 |             from app.tasks.accounts_sync_tasks import sync_accounts
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
108 |
109 |             try:
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/routes/accounts/sync.py:111:20
    |
109 |             try:
110 |                 sync_accounts(manual_run=True, created_by=captured_created_by)
111 |             except Exception as exc:  # pragma: no cover - 后台线程日志
    |                    ^^^^^^^^^
112 |                 log_error(
113 |                     "后台批量账户同步失败",
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/accounts/sync.py:135:36
    |
134 |         return jsonify_unified_success(
135 |             message="批量账户同步任务已在后台启动，请稍后在会话中心查看进度。",
    |                                                  ^^
136 |             data={"manual_job_id": thread.name},
137 |         )
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/accounts/sync.py:148:26
    |
146 |             error=str(exc),
147 |         )
148 |         msg = "批量同步任务触发失败，请稍后重试"
    |                                    ^^
149 |         raise SystemError(msg) from exc
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/accounts/sync.py:157:19
    |
155 | @require_csrf
156 | def sync_instance_accounts(instance_id: int) -> Response:
157 |     """同步指定实例的账户信息，统一返回 JSON。.
    |                              ^^
158 |
159 |     Args:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/accounts/sync.py:163:16
    |
162 |     Returns:
163 |         JSON 响应，包含同步结果和统计信息。
    |                  ^^
164 |
165 |     Raises:
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/accounts/sync.py:235:22
    |
233 |             error=str(exc),
234 |         )
235 |         msg = "账户同步失败，请重试"
    |                            ^^
236 |         raise SystemError(msg) from exc
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/auth.py:52:13
   |
50 |     """用户登录 API。.
51 |
52 |     验证用户名和密码，成功后返回 JWT token。
   |                     ^^
53 |
54 |     Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/auth.py:55:16
   |
54 |     Returns:
55 |         JSON 响应，包含 access_token、refresh_token 和用户信息。
   |                  ^^
56 |
57 |     Raises:
   |

RUF001 String contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/routes/auth.py:79:21
   |
77 |     if not username or not password:
78 |         auth_logger.warning(
79 |             "API登录失败：用户名或密码为空",
   |                         ^^
80 |             username=username,
81 |             ip_address=request.remote_addr,
   |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/auth.py:103:20
    |
101 |             )
102 |
103 |             # API登录，返回JWT token
    |                      ^^
104 |             access_token = create_access_token(identity=user.id)
105 |             refresh_token = create_refresh_token(identity=user.id)
    |

RUF001 String contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/routes/auth.py:122:21
    |
121 |         auth_logger.warning(
122 |             "API登录失败：用户账户已禁用",
    |                         ^^
123 |             username=username,
124 |             ip_address=request.remote_addr,
    |

RUF001 String contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/routes/auth.py:132:17
    |
131 |     auth_logger.warning(
132 |         "API登录失败：用户名或密码错误",
    |                     ^^
133 |         username=username,
134 |         ip_address=request.remote_addr,
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/auth.py:148:17
    |
146 |     """用户登录页面。.
147 |
148 |     GET 请求渲染登录页面，POST 请求处理登录逻辑。
    |                         ^^
149 |
150 |     Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/auth.py:152:24
    |
150 |     Returns:
151 |         GET: 渲染的登录页面。
152 |         POST: 成功时重定向到首页，失败时重新渲染登录页面。
    |                                 ^^
153 |
154 |     Query Parameters:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/auth.py:155:26
    |
154 |     Query Parameters:
155 |         next: 登录成功后的重定向地址，可选。
    |                                     ^^
156 |
157 |     """
    |

RUF001 String contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/routes/auth.py:174:24
    |
172 |         if not username or not password:
173 |             auth_logger.warning(
174 |                 "页面登录失败：用户名或密码为空",
    |                              ^^
175 |                 username=username,
176 |                 ip_address=request.remote_addr,
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/auth.py:199:23
    |
197 |                 )
198 |
199 |                 # 页面登录，重定向到首页
    |                           ^^
200 |                 flash("登录成功！", FlashCategory.SUCCESS)
201 |                 next_page = request.args.get("next")
    |

RUF001 String contains ambiguous `！` (FULLWIDTH EXCLAMATION MARK). Did you mean `!` (EXCLAMATION MARK)?
   --> app/routes/auth.py:200:28
    |
199 |                 # 页面登录，重定向到首页
200 |                 flash("登录成功！", FlashCategory.SUCCESS)
    |                                ^^
201 |                 next_page = request.args.get("next")
202 |                 return redirect(next_page) if next_page else redirect(url_for("dashboard.index"))
    |

RUF001 String contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/routes/auth.py:204:24
    |
202 |                 return redirect(next_page) if next_page else redirect(url_for("dashboard.index"))
203 |             auth_logger.warning(
204 |                 "页面登录失败：账户已被禁用",
    |                              ^^
205 |                 username=username,
206 |                 user_id=user.id,
    |

RUF001 String contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/routes/auth.py:212:24
    |
210 |         else:
211 |             auth_logger.warning(
212 |                 "页面登录失败：用户名或密码错误",
    |                              ^^
213 |                 username=username,
214 |                 ip_address=request.remote_addr,
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/auth.py:218:12
    |
216 |             flash("用户名或密码错误", FlashCategory.ERROR)
217 |
218 |     # GET请求，显示登录页面
    |              ^^
219 |
220 |     return render_template("auth/login.html")
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/auth.py:307:16
    |
306 |     Returns:
307 |         JSON 响应，包含 CSRF token。
    |                  ^^
308 |
309 |     """
    |

PLC0415 `import` should be at the top-level of a file
   --> app/routes/auth.py:310:5
    |
309 |     """
310 |     from flask_wtf.csrf import generate_csrf
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
311 |     return jsonify_unified_success(
312 |         data={"csrf_token": generate_csrf()},
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/auth.py:326:16
    |
325 |     Returns:
326 |         JSON 响应，包含新的 access_token。
    |                  ^^
327 |
328 |     """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/auth.py:349:16
    |
348 |     Returns:
349 |         JSON 响应，包含用户信息。
    |                  ^^
350 |
351 |     Raises:
    |

D205 1 blank line required between summary line and description
 --> app/routes/cache.py:2:1
  |
2 | / """鲸落 - 缓存管理路由
3 | | 提供缓存管理相关的API接口.
4 | | """
  | |___^
5 |
6 |   from flask import Blueprint, Response, request
  |
help: Insert single blank line

A004 Import `SystemError` is shadowing a Python builtin
  --> app/routes/cache.py:9:39
   |
 7 | from flask_login import current_user, login_required
 8 |
 9 | from app.errors import NotFoundError, SystemError, ValidationError
   |                                       ^^^^^^^^^^^
10 | from app.models import Instance
11 | from app.services.account_classification.orchestrator import AccountClassificationService
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/cache.py:107:20
    |
106 |     Returns:
107 |         成功时返回统一成功响应，失败抛出业务异常。
    |                               ^^
108 |
109 |     """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/cache.py:150:15
    |
149 |     Returns:
150 |         统一成功响应，data 中包含已清理实例数量。
    |                     ^^
151 |
152 |     """
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/routes/cache.py:165:16
    |
163 |             if cache_manager.invalidate_instance_cache(instance.id):
164 |                 cleared_count += 1
165 |         except Exception as exc:
    |                ^^^^^^^^^
166 |             log_error(f"清除实例 {instance.id} 缓存失败: {exc}", module="cache")
    |

E501 Line too long (121 > 120)
   --> app/routes/cache.py:174:112
    |
172 |         operator_id=getattr(current_user, "id", None),
173 |     )
174 |     return jsonify_unified_success(message=f"已清除 {cleared_count} 个实例的缓存", data={"cleared_count": cleared_count})
    |                                                                                                                         ^
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/cache.py:187:13
    |
186 |     Returns:
187 |         成功响应，失败时抛出异常交由统一处理。
    |                 ^^
188 |
189 |     """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/cache.py:218:26
    |
217 |     Args:
218 |         db_type: 数据库类型字符串，例如 mysql。
    |                                  ^^
219 |
220 |     Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/cache.py:221:13
    |
220 |     Returns:
221 |         成功响应，其中 message 描述已清理的类型。
    |                 ^^
222 |
223 |     """
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/routes/cache.py:281:16
    |
279 |                 "rules_count": len(rules_cache) if rules_cache else 0,
280 |             }
281 |         except Exception as exc:
    |                ^^^^^^^^^
282 |             log_error(f"获取数据库类型 {db_type} 缓存统计失败: {exc}", module="cache")
283 |             db_type_stats[db_type] = {
    |

D400 First line should end with a period
 --> app/routes/capacity/__init__.py:1:1
  |
1 | """Capacity 域蓝图入口, 汇聚聚合统计路由。"""
  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  |
help: Add period

D415 First line should end with a period, question mark, or exclamation point
 --> app/routes/capacity/__init__.py:1:1
  |
1 | """Capacity 域蓝图入口, 汇聚聚合统计路由。"""
  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  |
help: Add closing punctuation

C901 `aggregate_current` is too complex (28 > 10)
  --> app/routes/capacity/aggregations.py:58:5
   |
56 | @view_required
57 | @require_csrf
58 | def aggregate_current() -> Response:  # noqa: PLR0912, PLR0915
   |     ^^^^^^^^^^^^^^^^^
59 |     """手动触发当前周期数据聚合。.
   |

D205 1 blank line required between summary line and description
 --> app/routes/capacity/databases.py:1:1
  |
1 | / """数据库统计 API 路由
2 | | 提供数据库大小监控、历史数据、统计聚合等接口
3 | | 专注于数据库层面的统计功能.
4 | | """
  | |___^
5 |
6 |   import contextlib
  |
help: Insert single blank line

A004 Import `SystemError` is shadowing a Python builtin
  --> app/routes/capacity/databases.py:13:24
   |
12 | from app.constants import DATABASE_TYPES, PERIOD_TYPES
13 | from app.errors import SystemError, ValidationError
   |                        ^^^^^^^^^^^
14 | from app.models.instance_database import InstanceDatabase
15 | from app.services.database_type_service import DatabaseTypeService
   |

ANN201 Missing return type annotation for public function `list_databases`
  --> app/routes/capacity/databases.py:33:5
   |
31 | @login_required
32 | @view_required
33 | def list_databases():
   |     ^^^^^^^^^^^^^^
34 |     """数据库统计聚合页面（数据库统计层面）。.
   |
help: Add return type annotation

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/routes/capacity/databases.py:34:17
   |
32 | @view_required
33 | def list_databases():
34 |     """数据库统计聚合页面（数据库统计层面）。.
   |                          ^^
35 |
36 |     Returns:
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/routes/capacity/databases.py:34:25
   |
32 | @view_required
33 | def list_databases():
34 |     """数据库统计聚合页面（数据库统计层面）。.
   |                                          ^^
35 |
36 |     Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/capacity/databases.py:37:21
   |
36 |     Returns:
37 |         渲染的数据库统计聚合页面，包含筛选选项和图表。
   |                                 ^^
38 |
39 |     Query Parameters:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/capacity/databases.py:40:25
   |
39 |     Query Parameters:
40 |         db_type: 数据库类型筛选，可选。
   |                                ^^
41 |         instance: 实例 ID 筛选，可选。
42 |         database_id: 数据库 ID 筛选，可选。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/capacity/databases.py:41:27
   |
39 |     Query Parameters:
40 |         db_type: 数据库类型筛选，可选。
41 |         instance: 实例 ID 筛选，可选。
   |                               ^^
42 |         database_id: 数据库 ID 筛选，可选。
43 |         database: 数据库名称筛选，可选。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/capacity/databases.py:42:31
   |
40 |         db_type: 数据库类型筛选，可选。
41 |         instance: 实例 ID 筛选，可选。
42 |         database_id: 数据库 ID 筛选，可选。
   |                                    ^^
43 |         database: 数据库名称筛选，可选。
44 |         period_type: 统计周期类型，默认 'daily'。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/capacity/databases.py:43:26
   |
41 |         instance: 实例 ID 筛选，可选。
42 |         database_id: 数据库 ID 筛选，可选。
43 |         database: 数据库名称筛选，可选。
   |                                 ^^
44 |         period_type: 统计周期类型，默认 'daily'。
45 |         start_date: 开始日期，可选。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/capacity/databases.py:44:28
   |
42 |         database_id: 数据库 ID 筛选，可选。
43 |         database: 数据库名称筛选，可选。
44 |         period_type: 统计周期类型，默认 'daily'。
   |                                  ^^
45 |         start_date: 开始日期，可选。
46 |         end_date: 结束日期，可选。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/capacity/databases.py:45:25
   |
43 |         database: 数据库名称筛选，可选。
44 |         period_type: 统计周期类型，默认 'daily'。
45 |         start_date: 开始日期，可选。
   |                             ^^
46 |         end_date: 结束日期，可选。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/capacity/databases.py:46:23
   |
44 |         period_type: 统计周期类型，默认 'daily'。
45 |         start_date: 开始日期，可选。
46 |         end_date: 结束日期，可选。
   |                           ^^
47 |
48 |     """
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/capacity/databases.py:112:19
    |
110 | @view_required
111 | def fetch_database_metrics() -> Response:
112 |     """获取数据库统计聚合数据（数据库统计层面）。.
    |                              ^^
113 |
114 |     支持分页、筛选和日期范围查询。
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/capacity/databases.py:112:27
    |
110 | @view_required
111 | def fetch_database_metrics() -> Response:
112 |     """获取数据库统计聚合数据（数据库统计层面）。.
    |                                              ^^
113 |
114 |     支持分页、筛选和日期范围查询。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/capacity/databases.py:117:16
    |
116 |     Returns:
117 |         JSON 响应，包含聚合数据列表和分页信息。
    |                  ^^
118 |
119 |     Raises:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/capacity/databases.py:124:30
    |
123 |     Query Parameters:
124 |         instance_id: 实例 ID 筛选，可选。
    |                                  ^^
125 |         db_type: 数据库类型筛选，可选。
126 |         database_name: 数据库名称筛选，可选。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/capacity/databases.py:125:25
    |
123 |     Query Parameters:
124 |         instance_id: 实例 ID 筛选，可选。
125 |         db_type: 数据库类型筛选，可选。
    |                                ^^
126 |         database_name: 数据库名称筛选，可选。
127 |         database_id: 数据库 ID 筛选，可选。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/capacity/databases.py:126:31
    |
124 |         instance_id: 实例 ID 筛选，可选。
125 |         db_type: 数据库类型筛选，可选。
126 |         database_name: 数据库名称筛选，可选。
    |                                      ^^
127 |         database_id: 数据库 ID 筛选，可选。
128 |         period_type: 统计周期类型，可选。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/capacity/databases.py:127:31
    |
125 |         db_type: 数据库类型筛选，可选。
126 |         database_name: 数据库名称筛选，可选。
127 |         database_id: 数据库 ID 筛选，可选。
    |                                    ^^
128 |         period_type: 统计周期类型，可选。
129 |         start_date: 开始日期（YYYY-MM-DD），可选。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/capacity/databases.py:128:28
    |
126 |         database_name: 数据库名称筛选，可选。
127 |         database_id: 数据库 ID 筛选，可选。
128 |         period_type: 统计周期类型，可选。
    |                                  ^^
129 |         start_date: 开始日期（YYYY-MM-DD），可选。
130 |         end_date: 结束日期（YYYY-MM-DD），可选。
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/capacity/databases.py:129:25
    |
127 |         database_id: 数据库 ID 筛选，可选。
128 |         period_type: 统计周期类型，可选。
129 |         start_date: 开始日期（YYYY-MM-DD），可选。
    |                             ^^
130 |         end_date: 结束日期（YYYY-MM-DD），可选。
131 |         page: 页码，默认 1。
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/capacity/databases.py:129:36
    |
127 |         database_id: 数据库 ID 筛选，可选。
128 |         period_type: 统计周期类型，可选。
129 |         start_date: 开始日期（YYYY-MM-DD），可选。
    |                                         ^^
130 |         end_date: 结束日期（YYYY-MM-DD），可选。
131 |         page: 页码，默认 1。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/capacity/databases.py:129:37
    |
127 |         database_id: 数据库 ID 筛选，可选。
128 |         period_type: 统计周期类型，可选。
129 |         start_date: 开始日期（YYYY-MM-DD），可选。
    |                                           ^^
130 |         end_date: 结束日期（YYYY-MM-DD），可选。
131 |         page: 页码，默认 1。
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/capacity/databases.py:130:23
    |
128 |         period_type: 统计周期类型，可选。
129 |         start_date: 开始日期（YYYY-MM-DD），可选。
130 |         end_date: 结束日期（YYYY-MM-DD），可选。
    |                           ^^
131 |         page: 页码，默认 1。
132 |         per_page: 每页数量，默认 20。
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/capacity/databases.py:130:34
    |
128 |         period_type: 统计周期类型，可选。
129 |         start_date: 开始日期（YYYY-MM-DD），可选。
130 |         end_date: 结束日期（YYYY-MM-DD），可选。
    |                                       ^^
131 |         page: 页码，默认 1。
132 |         per_page: 每页数量，默认 20。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/capacity/databases.py:130:35
    |
128 |         period_type: 统计周期类型，可选。
129 |         start_date: 开始日期（YYYY-MM-DD），可选。
130 |         end_date: 结束日期（YYYY-MM-DD），可选。
    |                                         ^^
131 |         page: 页码，默认 1。
132 |         per_page: 每页数量，默认 20。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/capacity/databases.py:131:17
    |
129 |         start_date: 开始日期（YYYY-MM-DD），可选。
130 |         end_date: 结束日期（YYYY-MM-DD），可选。
131 |         page: 页码，默认 1。
    |                   ^^
132 |         per_page: 每页数量，默认 20。
133 |         get_all: 是否获取全部数据，默认 false。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/capacity/databases.py:132:23
    |
130 |         end_date: 结束日期（YYYY-MM-DD），可选。
131 |         page: 页码，默认 1。
132 |         per_page: 每页数量，默认 20。
    |                           ^^
133 |         get_all: 是否获取全部数据，默认 false。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/capacity/databases.py:133:26
    |
131 |         page: 页码，默认 1。
132 |         per_page: 每页数量，默认 20。
133 |         get_all: 是否获取全部数据，默认 false。
    |                                  ^^
134 |
135 |     """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/capacity/databases.py:191:21
    |
190 |     Args:
191 |         value: 日期字符串，格式 'YYYY-MM-DD'。
    |                          ^^
192 |         field: 字段名称，用于错误消息。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/capacity/databases.py:192:20
    |
190 |     Args:
191 |         value: 日期字符串，格式 'YYYY-MM-DD'。
192 |         field: 字段名称，用于错误消息。
    |                        ^^
193 |
194 |     Returns:
    |

TRY301 Abstract `raise` to an inner function
   --> app/routes/capacity/databases.py:205:13
    |
203 |         if parsed_dt is None:
204 |             msg = "无法解析日期"
205 |             raise ValueError(msg)
    |             ^^^^^^^^^^^^^^^^^^^^^
206 |         return parsed_dt.date()
207 |     except Exception as exc:
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/capacity/databases.py:208:29
    |
206 |         return parsed_dt.date()
207 |     except Exception as exc:
208 |         msg = f"{field} 格式错误，应为 YYYY-MM-DD"
    |                                 ^^
209 |         raise ValidationError(msg) from exc
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/capacity/databases.py:219:16
    |
218 |     Returns:
219 |         JSON 响应，包含汇总统计数据。
    |                  ^^
220 |
221 |     Raises:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/capacity/databases.py:226:30
    |
225 |     Query Parameters:
226 |         instance_id: 实例 ID 筛选，可选。
    |                                  ^^
227 |         db_type: 数据库类型筛选，可选。
228 |         database_name: 数据库名称筛选，可选。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/capacity/databases.py:227:25
    |
225 |     Query Parameters:
226 |         instance_id: 实例 ID 筛选，可选。
227 |         db_type: 数据库类型筛选，可选。
    |                                ^^
228 |         database_name: 数据库名称筛选，可选。
229 |         database_id: 数据库 ID 筛选，可选。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/capacity/databases.py:228:31
    |
226 |         instance_id: 实例 ID 筛选，可选。
227 |         db_type: 数据库类型筛选，可选。
228 |         database_name: 数据库名称筛选，可选。
    |                                      ^^
229 |         database_id: 数据库 ID 筛选，可选。
230 |         period_type: 统计周期类型，可选。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/capacity/databases.py:229:31
    |
227 |         db_type: 数据库类型筛选，可选。
228 |         database_name: 数据库名称筛选，可选。
229 |         database_id: 数据库 ID 筛选，可选。
    |                                    ^^
230 |         period_type: 统计周期类型，可选。
231 |         start_date: 开始日期（YYYY-MM-DD），可选。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/capacity/databases.py:230:28
    |
228 |         database_name: 数据库名称筛选，可选。
229 |         database_id: 数据库 ID 筛选，可选。
230 |         period_type: 统计周期类型，可选。
    |                                  ^^
231 |         start_date: 开始日期（YYYY-MM-DD），可选。
232 |         end_date: 结束日期（YYYY-MM-DD），可选。
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/capacity/databases.py:231:25
    |
229 |         database_id: 数据库 ID 筛选，可选。
230 |         period_type: 统计周期类型，可选。
231 |         start_date: 开始日期（YYYY-MM-DD），可选。
    |                             ^^
232 |         end_date: 结束日期（YYYY-MM-DD），可选。
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/capacity/databases.py:231:36
    |
229 |         database_id: 数据库 ID 筛选，可选。
230 |         period_type: 统计周期类型，可选。
231 |         start_date: 开始日期（YYYY-MM-DD），可选。
    |                                         ^^
232 |         end_date: 结束日期（YYYY-MM-DD），可选。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/capacity/databases.py:231:37
    |
229 |         database_id: 数据库 ID 筛选，可选。
230 |         period_type: 统计周期类型，可选。
231 |         start_date: 开始日期（YYYY-MM-DD），可选。
    |                                           ^^
232 |         end_date: 结束日期（YYYY-MM-DD），可选。
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/capacity/databases.py:232:23
    |
230 |         period_type: 统计周期类型，可选。
231 |         start_date: 开始日期（YYYY-MM-DD），可选。
232 |         end_date: 结束日期（YYYY-MM-DD），可选。
    |                           ^^
233 |
234 |     """
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/capacity/databases.py:232:34
    |
230 |         period_type: 统计周期类型，可选。
231 |         start_date: 开始日期（YYYY-MM-DD），可选。
232 |         end_date: 结束日期（YYYY-MM-DD），可选。
    |                                       ^^
233 |
234 |     """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/capacity/databases.py:232:35
    |
230 |         period_type: 统计周期类型，可选。
231 |         start_date: 开始日期（YYYY-MM-DD），可选。
232 |         end_date: 结束日期（YYYY-MM-DD），可选。
    |                                         ^^
233 |
234 |     """
    |

A004 Import `SystemError` is shadowing a Python builtin
  --> app/routes/capacity/instances.py:12:39
   |
10 | from app.constants import DATABASE_TYPES, PERIOD_TYPES
11 | from app.constants.system_constants import SuccessMessages
12 | from app.errors import NotFoundError, SystemError, ValidationError as AppValidationError
   |                                       ^^^^^^^^^^^
13 | from app.models.instance import Instance
14 | from app.models.instance_size_stat import InstanceSizeStat
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/capacity/instances.py:49:21
   |
48 |     Args:
49 |         value: 日期字符串，格式 'YYYY-MM-DD'。
   |                          ^^
50 |         field_name: 字段名称，用于错误消息。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/capacity/instances.py:50:25
   |
48 |     Args:
49 |         value: 日期字符串，格式 'YYYY-MM-DD'。
50 |         field_name: 字段名称，用于错误消息。
   |                             ^^
51 |
52 |     Returns:
   |

DTZ007 Naive datetime constructed using `datetime.datetime.strptime()` without %z
  --> app/routes/capacity/instances.py:60:16
   |
58 |     """
59 |     try:
60 |         return datetime.strptime(value, "%Y-%m-%d").date()
   |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
61 |     except ValueError as exc:
62 |         msg = f"{field_name} 格式错误，需使用 YYYY-MM-DD"
   |
help: Call `.replace(tzinfo=<timezone>)` or `.astimezone()` to convert to an aware datetime

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/capacity/instances.py:62:34
   |
60 |         return datetime.strptime(value, "%Y-%m-%d").date()
61 |     except ValueError as exc:
62 |         msg = f"{field_name} 格式错误，需使用 YYYY-MM-DD"
   |                                      ^^
63 |         raise AppValidationError(msg) from exc
   |

ANN201 Missing return type annotation for public function `list_instances`
  --> app/routes/capacity/instances.py:70:5
   |
68 | @login_required
69 | @view_required
70 | def list_instances():
   |     ^^^^^^^^^^^^^^
71 |     """实例统计聚合页面。.
   |
help: Add return type annotation

PLC0415 `import` should be at the top-level of a file
  --> app/routes/capacity/instances.py:84:5
   |
82 |     end_date = request.args.get("end_date", "")
83 |
84 |     from app.services.database_type_service import DatabaseTypeService
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
85 |     database_type_configs = DatabaseTypeService.get_active_types()
86 |     if database_type_configs:
   |

C901 `fetch_instance_metrics` is too complex (11 > 10)
   --> app/routes/capacity/instances.py:122:5
    |
120 | @login_required
121 | @view_required
122 | def fetch_instance_metrics():
    |     ^^^^^^^^^^^^^^^^^^^^^^
123 |     """获取实例聚合数据（实例统计层面）。.
    |

PLR0915 Too many statements (56 > 50)
   --> app/routes/capacity/instances.py:122:5
    |
120 | @login_required
121 | @view_required
122 | def fetch_instance_metrics():
    |     ^^^^^^^^^^^^^^^^^^^^^^
123 |     """获取实例聚合数据（实例统计层面）。.
    |

ANN201 Missing return type annotation for public function `fetch_instance_metrics`
   --> app/routes/capacity/instances.py:122:5
    |
120 | @login_required
121 | @view_required
122 | def fetch_instance_metrics():
    |     ^^^^^^^^^^^^^^^^^^^^^^
123 |     """获取实例聚合数据（实例统计层面）。.
    |
help: Add return type annotation

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/capacity/instances.py:123:16
    |
121 | @view_required
122 | def fetch_instance_metrics():
123 |     """获取实例聚合数据（实例统计层面）。.
    |                        ^^
124 |
125 |     Args:
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/capacity/instances.py:123:23
    |
121 | @view_required
122 | def fetch_instance_metrics():
123 |     """获取实例聚合数据（实例统计层面）。.
    |                                      ^^
124 |
125 |     Args:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/capacity/instances.py:126:26
    |
125 |     Args:
126 |         instance_id: 请求参数，实例ID。
    |                              ^^
127 |         db_type: 请求参数，数据库类型。
128 |         period_type: 请求参数，聚合周期类型。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/capacity/instances.py:127:22
    |
125 |     Args:
126 |         instance_id: 请求参数，实例ID。
127 |         db_type: 请求参数，数据库类型。
    |                          ^^
128 |         period_type: 请求参数，聚合周期类型。
129 |         start_date: 请求参数，开始日期（YYYY-MM-DD）。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/capacity/instances.py:128:26
    |
126 |         instance_id: 请求参数，实例ID。
127 |         db_type: 请求参数，数据库类型。
128 |         period_type: 请求参数，聚合周期类型。
    |                              ^^
129 |         start_date: 请求参数，开始日期（YYYY-MM-DD）。
130 |         end_date: 请求参数，结束日期（YYYY-MM-DD）。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/capacity/instances.py:129:25
    |
127 |         db_type: 请求参数，数据库类型。
128 |         period_type: 请求参数，聚合周期类型。
129 |         start_date: 请求参数，开始日期（YYYY-MM-DD）。
    |                             ^^
130 |         end_date: 请求参数，结束日期（YYYY-MM-DD）。
131 |         time_range: 请求参数，快捷时间范围（天）。
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/capacity/instances.py:129:30
    |
127 |         db_type: 请求参数，数据库类型。
128 |         period_type: 请求参数，聚合周期类型。
129 |         start_date: 请求参数，开始日期（YYYY-MM-DD）。
    |                                       ^^
130 |         end_date: 请求参数，结束日期（YYYY-MM-DD）。
131 |         time_range: 请求参数，快捷时间范围（天）。
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/capacity/instances.py:129:41
    |
127 |         db_type: 请求参数，数据库类型。
128 |         period_type: 请求参数，聚合周期类型。
129 |         start_date: 请求参数，开始日期（YYYY-MM-DD）。
    |                                                   ^^
130 |         end_date: 请求参数，结束日期（YYYY-MM-DD）。
131 |         time_range: 请求参数，快捷时间范围（天）。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/capacity/instances.py:130:23
    |
128 |         period_type: 请求参数，聚合周期类型。
129 |         start_date: 请求参数，开始日期（YYYY-MM-DD）。
130 |         end_date: 请求参数，结束日期（YYYY-MM-DD）。
    |                           ^^
131 |         time_range: 请求参数，快捷时间范围（天）。
132 |         page: 请求参数，分页页码。
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/capacity/instances.py:130:28
    |
128 |         period_type: 请求参数，聚合周期类型。
129 |         start_date: 请求参数，开始日期（YYYY-MM-DD）。
130 |         end_date: 请求参数，结束日期（YYYY-MM-DD）。
    |                                     ^^
131 |         time_range: 请求参数，快捷时间范围（天）。
132 |         page: 请求参数，分页页码。
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/capacity/instances.py:130:39
    |
128 |         period_type: 请求参数，聚合周期类型。
129 |         start_date: 请求参数，开始日期（YYYY-MM-DD）。
130 |         end_date: 请求参数，结束日期（YYYY-MM-DD）。
    |                                                 ^^
131 |         time_range: 请求参数，快捷时间范围（天）。
132 |         page: 请求参数，分页页码。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/capacity/instances.py:131:25
    |
129 |         start_date: 请求参数，开始日期（YYYY-MM-DD）。
130 |         end_date: 请求参数，结束日期（YYYY-MM-DD）。
131 |         time_range: 请求参数，快捷时间范围（天）。
    |                             ^^
132 |         page: 请求参数，分页页码。
133 |         per_page: 请求参数，每页数量。
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/capacity/instances.py:131:32
    |
129 |         start_date: 请求参数，开始日期（YYYY-MM-DD）。
130 |         end_date: 请求参数，结束日期（YYYY-MM-DD）。
131 |         time_range: 请求参数，快捷时间范围（天）。
    |                                           ^^
132 |         page: 请求参数，分页页码。
133 |         per_page: 请求参数，每页数量。
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/capacity/instances.py:131:34
    |
129 |         start_date: 请求参数，开始日期（YYYY-MM-DD）。
130 |         end_date: 请求参数，结束日期（YYYY-MM-DD）。
131 |         time_range: 请求参数，快捷时间范围（天）。
    |                                               ^^
132 |         page: 请求参数，分页页码。
133 |         per_page: 请求参数，每页数量。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/capacity/instances.py:132:19
    |
130 |         end_date: 请求参数，结束日期（YYYY-MM-DD）。
131 |         time_range: 请求参数，快捷时间范围（天）。
132 |         page: 请求参数，分页页码。
    |                       ^^
133 |         per_page: 请求参数，每页数量。
134 |         get_all: 请求参数，是否返回全部记录（用于图表）。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/capacity/instances.py:133:23
    |
131 |         time_range: 请求参数，快捷时间范围（天）。
132 |         page: 请求参数，分页页码。
133 |         per_page: 请求参数，每页数量。
    |                           ^^
134 |         get_all: 请求参数，是否返回全部记录（用于图表）。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/capacity/instances.py:134:22
    |
132 |         page: 请求参数，分页页码。
133 |         per_page: 请求参数，每页数量。
134 |         get_all: 请求参数，是否返回全部记录（用于图表）。
    |                          ^^
135 |
136 |     Returns:
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/capacity/instances.py:134:31
    |
132 |         page: 请求参数，分页页码。
133 |         per_page: 请求参数，每页数量。
134 |         get_all: 请求参数，是否返回全部记录（用于图表）。
    |                                            ^^
135 |
136 |     Returns:
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/capacity/instances.py:134:36
    |
132 |         page: 请求参数，分页页码。
133 |         per_page: 请求参数，每页数量。
134 |         get_all: 请求参数，是否返回全部记录（用于图表）。
    |                                                      ^^
135 |
136 |     Returns:
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/capacity/instances.py:149:25
    |
147 |         time_range = request.args.get("time_range")
148 |
149 |         # 处理time_range参数，转换为start_date和end_date
    |                             ^^
150 |         if time_range and not start_date and not end_date:
151 |             end_date_obj = time_utils.now_china()
    |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/capacity/instances.py:159:19
    |
157 |         page = request.args.get("page", 1, type=int)
158 |         per_page = request.args.get("per_page", 20, type=int)
159 |         # 是否返回所有数据（用于图表显示）
    |                           ^^
160 |         get_all = request.args.get("get_all", "false").lower() == "true"
    |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/capacity/instances.py:159:26
    |
157 |         page = request.args.get("page", 1, type=int)
158 |         per_page = request.args.get("per_page", 20, type=int)
159 |         # 是否返回所有数据（用于图表显示）
    |                                         ^^
160 |         get_all = request.args.get("get_all", "false").lower() == "true"
    |

PLC0415 `import` should be at the top-level of a file
   --> app/routes/capacity/instances.py:167:9
    |
166 |         # 构建查询 - 查询实例统计聚合表
167 |         from app.models.instance_size_aggregation import InstanceSizeAggregation
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
168 |         query = (
169 |             InstanceSizeAggregation.query.join(Instance)
    |

RUF003 Comment contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/routes/capacity/instances.py:191:21
    |
189 |         # 排序和分页
190 |         if get_all:
191 |             # 用于图表显示：按总大小排序获取TOP N实例
    |                           ^^
192 |             # 先按实例分组，获取每个实例的最大容量
193 |             subquery = query.with_entities(
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/capacity/instances.py:192:21
    |
190 |         if get_all:
191 |             # 用于图表显示：按总大小排序获取TOP N实例
192 |             # 先按实例分组，获取每个实例的最大容量
    |                           ^^
193 |             subquery = query.with_entities(
194 |                 InstanceSizeAggregation.instance_id,
    |

RUF003 Comment contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/routes/capacity/instances.py:210:21
    |
208 |             total = len(aggregations)
209 |         else:
210 |             # 用于表格显示：按时间排序分页
    |                           ^^
211 |             query = query.order_by(desc(InstanceSizeAggregation.period_start))
212 |             total = query.count()
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/capacity/instances.py:215:18
    |
213 |             aggregations = query.offset(offset).limit(limit).all()
214 |
215 |         # 转换为字典格式，包含实例信息
    |                         ^^
216 |         data = []
217 |         for agg in aggregations:
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/capacity/instances.py:225:21
    |
223 |                 "db_type": agg.instance.db_type,
224 |             }
225 |             # 为了兼容前端，添加 avg_size_mb 字段
    |                           ^^
226 |             agg_dict["avg_size_mb"] = agg_dict.get("total_size_mb", 0)
227 |             data.append(agg_dict)
    |

C901 `fetch_instance_summary` is too complex (13 > 10)
   --> app/routes/capacity/instances.py:253:5
    |
251 | @login_required
252 | @view_required
253 | def fetch_instance_summary():
    |     ^^^^^^^^^^^^^^^^^^^^^^
254 |     """获取实例聚合汇总信息（实例统计层面）。.
    |

ANN201 Missing return type annotation for public function `fetch_instance_summary`
   --> app/routes/capacity/instances.py:253:5
    |
251 | @login_required
252 | @view_required
253 | def fetch_instance_summary():
    |     ^^^^^^^^^^^^^^^^^^^^^^
254 |     """获取实例聚合汇总信息（实例统计层面）。.
    |
help: Add return type annotation

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/capacity/instances.py:254:18
    |
252 | @view_required
253 | def fetch_instance_summary():
254 |     """获取实例聚合汇总信息（实例统计层面）。.
    |                            ^^
255 |
256 |     Args:
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/capacity/instances.py:254:25
    |
252 | @view_required
253 | def fetch_instance_summary():
254 |     """获取实例聚合汇总信息（实例统计层面）。.
    |                                          ^^
255 |
256 |     Args:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/capacity/instances.py:257:26
    |
256 |     Args:
257 |         instance_id: 请求参数，实例ID。
    |                              ^^
258 |         db_type: 请求参数，数据库类型。
259 |         period_type: 请求参数，周期类型。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/capacity/instances.py:258:22
    |
256 |     Args:
257 |         instance_id: 请求参数，实例ID。
258 |         db_type: 请求参数，数据库类型。
    |                          ^^
259 |         period_type: 请求参数，周期类型。
260 |         start_date: 请求参数，开始日期（YYYY-MM-DD）。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/capacity/instances.py:259:26
    |
257 |         instance_id: 请求参数，实例ID。
258 |         db_type: 请求参数，数据库类型。
259 |         period_type: 请求参数，周期类型。
    |                              ^^
260 |         start_date: 请求参数，开始日期（YYYY-MM-DD）。
261 |         end_date: 请求参数，结束日期（YYYY-MM-DD）。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/capacity/instances.py:260:25
    |
258 |         db_type: 请求参数，数据库类型。
259 |         period_type: 请求参数，周期类型。
260 |         start_date: 请求参数，开始日期（YYYY-MM-DD）。
    |                             ^^
261 |         end_date: 请求参数，结束日期（YYYY-MM-DD）。
262 |         time_range: 请求参数，快捷时间范围（天）。
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/capacity/instances.py:260:30
    |
258 |         db_type: 请求参数，数据库类型。
259 |         period_type: 请求参数，周期类型。
260 |         start_date: 请求参数，开始日期（YYYY-MM-DD）。
    |                                       ^^
261 |         end_date: 请求参数，结束日期（YYYY-MM-DD）。
262 |         time_range: 请求参数，快捷时间范围（天）。
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/capacity/instances.py:260:41
    |
258 |         db_type: 请求参数，数据库类型。
259 |         period_type: 请求参数，周期类型。
260 |         start_date: 请求参数，开始日期（YYYY-MM-DD）。
    |                                                   ^^
261 |         end_date: 请求参数，结束日期（YYYY-MM-DD）。
262 |         time_range: 请求参数，快捷时间范围（天）。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/capacity/instances.py:261:23
    |
259 |         period_type: 请求参数，周期类型。
260 |         start_date: 请求参数，开始日期（YYYY-MM-DD）。
261 |         end_date: 请求参数，结束日期（YYYY-MM-DD）。
    |                           ^^
262 |         time_range: 请求参数，快捷时间范围（天）。
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/capacity/instances.py:261:28
    |
259 |         period_type: 请求参数，周期类型。
260 |         start_date: 请求参数，开始日期（YYYY-MM-DD）。
261 |         end_date: 请求参数，结束日期（YYYY-MM-DD）。
    |                                     ^^
262 |         time_range: 请求参数，快捷时间范围（天）。
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/capacity/instances.py:261:39
    |
259 |         period_type: 请求参数，周期类型。
260 |         start_date: 请求参数，开始日期（YYYY-MM-DD）。
261 |         end_date: 请求参数，结束日期（YYYY-MM-DD）。
    |                                                 ^^
262 |         time_range: 请求参数，快捷时间范围（天）。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/capacity/instances.py:262:25
    |
260 |         start_date: 请求参数，开始日期（YYYY-MM-DD）。
261 |         end_date: 请求参数，结束日期（YYYY-MM-DD）。
262 |         time_range: 请求参数，快捷时间范围（天）。
    |                             ^^
263 |
264 |     Returns:
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/capacity/instances.py:262:32
    |
260 |         start_date: 请求参数，开始日期（YYYY-MM-DD）。
261 |         end_date: 请求参数，结束日期（YYYY-MM-DD）。
262 |         time_range: 请求参数，快捷时间范围（天）。
    |                                           ^^
263 |
264 |     Returns:
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/capacity/instances.py:262:34
    |
260 |         start_date: 请求参数，开始日期（YYYY-MM-DD）。
261 |         end_date: 请求参数，结束日期（YYYY-MM-DD）。
262 |         time_range: 请求参数，快捷时间范围（天）。
    |                                               ^^
263 |
264 |     Returns:
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/capacity/instances.py:277:25
    |
275 |         time_range = request.args.get("time_range")
276 |
277 |         # 处理time_range参数，转换为start_date和end_date
    |                             ^^
278 |         if time_range and not start_date and not end_date:
279 |             end_date_obj = time_utils.now_china()
    |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/capacity/instances.py:292:22
    |
290 |             end_date_obj = _parse_iso_date(end_date, "end_date")
291 |
292 |         # 优先使用实例大小统计表（与容量同步实时同步）
    |                                 ^^
293 |         stat_query = (
294 |             InstanceSizeStat.query.join(Instance)
    |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/capacity/instances.py:292:32
    |
290 |             end_date_obj = _parse_iso_date(end_date, "end_date")
291 |
292 |         # 优先使用实例大小统计表（与容量同步实时同步）
    |                                                     ^^
293 |         stat_query = (
294 |             InstanceSizeStat.query.join(Instance)
    |

D205 1 blank line required between summary line and description
 --> app/routes/common.py:1:1
  |
1 | / """通用 API 路由
2 | | 提供跨模块使用的通用接口.
3 | | """
  | |___^
4 |
5 |   from flask import Blueprint, Response, request
  |
help: Insert single blank line

A004 Import `SystemError` is shadowing a Python builtin
  --> app/routes/common.py:9:24
   |
 7 | from sqlalchemy import func
 8 |
 9 | from app.errors import SystemError, ValidationError
   |                        ^^^^^^^^^^^
10 | from app.models.instance import Instance
11 | from app.models.instance_database import InstanceDatabase
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/routes/common.py:25:16
   |
23 | @view_required
24 | def get_instance_options() -> Response:
25 |     """获取实例下拉选项（通用）。.
   |                        ^^
26 |
27 |     Args:
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/routes/common.py:25:19
   |
23 | @view_required
24 | def get_instance_options() -> Response:
25 |     """获取实例下拉选项（通用）。.
   |                              ^^
26 |
27 |     Args:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/common.py:28:22
   |
27 |     Args:
28 |         db_type: 请求参数，可选的数据库类型筛选。
   |                          ^^
29 |
30 |     Returns:
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/routes/common.py:67:22
   |
65 | @view_required
66 | def get_database_options() -> Response:
67 |     """获取指定实例的数据库下拉选项（通用）。.
   |                                    ^^
68 |
69 |     Args:
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/routes/common.py:67:25
   |
65 | @view_required
66 | def get_database_options() -> Response:
67 |     """获取指定实例的数据库下拉选项（通用）。.
   |                                          ^^
68 |
69 |     Args:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/common.py:70:26
   |
69 |     Args:
70 |         instance_id: 请求参数，必填的实例ID。
   |                              ^^
71 |         limit: 请求参数，返回数量（默认100）。
72 |         offset: 请求参数，数据偏移量（默认0）。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/common.py:71:20
   |
69 |     Args:
70 |         instance_id: 请求参数，必填的实例ID。
71 |         limit: 请求参数，返回数量（默认100）。
   |                        ^^
72 |         offset: 请求参数，数据偏移量（默认0）。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/routes/common.py:71:25
   |
69 |     Args:
70 |         instance_id: 请求参数，必填的实例ID。
71 |         limit: 请求参数，返回数量（默认100）。
   |                                  ^^
72 |         offset: 请求参数，数据偏移量（默认0）。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/routes/common.py:71:31
   |
69 |     Args:
70 |         instance_id: 请求参数，必填的实例ID。
71 |         limit: 请求参数，返回数量（默认100）。
   |                                           ^^
72 |         offset: 请求参数，数据偏移量（默认0）。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/common.py:72:21
   |
70 |         instance_id: 请求参数，必填的实例ID。
71 |         limit: 请求参数，返回数量（默认100）。
72 |         offset: 请求参数，数据偏移量（默认0）。
   |                         ^^
73 |
74 |     Returns:
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/routes/common.py:72:27
   |
70 |         instance_id: 请求参数，必填的实例ID。
71 |         limit: 请求参数，返回数量（默认100）。
72 |         offset: 请求参数，数据偏移量（默认0）。
   |                                     ^^
73 |
74 |     Returns:
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/routes/common.py:72:31
   |
70 |         instance_id: 请求参数，必填的实例ID。
71 |         limit: 请求参数，返回数量（默认100）。
72 |         offset: 请求参数，数据偏移量（默认0）。
   |                                            ^^
73 |
74 |     Returns:
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/common.py:141:17
    |
139 | @view_required
140 | def get_database_type_options() -> Response:
141 |     """获取数据库类型选项（通用）。.
    |                          ^^
142 |
143 |     Returns:
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/common.py:141:20
    |
139 | @view_required
140 | def get_database_type_options() -> Response:
141 |     """获取数据库类型选项（通用）。.
    |                                ^^
142 |
143 |     Returns:
    |

A004 Import `SystemError` is shadowing a Python builtin
 --> app/routes/connections.py:7:39
  |
5 | from flask_login import login_required
6 |
7 | from app.errors import NotFoundError, SystemError, ValidationError
  |                                       ^^^^^^^^^^^
8 | from app.models import Instance
9 | from app.services.connection_adapters.connection_factory import ConnectionFactory
  |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/routes/connections.py:26:11
   |
24 |     """测试数据库连接 API。.
25 |
26 |     支持两种模式：
   |                 ^^
27 |     1. 测试现有实例：传入 instance_id
28 |     2. 测试新连接：传入连接参数（db_type、host、port、credential_id）
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/routes/connections.py:27:14
   |
26 |     支持两种模式：
27 |     1. 测试现有实例：传入 instance_id
   |                    ^^
28 |     2. 测试新连接：传入连接参数（db_type、host、port、credential_id）
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/routes/connections.py:28:13
   |
26 |     支持两种模式：
27 |     1. 测试现有实例：传入 instance_id
28 |     2. 测试新连接：传入连接参数（db_type、host、port、credential_id）
   |                  ^^
29 |
30 |     Returns:
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/routes/connections.py:28:20
   |
26 |     支持两种模式：
27 |     1. 测试现有实例：传入 instance_id
28 |     2. 测试新连接：传入连接参数（db_type、host、port、credential_id）
   |                                ^^
29 |
30 |     Returns:
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/routes/connections.py:28:52
   |
26 |     支持两种模式：
27 |     1. 测试现有实例：传入 instance_id
28 |     2. 测试新连接：传入连接参数（db_type、host、port、credential_id）
   |                                                                    ^^
29 |
30 |     Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/connections.py:31:16
   |
30 |     Returns:
31 |         JSON 响应，包含连接测试结果和数据库版本信息。
   |                  ^^
32 |
33 |     Raises:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/connections.py:59:16
   |
58 |     Returns:
59 |         JSON 响应，包含测试结果。
   |                  ^^
60 |
61 |     Raises:
   |

E501 Line too long (251 > 120)
  --> app/routes/connections.py:72:113
   |
70 | …
71 | …
72 | …ersion=result.get("database_version"), main_version=result.get("main_version"), detailed_version=result.get("detailed_version"))
   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
73 | …
74 | …
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/connections.py:83:34
   |
82 |     Args:
83 |         connection_params: 连接参数字典，必须包含 db_type、host、port、credential_id。
   |                                        ^^
84 |
85 |     Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/connections.py:86:16
   |
85 |     Returns:
86 |         JSON 响应，包含测试结果。
   |                  ^^
87 |
88 |     Raises:
   |

PLR2004 Magic value used in comparison, consider replacing `65535` with a constant variable
   --> app/routes/connections.py:108:28
    |
106 |         msg = "端口号必须是有效的数字"
107 |         raise ValidationError(msg) from exc
108 |     if port <= 0 or port > 65535:
    |                            ^^^^^
109 |         msg = "端口号必须在1-65535之间"
110 |         raise ValidationError(msg)
    |

PLC0415 `import` should be at the top-level of a file
   --> app/routes/connections.py:111:5
    |
109 |         msg = "端口号必须在1-65535之间"
110 |         raise ValidationError(msg)
111 |     from app.models import Credential
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
112 |     credential = Credential.query.get(connection_params.get("credential_id"))
113 |     if not credential:
    |

E501 Line too long (223 > 120)
   --> app/routes/connections.py:116:121
    |
114 | …
115 | …
116 | …tion_params.get("host"), port=port, credential_id=connection_params.get("credential_id"), description="临时测试连接")
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
117 | …
118 | …
    |

TRY301 Abstract `raise` to an inner function
   --> app/routes/connections.py:150:13
    |
148 |         if not ConnectionFactory.is_type_supported(db_type):
149 |             msg = f"不支持的数据库类型: {db_type}"
150 |             raise ValidationError(msg)
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^
151 |         try:
152 |             port = int(data.get("port", 0))
    |

PLR2004 Magic value used in comparison, consider replacing `65535` with a constant variable
   --> app/routes/connections.py:156:32
    |
154 |             msg = "端口号必须是有效的数字"
155 |             raise ValidationError(msg) from exc
156 |         if port <= 0 or port > 65535:
    |                                ^^^^^
157 |             msg = "端口号必须在1-65535之间"
158 |             raise ValidationError(msg)
    |

TRY301 Abstract `raise` to an inner function
   --> app/routes/connections.py:158:13
    |
156 |         if port <= 0 or port > 65535:
157 |             msg = "端口号必须在1-65535之间"
158 |             raise ValidationError(msg)
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^
159 |         if data.get("credential_id"):
160 |             from app.models import Credential
    |

PLC0415 `import` should be at the top-level of a file
   --> app/routes/connections.py:160:13
    |
158 |             raise ValidationError(msg)
159 |         if data.get("credential_id"):
160 |             from app.models import Credential
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
161 |             credential = Credential.query.get(data.get("credential_id"))
162 |             if not credential:
    |

TRY301 Abstract `raise` to an inner function
   --> app/routes/connections.py:164:17
    |
162 |             if not credential:
163 |                 msg = "凭据不存在"
164 |                 raise NotFoundError(msg)
    |                 ^^^^^^^^^^^^^^^^^^^^^^^^
165 |         log_info("连接参数验证通过", module="connections", db_type=db_type)
166 |         return jsonify_unified_success(message="连接参数验证通过")
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/connections.py:181:16
    |
180 |     Returns:
181 |         JSON 响应，包含每个实例的测试结果和汇总统计。
    |                  ^^
182 |
183 |     Raises:
    |

PLR2004 Magic value used in comparison, consider replacing `50` with a constant variable
   --> app/routes/connections.py:196:28
    |
194 |         msg = "实例ID列表不能为空"
195 |         raise ValidationError(msg)
196 |     if len(instance_ids) > 50:
    |                            ^^
197 |         msg = "批量测试数量不能超过50个"
198 |         raise ValidationError(msg)
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/routes/connections.py:219:20
    |
217 |                     fail_count += 1
218 |                 results.append(result)
219 |             except Exception as e:
    |                    ^^^^^^^^^
220 |                 results.append({"instance_id": instance_id, "success": False, "error": f"测试失败: {e!s}"})
221 |                 fail_count += 1
    |

E501 Line too long (125 > 120)
   --> app/routes/connections.py:223:113
    |
221 |                 fail_count += 1
222 |                 log_error("批量连接测试单实例失败", module="connections", instance_id=instance_id, error=str(e))
223 |         log_info("批量连接测试完成", module="connections", total=len(instance_ids), success=success_count, failed=fail_count)
    |                                                                                                                         ^^^^^
224 |         return jsonify_unified_success(data={"results": results, "summary": {"total": len(instance_ids), "success": success_count, "f…
225 |     except Exception as exc:
    |

E501 Line too long (182 > 120)
   --> app/routes/connections.py:224:121
    |
222 | …d, error=str(e))
223 | …uccess_count, failed=fail_count)
224 | … len(instance_ids), "success": success_count, "failed": fail_count}}, message="批量连接测试完成")
    |                                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
225 | …
226 | …
    |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/routes/connections.py:236:17
    |
234 |     """获取实例连接状态。.
235 |
236 |     根据最后连接时间判断状态：1小时内为 good，1天内为 warning，超过1天为 poor。
    |                             ^^
237 |
238 |     Args:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/connections.py:236:28
    |
234 |     """获取实例连接状态。.
235 |
236 |     根据最后连接时间判断状态：1小时内为 good，1天内为 warning，超过1天为 poor。
    |                                             ^^
237 |
238 |     Args:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/connections.py:236:41
    |
234 |     """获取实例连接状态。.
235 |
236 |     根据最后连接时间判断状态：1小时内为 good，1天内为 warning，超过1天为 poor。
    |                                                              ^^
237 |
238 |     Args:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/connections.py:242:16
    |
241 |     Returns:
242 |         JSON 响应，包含实例信息和连接状态。
    |                  ^^
243 |
244 |     Raises:
    |

PLC0415 `import` should be at the top-level of a file
   --> app/routes/connections.py:257:13
    |
255 |         status = "unknown"
256 |         if instance.last_connected:
257 |             from datetime import datetime, timedelta
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
258 |             last_connected_time = instance.last_connected
259 |             if isinstance(last_connected_time, str):
    |

E501 Line too long (293 > 120)
   --> app/routes/connections.py:268:121
    |
266 | …
267 | …
268 | … instance.db_type, "host": instance.host, "port": instance.port, "last_connected": last_connected, "status": status, "is_active": instance.is_active}, message="获取连接状态成功")
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
269 | …
270 | …
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/credentials.py:55:25
   |
54 |     Args:
55 |         action: 当前执行动作描述，如“创建凭据”。
   |                                 ^^
56 |         error: 捕获到的异常。
   |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/credentials.py:65:24
   |
63 |     lowered = message.lower()
64 |     if "unique constraint failed" in lowered or "duplicate key value" in lowered:
65 |         return "凭据名称已存在，请使用其他名称"
   |                               ^^
66 |     if "not null constraint failed" in lowered:
67 |         return "必填字段不能为空"
   |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/credentials.py:68:24
   |
66 |     if "not null constraint failed" in lowered:
67 |         return "必填字段不能为空"
68 |     return f"{action}失败，请稍后重试"
   |                          ^^
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/credentials.py:75:23
   |
74 |     Args:
75 |         action: 执行的动作名，用于日志。
   |                             ^^
76 |         error: 捕获到的原始异常。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/credentials.py:115:27
    |
113 |     Args:
114 |         data: 经过清洗的表单数据。
115 |         credential: 现有凭据实例（更新时传入）。
    |                                 ^^
116 |
117 |     Returns:
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/credentials.py:115:33
    |
113 |     Args:
114 |         data: 经过清洗的表单数据。
115 |         credential: 现有凭据实例（更新时传入）。
    |                                             ^^
116 |
117 |     Returns:
    |

C901 `index` is too complex (12 > 10)
   --> app/routes/credentials.py:151:5
    |
149 | @login_required
150 | @view_required
151 | def index() -> str:
    |     ^^^^^
152 |     """凭据管理首页。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/credentials.py:154:13
    |
152 |     """凭据管理首页。.
153 |
154 |     渲染凭据管理页面，支持搜索、类型、数据库类型、状态和标签筛选。
    |                     ^^
155 |
156 |     Returns:
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/credentials.py:157:30
    |
156 |     Returns:
157 |         渲染后的 HTML 页面或 JSON 响应（当请求为 JSON 时）。
    |                                       ^^
158 |
159 |     Query Parameters:
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/credentials.py:157:42
    |
156 |     Returns:
157 |         渲染后的 HTML 页面或 JSON 响应（当请求为 JSON 时）。
    |                                                         ^^
158 |
159 |     Query Parameters:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/credentials.py:160:17
    |
159 |     Query Parameters:
160 |         page: 页码，默认 1。
    |                   ^^
161 |         per_page: 每页数量，默认 10。
162 |         search: 搜索关键词，可选。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/credentials.py:161:23
    |
159 |     Query Parameters:
160 |         page: 页码，默认 1。
161 |         per_page: 每页数量，默认 10。
    |                           ^^
162 |         search: 搜索关键词，可选。
163 |         credential_type: 凭据类型筛选，可选。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/credentials.py:162:22
    |
160 |         page: 页码，默认 1。
161 |         per_page: 每页数量，默认 10。
162 |         search: 搜索关键词，可选。
    |                           ^^
163 |         credential_type: 凭据类型筛选，可选。
164 |         db_type: 数据库类型筛选，可选。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/credentials.py:163:32
    |
161 |         per_page: 每页数量，默认 10。
162 |         search: 搜索关键词，可选。
163 |         credential_type: 凭据类型筛选，可选。
    |                                      ^^
164 |         db_type: 数据库类型筛选，可选。
165 |         status: 状态筛选，可选。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/credentials.py:164:25
    |
162 |         search: 搜索关键词，可选。
163 |         credential_type: 凭据类型筛选，可选。
164 |         db_type: 数据库类型筛选，可选。
    |                                ^^
165 |         status: 状态筛选，可选。
166 |         tags: 标签筛选（逗号分隔或数组），可选。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/credentials.py:165:21
    |
163 |         credential_type: 凭据类型筛选，可选。
164 |         db_type: 数据库类型筛选，可选。
165 |         status: 状态筛选，可选。
    |                         ^^
166 |         tags: 标签筛选（逗号分隔或数组），可选。
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/credentials.py:166:19
    |
164 |         db_type: 数据库类型筛选，可选。
165 |         status: 状态筛选，可选。
166 |         tags: 标签筛选（逗号分隔或数组），可选。
    |                       ^^
167 |
168 |     """
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/credentials.py:166:27
    |
164 |         db_type: 数据库类型筛选，可选。
165 |         status: 状态筛选，可选。
166 |         tags: 标签筛选（逗号分隔或数组），可选。
    |                                       ^^
167 |
168 |     """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/credentials.py:166:28
    |
164 |         db_type: 数据库类型筛选，可选。
165 |         status: 状态筛选，可选。
166 |         tags: 标签筛选（逗号分隔或数组），可选。
    |                                         ^^
167 |
168 |     """
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/credentials.py:184:11
    |
182 |             tags = [tag.strip() for tag in tags_str.split(",") if tag.strip()]
183 |
184 |     # 构建查询，包含实例数量统计
    |               ^^
185 |     query = db.session.query(Credential, db.func.count(Instance.id).label("instance_count")).outerjoin(
186 |         Instance, Credential.id == Instance.credential_id,
    |

PLC0415 `import` should be at the top-level of a file
   --> app/routes/credentials.py:212:9
    |
210 |     # 标签筛选
211 |     if tags:
212 |         from app.models.tag import Tag
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
213 |         query = query.join(Credential.tags).filter(Tag.name.in_(tags))
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/credentials.py:221:11
    |
219 |     pagination = query.paginate(page=page, per_page=per_page, error_out=False)
220 |
221 |     # 处理结果，添加实例数量到凭据对象
    |               ^^
222 |     credentials_with_count = []
223 |     for cred, instance_count in pagination.items:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/credentials.py:303:16
    |
302 |     Returns:
303 |         JSON 响应，包含创建的凭据信息。
    |                  ^^
304 |
305 |     Raises:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/credentials.py:319:24
    |
317 | @require_csrf
318 | def create_credential_rest() -> "Response":
319 |     """RESTful 创建凭据 API，供前端 CredentialsService 使用。."""
    |                            ^^
320 |     payload = _parse_payload()
321 |     return _build_create_response(payload)
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/routes/credentials.py:379:16
    |
377 |             db.session.delete(credential)
378 |             db.session.commit()
379 |         except Exception as exc:
    |                ^^^^^^^^^
380 |             _handle_db_exception("删除凭据", exc)
381 |     except DatabaseError as exc:
    |

RUF001 String contains ambiguous `！` (FULLWIDTH EXCLAMATION MARK). Did you mean `!` (EXCLAMATION MARK)?
   --> app/routes/credentials.py:402:18
    |
400 |         )
401 |
402 |     flash("凭据删除成功！", FlashCategory.SUCCESS)
    |                        ^^
403 |     return redirect(url_for("credentials.index"))
    |

C901 `list_credentials` is too complex (11 > 10)
   --> app/routes/credentials.py:410:5
    |
408 | @login_required
409 | @view_required
410 | def list_credentials() -> "Response":
    |     ^^^^^^^^^^^^^^^^
411 |     """获取凭据列表 API。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/credentials.py:413:18
    |
411 |     """获取凭据列表 API。.
412 |
413 |     支持分页、排序、搜索和筛选，返回凭据列表及实例数量统计。
    |                               ^^
414 |
415 |     Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/credentials.py:419:17
    |
418 |     Query Parameters:
419 |         page: 页码，默认 1。
    |                   ^^
420 |         limit: 每页数量，默认 20。
421 |         sort: 排序字段，默认 'created_at'。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/credentials.py:420:20
    |
418 |     Query Parameters:
419 |         page: 页码，默认 1。
420 |         limit: 每页数量，默认 20。
    |                        ^^
421 |         sort: 排序字段，默认 'created_at'。
422 |         order: 排序方向（'asc'、'desc'），默认 'desc'。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/credentials.py:421:19
    |
419 |         page: 页码，默认 1。
420 |         limit: 每页数量，默认 20。
421 |         sort: 排序字段，默认 'created_at'。
    |                       ^^
422 |         order: 排序方向（'asc'、'desc'），默认 'desc'。
423 |         search: 搜索关键词，可选。
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/credentials.py:422:20
    |
420 |         limit: 每页数量，默认 20。
421 |         sort: 排序字段，默认 'created_at'。
422 |         order: 排序方向（'asc'、'desc'），默认 'desc'。
    |                        ^^
423 |         search: 搜索关键词，可选。
424 |         credential_type: 凭据类型筛选，可选。
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/credentials.py:422:33
    |
420 |         limit: 每页数量，默认 20。
421 |         sort: 排序字段，默认 'created_at'。
422 |         order: 排序方向（'asc'、'desc'），默认 'desc'。
    |                                       ^^
423 |         search: 搜索关键词，可选。
424 |         credential_type: 凭据类型筛选，可选。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/credentials.py:422:34
    |
420 |         limit: 每页数量，默认 20。
421 |         sort: 排序字段，默认 'created_at'。
422 |         order: 排序方向（'asc'、'desc'），默认 'desc'。
    |                                         ^^
423 |         search: 搜索关键词，可选。
424 |         credential_type: 凭据类型筛选，可选。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/credentials.py:423:22
    |
421 |         sort: 排序字段，默认 'created_at'。
422 |         order: 排序方向（'asc'、'desc'），默认 'desc'。
423 |         search: 搜索关键词，可选。
    |                           ^^
424 |         credential_type: 凭据类型筛选，可选。
425 |         db_type: 数据库类型筛选，可选。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/credentials.py:424:32
    |
422 |         order: 排序方向（'asc'、'desc'），默认 'desc'。
423 |         search: 搜索关键词，可选。
424 |         credential_type: 凭据类型筛选，可选。
    |                                      ^^
425 |         db_type: 数据库类型筛选，可选。
426 |         status: 状态筛选，可选。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/credentials.py:425:25
    |
423 |         search: 搜索关键词，可选。
424 |         credential_type: 凭据类型筛选，可选。
425 |         db_type: 数据库类型筛选，可选。
    |                                ^^
426 |         status: 状态筛选，可选。
427 |         tags: 标签筛选（逗号分隔或数组），可选。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/credentials.py:426:21
    |
424 |         credential_type: 凭据类型筛选，可选。
425 |         db_type: 数据库类型筛选，可选。
426 |         status: 状态筛选，可选。
    |                         ^^
427 |         tags: 标签筛选（逗号分隔或数组），可选。
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/credentials.py:427:19
    |
425 |         db_type: 数据库类型筛选，可选。
426 |         status: 状态筛选，可选。
427 |         tags: 标签筛选（逗号分隔或数组），可选。
    |                       ^^
428 |
429 |     """
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/credentials.py:427:27
    |
425 |         db_type: 数据库类型筛选，可选。
426 |         status: 状态筛选，可选。
427 |         tags: 标签筛选（逗号分隔或数组），可选。
    |                                       ^^
428 |
429 |     """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/credentials.py:427:28
    |
425 |         db_type: 数据库类型筛选，可选。
426 |         status: 状态筛选，可选。
427 |         tags: 标签筛选（逗号分隔或数组），可选。
    |                                         ^^
428 |
429 |     """
    |

PLC0415 `import` should be at the top-level of a file
   --> app/routes/credentials.py:470:9
    |
469 |     if tag_params:
470 |         from app.models.tag import Tag
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
471 |         query = query.join(Credential.tags).filter(Tag.name.in_(tag_params))
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/credentials.py:557:15
    |
556 | # ---------------------------------------------------------------------------
557 | # 表单路由已由前端模态替代，不再暴露独立页面入口
    |                           ^^
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/dashboard.py:15:15
   |
13 | from app.constants.system_constants import SuccessMessages
14 |
15 | # 移除SyncData导入，使用新的同步会话模型
   |                   ^^
16 | from app.models.sync_session import SyncSession
17 | from app.models.user import User
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/dashboard.py:44:13
   |
42 |     """系统仪表板首页。.
43 |
44 |     渲染系统概览页面，展示实例、账户、容量等统计信息和图表。
   |                     ^^
45 |
46 |     Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/dashboard.py:82:16
   |
80 |     """获取系统概览 API。.
81 |
82 |     返回系统的统计概览数据，包括用户、实例、账户、容量等信息。
   |                           ^^
83 |
84 |     Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/dashboard.py:152:15
    |
150 |     """获取系统概览数据 (缓存版本)。.
151 |
152 |     聚合各模块的统计数据，包括用户、实例、账户、分类、容量和数据库信息。
    |                         ^^
153 |     结果缓存 5 分钟。
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/routes/dashboard.py:219:12
    |
217 |             },
218 |         }
219 |     except Exception as exc:
    |            ^^^^^^^^^
220 |         db.session.rollback()
221 |         log_error("获取系统概览失败", module="dashboard", error=str(exc))
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/routes/dashboard.py:262:12
    |
260 |             charts["sync_trend"] = get_sync_trend_data()
261 |
262 |     except Exception as exc:
    |            ^^^^^^^^^
263 |         log_error("获取图表数据失败", module="dashboard", error=str(exc))
264 |         charts = {}
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/dashboard.py:273:47
    |
272 |     Returns:
273 |         list[dict[str, int | str]]: 最近 7 天的日志数，包含日期与数量。
    |                                                      ^^
274 |
275 |     """
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/routes/dashboard.py:312:12
    |
311 |         return [{"status": status, "count": count} for status, count in status_count.items()]
312 |     except Exception as exc:
    |            ^^^^^^^^^
313 |         log_error("获取任务状态分布失败", module="dashboard", error=str(exc))
314 |         return []
    |

SLF001 Private member accessed: `_mapping`
   --> app/routes/dashboard.py:382:26
    |
380 |             .one_or_none()
381 |         )
382 |         result_mapping = result._mapping if result is not None else {}
    |                          ^^^^^^^^^^^^^^^
383 |
384 |         for start_dt, label in labels:
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/routes/dashboard.py:391:12
    |
389 |                 },
390 |             )
391 |     except Exception as exc:
    |            ^^^^^^^^^
392 |         log_error("获取同步趋势数据失败", module="dashboard", error=str(exc))
393 |         trend_data = []
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/routes/dashboard.py:442:12
    |
440 |             "uptime": get_system_uptime(),
441 |         }
442 |     except Exception as exc:
    |            ^^^^^^^^^
443 |         log_error("获取系统状态失败", module="dashboard", error=str(exc))
444 |         return {
    |

D104 Missing docstring in public package
--> app/routes/databases/__init__.py:1:1

D205 1 blank line required between summary line and description
 --> app/routes/databases/capacity_sync.py:1:1
  |
1 | / """数据库域：容量同步 API 路由
2 | | 专注于数据同步功能，不包含统计功能.
3 | | """
  | |___^
4 |
5 |   from __future__ import annotations
  |
help: Insert single blank line

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
 --> app/routes/databases/capacity_sync.py:1:8
  |
1 | """数据库域：容量同步 API 路由
  |            ^^
2 | 专注于数据同步功能，不包含统计功能.
3 | """
  |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/routes/databases/capacity_sync.py:2:10
  |
1 | """数据库域：容量同步 API 路由
2 | 专注于数据同步功能，不包含统计功能.
  |                   ^^
3 | """
  |

A004 Import `SystemError` is shadowing a Python builtin
  --> app/routes/databases/capacity_sync.py:11:39
   |
 9 | from flask import Blueprint, Response
10 |
11 | from app.errors import NotFoundError, SystemError
   |                                       ^^^^^^^^^^^
12 | from app.models.instance import Instance
13 | from app.services.aggregation.aggregation_service import AggregationService
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/databases/capacity_sync.py:46:10
   |
44 |     """采集实例容量信息。.
45 |
46 |     连接数据库，同步数据库列表，采集大小信息并保存。
   |               ^^
47 |
48 |     Args:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/databases/capacity_sync.py:46:18
   |
44 |     """采集实例容量信息。.
45 |
46 |     连接数据库，同步数据库列表，采集大小信息并保存。
   |                               ^^
47 |
48 |     Args:
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/routes/databases/capacity_sync.py:52:18
   |
51 |     Returns:
52 |         包含采集结果的字典：
   |                           ^^
53 |         - success: 是否成功
54 |         - databases: 数据库列表
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/routes/databases/capacity_sync.py:56:29
   |
54 |         - databases: 数据库列表
55 |         - database_count: 数据库数量
56 |         - total_size_mb: 总大小（MB）
   |                                ^^
57 |         - saved_count: 保存的记录数
58 |         - instance_stat_updated: 实例统计是否更新
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/routes/databases/capacity_sync.py:56:32
   |
54 |         - databases: 数据库列表
55 |         - database_count: 数据库数量
56 |         - total_size_mb: 总大小（MB）
   |                                    ^^
57 |         - saved_count: 保存的记录数
58 |         - instance_stat_updated: 实例统计是否更新
   |

BLE001 Do not catch blind exception: `Exception`
  --> app/routes/databases/capacity_sync.py:74:16
   |
72 |         try:
73 |             inventory_result = collector.synchronize_database_inventory()
74 |         except Exception as inventory_error:
   |                ^^^^^^^^^
75 |             log_error(
76 |                 "同步数据库列表失败",
   |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/databases/capacity_sync.py:99:37
    |
 97 |                 "instance_stat_updated": False,
 98 |                 "inventory": inventory_result,
 99 |                 "message": "未发现活跃数据库，已仅同步数据库列表",
    |                                             ^^
100 |             }
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/routes/databases/capacity_sync.py:115:16
    |
113 |         try:
114 |             saved_count = collector.save_collected_data(databases_data)
115 |         except Exception as exc:
    |                ^^^^^^^^^
116 |             log_error(
117 |                 "保存数据库容量数据失败",
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/routes/databases/capacity_sync.py:136:16
    |
134 |             aggregation_service.calculate_daily_database_aggregations_for_instance(instance.id)
135 |             aggregation_service.calculate_daily_aggregations_for_instance(instance.id)
136 |         except Exception as exc:
    |                ^^^^^^^^^
137 |             log_warning(
138 |                 "容量聚合刷新失败",
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/databases/capacity_sync.py:164:21
    |
162 |     """同步指定实例的容量信息。.
163 |
164 |     采集数据库大小信息并保存到统计表，同时触发聚合计算。
    |                                     ^^
165 |
166 |     Args:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/databases/capacity_sync.py:170:16
    |
169 |     Returns:
170 |         JSON 响应，包含容量同步结果、数据库数量和总大小。
    |                  ^^
171 |
172 |     Raises:
    |

TRY301 Abstract `raise` to an inner function
   --> app/routes/databases/capacity_sync.py:218:9
    |
216 |         )
217 |         error_message = result.get("message") or result.get("error") or "实例容量同步失败"
218 |         raise SystemError(error_message)
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
219 |
220 |     except NotFoundError:
    |

A004 Import `SystemError` is shadowing a Python builtin
  --> app/routes/databases/ledgers.py:14:39
   |
13 | from app.constants import DATABASE_TYPES
14 | from app.errors import NotFoundError, SystemError
   |                                       ^^^^^^^^^^^
15 | from app.services.ledgers.database_ledger_service import DatabaseLedgerService
16 | from app.utils.decorators import view_required
   |

D205 1 blank line required between summary line and description
 --> app/routes/files.py:1:1
  |
1 | / """文件导入导出路由
2 | | 统一处理全局的导出/上传相关接口.
3 | | """
  | |___^
4 |
5 |   from __future__ import annotations
  |
help: Insert single blank line

A004 Import `SystemError` is shadowing a Python builtin
  --> app/routes/files.py:23:24
   |
21 |     INSTANCE_IMPORT_TEMPLATE_SAMPLE,
22 | )
23 | from app.errors import SystemError, ValidationError
   |                        ^^^^^^^^^^^
24 | from app.models.account_permission import AccountPermission
25 | from app.models.instance import Instance
   |

C901 `export_accounts` is too complex (17 > 10)
  --> app/routes/files.py:39:5
   |
37 | @login_required
38 | @view_required
39 | def export_accounts() -> Response:
   |     ^^^^^^^^^^^^^^^
40 |     """导出账户数据为 CSV。.
   |

PLR0912 Too many branches (18 > 12)
  --> app/routes/files.py:39:5
   |
37 | @login_required
38 | @view_required
39 | def export_accounts() -> Response:
   |     ^^^^^^^^^^^^^^^
40 |     """导出账户数据为 CSV。.
   |

PLR0915 Too many statements (64 > 50)
  --> app/routes/files.py:39:5
   |
37 | @login_required
38 | @view_required
39 | def export_accounts() -> Response:
   |     ^^^^^^^^^^^^^^^
40 |     """导出账户数据为 CSV。.
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/files.py:51:25
   |
50 |     Query Parameters:
51 |         db_type: 数据库类型筛选，可选。
   |                                ^^
52 |         search: 搜索关键词，可选。
53 |         instance_id: 实例 ID 筛选，可选。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/files.py:52:22
   |
50 |     Query Parameters:
51 |         db_type: 数据库类型筛选，可选。
52 |         search: 搜索关键词，可选。
   |                           ^^
53 |         instance_id: 实例 ID 筛选，可选。
54 |         is_locked: 锁定状态筛选，可选。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/files.py:53:30
   |
51 |         db_type: 数据库类型筛选，可选。
52 |         search: 搜索关键词，可选。
53 |         instance_id: 实例 ID 筛选，可选。
   |                                  ^^
54 |         is_locked: 锁定状态筛选，可选。
55 |         is_superuser: 超级用户筛选，可选。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/files.py:54:26
   |
52 |         search: 搜索关键词，可选。
53 |         instance_id: 实例 ID 筛选，可选。
54 |         is_locked: 锁定状态筛选，可选。
   |                                ^^
55 |         is_superuser: 超级用户筛选，可选。
56 |         tags: 标签筛选（数组），可选。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/files.py:55:29
   |
53 |         instance_id: 实例 ID 筛选，可选。
54 |         is_locked: 锁定状态筛选，可选。
55 |         is_superuser: 超级用户筛选，可选。
   |                                   ^^
56 |         tags: 标签筛选（数组），可选。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/routes/files.py:56:19
   |
54 |         is_locked: 锁定状态筛选，可选。
55 |         is_superuser: 超级用户筛选，可选。
56 |         tags: 标签筛选（数组），可选。
   |                       ^^
57 |
58 |     """
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/routes/files.py:56:22
   |
54 |         is_locked: 锁定状态筛选，可选。
55 |         is_superuser: 超级用户筛选，可选。
56 |         tags: 标签筛选（数组），可选。
   |                             ^^
57 |
58 |     """
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/files.py:56:23
   |
54 |         is_locked: 锁定状态筛选，可选。
55 |         is_superuser: 超级用户筛选，可选。
56 |         tags: 标签筛选（数组），可选。
   |                               ^^
57 |
58 |     """
   |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/routes/files.py:60:17
   |
58 |     """
59 |     try:
60 |         # 获取查询参数（与列表页保持一致）
   |                       ^^
61 |         db_type = request.args.get("db_type", type=str)
62 |         search = request.args.get("search", "").strip()
   |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/routes/files.py:60:26
   |
58 |     """
59 |     try:
60 |         # 获取查询参数（与列表页保持一致）
   |                                         ^^
61 |         db_type = request.args.get("db_type", type=str)
62 |         search = request.args.get("search", "").strip()
   |

PLC0415 `import` should be at the top-level of a file
  --> app/routes/files.py:68:9
   |
66 |         tags = [tag for tag in request.args.getlist("tags") if tag.strip()]
67 |
68 |         from app.models.instance_account import InstanceAccount
   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
69 |
70 |         # 构建查询
   |

BLE001 Do not catch blind exception: `Exception`
   --> app/routes/files.py:102:20
    |
100 |             try:
101 |                 query = query.join(Instance).join(Instance.tags).filter(Tag.name.in_(tags))
102 |             except Exception as exc:
    |                    ^^^^^^^^^
103 |                 log_error(
104 |                     "导出账户时标签过滤失败",
    |

PLC0415 `import` should be at the top-level of a file
   --> app/routes/files.py:112:9
    |
110 |         accounts = query.all()
111 |
112 |         from app.models.account_classification import AccountClassificationAssignment
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
113 |
114 |         classifications: dict[int, list[str]] = {}
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/files.py:194:22
    |
193 |     Query Parameters:
194 |         search: 搜索关键词，可选。
    |                           ^^
195 |         db_type: 数据库类型筛选，可选。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/files.py:195:25
    |
193 |     Query Parameters:
194 |         search: 搜索关键词，可选。
195 |         db_type: 数据库类型筛选，可选。
    |                                ^^
196 |
197 |     """
    |

PLC0415 `import` should be at the top-level of a file
   --> app/routes/files.py:284:5
    |
282 | def export_database_ledger() -> Response:
283 |     """导出数据库台账列表为 CSV。."""
284 |     from app.services.ledgers.database_ledger_service import DatabaseLedgerService
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
285 |
286 |     try:
    |

E501 Line too long (121 > 120)
   --> app/routes/files.py:300:89
    |
298 |         output = io.StringIO()
299 |         writer = csv.writer(output)
300 |         writer.writerow(["数据库名称", "实例名称", "主机", "数据库类型", "标签", "最新容量", "最后采集时间", "同步状态"])
    |                                                                                                                         ^
301 |
302 |         for row in rows:
    |

C901 `export_logs` is too complex (16 > 10)
   --> app/routes/files.py:343:5
    |
341 | @files_bp.route("/api/log-export", methods=["GET"])
342 | @login_required
343 | def export_logs() -> Response:
    |     ^^^^^^^^^^^
344 |     """导出日志 API。.
    |

PLR0912 Too many branches (15 > 12)
   --> app/routes/files.py:343:5
    |
341 | @files_bp.route("/api/log-export", methods=["GET"])
342 | @login_required
343 | def export_logs() -> Response:
    |     ^^^^^^^^^^^
344 |     """导出日志 API。.
    |

PLR0915 Too many statements (61 > 50)
   --> app/routes/files.py:343:5
    |
341 | @files_bp.route("/api/log-export", methods=["GET"])
342 | @login_required
343 | def export_logs() -> Response:
    |     ^^^^^^^^^^^
344 |     """导出日志 API。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/files.py:346:23
    |
344 |     """导出日志 API。.
345 |
346 |     支持 JSON 和 CSV 两种格式，可按级别、模块和时间范围筛选。
    |                              ^^
347 |
348 |     Returns:
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/files.py:356:21
    |
355 |     Query Parameters:
356 |         format: 导出格式（'json' 或 'csv'），默认 'json'。
    |                         ^^
357 |         level: 日志级别筛选，可选。
358 |         module: 模块名称筛选，可选。
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/files.py:356:36
    |
355 |     Query Parameters:
356 |         format: 导出格式（'json' 或 'csv'），默认 'json'。
    |                                          ^^
357 |         level: 日志级别筛选，可选。
358 |         module: 模块名称筛选，可选。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/files.py:356:37
    |
355 |     Query Parameters:
356 |         format: 导出格式（'json' 或 'csv'），默认 'json'。
    |                                            ^^
357 |         level: 日志级别筛选，可选。
358 |         module: 模块名称筛选，可选。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/files.py:357:22
    |
355 |     Query Parameters:
356 |         format: 导出格式（'json' 或 'csv'），默认 'json'。
357 |         level: 日志级别筛选，可选。
    |                            ^^
358 |         module: 模块名称筛选，可选。
359 |         start_time: 开始时间（ISO 8601 格式），可选。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/files.py:358:23
    |
356 |         format: 导出格式（'json' 或 'csv'），默认 'json'。
357 |         level: 日志级别筛选，可选。
358 |         module: 模块名称筛选，可选。
    |                             ^^
359 |         start_time: 开始时间（ISO 8601 格式），可选。
360 |         end_time: 结束时间（ISO 8601 格式），可选。
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/files.py:359:25
    |
357 |         level: 日志级别筛选，可选。
358 |         module: 模块名称筛选，可选。
359 |         start_time: 开始时间（ISO 8601 格式），可选。
    |                             ^^
360 |         end_time: 结束时间（ISO 8601 格式），可选。
361 |         limit: 最大导出数量，默认 1000。
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/files.py:359:37
    |
357 |         level: 日志级别筛选，可选。
358 |         module: 模块名称筛选，可选。
359 |         start_time: 开始时间（ISO 8601 格式），可选。
    |                                            ^^
360 |         end_time: 结束时间（ISO 8601 格式），可选。
361 |         limit: 最大导出数量，默认 1000。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/files.py:359:38
    |
357 |         level: 日志级别筛选，可选。
358 |         module: 模块名称筛选，可选。
359 |         start_time: 开始时间（ISO 8601 格式），可选。
    |                                              ^^
360 |         end_time: 结束时间（ISO 8601 格式），可选。
361 |         limit: 最大导出数量，默认 1000。
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/files.py:360:23
    |
358 |         module: 模块名称筛选，可选。
359 |         start_time: 开始时间（ISO 8601 格式），可选。
360 |         end_time: 结束时间（ISO 8601 格式），可选。
    |                           ^^
361 |         limit: 最大导出数量，默认 1000。
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/files.py:360:35
    |
358 |         module: 模块名称筛选，可选。
359 |         start_time: 开始时间（ISO 8601 格式），可选。
360 |         end_time: 结束时间（ISO 8601 格式），可选。
    |                                          ^^
361 |         limit: 最大导出数量，默认 1000。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/files.py:360:36
    |
358 |         module: 模块名称筛选，可选。
359 |         start_time: 开始时间（ISO 8601 格式），可选。
360 |         end_time: 结束时间（ISO 8601 格式），可选。
    |                                            ^^
361 |         limit: 最大导出数量，默认 1000。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/files.py:361:22
    |
359 |         start_time: 开始时间（ISO 8601 格式），可选。
360 |         end_time: 结束时间（ISO 8601 格式），可选。
361 |         limit: 最大导出数量，默认 1000。
    |                            ^^
362 |
363 |     """
    |

PERF401 Use a list comprehension to create a transformed list
   --> app/routes/files.py:407:17
    |
405 |               logs_data: list[dict[str, Any]] = []
406 |               for log in logs:
407 | /                 logs_data.append(
408 | |                     {
409 | |                         "id": log.id,
410 | |                         "timestamp": log.timestamp.isoformat() if log.timestamp else None,
411 | |                         "level": log.level.value if log.level else None,
412 | |                         "module": log.module,
413 | |                         "message": log.message,
414 | |                         "traceback": log.traceback,
415 | |                         "context": log.context,
416 | |                         "created_at": log.created_at.isoformat() if log.created_at else None,
417 | |                     },
418 | |                 )
    | |_________________^
419 |
420 |               payload = {"logs": logs_data, "exported_at": time_utils.now().isoformat()}
    |
help: Replace for loop with list comprehension

TRY301 Abstract `raise` to an inner function
   --> app/routes/files.py:475:9
    |
474 |         msg = "不支持的导出格式"
475 |         raise ValidationError(msg)
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^
476 |
477 |     except Exception as exc:
    |

A004 Import `SystemError` is shadowing a Python builtin
  --> app/routes/health.py:13:24
   |
11 | from app.constants import TimeConstants
12 | from app.constants.system_constants import SuccessMessages
13 | from app.errors import SystemError
   |                        ^^^^^^^^^^^
14 | from app.services.cache_service import cache_manager
15 | from app.utils.response_utils import jsonify_unified_success
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/health.py:28:16
   |
27 |     Returns:
28 |         JSON 响应，包含服务状态和版本信息。
   |                  ^^
29 |
30 |     Raises:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/health.py:52:16
   |
51 |     Returns:
52 |         JSON 响应，包含各组件的详细健康状态。
   |                  ^^
53 |
54 |     Raises:
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/health.py:112:12
    |
110 | @health_bp.route("/api/health")
111 | def get_health() -> Response:
112 |     """健康检查（供外部监控使用）。.
    |                ^^
113 |
114 |     快速检查数据库和 Redis 连接状态，适用于监控系统。
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/health.py:112:20
    |
110 | @health_bp.route("/api/health")
111 | def get_health() -> Response:
112 |     """健康检查（供外部监控使用）。.
    |                                ^^
113 |
114 |     快速检查数据库和 Redis 连接状态，适用于监控系统。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/health.py:114:24
    |
112 |     """健康检查（供外部监控使用）。.
113 |
114 |     快速检查数据库和 Redis 连接状态，适用于监控系统。
    |                                    ^^
115 |
116 |     Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/health.py:117:16
    |
116 |     Returns:
117 |         JSON 响应，包含各组件的连接状态和系统运行时间。
    |                  ^^
118 |
119 |     """
    |

PLC0415 `import` should be at the top-level of a file
   --> app/routes/health.py:125:9
    |
123 |     db_status = "connected"
124 |     try:
125 |         from sqlalchemy import text
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^
126 |
127 |         db.session.execute(text("SELECT 1"))
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/routes/health.py:128:12
    |
127 |         db.session.execute(text("SELECT 1"))
128 |     except Exception:
    |            ^^^^^^^^^
129 |         db_status = "error"
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/routes/health.py:135:12
    |
133 |     try:
134 |         redis_status = "connected" if cache_manager and cache_manager.health_check() else "error"
135 |     except Exception:
    |            ^^^^^^^^^
136 |         redis_status = "error"
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/health.py:167:16
    |
166 |     Returns:
167 |         JSON 响应，包含缓存健康状态。
    |                  ^^
168 |
169 |     Raises:
    |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/routes/health.py:189:18
    |
188 |     Returns:
189 |         包含健康状态的字典：
    |                           ^^
190 |         - healthy: 是否健康
191 |         - response_time_ms: 响应时间（毫秒）
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/health.py:191:33
    |
189 |         包含健康状态的字典：
190 |         - healthy: 是否健康
191 |         - response_time_ms: 响应时间（毫秒）
    |                                     ^^
192 |         - status: 连接状态（'connected' 或 'disconnected'）
193 |         - error: 错误信息（如果失败）
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/health.py:191:36
    |
189 |         包含健康状态的字典：
190 |         - healthy: 是否健康
191 |         - response_time_ms: 响应时间（毫秒）
    |                                           ^^
192 |         - status: 连接状态（'connected' 或 'disconnected'）
193 |         - error: 错误信息（如果失败）
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/health.py:192:23
    |
190 |         - healthy: 是否健康
191 |         - response_time_ms: 响应时间（毫秒）
192 |         - status: 连接状态（'connected' 或 'disconnected'）
    |                           ^^
193 |         - error: 错误信息（如果失败）
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/health.py:192:52
    |
190 |         - healthy: 是否健康
191 |         - response_time_ms: 响应时间（毫秒）
192 |         - status: 连接状态（'connected' 或 'disconnected'）
    |                                                          ^^
193 |         - error: 错误信息（如果失败）
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/health.py:193:22
    |
191 |         - response_time_ms: 响应时间（毫秒）
192 |         - status: 连接状态（'connected' 或 'disconnected'）
193 |         - error: 错误信息（如果失败）
    |                          ^^
194 |
195 |     """
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/health.py:193:27
    |
191 |         - response_time_ms: 响应时间（毫秒）
192 |         - status: 连接状态（'connected' 或 'disconnected'）
193 |         - error: 错误信息（如果失败）
    |                                    ^^
194 |
195 |     """
    |

PLC0415 `import` should be at the top-level of a file
   --> app/routes/health.py:198:9
    |
196 |     try:
197 |         start_time = time.time()
198 |         from sqlalchemy import text
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^
199 |         db.session.execute(text("SELECT 1"))
200 |         response_time = (time.time() - start_time) * 1000  # 毫秒
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/routes/health.py:207:12
    |
205 |             "status": "connected",
206 |         }
207 |     except Exception as exc:
    |            ^^^^^^^^^
208 |         log_error("数据库健康检查失败", module="health", error=str(exc))
209 |         return {"healthy": False, "error": str(exc), "status": "disconnected"}
    |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/routes/health.py:216:18
    |
215 |     Returns:
216 |         包含健康状态的字典：
    |                           ^^
217 |         - healthy: 是否健康
218 |         - response_time_ms: 响应时间（毫秒）
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/health.py:218:33
    |
216 |         包含健康状态的字典：
217 |         - healthy: 是否健康
218 |         - response_time_ms: 响应时间（毫秒）
    |                                     ^^
219 |         - status: 连接状态（'connected' 或 'disconnected'）
220 |         - error: 错误信息（如果失败）
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/health.py:218:36
    |
216 |         包含健康状态的字典：
217 |         - healthy: 是否健康
218 |         - response_time_ms: 响应时间（毫秒）
    |                                           ^^
219 |         - status: 连接状态（'connected' 或 'disconnected'）
220 |         - error: 错误信息（如果失败）
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/health.py:219:23
    |
217 |         - healthy: 是否健康
218 |         - response_time_ms: 响应时间（毫秒）
219 |         - status: 连接状态（'connected' 或 'disconnected'）
    |                           ^^
220 |         - error: 错误信息（如果失败）
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/health.py:219:52
    |
217 |         - healthy: 是否健康
218 |         - response_time_ms: 响应时间（毫秒）
219 |         - status: 连接状态（'connected' 或 'disconnected'）
    |                                                          ^^
220 |         - error: 错误信息（如果失败）
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/health.py:220:22
    |
218 |         - response_time_ms: 响应时间（毫秒）
219 |         - status: 连接状态（'connected' 或 'disconnected'）
220 |         - error: 错误信息（如果失败）
    |                          ^^
221 |
222 |     """
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/health.py:220:27
    |
218 |         - response_time_ms: 响应时间（毫秒）
219 |         - status: 连接状态（'connected' 或 'disconnected'）
220 |         - error: 错误信息（如果失败）
    |                                    ^^
221 |
222 |     """
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/routes/health.py:234:12
    |
232 |             "status": "connected" if result == "ok" else "error",
233 |         }
234 |     except Exception as exc:
    |            ^^^^^^^^^
235 |         log_error("缓存健康检查失败", module="health", error=str(exc))
236 |         return {"healthy": False, "error": str(exc), "status": "disconnected"}
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/health.py:242:20
    |
240 |     """检查系统资源健康状态。.
241 |
242 |     检查 CPU、内存和磁盘使用率，当任一指标超过 90% 时标记为不健康。
    |                               ^^
243 |
244 |     Returns:
    |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/routes/health.py:245:18
    |
244 |     Returns:
245 |         包含健康状态的字典：
    |                           ^^
246 |         - healthy: 是否健康（所有指标 < 90%）
247 |         - cpu_percent: CPU 使用率
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/health.py:246:24
    |
244 |     Returns:
245 |         包含健康状态的字典：
246 |         - healthy: 是否健康（所有指标 < 90%）
    |                            ^^
247 |         - cpu_percent: CPU 使用率
248 |         - memory_percent: 内存使用率
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/health.py:246:35
    |
244 |     Returns:
245 |         包含健康状态的字典：
246 |         - healthy: 是否健康（所有指标 < 90%）
    |                                            ^^
247 |         - cpu_percent: CPU 使用率
248 |         - memory_percent: 内存使用率
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/health.py:250:21
    |
248 |         - memory_percent: 内存使用率
249 |         - disk_percent: 磁盘使用率
250 |         - status: 状态（'healthy'、'warning' 或 'error'）
    |                       ^^
251 |         - error: 错误信息（如果失败）
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/health.py:250:51
    |
248 |         - memory_percent: 内存使用率
249 |         - disk_percent: 磁盘使用率
250 |         - status: 状态（'healthy'、'warning' 或 'error'）
    |                                                        ^^
251 |         - error: 错误信息（如果失败）
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/health.py:251:22
    |
249 |         - disk_percent: 磁盘使用率
250 |         - status: 状态（'healthy'、'warning' 或 'error'）
251 |         - error: 错误信息（如果失败）
    |                          ^^
252 |
253 |     """
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/health.py:251:27
    |
249 |         - disk_percent: 磁盘使用率
250 |         - status: 状态（'healthy'、'warning' 或 'error'）
251 |         - error: 错误信息（如果失败）
    |                                    ^^
252 |
253 |     """
    |

PLR2004 Magic value used in comparison, consider replacing `90` with a constant variable
   --> app/routes/health.py:269:31
    |
267 |         healthy = all(
268 |             [
269 |                 cpu_percent < 90,  # CPU使用率低于90%
    |                               ^^
270 |                 memory_percent < 90,  # 内存使用率低于90%
271 |                 disk_percent < 90,  # 磁盘使用率低于90%
    |

PLR2004 Magic value used in comparison, consider replacing `90` with a constant variable
   --> app/routes/health.py:270:34
    |
268 |             [
269 |                 cpu_percent < 90,  # CPU使用率低于90%
270 |                 memory_percent < 90,  # 内存使用率低于90%
    |                                  ^^
271 |                 disk_percent < 90,  # 磁盘使用率低于90%
272 |             ],
    |

PLR2004 Magic value used in comparison, consider replacing `90` with a constant variable
   --> app/routes/health.py:271:32
    |
269 |                 cpu_percent < 90,  # CPU使用率低于90%
270 |                 memory_percent < 90,  # 内存使用率低于90%
271 |                 disk_percent < 90,  # 磁盘使用率低于90%
    |                                ^^
272 |             ],
273 |         )
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/routes/health.py:282:12
    |
280 |             "status": "healthy" if healthy else "warning",
281 |         }
282 |     except Exception as exc:
    |            ^^^^^^^^^
283 |         log_error("系统健康检查失败", module="health", error=str(exc))
284 |         return {"healthy": False, "error": str(exc), "status": "error"}
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/health.py:291:16
    |
290 |     Returns:
291 |         运行时间字符串，格式：'X天 X小时 X分钟'。
    |                       ^^
292 |         如果无法获取返回 '未知'。
    |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/routes/health.py:291:19
    |
290 |     Returns:
291 |         运行时间字符串，格式：'X天 X小时 X分钟'。
    |                             ^^
292 |         如果无法获取返回 '未知'。
    |

PLC0415 `import` should be at the top-level of a file
   --> app/routes/health.py:296:9
    |
294 |     """
295 |     try:
296 |         from app import app_start_time
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
297 |
298 |         current_time = time_utils.now_china()
    |

TRY300 Consider moving this statement to an `else` block
   --> app/routes/health.py:305:9
    |
303 |         minutes, _ = divmod(remainder, 60)
304 |
305 |         return f"{days}天 {hours}小时 {minutes}分钟"
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
306 |     except Exception:
307 |         return "未知"
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/routes/health.py:306:12
    |
305 |         return f"{days}天 {hours}小时 {minutes}分钟"
306 |     except Exception:
    |            ^^^^^^^^^
307 |         return "未知"
    |

D104 Missing docstring in public package
--> app/routes/history/__init__.py:1:1

D205 1 blank line required between summary line and description
 --> app/routes/history/logs.py:2:1
  |
2 | / """鲸落 - 统一日志系统API路由
3 | | 提供日志查询、展示和管理的RESTful API.
4 | | """
  | |___^
5 |
6 |   from datetime import datetime, timedelta
  |
help: Insert single blank line

A004 Import `SystemError` is shadowing a Python builtin
  --> app/routes/history/logs.py:14:24
   |
12 | from app import db
13 | from app.constants import LOG_LEVELS, TIME_RANGES
14 | from app.errors import SystemError, ValidationError
   |                        ^^^^^^^^^^^
15 | from app.models.unified_log import LogLevel, UnifiedLog
16 | from app.utils.query_filter_utils import get_log_modules as load_log_modules
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/history/logs.py:33:16
   |
31 |     """日志中心仪表板。.
32 |
33 |     渲染日志查询和展示页面，提供日志级别、模块和时间范围的筛选选项。
   |                           ^^
34 |
35 |     Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/history/logs.py:85:29
   |
84 |     Args:
85 |         raw_value: ISO 格式字符串，可为 None。
   |                                  ^^
86 |
87 |     Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/history/logs.py:88:41
   |
87 |     Returns:
88 |         datetime | None: 解析成功返回 datetime，否则 None。
   |                                               ^^
89 |
90 |     """
   |

C901 `search_logs` is too complex (17 > 10)
   --> app/routes/history/logs.py:102:5
    |
100 | @logs_bp.route("/api/search", methods=["GET"])
101 | @login_required
102 | def search_logs() -> Response:
    |     ^^^^^^^^^^^
103 |     """搜索日志 API。.
    |

PLR0912 Too many branches (17 > 12)
   --> app/routes/history/logs.py:102:5
    |
100 | @logs_bp.route("/api/search", methods=["GET"])
101 | @login_required
102 | def search_logs() -> Response:
    |     ^^^^^^^^^^^
103 |     """搜索日志 API。.
    |

PLR0915 Too many statements (67 > 50)
   --> app/routes/history/logs.py:102:5
    |
100 | @logs_bp.route("/api/search", methods=["GET"])
101 | @login_required
102 | def search_logs() -> Response:
    |     ^^^^^^^^^^^
103 |     """搜索日志 API。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/history/logs.py:109:17
    |
108 |     Query Parameters:
109 |         page: 页码，默认 1。
    |                   ^^
110 |         per_page: 每页数量，默认 50。
111 |         level: 日志级别筛选。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/history/logs.py:110:23
    |
108 |     Query Parameters:
109 |         page: 页码，默认 1。
110 |         per_page: 每页数量，默认 50。
    |                           ^^
111 |         level: 日志级别筛选。
112 |         module: 模块筛选。
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/history/logs.py:114:25
    |
112 |         module: 模块筛选。
113 |         q: 搜索关键词。
114 |         start_time: 开始时间（ISO 格式）。
    |                             ^^
115 |         end_time: 结束时间（ISO 格式）。
116 |         hours: 最近 N 小时。
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/history/logs.py:114:32
    |
112 |         module: 模块筛选。
113 |         q: 搜索关键词。
114 |         start_time: 开始时间（ISO 格式）。
    |                                       ^^
115 |         end_time: 结束时间（ISO 格式）。
116 |         hours: 最近 N 小时。
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/history/logs.py:115:23
    |
113 |         q: 搜索关键词。
114 |         start_time: 开始时间（ISO 格式）。
115 |         end_time: 结束时间（ISO 格式）。
    |                           ^^
116 |         hours: 最近 N 小时。
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/history/logs.py:115:30
    |
113 |         q: 搜索关键词。
114 |         start_time: 开始时间（ISO 格式）。
115 |         end_time: 结束时间（ISO 格式）。
    |                                     ^^
116 |         hours: 最近 N 小时。
    |

RUF003 Comment contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/routes/history/logs.py:169:21
    |
167 |                 raise ValidationError(msg) from exc
168 |         elif not start_time and not end_time and not hours:
169 |             # 默认时间范围：最近24小时
    |                           ^^
170 |             default_start = time_utils.now() - timedelta(hours=24)
171 |             query = query.filter(UnifiedLog.timestamp >= default_start)
    |

PERF401 Use a list comprehension to create a transformed list
   --> app/routes/history/logs.py:212:13
    |
210 |         logs = []
211 |         for log_entry in pagination.items:
212 |             logs.append(log_entry.to_dict())
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
213 |
214 |         response_data = {
    |
help: Replace for loop with list comprehension

C901 `list_logs` is too complex (11 > 10)
   --> app/routes/history/logs.py:239:5
    |
237 | @logs_bp.route("/api/list", methods=["GET"])
238 | @login_required
239 | def list_logs() -> Response:
    |     ^^^^^^^^^
240 |     """Grid.js 日志列表 API。.
    |

PLC0415 `import` should be at the top-level of a file
   --> app/routes/history/logs.py:396:9
    |
394 |     """
395 |     try:
396 |         from sqlalchemy import distinct
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
397 |
398 |         # 获取所有模块
    |

C901 `get_log_stats` is too complex (11 > 10)
   --> app/routes/history/logs.py:414:5
    |
412 | @logs_bp.route("/api/stats", methods=["GET"])
413 | @login_required
414 | def get_log_stats() -> tuple[dict, int]:
    |     ^^^^^^^^^^^^^
415 |     """获取日志统计 API（兼容旧前端）。.
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/history/logs.py:415:18
    |
413 | @login_required
414 | def get_log_stats() -> tuple[dict, int]:
415 |     """获取日志统计 API（兼容旧前端）。.
    |                        ^^
416 |
417 |     Returns:
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/history/logs.py:415:24
    |
413 | @login_required
414 | def get_log_stats() -> tuple[dict, int]:
415 |     """获取日志统计 API（兼容旧前端）。.
    |                                    ^^
416 |
417 |     Returns:
    |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/history/logs.py:465:16
    |
463 |         total_logs = query.count()
464 |
465 |         # 错误日志数（包含ERROR和CRITICAL级别）
    |                     ^^
466 |         error_query = query.filter(UnifiedLog.level.in_([LogLevel.ERROR, LogLevel.CRITICAL]))
467 |         error_logs = error_query.count()
    |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/history/logs.py:465:35
    |
463 |         total_logs = query.count()
464 |
465 |         # 错误日志数（包含ERROR和CRITICAL级别）
    |                                              ^^
466 |         error_query = query.filter(UnifiedLog.level.in_([LogLevel.ERROR, LogLevel.CRITICAL]))
467 |         error_logs = error_query.count()
    |

PLC0415 `import` should be at the top-level of a file
   --> app/routes/history/logs.py:474:9
    |
473 |         # 活跃模块数
474 |         from sqlalchemy import distinct
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
475 |         modules_query = db.session.query(distinct(UnifiedLog.module))
    |

A004 Import `SystemError` is shadowing a Python builtin
  --> app/routes/history/sessions.py:8:39
   |
 7 | from app.constants import STATUS_SYNC_OPTIONS, SYNC_CATEGORIES, SYNC_TYPES, SyncStatus
 8 | from app.errors import NotFoundError, SystemError
   |                                       ^^^^^^^^^^^
 9 | from app.services.sync_session_service import sync_session_service
10 | from app.utils.decorators import require_csrf, view_required
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/routes/history/sessions.py:53:15
   |
51 |     """获取同步会话列表 API。.
52 |
53 |     支持分页、排序和筛选（按类型、分类、状态）。
   |                         ^^
54 |
55 |     Returns:
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/routes/history/sessions.py:53:25
   |
51 |     """获取同步会话列表 API。.
52 |
53 |     支持分页、排序和筛选（按类型、分类、状态）。
   |                                             ^^
54 |
55 |     Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/history/sessions.py:56:16
   |
55 |     Returns:
56 |         JSON 响应，包含会话列表和分页信息。
   |                  ^^
57 |
58 |     Raises:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/history/sessions.py:62:26
   |
61 |     Query Parameters:
62 |         sync_type: 同步类型筛选，可选。
   |                                ^^
63 |         sync_category: 同步分类筛选，可选。
64 |         status: 状态筛选，可选。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/history/sessions.py:63:30
   |
61 |     Query Parameters:
62 |         sync_type: 同步类型筛选，可选。
63 |         sync_category: 同步分类筛选，可选。
   |                                    ^^
64 |         status: 状态筛选，可选。
65 |         page: 页码，默认 1。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/history/sessions.py:64:21
   |
62 |         sync_type: 同步类型筛选，可选。
63 |         sync_category: 同步分类筛选，可选。
64 |         status: 状态筛选，可选。
   |                         ^^
65 |         page: 页码，默认 1。
66 |         limit: 每页数量，默认 20，最大 100。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/history/sessions.py:65:17
   |
63 |         sync_category: 同步分类筛选，可选。
64 |         status: 状态筛选，可选。
65 |         page: 页码，默认 1。
   |                   ^^
66 |         limit: 每页数量，默认 20，最大 100。
67 |         sort: 排序字段，默认 'started_at'。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/history/sessions.py:66:20
   |
64 |         status: 状态筛选，可选。
65 |         page: 页码，默认 1。
66 |         limit: 每页数量，默认 20，最大 100。
   |                        ^^
67 |         sort: 排序字段，默认 'started_at'。
68 |         order: 排序方向（'asc'、'desc'），默认 'desc'。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/history/sessions.py:66:26
   |
64 |         status: 状态筛选，可选。
65 |         page: 页码，默认 1。
66 |         limit: 每页数量，默认 20，最大 100。
   |                                 ^^
67 |         sort: 排序字段，默认 'started_at'。
68 |         order: 排序方向（'asc'、'desc'），默认 'desc'。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/history/sessions.py:67:19
   |
65 |         page: 页码，默认 1。
66 |         limit: 每页数量，默认 20，最大 100。
67 |         sort: 排序字段，默认 'started_at'。
   |                       ^^
68 |         order: 排序方向（'asc'、'desc'），默认 'desc'。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/routes/history/sessions.py:68:20
   |
66 |         limit: 每页数量，默认 20，最大 100。
67 |         sort: 排序字段，默认 'started_at'。
68 |         order: 排序方向（'asc'、'desc'），默认 'desc'。
   |                        ^^
69 |
70 |     """
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/routes/history/sessions.py:68:33
   |
66 |         limit: 每页数量，默认 20，最大 100。
67 |         sort: 排序字段，默认 'started_at'。
68 |         order: 排序方向（'asc'、'desc'），默认 'desc'。
   |                                       ^^
69 |
70 |     """
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/history/sessions.py:68:34
   |
66 |         limit: 每页数量，默认 20，最大 100。
67 |         sort: 排序字段，默认 'started_at'。
68 |         order: 排序方向（'asc'、'desc'），默认 'desc'。
   |                                         ^^
69 |
70 |     """
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/history/sessions.py:137:16
    |
136 |     Returns:
137 |         JSON 响应，包含会话详情、实例记录和进度百分比。
    |                  ^^
138 |
139 |     Raises:
    |

TRY301 Abstract `raise` to an inner function
   --> app/routes/history/sessions.py:149:13
    |
147 |         if not session:
148 |             msg = "会话不存在"
149 |             raise NotFoundError(msg)
    |             ^^^^^^^^^^^^^^^^^^^^^^^^
150 |
151 |         # 获取实例记录
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/history/sessions.py:207:22
    |
205 |             )
206 |             return jsonify_unified_success(message="会话已取消")
207 |         msg = "取消会话失败，会话不存在或已结束"
    |                            ^^
208 |         raise NotFoundError(msg)
    |

TRY301 Abstract `raise` to an inner function
   --> app/routes/history/sessions.py:208:9
    |
206 |             return jsonify_unified_success(message="会话已取消")
207 |         msg = "取消会话失败，会话不存在或已结束"
208 |         raise NotFoundError(msg)
    |         ^^^^^^^^^^^^^^^^^^^^^^^^
209 |
210 |     except Exception as e:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/history/sessions.py:233:16
    |
232 |     Returns:
233 |         JSON 响应，包含会话信息、错误记录列表和错误数量。
    |                  ^^
234 |
235 |     Raises:
    |

TRY301 Abstract `raise` to an inner function
   --> app/routes/history/sessions.py:245:13
    |
243 |         if not session:
244 |             msg = "会话不存在"
245 |             raise NotFoundError(msg)
    |             ^^^^^^^^^^^^^^^^^^^^^^^^
246 |
247 |         # 获取所有实例记录
    |

INP001 File `app/routes/instances/batch.py` is part of an implicit namespace package. Add an `__init__.py`.
--> app/routes/instances/batch.py:1:1

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
 --> app/routes/instances/batch.py:1:15
  |
1 | """Instances 域：批量创建与删除路由。."""
  |                ^^
2 |
3 | from __future__ import annotations
  |

A004 Import `SystemError` is shadowing a Python builtin
  --> app/routes/instances/batch.py:19:24
   |
17 | )
18 | from app.constants.system_constants import ErrorCategory
19 | from app.errors import SystemError, ValidationError
   |                        ^^^^^^^^^^^
20 | from app.services.instances import InstanceBatchCreationService, InstanceBatchDeletionService
21 | from app.utils.decorators import create_required, delete_required, require_csrf
   |

TRY301 Abstract `raise` to an inner function
   --> app/routes/instances/batch.py:127:13
    |
125 |         if not uploaded_file or not uploaded_file.filename.endswith(".csv"):
126 |             msg = "请上传CSV格式文件"
127 |             raise ValidationError(msg)
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^
128 |
129 |         return _process_csv_file(uploaded_file)
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `file_obj`
   --> app/routes/instances/batch.py:145:33
    |
145 | def _process_csv_file(file_obj: Any) -> Response:
    |                                 ^^^
146 |     """解析 CSV 文件并触发批量创建。.
    |

TRY301 Abstract `raise` to an inner function
   --> app/routes/instances/batch.py:171:13
    |
169 |         if not instances_data:
170 |             msg = "CSV文件为空或未包含有效数据"
171 |             raise ValidationError(msg)
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^
172 |
173 |         return _create_instances(instances_data)
    |

INP001 File `app/routes/instances/detail.py` is part of an implicit namespace package. Add an `__init__.py`.
--> app/routes/instances/detail.py:1:1

A004 Import `SystemError` is shadowing a Python builtin
  --> app/routes/instances/detail.py:13:39
   |
11 | from app import db
12 | from app.constants.database_types import DatabaseType
13 | from app.errors import ConflictError, SystemError, ValidationError
   |                                       ^^^^^^^^^^^
14 | from app.models.account_permission import AccountPermission
15 | from app.models.credential import Credential
   |

PLR0911 Too many return statements (7 > 6)
  --> app/routes/instances/detail.py:34:5
   |
34 | def _parse_is_active_value(data: Any, default: bool = False) -> bool:
   |     ^^^^^^^^^^^^^^^^^^^^^^
35 |     """从请求数据中解析 is_active，兼容表单/JSON/checkbox。.
   |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `data`
  --> app/routes/instances/detail.py:34:34
   |
34 | def _parse_is_active_value(data: Any, default: bool = False) -> bool:
   |                                  ^^^
35 |     """从请求数据中解析 is_active，兼容表单/JSON/checkbox。.
   |

FBT001 Boolean-typed positional argument in function definition
  --> app/routes/instances/detail.py:34:39
   |
34 | def _parse_is_active_value(data: Any, default: bool = False) -> bool:
   |                                       ^^^^^^^
35 |     """从请求数据中解析 is_active，兼容表单/JSON/checkbox。.
   |

FBT002 Boolean default positional argument in function definition
  --> app/routes/instances/detail.py:34:39
   |
34 | def _parse_is_active_value(data: Any, default: bool = False) -> bool:
   |                                       ^^^^^^^
35 |     """从请求数据中解析 is_active，兼容表单/JSON/checkbox。.
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/instances/detail.py:35:26
   |
34 | def _parse_is_active_value(data: Any, default: bool = False) -> bool:
35 |     """从请求数据中解析 is_active，兼容表单/JSON/checkbox。.
   |                                  ^^
36 |
37 |     Args:
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/routes/instances/detail.py:38:21
   |
37 |     Args:
38 |         data: 请求数据对象（表单或 JSON）。
   |                           ^^
39 |         default: 默认值，默认为 False。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/routes/instances/detail.py:38:30
   |
37 |     Args:
38 |         data: 请求数据对象（表单或 JSON）。
   |                                        ^^
39 |         default: 默认值，默认为 False。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/instances/detail.py:39:21
   |
37 |     Args:
38 |         data: 请求数据对象（表单或 JSON）。
39 |         default: 默认值，默认为 False。
   |                        ^^
40 |
41 |     Returns:
   |

SIM108 Use ternary operator `value = None if not values else values[-1]` instead of `if`-`else`-block
  --> app/routes/instances/detail.py:48:9
   |
46 |       if hasattr(data, "getlist"):
47 |           values = data.getlist("is_active")
48 | /         if not values:
49 | |             value = None
50 | |         else:
51 | |             value = values[-1]  # 取最后一个值（checkbox优先于隐藏域）
   | |______________________________^
52 |       else:
53 |           value = data.get("is_active", default)
   |
help: Replace `if`-`else`-block with `value = None if not values else values[-1]`

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/routes/instances/detail.py:51:41
   |
49 |             value = None
50 |         else:
51 |             value = values[-1]  # 取最后一个值（checkbox优先于隐藏域）
   |                                               ^^
52 |     else:
53 |         value = data.get("is_active", default)
   |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/routes/instances/detail.py:51:56
   |
49 |             value = None
50 |         else:
51 |             value = values[-1]  # 取最后一个值（checkbox优先于隐藏域）
   |                                                                     ^^
52 |     else:
53 |         value = data.get("is_active", default)
   |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/instances/detail.py:59:27
   |
58 |     if isinstance(value, (list, tuple)):
59 |         # 兼容 JSON 中提供数组的情况，取最后一个
   |                                     ^^
60 |         for item in reversed(value):
61 |             parsed = _parse_is_active_value({"is_active": item}, default)
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/instances/detail.py:87:18
   |
86 |     Returns:
87 |         渲染的实例详情页面，包含账户列表和统计信息。
   |                           ^^
88 |
89 |     Raises:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/instances/detail.py:93:35
   |
92 |     Query Parameters:
93 |         include_deleted: 是否包含已删除账户，默认 'true'。
   |                                            ^^
94 |
95 |     """
   |

B018 Found useless expression. Either assign it to a variable or remove it.
   --> app/routes/instances/detail.py:99:5
    |
 98 |     # 确保标签关系被加载
 99 |     instance.tags  # 触发标签关系的加载
    |     ^^^^^^^^^^^^^
100 |
101 |     # 获取查询参数
    |

PLC0415 `import` should be at the top-level of a file
   --> app/routes/instances/detail.py:184:5
    |
182 |     instance = Instance.query.get_or_404(instance_id)
183 |
184 |     from app.models.account_permission import AccountPermission
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
185 |
186 |     account = AccountPermission.query.filter_by(id=account_id, instance_id=instance_id).first_or_404()
    |

PLC0415 `import` should be at the top-level of a file
   --> app/routes/instances/detail.py:189:9
    |
188 |     try:
189 |         from app.models.account_change_log import AccountChangeLog
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
190 |
191 |         change_logs = (
    |

PERF401 Use a list comprehension to create a transformed list
   --> app/routes/instances/detail.py:204:13
    |
202 |           history = []
203 |           for log in change_logs:
204 | /             history.append(
205 | |                 {
206 | |                     "id": log.id,
207 | |                     "change_type": log.change_type,
208 | |                     "change_time": (time_utils.format_china_time(log.change_time) if log.change_time else "未知"),
209 | |                     "status": log.status,
210 | |                     "message": log.message,
211 | |                     "privilege_diff": log.privilege_diff,
212 | |                     "other_diff": log.other_diff,
213 | |                     "session_id": log.session_id,
214 | |                 },
215 | |             )
    | |_____________^
216 |
217 |           return jsonify_unified_success(
    |
help: Replace for loop with list comprehension

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/instances/detail.py:251:16
    |
250 |     Returns:
251 |         JSON 响应，包含更新后的实例信息。
    |                  ^^
252 |
253 |     Raises:
    |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/instances/detail.py:271:13
    |
269 |         raise ValidationError(validation_error)
270 |
271 |     # 验证凭据ID（如果提供）
    |                 ^^
272 |     if data.get("credential_id"):
273 |         try:
    |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/instances/detail.py:271:18
    |
269 |         raise ValidationError(validation_error)
270 |
271 |     # 验证凭据ID（如果提供）
    |                           ^^
272 |     if data.get("credential_id"):
273 |         try:
    |

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
   --> app/routes/instances/detail.py:281:13
    |
279 |         except (ValueError, TypeError):
280 |             msg = "无效的凭据ID"
281 |             raise ValidationError(msg)
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^
282 |
283 |     # 验证实例名称唯一性（排除当前实例）
    |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/instances/detail.py:283:16
    |
281 |             raise ValidationError(msg)
282 |
283 |     # 验证实例名称唯一性（排除当前实例）
    |                         ^^
284 |     existing_instance = Instance.query.filter(
285 |         Instance.name == data.get("name"), Instance.id != instance_id,
    |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/instances/detail.py:283:23
    |
281 |             raise ValidationError(msg)
282 |
283 |     # 验证实例名称唯一性（排除当前实例）
    |                                       ^^
284 |     existing_instance = Instance.query.filter(
285 |         Instance.name == data.get("name"), Instance.id != instance_id,
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/instances/detail.py:348:22
    |
346 | @view_required
347 | def get_instance_database_sizes(instance_id: int) -> Response:
348 |     """获取指定实例的数据库大小数据（最新或历史）。.
    |                                    ^^
349 |
350 |     Args:
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/instances/detail.py:348:28
    |
346 | @view_required
347 | def get_instance_database_sizes(instance_id: int) -> Response:
348 |     """获取指定实例的数据库大小数据（最新或历史）。.
    |                                                ^^
349 |
350 |     Args:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/instances/detail.py:354:16
    |
353 |     Returns:
354 |         JSON 响应，包含数据库大小数据列表和统计信息。
    |                  ^^
355 |
356 |     Raises:
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/instances/detail.py:362:25
    |
361 |     Query Parameters:
362 |         start_date: 开始日期（YYYY-MM-DD），可选。
    |                             ^^
363 |         end_date: 结束日期（YYYY-MM-DD），可选。
364 |         database_name: 数据库名称筛选，可选。
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/instances/detail.py:362:36
    |
361 |     Query Parameters:
362 |         start_date: 开始日期（YYYY-MM-DD），可选。
    |                                         ^^
363 |         end_date: 结束日期（YYYY-MM-DD），可选。
364 |         database_name: 数据库名称筛选，可选。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/instances/detail.py:362:37
    |
361 |     Query Parameters:
362 |         start_date: 开始日期（YYYY-MM-DD），可选。
    |                                           ^^
363 |         end_date: 结束日期（YYYY-MM-DD），可选。
364 |         database_name: 数据库名称筛选，可选。
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/instances/detail.py:363:23
    |
361 |     Query Parameters:
362 |         start_date: 开始日期（YYYY-MM-DD），可选。
363 |         end_date: 结束日期（YYYY-MM-DD），可选。
    |                           ^^
364 |         database_name: 数据库名称筛选，可选。
365 |         latest_only: 是否只返回最新数据，默认 false。
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/instances/detail.py:363:34
    |
361 |     Query Parameters:
362 |         start_date: 开始日期（YYYY-MM-DD），可选。
363 |         end_date: 结束日期（YYYY-MM-DD），可选。
    |                                       ^^
364 |         database_name: 数据库名称筛选，可选。
365 |         latest_only: 是否只返回最新数据，默认 false。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/instances/detail.py:363:35
    |
361 |     Query Parameters:
362 |         start_date: 开始日期（YYYY-MM-DD），可选。
363 |         end_date: 结束日期（YYYY-MM-DD），可选。
    |                                         ^^
364 |         database_name: 数据库名称筛选，可选。
365 |         latest_only: 是否只返回最新数据，默认 false。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/instances/detail.py:364:31
    |
362 |         start_date: 开始日期（YYYY-MM-DD），可选。
363 |         end_date: 结束日期（YYYY-MM-DD），可选。
364 |         database_name: 数据库名称筛选，可选。
    |                                      ^^
365 |         latest_only: 是否只返回最新数据，默认 false。
366 |         include_inactive: 是否包含非活跃数据库，默认 false。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/instances/detail.py:365:31
    |
363 |         end_date: 结束日期（YYYY-MM-DD），可选。
364 |         database_name: 数据库名称筛选，可选。
365 |         latest_only: 是否只返回最新数据，默认 false。
    |                                        ^^
366 |         include_inactive: 是否包含非活跃数据库，默认 false。
367 |         limit: 返回数量限制，默认 100。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/instances/detail.py:366:37
    |
364 |         database_name: 数据库名称筛选，可选。
365 |         latest_only: 是否只返回最新数据，默认 false。
366 |         include_inactive: 是否包含非活跃数据库，默认 false。
    |                                               ^^
367 |         limit: 返回数量限制，默认 100。
368 |         offset: 偏移量，默认 0。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/instances/detail.py:367:22
    |
365 |         latest_only: 是否只返回最新数据，默认 false。
366 |         include_inactive: 是否包含非活跃数据库，默认 false。
367 |         limit: 返回数量限制，默认 100。
    |                            ^^
368 |         offset: 偏移量，默认 0。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/instances/detail.py:368:20
    |
366 |         include_inactive: 是否包含非活跃数据库，默认 false。
367 |         limit: 返回数量限制，默认 100。
368 |         offset: 偏移量，默认 0。
    |                       ^^
369 |
370 |     """
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/instances/detail.py:393:33
    |
391 |             return parsed_dt.date() if parsed_dt else None
392 |         except Exception as exc:
393 |             msg = f"{field} 格式错误，应为 YYYY-MM-DD"
    |                                     ^^
394 |             raise ValidationError(msg) from exc
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/instances/detail.py:439:21
    |
437 |     """获取账户权限详情。.
438 |
439 |     根据数据库类型返回相应的权限信息（全局权限、角色、数据库权限等）。
    |                                     ^^
440 |
441 |     Args:
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/instances/detail.py:439:36
    |
437 |     """获取账户权限详情。.
438 |
439 |     根据数据库类型返回相应的权限信息（全局权限、角色、数据库权限等）。
    |                                                                   ^^
440 |
441 |     Args:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/instances/detail.py:446:16
    |
445 |     Returns:
446 |         JSON 响应，包含账户权限详情。
    |                  ^^
447 |
448 |     Raises:
    |

ANN202 Missing return type annotation for private function `_build_capacity_query`
   --> app/routes/instances/detail.py:497:5
    |
495 |         message="获取账户权限详情成功",
496 |     )
497 | def _build_capacity_query(
    |     ^^^^^^^^^^^^^^^^^^^^^
498 |     instance_id: int,
499 |     database_name: str | None,
    |
help: Add return type annotation

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/instances/detail.py:512:13
    |
511 |     Returns:
512 |         查询对象，可继续链式操作。
    |                 ^^
513 |
514 |     """
    |

FBT001 Boolean-typed positional argument in function definition
   --> app/routes/instances/detail.py:542:28
    |
542 | def _normalize_active_flag(flag: bool | None) -> bool:
    |                            ^^^^
543 |     """将可能为空的激活标记标准化为 bool。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/instances/detail.py:546:26
    |
545 |     Args:
546 |         flag: 数据库记录中的活跃标记，可能为 None。
    |                                     ^^
547 |
548 |     Returns:
    |

FBT001 Boolean-typed positional argument in function definition
   --> app/routes/instances/detail.py:559:5
    |
557 | def _serialize_capacity_entry(
558 |     stat: DatabaseSizeStat,
559 |     is_active: bool,
    |     ^^^^^^^^^
560 |     deleted_at: datetime | None,
561 |     last_seen_date: date | None,
    |

PLR0913 Too many arguments in function definition (7 > 5)
   --> app/routes/instances/detail.py:589:5
    |
589 | def _fetch_latest_database_sizes(
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
590 |     instance_id: int,
591 |     database_name: str | None,
    |

FBT001 Boolean-typed positional argument in function definition
   --> app/routes/instances/detail.py:594:5
    |
592 |     start_date: date | None,
593 |     end_date: date | None,
594 |     include_inactive: bool,
    |     ^^^^^^^^^^^^^^^^
595 |     limit: int,
596 |     offset: int,
    |

PLR0913 Too many arguments in function definition (7 > 5)
   --> app/routes/instances/detail.py:684:5
    |
684 | def _fetch_historical_database_sizes(
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
685 |     instance_id: int,
686 |     database_name: str | None,
    |

FBT001 Boolean-typed positional argument in function definition
   --> app/routes/instances/detail.py:689:5
    |
687 |     start_date: date | None,
688 |     end_date: date | None,
689 |     include_inactive: bool,
    |     ^^^^^^^^^^^^^^^^
690 |     limit: int,
691 |     offset: int,
    |

INP001 File `app/routes/instances/manage.py` is part of an implicit namespace package. Add an `__init__.py`.
--> app/routes/instances/manage.py:1:1

A004 Import `SystemError` is shadowing a Python builtin
  --> app/routes/instances/manage.py:17:39
   |
15 |     SyncStatus,
16 | )
17 | from app.errors import ConflictError, SystemError, ValidationError
   |                                       ^^^^^^^^^^^
18 | from app.models.credential import Credential
19 | from app.models.instance import Instance
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/instances/manage.py:45:13
   |
43 |     """实例管理首页。.
44 |
45 |     渲染实例列表页面，支持搜索、筛选和标签过滤。
   |                     ^^
46 |
47 |     Returns:
   |

PLC0415 `import` should be at the top-level of a file
  --> app/routes/instances/manage.py:65:5
   |
64 |     # 获取数据库类型配置
65 |     from app.services.database_type_service import DatabaseTypeService
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
66 |
67 |     database_type_configs = DatabaseTypeService.get_active_types()
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/instances/manage.py:111:18
    |
109 |     """创建实例 API。.
110 |
111 |     接收 JSON 或表单数据，验证后创建新的数据库实例。
    |                         ^^
112 |
113 |     Returns:
    |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/instances/manage.py:132:13
    |
130 |         raise ValidationError(validation_error)
131 |
132 |     # 验证凭据ID（如果提供）
    |                 ^^
133 |     if data.get("credential_id"):
134 |         try:
    |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/instances/manage.py:132:18
    |
130 |         raise ValidationError(validation_error)
131 |
132 |     # 验证凭据ID（如果提供）
    |                           ^^
133 |     if data.get("credential_id"):
134 |         try:
    |

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
   --> app/routes/instances/manage.py:142:13
    |
140 |         except (ValueError, TypeError):
141 |             msg = "无效的凭据ID"
142 |             raise ValidationError(msg)
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^
143 |
144 |     # 验证实例名称唯一性
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/instances/manage.py:202:20
    |
200 |     """删除实例。.
201 |
202 |     删除指定实例及其关联的所有数据（账户、同步记录、变更日志等）。
    |                                   ^^
203 |
204 |     Args:
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/instances/manage.py:202:34
    |
200 |     """删除实例。.
201 |
202 |     删除指定实例及其关联的所有数据（账户、同步记录、变更日志等）。
    |                                                               ^^
203 |
204 |     Args:
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/instances/manage.py:248:22
    |
246 |             exception=e,
247 |         )
248 |         msg = "删除实例失败，请重试"
    |                            ^^
249 |         raise SystemError(msg) from e
    |

C901 `list_instances_data` is too complex (13 > 10)
   --> app/routes/instances/manage.py:256:5
    |
254 | @login_required
255 | @view_required
256 | def list_instances_data() -> Response:
    |     ^^^^^^^^^^^^^^^^^^^
257 |     """Grid.js 实例列表 API。.
    |

PLR0915 Too many statements (53 > 50)
   --> app/routes/instances/manage.py:256:5
    |
254 | @login_required
255 | @view_required
256 | def list_instances_data() -> Response:
    |     ^^^^^^^^^^^^^^^^^^^
257 |     """Grid.js 实例列表 API。.
    |

PERF401 Use a list comprehension to create a transformed list
   --> app/routes/instances/manage.py:405:13
    |
403 |           items = []
404 |           for instance in pagination.items:
405 | /             items.append(
406 | |                 {
407 | |                     "id": instance.id,
408 | |                     "name": instance.name,
409 | |                     "db_type": instance.db_type,
410 | |                     "host": instance.host,
411 | |                     "port": instance.port,
412 | |                     "description": instance.description or "",
413 | |                     "is_active": instance.is_active,
414 | |                     "main_version": instance.main_version,
415 | |                     "active_db_count": active_database_counts.get(instance.id, 0),
416 | |                     "active_account_count": active_account_counts.get(instance.id, 0),
417 | |                     "last_sync_time": (
418 | |                         last_sync_times.get(instance.id).isoformat()
419 | |                         if last_sync_times.get(instance.id)
420 | |                         else None
421 | |                     ),
422 | |                     "tags": tags_map.get(instance.id, []),
423 | |                 },
424 | |             )
    | |_____________^
425 |
426 |           return jsonify_unified_success(
    |
help: Replace for loop with list comprehension

C901 `list_instance_accounts` is too complex (11 > 10)
   --> app/routes/instances/manage.py:467:5
    |
465 | @login_required
466 | @view_required
467 | def list_instance_accounts(instance_id: int) -> Response:
    |     ^^^^^^^^^^^^^^^^^^^^^^
468 |     """获取实例账户数据 API。.
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/instances/manage.py:492:49
    |
490 |             instance_account = account.instance_account
491 |             is_active = bool(instance_account and instance_account.is_active)
492 |             # 对于锁定状态优先使用各数据库的 type_specific 字段判定，若账户已被标记删除再补充为锁定
    |                                                                    ^^
493 |             is_locked_flag = bool(account.is_locked)
    |

PLC0415 `import` should be at the top-level of a file
   --> app/routes/instances/manage.py:544:5
    |
544 |     from app.models.account_permission import AccountPermission
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
545 |
546 |     account = AccountPermission.query.filter_by(id=account_id, instance_id=instance_id).first_or_404()
    |

F821 Undefined name `account_id`
   --> app/routes/instances/manage.py:546:52
    |
544 |     from app.models.account_permission import AccountPermission
545 |
546 |     account = AccountPermission.query.filter_by(id=account_id, instance_id=instance_id).first_or_404()
    |                                                    ^^^^^^^^^^
547 |
548 |     try:
    |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/instances/manage.py:549:17
    |
548 |     try:
549 |         # 构建权限信息（与账户管理页面保持一致的数据结构）
    |                       ^^
550 |         permissions = {
551 |             "db_type": instance.db_type.upper() if instance else "",
    |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/instances/manage.py:549:34
    |
548 |     try:
549 |         # 构建权限信息（与账户管理页面保持一致的数据结构）
    |                                                         ^^
550 |         permissions = {
551 |             "db_type": instance.db_type.upper() if instance else "",
    |

F821 Undefined name `account_id`
   --> app/routes/instances/manage.py:598:24
    |
596 |             module="instances",
597 |             instance_id=instance_id,
598 |             account_id=account_id,
    |                        ^^^^^^^^^^
599 |             exception=exc,
600 |         )
    |

E402 Module level import not at top of file
   --> app/routes/instances/manage.py:606:1
    |
605 |   # 注册额外路由模块
606 | / from . import (
607 | |     detail,  # noqa: F401
608 | |     statistics,  # noqa: F401
609 | | )
    | |_^
    |

INP001 File `app/routes/instances/statistics.py` is part of an implicit namespace package. Add an `__init__.py`.
--> app/routes/instances/statistics.py:1:1

A004 Import `SystemError` is shadowing a Python builtin
 --> app/routes/instances/statistics.py:7:24
  |
6 | from app.constants import FlashCategory
7 | from app.errors import SystemError
  |                        ^^^^^^^^^^^
8 | from app.routes.instances.manage import instances_bp
9 | from app.services.statistics.instance_statistics_service import (
  |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/instances/statistics.py:31:26
   |
29 |     except SystemError:
30 |         stats = empty_instance_statistics()
31 |         flash("获取实例统计信息失败，请稍后重试", FlashCategory.ERROR)
   |                                    ^^
32 |     return render_template("instances/statistics.html", stats=stats)
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/routes/main.py:17:14
   |
15 | @main_bp.route("/admin/api/app-info", methods=["GET"])
16 | def app_info() -> tuple[Response, int]:
17 |     """获取应用信息（供前端展示应用名称等）。.
   |                    ^^
18 |
19 |     Returns:
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/routes/main.py:17:25
   |
15 | @main_bp.route("/admin/api/app-info", methods=["GET"])
16 | def app_info() -> tuple[Response, int]:
17 |     """获取应用信息（供前端展示应用名称等）。.
   |                                          ^^
18 |
19 |     Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/main.py:50:25
   |
48 | @main_bp.route("/favicon.ico")
49 | def favicon() -> "Response":
50 |     """提供 favicon.ico 文件，避免 404。.
   |                             ^^
51 |
52 |     Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/main.py:53:22
   |
52 |     Returns:
53 |         Response: 空响应，状态码 204。
   |                         ^^
54 |
55 |     """
   |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/main.py:56:15
   |
55 |     """
56 |     # 返回一个空的响应，避免404错误
   |                       ^^
57 |     return "", HTTPStatus.NO_CONTENT
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/main.py:63:27
   |
61 | @main_bp.route("/apple-touch-icon-precomposed.png")
62 | def apple_touch_icon() -> Response:
63 |     """提供 Apple Touch Icon，避免移动端 404。.
   |                             ^^
64 |
65 |     Returns:
   |

PTH118 `os.path.join()` should be replaced by `Path` with `/` operator
  --> app/routes/main.py:70:17
   |
68 |     """
69 |     icon_name = "apple-touch-icon-precomposed.png" if "precomposed" in request.path else "apple-touch-icon.png"
70 |     icon_path = os.path.join(current_app.static_folder, "img")
   |                 ^^^^^^^^^^^^
71 |     return send_from_directory(icon_path, icon_name)
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/main.py:79:22
   |
78 |     Returns:
79 |         Response: 空响应，状态码 204。
   |                         ^^
80 |
81 |     """
   |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/main.py:82:15
   |
81 |     """
82 |     # 返回一个空的响应，避免404错误
   |                       ^^
83 |     return "", HTTPStatus.NO_CONTENT
   |

A004 Import `SystemError` is shadowing a Python builtin
  --> app/routes/partition.py:9:24
   |
 7 | from flask_login import current_user, login_required
 8 |
 9 | from app.errors import SystemError, ValidationError
   |                        ^^^^^^^^^^^
10 | from app.models.database_size_aggregation import DatabaseSizeAggregation
11 | from app.models.database_size_stat import DatabaseSizeStat
   |

ANN201 Missing return type annotation for public function `partitions_page`
  --> app/routes/partition.py:28:5
   |
26 | @login_required
27 | @view_required
28 | def partitions_page():
   |     ^^^^^^^^^^^^^^^
29 |     """分区管理页面。.
   |
help: Add return type annotation

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/partition.py:45:16
   |
44 |     Returns:
45 |         JSON 响应，包含分区信息、状态和缺失分区列表。
   |                  ^^
46 |
47 |     """
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/partition.py:70:21
   |
68 |         value: 待解析的字符串值。
69 |         default: 默认值。
70 |         minimum: 最小值，默认 1。
   |                        ^^
71 |         maximum: 最大值，默认 100。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/partition.py:71:21
   |
69 |         default: 默认值。
70 |         minimum: 最小值，默认 1。
71 |         maximum: 最大值，默认 100。
   |                        ^^
72 |
73 |     Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/partition.py:74:15
   |
73 |     Returns:
74 |         解析后的整数，限制在 [minimum, maximum] 范围内。
   |                     ^^
75 |
76 |     """
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/partition.py:96:33
   |
94 |     Args:
95 |         stats_service: 分区统计服务实例。
96 |         partition_info: 已获取的分区信息，缺省时内部拉取。
   |                                         ^^
97 |
98 |     Returns:
   |

DTZ011 `datetime.date.today()` used
   --> app/routes/partition.py:105:20
    |
103 |     partitions = info.get("partitions", [])
104 |
105 |     current_date = date.today()
    |                    ^^^^^^^^^^^^
106 |     required_partitions: list[str] = []
107 |     for offset in range(3):
    |
help: Use `datetime.datetime.now(tz=...).date()` instead

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/partition.py:133:13
    |
131 |     """获取分区管理状态。.
132 |
133 |     检查分区健康状态，包括缺失分区检测。
    |                     ^^
134 |
135 |     Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/partition.py:136:16
    |
135 |     Returns:
136 |         JSON 响应，包含分区状态、总数、大小和缺失分区列表。
    |                  ^^
137 |
138 |     Raises:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/partition.py:170:16
    |
168 | @view_required
169 | def list_partitions() -> Response:
170 |     """分页返回分区列表，供 Grid.js 使用。.
    |                        ^^
171 |
172 |     支持分页、排序、搜索和筛选（按表类型、状态）。
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/partition.py:172:18
    |
170 |     """分页返回分区列表，供 Grid.js 使用。.
171 |
172 |     支持分页、排序、搜索和筛选（按表类型、状态）。
    |                               ^^
173 |
174 |     Returns:
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/partition.py:172:26
    |
170 |     """分页返回分区列表，供 Grid.js 使用。.
171 |
172 |     支持分页、排序、搜索和筛选（按表类型、状态）。
    |                                               ^^
173 |
174 |     Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/partition.py:175:16
    |
174 |     Returns:
175 |         JSON 响应，包含分区列表和分页信息。
    |                  ^^
176 |
177 |     Query Parameters:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/partition.py:178:17
    |
177 |     Query Parameters:
178 |         page: 页码，默认 1。
    |                   ^^
179 |         limit: 每页数量，默认 20，最大 200。
180 |         sort: 排序字段，默认 'name'。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/partition.py:179:20
    |
177 |     Query Parameters:
178 |         page: 页码，默认 1。
179 |         limit: 每页数量，默认 20，最大 200。
    |                        ^^
180 |         sort: 排序字段，默认 'name'。
181 |         order: 排序方向（'asc'、'desc'），默认 'asc'。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/partition.py:179:26
    |
177 |     Query Parameters:
178 |         page: 页码，默认 1。
179 |         limit: 每页数量，默认 20，最大 200。
    |                                 ^^
180 |         sort: 排序字段，默认 'name'。
181 |         order: 排序方向（'asc'、'desc'），默认 'asc'。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/partition.py:180:19
    |
178 |         page: 页码，默认 1。
179 |         limit: 每页数量，默认 20，最大 200。
180 |         sort: 排序字段，默认 'name'。
    |                       ^^
181 |         order: 排序方向（'asc'、'desc'），默认 'asc'。
182 |         search: 搜索关键词，可选。
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/partition.py:181:20
    |
179 |         limit: 每页数量，默认 20，最大 200。
180 |         sort: 排序字段，默认 'name'。
181 |         order: 排序方向（'asc'、'desc'），默认 'asc'。
    |                        ^^
182 |         search: 搜索关键词，可选。
183 |         table_type: 表类型筛选，可选。
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/partition.py:181:33
    |
179 |         limit: 每页数量，默认 20，最大 200。
180 |         sort: 排序字段，默认 'name'。
181 |         order: 排序方向（'asc'、'desc'），默认 'asc'。
    |                                       ^^
182 |         search: 搜索关键词，可选。
183 |         table_type: 表类型筛选，可选。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/partition.py:181:34
    |
179 |         limit: 每页数量，默认 20，最大 200。
180 |         sort: 排序字段，默认 'name'。
181 |         order: 排序方向（'asc'、'desc'），默认 'asc'。
    |                                         ^^
182 |         search: 搜索关键词，可选。
183 |         table_type: 表类型筛选，可选。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/partition.py:182:22
    |
180 |         sort: 排序字段，默认 'name'。
181 |         order: 排序方向（'asc'、'desc'），默认 'asc'。
182 |         search: 搜索关键词，可选。
    |                           ^^
183 |         table_type: 表类型筛选，可选。
184 |         status: 状态筛选，可选。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/partition.py:183:26
    |
181 |         order: 排序方向（'asc'、'desc'），默认 'asc'。
182 |         search: 搜索关键词，可选。
183 |         table_type: 表类型筛选，可选。
    |                               ^^
184 |         status: 状态筛选，可选。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/partition.py:184:21
    |
182 |         search: 搜索关键词，可选。
183 |         table_type: 表类型筛选，可选。
184 |         status: 状态筛选，可选。
    |                         ^^
185 |
186 |     """
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/partition.py:281:22
    |
279 |         parsed_dt = time_utils.to_china(partition_date_str + "T00:00:00")
280 |     except Exception as exc:
281 |         msg = "日期格式错误，请使用 YYYY-MM-DD 格式"
    |                            ^^
282 |         raise ValidationError(msg) from exc
283 |     if parsed_dt is None:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/partition.py:354:16
    |
353 |     Returns:
354 |         JSON 响应，包含分区统计数据。
    |                  ^^
355 |
356 |     """
    |

C901 `get_core_aggregation_metrics` is too complex (40 > 10)
   --> app/routes/partition.py:378:5
    |
376 | @login_required
377 | @view_required
378 | def get_core_aggregation_metrics() -> Response:  # noqa: PLR0912, PLR0915
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
379 |     """获取核心聚合指标数据。.
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/partition.py:405:41
    |
403 |         valid_periods = {"daily", "weekly", "monthly", "quarterly"}
404 |         if period_type not in valid_periods:
405 |             log_warning("无效的 period_type，默认使用 daily", module="partition", period_type=period_type)
    |                                            ^^
406 |             period_type = "daily"
    |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/partition.py:468:51
    |
466 |         # 按日期统计4个核心指标
467 |         daily_metrics = defaultdict(lambda: {
468 |             "instance_count": 0,      # 每天采集的实例数总量（日统计）或平均值（周/月/季统计）
    |                                                             ^^
469 |             "database_count": 0,      # 每天采集的数据库数总量（日统计）或平均值（周/月/季统计）
470 |             "instance_aggregation_count": 0,  # 聚合统计下的实例统计数量
    |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/partition.py:468:55
    |
466 |         # 按日期统计4个核心指标
467 |         daily_metrics = defaultdict(lambda: {
468 |             "instance_count": 0,      # 每天采集的实例数总量（日统计）或平均值（周/月/季统计）
    |                                                                     ^^
469 |             "database_count": 0,      # 每天采集的数据库数总量（日统计）或平均值（周/月/季统计）
470 |             "instance_aggregation_count": 0,  # 聚合统计下的实例统计数量
    |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/partition.py:468:60
    |
466 |         # 按日期统计4个核心指标
467 |         daily_metrics = defaultdict(lambda: {
468 |             "instance_count": 0,      # 每天采集的实例数总量（日统计）或平均值（周/月/季统计）
    |                                                                               ^^
469 |             "database_count": 0,      # 每天采集的数据库数总量（日统计）或平均值（周/月/季统计）
470 |             "instance_aggregation_count": 0,  # 聚合统计下的实例统计数量
    |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/partition.py:468:68
    |
466 |         # 按日期统计4个核心指标
467 |         daily_metrics = defaultdict(lambda: {
468 |             "instance_count": 0,      # 每天采集的实例数总量（日统计）或平均值（周/月/季统计）
    |                                                                                             ^^
469 |             "database_count": 0,      # 每天采集的数据库数总量（日统计）或平均值（周/月/季统计）
470 |             "instance_aggregation_count": 0,  # 聚合统计下的实例统计数量
    |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/partition.py:469:52
    |
467 |         daily_metrics = defaultdict(lambda: {
468 |             "instance_count": 0,      # 每天采集的实例数总量（日统计）或平均值（周/月/季统计）
469 |             "database_count": 0,      # 每天采集的数据库数总量（日统计）或平均值（周/月/季统计）
    |                                                               ^^
470 |             "instance_aggregation_count": 0,  # 聚合统计下的实例统计数量
471 |             "database_aggregation_count": 0,   # 聚合统计下的数据库统计数量
    |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/partition.py:469:56
    |
467 |         daily_metrics = defaultdict(lambda: {
468 |             "instance_count": 0,      # 每天采集的实例数总量（日统计）或平均值（周/月/季统计）
469 |             "database_count": 0,      # 每天采集的数据库数总量（日统计）或平均值（周/月/季统计）
    |                                                                       ^^
470 |             "instance_aggregation_count": 0,  # 聚合统计下的实例统计数量
471 |             "database_aggregation_count": 0,   # 聚合统计下的数据库统计数量
    |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/partition.py:469:61
    |
467 |         daily_metrics = defaultdict(lambda: {
468 |             "instance_count": 0,      # 每天采集的实例数总量（日统计）或平均值（周/月/季统计）
469 |             "database_count": 0,      # 每天采集的数据库数总量（日统计）或平均值（周/月/季统计）
    |                                                                                 ^^
470 |             "instance_aggregation_count": 0,  # 聚合统计下的实例统计数量
471 |             "database_aggregation_count": 0,   # 聚合统计下的数据库统计数量
    |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/partition.py:469:69
    |
467 |         daily_metrics = defaultdict(lambda: {
468 |             "instance_count": 0,      # 每天采集的实例数总量（日统计）或平均值（周/月/季统计）
469 |             "database_count": 0,      # 每天采集的数据库数总量（日统计）或平均值（周/月/季统计）
    |                                                                                               ^^
470 |             "instance_aggregation_count": 0,  # 聚合统计下的实例统计数量
471 |             "database_aggregation_count": 0,   # 聚合统计下的数据库统计数量
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/partition.py:492:20
    |
490 |             daily_metrics[date_str]["instance_aggregation_count"] += 1
491 |
492 |         # 对于周、月、季统计，需要计算平均值
    |                             ^^
493 |         if period_type in ["weekly", "monthly", "quarterly"]:
494 |             # 计算每个周期内的平均值
    |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/partition.py:511:31
    |
510 |                 if period_type == "weekly":
511 |                     # 计算周的开始日期（周一）
    |                                       ^^
512 |                     week_start = period_start - timedelta(days=period_start.weekday())
513 |                     period_key = week_start.isoformat()
    |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/partition.py:511:34
    |
510 |                 if period_type == "weekly":
511 |                     # 计算周的开始日期（周一）
    |                                             ^^
512 |                     week_start = period_start - timedelta(days=period_start.weekday())
513 |                     period_key = week_start.isoformat()
    |

E501 Line too long (129 > 120)
   --> app/routes/partition.py:540:121
    |
538 |             for period_key, metrics in period_metrics.items():
539 |                 if metrics["days_in_period"] > 0:
540 |                     daily_metrics[period_key]["instance_count"] = round(metrics["instance_count"] / metrics["days_in_period"], 1)
    |                                                                                                                         ^^^^^^^^^
541 |                     daily_metrics[period_key]["database_count"] = round(metrics["database_count"] / metrics["days_in_period"], 1)
542 |                     daily_metrics[period_key]["instance_aggregation_count"] = metrics["instance_aggregation_count"]
    |

E501 Line too long (129 > 120)
   --> app/routes/partition.py:541:121
    |
539 |                 if metrics["days_in_period"] > 0:
540 |                     daily_metrics[period_key]["instance_count"] = round(metrics["instance_count"] / metrics["days_in_period"], 1)
541 |                     daily_metrics[period_key]["database_count"] = round(metrics["database_count"] / metrics["days_in_period"], 1)
    |                                                                                                                         ^^^^^^^^^
542 |                     daily_metrics[period_key]["instance_aggregation_count"] = metrics["instance_aggregation_count"]
543 |                     daily_metrics[period_key]["database_aggregation_count"] = metrics["database_aggregation_count"]
    |

RUF001 String contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/partition.py:601:37
    |
599 |             database_agg_label = "数据库日统计数量"
600 |         elif period_type == "weekly":
601 |             instance_label = "实例数平均值（周）"
    |                                           ^^
602 |             database_label = "数据库数平均值（周）"
603 |             instance_agg_label = "实例周统计数量"
    |

RUF001 String contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/partition.py:601:39
    |
599 |             database_agg_label = "数据库日统计数量"
600 |         elif period_type == "weekly":
601 |             instance_label = "实例数平均值（周）"
    |                                               ^^
602 |             database_label = "数据库数平均值（周）"
603 |             instance_agg_label = "实例周统计数量"
    |

RUF001 String contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/partition.py:602:38
    |
600 |         elif period_type == "weekly":
601 |             instance_label = "实例数平均值（周）"
602 |             database_label = "数据库数平均值（周）"
    |                                             ^^
603 |             instance_agg_label = "实例周统计数量"
604 |             database_agg_label = "数据库周统计数量"
    |

RUF001 String contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/partition.py:602:40
    |
600 |         elif period_type == "weekly":
601 |             instance_label = "实例数平均值（周）"
602 |             database_label = "数据库数平均值（周）"
    |                                                 ^^
603 |             instance_agg_label = "实例周统计数量"
604 |             database_agg_label = "数据库周统计数量"
    |

RUF001 String contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/partition.py:606:37
    |
604 |             database_agg_label = "数据库周统计数量"
605 |         elif period_type == "monthly":
606 |             instance_label = "实例数平均值（月）"
    |                                           ^^
607 |             database_label = "数据库数平均值（月）"
608 |             instance_agg_label = "实例月统计数量"
    |

RUF001 String contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/partition.py:606:39
    |
604 |             database_agg_label = "数据库周统计数量"
605 |         elif period_type == "monthly":
606 |             instance_label = "实例数平均值（月）"
    |                                               ^^
607 |             database_label = "数据库数平均值（月）"
608 |             instance_agg_label = "实例月统计数量"
    |

RUF001 String contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/partition.py:607:38
    |
605 |         elif period_type == "monthly":
606 |             instance_label = "实例数平均值（月）"
607 |             database_label = "数据库数平均值（月）"
    |                                             ^^
608 |             instance_agg_label = "实例月统计数量"
609 |             database_agg_label = "数据库月统计数量"
    |

RUF001 String contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/partition.py:607:40
    |
605 |         elif period_type == "monthly":
606 |             instance_label = "实例数平均值（月）"
607 |             database_label = "数据库数平均值（月）"
    |                                                 ^^
608 |             instance_agg_label = "实例月统计数量"
609 |             database_agg_label = "数据库月统计数量"
    |

RUF001 String contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/partition.py:611:37
    |
609 |             database_agg_label = "数据库月统计数量"
610 |         elif period_type == "quarterly":
611 |             instance_label = "实例数平均值（季）"
    |                                           ^^
612 |             database_label = "数据库数平均值（季）"
613 |             instance_agg_label = "实例季统计数量"
    |

RUF001 String contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/partition.py:611:39
    |
609 |             database_agg_label = "数据库月统计数量"
610 |         elif period_type == "quarterly":
611 |             instance_label = "实例数平均值（季）"
    |                                               ^^
612 |             database_label = "数据库数平均值（季）"
613 |             instance_agg_label = "实例季统计数量"
    |

RUF001 String contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/partition.py:612:38
    |
610 |         elif period_type == "quarterly":
611 |             instance_label = "实例数平均值（季）"
612 |             database_label = "数据库数平均值（季）"
    |                                             ^^
613 |             instance_agg_label = "实例季统计数量"
614 |             database_agg_label = "数据库季统计数量"
    |

RUF001 String contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/partition.py:612:40
    |
610 |         elif period_type == "quarterly":
611 |             instance_label = "实例数平均值（季）"
612 |             database_label = "数据库数平均值（季）"
    |                                                 ^^
613 |             instance_agg_label = "实例季统计数量"
614 |             database_agg_label = "数据库季统计数量"
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/partition.py:623:27
    |
621 |         # 构建Chart.js数据集 - 使用高透明度实现颜色混合效果
622 |         datasets = [
623 |             # 实例数总量 - 蓝色实线，较粗，高透明度
    |                                    ^^
624 |             {
625 |                 "label": instance_label,
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/partition.py:623:30
    |
621 |         # 构建Chart.js数据集 - 使用高透明度实现颜色混合效果
622 |         datasets = [
623 |             # 实例数总量 - 蓝色实线，较粗，高透明度
    |                                          ^^
624 |             {
625 |                 "label": instance_label,
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/partition.py:627:64
    |
625 |                 "label": instance_label,
626 |                 "data": instance_count_data,
627 |                 "borderColor": "rgba(54, 162, 235, 0.7)",  # 蓝色，70%透明度
    |                                                                  ^^
628 |                 "backgroundColor": "rgba(54, 162, 235, 0.1)",
629 |                 "borderWidth": 4,
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/partition.py:634:29
    |
632 |                 "fill": False,
633 |             },
634 |             # 实例日统计数量 - 红色实线，较细，高透明度叠加
    |                                        ^^
635 |             {
636 |                 "label": instance_agg_label,
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/partition.py:634:32
    |
632 |                 "fill": False,
633 |             },
634 |             # 实例日统计数量 - 红色实线，较细，高透明度叠加
    |                                              ^^
635 |             {
636 |                 "label": instance_agg_label,
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/partition.py:638:64
    |
636 |                 "label": instance_agg_label,
637 |                 "data": instance_aggregation_data,
638 |                 "borderColor": "rgba(255, 99, 132, 0.7)",  # 红色，70%透明度
    |                                                                  ^^
639 |                 "backgroundColor": "rgba(255, 99, 132, 0.05)",
640 |                 "borderWidth": 3,
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/partition.py:645:28
    |
643 |                 "fill": False,
644 |             },
645 |             # 数据库数总量 - 绿色实线，较粗，高透明度
    |                                      ^^
646 |             {
647 |                 "label": database_label,
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/partition.py:645:31
    |
643 |                 "fill": False,
644 |             },
645 |             # 数据库数总量 - 绿色实线，较粗，高透明度
    |                                            ^^
646 |             {
647 |                 "label": database_label,
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/partition.py:649:64
    |
647 |                 "label": database_label,
648 |                 "data": database_count_data,
649 |                 "borderColor": "rgba(75, 192, 192, 0.7)",  # 绿色，70%透明度
    |                                                                  ^^
650 |                 "backgroundColor": "rgba(75, 192, 192, 0.1)",
651 |                 "borderWidth": 4,
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/partition.py:656:30
    |
654 |                 "fill": False,
655 |             },
656 |             # 数据库日统计数量 - 橙色实线，较细，高透明度叠加
    |                                          ^^
657 |             {
658 |                 "label": database_agg_label,
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/partition.py:656:33
    |
654 |                 "fill": False,
655 |             },
656 |             # 数据库日统计数量 - 橙色实线，较细，高透明度叠加
    |                                                ^^
657 |             {
658 |                 "label": database_agg_label,
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/partition.py:660:64
    |
658 |                 "label": database_agg_label,
659 |                 "data": database_aggregation_data,
660 |                 "borderColor": "rgba(255, 159, 64, 0.7)",  # 橙色，70%透明度
    |                                                                  ^^
661 |                 "backgroundColor": "rgba(255, 159, 64, 0.05)",
662 |                 "borderWidth": 3,
    |

PGH003 Use specific rule codes when ignoring type issues
  --> app/routes/scheduler.py:8:55
   |
 7 | from flask import Blueprint, Response, render_template
 8 | from flask_login import current_user, login_required  # type: ignore
   |                                                       ^^^^^^^^^^^^^^
 9 |
10 | from app.constants.scheduler_jobs import BUILTIN_TASK_IDS
   |

A004 Import `SystemError` is shadowing a Python builtin
  --> app/routes/scheduler.py:12:39
   |
10 | from app.constants.scheduler_jobs import BUILTIN_TASK_IDS
11 | from app.constants.sync_constants import SyncCategory, SyncOperationType
12 | from app.errors import NotFoundError, SystemError
   |                                       ^^^^^^^^^^^
13 | from app.scheduler import get_scheduler
14 | from app.services.sync_session_service import sync_session_service
   |

PGH003 Use specific rule codes when ignoring type issues
  --> app/routes/scheduler.py:45:95
   |
44 | _scheduler_forms = SchedulerJobFormView.as_view("scheduler_forms")
45 | _scheduler_forms = login_required(scheduler_manage_required(require_csrf(_scheduler_forms)))  # type: ignore
   |                                                                                               ^^^^^^^^^^^^^^
46 | scheduler_bp.add_url_rule(
47 |     "/api/jobs/<job_id>",
   |

PGH003 Use specific rule codes when ignoring type issues
  --> app/routes/scheduler.py:54:18
   |
53 | @scheduler_bp.route("/")
54 | @login_required  # type: ignore
   |                  ^^^^^^^^^^^^^^
55 | @scheduler_view_required  # type: ignore
56 | def index() -> str:
   |

PGH003 Use specific rule codes when ignoring type issues
  --> app/routes/scheduler.py:55:27
   |
53 | @scheduler_bp.route("/")
54 | @login_required  # type: ignore
55 | @scheduler_view_required  # type: ignore
   |                           ^^^^^^^^^^^^^^
56 | def index() -> str:
57 |     """定时任务管理页面。.
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/scheduler.py:59:15
   |
57 |     """定时任务管理页面。.
58 |
59 |     渲染定时任务管理界面，提供任务查看、暂停、恢复、执行等功能。
   |                         ^^
60 |
61 |     Returns:
   |

PGH003 Use specific rule codes when ignoring type issues
  --> app/routes/scheduler.py:69:18
   |
68 | @scheduler_bp.route("/api/jobs")
69 | @login_required  # type: ignore
   |                  ^^^^^^^^^^^^^^
70 | @scheduler_view_required  # type: ignore
71 | def get_jobs() -> Response:
   |

PGH003 Use specific rule codes when ignoring type issues
  --> app/routes/scheduler.py:70:27
   |
68 | @scheduler_bp.route("/api/jobs")
69 | @login_required  # type: ignore
70 | @scheduler_view_required  # type: ignore
   |                           ^^^^^^^^^^^^^^
71 | def get_jobs() -> Response:
72 |     """获取所有定时任务。.
   |

C901 `get_jobs` is too complex (31 > 10)
  --> app/routes/scheduler.py:71:5
   |
69 | @login_required  # type: ignore
70 | @scheduler_view_required  # type: ignore
71 | def get_jobs() -> Response:
   |     ^^^^^^^^
72 |     """获取所有定时任务。.
   |

PLR0912 Too many branches (33 > 12)
  --> app/routes/scheduler.py:71:5
   |
69 | @login_required  # type: ignore
70 | @scheduler_view_required  # type: ignore
71 | def get_jobs() -> Response:
   |     ^^^^^^^^
72 |     """获取所有定时任务。.
   |

PLR0915 Too many statements (117 > 50)
  --> app/routes/scheduler.py:71:5
   |
69 | @login_required  # type: ignore
70 | @scheduler_view_required  # type: ignore
71 | def get_jobs() -> Response:
   |     ^^^^^^^^
72 |     """获取所有定时任务。.
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/scheduler.py:74:16
   |
72 |     """获取所有定时任务。.
73 |
74 |     查询调度器中的所有任务，包括任务状态、触发器信息等。
   |                           ^^
75 |
76 |     Returns:
   |

PGH003 Use specific rule codes when ignoring type issues
  --> app/routes/scheduler.py:84:38
   |
82 |     """
83 |     try:
84 |         scheduler = get_scheduler()  # type: ignore
   |                                      ^^^^^^^^^^^^^^
85 |         if not scheduler.running:
86 |             log_warning("调度器未启动", module="scheduler")
   |

TRY301 Abstract `raise` to an inner function
  --> app/routes/scheduler.py:88:13
   |
86 |             log_warning("调度器未启动", module="scheduler")
87 |             msg = "调度器未启动"
88 |             raise SystemError(msg)
   |             ^^^^^^^^^^^^^^^^^^^^^^
89 |         jobs = scheduler.get_jobs()
90 |         jobs_data: list[dict[str, Any]] = []
   |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/scheduler.py:105:36
    |
104 |                 if trigger_type == "cron" and "CronTrigger" in str(type(job.trigger)):
105 |                     # 对于CronTrigger，包含所有字段用于编辑
    |                                      ^^
106 |                     trigger_info = {}
107 |                     trigger_args = {}
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/scheduler.py:109:29
    |
107 |                     trigger_args = {}
108 |
109 |                     # 包含所有字段，用于编辑时正确显示
    |                                   ^^
110 |                     # CronTrigger使用fields属性存储字段值
111 |                     fields = getattr(job.trigger, "fields", {})
    |

RUF003 Comment contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/routes/scheduler.py:115:46
    |
113 |                     # 检查fields是否为字典
114 |                     if isinstance(fields, dict):
115 |                         # 按时间顺序生成trigger_args：秒、分、时、日、月、周、年
    |                                                     ^^
116 |                         trigger_args["second"] = fields.get("second", "0")
117 |                         trigger_args["minute"] = fields.get("minute", "0")
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/scheduler.py:124:32
    |
122 |                         trigger_args["year"] = fields.get("year", "") if fields.get("year") is not None else ""
123 |                     elif isinstance(fields, list):
124 |                         # 如果是列表，直接使用字段值
    |                                     ^^
125 |                         # 按时间顺序生成trigger_args：秒、分、时、日、月、周、年
126 |                         if len(fields) >= 8:
    |

RUF003 Comment contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/routes/scheduler.py:125:46
    |
123 |                     elif isinstance(fields, list):
124 |                         # 如果是列表，直接使用字段值
125 |                         # 按时间顺序生成trigger_args：秒、分、时、日、月、周、年
    |                                                     ^^
126 |                         if len(fields) >= 8:
127 |                             trigger_args["second"] = str(fields[7]) if fields[7] is not None else "0"
    |

PLR2004 Magic value used in comparison, consider replacing `8` with a constant variable
   --> app/routes/scheduler.py:126:43
    |
124 |                         # 如果是列表，直接使用字段值
125 |                         # 按时间顺序生成trigger_args：秒、分、时、日、月、周、年
126 |                         if len(fields) >= 8:
    |                                           ^
127 |                             trigger_args["second"] = str(fields[7]) if fields[7] is not None else "0"
128 |                             trigger_args["minute"] = str(fields[6]) if fields[6] is not None else "0"
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/scheduler.py:144:39
    |
142 |                             trigger_args["year"] = ""
143 |                     else:
144 |                         # 如果既不是字典也不是列表，使用默认值
    |                                                   ^^
145 |                         log_warning(
146 |                             "触发器字段类型异常",
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/scheduler.py:176:32
    |
174 |                             trigger_info["year"] = fields.get("year")
175 |                     elif isinstance(fields, list):
176 |                         # 如果是列表，直接使用字段值，按时间顺序排序：秒、分、时、日、月、周、年
    |                                     ^^
177 |                         if len(fields) >= 8:
178 |                             # 按时间顺序添加非默认值
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/scheduler.py:176:40
    |
174 |                             trigger_info["year"] = fields.get("year")
175 |                     elif isinstance(fields, list):
176 |                         # 如果是列表，直接使用字段值，按时间顺序排序：秒、分、时、日、月、周、年
    |                                                     ^^
177 |                         if len(fields) >= 8:
178 |                             # 按时间顺序添加非默认值
    |

RUF003 Comment contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/routes/scheduler.py:176:48
    |
174 |                             trigger_info["year"] = fields.get("year")
175 |                     elif isinstance(fields, list):
176 |                         # 如果是列表，直接使用字段值，按时间顺序排序：秒、分、时、日、月、周、年
    |                                                                     ^^
177 |                         if len(fields) >= 8:
178 |                             # 按时间顺序添加非默认值
    |

PLR2004 Magic value used in comparison, consider replacing `8` with a constant variable
   --> app/routes/scheduler.py:177:43
    |
175 |                     elif isinstance(fields, list):
176 |                         # 如果是列表，直接使用字段值，按时间顺序排序：秒、分、时、日、月、周、年
177 |                         if len(fields) >= 8:
    |                                           ^
178 |                             # 按时间顺序添加非默认值
179 |                             if str(fields[7]) != "0":  # second
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/scheduler.py:194:33
    |
192 |                                 trigger_info["year"] = str(fields[0])
193 |                 else:
194 |                     # 对于其他类型的触发器，使用原始字符串
    |                                           ^^
195 |                     trigger_args = {"description": str(job.trigger)}
196 |             except Exception as job_error:
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/routes/scheduler.py:196:20
    |
194 |                     # 对于其他类型的触发器，使用原始字符串
195 |                     trigger_args = {"description": str(job.trigger)}
196 |             except Exception as job_error:
    |                    ^^^^^^^^^
197 |                 log_error(
198 |                     "处理任务触发器信息失败",
    |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/scheduler.py:212:26
    |
210 |                 state = "STATE_RUNNING"
211 |
212 |             # 获取任务的上次运行时间（从日志中查找）
    |                                     ^^
213 |             last_run_time = None
214 |             try:
    |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/scheduler.py:212:33
    |
210 |                 state = "STATE_RUNNING"
211 |
212 |             # 获取任务的上次运行时间（从日志中查找）
    |                                                   ^^
213 |             last_run_time = None
214 |             try:
    |

PLC0415 `import` should be at the top-level of a file
   --> app/routes/scheduler.py:215:17
    |
213 |             last_run_time = None
214 |             try:
215 |                 from datetime import timedelta
    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
216 |
217 |                 from app.models.unified_log import UnifiedLog
    |

PLC0415 `import` should be at the top-level of a file
   --> app/routes/scheduler.py:217:17
    |
215 |                 from datetime import timedelta
216 |
217 |                 from app.models.unified_log import UnifiedLog
    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
218 |                 from app.utils.time_utils import time_utils
    |

PLC0415 `import` should be at the top-level of a file
   --> app/routes/scheduler.py:218:17
    |
217 |                 from app.models.unified_log import UnifiedLog
218 |                 from app.utils.time_utils import time_utils
    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
219 |
220 |                 # 查找最近24小时内该任务的执行日志
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/routes/scheduler.py:229:20
    |
227 |                 if recent_logs:
228 |                     last_run_time = recent_logs.timestamp.isoformat()
229 |             except Exception as lookup_error:
    |                    ^^^^^^^^^
230 |                 log_warning(
231 |                     "获取任务上次运行时间失败",
    |

PGH003 Use specific rule codes when ignoring type issues
   --> app/routes/scheduler.py:272:18
    |
271 | @scheduler_bp.route("/api/jobs/<job_id>")
272 | @login_required  # type: ignore
    |                  ^^^^^^^^^^^^^^
273 | @scheduler_view_required  # type: ignore
274 | def get_job(job_id: str) -> Response:
    |

PGH003 Use specific rule codes when ignoring type issues
   --> app/routes/scheduler.py:273:27
    |
271 | @scheduler_bp.route("/api/jobs/<job_id>")
272 | @login_required  # type: ignore
273 | @scheduler_view_required  # type: ignore
    |                           ^^^^^^^^^^^^^^
274 | def get_job(job_id: str) -> Response:
275 |     """获取指定任务详情。.
    |

PGH003 Use specific rule codes when ignoring type issues
   --> app/routes/scheduler.py:285:48
    |
283 |     """
284 |     try:
285 |         job = get_scheduler().get_job(job_id)  # type: ignore
    |                                                ^^^^^^^^^^^^^^
286 |         if not job:
287 |             msg = "任务不存在"
    |

TRY301 Abstract `raise` to an inner function
   --> app/routes/scheduler.py:288:13
    |
286 |         if not job:
287 |             msg = "任务不存在"
288 |             raise NotFoundError(msg)
    |             ^^^^^^^^^^^^^^^^^^^^^^^^
289 |
290 |         job_info = {
    |

PGH003 Use specific rule codes when ignoring type issues
   --> app/routes/scheduler.py:319:18
    |
318 | @scheduler_bp.route("/api/jobs/<job_id>/pause", methods=["POST"])
319 | @login_required  # type: ignore
    |                  ^^^^^^^^^^^^^^
320 | @scheduler_manage_required  # type: ignore
321 | @require_csrf
    |

PGH003 Use specific rule codes when ignoring type issues
   --> app/routes/scheduler.py:320:29
    |
318 | @scheduler_bp.route("/api/jobs/<job_id>/pause", methods=["POST"])
319 | @login_required  # type: ignore
320 | @scheduler_manage_required  # type: ignore
    |                             ^^^^^^^^^^^^^^
321 | @require_csrf
322 | def pause_job(job_id: str) -> Response:
    |

PGH003 Use specific rule codes when ignoring type issues
   --> app/routes/scheduler.py:333:44
    |
331 |     """
332 |     try:
333 |         get_scheduler().pause_job(job_id)  # type: ignore
    |                                            ^^^^^^^^^^^^^^
334 |         log_info("任务暂停成功", module="scheduler", job_id=job_id)
335 |         return jsonify_unified_success(message="任务暂停成功")
    |

PGH003 Use specific rule codes when ignoring type issues
   --> app/routes/scheduler.py:344:18
    |
343 | @scheduler_bp.route("/api/jobs/<job_id>/resume", methods=["POST"])
344 | @login_required  # type: ignore
    |                  ^^^^^^^^^^^^^^
345 | @scheduler_manage_required  # type: ignore
346 | @require_csrf
    |

PGH003 Use specific rule codes when ignoring type issues
   --> app/routes/scheduler.py:345:29
    |
343 | @scheduler_bp.route("/api/jobs/<job_id>/resume", methods=["POST"])
344 | @login_required  # type: ignore
345 | @scheduler_manage_required  # type: ignore
    |                             ^^^^^^^^^^^^^^
346 | @require_csrf
347 | def resume_job(job_id: str) -> Response:
    |

PGH003 Use specific rule codes when ignoring type issues
   --> app/routes/scheduler.py:358:45
    |
356 |     """
357 |     try:
358 |         get_scheduler().resume_job(job_id)  # type: ignore
    |                                             ^^^^^^^^^^^^^^
359 |         log_info("任务恢复成功", module="scheduler", job_id=job_id)
360 |         return jsonify_unified_success(message="任务恢复成功")
    |

PGH003 Use specific rule codes when ignoring type issues
   --> app/routes/scheduler.py:369:18
    |
368 | @scheduler_bp.route("/api/jobs/<job_id>/run", methods=["POST"])
369 | @login_required  # type: ignore
    |                  ^^^^^^^^^^^^^^
370 | @scheduler_manage_required  # type: ignore
371 | @require_csrf
    |

PGH003 Use specific rule codes when ignoring type issues
   --> app/routes/scheduler.py:370:29
    |
368 | @scheduler_bp.route("/api/jobs/<job_id>/run", methods=["POST"])
369 | @login_required  # type: ignore
370 | @scheduler_manage_required  # type: ignore
    |                             ^^^^^^^^^^^^^^
371 | @require_csrf
372 | def run_job(job_id: str) -> Response:
    |

C901 `run_job` is too complex (12 > 10)
   --> app/routes/scheduler.py:372:5
    |
370 | @scheduler_manage_required  # type: ignore
371 | @require_csrf
372 | def run_job(job_id: str) -> Response:
    |     ^^^^^^^
373 |     """立即执行任务。.
    |

PGH003 Use specific rule codes when ignoring type issues
   --> app/routes/scheduler.py:386:38
    |
384 |     """
385 |     try:
386 |         scheduler = get_scheduler()  # type: ignore
    |                                      ^^^^^^^^^^^^^^
387 |         if not scheduler.running:
388 |             log_warning("调度器未启动", module="scheduler")
    |

TRY301 Abstract `raise` to an inner function
   --> app/routes/scheduler.py:390:13
    |
388 |             log_warning("调度器未启动", module="scheduler")
389 |             msg = "调度器未启动"
390 |             raise SystemError(msg)
    |             ^^^^^^^^^^^^^^^^^^^^^^
391 |
392 |         job = scheduler.get_job(job_id)
    |

TRY301 Abstract `raise` to an inner function
   --> app/routes/scheduler.py:395:13
    |
393 |         if not job:
394 |             msg = "任务不存在"
395 |             raise NotFoundError(msg)
    |             ^^^^^^^^^^^^^^^^^^^^^^^^
396 |
397 |         log_info("开始立即执行任务", module="scheduler", job_id=job_id, job_name=job.name)
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/scheduler.py:399:26
    |
397 |         log_info("开始立即执行任务", module="scheduler", job_id=job_id, job_name=job.name)
398 |
399 |         # 在请求上下文内获取当前用户信息，避免线程中访问 current_user 失败
    |                                         ^^
400 |         created_by = None
401 |         user_is_authenticated = False
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/routes/scheduler.py:404:16
    |
402 |         try:
403 |             user_is_authenticated = current_user.is_authenticated  # type: ignore[attr-defined]
404 |         except Exception:  # pragma: no cover - 防御性捕获
    |                ^^^^^^^^^
405 |             user_is_authenticated = False
406 |         if user_is_authenticated:
    |

PLC0415 `import` should be at the top-level of a file
   --> app/routes/scheduler.py:419:25
    |
417 |                         job.func(*job.args, **manual_kwargs)
418 |                     else:
419 |                         from app import create_app
    |                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
420 |
421 |                         app = create_app(init_scheduler_on_start=False)  # type: ignore
    |

PGH003 Use specific rule codes when ignoring type issues
   --> app/routes/scheduler.py:421:74
    |
419 |                         from app import create_app
420 |
421 |                         app = create_app(init_scheduler_on_start=False)  # type: ignore
    |                                                                          ^^^^^^^^^^^^^^
422 |                         with app.app_context():
423 |                             job.func(*job.args, **(job.kwargs or {}))
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/routes/scheduler.py:431:24
    |
429 |                         job_name=job.name,
430 |                     )
431 |                 except Exception as func_error:  # pragma: no cover - 防御性日志
    |                        ^^^^^^^^^
432 |                     log_error(
433 |                         "任务函数执行失败",
    |

PGH003 Use specific rule codes when ignoring type issues
   --> app/routes/scheduler.py:472:18
    |
471 | @scheduler_bp.route("/api/jobs/reload", methods=["POST"])
472 | @login_required  # type: ignore
    |                  ^^^^^^^^^^^^^^
473 | @scheduler_manage_required  # type: ignore
474 | @require_csrf
    |

PGH003 Use specific rule codes when ignoring type issues
   --> app/routes/scheduler.py:473:29
    |
471 | @scheduler_bp.route("/api/jobs/reload", methods=["POST"])
472 | @login_required  # type: ignore
473 | @scheduler_manage_required  # type: ignore
    |                             ^^^^^^^^^^^^^^
474 | @require_csrf
475 | def reload_jobs() -> Response:
    |

PGH003 Use specific rule codes when ignoring type issues
   --> app/routes/scheduler.py:485:38
    |
483 |     """
484 |     try:
485 |         scheduler = get_scheduler()  # type: ignore
    |                                      ^^^^^^^^^^^^^^
486 |         if not scheduler.running:
487 |             log_warning("调度器未启动", module="scheduler")
    |

TRY301 Abstract `raise` to an inner function
   --> app/routes/scheduler.py:489:13
    |
487 |             log_warning("调度器未启动", module="scheduler")
488 |             msg = "调度器未启动"
489 |             raise SystemError(msg)
    |             ^^^^^^^^^^^^^^^^^^^^^^
490 |
491 |         # 获取现有任务列表
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/routes/scheduler.py:502:20
    |
500 |                 deleted_count += 1
501 |                 log_info("重新加载-删除任务", module="scheduler", job_id=job_id)
502 |             except Exception as del_err:
    |                    ^^^^^^^^^
503 |                 log_error(
504 |                     "重新加载-删除任务失败",
    |

PLC0415 `import` should be at the top-level of a file
   --> app/routes/scheduler.py:511:9
    |
510 |         # 重新加载任务配置
511 |         from app.scheduler import _reload_all_jobs
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
512 |         _reload_all_jobs()
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/scheduler.py:532:46
    |
530 |                 "reloaded_count": len(reloaded_jobs),
531 |             },
532 |             message=f"已删除 {deleted_count} 个任务，重新加载 {len(reloaded_jobs)} 个任务",
    |                                                    ^^
533 |         )
    |

D104 Missing docstring in public package
--> app/routes/tags/__init__.py:1:1

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/tags/bulk.py:28:28
   |
27 |     Returns:
28 |         (JSON 响应, HTTP 状态码)，包含分配统计。
   |                                 ^^
29 |
30 |     Raises:
   |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/tags/bulk.py:121:27
    |
119 |             "tag_ids": tag_ids,
120 |         },
121 |         message=f"标签批量分配成功，共分配 {assigned_count} 个标签关系",
    |                                   ^^
122 |     )
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/tags/bulk.py:133:28
    |
132 |     Returns:
133 |         (JSON 响应, HTTP 状态码)，包含移除统计。
    |                                 ^^
134 |
135 |     Raises:
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/tags/bulk.py:226:27
    |
224 |             "tag_ids": tag_ids,
225 |         },
226 |         message=f"标签批量移除成功，共移除 {removed_count} 个标签关系",
    |                                   ^^
227 |     )
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/tags/bulk.py:238:28
    |
237 |     Returns:
238 |         (JSON 响应, HTTP 状态码)，包含标签列表和分类名称映射。
    |                                 ^^
239 |
240 |     Raises:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/tags/bulk.py:305:28
    |
304 |     Returns:
305 |         (JSON 响应, HTTP 状态码)，包含移除统计。
    |                                 ^^
306 |
307 |     Raises:
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/tags/bulk.py:396:25
    |
394 |             "instance_ids": instance_ids,
395 |         },
396 |         message=f"批量移除成功，共移除 {total_removed} 个标签关系",
    |                               ^^
397 |     )
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/routes/tags/bulk.py:428:20
    |
426 | @view_required
427 | def list_all_tags() -> tuple[Response, int]:
428 |     """获取所有标签列表 API（包括非活跃标签）。.
    |                            ^^
429 |
430 |     Returns:
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/routes/tags/bulk.py:428:28
    |
426 | @view_required
427 | def list_all_tags() -> tuple[Response, int]:
428 |     """获取所有标签列表 API（包括非活跃标签）。.
    |                                            ^^
429 |
430 |     Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/tags/manage.py:68:13
   |
66 |     """标签管理首页。.
67 |
68 |     渲染标签管理页面，支持搜索、分类和状态筛选。
   |                     ^^
69 |
70 |     Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/tags/manage.py:74:22
   |
73 |     Query Parameters:
74 |         search: 搜索关键词，可选。
   |                           ^^
75 |         category: 标签分类，可选。
76 |         status: 状态筛选（'all'、'active'、'inactive'），默认 'all'。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/tags/manage.py:75:23
   |
73 |     Query Parameters:
74 |         search: 搜索关键词，可选。
75 |         category: 标签分类，可选。
   |                           ^^
76 |         status: 状态筛选（'all'、'active'、'inactive'），默认 'all'。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/routes/tags/manage.py:76:21
   |
74 |         search: 搜索关键词，可选。
75 |         category: 标签分类，可选。
76 |         status: 状态筛选（'all'、'active'、'inactive'），默认 'all'。
   |                         ^^
77 |
78 |     """
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/routes/tags/manage.py:76:47
   |
74 |         search: 搜索关键词，可选。
75 |         category: 标签分类，可选。
76 |         status: 状态筛选（'all'、'active'、'inactive'），默认 'all'。
   |                                                      ^^
77 |
78 |     """
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/tags/manage.py:76:48
   |
74 |         search: 搜索关键词，可选。
75 |         category: 标签分类，可选。
76 |         status: 状态筛选（'all'、'active'、'inactive'），默认 'all'。
   |                                                        ^^
77 |
78 |     """
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/tags/manage.py:159:28
    |
157 |     """删除标签。.
158 |
159 |     硬删除标签及其关联关系。如果标签正在被实例使用，则拒绝删除。
    |                                                   ^^
160 |
161 |     Args:
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/tags/manage.py:179:72
    |
177 |             if _prefers_json_response():
178 |                 return jsonify_unified_error_message(
179 |                     f"标签 '{tag.display_name}' 仍被 {instance_count} 个实例使用，无法删除",
    |                                                                                 ^^
180 |                     status_code=HttpStatus.CONFLICT,
181 |                     message_key="TAG_IN_USE",
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/tags/manage.py:185:46
    |
183 |                 )
184 |             flash(
185 |                 f"无法删除标签 '{tag.display_name}'，还有 {instance_count} 个实例正在使用",
    |                                                    ^^
186 |                 FlashCategory.ERROR,
187 |             )
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/routes/tags/manage.py:201:12
    |
199 |         return redirect(url_for("tags.index"))
200 |
201 |     except Exception as e:
    |            ^^^^^^^^^
202 |         db.session.rollback()
203 |         log_error(
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/tags/manage.py:224:18
    |
222 | @require_csrf
223 | def batch_delete_tags() -> tuple[Response, int]:
224 |     """批量删除标签 API，返回每个标签的处理结果。."""
    |                        ^^
225 |     payload = request.get_json(silent=True) or {}
226 |     tag_ids = payload.get("tag_ids") or []
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/routes/tags/manage.py:264:16
    |
262 |             _delete_tag_record(tag, operator_id=operator_id)
263 |             results.append({"tag_id": tag_id, "status": "deleted"})
264 |         except Exception as exc:
    |                ^^^^^^^^^
265 |             db.session.rollback()
266 |             has_failure = True
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/tags/manage.py:281:15
    |
279 |     """Grid.js 标签列表 API。.
280 |
281 |     支持分页、搜索和筛选，返回标签列表及实例数量统计。
    |                         ^^
282 |
283 |     Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/tags/manage.py:287:17
    |
286 |     Query Parameters:
287 |         page: 页码，默认 1。
    |                   ^^
288 |         limit: 每页数量，默认 20。
289 |         search: 搜索关键词，可选。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/tags/manage.py:288:20
    |
286 |     Query Parameters:
287 |         page: 页码，默认 1。
288 |         limit: 每页数量，默认 20。
    |                        ^^
289 |         search: 搜索关键词，可选。
290 |         category: 分类筛选，可选。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/tags/manage.py:289:22
    |
287 |         page: 页码，默认 1。
288 |         limit: 每页数量，默认 20。
289 |         search: 搜索关键词，可选。
    |                           ^^
290 |         category: 分类筛选，可选。
291 |         status: 状态筛选，可选。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/tags/manage.py:290:23
    |
288 |         limit: 每页数量，默认 20。
289 |         search: 搜索关键词，可选。
290 |         category: 分类筛选，可选。
    |                           ^^
291 |         status: 状态筛选，可选。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/tags/manage.py:291:21
    |
289 |         search: 搜索关键词，可选。
290 |         category: 分类筛选，可选。
291 |         status: 状态筛选，可选。
    |                         ^^
292 |
293 |     """
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/routes/tags/manage.py:434:10
    |
433 | # ---------------------------------------------------------------------------
434 | # 表单页面已退役，全部通过列表页模态 + API 处理
    |                 ^^
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/users.py:35:13
   |
33 |     """用户管理首页。.
34 |
35 |     渲染用户管理页面，支持搜索、角色和状态筛选。
   |                     ^^
36 |
37 |     Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/users.py:41:22
   |
40 |     Query Parameters:
41 |         search: 搜索关键词，可选。
   |                           ^^
42 |         role: 角色筛选，可选。
43 |         status: 状态筛选（'all'、'active'、'inactive'），默认 'all'。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/users.py:42:19
   |
40 |     Query Parameters:
41 |         search: 搜索关键词，可选。
42 |         role: 角色筛选，可选。
   |                       ^^
43 |         status: 状态筛选（'all'、'active'、'inactive'），默认 'all'。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/routes/users.py:43:21
   |
41 |         search: 搜索关键词，可选。
42 |         role: 角色筛选，可选。
43 |         status: 状态筛选（'all'、'active'、'inactive'），默认 'all'。
   |                         ^^
44 |
45 |     """
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/routes/users.py:43:47
   |
41 |         search: 搜索关键词，可选。
42 |         role: 角色筛选，可选。
43 |         status: 状态筛选（'all'、'active'、'inactive'），默认 'all'。
   |                                                      ^^
44 |
45 |     """
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/users.py:43:48
   |
41 |         search: 搜索关键词，可选。
42 |         role: 角色筛选，可选。
43 |         status: 状态筛选（'all'、'active'、'inactive'），默认 'all'。
   |                                                        ^^
44 |
45 |     """
   |

BLE001 Do not catch blind exception: `Exception`
  --> app/routes/users.py:60:12
   |
58 |         )
59 |
60 |     except Exception as e:
   |            ^^^^^^^^^
61 |         log_error(
62 |             "加载用户管理页面失败",
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/users.py:83:17
   |
82 |     Query Parameters:
83 |         page: 页码，默认 1。
   |                   ^^
84 |         limit: 每页数量，默认 10。
85 |         sort: 排序字段，默认 'created_at'。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/users.py:84:20
   |
82 |     Query Parameters:
83 |         page: 页码，默认 1。
84 |         limit: 每页数量，默认 10。
   |                        ^^
85 |         sort: 排序字段，默认 'created_at'。
86 |         order: 排序方向（'asc'、'desc'），默认 'desc'。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/users.py:85:19
   |
83 |         page: 页码，默认 1。
84 |         limit: 每页数量，默认 10。
85 |         sort: 排序字段，默认 'created_at'。
   |                       ^^
86 |         order: 排序方向（'asc'、'desc'），默认 'desc'。
87 |         search: 搜索关键词，可选。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/routes/users.py:86:20
   |
84 |         limit: 每页数量，默认 10。
85 |         sort: 排序字段，默认 'created_at'。
86 |         order: 排序方向（'asc'、'desc'），默认 'desc'。
   |                        ^^
87 |         search: 搜索关键词，可选。
88 |         role: 角色筛选，可选。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/routes/users.py:86:33
   |
84 |         limit: 每页数量，默认 10。
85 |         sort: 排序字段，默认 'created_at'。
86 |         order: 排序方向（'asc'、'desc'），默认 'desc'。
   |                                       ^^
87 |         search: 搜索关键词，可选。
88 |         role: 角色筛选，可选。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/users.py:86:34
   |
84 |         limit: 每页数量，默认 10。
85 |         sort: 排序字段，默认 'created_at'。
86 |         order: 排序方向（'asc'、'desc'），默认 'desc'。
   |                                         ^^
87 |         search: 搜索关键词，可选。
88 |         role: 角色筛选，可选。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/users.py:87:22
   |
85 |         sort: 排序字段，默认 'created_at'。
86 |         order: 排序方向（'asc'、'desc'），默认 'desc'。
87 |         search: 搜索关键词，可选。
   |                           ^^
88 |         role: 角色筛选，可选。
89 |         status: 状态筛选，可选。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/users.py:88:19
   |
86 |         order: 排序方向（'asc'、'desc'），默认 'desc'。
87 |         search: 搜索关键词，可选。
88 |         role: 角色筛选，可选。
   |                       ^^
89 |         status: 状态筛选，可选。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/routes/users.py:89:21
   |
87 |         search: 搜索关键词，可选。
88 |         role: 角色筛选，可选。
89 |         status: 状态筛选，可选。
   |                         ^^
90 |
91 |     """
   |

D205 1 blank line required between summary line and description
 --> app/scheduler.py:1:1
  |
1 | / """鲸落定时任务调度器
2 | | 使用APScheduler实现轻量级定时任务.
3 | | """
  | |___^
4 |
5 |   import atexit
  |
help: Insert single blank line

D107 Missing docstring in `__init__`
  --> app/scheduler.py:31:9
   |
29 |     """定时任务调度器."""
30 |
31 |     def __init__(self, app: Any = None) -> None:
   |         ^^^^^^^^
32 |         self.app = app
33 |         self.scheduler = None
   |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `app`
  --> app/scheduler.py:31:29
   |
29 |     """定时任务调度器."""
30 |
31 |     def __init__(self, app: Any = None) -> None:
   |                             ^^^
32 |         self.app = app
33 |         self.scheduler = None
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/scheduler.py:39:40
   |
37 |         """配置 APScheduler 并注册事件监听。.
38 |
39 |         准备 SQLite jobstore、线程执行器与默认任务参数，随后创建后台调度器实例并
   |                                                       ^^
40 |         绑定成功/失败事件，确保所有调度器行为集中在同一处完成。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/scheduler.py:40:18
   |
39 |         准备 SQLite jobstore、线程执行器与默认任务参数，随后创建后台调度器实例并
40 |         绑定成功/失败事件，确保所有调度器行为集中在同一处完成。
   |                          ^^
41 |
42 |         Returns:
   |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/scheduler.py:65:52
   |
63 |             "coalesce": True,  # 合并相同任务
64 |             "max_instances": 1,  # 最大实例数
65 |             "misfire_grace_time": 300,  # 错过执行时间容忍度（秒）
   |                                                             ^^
66 |         }
   |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/scheduler.py:65:54
   |
63 |             "coalesce": True,  # 合并相同任务
64 |             "max_instances": 1,  # 最大实例数
65 |             "misfire_grace_time": 300,  # 错过执行时间容忍度（秒）
   |                                                                 ^^
66 |         }
   |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `event`
  --> app/scheduler.py:80:36
   |
78 |         self.scheduler.add_listener(self._job_error, EVENT_JOB_ERROR)
79 |
80 |     def _job_executed(self, event: Any) -> None:
   |                                    ^^^
81 |         """处理任务成功事件。.
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/scheduler.py:84:36
   |
83 |         Args:
84 |             event: APScheduler 事件对象，包含 job_id 与返回值。
   |                                        ^^
85 |
86 |         Returns:
   |

G004 Logging statement uses f-string
  --> app/scheduler.py:90:21
   |
89 |         """
90 |         logger.info(f"任务执行成功: {event.job_id} - {event.retval}")
   |                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
91 |
92 |     def _job_error(self, event: Any) -> None:
   |
help: Convert to lazy `%` formatting

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `event`
  --> app/scheduler.py:92:33
   |
90 |         logger.info(f"任务执行成功: {event.job_id} - {event.retval}")
91 |
92 |     def _job_error(self, event: Any) -> None:
   |                                 ^^^
93 |         """处理任务失败事件。.
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/scheduler.py:96:36
   |
95 |         Args:
96 |             event: APScheduler 事件对象，包含异常信息。
   |                                        ^^
97 |
98 |         Returns:
   |

G004 Logging statement uses f-string
   --> app/scheduler.py:103:22
    |
101 |         """
102 |         exception_str = str(event.exception) if event.exception else "未知错误"
103 |         logger.error(f"任务执行失败: {event.job_id} - {exception_str}")
    |                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
104 |
105 |     def start(self) -> None:
    |
help: Convert to lazy `%` formatting

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/scheduler.py:116:41
    |
114 |             logger.info("定时任务调度器已启动")
115 |         else:
116 |             logger.warning("定时任务调度器已经在运行，跳过启动")
    |                                                     ^^
117 |
118 |     def stop(self) -> None:
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `func`
   --> app/scheduler.py:129:29
    |
127 |             logger.info("定时任务调度器已停止")
128 |
129 |     def add_job(self, func: Any, trigger: Any, **kwargs: Any) -> Any:
    |                             ^^^
130 |         """向调度器注册任务。.
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `trigger`
   --> app/scheduler.py:129:43
    |
127 |             logger.info("定时任务调度器已停止")
128 |
129 |     def add_job(self, func: Any, trigger: Any, **kwargs: Any) -> Any:
    |                                           ^^^
130 |         """向调度器注册任务。.
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `**kwargs`
   --> app/scheduler.py:129:58
    |
127 |             logger.info("定时任务调度器已停止")
128 |
129 |     def add_job(self, func: Any, trigger: Any, **kwargs: Any) -> Any:
    |                                                          ^^^
130 |         """向调度器注册任务。.
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `add_job`
   --> app/scheduler.py:129:66
    |
127 |             logger.info("定时任务调度器已停止")
128 |
129 |     def add_job(self, func: Any, trigger: Any, **kwargs: Any) -> Any:
    |                                                                  ^^^
130 |         """向调度器注册任务。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/scheduler.py:135:52
    |
133 |             func: 需要调度的可调用对象。
134 |             trigger: APScheduler 触发器或触发器关键字参数。
135 |             **kwargs: 传递给 `scheduler.add_job` 的其它参数，如 id/name。
    |                                                            ^^
136 |
137 |         Returns:
    |

G004 Logging statement uses f-string
   --> app/scheduler.py:155:25
    |
153 |         try:
154 |             self.scheduler.remove_job(job_id)
155 |             logger.info(f"任务已删除: {job_id}")
    |                         ^^^^^^^^^^^^^^^^^^^^^^^
156 |         except Exception as e:
157 |             error_str = str(e) if e else "未知错误"
    |
help: Convert to lazy `%` formatting

G004 Logging statement uses f-string
   --> app/scheduler.py:158:30
    |
156 |         except Exception as e:
157 |             error_str = str(e) if e else "未知错误"
158 |             logger.exception(f"删除任务失败: {job_id} - {error_str}")
    |                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
159 |
160 |     def get_jobs(self) -> list:
    |
help: Convert to lazy `%` formatting

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `get_job`
   --> app/scheduler.py:169:39
    |
167 |         return self.scheduler.get_jobs()
168 |
169 |     def get_job(self, job_id: str) -> Any:
    |                                       ^^^
170 |         """获取指定任务。.
    |

G004 Logging statement uses f-string
   --> app/scheduler.py:192:21
    |
190 |         """
191 |         self.scheduler.pause_job(job_id)
192 |         logger.info(f"任务已暂停: {job_id}")
    |                     ^^^^^^^^^^^^^^^^^^^^^^^
193 |
194 |     def resume_job(self, job_id: str) -> None:
    |
help: Convert to lazy `%` formatting

G004 Logging statement uses f-string
   --> app/scheduler.py:205:21
    |
203 |         """
204 |         self.scheduler.resume_job(job_id)
205 |         logger.info(f"任务已恢复: {job_id}")
    |                     ^^^^^^^^^^^^^^^^^^^^^^^
    |
help: Convert to lazy `%` formatting

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `get_scheduler`
   --> app/scheduler.py:213:24
    |
212 | # 确保scheduler实例可以被正确访问
213 | def get_scheduler() -> Any:
    |                        ^^^
214 |     """获取底层 APScheduler 实例。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/scheduler.py:224:15
    |
223 | def _acquire_scheduler_lock() -> bool:
224 |     """尝试获取文件锁，确保单进程运行调度器。.
    |                      ^^
225 |
226 |     Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/scheduler.py:227:27
    |
226 |     Returns:
227 |         bool: 成功获取锁返回 True，否则返回 False。
    |                                  ^^
228 |
229 |     """
    |

PLW0603 Using the global statement to update `_scheduler_lock_handle` is discouraged
   --> app/scheduler.py:230:12
    |
229 |     """
230 |     global _scheduler_lock_handle, _scheduler_lock_pid
    |            ^^^^^^^^^^^^^^^^^^^^^^
231 |
232 |     if fcntl is None:
    |

PLW0603 Using the global statement to update `_scheduler_lock_handle` is discouraged
   --> app/scheduler.py:230:12
    |
229 |     """
230 |     global _scheduler_lock_handle, _scheduler_lock_pid
    |            ^^^^^^^^^^^^^^^^^^^^^^
231 |
232 |     if fcntl is None:
    |

PLW0603 Using the global statement to update `_scheduler_lock_pid` is discouraged
   --> app/scheduler.py:230:36
    |
229 |     """
230 |     global _scheduler_lock_handle, _scheduler_lock_pid
    |                                    ^^^^^^^^^^^^^^^^^^^
231 |
232 |     if fcntl is None:
    |

PLW0603 Using the global statement to update `_scheduler_lock_pid` is discouraged
   --> app/scheduler.py:230:36
    |
229 |     """
230 |     global _scheduler_lock_handle, _scheduler_lock_pid
    |                                    ^^^^^^^^^^^^^^^^^^^
231 |
232 |     if fcntl is None:
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/scheduler.py:233:37
    |
232 |     if fcntl is None:
233 |         logger.warning("当前平台不支持fcntl，无法加文件锁，可能存在多个调度器实例并发运行")
    |                                            ^^
234 |         return True
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/scheduler.py:233:44
    |
232 |     if fcntl is None:
233 |         logger.warning("当前平台不支持fcntl，无法加文件锁，可能存在多个调度器实例并发运行")
    |                                                          ^^
234 |         return True
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/scheduler.py:241:20
    |
239 |         if _scheduler_lock_pid == current_pid:
240 |             return True
241 |         # 子进程继承了锁句柄，但并未真正持有锁，需要重新获取
    |                             ^^
242 |         try:
243 |             _scheduler_lock_handle.close()
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/scheduler.py:241:29
    |
239 |         if _scheduler_lock_pid == current_pid:
240 |             return True
241 |         # 子进程继承了锁句柄，但并未真正持有锁，需要重新获取
    |                                               ^^
242 |         try:
243 |             _scheduler_lock_handle.close()
    |

SIM105 Use `contextlib.suppress(Exception)` instead of `try`-`except`-`pass`
   --> app/scheduler.py:242:9
    |
240 |               return True
241 |           # 子进程继承了锁句柄，但并未真正持有锁，需要重新获取
242 | /         try:
243 | |             _scheduler_lock_handle.close()
244 | |         except Exception:  # pragma: no cover - 防御性释放
245 | |             pass
    | |________________^
246 |           _scheduler_lock_handle = None
247 |           _scheduler_lock_pid = None
    |
help: Replace `try`-`except`-`pass` with `with contextlib.suppress(Exception): ...`

S110 `try`-`except`-`pass` detected, consider logging the exception
   --> app/scheduler.py:244:9
    |
242 |           try:
243 |               _scheduler_lock_handle.close()
244 | /         except Exception:  # pragma: no cover - 防御性释放
245 | |             pass
    | |________________^
246 |           _scheduler_lock_handle = None
247 |           _scheduler_lock_pid = None
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/scheduler.py:244:16
    |
242 |         try:
243 |             _scheduler_lock_handle.close()
244 |         except Exception:  # pragma: no cover - 防御性释放
    |                ^^^^^^^^^
245 |             pass
246 |         _scheduler_lock_handle = None
    |

SIM115 Use a context manager for opening files
   --> app/scheduler.py:254:14
    |
252 |     lock_path = Path("userdata") / "scheduler.lock"
253 |     lock_path.parent.mkdir(exist_ok=True)
254 |     handle = open(lock_path, "w+")
    |              ^^^^
255 |     try:
256 |         fcntl.flock(handle, fcntl.LOCK_EX | fcntl.LOCK_NB)
    |

PTH123 `open()` should be replaced by `Path.open()`
   --> app/scheduler.py:254:14
    |
252 |     lock_path = Path("userdata") / "scheduler.lock"
253 |     lock_path.parent.mkdir(exist_ok=True)
254 |     handle = open(lock_path, "w+")
    |              ^^^^
255 |     try:
256 |         fcntl.flock(handle, fcntl.LOCK_EX | fcntl.LOCK_NB)
    |
help: Replace with `Path.open()`

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/scheduler.py:261:29
    |
259 |         _scheduler_lock_handle = handle
260 |         _scheduler_lock_pid = current_pid
261 |         logger.info("调度器锁已获取，当前进程负责运行定时任务", pid=os.getpid())
    |                                    ^^
262 |         return True
263 |     except BlockingIOError:
    |

TRY300 Consider moving this statement to an `else` block
   --> app/scheduler.py:262:9
    |
260 |         _scheduler_lock_pid = current_pid
261 |         logger.info("调度器锁已获取，当前进程负责运行定时任务", pid=os.getpid())
262 |         return True
    |         ^^^^^^^^^^^
263 |     except BlockingIOError:
264 |         handle.close()
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/scheduler.py:265:36
    |
263 |     except BlockingIOError:
264 |         handle.close()
265 |         logger.info("检测到其他进程正在运行调度器，跳过当前进程的调度器初始化")
    |                                                  ^^
266 |         return False
267 |     except Exception as exc:  # pragma: no cover - 极端情况
    |

G004 Logging statement uses f-string
   --> app/scheduler.py:269:26
    |
267 |     except Exception as exc:  # pragma: no cover - 极端情况
268 |         handle.close()
269 |         logger.exception(f"获取调度器锁失败: {exc}")
    |                          ^^^^^^^^^^^^^^^^^^^^^^^^^^
270 |         return False
    |
help: Convert to lazy `%` formatting

TRY401 Redundant exception object included in `logging.exception` call
   --> app/scheduler.py:269:39
    |
267 |     except Exception as exc:  # pragma: no cover - 极端情况
268 |         handle.close()
269 |         logger.exception(f"获取调度器锁失败: {exc}")
    |                                               ^^^
270 |         return False
    |

PLW0603 Using the global statement to update `_scheduler_lock_handle` is discouraged
   --> app/scheduler.py:280:12
    |
279 |     """
280 |     global _scheduler_lock_handle, _scheduler_lock_pid
    |            ^^^^^^^^^^^^^^^^^^^^^^
281 |     if fcntl is None or not _scheduler_lock_handle:
282 |         return
    |

PLW0603 Using the global statement to update `_scheduler_lock_pid` is discouraged
   --> app/scheduler.py:280:36
    |
279 |     """
280 |     global _scheduler_lock_handle, _scheduler_lock_pid
    |                                    ^^^^^^^^^^^^^^^^^^^
281 |     if fcntl is None or not _scheduler_lock_handle:
282 |         return
    |

SIM105 Use `contextlib.suppress(Exception)` instead of `try`-`except`-`pass`
   --> app/scheduler.py:283:5
    |
281 |       if fcntl is None or not _scheduler_lock_handle:
282 |           return
283 | /     try:
284 | |         fcntl.flock(_scheduler_lock_handle, fcntl.LOCK_UN)
285 | |     except Exception:  # pragma: no cover
286 | |         pass
    | |____________^
287 |       try:
288 |           _scheduler_lock_handle.close()
    |
help: Replace `try`-`except`-`pass` with `with contextlib.suppress(Exception): ...`

S110 `try`-`except`-`pass` detected, consider logging the exception
   --> app/scheduler.py:285:5
    |
283 |       try:
284 |           fcntl.flock(_scheduler_lock_handle, fcntl.LOCK_UN)
285 | /     except Exception:  # pragma: no cover
286 | |         pass
    | |____________^
287 |       try:
288 |           _scheduler_lock_handle.close()
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/scheduler.py:285:12
    |
283 |     try:
284 |         fcntl.flock(_scheduler_lock_handle, fcntl.LOCK_UN)
285 |     except Exception:  # pragma: no cover
    |            ^^^^^^^^^
286 |         pass
287 |     try:
    |

S110 `try`-`except`-`pass` detected, consider logging the exception
   --> app/scheduler.py:289:5
    |
287 |       try:
288 |           _scheduler_lock_handle.close()
289 | /     except Exception:  # pragma: no cover
290 | |         pass
    | |____________^
291 |       finally:
292 |           _scheduler_lock_handle = None
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/scheduler.py:289:12
    |
287 |     try:
288 |         _scheduler_lock_handle.close()
289 |     except Exception:  # pragma: no cover
    |            ^^^^^^^^^
290 |         pass
291 |     finally:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/scheduler.py:303:26
    |
302 |     Returns:
303 |         bool: True 表示可以启动，False 表示跳过。
    |                                ^^
304 |
305 |     """
    |

G004 Logging statement uses f-string
   --> app/scheduler.py:308:21
    |
306 |     enable_flag = os.environ.get("ENABLE_SCHEDULER", "true").strip().lower()
307 |     if enable_flag not in ("true", "1", "yes"):
308 |         logger.info(f"检测到 ENABLE_SCHEDULER={enable_flag}，跳过调度器初始化")
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
309 |         return False
    |
help: Convert to lazy `%` formatting

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/scheduler.py:308:57
    |
306 |     enable_flag = os.environ.get("ENABLE_SCHEDULER", "true").strip().lower()
307 |     if enable_flag not in ("true", "1", "yes"):
308 |         logger.info(f"检测到 ENABLE_SCHEDULER={enable_flag}，跳过调度器初始化")
    |                                                            ^^
309 |         return False
    |

G004 Logging statement uses f-string
   --> app/scheduler.py:314:21
    |
312 |     if server_software.startswith("gunicorn"):
313 |         parent_pid = os.getppid()
314 |         logger.info(f"检测到 gunicorn 环境，ppid={parent_pid}，将通过文件锁保证单实例")
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
315 |
316 |     # Flask reloader: 只有子进程 (WERKZEUG_RUN_MAIN=true) 才运行调度器
    |
help: Convert to lazy `%` formatting

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/scheduler.py:314:38
    |
312 |     if server_software.startswith("gunicorn"):
313 |         parent_pid = os.getppid()
314 |         logger.info(f"检测到 gunicorn 环境，ppid={parent_pid}，将通过文件锁保证单实例")
    |                                           ^^
315 |
316 |     # Flask reloader: 只有子进程 (WERKZEUG_RUN_MAIN=true) 才运行调度器
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/scheduler.py:314:56
    |
312 |     if server_software.startswith("gunicorn"):
313 |         parent_pid = os.getppid()
314 |         logger.info(f"检测到 gunicorn 环境，ppid={parent_pid}，将通过文件锁保证单实例")
    |                                                              ^^
315 |
316 |     # Flask reloader: 只有子进程 (WERKZEUG_RUN_MAIN=true) 才运行调度器
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/scheduler.py:320:48
    |
318 |         reloader_flag = os.environ.get("WERKZEUG_RUN_MAIN")
319 |         if reloader_flag not in ("true", "1"):
320 |             logger.info("检测到 Flask reloader 父进程，跳过调度器初始化")
    |                                                      ^^
321 |             return False
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `app`
   --> app/scheduler.py:326:25
    |
326 | def init_scheduler(app: Any) -> None:
    |                         ^^^
327 |     """初始化调度器（仅在允许的进程中启动）。.
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/scheduler.py:327:14
    |
326 | def init_scheduler(app: Any) -> None:
327 |     """初始化调度器（仅在允许的进程中启动）。.
    |                    ^^
328 |
329 |     Args:
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/scheduler.py:327:25
    |
326 | def init_scheduler(app: Any) -> None:
327 |     """初始化调度器（仅在允许的进程中启动）。.
    |                                          ^^
328 |
329 |     Args:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/scheduler.py:330:24
    |
329 |     Args:
330 |         app: Flask 应用实例，用于任务上下文。
    |                            ^^
331 |
332 |     Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/scheduler.py:333:53
    |
332 |     Returns:
333 |         TaskScheduler | None: 初始化成功时返回 TaskScheduler，否则返回 None。
    |                                                             ^^
334 |
335 |     """
    |

PLW0602 Using global for `scheduler` but no assignment is done
   --> app/scheduler.py:336:12
    |
335 |     """
336 |     global scheduler
    |            ^^^^^^^^^
337 |
338 |     if not _should_start_scheduler():
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/scheduler.py:347:38
    |
345 |         # 检查是否已经初始化过
346 |         if hasattr(scheduler, "app") and scheduler.app is not None:
347 |             logger.warning("调度器已经初始化过，跳过重复初始化")
    |                                               ^^
348 |             return scheduler
    |

PLC0415 `import` should be at the top-level of a file
   --> app/scheduler.py:362:9
    |
361 |         # 等待调度器完全启动
362 |         import time
    |         ^^^^^^^^^^^
363 |         time.sleep(2)
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/scheduler.py:368:19
    |
366 |         _load_existing_jobs()
367 |
368 |         # 如果没有现有任务，则添加默认任务
    |                           ^^
369 |         _add_default_jobs()
    |

TRY300 Consider moving this statement to an `else` block
   --> app/scheduler.py:372:9
    |
371 |         logger.info("调度器初始化完成")
372 |         return scheduler
    |         ^^^^^^^^^^^^^^^^
373 |     except Exception as e:
374 |         logger.exception(f"调度器初始化失败: {e}")
    |

G004 Logging statement uses f-string
   --> app/scheduler.py:374:26
    |
372 |         return scheduler
373 |     except Exception as e:
374 |         logger.exception(f"调度器初始化失败: {e}")
    |                          ^^^^^^^^^^^^^^^^^^^^^^^^
375 |         # 不抛出异常，让应用继续启动
376 |         return None
    |
help: Convert to lazy `%` formatting

TRY401 Redundant exception object included in `logging.exception` call
   --> app/scheduler.py:374:39
    |
372 |         return scheduler
373 |     except Exception as e:
374 |         logger.exception(f"调度器初始化失败: {e}")
    |                                               ^
375 |         # 不抛出异常，让应用继续启动
376 |         return None
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/scheduler.py:375:16
    |
373 |     except Exception as e:
374 |         logger.exception(f"调度器初始化失败: {e}")
375 |         # 不抛出异常，让应用继续启动
    |                     ^^
376 |         return None
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/scheduler.py:389:35
    |
387 |         # 检查调度器是否已启动
388 |         if not scheduler.scheduler or not scheduler.scheduler.running:
389 |             logger.warning("调度器未启动，跳过加载现有任务")
    |                                         ^^
390 |             return
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/scheduler.py:394:37
    |
392 |         # 检查调度器是否完全就绪
393 |         if not hasattr(scheduler.scheduler, "_jobstores_lock"):
394 |             logger.warning("调度器未完全就绪，跳过加载现有任务")
    |                                             ^^
395 |             return
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/scheduler.py:400:43
    |
398 |         sqlite_path = Path("userdata/scheduler.db")
399 |         if not sqlite_path.exists():
400 |             logger.warning("SQLite数据库文件不存在，跳过加载现有任务")
    |                                                   ^^
401 |             return
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/scheduler.py:403:35
    |
401 |             return
402 |
403 |         # 使用try-except包装get_jobs调用，避免KeyboardInterrupt
    |                                         ^^
404 |         try:
405 |             existing_jobs = scheduler.get_jobs()
    |

G004 Logging statement uses f-string
   --> app/scheduler.py:407:29
    |
405 |             existing_jobs = scheduler.get_jobs()
406 |             if existing_jobs:
407 |                 logger.info(f"从SQLite数据库加载了 {len(existing_jobs)} 个现有任务")
    |                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
408 |                 for job in existing_jobs:
409 |                     logger.info(f"加载任务: {job.name} ({job.id})")
    |
help: Convert to lazy `%` formatting

G004 Logging statement uses f-string
   --> app/scheduler.py:409:33
    |
407 |                 logger.info(f"从SQLite数据库加载了 {len(existing_jobs)} 个现有任务")
408 |                 for job in existing_jobs:
409 |                     logger.info(f"加载任务: {job.name} ({job.id})")
    |                                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
410 |             else:
411 |                 logger.info("SQLite数据库中没有找到任务")
    |
help: Convert to lazy `%` formatting

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/scheduler.py:413:37
    |
411 |                 logger.info("SQLite数据库中没有找到任务")
412 |         except KeyboardInterrupt:
413 |             logger.warning("加载任务时被中断，跳过加载现有任务")
    |                                             ^^
414 |             return
415 |         except Exception as e:
    |

G004 Logging statement uses f-string
   --> app/scheduler.py:416:30
    |
414 |             return
415 |         except Exception as e:
416 |             logger.exception(f"获取任务列表失败: {e}")
    |                              ^^^^^^^^^^^^^^^^^^^^^^^^
417 |             return
418 |     except Exception as e:
    |
help: Convert to lazy `%` formatting

TRY401 Redundant exception object included in `logging.exception` call
   --> app/scheduler.py:416:43
    |
414 |             return
415 |         except Exception as e:
416 |             logger.exception(f"获取任务列表失败: {e}")
    |                                                   ^
417 |             return
418 |     except Exception as e:
    |

G004 Logging statement uses f-string
   --> app/scheduler.py:419:26
    |
417 |             return
418 |     except Exception as e:
419 |         logger.exception(f"加载现有任务失败: {e}")
    |                          ^^^^^^^^^^^^^^^^^^^^^^^^
420 |         # 不抛出异常，让应用继续启动
    |
help: Convert to lazy `%` formatting

TRY401 Redundant exception object included in `logging.exception` call
   --> app/scheduler.py:419:39
    |
417 |             return
418 |     except Exception as e:
419 |         logger.exception(f"加载现有任务失败: {e}")
    |                                               ^
420 |         # 不抛出异常，让应用继续启动
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/scheduler.py:420:16
    |
418 |     except Exception as e:
419 |         logger.exception(f"加载现有任务失败: {e}")
420 |         # 不抛出异常，让应用继续启动
    |                     ^^
    |

C901 `_load_tasks_from_config` is too complex (22 > 10)
   --> app/scheduler.py:443:5
    |
443 | def _load_tasks_from_config(force: bool = False) -> None:
    |     ^^^^^^^^^^^^^^^^^^^^^^^
444 |     """从配置文件加载默认任务并注册。.
    |

PLR0912 Too many branches (23 > 12)
   --> app/scheduler.py:443:5
    |
443 | def _load_tasks_from_config(force: bool = False) -> None:
    |     ^^^^^^^^^^^^^^^^^^^^^^^
444 |     """从配置文件加载默认任务并注册。.
    |

PLR0915 Too many statements (75 > 50)
   --> app/scheduler.py:443:5
    |
443 | def _load_tasks_from_config(force: bool = False) -> None:
    |     ^^^^^^^^^^^^^^^^^^^^^^^
444 |     """从配置文件加载默认任务并注册。.
    |

FBT001 Boolean-typed positional argument in function definition
   --> app/scheduler.py:443:29
    |
443 | def _load_tasks_from_config(force: bool = False) -> None:
    |                             ^^^^^
444 |     """从配置文件加载默认任务并注册。.
    |

FBT002 Boolean default positional argument in function definition
   --> app/scheduler.py:443:29
    |
443 | def _load_tasks_from_config(force: bool = False) -> None:
    |                             ^^^^^
444 |     """从配置文件加载默认任务并注册。.
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/scheduler.py:447:27
    |
446 |     Args:
447 |         force: True 表示强制重建（会删除已有任务）。
    |                                 ^^
448 |
449 |     Returns:
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/scheduler.py:447:35
    |
446 |     Args:
447 |         force: True 表示强制重建（会删除已有任务）。
    |                                                 ^^
448 |
449 |     Returns:
    |

PLC0415 `import` should be at the top-level of a file
   --> app/scheduler.py:453:5
    |
452 |     """
453 |     import yaml
    |     ^^^^^^^^^^^
454 |
455 |     from app.tasks.accounts_sync_tasks import sync_accounts
    |

PLC0415 `import` should be at the top-level of a file
   --> app/scheduler.py:455:5
    |
453 |     import yaml
454 |
455 |     from app.tasks.accounts_sync_tasks import sync_accounts
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
456 |     from app.tasks.capacity_aggregation_tasks import calculate_database_size_aggregations
457 |     from app.tasks.capacity_collection_tasks import collect_database_sizes
    |

PLC0415 `import` should be at the top-level of a file
   --> app/scheduler.py:456:5
    |
455 |     from app.tasks.accounts_sync_tasks import sync_accounts
456 |     from app.tasks.capacity_aggregation_tasks import calculate_database_size_aggregations
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
457 |     from app.tasks.capacity_collection_tasks import collect_database_sizes
458 |     from app.tasks.log_cleanup_tasks import cleanup_old_logs
    |

PLC0415 `import` should be at the top-level of a file
   --> app/scheduler.py:457:5
    |
455 |     from app.tasks.accounts_sync_tasks import sync_accounts
456 |     from app.tasks.capacity_aggregation_tasks import calculate_database_size_aggregations
457 |     from app.tasks.capacity_collection_tasks import collect_database_sizes
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
458 |     from app.tasks.log_cleanup_tasks import cleanup_old_logs
459 |     from app.tasks.partition_management_tasks import monitor_partition_health
    |

PLC0415 `import` should be at the top-level of a file
   --> app/scheduler.py:458:5
    |
456 |     from app.tasks.capacity_aggregation_tasks import calculate_database_size_aggregations
457 |     from app.tasks.capacity_collection_tasks import collect_database_sizes
458 |     from app.tasks.log_cleanup_tasks import cleanup_old_logs
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
459 |     from app.tasks.partition_management_tasks import monitor_partition_health
    |

PLC0415 `import` should be at the top-level of a file
   --> app/scheduler.py:459:5
    |
457 |     from app.tasks.capacity_collection_tasks import collect_database_sizes
458 |     from app.tasks.log_cleanup_tasks import cleanup_old_logs
459 |     from app.tasks.partition_management_tasks import monitor_partition_health
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
460 |
461 |     # 如果不是强制模式，检查是否已有任务
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/scheduler.py:461:15
    |
459 |     from app.tasks.partition_management_tasks import monitor_partition_health
460 |
461 |     # 如果不是强制模式，检查是否已有任务
    |                       ^^
462 |     if not force:
463 |         try:
    |

G004 Logging statement uses f-string
   --> app/scheduler.py:466:29
    |
464 |             existing_jobs = scheduler.get_jobs()
465 |             if existing_jobs:
466 |                 logger.info(f"发现 {len(existing_jobs)} 个现有任务，跳过创建默认任务")
    |                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
467 |                 return
468 |         except KeyboardInterrupt:
    |
help: Convert to lazy `%` formatting

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/scheduler.py:466:60
    |
464 |             existing_jobs = scheduler.get_jobs()
465 |             if existing_jobs:
466 |                 logger.info(f"发现 {len(existing_jobs)} 个现有任务，跳过创建默认任务")
    |                                                                   ^^
467 |                 return
468 |         except KeyboardInterrupt:
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/scheduler.py:469:39
    |
467 |                 return
468 |         except KeyboardInterrupt:
469 |             logger.warning("检查现有任务时被中断，跳过创建默认任务")
    |                                                 ^^
470 |             return
471 |         except Exception as e:
    |

G004 Logging statement uses f-string
   --> app/scheduler.py:472:30
    |
470 |             return
471 |         except Exception as e:
472 |             logger.exception(f"检查现有任务失败: {e}")
    |                              ^^^^^^^^^^^^^^^^^^^^^^^^
473 |             return
    |
help: Convert to lazy `%` formatting

TRY401 Redundant exception object included in `logging.exception` call
   --> app/scheduler.py:472:43
    |
470 |             return
471 |         except Exception as e:
472 |             logger.exception(f"检查现有任务失败: {e}")
    |                                                   ^
473 |             return
    |

PTH118 `os.path.join()` should be replaced by `Path` with `/` operator
   --> app/scheduler.py:476:19
    |
475 |     # 从配置文件读取默认任务
476 |     config_file = os.path.join(os.path.dirname(__file__), "config", "scheduler_tasks.yaml")
    |                   ^^^^^^^^^^^^
477 |
478 |     try:
    |

PTH120 `os.path.dirname()` should be replaced by `Path.parent`
   --> app/scheduler.py:476:32
    |
475 |     # 从配置文件读取默认任务
476 |     config_file = os.path.join(os.path.dirname(__file__), "config", "scheduler_tasks.yaml")
    |                                ^^^^^^^^^^^^^^^
477 |
478 |     try:
    |
help: Replace with `Path(...).parent`

PTH123 `open()` should be replaced by `Path.open()`
   --> app/scheduler.py:479:14
    |
478 |     try:
479 |         with open(config_file, encoding="utf-8") as f:
    |              ^^^^
480 |             config = yaml.safe_load(f)
    |
help: Replace with `Path.open()`

G004 Logging statement uses f-string
   --> app/scheduler.py:505:32
    |
503 |             func = task_func_map.get(function_name)
504 |             if not func:
505 |                 logger.warning(f"未知的任务函数: {function_name}")
    |                                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
506 |                 continue
    |
help: Convert to lazy `%` formatting

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/scheduler.py:510:26
    |
508 |             # 创建任务
509 |             try:
510 |                 # 如果是强制模式，先删除现有任务
    |                                 ^^
511 |                 if force:
512 |                     try:
    |

G004 Logging statement uses f-string
   --> app/scheduler.py:514:37
    |
512 |                     try:
513 |                         scheduler.remove_job(task_id)
514 |                         logger.info(f"强制模式-删除现有任务: {task_name} ({task_id})")
    |                                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
515 |                     except Exception:
516 |                         pass  # 任务不存在，忽略错误
    |
help: Convert to lazy `%` formatting

S110 `try`-`except`-`pass` detected, consider logging the exception
   --> app/scheduler.py:515:21
    |
513 |                           scheduler.remove_job(task_id)
514 |                           logger.info(f"强制模式-删除现有任务: {task_name} ({task_id})")
515 | /                     except Exception:
516 | |                         pass  # 任务不存在，忽略错误
    | |____________________________^
517 |
518 |                   # 对于cron触发器，确保使用正确的时区
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/scheduler.py:515:28
    |
513 |                         scheduler.remove_job(task_id)
514 |                         logger.info(f"强制模式-删除现有任务: {task_name} ({task_id})")
515 |                     except Exception:
    |                            ^^^^^^^^^
516 |                         pass  # 任务不存在，忽略错误
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/scheduler.py:516:38
    |
514 |                         logger.info(f"强制模式-删除现有任务: {task_name} ({task_id})")
515 |                     except Exception:
516 |                         pass  # 任务不存在，忽略错误
    |                                           ^^
517 |
518 |                 # 对于cron触发器，确保使用正确的时区
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/scheduler.py:518:28
    |
516 |                         pass  # 任务不存在，忽略错误
517 |
518 |                 # 对于cron触发器，确保使用正确的时区
    |                                 ^^
519 |                 if trigger_type == "cron":
520 |                     from apscheduler.triggers.cron import CronTrigger
    |

PLC0415 `import` should be at the top-level of a file
   --> app/scheduler.py:520:21
    |
518 |                 # 对于cron触发器，确保使用正确的时区
519 |                 if trigger_type == "cron":
520 |                     from apscheduler.triggers.cron import CronTrigger
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
521 |                     # 只传递实际配置的字段，避免APScheduler自动填充默认值
522 |                     cron_kwargs = {}
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/scheduler.py:521:33
    |
519 |                 if trigger_type == "cron":
520 |                     from apscheduler.triggers.cron import CronTrigger
521 |                     # 只传递实际配置的字段，避免APScheduler自动填充默认值
    |                                           ^^
522 |                     cron_kwargs = {}
523 |                     if "second" in trigger_params:
    |

G004 Logging statement uses f-string
   --> app/scheduler.py:554:29
    |
552 |                         **trigger_params,
553 |                     )
554 |                 logger.info(f"添加任务: {task_name} ({task_id})")
    |                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
555 |             except Exception as e:
556 |                 if force:
    |
help: Convert to lazy `%` formatting

G004 Logging statement uses f-string
   --> app/scheduler.py:557:38
    |
555 |             except Exception as e:
556 |                 if force:
557 |                     logger.exception(f"强制模式-创建任务失败: {task_name} ({task_id}) - {e}")
    |                                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
558 |                 else:
559 |                     logger.warning(f"任务已存在，跳过创建: {task_name} ({task_id}) - {e}")
    |
help: Convert to lazy `%` formatting

TRY401 Redundant exception object included in `logging.exception` call
   --> app/scheduler.py:557:80
    |
555 |             except Exception as e:
556 |                 if force:
557 |                     logger.exception(f"强制模式-创建任务失败: {task_name} ({task_id}) - {e}")
    |                                                                                          ^
558 |                 else:
559 |                     logger.warning(f"任务已存在，跳过创建: {task_name} ({task_id}) - {e}")
    |

G004 Logging statement uses f-string
   --> app/scheduler.py:559:36
    |
557 |                     logger.exception(f"强制模式-创建任务失败: {task_name} ({task_id}) - {e}")
558 |                 else:
559 |                     logger.warning(f"任务已存在，跳过创建: {task_name} ({task_id}) - {e}")
    |                                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
560 |
561 |     except FileNotFoundError:
    |
help: Convert to lazy `%` formatting

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/scheduler.py:559:43
    |
557 |                     logger.exception(f"强制模式-创建任务失败: {task_name} ({task_id}) - {e}")
558 |                 else:
559 |                     logger.warning(f"任务已存在，跳过创建: {task_name} ({task_id}) - {e}")
    |                                                ^^
560 |
561 |     except FileNotFoundError:
    |

G004 Logging statement uses f-string
   --> app/scheduler.py:562:26
    |
561 |     except FileNotFoundError:
562 |         logger.exception(f"配置文件不存在: {config_file}，无法加载默认任务")
    |                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
563 |         return
564 |     except Exception as e:
    |
help: Convert to lazy `%` formatting

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/scheduler.py:562:50
    |
561 |     except FileNotFoundError:
562 |         logger.exception(f"配置文件不存在: {config_file}，无法加载默认任务")
    |                                                         ^^
563 |         return
564 |     except Exception as e:
    |

G004 Logging statement uses f-string
   --> app/scheduler.py:565:26
    |
563 |         return
564 |     except Exception as e:
565 |         logger.exception(f"读取配置文件失败: {e}")
    |                          ^^^^^^^^^^^^^^^^^^^^^^^^
566 |         return
    |
help: Convert to lazy `%` formatting

TRY401 Redundant exception object included in `logging.exception` call
   --> app/scheduler.py:565:39
    |
563 |         return
564 |     except Exception as e:
565 |         logger.exception(f"读取配置文件失败: {e}")
    |                                               ^
566 |         return
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/services/__init__.py:3:9
  |
1 | """服务层模块。.
2 |
3 | 提供业务逻辑服务，包括账户同步、容量采集、数据聚合、统计分析等核心功能。
  |                 ^^
4 |
5 | 主要模块：
  |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
 --> app/services/__init__.py:5:5
  |
3 | 提供业务逻辑服务，包括账户同步、容量采集、数据聚合、统计分析等核心功能。
4 |
5 | 主要模块：
  |         ^^
6 | - accounts_sync: 账户同步服务
7 | - database_sync: 数据库容量同步服务
  |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/services/account_classification/auto_classify_service.py:1:12
  |
1 | """账户自动分类服务，将路由层与编排器解耦。."""
  |                    ^^
2 |
3 | from __future__ import annotations
  |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/account_classification/auto_classify_service.py:60:15
   |
58 |     """账户自动分类服务。.
59 |
60 |     封装账户分类调度逻辑，负责参数校验、日志与错误管理。
   |                         ^^
61 |     将路由层与编排器解耦，提供统一的分类接口。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/account_classification/auto_classify_service.py:61:15
   |
60 |     封装账户分类调度逻辑，负责参数校验、日志与错误管理。
61 |     将路由层与编排器解耦，提供统一的分类接口。
   |                         ^^
62 |
63 |     Attributes:
   |

D107 Missing docstring in `__init__`
  --> app/services/account_classification/auto_classify_service.py:68:9
   |
66 |     """
67 |
68 |     def __init__(self, classification_service: AccountClassificationService | None = None) -> None:
   |         ^^^^^^^^
69 |         self.classification_service = classification_service or AccountClassificationService()
   |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `instance_id`
  --> app/services/account_classification/auto_classify_service.py:74:22
   |
72 |         self,
73 |         *,
74 |         instance_id: Any,
   |                      ^^^
75 |         created_by: int | None,
76 |         use_optimized: Any = True,
   |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `use_optimized`
  --> app/services/account_classification/auto_classify_service.py:76:24
   |
74 |         instance_id: Any,
75 |         created_by: int | None,
76 |         use_optimized: Any = True,
   |                        ^^^
77 |     ) -> AutoClassifyResult:
78 |         """执行账户自动分类。.
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/account_classification/auto_classify_service.py:81:33
   |
80 |         Args:
81 |             instance_id: 目标实例 ID，为空时表示全量分类。
   |                                     ^^
82 |             created_by: 触发该任务的用户 ID，可为空。
83 |             use_optimized: 是否使用优化版分类器，接受布尔或字符串值。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/account_classification/auto_classify_service.py:82:36
   |
80 |         Args:
81 |             instance_id: 目标实例 ID，为空时表示全量分类。
82 |             created_by: 触发该任务的用户 ID，可为空。
   |                                            ^^
83 |             use_optimized: 是否使用优化版分类器，接受布尔或字符串值。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/account_classification/auto_classify_service.py:83:38
   |
81 |             instance_id: 目标实例 ID，为空时表示全量分类。
82 |             created_by: 触发该任务的用户 ID，可为空。
83 |             use_optimized: 是否使用优化版分类器，接受布尔或字符串值。
   |                                                ^^
84 |
85 |         Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/account_classification/auto_classify_service.py:166:33
    |
165 |         Args:
166 |             instance_id: 目标实例 ID，None 表示全量。
    |                                     ^^
167 |             created_by: 触发任务的用户 ID。
168 |             use_optimized: 是否使用优化版分类流程。
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/account_classification/auto_classify_service.py:174:20
    |
173 |         """
174 |         # 目前仅存在优化版本，未来可在此切换不同实现。
    |                             ^^
175 |         if use_optimized:
176 |             return self.classification_service.auto_classify_accounts(
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `value`
   --> app/services/account_classification/auto_classify_service.py:186:24
    |
185 |     @staticmethod
186 |     def _as_int(value: Any) -> int:
    |                        ^^^
187 |         """安全地将输入转换为整数。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/account_classification/auto_classify_service.py:193:25
    |
192 |         Returns:
193 |             int: 转换成功的整数，失败时返回 0。
    |                                ^^
194 |
195 |         """
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `raw_value`
   --> app/services/account_classification/auto_classify_service.py:201:49
    |
199 |             return 0
200 |
201 |     def _normalize_instance_id(self, raw_value: Any) -> int | None:
    |                                                 ^^^
202 |         """规范化实例 ID。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/account_classification/auto_classify_service.py:208:34
    |
207 |         Returns:
208 |             int | None: 解析后的实例 ID，空值返回 None。
    |                                        ^^
209 |
210 |         Raises:
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `value`
   --> app/services/account_classification/auto_classify_service.py:225:35
    |
223 |             raise AutoClassifyError(msg) from exc
224 |
225 |     def _coerce_bool(self, value: Any, *, default: bool) -> bool:
    |                                   ^^^
226 |         """将输入值转换为布尔型。.
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `errors`
   --> app/services/account_classification/auto_classify_service.py:257:35
    |
256 |     @staticmethod
257 |     def _normalize_errors(errors: Any) -> list[str]:
    |                                   ^^^
258 |         """规范化错误结构为字符串列表。.
    |

D107 Missing docstring in `__init__`
  --> app/services/account_classification/cache.py:17:9
   |
15 |     """针对分类业务封装的缓存访问器。."""
16 |
17 |     def __init__(self, manager: Any | None = None) -> None:
   |         ^^^^^^^^
18 |         self.manager = manager or cache_manager
   |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `manager`
  --> app/services/account_classification/cache.py:17:33
   |
15 |     """针对分类业务封装的缓存访问器。."""
16 |
17 |     def __init__(self, manager: Any | None = None) -> None:
   |                                 ^^^^^^^^^^
18 |         self.manager = manager or cache_manager
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/account_classification/cache.py:25:53
   |
24 |         Returns:
25 |             list[dict[str, Any]] | None: 命中缓存时返回规则列表，否则返回 None。
   |                                                                ^^
26 |
27 |         """
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/account_classification/cache.py:47:30
   |
46 |         Returns:
47 |             bool: 写入成功返回 True，数据为空或写入失败返回 False。
   |                                    ^^
48 |
49 |         """
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/account_classification/cache.py:62:29
   |
61 |         Args:
62 |             db_type: 数据库类型标识，例如 mysql、postgres。
   |                                    ^^
63 |             rules: 分类规则列表，将持久化到缓存。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/account_classification/cache.py:63:26
   |
61 |         Args:
62 |             db_type: 数据库类型标识，例如 mysql、postgres。
63 |             rules: 分类规则列表，将持久化到缓存。
   |                                ^^
64 |
65 |         Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/account_classification/cache.py:66:30
   |
65 |         Returns:
66 |             bool: 写入成功返回 True，失败返回 False。
   |                                    ^^
67 |
68 |         """
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/account_classification/cache.py:78:34
   |
77 |         Returns:
78 |             bool: 成功执行失效操作时为 True，否则 False。
   |                                            ^^
79 |
80 |         """
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
 --> app/services/account_classification/classifiers/__init__.py:5:5
  |
3 | 提供各种数据库类型的账户分类规则评估器。
4 |
5 | 主要组件：
  |         ^^
6 | - ClassifierFactory: 分类器工厂
7 | - BaseRuleClassifier: 分类器基类
  |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/services/account_classification/classifiers/base.py:3:18
  |
1 | """分类器基类。.
2 |
3 | 定义数据库特定规则评估器的通用接口，所有数据库类型的分类器都需要继承此基类。
  |                                   ^^
4 | """
  |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/account_classification/classifiers/base.py:42:28
   |
41 |         Returns:
42 |             如果账户满足规则返回 True，否则返回 False。
   |                                      ^^
43 |
44 |         """
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/account_classification/classifiers/base.py:53:30
   |
52 |         Returns:
53 |             如果支持该数据库类型返回 True，否则返回 False。
   |                                          ^^
54 |
55 |         """
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/services/account_classification/classifiers/factory.py:3:16
  |
1 | """分类器工厂。.
2 |
3 | 提供数据库类型专属的分类器实例，支持 MySQL、PostgreSQL、SQL Server 和 Oracle。
  |                               ^^
4 | """
  |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/account_classification/classifiers/factory.py:22:20
   |
20 |     """分类器工厂。.
21 |
22 |     提供数据库类型专属的分类器实例，根据数据库类型返回对应的规则分类器。
   |                                   ^^
23 |
24 |     Attributes:
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/account_classification/classifiers/factory.py:51:27
   |
50 |         Args:
51 |             db_type: 数据库类型（mysql、postgresql、sqlserver、oracle）。
   |                                ^^
52 |
53 |         Returns:
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/account_classification/classifiers/factory.py:51:61
   |
50 |         Args:
51 |             db_type: 数据库类型（mysql、postgresql、sqlserver、oracle）。
   |                                                                      ^^
52 |
53 |         Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/account_classification/classifiers/factory.py:54:21
   |
53 |         Returns:
54 |             对应的分类器实例，如果数据库类型不支持则返回 None。
   |                             ^^
55 |
56 |         Example:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/services/account_classification/classifiers/mysql_classifier.py:3:24
  |
1 | """MySQL 规则分类器。.
2 |
3 | 实现 MySQL 数据库的账户分类规则评估逻辑，支持全局权限、数据库权限、表权限和角色的匹配。
  |                                        ^^
4 | """
  |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/account_classification/classifiers/mysql_classifier.py:18:26
   |
16 |     """MySQL 规则分类器。.
17 |
18 |     实现 MySQL 数据库的账户分类规则评估，支持以下规则类型：
   |                                        ^^
19 |     - global_privileges: 全局权限匹配
20 |     - exclude_privileges: 排除权限匹配
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/services/account_classification/classifiers/mysql_classifier.py:18:35
   |
16 |     """MySQL 规则分类器。.
17 |
18 |     实现 MySQL 数据库的账户分类规则评估，支持以下规则类型：
   |                                                          ^^
19 |     - global_privileges: 全局权限匹配
20 |     - exclude_privileges: 排除权限匹配
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/account_classification/classifiers/mysql_classifier.py:26:26
   |
25 |     Attributes:
26 |         db_type: 数据库类型标识符，固定为 'mysql'。
   |                                  ^^
27 |
28 |     Example:
   |

C901 `evaluate` is too complex (41 > 10)
  --> app/services/account_classification/classifiers/mysql_classifier.py:38:9
   |
36 |     db_type = "mysql"
37 |
38 |     def evaluate(self, account, rule_expression: dict[str, Any]) -> bool:
   |         ^^^^^^^^
39 |         """评估账户是否满足 MySQL 规则表达式。.
   |

PLR0911 Too many return statements (10 > 6)
  --> app/services/account_classification/classifiers/mysql_classifier.py:38:9
   |
36 |     db_type = "mysql"
37 |
38 |     def evaluate(self, account, rule_expression: dict[str, Any]) -> bool:
   |         ^^^^^^^^
39 |         """评估账户是否满足 MySQL 规则表达式。.
   |

PLR0912 Too many branches (43 > 12)
  --> app/services/account_classification/classifiers/mysql_classifier.py:38:9
   |
36 |     db_type = "mysql"
37 |
38 |     def evaluate(self, account, rule_expression: dict[str, Any]) -> bool:
   |         ^^^^^^^^
39 |         """评估账户是否满足 MySQL 规则表达式。.
   |

PLR0915 Too many statements (85 > 50)
  --> app/services/account_classification/classifiers/mysql_classifier.py:38:9
   |
36 |     db_type = "mysql"
37 |
38 |     def evaluate(self, account, rule_expression: dict[str, Any]) -> bool:
   |         ^^^^^^^^
39 |         """评估账户是否满足 MySQL 规则表达式。.
   |

ANN001 Missing type annotation for function argument `account`
  --> app/services/account_classification/classifiers/mysql_classifier.py:38:24
   |
36 |     db_type = "mysql"
37 |
38 |     def evaluate(self, account, rule_expression: dict[str, Any]) -> bool:
   |                        ^^^^^^^
39 |         """评估账户是否满足 MySQL 规则表达式。.
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/account_classification/classifiers/mysql_classifier.py:43:37
   |
41 |         Args:
42 |             account: 账户权限对象。
43 |             rule_expression: 规则表达式字典，支持以下字段：
   |                                            ^^
44 |                 - operator: 逻辑运算符（'AND' 或 'OR'），默认为 'OR'
45 |                 - global_privileges: 全局权限列表
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/services/account_classification/classifiers/mysql_classifier.py:43:44
   |
41 |         Args:
42 |             account: 账户权限对象。
43 |             rule_expression: 规则表达式字典，支持以下字段：
   |                                                          ^^
44 |                 - operator: 逻辑运算符（'AND' 或 'OR'），默认为 'OR'
45 |                 - global_privileges: 全局权限列表
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/account_classification/classifiers/mysql_classifier.py:44:34
   |
42 |             account: 账户权限对象。
43 |             rule_expression: 规则表达式字典，支持以下字段：
44 |                 - operator: 逻辑运算符（'AND' 或 'OR'），默认为 'OR'
   |                                       ^^
45 |                 - global_privileges: 全局权限列表
46 |                 - exclude_privileges: 排除权限列表
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/account_classification/classifiers/mysql_classifier.py:44:47
   |
42 |             account: 账户权限对象。
43 |             rule_expression: 规则表达式字典，支持以下字段：
44 |                 - operator: 逻辑运算符（'AND' 或 'OR'），默认为 'OR'
   |                                                      ^^
45 |                 - global_privileges: 全局权限列表
46 |                 - exclude_privileges: 排除权限列表
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/account_classification/classifiers/mysql_classifier.py:44:48
   |
42 |             account: 账户权限对象。
43 |             rule_expression: 规则表达式字典，支持以下字段：
44 |                 - operator: 逻辑运算符（'AND' 或 'OR'），默认为 'OR'
   |                                                        ^^
45 |                 - global_privileges: 全局权限列表
46 |                 - exclude_privileges: 排除权限列表
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/account_classification/classifiers/mysql_classifier.py:52:28
   |
51 |         Returns:
52 |             如果账户满足规则返回 True，否则返回 False。
   |                                      ^^
53 |
54 |         Example:
   |

TRY300 Consider moving this statement to an `else` block
   --> app/services/account_classification/classifiers/mysql_classifier.py:170:13
    |
168 |                     return False
169 |
170 |             return True
    |             ^^^^^^^^^^^
171 |         except Exception as exc:
172 |             log_error("评估MySQL规则失败", module="account_classification", error=str(exc))
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/services/account_classification/classifiers/mysql_classifier.py:171:16
    |
170 |             return True
171 |         except Exception as exc:
    |                ^^^^^^^^^
172 |             log_error("评估MySQL规则失败", module="account_classification", error=str(exc))
173 |             return False
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `perms`
   --> app/services/account_classification/classifiers/mysql_classifier.py:176:36
    |
175 |     @staticmethod
176 |     def _extract_perm_names(perms: Any) -> set[str]:
    |                                    ^^^
177 |         """从权限数据中提取权限名称集合。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/account_classification/classifiers/mysql_classifier.py:180:24
    |
179 |         Args:
180 |             perms: 权限数据，可以是列表、字典或其他格式。
    |                            ^^
181 |
182 |         Returns:
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `requirement`
   --> app/services/account_classification/classifiers/mysql_classifier.py:200:48
    |
199 |     @staticmethod
200 |     def _normalize_db_requirement(requirement: Any) -> dict[str, Any] | None:
    |                                                ^^^
201 |         """规范化数据库权限要求。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/account_classification/classifiers/mysql_classifier.py:204:30
    |
203 |         Args:
204 |             requirement: 权限要求，可以是字典或字符串。
    |                                  ^^
205 |
206 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/account_classification/classifiers/mysql_classifier.py:207:24
    |
206 |         Returns:
207 |             规范化后的权限要求字典，如果无法规范化则返回 None。
    |                                   ^^
208 |
209 |         """
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `requirement`
   --> app/services/account_classification/classifiers/mysql_classifier.py:217:51
    |
216 |     @staticmethod
217 |     def _normalize_table_requirement(requirement: Any) -> dict[str, Any] | None:
    |                                                   ^^^
218 |         """规范化表权限要求。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/account_classification/classifiers/mysql_classifier.py:221:30
    |
220 |         Args:
221 |             requirement: 权限要求，可以是字典或字符串。
    |                                  ^^
222 |
223 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/account_classification/classifiers/mysql_classifier.py:224:24
    |
223 |         Returns:
224 |             规范化后的权限要求字典，如果无法规范化则返回 None。
    |                                   ^^
225 |
226 |         """
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `value`
   --> app/services/account_classification/classifiers/mysql_classifier.py:234:29
    |
233 |     @staticmethod
234 |     def _ensure_list(value: Any) -> list[str]:
    |                             ^^^
235 |         """确保值为列表格式。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/services/account_classification/classifiers/oracle_classifier.py:3:25
  |
1 | """Oracle 规则分类器。.
2 |
3 | 实现 Oracle 数据库的账户分类规则评估逻辑，支持角色、系统权限和对象权限的匹配。
  |                                         ^^
4 | """
  |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/account_classification/classifiers/oracle_classifier.py:18:27
   |
16 |     """Oracle 规则分类器。.
17 |
18 |     实现 Oracle 数据库的账户分类规则评估，支持以下规则类型：
   |                                         ^^
19 |     - roles: 角色匹配
20 |     - system_privileges: 系统权限匹配
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/services/account_classification/classifiers/oracle_classifier.py:18:36
   |
16 |     """Oracle 规则分类器。.
17 |
18 |     实现 Oracle 数据库的账户分类规则评估，支持以下规则类型：
   |                                                           ^^
19 |     - roles: 角色匹配
20 |     - system_privileges: 系统权限匹配
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/account_classification/classifiers/oracle_classifier.py:24:26
   |
23 |     Attributes:
24 |         db_type: 数据库类型标识符，固定为 'oracle'。
   |                                  ^^
25 |
26 |     Example:
   |

C901 `evaluate` is too complex (15 > 10)
  --> app/services/account_classification/classifiers/oracle_classifier.py:36:9
   |
34 |     db_type = "oracle"
35 |
36 |     def evaluate(self, account, rule_expression: dict[str, Any]) -> bool:
   |         ^^^^^^^^
37 |         """评估账户是否满足 Oracle 规则表达式。.
   |

PLR0912 Too many branches (14 > 12)
  --> app/services/account_classification/classifiers/oracle_classifier.py:36:9
   |
34 |     db_type = "oracle"
35 |
36 |     def evaluate(self, account, rule_expression: dict[str, Any]) -> bool:
   |         ^^^^^^^^
37 |         """评估账户是否满足 Oracle 规则表达式。.
   |

ANN001 Missing type annotation for function argument `account`
  --> app/services/account_classification/classifiers/oracle_classifier.py:36:24
   |
34 |     db_type = "oracle"
35 |
36 |     def evaluate(self, account, rule_expression: dict[str, Any]) -> bool:
   |                        ^^^^^^^
37 |         """评估账户是否满足 Oracle 规则表达式。.
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/account_classification/classifiers/oracle_classifier.py:41:37
   |
39 |         Args:
40 |             account: 账户权限对象。
41 |             rule_expression: 规则表达式字典，支持以下字段：
   |                                            ^^
42 |                 - operator: 逻辑运算符（'AND' 或 'OR'），默认为 'OR'
43 |                 - roles: 角色列表
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/services/account_classification/classifiers/oracle_classifier.py:41:44
   |
39 |         Args:
40 |             account: 账户权限对象。
41 |             rule_expression: 规则表达式字典，支持以下字段：
   |                                                          ^^
42 |                 - operator: 逻辑运算符（'AND' 或 'OR'），默认为 'OR'
43 |                 - roles: 角色列表
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/account_classification/classifiers/oracle_classifier.py:42:34
   |
40 |             account: 账户权限对象。
41 |             rule_expression: 规则表达式字典，支持以下字段：
42 |                 - operator: 逻辑运算符（'AND' 或 'OR'），默认为 'OR'
   |                                       ^^
43 |                 - roles: 角色列表
44 |                 - system_privileges: 系统权限列表
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/account_classification/classifiers/oracle_classifier.py:42:47
   |
40 |             account: 账户权限对象。
41 |             rule_expression: 规则表达式字典，支持以下字段：
42 |                 - operator: 逻辑运算符（'AND' 或 'OR'），默认为 'OR'
   |                                                      ^^
43 |                 - roles: 角色列表
44 |                 - system_privileges: 系统权限列表
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/account_classification/classifiers/oracle_classifier.py:42:48
   |
40 |             account: 账户权限对象。
41 |             rule_expression: 规则表达式字典，支持以下字段：
42 |                 - operator: 逻辑运算符（'AND' 或 'OR'），默认为 'OR'
   |                                                        ^^
43 |                 - roles: 角色列表
44 |                 - system_privileges: 系统权限列表
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/account_classification/classifiers/oracle_classifier.py:48:28
   |
47 |         Returns:
48 |             如果账户满足规则返回 True，否则返回 False。
   |                                      ^^
49 |
50 |         Example:
   |

BLE001 Do not catch blind exception: `Exception`
   --> app/services/account_classification/classifiers/oracle_classifier.py:138:16
    |
137 |             return self._combine_results(match_results, operator)
138 |         except Exception as exc:
    |                ^^^^^^^^^
139 |             log_error("评估Oracle规则失败", module="account_classification", error=str(exc))
140 |             return False
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/account_classification/classifiers/oracle_classifier.py:148:35
    |
146 |         Args:
147 |             results: 各子条件的匹配结果。
148 |             operator: 'AND' 或 'OR'，决定组合逻辑。
    |                                    ^^
149 |
150 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/account_classification/classifiers/oracle_classifier.py:151:34
    |
150 |         Returns:
151 |             bool: 当结果列表为空时视为 True，否则按运算符聚合。
    |                                            ^^
152 |
153 |         """
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `source`
   --> app/services/account_classification/classifiers/oracle_classifier.py:161:50
    |
160 |     @staticmethod
161 |     def _normalize_tablespace_privileges(source: Any) -> list[dict[str, Any]]:
    |                                                  ^^^
162 |         """支持 dict/list 两种结构的表空间权限。.
    |

PERF401 Use `list.extend` to create a transformed list
   --> app/services/account_classification/classifiers/oracle_classifier.py:176:21
    |
174 |                   perms = privileges if isinstance(privileges, list) else [privileges]
175 |                   for privilege in perms:
176 | /                     normalized.append(
177 | |                         {
178 | |                             "tablespace_name": tablespace_name,
179 | |                             "privilege": privilege,
180 | |                         },
181 | |                     )
    | |_____________________^
182 |           elif isinstance(source, list):
183 |               normalized = [item for item in source if isinstance(item, dict)]
    |
help: Replace for loop with list.extend

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/services/account_classification/classifiers/postgresql_classifier.py:3:29
  |
1 | """PostgreSQL 规则分类器。.
2 |
3 | 实现 PostgreSQL 数据库的账户分类规则评估逻辑，支持预定义角色、角色属性、数据库权限和模式权限的匹配。
  |                                             ^^
4 | """
  |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/account_classification/classifiers/postgresql_classifier.py:18:31
   |
16 |     """PostgreSQL 规则分类器。.
17 |
18 |     实现 PostgreSQL 数据库的账户分类规则评估，支持以下规则类型：
   |                                             ^^
19 |     - predefined_roles: 预定义角色匹配
20 |     - role_attributes: 角色属性匹配（如 SUPERUSER、CREATEDB 等）
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/services/account_classification/classifiers/postgresql_classifier.py:18:40
   |
16 |     """PostgreSQL 规则分类器。.
17 |
18 |     实现 PostgreSQL 数据库的账户分类规则评估，支持以下规则类型：
   |                                                               ^^
19 |     - predefined_roles: 预定义角色匹配
20 |     - role_attributes: 角色属性匹配（如 SUPERUSER、CREATEDB 等）
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/account_classification/classifiers/postgresql_classifier.py:20:30
   |
18 |     实现 PostgreSQL 数据库的账户分类规则评估，支持以下规则类型：
19 |     - predefined_roles: 预定义角色匹配
20 |     - role_attributes: 角色属性匹配（如 SUPERUSER、CREATEDB 等）
   |                                    ^^
21 |     - database_privileges: 数据库级权限匹配
22 |     - schema_privileges: 模式级权限匹配
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/account_classification/classifiers/postgresql_classifier.py:20:53
   |
18 |     实现 PostgreSQL 数据库的账户分类规则评估，支持以下规则类型：
19 |     - predefined_roles: 预定义角色匹配
20 |     - role_attributes: 角色属性匹配（如 SUPERUSER、CREATEDB 等）
   |                                                               ^^
21 |     - database_privileges: 数据库级权限匹配
22 |     - schema_privileges: 模式级权限匹配
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/account_classification/classifiers/postgresql_classifier.py:25:26
   |
24 |     Attributes:
25 |         db_type: 数据库类型标识符，固定为 'postgresql'。
   |                                  ^^
26 |
27 |     Example:
   |

C901 `evaluate` is too complex (11 > 10)
  --> app/services/account_classification/classifiers/postgresql_classifier.py:37:9
   |
35 |     db_type = "postgresql"
36 |
37 |     def evaluate(self, account, rule_expression: dict[str, Any]) -> bool:
   |         ^^^^^^^^
38 |         """评估账户是否满足 PostgreSQL 规则表达式。.
   |

ANN001 Missing type annotation for function argument `account`
  --> app/services/account_classification/classifiers/postgresql_classifier.py:37:24
   |
35 |     db_type = "postgresql"
36 |
37 |     def evaluate(self, account, rule_expression: dict[str, Any]) -> bool:
   |                        ^^^^^^^
38 |         """评估账户是否满足 PostgreSQL 规则表达式。.
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/account_classification/classifiers/postgresql_classifier.py:42:37
   |
40 |         Args:
41 |             account: 账户权限对象。
42 |             rule_expression: 规则表达式字典，支持以下字段：
   |                                            ^^
43 |                 - operator: 逻辑运算符（'AND' 或 'OR'），默认为 'OR'
44 |                 - predefined_roles: 预定义角色列表
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/services/account_classification/classifiers/postgresql_classifier.py:42:44
   |
40 |         Args:
41 |             account: 账户权限对象。
42 |             rule_expression: 规则表达式字典，支持以下字段：
   |                                                          ^^
43 |                 - operator: 逻辑运算符（'AND' 或 'OR'），默认为 'OR'
44 |                 - predefined_roles: 预定义角色列表
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/account_classification/classifiers/postgresql_classifier.py:43:34
   |
41 |             account: 账户权限对象。
42 |             rule_expression: 规则表达式字典，支持以下字段：
43 |                 - operator: 逻辑运算符（'AND' 或 'OR'），默认为 'OR'
   |                                       ^^
44 |                 - predefined_roles: 预定义角色列表
45 |                 - role_attributes: 角色属性列表
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/account_classification/classifiers/postgresql_classifier.py:43:47
   |
41 |             account: 账户权限对象。
42 |             rule_expression: 规则表达式字典，支持以下字段：
43 |                 - operator: 逻辑运算符（'AND' 或 'OR'），默认为 'OR'
   |                                                      ^^
44 |                 - predefined_roles: 预定义角色列表
45 |                 - role_attributes: 角色属性列表
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/account_classification/classifiers/postgresql_classifier.py:43:48
   |
41 |             account: 账户权限对象。
42 |             rule_expression: 规则表达式字典，支持以下字段：
43 |                 - operator: 逻辑运算符（'AND' 或 'OR'），默认为 'OR'
   |                                                        ^^
44 |                 - predefined_roles: 预定义角色列表
45 |                 - role_attributes: 角色属性列表
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/account_classification/classifiers/postgresql_classifier.py:50:28
   |
49 |         Returns:
50 |             如果账户满足规则返回 True，否则返回 False。
   |                                      ^^
51 |
52 |         Example:
   |

BLE001 Do not catch blind exception: `Exception`
   --> app/services/account_classification/classifiers/postgresql_classifier.py:105:16
    |
104 |             return self._combine_results(match_results, operator)
105 |         except Exception as exc:
    |                ^^^^^^^^^
106 |             log_error("评估PostgreSQL规则失败", module="account_classification", error=str(exc))
107 |             return False
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `perms`
   --> app/services/account_classification/classifiers/postgresql_classifier.py:110:36
    |
109 |     @staticmethod
110 |     def _extract_priv_names(perms: Any) -> set[str]:
    |                                    ^^^
111 |         """提取权限名称集合。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/account_classification/classifiers/postgresql_classifier.py:117:33
    |
116 |         Returns:
117 |             set[str]: 去重后的权限名称集合，仅包含已授权的权限。
    |                                           ^^
118 |
119 |         """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/account_classification/classifiers/postgresql_classifier.py:144:37
    |
143 |         Returns:
144 |             bool: results 为空时返回 True，否则按运算符聚合。
    |                                          ^^
145 |
146 |         """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/services/account_classification/classifiers/sqlserver_classifier.py:3:29
  |
1 | """SQL Server 规则分类器。.
2 |
3 | 实现 SQL Server 数据库的账户分类规则评估逻辑，支持服务器角色、数据库角色和权限的匹配。
  |                                             ^^
4 | """
  |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/account_classification/classifiers/sqlserver_classifier.py:18:31
   |
16 |     """SQL Server 规则分类器。.
17 |
18 |     实现 SQL Server 数据库的账户分类规则评估，支持以下规则类型：
   |                                             ^^
19 |     - server_roles: 服务器角色匹配
20 |     - database_roles: 数据库角色匹配
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/services/account_classification/classifiers/sqlserver_classifier.py:18:40
   |
16 |     """SQL Server 规则分类器。.
17 |
18 |     实现 SQL Server 数据库的账户分类规则评估，支持以下规则类型：
   |                                                               ^^
19 |     - server_roles: 服务器角色匹配
20 |     - database_roles: 数据库角色匹配
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/account_classification/classifiers/sqlserver_classifier.py:25:26
   |
24 |     Attributes:
25 |         db_type: 数据库类型标识符，固定为 'sqlserver'。
   |                                  ^^
26 |
27 |     Example:
   |

C901 `evaluate` is too complex (11 > 10)
  --> app/services/account_classification/classifiers/sqlserver_classifier.py:37:9
   |
35 |     db_type = "sqlserver"
36 |
37 |     def evaluate(self, account, rule_expression: dict[str, Any]) -> bool:
   |         ^^^^^^^^
38 |         """评估账户是否满足 SQL Server 规则表达式。.
   |

ANN001 Missing type annotation for function argument `account`
  --> app/services/account_classification/classifiers/sqlserver_classifier.py:37:24
   |
35 |     db_type = "sqlserver"
36 |
37 |     def evaluate(self, account, rule_expression: dict[str, Any]) -> bool:
   |                        ^^^^^^^
38 |         """评估账户是否满足 SQL Server 规则表达式。.
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/account_classification/classifiers/sqlserver_classifier.py:42:37
   |
40 |         Args:
41 |             account: 账户权限对象。
42 |             rule_expression: 规则表达式字典，支持以下字段：
   |                                            ^^
43 |                 - operator: 逻辑运算符（'AND' 或 'OR'），默认为 'OR'
44 |                 - server_roles: 服务器角色列表
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/services/account_classification/classifiers/sqlserver_classifier.py:42:44
   |
40 |         Args:
41 |             account: 账户权限对象。
42 |             rule_expression: 规则表达式字典，支持以下字段：
   |                                                          ^^
43 |                 - operator: 逻辑运算符（'AND' 或 'OR'），默认为 'OR'
44 |                 - server_roles: 服务器角色列表
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/account_classification/classifiers/sqlserver_classifier.py:43:34
   |
41 |             account: 账户权限对象。
42 |             rule_expression: 规则表达式字典，支持以下字段：
43 |                 - operator: 逻辑运算符（'AND' 或 'OR'），默认为 'OR'
   |                                       ^^
44 |                 - server_roles: 服务器角色列表
45 |                 - database_roles: 数据库角色列表
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/account_classification/classifiers/sqlserver_classifier.py:43:47
   |
41 |             account: 账户权限对象。
42 |             rule_expression: 规则表达式字典，支持以下字段：
43 |                 - operator: 逻辑运算符（'AND' 或 'OR'），默认为 'OR'
   |                                                      ^^
44 |                 - server_roles: 服务器角色列表
45 |                 - database_roles: 数据库角色列表
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/account_classification/classifiers/sqlserver_classifier.py:43:48
   |
41 |             account: 账户权限对象。
42 |             rule_expression: 规则表达式字典，支持以下字段：
43 |                 - operator: 逻辑运算符（'AND' 或 'OR'），默认为 'OR'
   |                                                        ^^
44 |                 - server_roles: 服务器角色列表
45 |                 - database_roles: 数据库角色列表
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/account_classification/classifiers/sqlserver_classifier.py:50:28
   |
49 |         Returns:
50 |             如果账户满足规则返回 True，否则返回 False。
   |                                      ^^
51 |
52 |         Example:
   |

BLE001 Do not catch blind exception: `Exception`
   --> app/services/account_classification/classifiers/sqlserver_classifier.py:115:16
    |
114 |             return self._combine_results(match_results, operator)
115 |         except Exception as exc:
    |                ^^^^^^^^^
116 |             log_error("评估SQL Server规则失败", module="account_classification", error=str(exc))
117 |             return False
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/account_classification/classifiers/sqlserver_classifier.py:125:35
    |
123 |         Args:
124 |             results: 每个子条件的布尔结果。
125 |             operator: 'AND' 或 'OR'，决定组合策略。
    |                                    ^^
126 |
127 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/account_classification/classifiers/sqlserver_classifier.py:128:33
    |
127 |         Returns:
128 |             bool: 结果列表为空时返回 True，否则按运算符聚合。
    |                                          ^^
129 |
130 |         """
    |

D107 Missing docstring in `__init__`
  --> app/services/account_classification/orchestrator.py:32:9
   |
30 |     """
31 |
32 |     def __init__(
   |         ^^^^^^^^
33 |         self,
34 |         repository: ClassificationRepository | None = None,
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/account_classification/orchestrator.py:49:34
   |
48 |         Args:
49 |             instance_id: 限定的实例 ID，None 时表示全量处理。
   |                                       ^^
50 |             created_by: 触发任务的用户 ID。
   |

TRY300 Consider moving this statement to an `else` block
  --> app/services/account_classification/orchestrator.py:87:13
   |
85 |             )
86 |
87 |             return {"success": True, "message": "自动分类完成", **result}
   |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
88 |         except Exception as exc:
89 |             log_error("优化后的自动分类失败", module="account_classification", error=str(exc))
   |

BLE001 Do not catch blind exception: `Exception`
  --> app/services/account_classification/orchestrator.py:88:16
   |
87 |             return {"success": True, "message": "自动分类完成", **result}
88 |         except Exception as exc:
   |                ^^^^^^^^^
89 |             log_error("优化后的自动分类失败", module="account_classification", error=str(exc))
90 |             return {"success": False, "error": f"自动分类失败: {exc}"}
   |

BLE001 Do not catch blind exception: `Exception`
   --> app/services/account_classification/orchestrator.py:101:16
    |
 99 |         try:
100 |             return self.cache.invalidate_all()
101 |         except Exception as exc:
    |                ^^^^^^^^^
102 |             log_error("清除分类缓存失败", module="account_classification", error=str(exc))
103 |             return False
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/services/account_classification/orchestrator.py:117:16
    |
115 |         try:
116 |             return self.cache.invalidate_db_type(db_type)
117 |         except Exception as exc:
    |                ^^^^^^^^^
118 |             log_error("清除数据库类型缓存失败", module="account_classification", db_type=db_type, error=str(exc))
119 |             return False
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/account_classification/orchestrator.py:126:47
    |
125 |         Returns:
126 |             list[ClassificationRule]: 已排序的规则集合，包含缓存命中优先级。
    |                                                       ^^
127 |
128 |         """
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/services/account_classification/orchestrator.py:251:20
    |
249 |                 all_errors.extend(result["errors"])
250 |                 db_type_results[db_type] = result
251 |             except Exception as exc:
    |                    ^^^^^^^^^
252 |                 error_msg = f"数据库类型 {db_type} 分类失败: {exc}"
253 |                 log_error(error_msg, module="account_classification")
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/services/account_classification/orchestrator.py:316:20
    |
314 |                     matched_accounts=len(matched_accounts),
315 |                 )
316 |             except Exception as exc:
    |                    ^^^^^^^^^
317 |                 error_msg = f"规则 {rule.rule_name} 处理失败: {exc}"
318 |                 log_error(error_msg, module="account_classification", rule_id=rule.id, db_type=db_type)
    |

PERF401 Use a list comprehension to create a transformed list
   --> app/services/account_classification/orchestrator.py:355:17
    |
353 |         for account in filtered_accounts:
354 |             if self._evaluate_rule(account, rule):
355 |                 matched_accounts.append(account)
    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
356 |         return matched_accounts
    |
help: Replace for loop with list comprehension

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/account_classification/orchestrator.py:366:32
    |
365 |         Returns:
366 |             bool: 账户满足规则返回 True，否则 False。
    |                                        ^^
367 |
368 |         """
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/services/account_classification/orchestrator.py:382:27
    |
381 |         Args:
382 |             duration: 分类耗时（秒）。
    |                               ^^
383 |             total_accounts: 参与分类的账户数量。
384 |             total_rules: 本次评估的规则数量。
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/services/account_classification/orchestrator.py:382:29
    |
381 |         Args:
382 |             duration: 分类耗时（秒）。
    |                                   ^^
383 |             total_accounts: 参与分类的账户数量。
384 |             total_rules: 本次评估的规则数量。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/account_classification/repositories.py:49:34
   |
48 |         Args:
49 |             instance_id: 可选的实例 ID，用于筛选特定实例的账户。
   |                                       ^^
50 |
51 |         Returns:
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/account_classification/repositories.py:52:24
   |
51 |         Returns:
52 |             符合条件的账户权限列表（仅活跃实例和账户）。
   |                                   ^^
53 |
54 |         """
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/account_classification/repositories.py:52:33
   |
51 |         Returns:
52 |             符合条件的账户权限列表（仅活跃实例和账户）。
   |                                                     ^^
53 |
54 |         """
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/account_classification/repositories.py:71:24
   |
69 |         """重新分类前清理所有既有分配关系。.
70 |
71 |         删除所有现有的账户分类分配记录，为重新分类做准备。
   |                                       ^^
72 |
73 |         Returns:
   |

TRY300 Consider moving this statement to an `else` block
  --> app/services/account_classification/repositories.py:89:13
   |
87 |                 )
88 |             db.session.commit()
89 |             return deleted
   |             ^^^^^^^^^^^^^^
90 |         except Exception as exc:
91 |             db.session.rollback()
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/account_classification/repositories.py:104:19
    |
102 |         """为指定账户集重新写入分类分配记录。.
103 |
104 |         先删除现有的分配记录，然后批量插入新的分配记录。
    |                             ^^
105 |
106 |         Args:
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/services/account_classification/repositories.py:160:16
    |
159 |             return len(new_assignments)
160 |         except Exception as exc:
    |                ^^^^^^^^^
161 |             log_error(
162 |                 "批量写入分类分配失败",
    |

PERF401 Use a list comprehension to create a transformed list
   --> app/services/account_classification/repositories.py:184:13
    |
182 |           payload: list[dict] = []
183 |           for rule in rules:
184 | /             payload.append(
185 | |                 {
186 | |                     "id": rule.id,
187 | |                     "classification_id": rule.classification_id,
188 | |                     "db_type": rule.db_type,
189 | |                     "rule_name": rule.rule_name,
190 | |                     "rule_expression": rule.rule_expression,
191 | |                     "is_active": rule.is_active,
192 | |                     "created_at": rule.created_at.isoformat() if rule.created_at else None,
193 | |                     "updated_at": rule.updated_at.isoformat() if rule.updated_at else None,
194 | |                 },
195 | |             )
    | |_____________^
196 |           return payload
    |
help: Replace for loop with list comprehension

BLE001 Do not catch blind exception: `Exception`
   --> app/services/account_classification/repositories.py:220:20
    |
218 |                 rule.is_active = data.get("is_active", True)
219 |                 hydrated.append(rule)
220 |             except Exception as exc:
    |                    ^^^^^^^^^
221 |                 log_error("反序列化规则缓存失败", module="account_classification", error=str(exc))
222 |         return hydrated
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/services/accounts_sync/__init__.py:3:13
  |
1 | """账户同步服务模块。.
2 |
3 | 提供数据库账户的同步功能，包括账户清单管理、权限采集和增量更新。
  |                         ^^
4 |
5 | 主要组件：
  |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
 --> app/services/accounts_sync/__init__.py:5:5
  |
3 | 提供数据库账户的同步功能，包括账户清单管理、权限采集和增量更新。
4 |
5 | 主要组件：
  |         ^^
6 | - AccountSyncService: 账户同步服务（统一入口）
7 | - AccountSyncCoordinator: 账户同步协调器
  |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
 --> app/services/accounts_sync/__init__.py:6:29
  |
5 | 主要组件：
6 | - AccountSyncService: 账户同步服务（统一入口）
  |                                   ^^
7 | - AccountSyncCoordinator: 账户同步协调器
8 | - AccountInventoryManager: 账户清单管理器
  |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
 --> app/services/accounts_sync/__init__.py:6:34
  |
5 | 主要组件：
6 | - AccountSyncService: 账户同步服务（统一入口）
  |                                             ^^
7 | - AccountSyncCoordinator: 账户同步协调器
8 | - AccountInventoryManager: 账户清单管理器
  |

FBT001 Boolean-typed positional argument in function definition
  --> app/services/accounts_sync/account_query_service.py:9:48
   |
 9 | def get_accounts_by_instance(instance_id: int, include_inactive: bool = False) -> list[AccountPermission]:
   |                                                ^^^^^^^^^^^^^^^^
10 |     """按实例获取账户列表。.
   |

FBT002 Boolean default positional argument in function definition
  --> app/services/accounts_sync/account_query_service.py:9:48
   |
 9 | def get_accounts_by_instance(instance_id: int, include_inactive: bool = False) -> list[AccountPermission]:
   |                                                ^^^^^^^^^^^^^^^^
10 |     """按实例获取账户列表。.
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/accounts_sync/account_query_service.py:12:20
   |
10 |     """按实例获取账户列表。.
11 |
12 |     查询指定实例的所有账户权限记录，按用户名升序排列。
   |                                   ^^
13 |
14 |     Args:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/accounts_sync/account_query_service.py:16:36
   |
14 |     Args:
15 |         instance_id: 实例 ID。
16 |         include_inactive: 是否包含已失活账户，默认为 False。
   |                                             ^^
17 |
18 |     Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/accounts_sync/account_query_service.py:19:17
   |
18 |     Returns:
19 |         账户权限对象列表，按用户名升序排列。
   |                         ^^
20 |
21 |     """
   |

D205 1 blank line required between summary line and description
 --> app/services/accounts_sync/accounts_sync_filters.py:1:1
  |
1 | / """鲸落 - 数据库过滤规则管理器
2 | | 专门用于数据库账户同步时的过滤规则管理.
3 | | """
  | |___^
4 |
5 |   import re
  |
help: Insert single blank line

D107 Missing docstring in `__init__`
  --> app/services/accounts_sync/accounts_sync_filters.py:22:9
   |
20 |     """数据库过滤规则管理器."""
21 |
22 |     def __init__(self, config_path: str | Path | None = None) -> None:
   |         ^^^^^^^^
23 |         path_obj = Path(config_path) if config_path else _DEFAULT_CONFIG_PATH
24 |         self.config_file = path_obj
   |

G004 Logging statement uses f-string
  --> app/services/accounts_sync/accounts_sync_filters.py:40:26
   |
38 |         """
39 |         if not self.config_file.exists():
40 |             logger.error(f"账户过滤规则配置文件不存在: {self.config_path_str}")
   |                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
41 |             msg = f"账户过滤规则配置文件不存在: {self.config_path_str}"
42 |             raise FileNotFoundError(msg)
   |
help: Convert to lazy `%` formatting

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/accounts_sync/accounts_sync_filters.py:49:39
   |
48 |             if "account_filters" not in config:
49 |                 logger.error("配置文件格式错误，缺少 account_filters 节点")
   |                                               ^^
50 |                 msg = "配置文件格式错误，缺少 account_filters 节点"
51 |                 raise ValueError(msg)
   |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/accounts_sync/accounts_sync_filters.py:50:32
   |
48 |             if "account_filters" not in config:
49 |                 logger.error("配置文件格式错误，缺少 account_filters 节点")
50 |                 msg = "配置文件格式错误，缺少 account_filters 节点"
   |                                        ^^
51 |                 raise ValueError(msg)
   |

TRY301 Abstract `raise` to an inner function
  --> app/services/accounts_sync/accounts_sync_filters.py:51:17
   |
49 |                 logger.error("配置文件格式错误，缺少 account_filters 节点")
50 |                 msg = "配置文件格式错误，缺少 account_filters 节点"
51 |                 raise ValueError(msg)
   |                 ^^^^^^^^^^^^^^^^^^^^^
52 |
53 |             filter_rules = config["account_filters"] or {}
   |

G004 Logging statement uses f-string
  --> app/services/accounts_sync/accounts_sync_filters.py:54:25
   |
53 |             filter_rules = config["account_filters"] or {}
54 |             logger.info(f"成功加载账户过滤规则配置文件: {self.config_path_str}")
   |                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
55 |             logger.info(f"加载的数据库类型: {list(filter_rules.keys())}")
   |
help: Convert to lazy `%` formatting

G004 Logging statement uses f-string
  --> app/services/accounts_sync/accounts_sync_filters.py:55:25
   |
53 |             filter_rules = config["account_filters"] or {}
54 |             logger.info(f"成功加载账户过滤规则配置文件: {self.config_path_str}")
55 |             logger.info(f"加载的数据库类型: {list(filter_rules.keys())}")
   |                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
56 |
57 |             return filter_rules
   |
help: Convert to lazy `%` formatting

TRY300 Consider moving this statement to an `else` block
  --> app/services/accounts_sync/accounts_sync_filters.py:57:13
   |
55 |             logger.info(f"加载的数据库类型: {list(filter_rules.keys())}")
56 |
57 |             return filter_rules
   |             ^^^^^^^^^^^^^^^^^^^
58 |
59 |         except yaml.YAMLError as exc:
   |

G004 Logging statement uses f-string
  --> app/services/accounts_sync/accounts_sync_filters.py:60:30
   |
59 |         except yaml.YAMLError as exc:
60 |             logger.exception(f"解析配置文件失败: {exc}")
   |                              ^^^^^^^^^^^^^^^^^^^^^^^^^^
61 |             msg = f"解析配置文件失败: {exc}"
62 |             raise ValueError(msg) from exc
   |
help: Convert to lazy `%` formatting

TRY401 Redundant exception object included in `logging.exception` call
  --> app/services/accounts_sync/accounts_sync_filters.py:60:43
   |
59 |         except yaml.YAMLError as exc:
60 |             logger.exception(f"解析配置文件失败: {exc}")
   |                                                   ^^^
61 |             msg = f"解析配置文件失败: {exc}"
62 |             raise ValueError(msg) from exc
   |

G004 Logging statement uses f-string
  --> app/services/accounts_sync/accounts_sync_filters.py:64:30
   |
62 |             raise ValueError(msg) from exc
63 |         except Exception as exc:
64 |             logger.exception(f"加载过滤规则配置文件失败: {exc}")
   |                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
65 |             raise
   |
help: Convert to lazy `%` formatting

TRY401 Redundant exception object included in `logging.exception` call
  --> app/services/accounts_sync/accounts_sync_filters.py:64:47
   |
62 |             raise ValueError(msg) from exc
63 |         except Exception as exc:
64 |             logger.exception(f"加载过滤规则配置文件失败: {exc}")
   |                                                           ^^^
65 |             raise
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/accounts_sync/accounts_sync_filters.py:68:24
   |
67 |     def get_safe_sql_filter_conditions(self, db_type: str, username_field: str = "username") -> tuple[str, list[Any]]:
68 |         """获取安全的SQL过滤条件（参数化查询）.
   |                                 ^^
69 |
70 |         Args:
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/accounts_sync/accounts_sync_filters.py:68:30
   |
67 |     def get_safe_sql_filter_conditions(self, db_type: str, username_field: str = "username") -> tuple[str, list[Any]]:
68 |         """获取安全的SQL过滤条件（参数化查询）.
   |                                             ^^
69 |
70 |         Args:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/accounts_sync/accounts_sync_filters.py:72:35
   |
70 |         Args:
71 |             db_type: 数据库类型 (mysql, postgresql, sqlserver, oracle)
72 |             username_field: 用户名字段名，默认为'username'
   |                                         ^^
73 |
74 |         Returns:
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/accounts_sync/accounts_sync_filters.py:81:16
   |
80 |     def _match_pattern(self, text: str, pattern: str) -> bool:
81 |         """模式匹配（支持SQL LIKE语法）.
   |                    ^^
82 |
83 |         Args:
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/accounts_sync/accounts_sync_filters.py:81:29
   |
80 |     def _match_pattern(self, text: str, pattern: str) -> bool:
81 |         """模式匹配（支持SQL LIKE语法）.
   |                                      ^^
82 |
83 |         Args:
   |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/accounts_sync/accounts_sync_filters.py:93:23
   |
91 |         try:
92 |             # 将SQL LIKE模式转换为正则表达式
93 |             # % 匹配任意字符，_ 匹配单个字符
   |                             ^^
94 |             regex_pattern = pattern.replace("%", ".*").replace("_", ".")
95 |             # 添加行首和行尾锚点
   |

G004 Logging statement uses f-string
   --> app/services/accounts_sync/accounts_sync_filters.py:99:30
    |
 97 |             return bool(re.match(regex_pattern, text, re.IGNORECASE))
 98 |         except Exception as exc:
 99 |             logger.exception(f"模式匹配失败: {pattern} -> {text}, 错误: {exc}")
    |                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
100 |             return False
    |
help: Convert to lazy `%` formatting

TRY401 Redundant exception object included in `logging.exception` call
   --> app/services/accounts_sync/accounts_sync_filters.py:99:66
    |
 97 |             return bool(re.match(regex_pattern, text, re.IGNORECASE))
 98 |         except Exception as exc:
 99 |             logger.exception(f"模式匹配失败: {pattern} -> {text}, 错误: {exc}")
    |                                                                          ^^^
100 |             return False
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/accounts_sync_filters.py:106:27
    |
105 |         Args:
106 |             db_type: 数据库类型，None表示获取所有规则
    |                                ^^
107 |
108 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/services/accounts_sync/accounts_sync_service.py:1:10
  |
1 | """账户同步服务，两阶段协调入口。."""
  |                ^^
2 |
3 | from __future__ import annotations
  |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/accounts_sync/accounts_sync_service.py:22:16
   |
20 |     """账户同步服务 - 统一入口。.
21 |
22 |     提供账户同步的统一入口，支持四种同步类型：
   |                           ^^
23 |     - MANUAL_SINGLE: 手动单实例同步（无会话）
24 |     - MANUAL_BATCH: 手动批量同步（有会话）
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/services/accounts_sync/accounts_sync_service.py:22:25
   |
20 |     """账户同步服务 - 统一入口。.
21 |
22 |     提供账户同步的统一入口，支持四种同步类型：
   |                                             ^^
23 |     - MANUAL_SINGLE: 手动单实例同步（无会话）
24 |     - MANUAL_BATCH: 手动批量同步（有会话）
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/accounts_sync/accounts_sync_service.py:23:29
   |
22 |     提供账户同步的统一入口，支持四种同步类型：
23 |     - MANUAL_SINGLE: 手动单实例同步（无会话）
   |                                    ^^
24 |     - MANUAL_BATCH: 手动批量同步（有会话）
25 |     - MANUAL_TASK: 手动任务同步（有会话）
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/accounts_sync/accounts_sync_service.py:23:33
   |
22 |     提供账户同步的统一入口，支持四种同步类型：
23 |     - MANUAL_SINGLE: 手动单实例同步（无会话）
   |                                            ^^
24 |     - MANUAL_BATCH: 手动批量同步（有会话）
25 |     - MANUAL_TASK: 手动任务同步（有会话）
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/accounts_sync/accounts_sync_service.py:24:27
   |
22 |     提供账户同步的统一入口，支持四种同步类型：
23 |     - MANUAL_SINGLE: 手动单实例同步（无会话）
24 |     - MANUAL_BATCH: 手动批量同步（有会话）
   |                                 ^^
25 |     - MANUAL_TASK: 手动任务同步（有会话）
26 |     - SCHEDULED_TASK: 定时任务同步（有会话）
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/accounts_sync/accounts_sync_service.py:24:31
   |
22 |     提供账户同步的统一入口，支持四种同步类型：
23 |     - MANUAL_SINGLE: 手动单实例同步（无会话）
24 |     - MANUAL_BATCH: 手动批量同步（有会话）
   |                                         ^^
25 |     - MANUAL_TASK: 手动任务同步（有会话）
26 |     - SCHEDULED_TASK: 定时任务同步（有会话）
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/accounts_sync/accounts_sync_service.py:25:26
   |
23 |     - MANUAL_SINGLE: 手动单实例同步（无会话）
24 |     - MANUAL_BATCH: 手动批量同步（有会话）
25 |     - MANUAL_TASK: 手动任务同步（有会话）
   |                                ^^
26 |     - SCHEDULED_TASK: 定时任务同步（有会话）
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/accounts_sync/accounts_sync_service.py:25:30
   |
23 |     - MANUAL_SINGLE: 手动单实例同步（无会话）
24 |     - MANUAL_BATCH: 手动批量同步（有会话）
25 |     - MANUAL_TASK: 手动任务同步（有会话）
   |                                        ^^
26 |     - SCHEDULED_TASK: 定时任务同步（有会话）
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/accounts_sync/accounts_sync_service.py:26:29
   |
24 |     - MANUAL_BATCH: 手动批量同步（有会话）
25 |     - MANUAL_TASK: 手动任务同步（有会话）
26 |     - SCHEDULED_TASK: 定时任务同步（有会话）
   |                                   ^^
27 |
28 |     Attributes:
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/accounts_sync/accounts_sync_service.py:26:33
   |
24 |     - MANUAL_BATCH: 手动批量同步（有会话）
25 |     - MANUAL_TASK: 手动任务同步（有会话）
26 |     - SCHEDULED_TASK: 定时任务同步（有会话）
   |                                           ^^
27 |
28 |     Attributes:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/accounts_sync/accounts_sync_service.py:47:24
   |
45 |         """统一账户同步入口。.
46 |
47 |         根据同步类型执行相应的同步流程，支持单实例同步和批量同步。
   |                                       ^^
48 |
49 |         Args:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/accounts_sync/accounts_sync_service.py:51:30
   |
49 |         Args:
50 |             instance: 数据库实例对象。
51 |             sync_type: 同步操作方式，可选值：'manual_single'、'manual_batch'、
   |                                    ^^
52 |                 'manual_task'、'scheduled_task'，默认为 'manual_single'。
53 |             session_id: 同步会话 ID，批量同步时需要提供。
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/services/accounts_sync/accounts_sync_service.py:51:34
   |
49 |         Args:
50 |             instance: 数据库实例对象。
51 |             sync_type: 同步操作方式，可选值：'manual_single'、'manual_batch'、
   |                                            ^^
52 |                 'manual_task'、'scheduled_task'，默认为 'manual_single'。
53 |             session_id: 同步会话 ID，批量同步时需要提供。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/accounts_sync/accounts_sync_service.py:52:47
   |
50 |             instance: 数据库实例对象。
51 |             sync_type: 同步操作方式，可选值：'manual_single'、'manual_batch'、
52 |                 'manual_task'、'scheduled_task'，默认为 'manual_single'。
   |                                                ^^
53 |             session_id: 同步会话 ID，批量同步时需要提供。
54 |             created_by: 创建者用户 ID，手动同步时需要提供。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/accounts_sync/accounts_sync_service.py:53:32
   |
51 |             sync_type: 同步操作方式，可选值：'manual_single'、'manual_batch'、
52 |                 'manual_task'、'scheduled_task'，默认为 'manual_single'。
53 |             session_id: 同步会话 ID，批量同步时需要提供。
   |                                    ^^
54 |             created_by: 创建者用户 ID，手动同步时需要提供。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/accounts_sync/accounts_sync_service.py:54:33
   |
52 |                 'manual_task'、'scheduled_task'，默认为 'manual_single'。
53 |             session_id: 同步会话 ID，批量同步时需要提供。
54 |             created_by: 创建者用户 ID，手动同步时需要提供。
   |                                      ^^
55 |
56 |         Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/accounts_sync/accounts_sync_service.py:57:19
   |
56 |         Returns:
57 |             同步结果字典，格式如下：
   |                         ^^
58 |             {
59 |                 'success': True,
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/services/accounts_sync/accounts_sync_service.py:57:24
   |
56 |         Returns:
57 |             同步结果字典，格式如下：
   |                                   ^^
58 |             {
59 |                 'success': True,
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/services/accounts_sync/accounts_sync_service.py:67:18
   |
65 |                 'details': {...}  # 详细的同步信息
66 |             }
67 |             失败时返回：
   |                       ^^
68 |             {
69 |                 'success': False,
   |

E501 Line too long (144 > 120)
  --> app/services/accounts_sync/accounts_sync_service.py:95:121
   |
93 | …
94 | …
95 | … SyncOperationType.MANUAL_TASK.value, SyncOperationType.SCHEDULED_TASK.value]:
   |                                                        ^^^^^^^^^^^^^^^^^^^^^^^^
96 | …
97 | …
   |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/accounts_sync_service.py:101:23
    |
 99 |                 # 批量同步操作方式需要会话管理
100 |                 return self._sync_with_session(instance, sync_type, created_by)
101 |             # 未知同步操作方式，默认使用单实例同步
    |                               ^^
102 |             return self._sync_single_instance(instance)
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/accounts_sync_service.py:105:21
    |
104 |         except Exception as e:
105 |             # 分类异常处理，提供更详细的错误信息
    |                           ^^
106 |             error_type = type(e).__name__
107 |             if "JSON" in error_type or "serialization" in str(e).lower():
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/accounts_sync_service.py:140:22
    |
138 |         """单实例同步 - 无会话管理。.
139 |
140 |         用于实例页面的直接同步调用，不创建持久化会话记录。
    |                                   ^^
141 |         使用临时会话 ID 进行同步，完成后更新实例的最后连接时间。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/accounts_sync_service.py:141:23
    |
140 |         用于实例页面的直接同步调用，不创建持久化会话记录。
141 |         使用临时会话 ID 进行同步，完成后更新实例的最后连接时间。
    |                                 ^^
142 |
143 |         Args:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/accounts_sync_service.py:147:19
    |
146 |         Returns:
147 |             同步结果字典，格式与 sync_accounts 方法相同。
    |                         ^^
148 |
149 |         Raises:
    |

TRY300 Consider moving this statement to an `else` block
   --> app/services/accounts_sync/accounts_sync_service.py:167:13
    |
165 |                 result=result,
166 |             )
167 |             return result
    |             ^^^^^^^^^^^^^
168 |         except Exception as exc:
169 |             self.sync_logger.error(
    |

G201 Logging `.exception(...)` should be used instead of `.error(..., exc_info=True)`
   --> app/services/accounts_sync/accounts_sync_service.py:169:30
    |
167 |             return result
168 |         except Exception as exc:
169 |             self.sync_logger.error(
    |                              ^^^^^
170 |                 "单实例同步失败",
171 |                 module="accounts_sync",
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/accounts_sync_service.py:192:17
    |
190 |         """带会话管理的同步 - 用于批量同步。.
191 |
192 |         创建新的同步会话，执行同步并记录结果。会话记录会持久化到数据库，
    |                         ^^
193 |         用于追踪批量同步的进度和结果。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/accounts_sync_service.py:192:40
    |
190 |         """带会话管理的同步 - 用于批量同步。.
191 |
192 |         创建新的同步会话，执行同步并记录结果。会话记录会持久化到数据库，
    |                                                                       ^^
193 |         用于追踪批量同步的进度和结果。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/accounts_sync_service.py:197:30
    |
195 |         Args:
196 |             instance: 数据库实例对象。
197 |             sync_type: 同步操作方式，如 'manual_batch'、'scheduled_task'。
    |                                    ^^
198 |             created_by: 创建者用户 ID，手动同步时必须提供。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/accounts_sync_service.py:198:33
    |
196 |             instance: 数据库实例对象。
197 |             sync_type: 同步操作方式，如 'manual_batch'、'scheduled_task'。
198 |             created_by: 创建者用户 ID，手动同步时必须提供。
    |                                      ^^
199 |
200 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/accounts_sync_service.py:201:19
    |
200 |         Returns:
201 |             同步结果字典，格式与 sync_accounts 方法相同。
    |                         ^^
202 |
203 |         Raises:
    |

TRY300 Consider moving this statement to an `else` block
   --> app/services/accounts_sync/accounts_sync_service.py:247:13
    |
245 |                 )
246 |
247 |             return result
    |             ^^^^^^^^^^^^^
248 |
249 |         except Exception as e:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/accounts_sync_service.py:278:25
    |
276 |         """使用现有会话 ID 进行同步。.
277 |
278 |         在已有会话的上下文中执行同步操作，用于批量同步场景中的单个实例同步。
    |                                         ^^
279 |
280 |         Args:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/accounts_sync_service.py:282:34
    |
280 |         Args:
281 |             instance: 数据库实例对象。
282 |             session_id: 已存在的会话 ID，用于关联同步记录。
    |                                        ^^
283 |             sync_type: 同步操作方式，可选，用于日志记录。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/accounts_sync_service.py:283:30
    |
281 |             instance: 数据库实例对象。
282 |             session_id: 已存在的会话 ID，用于关联同步记录。
283 |             sync_type: 同步操作方式，可选，用于日志记录。
    |                                    ^^
284 |
285 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/accounts_sync_service.py:283:33
    |
281 |             instance: 数据库实例对象。
282 |             session_id: 已存在的会话 ID，用于关联同步记录。
283 |             sync_type: 同步操作方式，可选，用于日志记录。
    |                                          ^^
284 |
285 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/accounts_sync_service.py:286:19
    |
285 |         Returns:
286 |             同步结果字典，格式与 sync_accounts 方法相同。
    |                         ^^
287 |
288 |         Raises:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/accounts_sync_service.py:289:36
    |
288 |         Raises:
289 |             Exception: 同步过程中的异常会被捕获，数据库会回滚。
    |                                                ^^
290 |
291 |         """
    |

TRY300 Consider moving this statement to an `else` block
   --> app/services/accounts_sync/accounts_sync_service.py:305:13
    |
303 |                 result=result,
304 |             )
305 |             return result
    |             ^^^^^^^^^^^^^
306 |         except Exception as exc:
307 |             db.session.rollback()
    |

G201 Logging `.exception(...)` should be used instead of `.error(..., exc_info=True)`
   --> app/services/accounts_sync/accounts_sync_service.py:308:30
    |
306 |         except Exception as exc:
307 |             db.session.rollback()
308 |             self.sync_logger.error(
    |                              ^^^^^
309 |                 "现有会话同步失败",
310 |                 module="accounts_sync",
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/accounts_sync_service.py:331:23
    |
329 |         """构建同步结果字典。.
330 |
331 |         从同步汇总信息中提取关键指标，构建统一的结果格式。
    |                                     ^^
332 |
333 |         Args:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/accounts_sync_service.py:334:28
    |
333 |         Args:
334 |             summary: 同步汇总信息，包含 inventory 和 collection 两部分。
    |                                  ^^
335 |
336 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/accounts_sync_service.py:388:30
    |
386 |         Args:
387 |             instance: 数据库实例对象。
388 |             session_id: 会话 ID，可选。
    |                                ^^
389 |             sync_type: 同步操作方式。
390 |             result: 同步结果字典。
    |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
 --> app/services/accounts_sync/adapters/__init__.py:5:5
  |
3 | 提供各种数据库类型的账户同步适配器实现。
4 |
5 | 主要组件：
  |         ^^
6 | - BaseAccountAdapter: 账户同步适配器基类
7 | - MySQLAccountAdapter: MySQL 账户同步适配器
  |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/services/accounts_sync/adapters/base_adapter.py:1:15
  |
1 | """账户同步适配器基础定义，提供统一的抓取/归一化接口。."""
  |                          ^^
2 |
3 | from __future__ import annotations
  |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/accounts_sync/adapters/base_adapter.py:15:17
   |
14 | class BaseAccountAdapter(ABC):
15 |     """账户同步适配器基类，负责抽象远端账户数据抓取。."""
   |                          ^^
16 |
17 |     def fetch_remote_accounts(self, instance: Instance, connection: Any) -> list[dict[str, Any]]:
   |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `connection`
  --> app/services/accounts_sync/adapters/base_adapter.py:17:69
   |
15 |     """账户同步适配器基类，负责抽象远端账户数据抓取。."""
16 |
17 |     def fetch_remote_accounts(self, instance: Instance, connection: Any) -> list[dict[str, Any]]:
   |                                                                     ^^^
18 |         """拉取远端账户信息。.
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/accounts_sync/adapters/base_adapter.py:25:44
   |
24 |         Returns:
25 |             list[dict[str, Any]]: 已标准化的账户列表，包含以下字段：
   |                                                     ^^
26 |                 - username: 唯一标识（可含主机）
27 |                 - display_name: 可选，展示用
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/services/accounts_sync/adapters/base_adapter.py:25:51
   |
24 |         Returns:
25 |             list[dict[str, Any]]: 已标准化的账户列表，包含以下字段：
   |                                                                   ^^
26 |                 - username: 唯一标识（可含主机）
27 |                 - display_name: 可选，展示用
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/accounts_sync/adapters/base_adapter.py:26:33
   |
24 |         Returns:
25 |             list[dict[str, Any]]: 已标准化的账户列表，包含以下字段：
26 |                 - username: 唯一标识（可含主机）
   |                                     ^^
27 |                 - display_name: 可选，展示用
28 |                 - is_superuser: 是否超级用户
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/accounts_sync/adapters/base_adapter.py:26:38
   |
24 |         Returns:
25 |             list[dict[str, Any]]: 已标准化的账户列表，包含以下字段：
26 |                 - username: 唯一标识（可含主机）
   |                                               ^^
27 |                 - display_name: 可选，展示用
28 |                 - is_superuser: 是否超级用户
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/accounts_sync/adapters/base_adapter.py:27:35
   |
25 |             list[dict[str, Any]]: 已标准化的账户列表，包含以下字段：
26 |                 - username: 唯一标识（可含主机）
27 |                 - display_name: 可选，展示用
   |                                     ^^
28 |                 - is_superuser: 是否超级用户
29 |                 - is_active: 是否活跃
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/accounts_sync/adapters/base_adapter.py:30:35
   |
28 |                 - is_superuser: 是否超级用户
29 |                 - is_active: 是否活跃
30 |                 - attributes: 附加信息（锁定状态、主机等）
   |                                       ^^
31 |                 - permissions: 标准化权限快照
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/accounts_sync/adapters/base_adapter.py:30:44
   |
28 |                 - is_superuser: 是否超级用户
29 |                 - is_active: 是否活跃
30 |                 - attributes: 附加信息（锁定状态、主机等）
   |                                                         ^^
31 |                 - permissions: 标准化权限快照
   |

PERF401 Use a list comprehension to create a transformed list
  --> app/services/accounts_sync/adapters/base_adapter.py:37:13
   |
35 |         normalized: list[dict[str, Any]] = []
36 |         for account in raw_accounts:
37 |             normalized.append(self._normalize_account(instance, account))
   |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
38 |         return normalized
   |
help: Replace for loop with list comprehension

ARG002 Unused method argument: `instance`
  --> app/services/accounts_sync/adapters/base_adapter.py:42:9
   |
40 |     def enrich_permissions(
41 |         self,
42 |         instance: Instance,
   |         ^^^^^^^^
43 |         connection: Any,
44 |         accounts: list[dict[str, Any]],
   |

ARG002 Unused method argument: `connection`
  --> app/services/accounts_sync/adapters/base_adapter.py:43:9
   |
41 |         self,
42 |         instance: Instance,
43 |         connection: Any,
   |         ^^^^^^^^^^
44 |         accounts: list[dict[str, Any]],
45 |         *,
   |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `connection`
  --> app/services/accounts_sync/adapters/base_adapter.py:43:21
   |
41 |         self,
42 |         instance: Instance,
43 |         connection: Any,
   |                     ^^^
44 |         accounts: list[dict[str, Any]],
45 |         *,
   |

ARG002 Unused method argument: `usernames`
  --> app/services/accounts_sync/adapters/base_adapter.py:46:9
   |
44 |         accounts: list[dict[str, Any]],
45 |         *,
46 |         usernames: Sequence[str] | None = None,
   |         ^^^^^^^^^
47 |     ) -> list[dict[str, Any]]:
48 |         """为账号列表补全权限信息。.
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/accounts_sync/adapters/base_adapter.py:54:26
   |
52 |             connection: 数据库连接。
53 |             accounts: 需要补全权限的账户列表。
54 |             usernames: 可选，仅对指定用户名执行补全。
   |                            ^^
55 |
56 |         Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/accounts_sync/adapters/base_adapter.py:59:20
   |
57 |             list[dict[str, Any]]: 包含权限信息的账户列表。
58 |
59 |         默认实现直接返回原列表，适用于在 ``_fetch_raw_accounts`` 阶段已经填充
   |                               ^^
60 |         ``permissions`` 的适配器。若需要按需加载权限（例如 SQL Server），请在具体
61 |         适配器中重写该方法。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/accounts_sync/adapters/base_adapter.py:60:39
   |
59 |         默认实现直接返回原列表，适用于在 ``_fetch_raw_accounts`` 阶段已经填充
60 |         ``permissions`` 的适配器。若需要按需加载权限（例如 SQL Server），请在具体
   |                                                     ^^
61 |         适配器中重写该方法。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/accounts_sync/adapters/base_adapter.py:60:53
   |
59 |         默认实现直接返回原列表，适用于在 ``_fetch_raw_accounts`` 阶段已经填充
60 |         ``permissions`` 的适配器。若需要按需加载权限（例如 SQL Server），请在具体
   |                                                                      ^^
61 |         适配器中重写该方法。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/accounts_sync/adapters/base_adapter.py:60:54
   |
59 |         默认实现直接返回原列表，适用于在 ``_fetch_raw_accounts`` 阶段已经填充
60 |         ``permissions`` 的适配器。若需要按需加载权限（例如 SQL Server），请在具体
   |                                                                        ^^
61 |         适配器中重写该方法。
   |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `connection`
  --> app/services/accounts_sync/adapters/base_adapter.py:67:67
   |
66 |     @abstractmethod
67 |     def _fetch_raw_accounts(self, instance: Instance, connection: Any) -> list[dict[str, Any]]:
   |                                                                   ^^^
68 |         """具体数据库实现负责查询账户列表。.
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/accounts_sync/adapters/base_adapter.py:75:41
   |
74 |         Returns:
75 |             list[dict[str, Any]]: 原始账户数据（尚未标准化）。
   |                                               ^^
76 |
77 |         """
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/accounts_sync/adapters/base_adapter.py:75:47
   |
74 |         Returns:
75 |             list[dict[str, Any]]: 原始账户数据（尚未标准化）。
   |                                                           ^^
76 |
77 |         """
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/accounts_sync/adapters/factory.py:32:23
   |
31 |     Args:
32 |         db_type: 数据库类型（mysql、postgresql、sqlserver、oracle）。
   |                            ^^
33 |
34 |     Returns:
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/accounts_sync/adapters/factory.py:32:57
   |
31 |     Args:
32 |         db_type: 数据库类型（mysql、postgresql、sqlserver、oracle）。
   |                                                                  ^^
33 |
34 |     Returns:
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
 --> app/services/accounts_sync/adapters/mysql_adapter.py:1:16
  |
1 | """MySQL账户同步适配器（两阶段版）."""
  |                       ^^
2 |
3 | from __future__ import annotations
  |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
 --> app/services/accounts_sync/adapters/mysql_adapter.py:1:21
  |
1 | """MySQL账户同步适配器（两阶段版）."""
  |                                 ^^
2 |
3 | from __future__ import annotations
  |

D107 Missing docstring in `__init__`
  --> app/services/accounts_sync/adapters/mysql_adapter.py:37:9
   |
35 |     """
36 |
37 |     def __init__(self) -> None:
   |         ^^^^^^^^
38 |         self.logger = get_sync_logger()
39 |         self.filter_manager = DatabaseFilterManager()
   |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `connection`
  --> app/services/accounts_sync/adapters/mysql_adapter.py:44:67
   |
42 |     # BaseAccountAdapter 实现
43 |     # ------------------------------------------------------------------
44 |     def _fetch_raw_accounts(self, instance: Instance, connection: Any) -> list[dict[str, Any]]:
   |                                                                   ^^^
45 |         """拉取 MySQL 原始账户信息。.
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/accounts_sync/adapters/mysql_adapter.py:47:32
   |
45 |         """拉取 MySQL 原始账户信息。.
46 |
47 |         从 mysql.user 表中查询账户基本信息，包括用户名、主机、超级用户标志等。
   |                                           ^^
48 |
49 |         Args:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/accounts_sync/adapters/mysql_adapter.py:54:21
   |
53 |         Returns:
54 |             原始账户信息列表，每个元素包含：
   |                             ^^
55 |             - username: 唯一用户名（格式：user@host）
56 |             - original_username: 原始用户名
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/services/accounts_sync/adapters/mysql_adapter.py:54:28
   |
53 |         Returns:
54 |             原始账户信息列表，每个元素包含：
   |                                           ^^
55 |             - username: 唯一用户名（格式：user@host）
56 |             - original_username: 原始用户名
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/accounts_sync/adapters/mysql_adapter.py:55:30
   |
53 |         Returns:
54 |             原始账户信息列表，每个元素包含：
55 |             - username: 唯一用户名（格式：user@host）
   |                                   ^^
56 |             - original_username: 原始用户名
57 |             - host: 主机名
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/services/accounts_sync/adapters/mysql_adapter.py:55:33
   |
53 |         Returns:
54 |             原始账户信息列表，每个元素包含：
55 |             - username: 唯一用户名（格式：user@host）
   |                                         ^^
56 |             - original_username: 原始用户名
57 |             - host: 主机名
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/accounts_sync/adapters/mysql_adapter.py:55:43
   |
53 |         Returns:
54 |             原始账户信息列表，每个元素包含：
55 |             - username: 唯一用户名（格式：user@host）
   |                                                    ^^
56 |             - original_username: 原始用户名
57 |             - host: 主机名
   |

S608 Possible SQL injection vector through string-based query construction
  --> app/services/accounts_sync/adapters/mysql_adapter.py:78:17
   |
76 |               where_clause, params = self._build_filter_conditions()
77 |               user_sql = (
78 | /                 "SELECT "
79 | |                 "    User as username, "
80 | |                 "    Host as host, "
81 | |                 "    Super_priv as is_superuser, "
82 | |                 "    account_locked as is_locked, "
83 | |                 "    Grant_priv as can_grant, "
84 | |                 "    plugin as plugin, "
85 | |                 "    password_last_changed as password_last_changed "
86 | |                 "FROM mysql.user "
87 | |                 f"WHERE User != '' AND {where_clause} "
88 | |                 "ORDER BY User, Host"
   | |_____________________________________^
89 |               )
90 |               users = connection.execute_query(user_sql, params)
   |

TRY300 Consider moving this statement to an `else` block
   --> app/services/accounts_sync/adapters/mysql_adapter.py:124:13
    |
122 |                 account_count=len(accounts),
123 |             )
124 |             return accounts
    |             ^^^^^^^^^^^^^^^
125 |         except Exception as exc:
126 |             self.logger.error(
    |

G201 Logging `.exception(...)` should be used instead of `.error(..., exc_info=True)`
   --> app/services/accounts_sync/adapters/mysql_adapter.py:126:25
    |
124 |             return accounts
125 |         except Exception as exc:
126 |             self.logger.error(
    |                         ^^^^^
127 |                 "fetch_mysql_accounts_failed",
128 |                 module="mysql_account_adapter",
    |

ARG002 Unused method argument: `instance`
   --> app/services/accounts_sync/adapters/mysql_adapter.py:135:34
    |
133 |             return []
134 |
135 |     def _normalize_account(self, instance: Instance, account: dict[str, Any]) -> dict[str, Any]:
    |                                  ^^^^^^^^
136 |         """规范化 MySQL 账户信息。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/adapters/mysql_adapter.py:145:24
    |
144 |         Returns:
145 |             规范化后的账户信息字典，包含：
    |                                   ^^
146 |             - username: 唯一用户名
147 |             - display_name: 显示名称
    |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/services/accounts_sync/adapters/mysql_adapter.py:145:27
    |
144 |         Returns:
145 |             规范化后的账户信息字典，包含：
    |                                         ^^
146 |             - username: 唯一用户名
147 |             - display_name: 显示名称
    |

E501 Line too long (136 > 120)
   --> app/services/accounts_sync/adapters/mysql_adapter.py:189:121
    |
187 | …ysql")
188 | …
189 | …_rules.get("exclude_users", []), filter_rules.get("exclude_patterns", []))
    |                                                            ^^^^^^^^^^^^^^^^
190 | …
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `connection`
   --> app/services/accounts_sync/adapters/mysql_adapter.py:192:49
    |
190 |         return builder.build_where_clause()
191 |
192 |     def _get_user_permissions(self, connection: Any, username: str, host: str) -> dict[str, Any]:
    |                                                 ^^^
193 |         """获取 MySQL 用户权限详情。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/adapters/mysql_adapter.py:203:19
    |
202 |         Returns:
203 |             权限信息字典，包含：
    |                         ^^
204 |             - global_privileges: 全局权限列表
205 |             - database_privileges: 数据库级权限字典
    |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/services/accounts_sync/adapters/mysql_adapter.py:203:22
    |
202 |         Returns:
203 |             权限信息字典，包含：
    |                               ^^
204 |             - global_privileges: 全局权限列表
205 |             - database_privileges: 数据库级权限字典
    |

TRY300 Consider moving this statement to an `else` block
   --> app/services/accounts_sync/adapters/mysql_adapter.py:244:13
    |
242 |                       },
243 |                   )
244 | /             return {
245 | |                 "global_privileges": global_privileges,
246 | |                 "database_privileges": database_privileges,
247 | |                 "type_specific": type_specific,
248 | |             }
    | |_____________^
249 |           except Exception as exc:
250 |               self.logger.error(
    |

G201 Logging `.exception(...)` should be used instead of `.error(..., exc_info=True)`
   --> app/services/accounts_sync/adapters/mysql_adapter.py:250:25
    |
248 |             }
249 |         except Exception as exc:
250 |             self.logger.error(
    |                         ^^^^^
251 |                 "fetch_mysql_permissions_failed",
252 |                 module="mysql_account_adapter",
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `connection`
   --> app/services/accounts_sync/adapters/mysql_adapter.py:267:21
    |
265 |         self,
266 |         instance: Instance,
267 |         connection: Any,
    |                     ^^^
268 |         accounts: list[dict[str, Any]],
269 |         *,
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/adapters/mysql_adapter.py:274:23
    |
272 |         """丰富 MySQL 账户的权限信息。.
273 |
274 |         为指定账户查询详细的权限信息，包括全局权限和数据库级权限。
    |                                     ^^
275 |
276 |         Args:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/adapters/mysql_adapter.py:280:43
    |
278 |             connection: MySQL 数据库连接对象。
279 |             accounts: 账户信息列表。
280 |             usernames: 可选的目标用户名列表。如果为 None，处理所有账户。
    |                                                         ^^
281 |
282 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/adapters/mysql_adapter.py:283:23
    |
282 |         Returns:
283 |             丰富后的账户信息列表，每个账户的 permissions 字段包含详细权限。
    |                                 ^^
284 |
285 |         Example:
    |

G201 Logging `.exception(...)` should be used instead of `.error(..., exc_info=True)`
   --> app/services/accounts_sync/adapters/mysql_adapter.py:323:29
    |
321 |                 )
322 |             except Exception as exc:
323 |                 self.logger.error(
    |                             ^^^^^
324 |                     "fetch_mysql_permissions_failed",
325 |                     module="mysql_account_adapter",
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/adapters/mysql_adapter.py:350:26
    |
348 |         """解析 MySQL GRANT 语句。.
349 |
350 |         从 GRANT 语句中提取权限信息，并分类为全局权限或数据库级权限。
    |                                    ^^
351 |
352 |         Args:
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/services/accounts_sync/adapters/mysql_adapter.py:354:38
    |
352 |         Args:
353 |             grant_statement: GRANT 语句字符串。
354 |             global_privileges: 全局权限列表（会被修改）。
    |                                            ^^
355 |             database_privileges: 数据库级权限字典（会被修改）。
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/services/accounts_sync/adapters/mysql_adapter.py:354:43
    |
352 |         Args:
353 |             grant_statement: GRANT 语句字符串。
354 |             global_privileges: 全局权限列表（会被修改）。
    |                                                      ^^
355 |             database_privileges: 数据库级权限字典（会被修改）。
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/services/accounts_sync/adapters/mysql_adapter.py:355:42
    |
353 |             grant_statement: GRANT 语句字符串。
354 |             global_privileges: 全局权限列表（会被修改）。
355 |             database_privileges: 数据库级权限字典（会被修改）。
    |                                                  ^^
356 |
357 |         Returns:
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/services/accounts_sync/adapters/mysql_adapter.py:355:47
    |
353 |             grant_statement: GRANT 语句字符串。
354 |             global_privileges: 全局权限列表（会被修改）。
355 |             database_privileges: 数据库级权限字典（会被修改）。
    |                                                            ^^
356 |
357 |         Returns:
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/services/accounts_sync/adapters/mysql_adapter.py:395:16
    |
393 |                     existing.append("GRANT OPTION")
394 |                 return
395 |         except Exception as exc:
    |                ^^^^^^^^^
396 |             self.logger.warning(
397 |                 "mysql_parse_grant_failed",
    |

FBT001 Boolean-typed positional argument in function definition
   --> app/services/accounts_sync/adapters/mysql_adapter.py:420:38
    |
418 |         return [priv.strip().upper() for priv in privileges_part.split(",") if priv.strip()]
419 |
420 |     def _expand_all_privileges(self, is_global: bool) -> list[str]:
    |                                      ^^^^^^^^^
421 |         """返回 ALL PRIVILEGES 展开的权限列表。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/adapters/mysql_adapter.py:424:35
    |
423 |         Args:
424 |             is_global: True 表示全局权限，False 表示数据库级权限。
    |                                         ^^
425 |
426 |         Returns:
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
 --> app/services/accounts_sync/adapters/oracle_adapter.py:1:18
  |
1 | """Oracle 账户同步适配器（两阶段版）。."""
  |                         ^^
2 |
3 | from __future__ import annotations
  |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
 --> app/services/accounts_sync/adapters/oracle_adapter.py:1:23
  |
1 | """Oracle 账户同步适配器（两阶段版）。."""
  |                                   ^^
2 |
3 | from __future__ import annotations
  |

D107 Missing docstring in `__init__`
  --> app/services/accounts_sync/adapters/oracle_adapter.py:35:9
   |
33 |     """
34 |
35 |     def __init__(self) -> None:
   |         ^^^^^^^^
36 |         self.logger = get_sync_logger()
37 |         self.filter_manager = DatabaseFilterManager()
   |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `connection`
  --> app/services/accounts_sync/adapters/oracle_adapter.py:39:67
   |
37 |         self.filter_manager = DatabaseFilterManager()
38 |
39 |     def _fetch_raw_accounts(self, instance: Instance, connection: Any) -> list[dict[str, Any]]:
   |                                                                   ^^^
40 |         """拉取 Oracle 原始账户信息。.
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/accounts_sync/adapters/oracle_adapter.py:49:21
   |
48 |         Returns:
49 |             原始账户信息列表，每个元素包含用户名、账户状态、默认表空间等。
   |                             ^^
50 |
51 |         """
   |

TRY300 Consider moving this statement to an `else` block
  --> app/services/accounts_sync/adapters/oracle_adapter.py:78:13
   |
76 |                 account_count=len(accounts),
77 |             )
78 |             return accounts
   |             ^^^^^^^^^^^^^^^
79 |         except Exception as exc:
80 |             self.logger.error(
   |

G201 Logging `.exception(...)` should be used instead of `.error(..., exc_info=True)`
  --> app/services/accounts_sync/adapters/oracle_adapter.py:80:25
   |
78 |             return accounts
79 |         except Exception as exc:
80 |             self.logger.error(
   |                         ^^^^^
81 |                 "fetch_oracle_accounts_failed",
82 |                 module="oracle_account_adapter",
   |

ARG002 Unused method argument: `instance`
  --> app/services/accounts_sync/adapters/oracle_adapter.py:89:34
   |
87 |             return []
88 |
89 |     def _normalize_account(self, instance: Instance, account: dict[str, Any]) -> dict[str, Any]:
   |                                  ^^^^^^^^
90 |         """规范化 Oracle 账户信息。.
   |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `connection`
   --> app/services/accounts_sync/adapters/oracle_adapter.py:124:40
    |
123 |     # ------------------------------------------------------------------
124 |     def _fetch_users(self, connection: Any) -> list[dict[str, Any]]:
    |                                        ^^^
125 |         """读取 Oracle 用户列表。.
    |

S608 Possible SQL injection vector through string-based query construction
   --> app/services/accounts_sync/adapters/oracle_adapter.py:139:13
    |
138 |           sql = (
139 | /             "SELECT username, account_status, default_tablespace "
140 | |             "FROM dba_users "
141 | |             f"WHERE username NOT IN ({placeholders})"
    | |_____________________________________________________^
142 |           )
143 |           params = {f":{i+1}": user for i, user in enumerate(exclude_users)}
    |

PERF401 Use a list comprehension to create a transformed list
   --> app/services/accounts_sync/adapters/oracle_adapter.py:147:13
    |
145 |           results: list[dict[str, Any]] = []
146 |           for row in rows:
147 | /             results.append(
148 | |                 {
149 | |                     "username": row[0],
150 | |                     "account_status": row[1],
151 | |                     "default_tablespace": row[2],
152 | |                     "is_dba": row[0] == "SYS",
153 | |                 },
154 | |             )
    | |_____________^
155 |           return results
    |
help: Replace for loop with list comprehension

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `connection`
   --> app/services/accounts_sync/adapters/oracle_adapter.py:157:49
    |
155 |         return results
156 |
157 |     def _get_user_permissions(self, connection: Any, username: str) -> dict[str, Any]:
    |                                                 ^^^
158 |         """查询单个用户的权限快照。.
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `connection`
   --> app/services/accounts_sync/adapters/oracle_adapter.py:178:21
    |
176 |         self,
177 |         instance: Instance,
178 |         connection: Any,
    |                     ^^^
179 |         accounts: list[dict[str, Any]],
180 |         *,
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/adapters/oracle_adapter.py:185:23
    |
183 |         """丰富 Oracle 账户的权限信息。.
184 |
185 |         为指定账户查询详细的权限信息，包括角色、系统权限、表空间配额等。
    |                                     ^^
186 |
187 |         Args:
    |

G201 Logging `.exception(...)` should be used instead of `.error(..., exc_info=True)`
   --> app/services/accounts_sync/adapters/oracle_adapter.py:215:29
    |
213 |                     account["is_locked"] = account_status.upper() != "OPEN"
214 |             except Exception as exc:
215 |                 self.logger.error(
    |                             ^^^^^
216 |                     "fetch_oracle_permissions_failed",
217 |                     module="oracle_account_adapter",
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `connection`
   --> app/services/accounts_sync/adapters/oracle_adapter.py:233:38
    |
231 |         return accounts
232 |
233 |     def _get_roles(self, connection: Any, username: str) -> list[str]:
    |                                      ^^^
234 |         """查询用户拥有的角色。.
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `connection`
   --> app/services/accounts_sync/adapters/oracle_adapter.py:248:50
    |
246 |         return [row[0] for row in rows if row and row[0]]
247 |
248 |     def _get_system_privileges(self, connection: Any, username: str) -> list[str]:
    |                                                  ^^^
249 |         """查询用户拥有的系统权限。.
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `connection`
   --> app/services/accounts_sync/adapters/oracle_adapter.py:263:54
    |
261 |         return [row[0] for row in rows if row and row[0]]
262 |
263 |     def _get_tablespace_privileges(self, connection: Any, username: str) -> dict[str, dict[str, Any]]:
    |                                                      ^^^
264 |         """查询用户的表空间配额信息。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/adapters/oracle_adapter.py:274:20
    |
273 |         Returns:
274 |             表空间配额字典，键为表空间名称，值包含配额和已使用空间。
    |                           ^^
275 |
276 |         """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/adapters/oracle_adapter.py:274:28
    |
273 |         Returns:
274 |             表空间配额字典，键为表空间名称，值包含配额和已使用空间。
    |                                           ^^
275 |
276 |         """
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
 --> app/services/accounts_sync/adapters/postgresql_adapter.py:1:22
  |
1 | """PostgreSQL 账户同步适配器（两阶段版）。."""
  |                             ^^
2 |
3 | from __future__ import annotations
  |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
 --> app/services/accounts_sync/adapters/postgresql_adapter.py:1:27
  |
1 | """PostgreSQL 账户同步适配器（两阶段版）。."""
  |                                       ^^
2 |
3 | from __future__ import annotations
  |

D107 Missing docstring in `__init__`
  --> app/services/accounts_sync/adapters/postgresql_adapter.py:36:9
   |
34 |     """
35 |
36 |     def __init__(self) -> None:
   |         ^^^^^^^^
37 |         self.logger = get_sync_logger()
38 |         self.filter_manager = DatabaseFilterManager()
   |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `connection`
  --> app/services/accounts_sync/adapters/postgresql_adapter.py:40:67
   |
38 |         self.filter_manager = DatabaseFilterManager()
39 |
40 |     def _fetch_raw_accounts(self, instance: Instance, connection: Any) -> list[dict[str, Any]]:
   |                                                                   ^^^
41 |         """拉取 PostgreSQL 原始账户信息。.
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/accounts_sync/adapters/postgresql_adapter.py:50:21
   |
49 |         Returns:
50 |             原始账户信息列表，每个元素包含用户名、超级用户标志、角色属性等。
   |                             ^^
51 |
52 |         """
   |

S608 Possible SQL injection vector through string-based query construction
  --> app/services/accounts_sync/adapters/postgresql_adapter.py:56:17
   |
54 |               where_clause, params = self._build_filter_conditions()
55 |               roles_sql = (
56 | /                 "SELECT "
57 | |                 "    rolname as username, "
58 | |                 "    rolsuper as is_superuser, "
59 | |                 "    rolcreaterole as can_create_role, "
60 | |                 "    rolcreatedb as can_create_db, "
61 | |                 "    rolreplication as can_replicate, "
62 | |                 "    rolbypassrls as can_bypass_rls, "
63 | |                 "    rolcanlogin as can_login, "
64 | |                 "    rolinherit as can_inherit, "
65 | |                 "    CASE "
66 | |                 "        WHEN rolvaliduntil = 'infinity'::timestamp THEN NULL "
67 | |                 "        WHEN rolvaliduntil = '-infinity'::timestamp THEN NULL "
68 | |                 "        ELSE rolvaliduntil "
69 | |                 "    END as valid_until "
70 | |                 "FROM pg_roles "
71 | |                 f"WHERE {where_clause} "
72 | |                 "ORDER BY rolname"
   | |__________________________________^
73 |               )
74 |               rows = connection.execute_query(roles_sql, params)
   |

TRY300 Consider moving this statement to an `else` block
   --> app/services/accounts_sync/adapters/postgresql_adapter.py:124:13
    |
122 |                 account_count=len(accounts),
123 |             )
124 |             return accounts
    |             ^^^^^^^^^^^^^^^
125 |         except Exception as exc:
126 |             self.logger.error(
    |

G201 Logging `.exception(...)` should be used instead of `.error(..., exc_info=True)`
   --> app/services/accounts_sync/adapters/postgresql_adapter.py:126:25
    |
124 |             return accounts
125 |         except Exception as exc:
126 |             self.logger.error(
    |                         ^^^^^
127 |                 "fetch_postgresql_accounts_failed",
128 |                 module="postgresql_account_adapter",
    |

ARG002 Unused method argument: `instance`
   --> app/services/accounts_sync/adapters/postgresql_adapter.py:135:34
    |
133 |             return []
134 |
135 |     def _normalize_account(self, instance: Instance, account: dict[str, Any]) -> dict[str, Any]:
    |                                  ^^^^^^^^
136 |         """规范化 PostgreSQL 账户信息。.
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `connection`
   --> app/services/accounts_sync/adapters/postgresql_adapter.py:192:21
    |
190 |     def _get_role_permissions(
191 |         self,
192 |         connection: Any,
    |                     ^^^
193 |         username: str,
194 |         *,
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/services/accounts_sync/adapters/postgresql_adapter.py:218:16
    |
216 |         try:
217 |             permissions["role_attributes"] = self._get_role_attributes(connection, username)
218 |         except Exception as exc:
    |                ^^^^^^^^^
219 |             self.logger.warning(
220 |                 "fetch_pg_role_attributes_failed",
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/services/accounts_sync/adapters/postgresql_adapter.py:227:16
    |
225 |         try:
226 |             permissions["predefined_roles"] = self._get_predefined_roles(connection, username)
227 |         except Exception as exc:
    |                ^^^^^^^^^
228 |             self.logger.warning(
229 |                 "fetch_pg_predefined_roles_failed",
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/services/accounts_sync/adapters/postgresql_adapter.py:236:16
    |
234 |         try:
235 |             permissions["database_privileges_pg"] = self._get_database_privileges(connection, username)
236 |         except Exception as exc:
    |                ^^^^^^^^^
237 |             self.logger.warning(
238 |                 "fetch_pg_database_privileges_failed",
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/services/accounts_sync/adapters/postgresql_adapter.py:245:16
    |
243 |         try:
244 |             permissions["tablespace_privileges"] = self._get_tablespace_privileges(connection, username)
245 |         except Exception as exc:
    |                ^^^^^^^^^
246 |             self.logger.warning(
247 |                 "fetch_pg_tablespace_privileges_failed",
    |

C901 `enrich_permissions` is too complex (13 > 10)
   --> app/services/accounts_sync/adapters/postgresql_adapter.py:256:9
    |
254 |         return permissions
255 |
256 |     def enrich_permissions(
    |         ^^^^^^^^^^^^^^^^^^
257 |         self,
258 |         instance: Instance,
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `connection`
   --> app/services/accounts_sync/adapters/postgresql_adapter.py:259:21
    |
257 |         self,
258 |         instance: Instance,
259 |         connection: Any,
    |                     ^^^
260 |         accounts: list[dict[str, Any]],
261 |         *,
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/adapters/postgresql_adapter.py:266:23
    |
264 |         """丰富 PostgreSQL 账户的权限信息。.
265 |
266 |         为指定账户查询详细的权限信息，包括角色属性、预定义角色、数据库权限等。
    |                                     ^^
267 |
268 |         Args:
    |

G201 Logging `.exception(...)` should be used instead of `.error(..., exc_info=True)`
   --> app/services/accounts_sync/adapters/postgresql_adapter.py:326:29
    |
324 |                 account["is_locked"] = not can_login
325 |             except Exception as exc:
326 |                 self.logger.error(
    |                             ^^^^^
327 |                     "fetch_pg_permissions_failed",
328 |                     module="postgresql_account_adapter",
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `connection`
   --> app/services/accounts_sync/adapters/postgresql_adapter.py:345:48
    |
344 |     # 以下辅助查询函数沿用旧实现
345 |     def _get_role_attributes(self, connection: Any, username: str) -> dict[str, Any]:
    |                                                ^^^
346 |         """查询角色属性。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/adapters/postgresql_adapter.py:353:35
    |
352 |         Returns:
353 |             dict[str, Any]: 角色能力标志，如 `can_create_db` 等。
    |                                         ^^
354 |
355 |         """
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `connection`
   --> app/services/accounts_sync/adapters/postgresql_adapter.py:374:49
    |
372 |         }
373 |
374 |     def _get_predefined_roles(self, connection: Any, username: str) -> list[str]:
    |                                                 ^^^
375 |         """查询用户所属的预定义角色。.
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `connection`
   --> app/services/accounts_sync/adapters/postgresql_adapter.py:394:52
    |
392 |         return [row[0] for row in rows if row and row[0]]
393 |
394 |     def _get_database_privileges(self, connection: Any, username: str) -> dict[str, list[str]]:
    |                                                    ^^^
395 |         """查询用户在各数据库上的权限。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/adapters/postgresql_adapter.py:402:41
    |
401 |         Returns:
402 |             dict[str, list[str]]: 键为数据库名，值为权限列表。
    |                                               ^^
403 |
404 |         """
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `connection`
   --> app/services/accounts_sync/adapters/postgresql_adapter.py:432:54
    |
430 |         return privileges
431 |
432 |     def _get_tablespace_privileges(self, connection: Any, username: str) -> dict[str, list[str]]:
    |                                                      ^^^
433 |         """查询用户在各表空间上的权限。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/adapters/postgresql_adapter.py:440:41
    |
439 |         Returns:
440 |             dict[str, list[str]]: 键为表空间名，值为权限列表。
    |                                               ^^
441 |
442 |         """
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
 --> app/services/accounts_sync/adapters/sqlserver_adapter.py:1:22
  |
1 | """SQL Server 账户同步适配器（两阶段版）。."""
  |                             ^^
2 |
3 | from __future__ import annotations
  |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
 --> app/services/accounts_sync/adapters/sqlserver_adapter.py:1:27
  |
1 | """SQL Server 账户同步适配器（两阶段版）。."""
  |                                       ^^
2 |
3 | from __future__ import annotations
  |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/accounts_sync/adapters/sqlserver_adapter.py:26:13
   |
24 |     实现 SQL Server 数据库的账户查询和权限采集功能。
25 |     通过 sys.server_principals、sys.server_role_members、sys.database_principals 等视图采集登录信息和权限。
26 |     支持批量优化查询，提高多用户权限采集效率。
   |                     ^^
27 |
28 |     Attributes:
   |

D107 Missing docstring in `__init__`
  --> app/services/accounts_sync/adapters/sqlserver_adapter.py:39:9
   |
37 |     """
38 |
39 |     def __init__(self) -> None:
   |         ^^^^^^^^
40 |         self.logger = get_sync_logger()
41 |         self.filter_manager = DatabaseFilterManager()
   |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `connection`
  --> app/services/accounts_sync/adapters/sqlserver_adapter.py:43:67
   |
41 |         self.filter_manager = DatabaseFilterManager()
42 |
43 |     def _fetch_raw_accounts(self, instance: Instance, connection: Any) -> list[dict[str, Any]]:
   |                                                                   ^^^
44 |         """拉取 SQL Server 原始账户信息。.
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/accounts_sync/adapters/sqlserver_adapter.py:53:21
   |
52 |         Returns:
53 |             原始账户信息列表，每个元素包含登录名、是否禁用、是否为系统管理员等。
   |                             ^^
54 |
55 |         """
   |

TRY300 Consider moving this statement to an `else` block
  --> app/services/accounts_sync/adapters/sqlserver_adapter.py:81:13
   |
79 |                 account_count=len(accounts),
80 |             )
81 |             return accounts
   |             ^^^^^^^^^^^^^^^
82 |         except Exception as exc:
83 |             self.logger.error(
   |

G201 Logging `.exception(...)` should be used instead of `.error(..., exc_info=True)`
  --> app/services/accounts_sync/adapters/sqlserver_adapter.py:83:25
   |
81 |             return accounts
82 |         except Exception as exc:
83 |             self.logger.error(
   |                         ^^^^^
84 |                 "fetch_sqlserver_accounts_failed",
85 |                 module="sqlserver_account_adapter",
   |

ARG002 Unused method argument: `instance`
  --> app/services/accounts_sync/adapters/sqlserver_adapter.py:92:34
   |
90 |             return []
91 |
92 |     def _normalize_account(self, instance: Instance, account: dict[str, Any]) -> dict[str, Any]:
   |                                  ^^^^^^^^
93 |         """规范化 SQL Server 账户信息。.
   |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/adapters/sqlserver_adapter.py:117:39
    |
115 |             "is_superuser": account.get("is_superuser", False),
116 |             "is_locked": is_disabled,
117 |             # SQL Server 登录被禁用仍视为清单内账户，仅通过 is_locked 字段表达锁定状态
    |                                                    ^^
118 |             "is_active": True,
119 |             "permissions": {
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `connection`
   --> app/services/accounts_sync/adapters/sqlserver_adapter.py:131:21
    |
129 |         self,
130 |         instance: Instance,
131 |         connection: Any,
    |                     ^^^
132 |         accounts: list[dict[str, Any]],
133 |         *,
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/adapters/sqlserver_adapter.py:138:23
    |
136 |         """丰富 SQL Server 账户的权限信息。.
137 |
138 |         为指定账户查询详细的权限信息，包括服务器角色、服务器权限、数据库角色和数据库权限。
    |                                     ^^
139 |         使用批量优化查询提高性能。
    |

G201 Logging `.exception(...)` should be used instead of `.error(..., exc_info=True)`
   --> app/services/accounts_sync/adapters/sqlserver_adapter.py:192:29
    |
190 |                 account["is_locked"] = bool(type_specific.get("is_disabled", False))
191 |             except Exception as exc:
192 |                 self.logger.error(
    |                             ^^^^^
193 |                     "fetch_sqlserver_permissions_failed",
194 |                     module="sqlserver_account_adapter",
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `connection`
   --> app/services/accounts_sync/adapters/sqlserver_adapter.py:213:41
    |
211 |     # 查询逻辑来源于旧实现
212 |     # ------------------------------------------------------------------
213 |     def _fetch_logins(self, connection: Any) -> list[dict[str, Any]]:
    |                                         ^^^
214 |         """查询服务器登录账户。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/adapters/sqlserver_adapter.py:220:43
    |
219 |         Returns:
220 |             list[dict[str, Any]]: 过滤后的登录列表，包含名称、类型与状态。
    |                                                   ^^
221 |
222 |         """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/adapters/sqlserver_adapter.py:263:32
    |
262 |         Args:
263 |             patterns: LIKE 模式集合，支持 % 与 _。
    |                                    ^^
264 |
265 |         Returns:
    |

PLR0913 Too many arguments in function definition (6 > 5)
   --> app/services/accounts_sync/adapters/sqlserver_adapter.py:287:9
    |
285 |         return compiled
286 |
287 |     def _get_login_permissions(
    |         ^^^^^^^^^^^^^^^^^^^^^^
288 |         self,
289 |         connection: Any,
    |

ARG002 Unused method argument: `connection`
   --> app/services/accounts_sync/adapters/sqlserver_adapter.py:289:9
    |
287 |     def _get_login_permissions(
288 |         self,
289 |         connection: Any,
    |         ^^^^^^^^^^
290 |         login_name: str,
291 |         *,
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `connection`
   --> app/services/accounts_sync/adapters/sqlserver_adapter.py:289:21
    |
287 |     def _get_login_permissions(
288 |         self,
289 |         connection: Any,
    |                     ^^^
290 |         login_name: str,
291 |         *,
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/services/accounts_sync/adapters/sqlserver_adapter.py:300:38
    |
299 |         Args:
300 |             connection: SQL Server 连接（预留以便后续自定义查询）。
    |                                        ^^
301 |             login_name: 登录名。
302 |             precomputed_server_roles: 预先查询的服务器角色映射。
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/services/accounts_sync/adapters/sqlserver_adapter.py:300:50
    |
299 |         Args:
300 |             connection: SQL Server 连接（预留以便后续自定义查询）。
    |                                                                ^^
301 |             login_name: 登录名。
302 |             precomputed_server_roles: 预先查询的服务器角色映射。
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `connection`
   --> app/services/accounts_sync/adapters/sqlserver_adapter.py:403:50
    |
401 |         return copied
402 |
403 |     def _get_server_roles_bulk(self, connection: Any, usernames: Sequence[str]) -> dict[str, list[str]]:
    |                                                  ^^^
404 |         """批量查询服务器角色。.
    |

S608 Possible SQL injection vector through string-based query construction
   --> app/services/accounts_sync/adapters/sqlserver_adapter.py:419:15
    |
418 |           placeholders = ", ".join(["%s"] * len(normalized))
419 |           sql = f"""
    |  _______________^
420 | |             SELECT member.name AS login_name, role.name AS role_name
421 | |             FROM sys.server_role_members rm
422 | |             JOIN sys.server_principals role ON rm.role_principal_id = role.principal_id
423 | |             JOIN sys.server_principals member ON rm.member_principal_id = member.principal_id
424 | |             WHERE member.name IN ({placeholders})
425 | |         """
    | |___________^
426 |           rows = connection.execute_query(sql, tuple(normalized))
427 |           result: dict[str, list[str]] = {}
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `connection`
   --> app/services/accounts_sync/adapters/sqlserver_adapter.py:436:56
    |
434 |         return result
435 |
436 |     def _get_server_permissions_bulk(self, connection: Any, usernames: Sequence[str]) -> dict[str, list[str]]:
    |                                                        ^^^
437 |         """批量查询服务器权限。.
    |

S608 Possible SQL injection vector through string-based query construction
   --> app/services/accounts_sync/adapters/sqlserver_adapter.py:452:15
    |
451 |           placeholders = ", ".join(["%s"] * len(normalized))
452 |           sql = f"""
    |  _______________^
453 | |             SELECT sp.name AS login_name, perm.permission_name
454 | |             FROM sys.server_permissions perm
455 | |             JOIN sys.server_principals sp ON perm.grantee_principal_id = sp.principal_id
456 | |             WHERE sp.name IN ({placeholders})
457 | |         """
    | |___________^
458 |           rows = connection.execute_query(sql, tuple(normalized))
459 |           result: dict[str, list[str]] = {}
    |

C901 `_get_all_users_database_permissions_batch` is too complex (32 > 10)
   --> app/services/accounts_sync/adapters/sqlserver_adapter.py:468:9
    |
466 |         return result
467 |
468 |     def _get_all_users_database_permissions_batch(
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
469 |         self,
470 |         connection: Any,
    |

PLR0912 Too many branches (31 > 12)
   --> app/services/accounts_sync/adapters/sqlserver_adapter.py:468:9
    |
466 |         return result
467 |
468 |     def _get_all_users_database_permissions_batch(
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
469 |         self,
470 |         connection: Any,
    |

PLR0915 Too many statements (88 > 50)
   --> app/services/accounts_sync/adapters/sqlserver_adapter.py:468:9
    |
466 |         return result
467 |
468 |     def _get_all_users_database_permissions_batch(
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
469 |         self,
470 |         connection: Any,
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `connection`
   --> app/services/accounts_sync/adapters/sqlserver_adapter.py:470:21
    |
468 |     def _get_all_users_database_permissions_batch(
469 |         self,
470 |         connection: Any,
    |                     ^^^
471 |         usernames: Sequence[str],
472 |     ) -> dict[str, dict[str, Any]]:
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/services/accounts_sync/adapters/sqlserver_adapter.py:473:26
    |
471 |         usernames: Sequence[str],
472 |     ) -> dict[str, dict[str, Any]]:
473 |         """批量查询所有用户的数据库权限（优化版）。.
    |                                        ^^
474 |
475 |         通过 UNION ALL 合并多个数据库的查询，一次性获取所有用户在所有数据库中的权限信息。
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/services/accounts_sync/adapters/sqlserver_adapter.py:473:30
    |
471 |         usernames: Sequence[str],
472 |     ) -> dict[str, dict[str, Any]]:
473 |         """批量查询所有用户的数据库权限（优化版）。.
    |                                                ^^
474 |
475 |         通过 UNION ALL 合并多个数据库的查询，一次性获取所有用户在所有数据库中的权限信息。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/adapters/sqlserver_adapter.py:475:32
    |
473 |         """批量查询所有用户的数据库权限（优化版）。.
474 |
475 |         通过 UNION ALL 合并多个数据库的查询，一次性获取所有用户在所有数据库中的权限信息。
    |                                            ^^
476 |         显著提高多用户、多数据库场景下的查询效率。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/adapters/sqlserver_adapter.py:483:19
    |
482 |         Returns:
483 |             用户权限字典，键为登录名，值包含角色和权限信息。
    |                         ^^
484 |             格式：{
485 |                 'login_name': {
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/adapters/sqlserver_adapter.py:483:25
    |
482 |         Returns:
483 |             用户权限字典，键为登录名，值包含角色和权限信息。
    |                                     ^^
484 |             格式：{
485 |                 'login_name': {
    |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/services/accounts_sync/adapters/sqlserver_adapter.py:484:15
    |
482 |         Returns:
483 |             用户权限字典，键为登录名，值包含角色和权限信息。
484 |             格式：{
    |                 ^^
485 |                 'login_name': {
486 |                     'roles': {'db_name': ['role1', 'role2']},
    |

S608 Possible SQL injection vector through string-based query construction
   --> app/services/accounts_sync/adapters/sqlserver_adapter.py:512:30
    |
510 |               unique_usernames = list(dict.fromkeys(usernames))
511 |               placeholders = ", ".join(["%s"] * len(unique_usernames))
512 |               login_sids_sql = f"""
    |  ______________________________^
513 | |                 SELECT name, sid
514 | |                 FROM sys.server_principals
515 | |                 WHERE name IN ({placeholders})
516 | |                   AND type IN ('S', 'U', 'G')
517 | |             """
    | |_______________^
518 |               login_rows = connection.execute_query(login_sids_sql, tuple(unique_usernames))
519 |               sid_to_logins: dict[bytes, list[str]] = {}
    |

S608 Possible SQL injection vector through string-based query construction
   --> app/services/accounts_sync/adapters/sqlserver_adapter.py:543:21
    |
541 |                   quoted_db = self._quote_identifier(db)
542 |                   principals_parts.append(
543 | /                     f"""
544 | |                     SELECT '{db}' AS db_name,
545 | |                            name COLLATE SQL_Latin1_General_CP1_CI_AS AS user_name,
546 | |                            principal_id,
547 | |                            sid
548 | |                     FROM {quoted_db}.sys.database_principals
549 | |                     WHERE type IN ('S', 'U', 'G')
550 | |                       AND name != 'dbo'
551 | |                       AND sid IN ({sid_filter})
552 | |                     """,
    | |_______________________^
553 |                   )
    |

S608 Possible SQL injection vector through string-based query construction
   --> app/services/accounts_sync/adapters/sqlserver_adapter.py:556:21
    |
555 |                   roles_parts.append(
556 | /                     f"""
557 | |                     SELECT '{db}' AS db_name,
558 | |                            role.name COLLATE SQL_Latin1_General_CP1_CI_AS AS role_name,
559 | |                            member.principal_id AS member_principal_id
560 | |                     FROM {quoted_db}.sys.database_role_members drm
561 | |                     JOIN {quoted_db}.sys.database_principals role
562 | |                       ON drm.role_principal_id = role.principal_id
563 | |                     JOIN {quoted_db}.sys.database_principals member
564 | |                       ON drm.member_principal_id = member.principal_id
565 | |                     WHERE member.sid IN ({sid_filter})
566 | |                     """,
    | |_______________________^
567 |                   )
    |

S608 Possible SQL injection vector through string-based query construction
   --> app/services/accounts_sync/adapters/sqlserver_adapter.py:570:21
    |
569 |   …     perms_parts.append(
570 | / …         f"""
571 | | …         SELECT '{db}' AS db_name,
572 | | …                perm.permission_name COLLATE SQL_Latin1_General_CP1_CI_AS AS permission_name,
573 | | …                perm.grantee_principal_id,
574 | | …                perm.major_id,
575 | | …                perm.minor_id,
576 | | …                CASE
577 | | …                    WHEN perm.class_desc = 'DATABASE' THEN 'DATABASE'
578 | | …                    WHEN perm.class_desc = 'SCHEMA' THEN 'SCHEMA'
579 | | …                    WHEN perm.class_desc = 'OBJECT_OR_COLUMN' AND perm.minor_id = 0 THEN 'OBJECT'
580 | | …                    WHEN perm.class_desc = 'OBJECT_OR_COLUMN' AND perm.minor_id > 0 THEN 'COLUMN'
581 | | …                    ELSE perm.class_desc
582 | | …                END AS permission_scope,
583 | | …                CASE
584 | | …                    WHEN perm.class_desc = 'SCHEMA' THEN SCHEMA_NAME(perm.major_id)
585 | | …                    WHEN perm.class_desc = 'OBJECT_OR_COLUMN' THEN OBJECT_SCHEMA_NAME(perm.major_id)
586 | | …                    ELSE NULL
587 | | …                END AS schema_name,
588 | | …                CASE
589 | | …                    WHEN perm.class_desc = 'OBJECT_OR_COLUMN' THEN OBJECT_NAME(perm.major_id)
590 | | …                    ELSE NULL
591 | | …                END AS object_name,
592 | | …                CASE
593 | | …                    WHEN perm.class_desc = 'OBJECT_OR_COLUMN' AND perm.minor_id > 0 THEN COL_NAME(perm.major_id, perm.minor_id)
594 | | …                    ELSE NULL
595 | | …                END AS column_name
596 | | …         FROM {quoted_db}.sys.database_permissions perm
597 | | …         JOIN {quoted_db}.sys.database_principals dp
598 | | …           ON perm.grantee_principal_id = dp.principal_id
599 | | …         WHERE perm.state = 'G'
600 | | …           AND dp.sid IN ({sid_filter})
601 | | …         """,
    | |_____________^
602 |   …     )
    |

E501 Line too long (138 > 120)
   --> app/services/accounts_sync/adapters/sqlserver_adapter.py:593:121
    |
591 | …                     END AS object_name,
592 | …                     CASE
593 | …                         WHEN perm.class_desc = 'OBJECT_OR_COLUMN' AND perm.minor_id > 0 THEN COL_NAME(perm.major_id, perm.minor_id)
    |                                                                                                                    ^^^^^^^^^^^^^^^^^^
594 | …                         ELSE NULL
595 | …                     END AS column_name
    |

TRY300 Consider moving this statement to an `else` block
   --> app/services/accounts_sync/adapters/sqlserver_adapter.py:701:13
    |
699 |             )
700 |
701 |             return result
    |             ^^^^^^^^^^^^^
702 |         except Exception as exc:
703 |             self.logger.error(
    |

G201 Logging `.exception(...)` should be used instead of `.error(..., exc_info=True)`
   --> app/services/accounts_sync/adapters/sqlserver_adapter.py:703:25
    |
701 |             return result
702 |         except Exception as exc:
703 |             self.logger.error(
    |                         ^^^^^
704 |                 "sqlserver_batch_database_permissions_failed",
705 |                 module="sqlserver_account_adapter",
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `raw_sid`
   --> app/services/accounts_sync/adapters/sqlserver_adapter.py:712:33
    |
711 |     @staticmethod
712 |     def _normalize_sid(raw_sid: Any) -> bytes | None:
    |                                 ^^^
713 |         """标准化 SID 字节串。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/adapters/sqlserver_adapter.py:719:36
    |
718 |         Returns:
719 |             bytes | None: 统一转换后的字节串，无法转换则返回 None。
    |                                             ^^
720 |
721 |         """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/adapters/sqlserver_adapter.py:740:38
    |
739 |         Returns:
740 |             str | None: 形如 0x... 的字面值，sid 为空时返回 None。
    |                                            ^^
741 |
742 |         """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/services/accounts_sync/coordinator.py:1:11
  |
1 | """账户同步协调器，封装连接管理、清单/权限双阶段流程。."""
  |                  ^^
2 |
3 | from __future__ import annotations
  |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/accounts_sync/coordinator.py:21:15
   |
20 | class AccountSyncCoordinator(AbstractContextManager["AccountSyncCoordinator"]):
21 |     """账户同步协调器，负责两阶段流程。.
   |                      ^^
22 |
23 |     协调账户同步的两个阶段：
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/services/accounts_sync/coordinator.py:23:16
   |
21 |     """账户同步协调器，负责两阶段流程。.
22 |
23 |     协调账户同步的两个阶段：
   |                           ^^
24 |     1. 清单阶段（Inventory）：同步账户基本信息，标记活跃/非活跃状态
25 |     2. 权限阶段（Collection）：同步活跃账户的权限信息
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/accounts_sync/coordinator.py:24:12
   |
23 |     协调账户同步的两个阶段：
24 |     1. 清单阶段（Inventory）：同步账户基本信息，标记活跃/非活跃状态
   |                ^^
25 |     2. 权限阶段（Collection）：同步活跃账户的权限信息
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/accounts_sync/coordinator.py:24:22
   |
23 |     协调账户同步的两个阶段：
24 |     1. 清单阶段（Inventory）：同步账户基本信息，标记活跃/非活跃状态
   |                           ^^
25 |     2. 权限阶段（Collection）：同步活跃账户的权限信息
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/services/accounts_sync/coordinator.py:24:23
   |
23 |     协调账户同步的两个阶段：
24 |     1. 清单阶段（Inventory）：同步账户基本信息，标记活跃/非活跃状态
   |                             ^^
25 |     2. 权限阶段（Collection）：同步活跃账户的权限信息
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/accounts_sync/coordinator.py:24:32
   |
23 |     协调账户同步的两个阶段：
24 |     1. 清单阶段（Inventory）：同步账户基本信息，标记活跃/非活跃状态
   |                                               ^^
25 |     2. 权限阶段（Collection）：同步活跃账户的权限信息
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/accounts_sync/coordinator.py:25:12
   |
23 |     协调账户同步的两个阶段：
24 |     1. 清单阶段（Inventory）：同步账户基本信息，标记活跃/非活跃状态
25 |     2. 权限阶段（Collection）：同步活跃账户的权限信息
   |                ^^
26 |
27 |     支持上下文管理器协议，自动管理数据库连接的建立和释放。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/accounts_sync/coordinator.py:25:23
   |
23 |     协调账户同步的两个阶段：
24 |     1. 清单阶段（Inventory）：同步账户基本信息，标记活跃/非活跃状态
25 |     2. 权限阶段（Collection）：同步活跃账户的权限信息
   |                            ^^
26 |
27 |     支持上下文管理器协议，自动管理数据库连接的建立和释放。
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/services/accounts_sync/coordinator.py:25:24
   |
23 |     协调账户同步的两个阶段：
24 |     1. 清单阶段（Inventory）：同步账户基本信息，标记活跃/非活跃状态
25 |     2. 权限阶段（Collection）：同步活跃账户的权限信息
   |                              ^^
26 |
27 |     支持上下文管理器协议，自动管理数据库连接的建立和释放。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/accounts_sync/coordinator.py:27:15
   |
25 |     2. 权限阶段（Collection）：同步活跃账户的权限信息
26 |
27 |     支持上下文管理器协议，自动管理数据库连接的建立和释放。
   |                         ^^
28 |
29 |     Attributes:
   |

D107 Missing docstring in `__init__`
  --> app/services/accounts_sync/coordinator.py:39:9
   |
37 |     """
38 |
39 |     def __init__(self, instance: Instance) -> None:
   |         ^^^^^^^^
40 |         self.instance = instance
41 |         self.logger = get_sync_logger()
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/accounts_sync/coordinator.py:60:41
   |
59 |         Returns:
60 |             AccountSyncCoordinator: 自身引用，便于链式调用。
   |                                             ^^
61 |
62 |         Raises:
   |

ANN001 Missing type annotation for function argument `exc_type`
  --> app/services/accounts_sync/coordinator.py:71:24
   |
69 |         return self
70 |
71 |     def __exit__(self, exc_type, exc_val, exc_tb) -> None:
   |                        ^^^^^^^^
72 |         """退出上下文时释放连接资源。.
   |

ANN001 Missing type annotation for function argument `exc_val`
  --> app/services/accounts_sync/coordinator.py:71:34
   |
69 |         return self
70 |
71 |     def __exit__(self, exc_type, exc_val, exc_tb) -> None:
   |                                  ^^^^^^^
72 |         """退出上下文时释放连接资源。.
   |

ANN001 Missing type annotation for function argument `exc_tb`
  --> app/services/accounts_sync/coordinator.py:71:43
   |
69 |         return self
70 |
71 |     def __exit__(self, exc_type, exc_val, exc_tb) -> None:
   |                                           ^^^^^^
72 |         """退出上下文时释放连接资源。.
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/accounts_sync/coordinator.py:80:36
   |
79 |         Returns:
80 |             None: 连接关闭后返回 False 等效值，从而不吞掉异常。
   |                                              ^^
81 |
82 |         """
   |

PLR0911 Too many return statements (7 > 6)
  --> app/services/accounts_sync/coordinator.py:85:9
   |
83 |         self.disconnect()
84 |
85 |     def connect(self) -> bool:
   |         ^^^^^^^
86 |         """建立到数据库实例的连接。.
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/accounts_sync/coordinator.py:88:19
   |
86 |         """建立到数据库实例的连接。.
87 |
88 |         如果连接已存在且有效，则复用现有连接。
   |                             ^^
89 |         如果之前连接失败，则直接返回 False 不再重试。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/accounts_sync/coordinator.py:89:17
   |
88 |         如果连接已存在且有效，则复用现有连接。
89 |         如果之前连接失败，则直接返回 False 不再重试。
   |                         ^^
90 |
91 |         Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/accounts_sync/coordinator.py:92:24
   |
91 |         Returns:
92 |             连接成功返回 True，失败返回 False。
   |                              ^^
93 |
94 |         """
   |

G201 Logging `.exception(...)` should be used instead of `.error(..., exc_info=True)`
   --> app/services/accounts_sync/coordinator.py:111:25
    |
109 |             self._connection_failed = True
110 |             self._connection_error = str(exc)
111 |             self.logger.error(
    |                         ^^^^^
112 |                 "accounts_sync_connection_init_failed",
113 |                 instance_id=self.instance.id,
    |

TRY300 Consider moving this statement to an `else` block
   --> app/services/accounts_sync/coordinator.py:156:13
    |
154 |                 module=MODULE,
155 |             )
156 |             return False
    |             ^^^^^^^^^^^^
157 |         except Exception as exc:
158 |             self._connection_failed = True
    |

G201 Logging `.exception(...)` should be used instead of `.error(..., exc_info=True)`
   --> app/services/accounts_sync/coordinator.py:160:25
    |
158 |             self._connection_failed = True
159 |             self._connection_error = str(exc)
160 |             self.logger.error(
    |                         ^^^^^
161 |                 "accounts_sync_connection_exception",
162 |                 instance_id=self.instance.id,
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/coordinator.py:191:21
    |
190 |     def _ensure_connection(self) -> None:
191 |         """确保数据库连接有效，如果无效则尝试重新连接。.
    |                              ^^
192 |
193 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/coordinator.py:197:35
    |
196 |         Raises:
197 |             RuntimeError: 当连接失败时抛出，包含连接错误信息。
    |                                           ^^
198 |
199 |         """
    |

SIM102 Use a single `if` statement instead of nested `if` statements
   --> app/services/accounts_sync/coordinator.py:200:9
    |
199 |           """
200 | /         if not self._connection or not getattr(self._connection, "is_connected", False):
201 | |             if not self.connect():
    | |__________________________________^
202 |                   error_message = self._connection_error or "数据库连接未建立"
203 |                   raise RuntimeError(error_message)
    |
help: Combine `if` statements using `and`

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/coordinator.py:211:15
    |
209 |         """从远程数据库获取账户列表。.
210 |
211 |         使用缓存机制，同一实例的账户列表只获取一次。
    |                     ^^
212 |         确保连接有效后，通过适配器获取账户数据。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/coordinator.py:212:16
    |
211 |         使用缓存机制，同一实例的账户列表只获取一次。
212 |         确保连接有效后，通过适配器获取账户数据。
    |                       ^^
213 |
214 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/coordinator.py:215:19
    |
214 |         Returns:
215 |             账户字典列表，每个字典包含账户的基本信息。
    |                         ^^
216 |
217 |         Raises:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/coordinator.py:242:20
    |
241 |     def synchronize_inventory(self) -> dict:
242 |         """执行清单阶段同步，同步账户基本信息。.
    |                            ^^
243 |
244 |         获取远程账户列表，与本地数据库对比，创建新账户、刷新现有账户、
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/coordinator.py:244:17
    |
242 |         """执行清单阶段同步，同步账户基本信息。.
243 |
244 |         获取远程账户列表，与本地数据库对比，创建新账户、刷新现有账户、
    |                         ^^
245 |         标记活跃/非活跃状态。同步结果会缓存活跃账户列表供权限阶段使用。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/coordinator.py:244:26
    |
242 |         """执行清单阶段同步，同步账户基本信息。.
243 |
244 |         获取远程账户列表，与本地数据库对比，创建新账户、刷新现有账户、
    |                                           ^^
245 |         标记活跃/非活跃状态。同步结果会缓存活跃账户列表供权限阶段使用。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/coordinator.py:248:21
    |
247 |         Returns:
248 |             清单同步结果字典，格式如下：
    |                             ^^
249 |             {
250 |                 'status': 'completed',
    |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/services/accounts_sync/coordinator.py:248:26
    |
247 |         Returns:
248 |             清单同步结果字典，格式如下：
    |                                       ^^
249 |             {
250 |                 'status': 'completed',
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/coordinator.py:290:20
    |
289 |     def synchronize_permissions(self, *, session_id: str | None = None) -> dict:
290 |         """执行权限阶段同步，同步活跃账户的权限信息。.
    |                            ^^
291 |
292 |         如果清单阶段未执行，会先自动执行清单同步。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/coordinator.py:292:18
    |
290 |         """执行权限阶段同步，同步活跃账户的权限信息。.
291 |
292 |         如果清单阶段未执行，会先自动执行清单同步。
    |                           ^^
293 |         只为活跃账户同步权限信息，跳过非活跃账户。
294 |         按需补全权限信息（enrich_permissions），避免重复获取。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/coordinator.py:293:21
    |
292 |         如果清单阶段未执行，会先自动执行清单同步。
293 |         只为活跃账户同步权限信息，跳过非活跃账户。
    |                                 ^^
294 |         按需补全权限信息（enrich_permissions），避免重复获取。
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/services/accounts_sync/coordinator.py:294:17
    |
292 |         如果清单阶段未执行，会先自动执行清单同步。
293 |         只为活跃账户同步权限信息，跳过非活跃账户。
294 |         按需补全权限信息（enrich_permissions），避免重复获取。
    |                         ^^
295 |
296 |         Args:
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/services/accounts_sync/coordinator.py:294:36
    |
292 |         如果清单阶段未执行，会先自动执行清单同步。
293 |         只为活跃账户同步权限信息，跳过非活跃账户。
294 |         按需补全权限信息（enrich_permissions），避免重复获取。
    |                                             ^^
295 |
296 |         Args:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/coordinator.py:294:37
    |
292 |         如果清单阶段未执行，会先自动执行清单同步。
293 |         只为活跃账户同步权限信息，跳过非活跃账户。
294 |         按需补全权限信息（enrich_permissions），避免重复获取。
    |                                               ^^
295 |
296 |         Args:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/coordinator.py:297:35
    |
296 |         Args:
297 |             session_id: 可选的同步会话 ID，用于关联日志和错误追踪。
    |                                          ^^
298 |
299 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/coordinator.py:300:21
    |
299 |         Returns:
300 |             权限同步结果字典，格式如下：
    |                             ^^
301 |             {
302 |                 'status': 'completed',  # 或 'skipped'
    |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/services/accounts_sync/coordinator.py:300:26
    |
299 |         Returns:
300 |             权限同步结果字典，格式如下：
    |                                       ^^
301 |             {
302 |                 'status': 'completed',  # 或 'skipped'
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/coordinator.py:313:44
    |
311 |         Raises:
312 |             RuntimeError: 当数据库连接失败时抛出。
313 |             PermissionSyncError: 当权限同步失败时抛出，包含详细错误信息。
    |                                                      ^^
314 |
315 |         """
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/coordinator.py:340:37
    |
338 |                 "updated": 0,
339 |                 "skipped": len(remote_accounts),
340 |                 "message": "未检测到活跃账户，跳过权限同步",
    |                                             ^^
341 |                 "errors": [],
342 |             }
    |

E501 Line too long (122 > 120)
   --> app/services/accounts_sync/coordinator.py:356:121
    |
354 |         active_usernames = [account.username for account in active_accounts if getattr(account, "username", None)]
355 |         enriched_usernames = getattr(self, "_enriched_usernames", set())
356 |         pending_usernames = [username for username in active_usernames if username and username not in enriched_usernames]
    |                                                                                                                         ^^
357 |         if pending_usernames:
358 |             self._ensure_connection()
    |

E501 Line too long (121 > 120)
   --> app/services/accounts_sync/coordinator.py:394:121
    |
392 |             "updated": summary.get("updated", 0),
393 |             "skipped": summary.get("skipped", 0),
394 |             "processed_records": summary.get("processed_records", summary.get("created", 0) + summary.get("updated", 0)),
    |                                                                                                                         ^
395 |             "errors": summary.get("errors", []),
396 |             "message": summary.get("message"),
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/coordinator.py:411:22
    |
409 |         """执行完整的两阶段同步流程。.
410 |
411 |         依次执行清单阶段和权限阶段，返回两个阶段的汇总结果。
    |                                   ^^
412 |
413 |         Args:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/coordinator.py:414:35
    |
413 |         Args:
414 |             session_id: 可选的同步会话 ID，用于关联日志和错误追踪。
    |                                          ^^
415 |
416 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/coordinator.py:417:24
    |
416 |         Returns:
417 |             包含两个阶段结果的字典，格式如下：
    |                                   ^^
418 |             {
419 |                 'inventory': {...},    # synchronize_inventory 的返回值
    |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/services/accounts_sync/coordinator.py:417:29
    |
416 |         Returns:
417 |             包含两个阶段结果的字典，格式如下：
    |                                             ^^
418 |             {
419 |                 'inventory': {...},    # synchronize_inventory 的返回值
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/services/accounts_sync/inventory_manager.py:1:13
  |
1 | """账户清单同步管理器，负责维护 InstanceAccount 状态。."""
  |                      ^^
2 |
3 | from __future__ import annotations
  |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/accounts_sync/inventory_manager.py:21:40
   |
19 |     """维护 InstanceAccount 清单同步的管理器。.
20 |
21 |     负责将远程数据库账户与本地 InstanceAccount 表进行同步，
   |                                                          ^^
22 |     包括创建新账户、重新激活已删除账户、停用不存在的账户。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/accounts_sync/inventory_manager.py:36:26
   |
34 |         """根据远端账户列表同步 InstanceAccount 表。.
35 |
36 |         将远程账户数据与本地数据库进行对比，执行以下操作：
   |                                           ^^
37 |         - 创建新发现的账户
38 |         - 重新激活之前被删除的账户
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/services/accounts_sync/inventory_manager.py:36:33
   |
34 |         """根据远端账户列表同步 InstanceAccount 表。.
35 |
36 |         将远程账户数据与本地数据库进行对比，执行以下操作：
   |                                                         ^^
37 |         - 创建新发现的账户
38 |         - 重新激活之前被删除的账户
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/accounts_sync/inventory_manager.py:44:38
   |
42 |         Args:
43 |             instance: 数据库实例对象。
44 |             remote_accounts: 远程账户数据列表，每项至少包含以下字段：
   |                                              ^^
45 |                 - username: 账户用户名
46 |                 - db_type: 数据库类型（可选，默认使用实例类型）
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/services/accounts_sync/inventory_manager.py:44:49
   |
42 |         Args:
43 |             instance: 数据库实例对象。
44 |             remote_accounts: 远程账户数据列表，每项至少包含以下字段：
   |                                                                    ^^
45 |                 - username: 账户用户名
46 |                 - db_type: 数据库类型（可选，默认使用实例类型）
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/accounts_sync/inventory_manager.py:46:33
   |
44 |             remote_accounts: 远程账户数据列表，每项至少包含以下字段：
45 |                 - username: 账户用户名
46 |                 - db_type: 数据库类型（可选，默认使用实例类型）
   |                                      ^^
47 |                 - is_active: 是否活跃（可选，默认为 True）
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/accounts_sync/inventory_manager.py:46:36
   |
44 |             remote_accounts: 远程账户数据列表，每项至少包含以下字段：
45 |                 - username: 账户用户名
46 |                 - db_type: 数据库类型（可选，默认使用实例类型）
   |                                            ^^
47 |                 - is_active: 是否活跃（可选，默认为 True）
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/accounts_sync/inventory_manager.py:46:45
   |
44 |             remote_accounts: 远程账户数据列表，每项至少包含以下字段：
45 |                 - username: 账户用户名
46 |                 - db_type: 数据库类型（可选，默认使用实例类型）
   |                                                              ^^
47 |                 - is_active: 是否活跃（可选，默认为 True）
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/accounts_sync/inventory_manager.py:47:34
   |
45 |                 - username: 账户用户名
46 |                 - db_type: 数据库类型（可选，默认使用实例类型）
47 |                 - is_active: 是否活跃（可选，默认为 True）
   |                                      ^^
48 |
49 |         Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/accounts_sync/inventory_manager.py:47:37
   |
45 |                 - username: 账户用户名
46 |                 - db_type: 数据库类型（可选，默认使用实例类型）
47 |                 - is_active: 是否活跃（可选，默认为 True）
   |                                            ^^
48 |
49 |         Returns:
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/accounts_sync/inventory_manager.py:47:46
   |
45 |                 - username: 账户用户名
46 |                 - db_type: 数据库类型（可选，默认使用实例类型）
47 |                 - is_active: 是否活跃（可选，默认为 True）
   |                                                         ^^
48 |
49 |         Returns:
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/services/accounts_sync/inventory_manager.py:50:22
   |
49 |         Returns:
50 |             包含两个元素的元组：
   |                               ^^
51 |             - 同步统计信息字典，包含以下字段：
52 |                 {
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/accounts_sync/inventory_manager.py:51:23
   |
49 |         Returns:
50 |             包含两个元素的元组：
51 |             - 同步统计信息字典，包含以下字段：
   |                               ^^
52 |                 {
53 |                     'created': 新创建的账户数,
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/services/accounts_sync/inventory_manager.py:51:30
   |
49 |         Returns:
50 |             包含两个元素的元组：
51 |             - 同步统计信息字典，包含以下字段：
   |                                             ^^
52 |                 {
53 |                     'created': 新创建的账户数,
   |

G201 Logging `.exception(...)` should be used instead of `.error(..., exc_info=True)`
   --> app/services/accounts_sync/inventory_manager.py:128:25
    |
126 |         except Exception as exc:
127 |             db.session.rollback()
128 |             self.logger.error(
    |                         ^^^^^
129 |                 "account_inventory_sync_commit_failed",
130 |                 instance=instance.name,
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/services/accounts_sync/permission_manager.py:1:13
  |
1 | """账户权限同步管理器，实现权限增量及变更日志。."""
  |                      ^^
2 |
3 | from __future__ import annotations
  |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/accounts_sync/permission_manager.py:62:21
   |
61 | class PermissionSyncError(RuntimeError):
62 |     """权限同步阶段出现错误时抛出，携带阶段 summary。.
   |                                  ^^
63 |
64 |     Attributes:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/accounts_sync/permission_manager.py:74:26
   |
72 |         Args:
73 |             summary: 同步阶段的统计信息。
74 |             message: 错误消息，可选。
   |                              ^^
75 |
76 |         """
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/accounts_sync/permission_manager.py:84:41
   |
82 |     """处理权限快照的增量更新。.
83 |
84 |     负责将远程账户权限与本地 AccountPermission 表进行同步，
   |                                                          ^^
85 |     包括创建新权限记录、更新已变更的权限、记录权限变更日志。
   |

C901 `synchronize` is too complex (11 > 10)
  --> app/services/accounts_sync/permission_manager.py:96:9
   |
94 |         self.logger = get_sync_logger()
95 |
96 |     def synchronize(
   |         ^^^^^^^^^^^
97 |         self,
98 |         instance: Instance,
   |

PLR0915 Too many statements (62 > 50)
  --> app/services/accounts_sync/permission_manager.py:96:9
   |
94 |         self.logger = get_sync_logger()
95 |
96 |     def synchronize(
   |         ^^^^^^^^^^^
97 |         self,
98 |         instance: Instance,
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/permission_manager.py:106:26
    |
104 |         """同步账户权限数据。.
105 |
106 |         将远程账户权限与本地数据库进行对比，执行以下操作：
    |                                           ^^
107 |         - 创建新账户的权限记录
108 |         - 更新已变更的权限
    |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/services/accounts_sync/permission_manager.py:106:33
    |
104 |         """同步账户权限数据。.
105 |
106 |         将远程账户权限与本地数据库进行对比，执行以下操作：
    |                                                         ^^
107 |         - 创建新账户的权限记录
108 |         - 更新已变更的权限
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/permission_manager.py:113:38
    |
111 |         Args:
112 |             instance: 数据库实例对象。
113 |             remote_accounts: 远程账户数据列表，每项包含 username、permissions、
    |                                              ^^
114 |                 is_superuser、is_locked 等字段。
115 |             active_accounts: 活跃的 InstanceAccount 对象列表。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/permission_manager.py:116:32
    |
114 |                 is_superuser、is_locked 等字段。
115 |             active_accounts: 活跃的 InstanceAccount 对象列表。
116 |             session_id: 同步会话 ID，可选。
    |                                    ^^
117 |
118 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/permission_manager.py:119:21
    |
118 |         Returns:
119 |             同步统计信息字典，包含以下字段：
    |                             ^^
120 |             {
121 |                 'created': 新创建的权限记录数,
    |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/services/accounts_sync/permission_manager.py:119:28
    |
118 |         Returns:
119 |             同步统计信息字典，包含以下字段：
    |                                           ^^
120 |             {
121 |                 'created': 新创建的权限记录数,
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/services/accounts_sync/permission_manager.py:126:31
    |
124 |                 'processed_records': 处理的记录总数,
125 |                 'errors': 错误信息列表,
126 |                 'status': 同步状态（'completed' 或 'failed'）,
    |                                   ^^
127 |                 'message': 同步结果消息
128 |             }
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/services/accounts_sync/permission_manager.py:126:54
    |
124 |                 'processed_records': 处理的记录总数,
125 |                 'errors': 错误信息列表,
126 |                 'status': 同步状态（'completed' 或 'failed'）,
    |                                                            ^^
127 |                 'message': 同步结果消息
128 |             }
    |

G201 Logging `.exception(...)` should be used instead of `.error(..., exc_info=True)`
   --> app/services/accounts_sync/permission_manager.py:233:25
    |
231 |         except SQLAlchemyError as exc:
232 |             db.session.rollback()
233 |             self.logger.error(
    |                         ^^^^^
234 |                 "account_permission_sync_commit_failed",
235 |                 instance=instance.name,
    |

RUF001 String contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/services/accounts_sync/permission_manager.py:252:25
    |
250 |             "status": "completed" if not errors else "failed",
251 |             "message": (
252 |                 f"权限同步完成：新增 {created} 个账户，更新 {updated} 个账户"
    |                               ^^
253 |                 if not errors
254 |                 else "权限同步阶段发生错误"
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/permission_manager.py:252:42
    |
250 |             "status": "completed" if not errors else "failed",
251 |             "message": (
252 |                 f"权限同步完成：新增 {created} 个账户，更新 {updated} 个账户"
    |                                                      ^^
253 |                 if not errors
254 |                 else "权限同步阶段发生错误"
    |

FBT001 Boolean-typed positional argument in function definition
   --> app/services/accounts_sync/permission_manager.py:288:9
    |
286 |         record: AccountPermission,
287 |         permissions: dict,
288 |         is_superuser: bool,
    |         ^^^^^^^^^^^^
289 |         is_locked: bool,
290 |     ) -> None:
    |

FBT001 Boolean-typed positional argument in function definition
   --> app/services/accounts_sync/permission_manager.py:289:9
    |
287 |         permissions: dict,
288 |         is_superuser: bool,
289 |         is_locked: bool,
    |         ^^^^^^^^^
290 |     ) -> None:
291 |         """将权限快照写入账户记录。.
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/permission_manager.py:309:23
    |
307 |                 setattr(record, field, permissions[field])
308 |             elif field == "type_specific":
309 |                 # 若未提供，保持原值
    |                           ^^
310 |                 continue
311 |             else:
    |

C901 `_calculate_diff` is too complex (11 > 10)
   --> app/services/accounts_sync/permission_manager.py:314:9
    |
312 |                 setattr(record, field, None)
313 |
314 |     def _calculate_diff(
    |         ^^^^^^^^^^^^^^^
315 |         self,
316 |         record: AccountPermission,
    |

FBT001 Boolean-typed positional argument in function definition
   --> app/services/accounts_sync/permission_manager.py:318:9
    |
316 |         record: AccountPermission,
317 |         permissions: dict,
318 |         is_superuser: bool,
    |         ^^^^^^^^^^^^
319 |         is_locked: bool,
320 |     ) -> dict[str, Any]:
    |

FBT001 Boolean-typed positional argument in function definition
   --> app/services/accounts_sync/permission_manager.py:319:9
    |
317 |         permissions: dict,
318 |         is_superuser: bool,
319 |         is_locked: bool,
    |         ^^^^^^^^^
320 |     ) -> dict[str, Any]:
321 |         """计算新旧权限之间的差异。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/permission_manager.py:399:32
    |
397 |             change_type: 变更类型。
398 |             diff_payload: 差异结果。
399 |             session_id: 同步会话 ID，可选。
    |                                    ^^
400 |
401 |         Returns:
    |

FBT001 Boolean-typed positional argument in function definition
   --> app/services/accounts_sync/permission_manager.py:431:9
    |
429 |         self,
430 |         permissions: dict[str, Any],
431 |         is_superuser: bool,
    |         ^^^^^^^^^^^^
432 |         is_locked: bool,
433 |     ) -> dict[str, Any]:
    |

FBT001 Boolean-typed positional argument in function definition
   --> app/services/accounts_sync/permission_manager.py:432:9
    |
430 |         permissions: dict[str, Any],
431 |         is_superuser: bool,
432 |         is_locked: bool,
    |         ^^^^^^^^^
433 |     ) -> dict[str, Any]:
434 |         """构建新账户的权限差异初始结构。.
    |

FBT003 Boolean positional value in function call
   --> app/services/accounts_sync/permission_manager.py:453:72
    |
451 |         other_diff: list[dict[str, Any]] = []
452 |         if is_superuser:
453 |             other_entry = self._build_other_diff_entry("is_superuser", False, True)
    |                                                                        ^^^^^
454 |             if other_entry:
455 |                 other_diff.append(other_entry)
    |

FBT003 Boolean positional value in function call
   --> app/services/accounts_sync/permission_manager.py:453:79
    |
451 |         other_diff: list[dict[str, Any]] = []
452 |         if is_superuser:
453 |             other_entry = self._build_other_diff_entry("is_superuser", False, True)
    |                                                                               ^^^^
454 |             if other_entry:
455 |                 other_diff.append(other_entry)
    |

FBT003 Boolean positional value in function call
   --> app/services/accounts_sync/permission_manager.py:457:70
    |
455 |                 other_diff.append(other_entry)
456 |         if is_locked:
457 |             locked_entry = self._build_other_diff_entry("is_locked", False, True)
    |                                                                      ^^^^^
458 |             if locked_entry:
459 |                 other_diff.append(locked_entry)
    |

FBT003 Boolean positional value in function call
   --> app/services/accounts_sync/permission_manager.py:457:77
    |
455 |                 other_diff.append(other_entry)
456 |         if is_locked:
457 |             locked_entry = self._build_other_diff_entry("is_locked", False, True)
    |                                                                             ^^^^
458 |             if locked_entry:
459 |                 other_diff.append(locked_entry)
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `old_value`
   --> app/services/accounts_sync/permission_manager.py:474:20
    |
472 |         self,
473 |         field: str,
474 |         old_value: Any,
    |                    ^^^
475 |         new_value: Any,
476 |     ) -> list[dict[str, Any]]:
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `new_value`
   --> app/services/accounts_sync/permission_manager.py:475:20
    |
473 |         field: str,
474 |         old_value: Any,
475 |         new_value: Any,
    |                    ^^^
476 |     ) -> list[dict[str, Any]]:
477 |         """比较权限字段并返回差异条目。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/permission_manager.py:481:28
    |
479 |         Args:
480 |             field: 权限字段名称。
481 |             old_value: 原权限值，可为映射或序列。
    |                                ^^
482 |             new_value: 新权限值。
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `old_value`
   --> app/services/accounts_sync/permission_manager.py:579:20
    |
577 |         self,
578 |         field: str,
579 |         old_value: Any,
    |                    ^^^
580 |         new_value: Any,
581 |     ) -> dict[str, Any] | None:
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `new_value`
   --> app/services/accounts_sync/permission_manager.py:580:20
    |
578 |         field: str,
579 |         old_value: Any,
580 |         new_value: Any,
    |                    ^^^
581 |     ) -> dict[str, Any] | None:
582 |         """构建非权限字段的差异条目。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/permission_manager.py:590:36
    |
589 |         Returns:
590 |             dict | None: 若发生变化则返回记录，否则返回 None。
    |                                              ^^
591 |
592 |         """
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `old_value`
   --> app/services/accounts_sync/permission_manager.py:606:63
    |
604 |         }
605 |
606 |     def _build_other_description(self, label: str, old_value: Any, new_value: Any) -> str:
    |                                                               ^^^
607 |         """生成非权限字段差异的自然语言描述。.
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `new_value`
   --> app/services/accounts_sync/permission_manager.py:606:79
    |
604 |         }
605 |
606 |     def _build_other_description(self, label: str, old_value: Any, new_value: Any) -> str:
    |                                                                               ^^^
607 |         """生成非权限字段差异的自然语言描述。.
    |

C901 `_build_change_summary` is too complex (11 > 10)
   --> app/services/accounts_sync/permission_manager.py:628:9
    |
626 |         return f"{label} 已更新"
627 |
628 |     def _build_change_summary(
    |         ^^^^^^^^^^^^^^^^^^^^^
629 |         self,
630 |         username: str,
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/permission_manager.py:652:39
    |
650 |             grant_count = self._count_permissions_by_action(privilege_diff, "GRANT")
651 |             if grant_count:
652 |                 segments.append(f"新增账户，赋予 {grant_count} 项权限")
    |                                           ^^
653 |             else:
654 |                 segments.append("新增账户")
    |

RUF001 String contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/services/accounts_sync/permission_manager.py:668:42
    |
666 |                     parts.append(f"更新 {alter_count} 项权限")
667 |                 if parts:
668 |                     segments.append("权限更新：" + "，".join(parts))
    |                                              ^^
669 |
670 |             if other_diff:
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/permission_manager.py:668:48
    |
666 |                     parts.append(f"更新 {alter_count} 项权限")
667 |                 if parts:
668 |                     segments.append("权限更新：" + "，".join(parts))
    |                                                     ^^
669 |
670 |             if other_diff:
    |

RUF001 String contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/services/accounts_sync/permission_manager.py:673:42
    |
671 |                 descriptions = [entry.get("description") for entry in other_diff if entry.get("description")]
672 |                 if descriptions:
673 |                     segments.append("其他变更：" + "，".join(descriptions))
    |                                              ^^
674 |
675 |         base = f"账户 {username}"
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/permission_manager.py:673:48
    |
671 |                 descriptions = [entry.get("description") for entry in other_diff if entry.get("description")]
672 |                 if descriptions:
673 |                     segments.append("其他变更：" + "，".join(descriptions))
    |                                                     ^^
674 |
675 |         base = f"账户 {username}"
    |

RUF001 String contains ambiguous `；` (FULLWIDTH SEMICOLON). Did you mean `;` (SEMICOLON)?
   --> app/services/accounts_sync/permission_manager.py:677:34
    |
675 |         base = f"账户 {username}"
676 |         if segments:
677 |             return f"{base} " + "；".join(segments)
    |                                  ^^
678 |         return f"{base} 未发生变更"
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `value`
   --> app/services/accounts_sync/permission_manager.py:681:28
    |
680 |     @staticmethod
681 |     def _is_mapping(value: Any) -> bool:
    |                            ^^^
682 |         """判断值是否为映射类型。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/permission_manager.py:688:31
    |
687 |         Returns:
688 |             bool: 是映射类型返回 True，否则 False。
    |                                      ^^
689 |
690 |         """
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `value`
   --> app/services/accounts_sync/permission_manager.py:694:35
    |
693 |     @staticmethod
694 |     def _normalize_mapping(value: Any) -> dict[str, set]:
    |                                   ^^^
695 |         """将权限映射标准化为 {str: set} 结构。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/accounts_sync/permission_manager.py:701:34
    |
700 |         Returns:
701 |             dict[str, set]: 键为字符串，值为去重集合。
    |                                       ^^
702 |
703 |         """
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `value`
   --> app/services/accounts_sync/permission_manager.py:712:36
    |
711 |     @staticmethod
712 |     def _normalize_sequence(value: Any) -> set:
    |                                    ^^^
713 |         """将单值或序列转换为集合形式。.
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `value`
   --> app/services/accounts_sync/permission_manager.py:729:28
    |
728 |     @staticmethod
729 |     def _repr_value(value: Any) -> str:
    |                            ^^^
730 |         """将值转换为日志友好的文本。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/services/aggregation/aggregation_service.py:3:18
  |
1 | """聚合服务。.
2 |
3 | 支持数据库级与实例级的周期聚合计算，包括日、周、月、季度四种周期类型。
  |                                   ^^
4 | """
  |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/aggregation/aggregation_service.py:32:24
   |
30 |     """聚合服务。.
31 |
32 |     提供数据库级和实例级的周期聚合计算功能，支持日、周、月、季度四种周期类型。
   |                                           ^^
33 |
34 |     Attributes:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/aggregation/aggregation_service.py:74:22
   |
73 |     def _get_instance_or_raise(self, instance_id: int) -> Instance:
74 |         """根据 ID 获取实例，若不存在则抛错。.
   |                            ^^
75 |
76 |         Args:
   |

ARG002 Unused method argument: `target_date`
  --> app/services/aggregation/aggregation_service.py:94:42
   |
92 |         return instance
93 |
94 |     def _ensure_partition_for_date(self, target_date: date) -> None:
   |                                          ^^^^^^^^^^^
95 |         """保留接口，当前环境无需分区预处理。.
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/aggregation/aggregation_service.py:95:16
   |
94 |     def _ensure_partition_for_date(self, target_date: date) -> None:
95 |         """保留接口，当前环境无需分区预处理。.
   |                    ^^
96 |
97 |         Args:
   |

ANN001 Missing type annotation for function argument `aggregation`
   --> app/services/aggregation/aggregation_service.py:106:44
    |
104 |         return
105 |
106 |     def _commit_with_partition_retry(self, aggregation, start_date: date) -> None:
    |                                            ^^^^^^^^^^^
107 |         """提交聚合记录，移除分区重试逻辑。.
    |

ARG002 Unused method argument: `aggregation`
   --> app/services/aggregation/aggregation_service.py:106:44
    |
104 |         return
105 |
106 |     def _commit_with_partition_retry(self, aggregation, start_date: date) -> None:
    |                                            ^^^^^^^^^^^
107 |         """提交聚合记录，移除分区重试逻辑。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/aggregation/aggregation_service.py:107:18
    |
106 |     def _commit_with_partition_retry(self, aggregation, start_date: date) -> None:
107 |         """提交聚合记录，移除分区重试逻辑。.
    |                        ^^
108 |
109 |         Args:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/aggregation/aggregation_service.py:110:32
    |
109 |         Args:
110 |             aggregation: 聚合结果对象，仅用于错误日志。
    |                                      ^^
111 |             start_date: 聚合周期开始日期。
    |

FBT001 Boolean-typed positional argument in function definition
   --> app/services/aggregation/aggregation_service.py:152:61
    |
150 |         return (period_type or "").lower() == "daily"
151 |
152 |     def _resolve_use_current_period(self, period_type: str, override: bool | None = None) -> bool:
    |                                                             ^^^^^^^^
153 |         """结合覆盖配置判断是否使用当前周期。."""
154 |         if override is not None:
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/services/aggregation/aggregation_service.py:189:41
    |
187 |             instance_id: 实例 ID。
188 |             period_type: 周期类型。
189 |             use_current_period: 是否使用当前周期（否则使用上一周期）。
    |                                                 ^^
190 |
191 |         Returns:
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/services/aggregation/aggregation_service.py:189:50
    |
187 |             instance_id: 实例 ID。
188 |             period_type: 周期类型。
189 |             use_current_period: 是否使用当前周期（否则使用上一周期）。
    |                                                                   ^^
190 |
191 |         Returns:
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/aggregation/aggregation_service.py:238:19
    |
236 |         """
237 |         log_info(
238 |             "实例未激活，跳过聚合",
    |                        ^^
239 |             module=MODULE,
240 |             instance_id=instance.id,
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/aggregation/aggregation_service.py:248:45
    |
246 |             instance_name=instance.name,
247 |             period_type=period_type,
248 |             message=f"实例 {instance.name} 未激活，跳过聚合",
    |                                                  ^^
249 |         )
250 |         return summary.to_dict()
    |

ANN001 Missing type annotation for function argument `runner`
   --> app/services/aggregation/aggregation_service.py:255:9
    |
253 |         self,
254 |         *,
255 |         runner,
    |         ^^^^^^
256 |         period_type: str,
257 |         use_current_period: bool,
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/aggregation/aggregation_service.py:307:31
    |
306 |         Args:
307 |             periods: 指定的周期名称列表，如 day/week/month；为空时默认全部。
    |                                        ^^
308 |             use_current_periods: 覆盖各周期是否使用当前周期的设置，键为周期名。
    |

RUF002 Docstring contains ambiguous `；` (FULLWIDTH SEMICOLON). Did you mean `;` (SEMICOLON)?
   --> app/services/aggregation/aggregation_service.py:307:48
    |
306 |         Args:
307 |             periods: 指定的周期名称列表，如 day/week/month；为空时默认全部。
    |                                                           ^^
308 |             use_current_periods: 覆盖各周期是否使用当前周期的设置，键为周期名。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/aggregation/aggregation_service.py:308:50
    |
306 |         Args:
307 |             periods: 指定的周期名称列表，如 day/week/month；为空时默认全部。
308 |             use_current_periods: 覆盖各周期是否使用当前周期的设置，键为周期名。
    |                                                                  ^^
309 |
310 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/aggregation/aggregation_service.py:311:49
    |
310 |         Returns:
311 |             dict[str, Dict[str, Any]]: key 为周期名称，value 为聚合结果字典。
    |                                                      ^^
312 |
313 |         """
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/services/aggregation/aggregation_service.py:325:20
    |
323 |             try:
324 |                 period_result = method(use_current_period=use_current)
325 |             except Exception as exc:  # pragma: no cover - 防御性日志
    |                    ^^^^^^^^^
326 |                 log_error(
327 |                     "数据库级聚合执行失败",
    |

E501 Line too long (121 > 120)
   --> app/services/aggregation/aggregation_service.py:375:121
    |
374 |         failed_periods = [
375 |             period for period, result in period_results.items() if result.get("status") == AggregationStatus.FAILED.value
    |                                                                                                                         ^
376 |         ]
377 |         failed_instance_periods = [
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/aggregation/aggregation_service.py:392:27
    |
390 |             "统计聚合执行完成"
391 |             if overall_status is AggregationStatus.COMPLETED
392 |             else "统计聚合执行完成，但存在失败的周期"
    |                                   ^^
393 |         )
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/services/aggregation/aggregation_service.py:427:20
    |
426 |     def calculate_daily_aggregations(self, *, use_current_period: bool | None = None) -> dict[str, Any]:
427 |         """计算每日统计聚合（处理今日数据）。.
    |                            ^^
428 |
429 |         Args:
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/services/aggregation/aggregation_service.py:427:27
    |
426 |     def calculate_daily_aggregations(self, *, use_current_period: bool | None = None) -> dict[str, Any]:
427 |         """计算每日统计聚合（处理今日数据）。.
    |                                          ^^
428 |
429 |         Args:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/aggregation/aggregation_service.py:430:41
    |
429 |         Args:
430 |             use_current_period: 是否使用当前周期，None 时按默认（每日=当前，其他=上一周期）。
    |                                                 ^^
431 |
432 |         Returns:
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/services/aggregation/aggregation_service.py:430:51
    |
429 |         Args:
430 |             use_current_period: 是否使用当前周期，None 时按默认（每日=当前，其他=上一周期）。
    |                                                                ^^
431 |
432 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/aggregation/aggregation_service.py:430:57
    |
429 |         Args:
430 |             use_current_period: 是否使用当前周期，None 时按默认（每日=当前，其他=上一周期）。
    |                                                                           ^^
431 |
432 |         Returns:
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/services/aggregation/aggregation_service.py:430:65
    |
429 |         Args:
430 |             use_current_period: 是否使用当前周期，None 时按默认（每日=当前，其他=上一周期）。
    |                                                                                          ^^
431 |
432 |         Returns:
    |

C901 `aggregate_current_period` is too complex (11 > 10)
   --> app/services/aggregation/aggregation_service.py:444:9
    |
442 |         )
443 |
444 |     def aggregate_current_period(
    |         ^^^^^^^^^^^^^^^^^^^^^^^^
445 |         self,
446 |         period_type: str = "daily",
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/services/aggregation/aggregation_service.py:451:18
    |
449 |         progress_callbacks: dict[str, dict[str, Callable[..., None]]] | None = None,
450 |     ) -> dict[str, Any]:
451 |         """计算当前周期（含今日）统计聚合。.
    |                        ^^
452 |
453 |         Args:
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/services/aggregation/aggregation_service.py:451:22
    |
449 |         progress_callbacks: dict[str, dict[str, Callable[..., None]]] | None = None,
450 |     ) -> dict[str, Any]:
451 |         """计算当前周期（含今日）统计聚合。.
    |                                ^^
452 |
453 |         Args:
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/services/aggregation/aggregation_service.py:454:30
    |
453 |         Args:
454 |             period_type: 周期类型（daily/weekly/...）。
    |                                  ^^
455 |             scope: 运行范围（database/instance/all）。
456 |             progress_callbacks: 可选回调字典。
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/services/aggregation/aggregation_service.py:454:47
    |
453 |         Args:
454 |             period_type: 周期类型（daily/weekly/...）。
    |                                                    ^^
455 |             scope: 运行范围（database/instance/all）。
456 |             progress_callbacks: 可选回调字典。
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/services/aggregation/aggregation_service.py:455:24
    |
453 |         Args:
454 |             period_type: 周期类型（daily/weekly/...）。
455 |             scope: 运行范围（database/instance/all）。
    |                            ^^
456 |             progress_callbacks: 可选回调字典。
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/services/aggregation/aggregation_service.py:455:46
    |
453 |         Args:
454 |             period_type: 周期类型（daily/weekly/...）。
455 |             scope: 运行范围（database/instance/all）。
    |                                                   ^^
456 |             progress_callbacks: 可选回调字典。
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/aggregation/aggregation_service.py:536:32
    |
534 |         elif AggregationStatus.FAILED.value in statuses:
535 |             overall_status = AggregationStatus.FAILED
536 |             message = "当前周期聚合完成，但存在失败的子任务"
    |                                        ^^
537 |         elif statuses == {AggregationStatus.SKIPPED.value}:
538 |             overall_status = AggregationStatus.SKIPPED
    |

C901 `calculate_instance_aggregations` is too complex (11 > 10)
   --> app/services/aggregation/aggregation_service.py:681:9
    |
679 |         )
680 |
681 |     def calculate_instance_aggregations(
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
682 |         self,
683 |         instance_id: int,
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/services/aggregation/aggregation_service.py:726:20
    |
724 |             try:
725 |                 result = func(instance_id, use_current_period=use_current_period)
726 |             except Exception as exc:  # pragma: no cover - 防御性日志
    |                    ^^^^^^^^^
727 |                 log_error(
728 |                     "实例周期聚合执行失败",
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/aggregation/aggregation_service.py:757:31
    |
755 |         if failed_periods:
756 |             overall_status = AggregationStatus.FAILED
757 |             message = f"实例聚合完成，但以下周期失败: {', '.join(sorted(failed_periods))}"
    |                                     ^^
758 |         elif processed_periods == 0:
759 |             overall_status = AggregationStatus.SKIPPED
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/aggregation/aggregation_service.py:879:29
    |
877 |             instance_id: 实例 ID。
878 |             period_type: 周期类型。
879 |             start_date: 起始日期，可选。
    |                                 ^^
880 |             end_date: 结束日期，可选。
881 |             database_name: 数据库名称筛选，可选。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/aggregation/aggregation_service.py:880:27
    |
878 |             period_type: 周期类型。
879 |             start_date: 起始日期，可选。
880 |             end_date: 结束日期，可选。
    |                               ^^
881 |             database_name: 数据库名称筛选，可选。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/aggregation/aggregation_service.py:881:35
    |
879 |             start_date: 起始日期，可选。
880 |             end_date: 结束日期，可选。
881 |             database_name: 数据库名称筛选，可选。
    |                                          ^^
882 |
883 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/aggregation/aggregation_service.py:907:29
    |
905 |             instance_id: 实例 ID。
906 |             period_type: 周期类型。
907 |             start_date: 起始日期，可选。
    |                                 ^^
908 |             end_date: 结束日期，可选。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/aggregation/aggregation_service.py:908:27
    |
906 |             period_type: 周期类型。
907 |             start_date: 起始日期，可选。
908 |             end_date: 结束日期，可选。
    |                               ^^
909 |
910 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/aggregation/calculator.py:16:21
   |
14 |     """负责计算不同统计周期的日期范围。.
15 |
16 |     支持日、周、月、季度四种统计周期，提供当前周期、上一周期和前一周期的日期范围计算。
   |                                     ^^
17 |
18 |     Attributes:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/aggregation/calculator.py:19:26
   |
18 |     Attributes:
19 |         _now_func: 时间提供函数，用于获取当前日期，可在测试时注入。
   |                                ^^
20 |
21 |     """
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/aggregation/calculator.py:19:35
   |
18 |     Attributes:
19 |         _now_func: 时间提供函数，用于获取当前日期，可在测试时注入。
   |                                                  ^^
20 |
21 |     """
   |

ANN001 Missing type annotation for function argument `now_func`
  --> app/services/aggregation/calculator.py:23:24
   |
21 |     """
22 |
23 |     def __init__(self, now_func=None) -> None:
   |                        ^^^^^^^^
24 |         """初始化周期计算器。.
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/aggregation/calculator.py:27:32
   |
26 |         Args:
27 |             now_func: 可选的时间提供函数，默认使用中国时区的当前日期。
   |                                         ^^
28 |
29 |         """
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/aggregation/calculator.py:46:30
   |
45 |         Args:
46 |             period_type: 周期类型，可选值：'daily'、'weekly'、'monthly'、'quarterly'。
   |                                  ^^
47 |
48 |         Returns:
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/services/aggregation/calculator.py:46:34
   |
45 |         Args:
46 |             period_type: 周期类型，可选值：'daily'、'weekly'、'monthly'、'quarterly'。
   |                                          ^^
47 |
48 |         Returns:
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/services/aggregation/calculator.py:96:11
   |
94 |         """获取当前周期的自然起止日期。.
95 |
96 |         注意：period_end 指向该周期的自然结束日，可能晚于今天。
   |             ^^
97 |
98 |         Args:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/aggregation/calculator.py:96:34
   |
94 |         """获取当前周期的自然起止日期。.
95 |
96 |         注意：period_end 指向该周期的自然结束日，可能晚于今天。
   |                                                ^^
97 |
98 |         Args:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/aggregation/calculator.py:99:30
    |
 98 |         Args:
 99 |             period_type: 周期类型，可选值：'daily'、'weekly'、'monthly'、'quarterly'。
    |                                  ^^
100 |
101 |         Returns:
    |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/services/aggregation/calculator.py:99:34
    |
 98 |         Args:
 99 |             period_type: 周期类型，可选值：'daily'、'weekly'、'monthly'、'quarterly'。
    |                                          ^^
100 |
101 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/aggregation/calculator.py:134:30
    |
133 |         Args:
134 |             period_type: 周期类型，可选值：'daily'、'weekly'、'monthly'、'quarterly'。
    |                                  ^^
135 |             start_date: 当前周期开始日期。
136 |             end_date: 当前周期结束日期。
    |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/services/aggregation/calculator.py:134:34
    |
133 |         Args:
134 |             period_type: 周期类型，可选值：'daily'、'weekly'、'monthly'、'quarterly'。
    |                                          ^^
135 |             start_date: 当前周期开始日期。
136 |             end_date: 当前周期结束日期。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/aggregation/database_aggregation_runner.py:29:26
   |
27 |     """负责数据库级聚合的执行。.
28 |
29 |     从数据库容量统计数据中计算各周期的聚合指标，包括平均值、最大值、
   |                                               ^^
30 |     最小值、变化量和增长率等。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/aggregation/database_aggregation_runner.py:36:22
   |
34 |         _commit_with_partition_retry: 提交数据的回调函数。
35 |         _period_calculator: 周期计算器。
36 |         _module: 模块名称，用于日志记录。
   |                          ^^
37 |
38 |     """
   |

ANN002 Missing type annotation for `*args`
  --> app/services/aggregation/database_aggregation_runner.py:62:70
   |
60 |         self._module = module
61 |
62 |     def _invoke_callback(self, callback: Callable[..., None] | None, *args) -> None:
   |                                                                      ^^^^^
63 |         """安全执行回调。.
   |

BLE001 Do not catch blind exception: `Exception`
  --> app/services/aggregation/database_aggregation_runner.py:77:16
   |
75 |         try:
76 |             callback(*args)
77 |         except Exception as exc:  # pragma: no cover - 防御性处理
   |                ^^^^^^^^^
78 |             log_warning(
79 |                 "聚合回调执行失败",
   |

PLR0913 Too many arguments in function definition (6 > 5)
  --> app/services/aggregation/database_aggregation_runner.py:85:9
   |
83 |             )
84 |
85 |     def aggregate_period(
   |         ^^^^^^^^^^^^^^^^
86 |         self,
87 |         period_type: str,
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/aggregation/database_aggregation_runner.py:97:17
   |
95 |         """聚合所有激活实例在指定周期内的数据库统计。.
96 |
97 |         遍历所有活跃实例，为每个实例的每个数据库计算指定周期的聚合指标。
   |                         ^^
98 |
99 |         Args:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/aggregation/database_aggregation_runner.py:100:30
    |
 99 |         Args:
100 |             period_type: 周期类型，如 'daily'、'weekly'、'monthly'、'quarterly'。
    |                                  ^^
101 |             start_date: 周期开始日期。
102 |             end_date: 周期结束日期。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/aggregation/database_aggregation_runner.py:103:44
    |
101 |             start_date: 周期开始日期。
102 |             end_date: 周期结束日期。
103 |             on_instance_start: 实例开始处理时的回调函数，可选。
    |                                                        ^^
104 |             on_instance_complete: 实例处理完成时的回调函数，可选。
105 |             on_instance_error: 实例处理失败时的回调函数，可选。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/aggregation/database_aggregation_runner.py:104:47
    |
102 |             end_date: 周期结束日期。
103 |             on_instance_start: 实例开始处理时的回调函数，可选。
104 |             on_instance_complete: 实例处理完成时的回调函数，可选。
    |                                                           ^^
105 |             on_instance_error: 实例处理失败时的回调函数，可选。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/aggregation/database_aggregation_runner.py:105:44
    |
103 |             on_instance_start: 实例开始处理时的回调函数，可选。
104 |             on_instance_complete: 实例处理完成时的回调函数，可选。
105 |             on_instance_error: 实例处理失败时的回调函数，可选。
    |                                                        ^^
106 |
107 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/aggregation/database_aggregation_runner.py:108:21
    |
107 |         Returns:
108 |             周期聚合结果字典，包含处理统计和错误信息。
    |                             ^^
109 |
110 |         """
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/aggregation/database_aggregation_runner.py:125:41
    |
123 |                     summary.skipped_instances += 1
124 |                     log_warning(
125 |                         "实例在周期内没有数据库容量数据，跳过聚合",
    |                                                        ^^
126 |                         module=self._module,
127 |                         instance_id=instance.id,
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/aggregation/database_aggregation_runner.py:138:40
    |
136 |                         "message": (
137 |                             f"实例 {instance.name} 在 {start_date.isoformat()} 至 {end_date.isoformat()} "
138 |                             f"没有数据库容量数据，跳过聚合"
    |                                                 ^^
139 |                         ),
140 |                         "errors": [],
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/services/aggregation/database_aggregation_runner.py:187:20
    |
185 |                 }
186 |                 self._invoke_callback(on_instance_complete, instance, result_payload)
187 |             except Exception as exc:  # pragma: no cover - 防御性日志
    |                    ^^^^^^^^^
188 |                 db.session.rollback()
189 |                 summary.failed_instances += 1
    |

RUF001 String contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/services/aggregation/database_aggregation_runner.py:214:37
    |
212 |         if summary.status is AggregationStatus.COMPLETED:
213 |             summary.message = (
214 |                 f"{period_type} 聚合完成：处理 {summary.processed_instances}/{total_instances} 个实例"
    |                                         ^^
215 |             )
216 |         elif summary.status is AggregationStatus.SKIPPED:
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/aggregation/database_aggregation_runner.py:220:37
    |
218 |         else:
219 |             summary.message = (
220 |                 f"{period_type} 聚合完成，{summary.failed_instances} 个实例失败"
    |                                         ^^
221 |             )
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/aggregation/database_aggregation_runner.py:260:34
    |
258 |         if not stats:
259 |             log_warning(
260 |                 "实例在指定周期没有数据库容量数据，跳过聚合",
    |                                                  ^^
261 |                 module=self._module,
262 |                 instance_id=instance.id,
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/aggregation/database_aggregation_runner.py:274:31
    |
272 |                 message=(
273 |                     f"实例 {instance.name} 在 {start_date} 至 {end_date} "
274 |                     "没有数据库容量数据，跳过聚合"
    |                                        ^^
275 |                 ),
276 |                 extra=extra_details,
    |

PLR0913 Too many arguments in function definition (7 > 5)
   --> app/services/aggregation/database_aggregation_runner.py:366:9
    |
364 |         return grouped
365 |
366 |     def _persist_database_aggregation(
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
367 |         self,
368 |         *,
    |

PLR0913 Too many arguments in function definition (6 > 5)
   --> app/services/aggregation/database_aggregation_runner.py:503:9
    |
501 |             ) from exc
502 |
503 |     def _apply_change_statistics(
    |         ^^^^^^^^^^^^^^^^^^^^^^^^
504 |         self,
505 |         *,
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/services/aggregation/database_aggregation_runner.py:583:16
    |
581 |             aggregation.log_size_change_percent = None
582 |             aggregation.growth_rate = aggregation.size_change_percent
583 |         except Exception as exc:  # pragma: no cover - 防御性日志
    |                ^^^^^^^^^
584 |             log_error(
585 |                 "计算数据库增量统计失败，使用默认值",
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/aggregation/database_aggregation_runner.py:585:29
    |
583 |         except Exception as exc:  # pragma: no cover - 防御性日志
584 |             log_error(
585 |                 "计算数据库增量统计失败，使用默认值",
    |                                        ^^
586 |                 module=self._module,
587 |                 exception=exc,
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/aggregation/instance_aggregation_runner.py:29:25
   |
27 |     """负责实例级聚合的执行。.
28 |
29 |     从实例容量统计数据中计算各周期的聚合指标，包括总容量、平均值、
   |                                             ^^
30 |     数据库数量变化和增长趋势等。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/aggregation/instance_aggregation_runner.py:36:22
   |
34 |         _commit_with_partition_retry: 提交数据的回调函数。
35 |         _period_calculator: 周期计算器。
36 |         _module: 模块名称，用于日志记录。
   |                          ^^
37 |
38 |     """
   |

ANN002 Missing type annotation for `*args`
  --> app/services/aggregation/instance_aggregation_runner.py:62:70
   |
60 |         self._module = module
61 |
62 |     def _invoke_callback(self, callback: Callable[..., None] | None, *args) -> None:
   |                                                                      ^^^^^
63 |         """安全地执行回调。.
   |

BLE001 Do not catch blind exception: `Exception`
  --> app/services/aggregation/instance_aggregation_runner.py:77:16
   |
75 |         try:
76 |             callback(*args)
77 |         except Exception as exc:  # pragma: no cover
   |                ^^^^^^^^^
78 |             log_warning(
79 |                 "聚合回调执行失败",
   |

PLR0913 Too many arguments in function definition (6 > 5)
  --> app/services/aggregation/instance_aggregation_runner.py:85:9
   |
83 |             )
84 |
85 |     def aggregate_period(
   |         ^^^^^^^^^^^^^^^^
86 |         self,
87 |         period_type: str,
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/aggregation/instance_aggregation_runner.py:97:17
   |
95 |         """聚合所有激活实例在指定周期内的实例统计。.
96 |
97 |         遍历所有活跃实例，为每个实例计算指定周期的整体聚合指标。
   |                         ^^
98 |
99 |         Args:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/aggregation/instance_aggregation_runner.py:100:30
    |
 99 |         Args:
100 |             period_type: 周期类型，如 'daily'、'weekly'、'monthly'、'quarterly'。
    |                                  ^^
101 |             start_date: 周期开始日期。
102 |             end_date: 周期结束日期。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/aggregation/instance_aggregation_runner.py:103:44
    |
101 |             start_date: 周期开始日期。
102 |             end_date: 周期结束日期。
103 |             on_instance_start: 实例开始处理时的回调函数，可选。
    |                                                        ^^
104 |             on_instance_complete: 实例处理完成时的回调函数，可选。
105 |             on_instance_error: 实例处理失败时的回调函数，可选。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/aggregation/instance_aggregation_runner.py:104:47
    |
102 |             end_date: 周期结束日期。
103 |             on_instance_start: 实例开始处理时的回调函数，可选。
104 |             on_instance_complete: 实例处理完成时的回调函数，可选。
    |                                                           ^^
105 |             on_instance_error: 实例处理失败时的回调函数，可选。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/aggregation/instance_aggregation_runner.py:105:44
    |
103 |             on_instance_start: 实例开始处理时的回调函数，可选。
104 |             on_instance_complete: 实例处理完成时的回调函数，可选。
105 |             on_instance_error: 实例处理失败时的回调函数，可选。
    |                                                        ^^
106 |
107 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/aggregation/instance_aggregation_runner.py:108:21
    |
107 |         Returns:
108 |             周期聚合结果字典，包含处理统计和错误信息。
    |                             ^^
109 |
110 |         """
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/aggregation/instance_aggregation_runner.py:125:42
    |
123 |                     summary.skipped_instances += 1
124 |                     log_warning(
125 |                         "实例在周期内没有实例大小统计数据，跳过实例聚合",
    |                                                          ^^
126 |                         module=self._module,
127 |                         instance_id=instance.id,
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/aggregation/instance_aggregation_runner.py:138:39
    |
136 |                         "message": (
137 |                             f"实例 {instance.name} 在 {start_date.isoformat()} 至 {end_date.isoformat()} "
138 |                             f"没有实例统计数据，跳过聚合"
    |                                               ^^
139 |                         ),
140 |                         "errors": [],
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/services/aggregation/instance_aggregation_runner.py:182:20
    |
180 |                 }
181 |                 self._invoke_callback(on_instance_complete, instance, result_payload)
182 |             except Exception as exc:  # pragma: no cover - 防御性日志
    |                    ^^^^^^^^^
183 |                 db.session.rollback()
184 |                 summary.failed_instances += 1
    |

RUF001 String contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/services/aggregation/instance_aggregation_runner.py:209:39
    |
207 |         if summary.status is AggregationStatus.COMPLETED:
208 |             summary.message = (
209 |                 f"{period_type} 实例聚合完成：处理 {summary.processed_instances}/{total_instances} 个实例"
    |                                             ^^
210 |             )
211 |         elif summary.status is AggregationStatus.SKIPPED:
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/aggregation/instance_aggregation_runner.py:215:39
    |
213 |         else:
214 |             summary.message = (
215 |                 f"{period_type} 实例聚合完成，{summary.failed_instances} 个实例失败"
    |                                             ^^
216 |             )
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/aggregation/instance_aggregation_runner.py:231:23
    |
229 |         end_date: date,
230 |     ) -> InstanceSummary:
231 |         """聚合单个实例的指定周期，并返回汇总信息。.
    |                                  ^^
232 |
233 |         Args:
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/aggregation/instance_aggregation_runner.py:254:31
    |
252 |         if not stats:
253 |             log_warning(
254 |                 "实例在指定周期没有统计数据，跳过实例聚合",
    |                                            ^^
255 |                 module=self._module,
256 |                 instance_id=instance.id,
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/aggregation/instance_aggregation_runner.py:266:80
    |
264 |                 instance_name=instance.name,
265 |                 period_type=period_type,
266 |                 message=f"实例 {instance.name} 在 {start_date} 到 {end_date} 没有统计数据，跳过聚合",
    |                                                                                          ^^
267 |                 extra=extra_details,
268 |             )
    |

PLR0913 Too many arguments in function definition (6 > 5)
   --> app/services/aggregation/instance_aggregation_runner.py:315:9
    |
313 |         ).all()
314 |
315 |     def _persist_instance_aggregation(
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
316 |         self,
317 |         *,
    |

PLR2004 Magic value used in comparison, consider replacing `5` with a constant variable
   --> app/services/aggregation/instance_aggregation_runner.py:519:56
    |
517 |             aggregation.growth_rate = aggregation.total_size_change_percent
518 |
519 |             if aggregation.total_size_change_percent > 5:
    |                                                        ^
520 |                 aggregation.trend_direction = "growing"
521 |             elif aggregation.total_size_change_percent < -5:
    |

PLR2004 Magic value used in comparison, consider replacing `-5` with a constant variable
   --> app/services/aggregation/instance_aggregation_runner.py:521:58
    |
519 |             if aggregation.total_size_change_percent > 5:
520 |                 aggregation.trend_direction = "growing"
521 |             elif aggregation.total_size_change_percent < -5:
    |                                                          ^^
522 |                 aggregation.trend_direction = "shrinking"
523 |             else:
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/services/aggregation/instance_aggregation_runner.py:525:16
    |
523 |             else:
524 |                 aggregation.trend_direction = "stable"
525 |         except Exception as exc:  # pragma: no cover - defensive logging
    |                ^^^^^^^^^
526 |             log_error(
527 |                 "计算实例增量统计失败，使用默认值",
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/aggregation/instance_aggregation_runner.py:527:28
    |
525 |         except Exception as exc:  # pragma: no cover - defensive logging
526 |             log_error(
527 |                 "计算实例增量统计失败，使用默认值",
    |                                      ^^
528 |                 module=self._module,
529 |                 exception=exc,
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/aggregation/query_service.py:30:24
   |
28 |         """获取数据库级聚合数据。.
29 |
30 |         查询指定实例的数据库级聚合记录，支持按时间范围和数据库名称过滤。
   |                                       ^^
31 |
32 |         Args:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/aggregation/query_service.py:34:30
   |
32 |         Args:
33 |             instance_id: 实例 ID。
34 |             period_type: 周期类型，如 'daily'、'weekly'、'monthly'、'quarterly'。
   |                                  ^^
35 |             start_date: 开始日期，可选。
36 |             end_date: 结束日期，可选。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/aggregation/query_service.py:35:29
   |
33 |             instance_id: 实例 ID。
34 |             period_type: 周期类型，如 'daily'、'weekly'、'monthly'、'quarterly'。
35 |             start_date: 开始日期，可选。
   |                                 ^^
36 |             end_date: 结束日期，可选。
37 |             database_name: 数据库名称，可选。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/aggregation/query_service.py:36:27
   |
34 |             period_type: 周期类型，如 'daily'、'weekly'、'monthly'、'quarterly'。
35 |             start_date: 开始日期，可选。
36 |             end_date: 结束日期，可选。
   |                               ^^
37 |             database_name: 数据库名称，可选。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/aggregation/query_service.py:37:33
   |
35 |             start_date: 开始日期，可选。
36 |             end_date: 结束日期，可选。
37 |             database_name: 数据库名称，可选。
   |                                      ^^
38 |
39 |         Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/aggregation/query_service.py:40:23
   |
39 |         Returns:
40 |             格式化的聚合数据列表，按周期开始时间倒序排列。
   |                                 ^^
41 |
42 |         """
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/aggregation/query_service.py:67:23
   |
65 |         """获取实例级聚合数据。.
66 |
67 |         查询指定实例的实例级聚合记录，支持按时间范围过滤。
   |                                     ^^
68 |
69 |         Args:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/aggregation/query_service.py:71:30
   |
69 |         Args:
70 |             instance_id: 实例 ID。
71 |             period_type: 周期类型，如 'daily'、'weekly'、'monthly'、'quarterly'。
   |                                  ^^
72 |             start_date: 开始日期，可选。
73 |             end_date: 结束日期，可选。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/aggregation/query_service.py:72:29
   |
70 |             instance_id: 实例 ID。
71 |             period_type: 周期类型，如 'daily'、'weekly'、'monthly'、'quarterly'。
72 |             start_date: 开始日期，可选。
   |                                 ^^
73 |             end_date: 结束日期，可选。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/aggregation/query_service.py:73:27
   |
71 |             period_type: 周期类型，如 'daily'、'weekly'、'monthly'、'quarterly'。
72 |             start_date: 开始日期，可选。
73 |             end_date: 结束日期，可选。
   |                               ^^
74 |
75 |         Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/aggregation/query_service.py:76:23
   |
75 |         Returns:
76 |             格式化的聚合数据列表，按周期开始时间倒序排列。
   |                                 ^^
77 |
78 |         """
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/aggregation/results.py:20:22
   |
18 |     Attributes:
19 |         COMPLETED: 聚合完成。
20 |         SKIPPED: 聚合跳过（无数据或不需要执行）。
   |                          ^^
21 |         FAILED: 聚合失败。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/aggregation/results.py:20:32
   |
18 |     Attributes:
19 |         COMPLETED: 聚合完成。
20 |         SKIPPED: 聚合跳过（无数据或不需要执行）。
   |                                              ^^
21 |         FAILED: 聚合失败。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/aggregation/results.py:37:26
   |
36 |     Attributes:
37 |         period_type: 周期类型，如 'daily'、'weekly'、'monthly'、'quarterly'。
   |                              ^^
38 |         start_date: 周期开始日期。
39 |         end_date: 周期结束日期。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/aggregation/results.py:77:22
   |
76 |         Returns:
77 |             包含所有字段的字典，日期字段转换为 ISO 8601 格式字符串。
   |                               ^^
78 |
79 |         """
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/aggregation/results.py:102:28
    |
100 |     Attributes:
101 |         instance_id: 实例 ID。
102 |         instance_name: 实例名称，可选。
    |                                ^^
103 |         period_type: 周期类型，如 'daily'、'weekly'、'monthly'、'quarterly'。
104 |         processed_records: 已处理的记录数量。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/aggregation/results.py:103:26
    |
101 |         instance_id: 实例 ID。
102 |         instance_name: 实例名称，可选。
103 |         period_type: 周期类型，如 'daily'、'weekly'、'monthly'、'quarterly'。
    |                              ^^
104 |         processed_records: 已处理的记录数量。
105 |         errors: 错误信息列表。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/aggregation/results.py:137:22
    |
136 |         Returns:
137 |             包含所有字段的字典，可选字段仅在有值时包含。
    |                               ^^
138 |
139 |         """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/services/cache_service.py:1:13
  |
1 | """鲸落 - 缓存服务，提供统一的 Flask-Caching 接口。."""
  |                   ^^
2 |
3 | import hashlib
  |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/cache_service.py:19:27
   |
17 |     """缓存服务。.
18 |
19 |     提供统一的 Flask-Caching 接口，支持规则评估缓存、分类规则缓存等功能。
   |                                  ^^
20 |
21 |     Attributes:
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/cache_service.py:23:30
   |
21 |     Attributes:
22 |         cache: Flask-Caching 实例。
23 |         default_ttl: 默认缓存过期时间（秒）。
   |                                      ^^
24 |
25 |     """
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/cache_service.py:23:32
   |
21 |     Attributes:
22 |         cache: Flask-Caching 实例。
23 |         default_ttl: 默认缓存过期时间（秒）。
   |                                          ^^
24 |
25 |     """
   |

D107 Missing docstring in `__init__`
  --> app/services/cache_service.py:27:9
   |
25 |     """
26 |
27 |     def __init__(self, cache: Cache = None) -> None:
   |         ^^^^^^^^
28 |         self.cache = cache
29 |         self.default_ttl = Config.CACHE_DEFAULT_TTL  # 7天，按用户要求
   |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/cache_service.py:29:58
   |
27 |     def __init__(self, cache: Cache = None) -> None:
28 |         self.cache = cache
29 |         self.default_ttl = Config.CACHE_DEFAULT_TTL  # 7天，按用户要求
   |                                                           ^^
30 |
31 |     def _generate_cache_key(self, prefix: str, instance_id: int, username: str, db_name: str | None = None) -> str:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/cache_service.py:43:19
   |
42 |         Returns:
43 |             生成的缓存键，格式为 'whalefall:{hash}'。
   |                         ^^
44 |
45 |         """
   |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/cache_service.py:63:31
   |
62 |         """
63 |         # Flask-Caching不支持模式匹配，简化实现
   |                                      ^^
64 |         # 这里返回True，表示操作成功
65 |         logger.info("清除用户缓存", username=username, instance_id=instance_id)
   |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/cache_service.py:64:19
   |
62 |         """
63 |         # Flask-Caching不支持模式匹配，简化实现
64 |         # 这里返回True，表示操作成功
   |                       ^^
65 |         logger.info("清除用户缓存", username=username, instance_id=instance_id)
66 |         return True
   |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/cache_service.py:78:31
   |
77 |         """
78 |         # Flask-Caching不支持模式匹配，简化实现
   |                                      ^^
79 |         # 这里返回True，表示操作成功
80 |         logger.info("清除实例缓存", instance_id=instance_id)
   |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/cache_service.py:79:19
   |
77 |         """
78 |         # Flask-Caching不支持模式匹配，简化实现
79 |         # 这里返回True，表示操作成功
   |                       ^^
80 |         logger.info("清除实例缓存", instance_id=instance_id)
81 |         return True
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/cache_service.py:87:25
   |
86 |         Returns:
87 |             包含缓存状态和信息的字典，格式如下：
   |                                     ^^
88 |             {
89 |                 'status': 'connected',  # 或 'no_cache'、'error'
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/services/cache_service.py:87:30
   |
86 |         Returns:
87 |             包含缓存状态和信息的字典，格式如下：
   |                                               ^^
88 |             {
89 |                 'status': 'connected',  # 或 'no_cache'、'error'
   |

BLE001 Do not catch blind exception: `Exception`
   --> app/services/cache_service.py:100:16
    |
 98 |             info = self.cache.cache.info() if hasattr(self.cache.cache, "info") else "未获取到缓存详情"
 99 |             result = {"status": "connected", "info": info}
100 |         except Exception as exc:
    |                ^^^^^^^^^
101 |             result = {"status": "error", "error": str(exc)}
102 |         return result
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/services/cache_service.py:112:20
    |
111 |         Returns:
112 |             缓存的评估结果（True/False），缓存未命中或出错时返回 None。
    |                           ^^
113 |
114 |         """
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/services/cache_service.py:112:31
    |
111 |         Returns:
112 |             缓存的评估结果（True/False），缓存未命中或出错时返回 None。
    |                                       ^^
113 |
114 |         """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/cache_service.py:112:32
    |
111 |         Returns:
112 |             缓存的评估结果（True/False），缓存未命中或出错时返回 None。
    |                                         ^^
113 |
114 |         """
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/services/cache_service.py:132:16
    |
130 |                 )
131 |                 result = data.get("result")
132 |         except Exception as exc:
    |                ^^^^^^^^^
133 |             logger.warning(
134 |                 "获取规则评估缓存失败",
    |

FBT001 Boolean-typed positional argument in function definition
   --> app/services/cache_service.py:141:72
    |
139 |         return result
140 |
141 |     def set_rule_evaluation_cache(self, rule_id: int, account_id: int, result: bool, ttl: int | None = None) -> bool:
    |                                                                        ^^^^^^
142 |         """设置规则评估缓存。.
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/services/cache_service.py:148:24
    |
146 |             account_id: 账户 ID。
147 |             result: 评估结果。
148 |             ttl: 缓存过期时间（秒），默认使用配置的规则评估缓存时间。
    |                              ^^
149 |
150 |         Returns:
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/services/cache_service.py:148:26
    |
146 |             account_id: 账户 ID。
147 |             result: 评估结果。
148 |             ttl: 缓存过期时间（秒），默认使用配置的规则评估缓存时间。
    |                                  ^^
149 |
150 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/cache_service.py:148:27
    |
146 |             account_id: 账户 ID。
147 |             result: 评估结果。
148 |             ttl: 缓存过期时间（秒），默认使用配置的规则评估缓存时间。
    |                                    ^^
149 |
150 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/cache_service.py:151:22
    |
150 |         Returns:
151 |             成功返回 True，失败返回 False。
    |                          ^^
152 |
153 |         """
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/services/cache_service.py:177:16
    |
175 |             )
176 |             success = True
177 |         except Exception as exc:
    |                ^^^^^^^^^
178 |             logger.warning(
179 |                 "设置规则评估缓存失败",
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/cache_service.py:190:20
    |
189 |         Returns:
190 |             缓存的规则列表，缓存未命中或出错时返回 None。
    |                           ^^
191 |
192 |         """
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/services/cache_service.py:205:16
    |
203 |                 logger.debug("分类规则缓存命中", cache_key=cache_key)
204 |                 result = data
205 |         except Exception as exc:
    |                ^^^^^^^^^
206 |             logger.warning("获取分类规则缓存失败", error=str(exc))
207 |         return result
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/services/cache_service.py:214:24
    |
212 |         Args:
213 |             rules: 规则列表。
214 |             ttl: 缓存过期时间（秒），默认使用配置的规则缓存时间。
    |                              ^^
215 |
216 |         Returns:
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/services/cache_service.py:214:26
    |
212 |         Args:
213 |             rules: 规则列表。
214 |             ttl: 缓存过期时间（秒），默认使用配置的规则缓存时间。
    |                                  ^^
215 |
216 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/cache_service.py:214:27
    |
212 |         Args:
213 |             rules: 规则列表。
214 |             ttl: 缓存过期时间（秒），默认使用配置的规则缓存时间。
    |                                    ^^
215 |
216 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/cache_service.py:217:22
    |
216 |         Returns:
217 |             成功返回 True，失败返回 False。
    |                          ^^
218 |
219 |         """
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/services/cache_service.py:236:16
    |
234 |             logger.debug("分类规则缓存已设置", cache_key=cache_key, ttl=ttl, count=len(rules))
235 |             success = True
236 |         except Exception as exc:
    |                ^^^^^^^^^
237 |             logger.warning("设置分类规则缓存失败", error=str(exc))
238 |         return success
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/cache_service.py:247:22
    |
246 |         Returns:
247 |             成功返回 True，失败返回 False。
    |                          ^^
248 |
249 |         """
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/services/cache_service.py:259:16
    |
257 |             logger.info("清除账户缓存", account_id=account_id)
258 |             success = True
259 |         except Exception as exc:
    |                ^^^^^^^^^
260 |             logger.warning("清除账户缓存失败", account_id=account_id, error=str(exc))
261 |         return success
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/cache_service.py:267:22
    |
266 |         Returns:
267 |             成功返回 True，失败返回 False。
    |                          ^^
268 |
269 |         """
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/services/cache_service.py:280:16
    |
278 |             logger.info("清除分类缓存")
279 |             success = True
280 |         except Exception as exc:
    |                ^^^^^^^^^
281 |             logger.warning("清除分类缓存失败", error=str(exc))
282 |         return success
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/cache_service.py:288:22
    |
287 |         Returns:
288 |             成功返回 True，失败返回 False。
    |                          ^^
289 |
290 |         """
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/services/cache_service.py:298:16
    |
296 |             logger.info("清除所有规则评估缓存")
297 |             success = True
298 |         except Exception as exc:
    |                ^^^^^^^^^
299 |             logger.warning("清除所有规则评估缓存失败", error=str(exc))
300 |         return success
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/cache_service.py:306:27
    |
305 |         Args:
306 |             db_type: 数据库类型，如 'mysql'、'postgresql'。
    |                                ^^
307 |
308 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/cache_service.py:309:20
    |
308 |         Returns:
309 |             缓存的规则列表，缓存未命中或出错时返回 None。
    |                           ^^
310 |
311 |         """
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/services/cache_service.py:340:16
    |
338 |                 else:
339 |                     logger.warning("数据库类型规则缓存格式错误", db_type=db_type, cache_key=cache_key)
340 |         except Exception as exc:
    |                ^^^^^^^^^
341 |             logger.warning("获取数据库类型规则缓存失败", db_type=db_type, error=str(exc))
342 |         return rules
    |

E501 Line too long (131 > 120)
   --> app/services/cache_service.py:344:121
    |
342 |         return rules
343 |
344 |     def set_classification_rules_by_db_type_cache(self, db_type: str, rules: list[dict[str, Any]], ttl: int | None = None) -> bool:
    |                                                                                                                         ^^^^^^^^^^^
345 |         """设置按数据库类型分类的规则缓存。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/cache_service.py:348:27
    |
347 |         Args:
348 |             db_type: 数据库类型，如 'mysql'、'postgresql'。
    |                                ^^
349 |             rules: 规则列表。
350 |             ttl: 缓存过期时间（秒），默认使用配置的规则缓存时间。
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/services/cache_service.py:350:24
    |
348 |             db_type: 数据库类型，如 'mysql'、'postgresql'。
349 |             rules: 规则列表。
350 |             ttl: 缓存过期时间（秒），默认使用配置的规则缓存时间。
    |                              ^^
351 |
352 |         Returns:
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/services/cache_service.py:350:26
    |
348 |             db_type: 数据库类型，如 'mysql'、'postgresql'。
349 |             rules: 规则列表。
350 |             ttl: 缓存过期时间（秒），默认使用配置的规则缓存时间。
    |                                  ^^
351 |
352 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/cache_service.py:350:27
    |
348 |             db_type: 数据库类型，如 'mysql'、'postgresql'。
349 |             rules: 规则列表。
350 |             ttl: 缓存过期时间（秒），默认使用配置的规则缓存时间。
    |                                    ^^
351 |
352 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/cache_service.py:353:22
    |
352 |         Returns:
353 |             成功返回 True，失败返回 False。
    |                          ^^
354 |
355 |         """
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/services/cache_service.py:379:16
    |
377 |             )
378 |             success = True
379 |         except Exception as exc:
    |                ^^^^^^^^^
380 |             logger.warning("设置数据库类型规则缓存失败", db_type=db_type, error=str(exc))
381 |         return success
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/cache_service.py:387:27
    |
386 |         Args:
387 |             db_type: 数据库类型，如 'mysql'、'postgresql'。
    |                                ^^
388 |
389 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/cache_service.py:390:22
    |
389 |         Returns:
390 |             成功返回 True，失败返回 False。
    |                          ^^
391 |
392 |         """
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/services/cache_service.py:402:16
    |
400 |             logger.info("清除数据库类型缓存", db_type=db_type)
401 |             success = True
402 |         except Exception as exc:
    |                ^^^^^^^^^
403 |             logger.warning("清除数据库类型缓存失败", db_type=db_type, error=str(exc))
404 |         return success
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/cache_service.py:410:22
    |
409 |         Returns:
410 |             成功返回 True，失败返回 False。
    |                          ^^
411 |
412 |         """
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/services/cache_service.py:424:16
    |
422 |             logger.info("清除所有数据库类型缓存")
423 |             success = True
424 |         except Exception as exc:
    |                ^^^^^^^^^
425 |             logger.warning("清除所有数据库类型缓存失败", error=str(exc))
426 |         return success
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/cache_service.py:434:26
    |
433 |         Returns:
434 |             如果缓存正常返回 True，否则返回 False。
    |                                  ^^
435 |
436 |         """
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/services/cache_service.py:448:16
    |
446 |             self.cache.delete(test_key)
447 |             is_healthy = result == test_value
448 |         except Exception as exc:
    |                ^^^^^^^^^
449 |             logger.warning("缓存健康检查失败", error=str(exc))
450 |         return is_healthy
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/cache_service.py:477:13
    |
476 | def init_cache_manager(cache: Cache) -> CacheService:
477 |     """兼容旧入口，内部调用新的初始化方法。.
    |                  ^^
478 |
479 |     Args:
    |

D205 1 blank line required between summary line and description
 --> app/services/connection_adapters/__init__.py:1:1
  |
1 | / """鲸落 - 连接适配器模块
2 | | 集中提供数据库连接工厂与连接测试服务.
3 | | """
  | |___^
4 |
5 |   from .connection_factory import ConnectionFactory
  |
help: Insert single blank line

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/connection_adapters/adapters/base.py:19:25
   |
18 |     Args:
19 |         db_type: 数据库类型名称（如 'mysql'、'postgresql'）。
   |                                ^^
20 |
21 |     Returns:
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/connection_adapters/adapters/base.py:19:48
   |
18 |     Args:
19 |         db_type: 数据库类型名称（如 'mysql'、'postgresql'）。
   |                                                          ^^
20 |
21 |     Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/connection_adapters/adapters/base.py:22:21
   |
21 |     Returns:
22 |         默认 schema 名称，如果未配置则返回空字符串。
   |                         ^^
23 |
24 |     Example:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/connection_adapters/adapters/base.py:36:17
   |
34 |     """数据库连接抽象基类。.
35 |
36 |     定义数据库连接的标准接口，所有数据库类型的连接适配器都应继承此基类。
   |                             ^^
37 |
38 |     Attributes:
   |

D107 Missing docstring in `__init__`
  --> app/services/connection_adapters/adapters/base.py:52:9
   |
50 |     """
51 |
52 |     def __init__(self, instance: Instance) -> None:
   |         ^^^^^^^^
53 |         self.instance = instance
54 |         self.db_logger = get_db_logger()
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/connection_adapters/adapters/base.py:63:24
   |
62 |         Returns:
63 |             连接成功返回 True，失败返回 False。
   |                              ^^
64 |
65 |         Raises:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/connection_adapters/adapters/base.py:87:19
   |
86 |         Returns:
87 |             测试结果字典，包含连接状态、版本信息等。
   |                         ^^
88 |
89 |         Raises:
   |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `params`
  --> app/services/connection_adapters/adapters/base.py:95:49
   |
94 |     @abstractmethod
95 |     def execute_query(self, query: str, params: Any | None = None) -> Any:
   |                                                 ^^^^^^^^^^
96 |         """执行查询并返回结果。.
   |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `execute_query`
  --> app/services/connection_adapters/adapters/base.py:95:71
   |
94 |     @abstractmethod
95 |     def execute_query(self, query: str, params: Any | None = None) -> Any:
   |                                                                       ^^^
96 |         """执行查询并返回结果。.
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/connection_adapters/adapters/base.py:103:17
    |
102 |         Returns:
103 |             查询结果，通常为行列表。
    |                     ^^
104 |
105 |         Raises:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/connection_adapters/adapters/base.py:115:21
    |
114 |         Returns:
115 |             数据库版本字符串，获取失败返回 None。
    |                             ^^
116 |
117 |         Raises:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/connection_adapters/adapters/mysql_adapter.py:17:30
   |
16 |         Returns:
17 |             bool: 连接成功返回 True，失败返回 False。
   |                                    ^^
18 |
19 |         """
   |

PLC0415 `import` should be at the top-level of a file
  --> app/services/connection_adapters/adapters/mysql_adapter.py:21:13
   |
19 |         """
20 |         try:
21 |             import pymysql
   |             ^^^^^^^^^^^^^^
22 |
23 |             password = self.instance.credential.get_plain_password() if self.instance.credential else ""
   |

TRY300 Consider moving this statement to an `else` block
  --> app/services/connection_adapters/adapters/mysql_adapter.py:39:13
   |
37 |             )
38 |             self.is_connected = True
39 |             return True
   |             ^^^^^^^^^^^
40 |         except Exception as exc:
41 |             self.db_logger.exception(
   |

TRY300 Consider moving this statement to an `else` block
  --> app/services/connection_adapters/adapters/mysql_adapter.py:79:13
   |
78 |               version = self.get_version()
79 | /             return {
80 | |                 "success": True,
81 | |                 "message": f"MySQL连接成功 (主机: {self.instance.host}:{self.instance.port}, 版本: {version or '未知'})",
82 | |                 "database_version": version,
83 | |             }
   | |_____________^
84 |           except Exception as exc:
85 |               return {"success": False, "error": str(exc)}
   |

E501 Line too long (121 > 120)
  --> app/services/connection_adapters/adapters/mysql_adapter.py:81:111
   |
79 |             return {
80 |                 "success": True,
81 |                 "message": f"MySQL连接成功 (主机: {self.instance.host}:{self.instance.port}, 版本: {version or '未知'})",
   |                                                                                                                         ^
82 |                 "database_version": version,
83 |             }
   |

BLE001 Do not catch blind exception: `Exception`
  --> app/services/connection_adapters/adapters/mysql_adapter.py:84:16
   |
82 |                 "database_version": version,
83 |             }
84 |         except Exception as exc:
   |                ^^^^^^^^^
85 |             return {"success": False, "error": str(exc)}
86 |         finally:
   |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `execute_query`
  --> app/services/connection_adapters/adapters/mysql_adapter.py:89:73
   |
87 |             self.disconnect()
88 |
89 |     def execute_query(self, query: str, params: tuple | None = None) -> Any:
   |                                                                         ^^^
90 |         """执行 SQL 查询并返回全部结果。.
   |

TRY002 Create your own exception
   --> app/services/connection_adapters/adapters/mysql_adapter.py:102:19
    |
100 |         if not self.is_connected and not self.connect():
101 |             msg = "无法建立数据库连接"
102 |             raise Exception(msg)
    |                   ^^^^^^^^^^^^^^
103 |
104 |         cursor = self.connection.cursor()
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/connection_adapters/adapters/mysql_adapter.py:115:35
    |
114 |         Returns:
115 |             str | None: 成功时返回版本字符串，否则 None。
    |                                             ^^
116 |
117 |         """
    |

TRY300 Consider moving this statement to an `else` block
   --> app/services/connection_adapters/adapters/mysql_adapter.py:122:13
    |
120 |             if result:
121 |                 return result[0][0]
122 |             return None
    |             ^^^^^^^^^^^
123 |         except Exception:
124 |             return None
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/services/connection_adapters/adapters/mysql_adapter.py:123:16
    |
121 |                 return result[0][0]
122 |             return None
123 |         except Exception:
    |                ^^^^^^^^^
124 |             return None
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/connection_adapters/adapters/oracle_adapter.py:17:30
   |
16 |         Returns:
17 |             bool: 连接成功返回 True，失败返回 False。
   |                                    ^^
18 |
19 |         """
   |

PLC0415 `import` should be at the top-level of a file
  --> app/services/connection_adapters/adapters/oracle_adapter.py:22:13
   |
20 |         username_for_connection = None
21 |         try:
22 |             import os
   |             ^^^^^^^^^
23 |
24 |             import oracledb
   |

PLC0415 `import` should be at the top-level of a file
  --> app/services/connection_adapters/adapters/oracle_adapter.py:24:13
   |
22 |             import os
23 |
24 |             import oracledb
   |             ^^^^^^^^^^^^^^^
25 |
26 |             password = self.instance.credential.get_plain_password() if self.instance.credential else ""
   |

E501 Line too long (129 > 120)
  --> app/services/connection_adapters/adapters/oracle_adapter.py:32:121
   |
30 |             port = self.instance.port
31 |             service_name = self.instance.database_name or "ORCL"
32 |             dsn = f"(DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST={host})(PORT={port}))(CONNECT_DATA=(SERVICE_NAME={service_name})))"
   |                                                                                                                         ^^^^^^^^^
33 |
34 |             if not hasattr(oracledb, "is_thin") or not oracledb.is_thin():
   |

PTH118 `os.path.join()` should be replaced by `Path` with `/` operator
  --> app/services/connection_adapters/adapters/oracle_adapter.py:43:48
   |
41 |                     oracle_home = os.getenv("ORACLE_HOME")
42 |                     if oracle_home:
43 |                         candidate_paths.append(os.path.join(oracle_home, "lib"))
   |                                                ^^^^^^^^^^^^
44 |
45 |                     current_dir = os.path.dirname(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))
   |

PTH120 `os.path.dirname()` should be replaced by `Path.parent`
  --> app/services/connection_adapters/adapters/oracle_adapter.py:45:35
   |
43 |                         candidate_paths.append(os.path.join(oracle_home, "lib"))
44 |
45 |                     current_dir = os.path.dirname(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))
   |                                   ^^^^^^^^^^^^^^^
46 |                     candidate_paths.append(os.path.join(current_dir, "oracle_client", "lib"))
   |
help: Replace with `Path(...).parent`

PTH120 `os.path.dirname()` should be replaced by `Path.parent`
  --> app/services/connection_adapters/adapters/oracle_adapter.py:45:51
   |
43 |                         candidate_paths.append(os.path.join(oracle_home, "lib"))
44 |
45 |                     current_dir = os.path.dirname(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))
   |                                                   ^^^^^^^^^^^^^^^
46 |                     candidate_paths.append(os.path.join(current_dir, "oracle_client", "lib"))
   |
help: Replace with `Path(...).parent`

PTH120 `os.path.dirname()` should be replaced by `Path.parent`
  --> app/services/connection_adapters/adapters/oracle_adapter.py:45:67
   |
43 |                         candidate_paths.append(os.path.join(oracle_home, "lib"))
44 |
45 |                     current_dir = os.path.dirname(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))
   |                                                                   ^^^^^^^^^^^^^^^
46 |                     candidate_paths.append(os.path.join(current_dir, "oracle_client", "lib"))
   |
help: Replace with `Path(...).parent`

PTH100 `os.path.abspath()` should be replaced by `Path.resolve()`
  --> app/services/connection_adapters/adapters/oracle_adapter.py:45:83
   |
43 |                         candidate_paths.append(os.path.join(oracle_home, "lib"))
44 |
45 |                     current_dir = os.path.dirname(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))
   |                                                                                   ^^^^^^^^^^^^^^^
46 |                     candidate_paths.append(os.path.join(current_dir, "oracle_client", "lib"))
   |
help: Replace with `Path(...).resolve()`

PTH118 `os.path.join()` should be replaced by `Path` with `/` operator
  --> app/services/connection_adapters/adapters/oracle_adapter.py:46:44
   |
45 |                     current_dir = os.path.dirname(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))
46 |                     candidate_paths.append(os.path.join(current_dir, "oracle_client", "lib"))
   |                                            ^^^^^^^^^^^^
47 |
48 |                     lib_dir = next((path for path in candidate_paths if path and os.path.isdir(path)), None)
   |

PTH112 `os.path.isdir()` should be replaced by `Path.is_dir()`
  --> app/services/connection_adapters/adapters/oracle_adapter.py:48:82
   |
46 |                     candidate_paths.append(os.path.join(current_dir, "oracle_client", "lib"))
47 |
48 |                     lib_dir = next((path for path in candidate_paths if path and os.path.isdir(path)), None)
   |                                                                                  ^^^^^^^^^^^^^
49 |                     if lib_dir:
50 |                         oracledb.init_oracle_client(lib_dir=lib_dir)
   |
help: Replace with `Path(...).is_dir()`

BLE001 Do not catch blind exception: `Exception`
  --> app/services/connection_adapters/adapters/oracle_adapter.py:53:24
   |
51 |                     else:
52 |                         oracledb.init_oracle_client()
53 |                 except Exception as init_error:
   |                        ^^^^^^^^^
54 |                     if "already been initialized" not in str(init_error).lower():
55 |                         self.db_logger.warning(
   |

TRY300 Consider moving this statement to an `else` block
  --> app/services/connection_adapters/adapters/oracle_adapter.py:74:13
   |
72 |                 username=username_for_connection,
73 |             )
74 |             return True
   |             ^^^^^^^^^^^
75 |         except Exception as exc:
76 |             self.db_logger.exception(
   |

TRY300 Consider moving this statement to an `else` block
   --> app/services/connection_adapters/adapters/oracle_adapter.py:118:13
    |
117 |               version = self.get_version()
118 | /             return {
119 | |                 "success": True,
120 | |                 "message": f"Oracle连接成功 (主机: {self.instance.host}:{self.instance.port}, 版本: {version or '未知'})",
121 | |                 "database_version": version,
122 | |             }
    | |_____________^
123 |           except Exception as exc:
124 |               return {"success": False, "error": str(exc)}
    |

E501 Line too long (122 > 120)
   --> app/services/connection_adapters/adapters/oracle_adapter.py:120:111
    |
118 |             return {
119 |                 "success": True,
120 |                 "message": f"Oracle连接成功 (主机: {self.instance.host}:{self.instance.port}, 版本: {version or '未知'})",
    |                                                                                                                         ^^
121 |                 "database_version": version,
122 |             }
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/services/connection_adapters/adapters/oracle_adapter.py:123:16
    |
121 |                 "database_version": version,
122 |             }
123 |         except Exception as exc:
    |                ^^^^^^^^^
124 |             return {"success": False, "error": str(exc)}
125 |         finally:
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `execute_query`
   --> app/services/connection_adapters/adapters/oracle_adapter.py:128:80
    |
126 |             self.disconnect()
127 |
128 |     def execute_query(self, query: str, params: tuple | dict | None = None) -> Any:
    |                                                                                ^^^
129 |         """执行 SQL 查询并返回全部行。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/connection_adapters/adapters/oracle_adapter.py:133:25
    |
131 |         Args:
132 |             query: SQL 语句。
133 |             params: 查询参数，可为 tuple 或 dict。
    |                             ^^
134 |
135 |         Returns:
    |

TRY002 Create your own exception
   --> app/services/connection_adapters/adapters/oracle_adapter.py:141:19
    |
139 |         if not self.is_connected and not self.connect():
140 |             msg = "无法建立数据库连接"
141 |             raise Exception(msg)
    |                   ^^^^^^^^^^^^^^
142 |
143 |         cursor = self.connection.cursor()
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/connection_adapters/adapters/oracle_adapter.py:154:28
    |
153 |         Returns:
154 |             str | None: 版本号，获取失败返回 None。
    |                               ^^
155 |
156 |         """
    |

TRY300 Consider moving this statement to an `else` block
   --> app/services/connection_adapters/adapters/oracle_adapter.py:161:13
    |
159 |             if result:
160 |                 return result[0][0]
161 |             return None
    |             ^^^^^^^^^^^
162 |         except Exception:
163 |             return None
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/services/connection_adapters/adapters/oracle_adapter.py:162:16
    |
160 |                 return result[0][0]
161 |             return None
162 |         except Exception:
    |                ^^^^^^^^^
163 |             return None
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/connection_adapters/adapters/postgresql_adapter.py:17:30
   |
16 |         Returns:
17 |             bool: 连接成功返回 True，否则 False。
   |                                    ^^
18 |
19 |         """
   |

PLC0415 `import` should be at the top-level of a file
  --> app/services/connection_adapters/adapters/postgresql_adapter.py:21:13
   |
19 |         """
20 |         try:
21 |             import psycopg
   |             ^^^^^^^^^^^^^^
22 |
23 |             password = self.instance.credential.get_plain_password() if self.instance.credential else ""
   |

TRY300 Consider moving this statement to an `else` block
  --> app/services/connection_adapters/adapters/postgresql_adapter.py:35:13
   |
33 |             )
34 |             self.is_connected = True
35 |             return True
   |             ^^^^^^^^^^^
36 |         except Exception as exc:
37 |             self.db_logger.exception(
   |

TRY300 Consider moving this statement to an `else` block
  --> app/services/connection_adapters/adapters/postgresql_adapter.py:75:13
   |
74 |   …         version = self.get_version()
75 | / …         return {
76 | | …             "success": True,
77 | | …             "message": f"PostgreSQL连接成功 (主机: {self.instance.host}:{self.instance.port}, 版本: {version or '未知'})",
78 | | …             "database_version": version,
79 | | …         }
   | |___________^
80 |   …     except Exception as exc:
81 |   …         return {"success": False, "error": str(exc)}
   |

E501 Line too long (126 > 120)
  --> app/services/connection_adapters/adapters/postgresql_adapter.py:77:112
   |
75 | …     return {
76 | …         "success": True,
77 | …         "message": f"PostgreSQL连接成功 (主机: {self.instance.host}:{self.instance.port}, 版本: {version or '未知'})",
   |                                                                                                                    ^^^^^
78 | …         "database_version": version,
79 | …     }
   |

BLE001 Do not catch blind exception: `Exception`
  --> app/services/connection_adapters/adapters/postgresql_adapter.py:80:16
   |
78 |                 "database_version": version,
79 |             }
80 |         except Exception as exc:
   |                ^^^^^^^^^
81 |             return {"success": False, "error": str(exc)}
82 |         finally:
   |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `execute_query`
  --> app/services/connection_adapters/adapters/postgresql_adapter.py:85:73
   |
83 |             self.disconnect()
84 |
85 |     def execute_query(self, query: str, params: tuple | None = None) -> Any:
   |                                                                         ^^^
86 |         """执行 SQL 查询并返回所有结果。.
   |

TRY002 Create your own exception
   --> app/services/connection_adapters/adapters/postgresql_adapter.py:98:19
    |
 96 |         if not self.is_connected and not self.connect():
 97 |             msg = "无法建立数据库连接"
 98 |             raise Exception(msg)
    |                   ^^^^^^^^^^^^^^
 99 |
100 |         cursor = self.connection.cursor()
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/connection_adapters/adapters/postgresql_adapter.py:111:28
    |
110 |         Returns:
111 |             str | None: 版本号，失败返回 None。
    |                               ^^
112 |
113 |         """
    |

TRY300 Consider moving this statement to an `else` block
   --> app/services/connection_adapters/adapters/postgresql_adapter.py:118:13
    |
116 |             if result:
117 |                 return result[0][0]
118 |             return None
    |             ^^^^^^^^^^^
119 |         except Exception:
120 |             return None
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/services/connection_adapters/adapters/postgresql_adapter.py:119:16
    |
117 |                 return result[0][0]
118 |             return None
119 |         except Exception:
    |                ^^^^^^^^^
120 |             return None
    |

D107 Missing docstring in `__init__`
  --> app/services/connection_adapters/adapters/sqlserver_adapter.py:15:9
   |
13 |     """SQL Server 数据库连接。."""
14 |
15 |     def __init__(self, instance: Any) -> None:
   |         ^^^^^^^^
16 |         super().__init__(instance)
17 |         self.driver_type: str | None = None
   |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `instance`
  --> app/services/connection_adapters/adapters/sqlserver_adapter.py:15:34
   |
13 |     """SQL Server 数据库连接。."""
14 |
15 |     def __init__(self, instance: Any) -> None:
   |                                  ^^^
16 |         super().__init__(instance)
17 |         self.driver_type: str | None = None
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/connection_adapters/adapters/sqlserver_adapter.py:20:28
   |
19 |     def connect(self) -> bool:
20 |         """建立 SQL Server 连接（当前仅支持 pymssql）。.
   |                                ^^
21 |
22 |         Returns:
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/connection_adapters/adapters/sqlserver_adapter.py:20:42
   |
19 |     def connect(self) -> bool:
20 |         """建立 SQL Server 连接（当前仅支持 pymssql）。.
   |                                                    ^^
21 |
22 |         Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/connection_adapters/adapters/sqlserver_adapter.py:23:30
   |
22 |         Returns:
23 |             bool: 连接成功返回 True，失败返回 False。
   |                                    ^^
24 |
25 |         """
   |

PLC0415 `import` should be at the top-level of a file
  --> app/services/connection_adapters/adapters/sqlserver_adapter.py:60:13
   |
58 |         """
59 |         try:
60 |             import pymssql
   |             ^^^^^^^^^^^^^^
61 |
62 |             self.connection = pymssql.connect(
   |

TRY300 Consider moving this statement to an `else` block
  --> app/services/connection_adapters/adapters/sqlserver_adapter.py:74:13
   |
72 |             self.is_connected = True
73 |             self.driver_type = "pymssql"
74 |             return True
   |             ^^^^^^^^^^^
75 |         except ImportError:
76 |             self.db_logger.exception(
   |

BLE001 Do not catch blind exception: `Exception`
   --> app/services/connection_adapters/adapters/sqlserver_adapter.py:112:20
    |
110 |             try:
111 |                 self.connection.close()
112 |             except Exception as exc:
    |                    ^^^^^^^^^
113 |                 self.db_logger.warning(
114 |                     "SQL Server断开连接出现异常",
    |

TRY300 Consider moving this statement to an `else` block
   --> app/services/connection_adapters/adapters/sqlserver_adapter.py:131:13
    |
130 |   …         version = self.get_version()
131 | / …         return {
132 | | …             "success": True,
133 | | …             "message": f"SQL Server连接成功 (主机: {self.instance.host}:{self.instance.port}, 版本: {version or '未知'})",
134 | | …             "database_version": version,
135 | | …         }
    | |___________^
136 |   …     except Exception as exc:
137 |   …         return {"success": False, "error": str(exc)}
    |

E501 Line too long (126 > 120)
   --> app/services/connection_adapters/adapters/sqlserver_adapter.py:133:112
    |
131 | …     return {
132 | …         "success": True,
133 | …         "message": f"SQL Server连接成功 (主机: {self.instance.host}:{self.instance.port}, 版本: {version or '未知'})",
    |                                                                                                                    ^^^^^
134 | …         "database_version": version,
135 | …     }
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/services/connection_adapters/adapters/sqlserver_adapter.py:136:16
    |
134 |                 "database_version": version,
135 |             }
136 |         except Exception as exc:
    |                ^^^^^^^^^
137 |             return {"success": False, "error": str(exc)}
138 |         finally:
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `execute_query`
   --> app/services/connection_adapters/adapters/sqlserver_adapter.py:141:73
    |
139 |             self.disconnect()
140 |
141 |     def execute_query(self, query: str, params: tuple | None = None) -> Any:
    |                                                                         ^^^
142 |         """执行 SQL 查询并返回 `fetchall` 结果。.
    |

TRY002 Create your own exception
   --> app/services/connection_adapters/adapters/sqlserver_adapter.py:154:19
    |
152 |         if not self.is_connected and not self.connect():
153 |             msg = "无法建立数据库连接"
154 |             raise Exception(msg)
    |                   ^^^^^^^^^^^^^^
155 |
156 |         cursor = self.connection.cursor()
    |

TRY300 Consider moving this statement to an `else` block
   --> app/services/connection_adapters/adapters/sqlserver_adapter.py:174:13
    |
172 |             if result:
173 |                 return result[0][0]
174 |             return None
    |             ^^^^^^^^^^^
175 |         except Exception:
176 |             return None
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/services/connection_adapters/adapters/sqlserver_adapter.py:175:16
    |
173 |                 return result[0][0]
174 |             return None
175 |         except Exception:
    |                ^^^^^^^^^
176 |             return None
    |

EXE001 Shebang is present but file is not executable
 --> app/services/connection_adapters/connection_factory.py:1:1
  |
1 | #!/usr/bin/env python3
  | ^^^^^^^^^^^^^^^^^^^^^^
2 |
3 | """数据库连接工厂，依据实例类型选择适配器。."""
  |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/services/connection_adapters/connection_factory.py:3:11
  |
1 | #!/usr/bin/env python3
2 |
3 | """数据库连接工厂，依据实例类型选择适配器。."""
  |                  ^^
4 |
5 | from __future__ import annotations
  |

RUF012 Mutable class attributes should be annotated with `typing.ClassVar`
  --> app/services/connection_adapters/connection_factory.py:39:26
   |
37 |       """
38 |
39 |       CONNECTION_CLASSES = {
   |  __________________________^
40 | |         "mysql": MySQLConnection,
41 | |         "postgresql": PostgreSQLConnection,
42 | |         "sqlserver": SQLServerConnection,
43 | |         "oracle": OracleConnection,
44 | |     }
   | |_____^
45 |
46 |       @staticmethod
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/connection_adapters/connection_factory.py:53:30
   |
52 |         Args:
53 |             instance: 数据库实例对象，包含连接所需的配置信息。
   |                                     ^^
54 |
55 |         Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/connection_adapters/connection_factory.py:56:20
   |
55 |         Returns:
56 |             数据库连接对象，如果数据库类型不支持则返回 None。
   |                           ^^
57 |
58 |         Example:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/connection_adapters/connection_factory.py:87:19
   |
86 |         Returns:
87 |             测试结果字典，包含 success 和 error/message 字段。
   |                         ^^
88 |             格式：{'success': bool, 'error': str} 或 {'success': bool, 'message': str}
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/services/connection_adapters/connection_factory.py:88:15
   |
86 |         Returns:
87 |             测试结果字典，包含 success 和 error/message 字段。
88 |             格式：{'success': bool, 'error': str} 或 {'success': bool, 'message': str}
   |                 ^^
89 |
90 |         Example:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/connection_adapters/connection_factory.py:106:23
    |
105 |         Returns:
106 |             支持的数据库类型列表，如 ['mysql', 'postgresql', 'oracle', 'sqlserver']。
    |                                 ^^
107 |
108 |         """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/connection_adapters/connection_factory.py:119:30
    |
118 |         Returns:
119 |             如果支持该数据库类型返回 True，否则返回 False。
    |                                          ^^
120 |
121 |         Example:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/connection_adapters/connection_test_service.py:16:19
   |
14 |     """数据库连接测试服务。.
15 |
16 |     负责测试数据库实例的连接状态，获取版本信息，并更新实例的连接时间。
   |                                 ^^
17 |
18 |     Attributes:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/connection_adapters/connection_test_service.py:16:26
   |
14 |     """数据库连接测试服务。.
15 |
16 |     负责测试数据库实例的连接状态，获取版本信息，并更新实例的连接时间。
   |                                               ^^
17 |
18 |     Attributes:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/connection_adapters/connection_test_service.py:36:16
   |
34 |         """测试数据库连接。.
35 |
36 |         创建数据库连接，获取版本信息，并更新实例的连接状态。
   |                       ^^
37 |
38 |         Args:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/connection_adapters/connection_test_service.py:36:23
   |
34 |         """测试数据库连接。.
35 |
36 |         创建数据库连接，获取版本信息，并更新实例的连接状态。
   |                                     ^^
37 |
38 |         Args:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/connection_adapters/connection_test_service.py:42:19
   |
41 |         Returns:
42 |             测试结果字典，包含以下字段：
   |                         ^^
43 |             - success: 连接是否成功
44 |             - message/error: 成功消息或错误信息
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/services/connection_adapters/connection_test_service.py:42:26
   |
41 |         Returns:
42 |             测试结果字典，包含以下字段：
   |                                       ^^
43 |             - success: 连接是否成功
44 |             - message/error: 成功消息或错误信息
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/connection_adapters/connection_test_service.py:45:33
   |
43 |             - success: 连接是否成功
44 |             - message/error: 成功消息或错误信息
45 |             - version: 格式化的版本字符串（成功时）
   |                                          ^^
46 |             - database_version: 原始版本字符串（成功时）
47 |             - main_version: 主版本号（成功时）
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/connection_adapters/connection_test_service.py:45:37
   |
43 |             - success: 连接是否成功
44 |             - message/error: 成功消息或错误信息
45 |             - version: 格式化的版本字符串（成功时）
   |                                                  ^^
46 |             - database_version: 原始版本字符串（成功时）
47 |             - main_version: 主版本号（成功时）
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/connection_adapters/connection_test_service.py:46:40
   |
44 |             - message/error: 成功消息或错误信息
45 |             - version: 格式化的版本字符串（成功时）
46 |             - database_version: 原始版本字符串（成功时）
   |                                               ^^
47 |             - main_version: 主版本号（成功时）
48 |             - detailed_version: 详细版本号（成功时）
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/connection_adapters/connection_test_service.py:46:44
   |
44 |             - message/error: 成功消息或错误信息
45 |             - version: 格式化的版本字符串（成功时）
46 |             - database_version: 原始版本字符串（成功时）
   |                                                       ^^
47 |             - main_version: 主版本号（成功时）
48 |             - detailed_version: 详细版本号（成功时）
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/connection_adapters/connection_test_service.py:47:33
   |
45 |             - version: 格式化的版本字符串（成功时）
46 |             - database_version: 原始版本字符串（成功时）
47 |             - main_version: 主版本号（成功时）
   |                                     ^^
48 |             - detailed_version: 详细版本号（成功时）
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/connection_adapters/connection_test_service.py:47:37
   |
45 |             - version: 格式化的版本字符串（成功时）
46 |             - database_version: 原始版本字符串（成功时）
47 |             - main_version: 主版本号（成功时）
   |                                             ^^
48 |             - detailed_version: 详细版本号（成功时）
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/connection_adapters/connection_test_service.py:48:38
   |
46 |             - database_version: 原始版本字符串（成功时）
47 |             - main_version: 主版本号（成功时）
48 |             - detailed_version: 详细版本号（成功时）
   |                                           ^^
49 |
50 |         Example:
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/connection_adapters/connection_test_service.py:48:42
   |
46 |             - database_version: 原始版本字符串（成功时）
47 |             - main_version: 主版本号（成功时）
48 |             - detailed_version: 详细版本号（成功时）
   |                                                   ^^
49 |
50 |         Example:
   |

TRY300 Consider moving this statement to an `else` block
  --> app/services/connection_adapters/connection_test_service.py:80:13
   |
78 |               db.session.commit()
79 |
80 | /             return {
81 | |                 "success": True,
82 | |                 "message": f"连接成功，数据库版本: {formatted_version}",
83 | |                 "version": formatted_version,
84 | |                 "database_version": instance.database_version,
85 | |                 "main_version": instance.main_version,
86 | |                 "detailed_version": instance.detailed_version,
87 | |             }
   | |_____________^
88 |
89 |           except Exception as e:
   |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/connection_adapters/connection_test_service.py:82:34
   |
80 |             return {
81 |                 "success": True,
82 |                 "message": f"连接成功，数据库版本: {formatted_version}",
   |                                      ^^
83 |                 "version": formatted_version,
84 |                 "database_version": instance.database_version,
   |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/connection_adapters/connection_test_service.py:90:21
   |
89 |         except Exception as e:
90 |             # 即使连接失败，也记录尝试时间
   |                           ^^
91 |             self._update_last_connected(instance)
   |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/connection_adapters/connection_test_service.py:107:33
    |
105 |             if is_suspicious:
106 |                 self.test_logger.warning(
107 |                     "检测到可疑的数据库错误，可能存在安全威胁",
    |                                            ^^
108 |                     module="connection_test",
109 |                     instance_id=instance.id,
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/services/connection_adapters/connection_test_service.py:134:24
    |
132 |                 try:
133 |                     connection_obj.disconnect()
134 |                 except Exception as close_error:
    |                        ^^^^^^^^^
135 |                     self.test_logger.warning(
136 |                         "关闭数据库连接时发生错误",
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/connection_adapters/connection_test_service.py:145:21
    |
143 |         """更新最后连接时间。.
144 |
145 |         更新实例的最后连接时间戳，不影响已有的版本信息。
    |                                 ^^
146 |
147 |         Args:
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/connection_adapters/connection_test_service.py:166:34
    |
164 |             )
165 |
166 |     # `_get_database_version` 已移除，版本查询由各适配器自行实现。
    |                                     ^^
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/services/database_sync/__init__.py:1:14
  |
1 | """容量同步服务聚合入口，暴露协调器与工具类。."""
  |                        ^^
2 |
3 | from .coordinator import CapacitySyncCoordinator
  |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
 --> app/services/database_sync/adapters/__init__.py:5:5
  |
3 | 提供各种数据库类型的容量同步适配器实现。
4 |
5 | 主要组件：
  |         ^^
6 | - BaseCapacityAdapter: 容量同步适配器基类
7 | - MySQLCapacityAdapter: MySQL 容量同步适配器
  |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/services/database_sync/adapters/base_adapter.py:1:13
  |
1 | """容量采集适配器基类，约束 inventory 与 capacity 的实现接口。."""
  |                      ^^
2 |
3 | from __future__ import annotations
  |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/database_sync/adapters/base_adapter.py:16:17
   |
15 | class BaseCapacityAdapter:
16 |     """容量同步适配器基类，定义库存与容量采集接口。.
   |                          ^^
17 |
18 |     所有数据库类型的容量适配器都应继承此基类并实现其抽象方法。
   |

D107 Missing docstring in `__init__`
  --> app/services/database_sync/adapters/base_adapter.py:30:9
   |
28 |     """
29 |
30 |     def __init__(self) -> None:
   |         ^^^^^^^^
31 |         self.logger = get_system_logger()
   |

ANN001 Missing type annotation for function argument `connection`
  --> app/services/database_sync/adapters/base_adapter.py:33:51
   |
31 |         self.logger = get_system_logger()
32 |
33 |     def fetch_inventory(self, instance: Instance, connection) -> list[dict]:
   |                                                   ^^^^^^^^^^
34 |         """列出实例当前的数据库/表空间。.
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/database_sync/adapters/base_adapter.py:41:20
   |
40 |         Returns:
41 |             数据库清单列表，每个元素包含：
   |                           ^^
42 |             - database_name: 数据库名称
43 |             - is_system: 是否为系统数据库
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/services/database_sync/adapters/base_adapter.py:41:27
   |
40 |         Returns:
41 |             数据库清单列表，每个元素包含：
   |                                         ^^
42 |             - database_name: 数据库名称
43 |             - is_system: 是否为系统数据库
   |

ANN001 Missing type annotation for function argument `connection`
  --> app/services/database_sync/adapters/base_adapter.py:54:9
   |
52 |         self,
53 |         instance: Instance,
54 |         connection,
   |         ^^^^^^^^^^
55 |         target_databases: Sequence[str] | None = None,
56 |     ) -> list[dict]:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/database_sync/adapters/base_adapter.py:62:38
   |
60 |             instance: 实例对象。
61 |             connection: 数据库连接对象。
62 |             target_databases: 目标数据库列表，可选。如果为 None 则采集所有数据库。
   |                                             ^^
63 |
64 |         Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/database_sync/adapters/base_adapter.py:65:19
   |
64 |         Returns:
65 |             容量数据列表，每个元素包含：
   |                         ^^
66 |             - database_name: 数据库名称
67 |             - size_mb: 总大小（MB）
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/services/database_sync/adapters/base_adapter.py:65:26
   |
64 |         Returns:
65 |             容量数据列表，每个元素包含：
   |                                       ^^
66 |             - database_name: 数据库名称
67 |             - size_mb: 总大小（MB）
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/database_sync/adapters/base_adapter.py:67:27
   |
65 |             容量数据列表，每个元素包含：
66 |             - database_name: 数据库名称
67 |             - size_mb: 总大小（MB）
   |                              ^^
68 |             - data_size_mb: 数据大小（MB）
69 |             - log_size_mb: 日志大小（MB）
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/database_sync/adapters/base_adapter.py:67:30
   |
65 |             容量数据列表，每个元素包含：
66 |             - database_name: 数据库名称
67 |             - size_mb: 总大小（MB）
   |                                  ^^
68 |             - data_size_mb: 数据大小（MB）
69 |             - log_size_mb: 日志大小（MB）
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/database_sync/adapters/base_adapter.py:68:33
   |
66 |             - database_name: 数据库名称
67 |             - size_mb: 总大小（MB）
68 |             - data_size_mb: 数据大小（MB）
   |                                     ^^
69 |             - log_size_mb: 日志大小（MB）
70 |             - collected_date: 采集日期
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/database_sync/adapters/base_adapter.py:68:36
   |
66 |             - database_name: 数据库名称
67 |             - size_mb: 总大小（MB）
68 |             - data_size_mb: 数据大小（MB）
   |                                         ^^
69 |             - log_size_mb: 日志大小（MB）
70 |             - collected_date: 采集日期
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/database_sync/adapters/base_adapter.py:69:32
   |
67 |             - size_mb: 总大小（MB）
68 |             - data_size_mb: 数据大小（MB）
69 |             - log_size_mb: 日志大小（MB）
   |                                    ^^
70 |             - collected_date: 采集日期
71 |             - collected_at: 采集时间
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/database_sync/adapters/base_adapter.py:69:35
   |
67 |             - size_mb: 总大小（MB）
68 |             - data_size_mb: 数据大小（MB）
69 |             - log_size_mb: 日志大小（MB）
   |                                        ^^
70 |             - collected_date: 采集日期
71 |             - collected_at: 采集时间
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/database_sync/adapters/base_adapter.py:85:38
   |
84 |         Args:
85 |             target_databases: 目标数据库列表，可选。
   |                                             ^^
86 |
87 |         Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/database_sync/adapters/base_adapter.py:88:25
   |
87 |         Returns:
88 |             规范化后的数据库名称集合，如果输入为 None 则返回 None。
   |                                     ^^
89 |             空列表会被转换为空集合。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/database_sync/adapters/factory.py:30:23
   |
29 |     Args:
30 |         db_type: 数据库类型（mysql、postgresql、sqlserver、oracle）。
   |                            ^^
31 |
32 |     Returns:
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/database_sync/adapters/factory.py:30:57
   |
29 |     Args:
30 |         db_type: 数据库类型（mysql、postgresql、sqlserver、oracle）。
   |                                                                  ^^
31 |
32 |     Returns:
   |

RUF012 Mutable class attributes should be annotated with `typing.ClassVar`
  --> app/services/database_sync/adapters/mysql_adapter.py:32:25
   |
30 |     """
31 |
32 |     _SYSTEM_DATABASES = {"information_schema", "performance_schema", "mysql", "sys"}
   |                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
33 |
34 |     def fetch_inventory(self, instance, connection) -> list[dict]:
   |

ANN001 Missing type annotation for function argument `instance`
  --> app/services/database_sync/adapters/mysql_adapter.py:34:31
   |
32 |     _SYSTEM_DATABASES = {"information_schema", "performance_schema", "mysql", "sys"}
33 |
34 |     def fetch_inventory(self, instance, connection) -> list[dict]:
   |                               ^^^^^^^^
35 |         """列出 MySQL 实例当前的数据库清单。.
   |

ANN001 Missing type annotation for function argument `connection`
  --> app/services/database_sync/adapters/mysql_adapter.py:34:41
   |
32 |     _SYSTEM_DATABASES = {"information_schema", "performance_schema", "mysql", "sys"}
33 |
34 |     def fetch_inventory(self, instance, connection) -> list[dict]:
   |                                         ^^^^^^^^^^
35 |         """列出 MySQL 实例当前的数据库清单。.
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/database_sync/adapters/mysql_adapter.py:42:20
   |
41 |         Returns:
42 |             数据库清单列表，每个元素包含：
   |                           ^^
43 |             - database_name: 数据库名称
44 |             - is_system: 是否为系统数据库
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/services/database_sync/adapters/mysql_adapter.py:42:27
   |
41 |         Returns:
42 |             数据库清单列表，每个元素包含：
   |                                         ^^
43 |             - database_name: 数据库名称
44 |             - is_system: 是否为系统数据库
   |

ANN001 Missing type annotation for function argument `instance`
  --> app/services/database_sync/adapters/mysql_adapter.py:78:9
   |
76 |     def fetch_capacity(
77 |         self,
78 |         instance,
   |         ^^^^^^^^
79 |         connection,
80 |         target_databases: Sequence[str] | None = None,
   |

ANN001 Missing type annotation for function argument `connection`
  --> app/services/database_sync/adapters/mysql_adapter.py:79:9
   |
77 |         self,
78 |         instance,
79 |         connection,
   |         ^^^^^^^^^^
80 |         target_databases: Sequence[str] | None = None,
81 |     ) -> list[dict]:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/database_sync/adapters/mysql_adapter.py:87:40
   |
85 |             instance: 实例对象。
86 |             connection: MySQL 连接对象。
87 |             target_databases: 目标数据库名称列表，为空则采集全部。
   |                                                 ^^
88 |
89 |         Returns:
   |

G201 Logging `.exception(...)` should be used instead of `.error(..., exc_info=True)`
   --> app/services/database_sync/adapters/mysql_adapter.py:107:25
    |
105 |             tablespace_stats = self._collect_tablespace_sizes(connection, instance)
106 |         except Exception as exc:  # pragma: no cover - defensive logging
107 |             self.logger.error(
    |                         ^^^^^
108 |                 "mysql_tablespace_collection_failed",
109 |                 instance=instance.name,
    |

ANN001 Missing type annotation for function argument `connection`
   --> app/services/database_sync/adapters/mysql_adapter.py:132:34
    |
130 |         return data
131 |
132 |     def _assert_permission(self, connection, instance) -> None:
    |                                  ^^^^^^^^^^
133 |         """验证 MySQL 权限。.
    |

ANN001 Missing type annotation for function argument `instance`
   --> app/services/database_sync/adapters/mysql_adapter.py:132:46
    |
130 |         return data
131 |
132 |     def _assert_permission(self, connection, instance) -> None:
    |                                              ^^^^^^^^
133 |         """验证 MySQL 权限。.
    |

RUF001 String contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/services/database_sync/adapters/mysql_adapter.py:151:38
    |
149 |         result = connection.execute_query(test_query)
150 |         if not result:
151 |             error_msg = "MySQL 权限测试失败：无法访问 information_schema.SCHEMATA"
    |                                            ^^
152 |             self.logger.error(
153 |                 "mysql_permission_check_failed",
    |

C901 `_collect_tablespace_sizes` is too complex (15 > 10)
   --> app/services/database_sync/adapters/mysql_adapter.py:164:9
    |
162 |         )
163 |
164 |     def _collect_tablespace_sizes(self, connection, instance) -> dict[str, int]:
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^
165 |         """采集 MySQL 表空间大小。.
    |

PLR0912 Too many branches (15 > 12)
   --> app/services/database_sync/adapters/mysql_adapter.py:164:9
    |
162 |         )
163 |
164 |     def _collect_tablespace_sizes(self, connection, instance) -> dict[str, int]:
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^
165 |         """采集 MySQL 表空间大小。.
    |

ANN001 Missing type annotation for function argument `connection`
   --> app/services/database_sync/adapters/mysql_adapter.py:164:41
    |
162 |         )
163 |
164 |     def _collect_tablespace_sizes(self, connection, instance) -> dict[str, int]:
    |                                         ^^^^^^^^^^
165 |         """采集 MySQL 表空间大小。.
    |

ANN001 Missing type annotation for function argument `instance`
   --> app/services/database_sync/adapters/mysql_adapter.py:164:53
    |
162 |         )
163 |
164 |     def _collect_tablespace_sizes(self, connection, instance) -> dict[str, int]:
    |                                                     ^^^^^^^^
165 |         """采集 MySQL 表空间大小。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/database_sync/adapters/mysql_adapter.py:167:65
    |
165 |         """采集 MySQL 表空间大小。.
166 |
167 |         从 INNODB_TABLESPACES 或 INNODB_SYS_TABLESPACES 视图中查询表空间大小，
    |                                                                             ^^
168 |         并按数据库名称聚合。
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/services/database_sync/adapters/mysql_adapter.py:218:20
    |
216 |                         view=label,
217 |                     )
218 |             except Exception as exc:
    |                    ^^^^^^^^^
219 |                 self.logger.warning(
220 |                     "mysql_tablespace_query_failed",
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/services/database_sync/adapters/mysql_adapter.py:238:16
    |
236 |                         continue
237 |                     aggregated.setdefault(db_name, 0)
238 |         except Exception as exc:
    |                ^^^^^^^^^
239 |             self.logger.warning(
240 |                 "mysql_show_databases_failed",
    |

ANN001 Missing type annotation for function argument `instance`
   --> app/services/database_sync/adapters/mysql_adapter.py:248:45
    |
246 |         return aggregated
247 |
248 |     def _build_stats_from_tablespaces(self, instance, stats: dict[str, int]) -> list[dict]:
    |                                             ^^^^^^^^
249 |         """将表空间统计转换为标准容量数据。.
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/services/database_sync/adapters/mysql_adapter.py:298:39
    |
296 |         """将 MySQL tablespace 名称中的 @XXXX 转回正常字符。.
297 |
298 |         MySQL 在某些情况下会将特殊字符编码为 @XXXX 格式（十六进制）。
    |                                                        ^^
299 |
300 |         Args:
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/services/database_sync/adapters/mysql_adapter.py:298:44
    |
296 |         """将 MySQL tablespace 名称中的 @XXXX 转回正常字符。.
297 |
298 |         MySQL 在某些情况下会将特殊字符编码为 @XXXX 格式（十六进制）。
    |                                                                  ^^
299 |
300 |         Args:
    |

ANN001 Missing type annotation for function argument `instance`
   --> app/services/database_sync/adapters/mysql_adapter.py:323:41
    |
321 |         return re.sub(r"@([0-9A-Fa-f]{4})", _replace, raw_name)
322 |
323 |     def _build_tablespace_queries(self, instance) -> list[tuple[str, str]]:
    |                                         ^^^^^^^^
324 |         """构建表空间查询语句列表。.
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/services/database_sync/adapters/mysql_adapter.py:326:27
    |
324 |         """构建表空间查询语句列表。.
325 |
326 |         根据 MySQL 版本选择合适的视图（MySQL 8.x 优先使用 INNODB_TABLESPACES，
    |                                      ^^
327 |         MySQL 5.x 优先使用 INNODB_SYS_TABLESPACES）。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/database_sync/adapters/mysql_adapter.py:326:61
    |
324 |         """构建表空间查询语句列表。.
325 |
326 |         根据 MySQL 版本选择合适的视图（MySQL 8.x 优先使用 INNODB_TABLESPACES，
    |                                                                             ^^
327 |         MySQL 5.x 优先使用 INNODB_SYS_TABLESPACES）。
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/services/database_sync/adapters/mysql_adapter.py:327:46
    |
326 |         根据 MySQL 版本选择合适的视图（MySQL 8.x 优先使用 INNODB_TABLESPACES，
327 |         MySQL 5.x 优先使用 INNODB_SYS_TABLESPACES）。
    |                                                  ^^
328 |
329 |         Args:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/database_sync/adapters/mysql_adapter.py:330:27
    |
329 |         Args:
330 |             instance: 实例对象，包含版本信息。
    |                               ^^
331 |
332 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/database_sync/adapters/mysql_adapter.py:333:17
    |
332 |         Returns:
333 |             查询列表，每个元素为 (视图名称, SQL 查询语句) 元组。
    |                     ^^
334 |             按优先级排序，会依次尝试直到成功。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/database_sync/adapters/mysql_adapter.py:334:19
    |
332 |         Returns:
333 |             查询列表，每个元素为 (视图名称, SQL 查询语句) 元组。
334 |             按优先级排序，会依次尝试直到成功。
    |                         ^^
335 |
336 |         """
    |

ANN001 Missing type annotation for function argument `instance`
  --> app/services/database_sync/adapters/oracle_adapter.py:27:31
   |
25 |     """
26 |
27 |     def fetch_inventory(self, instance, connection) -> list[dict]:
   |                               ^^^^^^^^
28 |         """列出 Oracle 实例当前的表空间清单。.
   |

ANN001 Missing type annotation for function argument `connection`
  --> app/services/database_sync/adapters/oracle_adapter.py:27:41
   |
25 |     """
26 |
27 |     def fetch_inventory(self, instance, connection) -> list[dict]:
   |                                         ^^^^^^^^^^
28 |         """列出 Oracle 实例当前的表空间清单。.
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/database_sync/adapters/oracle_adapter.py:35:20
   |
34 |         Returns:
35 |             表空间清单列表，每个元素包含：
   |                           ^^
36 |             - database_name: 表空间名称
37 |             - is_system: 是否为系统表空间（Oracle 中统一标记为 False）
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/services/database_sync/adapters/oracle_adapter.py:35:27
   |
34 |         Returns:
35 |             表空间清单列表，每个元素包含：
   |                                         ^^
36 |             - database_name: 表空间名称
37 |             - is_system: 是否为系统表空间（Oracle 中统一标记为 False）
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/database_sync/adapters/oracle_adapter.py:37:34
   |
35 |             表空间清单列表，每个元素包含：
36 |             - database_name: 表空间名称
37 |             - is_system: 是否为系统表空间（Oracle 中统一标记为 False）
   |                                          ^^
38 |
39 |         Example:
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/database_sync/adapters/oracle_adapter.py:37:54
   |
35 |             表空间清单列表，每个元素包含：
36 |             - database_name: 表空间名称
37 |             - is_system: 是否为系统表空间（Oracle 中统一标记为 False）
   |                                                                     ^^
38 |
39 |         Example:
   |

ANN001 Missing type annotation for function argument `instance`
  --> app/services/database_sync/adapters/oracle_adapter.py:71:9
   |
69 |     def fetch_capacity(
70 |         self,
71 |         instance,
   |         ^^^^^^^^
72 |         connection,
73 |         target_databases: Sequence[str] | None = None,
   |

ANN001 Missing type annotation for function argument `connection`
  --> app/services/database_sync/adapters/oracle_adapter.py:72:9
   |
70 |         self,
71 |         instance,
72 |         connection,
   |         ^^^^^^^^^^
73 |         target_databases: Sequence[str] | None = None,
74 |     ) -> list[dict]:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/database_sync/adapters/oracle_adapter.py:77:36
   |
75 |         """采集 Oracle 表空间容量数据。.
76 |
77 |         从 dba_data_files 视图中查询表空间大小，并按表空间名称聚合。
   |                                               ^^
78 |
79 |         Args:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/database_sync/adapters/oracle_adapter.py:83:25
   |
81 |             connection: Oracle 数据库连接对象。
82 |             target_databases: 可选的目标表空间名称列表。
83 |                 如果为 None，采集所有表空间；
   |                            ^^
84 |                 如果为空列表，跳过采集。
   |

RUF002 Docstring contains ambiguous `；` (FULLWIDTH SEMICOLON). Did you mean `;` (SEMICOLON)?
  --> app/services/database_sync/adapters/oracle_adapter.py:83:33
   |
81 |             connection: Oracle 数据库连接对象。
82 |             target_databases: 可选的目标表空间名称列表。
83 |                 如果为 None，采集所有表空间；
   |                                            ^^
84 |                 如果为空列表，跳过采集。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/database_sync/adapters/oracle_adapter.py:84:23
   |
82 |             target_databases: 可选的目标表空间名称列表。
83 |                 如果为 None，采集所有表空间；
84 |                 如果为空列表，跳过采集。
   |                             ^^
85 |
86 |         Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/database_sync/adapters/oracle_adapter.py:87:19
   |
86 |         Returns:
87 |             容量数据列表，每个元素包含：
   |                         ^^
88 |             - database_name: 表空间名称
89 |             - size_mb: 总大小（MB）
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/services/database_sync/adapters/oracle_adapter.py:87:26
   |
86 |         Returns:
87 |             容量数据列表，每个元素包含：
   |                                       ^^
88 |             - database_name: 表空间名称
89 |             - size_mb: 总大小（MB）
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/database_sync/adapters/oracle_adapter.py:89:27
   |
87 |             容量数据列表，每个元素包含：
88 |             - database_name: 表空间名称
89 |             - size_mb: 总大小（MB）
   |                              ^^
90 |             - data_size_mb: 数据文件大小（MB）
91 |             - log_size_mb: 日志大小（Oracle 中为 None）
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/database_sync/adapters/oracle_adapter.py:89:30
   |
87 |             容量数据列表，每个元素包含：
88 |             - database_name: 表空间名称
89 |             - size_mb: 总大小（MB）
   |                                  ^^
90 |             - data_size_mb: 数据文件大小（MB）
91 |             - log_size_mb: 日志大小（Oracle 中为 None）
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/database_sync/adapters/oracle_adapter.py:90:35
   |
88 |             - database_name: 表空间名称
89 |             - size_mb: 总大小（MB）
90 |             - data_size_mb: 数据文件大小（MB）
   |                                         ^^
91 |             - log_size_mb: 日志大小（Oracle 中为 None）
92 |             - collected_date: 采集日期（中国时区）
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/database_sync/adapters/oracle_adapter.py:90:38
   |
88 |             - database_name: 表空间名称
89 |             - size_mb: 总大小（MB）
90 |             - data_size_mb: 数据文件大小（MB）
   |                                             ^^
91 |             - log_size_mb: 日志大小（Oracle 中为 None）
92 |             - collected_date: 采集日期（中国时区）
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/database_sync/adapters/oracle_adapter.py:91:32
   |
89 |             - size_mb: 总大小（MB）
90 |             - data_size_mb: 数据文件大小（MB）
91 |             - log_size_mb: 日志大小（Oracle 中为 None）
   |                                    ^^
92 |             - collected_date: 采集日期（中国时区）
93 |             - collected_at: 采集时间（UTC）
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/database_sync/adapters/oracle_adapter.py:91:47
   |
89 |             - size_mb: 总大小（MB）
90 |             - data_size_mb: 数据文件大小（MB）
91 |             - log_size_mb: 日志大小（Oracle 中为 None）
   |                                                      ^^
92 |             - collected_date: 采集日期（中国时区）
93 |             - collected_at: 采集时间（UTC）
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/database_sync/adapters/oracle_adapter.py:92:35
   |
90 |             - data_size_mb: 数据文件大小（MB）
91 |             - log_size_mb: 日志大小（Oracle 中为 None）
92 |             - collected_date: 采集日期（中国时区）
   |                                       ^^
93 |             - collected_at: 采集时间（UTC）
94 |             - is_system: 是否为系统表空间（统一为 False）
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/database_sync/adapters/oracle_adapter.py:92:40
   |
90 |             - data_size_mb: 数据文件大小（MB）
91 |             - log_size_mb: 日志大小（Oracle 中为 None）
92 |             - collected_date: 采集日期（中国时区）
   |                                                 ^^
93 |             - collected_at: 采集时间（UTC）
94 |             - is_system: 是否为系统表空间（统一为 False）
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/database_sync/adapters/oracle_adapter.py:93:33
   |
91 |             - log_size_mb: 日志大小（Oracle 中为 None）
92 |             - collected_date: 采集日期（中国时区）
93 |             - collected_at: 采集时间（UTC）
   |                                     ^^
94 |             - is_system: 是否为系统表空间（统一为 False）
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/database_sync/adapters/oracle_adapter.py:93:37
   |
91 |             - log_size_mb: 日志大小（Oracle 中为 None）
92 |             - collected_date: 采集日期（中国时区）
93 |             - collected_at: 采集时间（UTC）
   |                                          ^^
94 |             - is_system: 是否为系统表空间（统一为 False）
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/database_sync/adapters/oracle_adapter.py:94:34
   |
92 |             - collected_date: 采集日期（中国时区）
93 |             - collected_at: 采集时间（UTC）
94 |             - is_system: 是否为系统表空间（统一为 False）
   |                                          ^^
95 |
96 |         Raises:
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/database_sync/adapters/oracle_adapter.py:94:44
   |
92 |             - collected_date: 采集日期（中国时区）
93 |             - collected_at: 采集时间（UTC）
94 |             - is_system: 是否为系统表空间（统一为 False）
   |                                                        ^^
95 |
96 |         Raises:
   |

RUF012 Mutable class attributes should be annotated with `typing.ClassVar`
  --> app/services/database_sync/adapters/postgresql_adapter.py:30:25
   |
28 |     """
29 |
30 |     _SYSTEM_DATABASES = {"postgres"}
   |                         ^^^^^^^^^^^^
31 |
32 |     def fetch_inventory(self, instance, connection) -> list[dict]:
   |

ANN001 Missing type annotation for function argument `instance`
  --> app/services/database_sync/adapters/postgresql_adapter.py:32:31
   |
30 |     _SYSTEM_DATABASES = {"postgres"}
31 |
32 |     def fetch_inventory(self, instance, connection) -> list[dict]:
   |                               ^^^^^^^^
33 |         """列出 PostgreSQL 实例当前的数据库清单。.
   |

ANN001 Missing type annotation for function argument `connection`
  --> app/services/database_sync/adapters/postgresql_adapter.py:32:41
   |
30 |     _SYSTEM_DATABASES = {"postgres"}
31 |
32 |     def fetch_inventory(self, instance, connection) -> list[dict]:
   |                                         ^^^^^^^^^^
33 |         """列出 PostgreSQL 实例当前的数据库清单。.
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/database_sync/adapters/postgresql_adapter.py:40:20
   |
39 |         Returns:
40 |             数据库清单列表，每个元素包含：
   |                           ^^
41 |             - database_name: 数据库名称
42 |             - is_system: 是否为系统数据库或模板数据库
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/services/database_sync/adapters/postgresql_adapter.py:40:27
   |
39 |         Returns:
40 |             数据库清单列表，每个元素包含：
   |                                         ^^
41 |             - database_name: 数据库名称
42 |             - is_system: 是否为系统数据库或模板数据库
   |

ANN001 Missing type annotation for function argument `instance`
  --> app/services/database_sync/adapters/postgresql_adapter.py:77:9
   |
75 |     def fetch_capacity(
76 |         self,
77 |         instance,
   |         ^^^^^^^^
78 |         connection,
79 |         target_databases: Sequence[str] | None = None,
   |

ANN001 Missing type annotation for function argument `connection`
  --> app/services/database_sync/adapters/postgresql_adapter.py:78:9
   |
76 |         self,
77 |         instance,
78 |         connection,
   |         ^^^^^^^^^^
79 |         target_databases: Sequence[str] | None = None,
80 |     ) -> list[dict]:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/database_sync/adapters/postgresql_adapter.py:89:25
   |
87 |             connection: PostgreSQL 数据库连接对象。
88 |             target_databases: 可选的目标数据库名称列表。
89 |                 如果为 None，采集所有非模板数据库；
   |                            ^^
90 |                 如果为空列表，跳过采集。
   |

RUF002 Docstring contains ambiguous `；` (FULLWIDTH SEMICOLON). Did you mean `;` (SEMICOLON)?
  --> app/services/database_sync/adapters/postgresql_adapter.py:89:36
   |
87 |             connection: PostgreSQL 数据库连接对象。
88 |             target_databases: 可选的目标数据库名称列表。
89 |                 如果为 None，采集所有非模板数据库；
   |                                                  ^^
90 |                 如果为空列表，跳过采集。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/database_sync/adapters/postgresql_adapter.py:90:23
   |
88 |             target_databases: 可选的目标数据库名称列表。
89 |                 如果为 None，采集所有非模板数据库；
90 |                 如果为空列表，跳过采集。
   |                             ^^
91 |
92 |         Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/database_sync/adapters/postgresql_adapter.py:93:19
   |
92 |         Returns:
93 |             容量数据列表，每个元素包含：
   |                         ^^
94 |             - database_name: 数据库名称
95 |             - size_mb: 总大小（MB）
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/services/database_sync/adapters/postgresql_adapter.py:93:26
   |
92 |         Returns:
93 |             容量数据列表，每个元素包含：
   |                                       ^^
94 |             - database_name: 数据库名称
95 |             - size_mb: 总大小（MB）
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/database_sync/adapters/postgresql_adapter.py:95:27
   |
93 |             容量数据列表，每个元素包含：
94 |             - database_name: 数据库名称
95 |             - size_mb: 总大小（MB）
   |                              ^^
96 |             - data_size_mb: 数据大小（MB）
97 |             - log_size_mb: 日志大小（PostgreSQL 中为 None）
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/database_sync/adapters/postgresql_adapter.py:95:30
   |
93 |             容量数据列表，每个元素包含：
94 |             - database_name: 数据库名称
95 |             - size_mb: 总大小（MB）
   |                                  ^^
96 |             - data_size_mb: 数据大小（MB）
97 |             - log_size_mb: 日志大小（PostgreSQL 中为 None）
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/database_sync/adapters/postgresql_adapter.py:96:33
   |
94 |             - database_name: 数据库名称
95 |             - size_mb: 总大小（MB）
96 |             - data_size_mb: 数据大小（MB）
   |                                     ^^
97 |             - log_size_mb: 日志大小（PostgreSQL 中为 None）
98 |             - collected_date: 采集日期（中国时区）
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/database_sync/adapters/postgresql_adapter.py:96:36
   |
94 |             - database_name: 数据库名称
95 |             - size_mb: 总大小（MB）
96 |             - data_size_mb: 数据大小（MB）
   |                                         ^^
97 |             - log_size_mb: 日志大小（PostgreSQL 中为 None）
98 |             - collected_date: 采集日期（中国时区）
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/database_sync/adapters/postgresql_adapter.py:97:32
   |
95 |             - size_mb: 总大小（MB）
96 |             - data_size_mb: 数据大小（MB）
97 |             - log_size_mb: 日志大小（PostgreSQL 中为 None）
   |                                    ^^
98 |             - collected_date: 采集日期（中国时区）
99 |             - collected_at: 采集时间（UTC）
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/database_sync/adapters/postgresql_adapter.py:97:51
   |
95 |             - size_mb: 总大小（MB）
96 |             - data_size_mb: 数据大小（MB）
97 |             - log_size_mb: 日志大小（PostgreSQL 中为 None）
   |                                                          ^^
98 |             - collected_date: 采集日期（中国时区）
99 |             - collected_at: 采集时间（UTC）
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/services/database_sync/adapters/postgresql_adapter.py:98:35
    |
 96 |             - data_size_mb: 数据大小（MB）
 97 |             - log_size_mb: 日志大小（PostgreSQL 中为 None）
 98 |             - collected_date: 采集日期（中国时区）
    |                                       ^^
 99 |             - collected_at: 采集时间（UTC）
100 |             - is_system: 是否为系统数据库
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/services/database_sync/adapters/postgresql_adapter.py:98:40
    |
 96 |             - data_size_mb: 数据大小（MB）
 97 |             - log_size_mb: 日志大小（PostgreSQL 中为 None）
 98 |             - collected_date: 采集日期（中国时区）
    |                                                 ^^
 99 |             - collected_at: 采集时间（UTC）
100 |             - is_system: 是否为系统数据库
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/services/database_sync/adapters/postgresql_adapter.py:99:33
    |
 97 |             - log_size_mb: 日志大小（PostgreSQL 中为 None）
 98 |             - collected_date: 采集日期（中国时区）
 99 |             - collected_at: 采集时间（UTC）
    |                                     ^^
100 |             - is_system: 是否为系统数据库
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/services/database_sync/adapters/postgresql_adapter.py:99:37
    |
 97 |             - log_size_mb: 日志大小（PostgreSQL 中为 None）
 98 |             - collected_date: 采集日期（中国时区）
 99 |             - collected_at: 采集时间（UTC）
    |                                          ^^
100 |             - is_system: 是否为系统数据库
    |

ANN001 Missing type annotation for function argument `instance`
  --> app/services/database_sync/adapters/sqlserver_adapter.py:27:31
   |
25 |     """
26 |
27 |     def fetch_inventory(self, instance, connection) -> list[dict]:
   |                               ^^^^^^^^
28 |         """列出 SQL Server 实例当前的数据库清单。.
   |

ANN001 Missing type annotation for function argument `connection`
  --> app/services/database_sync/adapters/sqlserver_adapter.py:27:41
   |
25 |     """
26 |
27 |     def fetch_inventory(self, instance, connection) -> list[dict]:
   |                                         ^^^^^^^^^^
28 |         """列出 SQL Server 实例当前的数据库清单。.
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/database_sync/adapters/sqlserver_adapter.py:35:20
   |
34 |         Returns:
35 |             数据库清单列表，每个元素包含：
   |                           ^^
36 |             - database_name: 数据库名称
37 |             - is_system: 是否为系统数据库（database_id <= 4）
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/services/database_sync/adapters/sqlserver_adapter.py:35:27
   |
34 |         Returns:
35 |             数据库清单列表，每个元素包含：
   |                                         ^^
36 |             - database_name: 数据库名称
37 |             - is_system: 是否为系统数据库（database_id <= 4）
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/database_sync/adapters/sqlserver_adapter.py:37:34
   |
35 |             数据库清单列表，每个元素包含：
36 |             - database_name: 数据库名称
37 |             - is_system: 是否为系统数据库（database_id <= 4）
   |                                          ^^
38 |
39 |         Example:
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/database_sync/adapters/sqlserver_adapter.py:37:51
   |
35 |             数据库清单列表，每个元素包含：
36 |             - database_name: 数据库名称
37 |             - is_system: 是否为系统数据库（database_id <= 4）
   |                                                            ^^
38 |
39 |         Example:
   |

ANN001 Missing type annotation for function argument `instance`
  --> app/services/database_sync/adapters/sqlserver_adapter.py:71:9
   |
69 |     def fetch_capacity(
70 |         self,
71 |         instance,
   |         ^^^^^^^^
72 |         connection,
73 |         target_databases: Sequence[str] | None = None,
   |

ANN001 Missing type annotation for function argument `connection`
  --> app/services/database_sync/adapters/sqlserver_adapter.py:72:9
   |
70 |         self,
71 |         instance,
72 |         connection,
   |         ^^^^^^^^^^
73 |         target_databases: Sequence[str] | None = None,
74 |     ) -> list[dict]:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/database_sync/adapters/sqlserver_adapter.py:77:39
   |
75 |         """采集 SQL Server 数据库容量数据。.
76 |
77 |         从 sys.master_files 视图中查询数据文件大小，并按数据库名称聚合。
   |                                                   ^^
78 |
79 |         Args:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/database_sync/adapters/sqlserver_adapter.py:83:25
   |
81 |             connection: SQL Server 数据库连接对象。
82 |             target_databases: 可选的目标数据库名称列表。
83 |                 如果为 None，采集所有数据库；
   |                            ^^
84 |                 如果为空列表，跳过采集。
   |

RUF002 Docstring contains ambiguous `；` (FULLWIDTH SEMICOLON). Did you mean `;` (SEMICOLON)?
  --> app/services/database_sync/adapters/sqlserver_adapter.py:83:33
   |
81 |             connection: SQL Server 数据库连接对象。
82 |             target_databases: 可选的目标数据库名称列表。
83 |                 如果为 None，采集所有数据库；
   |                                            ^^
84 |                 如果为空列表，跳过采集。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/database_sync/adapters/sqlserver_adapter.py:84:23
   |
82 |             target_databases: 可选的目标数据库名称列表。
83 |                 如果为 None，采集所有数据库；
84 |                 如果为空列表，跳过采集。
   |                             ^^
85 |
86 |         Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/database_sync/adapters/sqlserver_adapter.py:87:19
   |
86 |         Returns:
87 |             容量数据列表，每个元素包含：
   |                         ^^
88 |             - database_name: 数据库名称
89 |             - size_mb: 总大小（MB，仅包含数据文件）
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/services/database_sync/adapters/sqlserver_adapter.py:87:26
   |
86 |         Returns:
87 |             容量数据列表，每个元素包含：
   |                                       ^^
88 |             - database_name: 数据库名称
89 |             - size_mb: 总大小（MB，仅包含数据文件）
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/database_sync/adapters/sqlserver_adapter.py:89:27
   |
87 |             容量数据列表，每个元素包含：
88 |             - database_name: 数据库名称
89 |             - size_mb: 总大小（MB，仅包含数据文件）
   |                              ^^
90 |             - data_size_mb: 数据文件大小（MB）
91 |             - log_size_mb: 日志大小（SQL Server 中为 None）
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/database_sync/adapters/sqlserver_adapter.py:89:30
   |
87 |             容量数据列表，每个元素包含：
88 |             - database_name: 数据库名称
89 |             - size_mb: 总大小（MB，仅包含数据文件）
   |                                  ^^
90 |             - data_size_mb: 数据文件大小（MB）
91 |             - log_size_mb: 日志大小（SQL Server 中为 None）
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/database_sync/adapters/sqlserver_adapter.py:89:38
   |
87 |             容量数据列表，每个元素包含：
88 |             - database_name: 数据库名称
89 |             - size_mb: 总大小（MB，仅包含数据文件）
   |                                                  ^^
90 |             - data_size_mb: 数据文件大小（MB）
91 |             - log_size_mb: 日志大小（SQL Server 中为 None）
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/database_sync/adapters/sqlserver_adapter.py:90:35
   |
88 |             - database_name: 数据库名称
89 |             - size_mb: 总大小（MB，仅包含数据文件）
90 |             - data_size_mb: 数据文件大小（MB）
   |                                         ^^
91 |             - log_size_mb: 日志大小（SQL Server 中为 None）
92 |             - collected_date: 采集日期（中国时区）
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/database_sync/adapters/sqlserver_adapter.py:90:38
   |
88 |             - database_name: 数据库名称
89 |             - size_mb: 总大小（MB，仅包含数据文件）
90 |             - data_size_mb: 数据文件大小（MB）
   |                                             ^^
91 |             - log_size_mb: 日志大小（SQL Server 中为 None）
92 |             - collected_date: 采集日期（中国时区）
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/database_sync/adapters/sqlserver_adapter.py:91:32
   |
89 |             - size_mb: 总大小（MB，仅包含数据文件）
90 |             - data_size_mb: 数据文件大小（MB）
91 |             - log_size_mb: 日志大小（SQL Server 中为 None）
   |                                    ^^
92 |             - collected_date: 采集日期（中国时区）
93 |             - collected_at: 采集时间（UTC）
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/database_sync/adapters/sqlserver_adapter.py:91:51
   |
89 |             - size_mb: 总大小（MB，仅包含数据文件）
90 |             - data_size_mb: 数据文件大小（MB）
91 |             - log_size_mb: 日志大小（SQL Server 中为 None）
   |                                                          ^^
92 |             - collected_date: 采集日期（中国时区）
93 |             - collected_at: 采集时间（UTC）
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/database_sync/adapters/sqlserver_adapter.py:92:35
   |
90 |             - data_size_mb: 数据文件大小（MB）
91 |             - log_size_mb: 日志大小（SQL Server 中为 None）
92 |             - collected_date: 采集日期（中国时区）
   |                                       ^^
93 |             - collected_at: 采集时间（UTC）
94 |             - is_system: 是否为系统数据库（统一为 False）
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/database_sync/adapters/sqlserver_adapter.py:92:40
   |
90 |             - data_size_mb: 数据文件大小（MB）
91 |             - log_size_mb: 日志大小（SQL Server 中为 None）
92 |             - collected_date: 采集日期（中国时区）
   |                                                 ^^
93 |             - collected_at: 采集时间（UTC）
94 |             - is_system: 是否为系统数据库（统一为 False）
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/database_sync/adapters/sqlserver_adapter.py:93:33
   |
91 |             - log_size_mb: 日志大小（SQL Server 中为 None）
92 |             - collected_date: 采集日期（中国时区）
93 |             - collected_at: 采集时间（UTC）
   |                                     ^^
94 |             - is_system: 是否为系统数据库（统一为 False）
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/database_sync/adapters/sqlserver_adapter.py:93:37
   |
91 |             - log_size_mb: 日志大小（SQL Server 中为 None）
92 |             - collected_date: 采集日期（中国时区）
93 |             - collected_at: 采集时间（UTC）
   |                                          ^^
94 |             - is_system: 是否为系统数据库（统一为 False）
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/database_sync/adapters/sqlserver_adapter.py:94:34
   |
92 |             - collected_date: 采集日期（中国时区）
93 |             - collected_at: 采集时间（UTC）
94 |             - is_system: 是否为系统数据库（统一为 False）
   |                                          ^^
95 |
96 |         Raises:
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/database_sync/adapters/sqlserver_adapter.py:94:44
   |
92 |             - collected_date: 采集日期（中国时区）
93 |             - collected_at: 采集时间（UTC）
94 |             - is_system: 是否为系统数据库（统一为 False）
   |                                                        ^^
95 |
96 |         Raises:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/services/database_sync/coordinator.py:1:11
  |
1 | """容量同步协调器，实现连接、库存同步与容量采集整体流程。."""
  |                  ^^
2 |
3 | from __future__ import annotations
  |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/database_sync/coordinator.py:22:15
   |
21 | class CapacitySyncCoordinator:
22 |     """容量同步协调器，负责组织库存同步与容量采集流程。.
   |                      ^^
23 |
24 |     协调数据库容量同步的完整流程，包括：
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/database_sync/coordinator.py:24:19
   |
22 |     """容量同步协调器，负责组织库存同步与容量采集流程。.
23 |
24 |     协调数据库容量同步的完整流程，包括：
   |                                 ^^
25 |     - 建立数据库连接
26 |     - 同步数据库清单
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/services/database_sync/coordinator.py:24:22
   |
22 |     """容量同步协调器，负责组织库存同步与容量采集流程。.
23 |
24 |     协调数据库容量同步的完整流程，包括：
   |                                       ^^
25 |     - 建立数据库连接
26 |     - 同步数据库清单
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/database_sync/coordinator.py:73:19
   |
71 |         """建立数据库连接。.
72 |
73 |         如果连接已存在且有效，则复用现有连接。
   |                             ^^
74 |
75 |         Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/database_sync/coordinator.py:76:24
   |
75 |         Returns:
76 |             连接成功返回 True，失败返回 False。
   |                              ^^
77 |
78 |         """
   |

G201 Logging `.exception(...)` should be used instead of `.error(..., exc_info=True)`
   --> app/services/database_sync/coordinator.py:105:25
    |
103 |                 return True
104 |         except Exception as exc:
105 |             self.logger.error(
    |                         ^^^^^
106 |                 "capacity_sync_connection_error",
107 |                 instance=self.instance.name,
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/database_sync/coordinator.py:121:19
    |
119 |         """断开数据库连接。.
120 |
121 |         安全地关闭数据库连接，即使发生异常也会清理连接对象。
    |                             ^^
122 |
123 |         Returns:
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/services/database_sync/coordinator.py:130:20
    |
128 |             try:
129 |                 self._connection.disconnect()
130 |             except Exception as exc:
    |                    ^^^^^^^^^
131 |                 self.logger.warning(
132 |                     "capacity_sync_disconnect_error",
    |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/services/database_sync/coordinator.py:141:18
    |
140 |     def synchronize_inventory(self) -> dict:
141 |         """执行库存同步：远端拉取 → instance_databases 落库。.
    |                        ^^
142 |
143 |         从远程数据库获取数据库清单，并同步到本地 instance_databases 表。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/database_sync/coordinator.py:143:22
    |
141 |         """执行库存同步：远端拉取 → instance_databases 落库。.
142 |
143 |         从远程数据库获取数据库清单，并同步到本地 instance_databases 表。
    |                                   ^^
144 |
145 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/database_sync/coordinator.py:146:21
    |
145 |         Returns:
146 |             同步统计信息字典，包含活跃数据库列表等信息。
    |                             ^^
147 |
148 |         """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/database_sync/coordinator.py:180:23
    |
178 |         """采集容量数据。.
179 |
180 |         从远程数据库采集容量统计数据，支持按数据库名称过滤。
    |                                     ^^
181 |
182 |         Args:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/database_sync/coordinator.py:183:40
    |
182 |         Args:
183 |             target_databases: 目标数据库名称列表，为 None 时采集所有数据库。
    |                                                 ^^
184 |
185 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/database_sync/coordinator.py:186:19
    |
185 |         Returns:
186 |             容量数据列表，每项包含数据库名称、大小等信息。
    |                         ^^
187 |
188 |         """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/database_sync/coordinator.py:244:24
    |
243 |         Returns:
244 |             保存成功返回 True，失败返回 False。
    |                              ^^
245 |
246 |         """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/database_sync/coordinator.py:253:24
    |
252 |         Returns:
253 |             更新成功返回 True，失败返回 False。
    |                              ^^
254 |
255 |         """
    |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/services/database_sync/coordinator.py:261:14
    |
259 |         """执行完整的库存同步 + 容量采集 + 数据持久化流程。.
260 |
261 |         按顺序执行：
    |                   ^^
262 |         1. 同步数据库清单
263 |         2. 采集活跃数据库的容量数据
    |

G201 Logging `.exception(...)` should be used instead of `.error(..., exc_info=True)`
   --> app/services/database_sync/coordinator.py:292:29
    |
290 |             except Exception as exc:
291 |                 db.session.rollback()
292 |                 self.logger.error(
    |                             ^^^^^
293 |                     "capacity_sync_commit_failed",
294 |                     instance=self.instance.name,
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/database_sync/coordinator.py:311:20
    |
309 |         """确保数据库连接已建立。.
310 |
311 |         如果连接不存在或已断开，则尝试重新连接。
    |                               ^^
312 |
313 |         Returns:
    |

SIM102 Use a single `if` statement instead of nested `if` statements
   --> app/services/database_sync/coordinator.py:320:9
    |
319 |           """
320 | /         if not self._connection or not getattr(self._connection, "is_connected", False):
321 | |             if not self.connect():
    | |__________________________________^
322 |                   msg = "数据库连接未建立"
323 |                   raise RuntimeError(msg)
    |
help: Combine `if` statements using `and`

D107 Missing docstring in `__init__`
  --> app/services/database_sync/database_filters.py:29:9
   |
27 |     """负责加载数据库发现/容量同步所需的过滤配置。."""
28 |
29 |     def __init__(self, config_path: str | Path | None = None) -> None:
   |         ^^^^^^^^
30 |         self._config_path = Path(config_path) if config_path else _DEFAULT_CONFIG_PATH
31 |         self._normalized_rules: dict[str, dict[str, Any]] = {}
   |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `instance`
   --> app/services/database_sync/database_filters.py:111:49
    |
109 |         return re.compile(regex, re.IGNORECASE)
110 |
111 |     def should_exclude_database(self, instance: Any, database_name: str | None) -> tuple[bool, str | None]:
    |                                                 ^^^
112 |         """判断给定实例下的数据库是否需要被过滤。.
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `instance`
   --> app/services/database_sync/database_filters.py:143:47
    |
141 |         return False, None
142 |
143 |     def filter_database_names(self, instance: Any, names: Iterable[str]) -> tuple[list[str], list[str]]:
    |                                               ^^^
144 |         """过滤数据库名称，返回保留与排除列表。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/database_sync/database_filters.py:144:19
    |
143 |     def filter_database_names(self, instance: Any, names: Iterable[str]) -> tuple[list[str], list[str]]:
144 |         """过滤数据库名称，返回保留与排除列表。.
    |                          ^^
145 |
146 |         Args:
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `instance`
   --> app/services/database_sync/database_filters.py:164:49
    |
162 |         return allowed, excluded
163 |
164 |     def filter_capacity_payload(self, instance: Any, payload: Sequence[dict[str, Any]]) -> tuple[list[dict[str, Any]], list[str]]:
    |                                                 ^^^
165 |         """过滤容量采集结果，返回保留记录与被排除的库名。.
    |

E501 Line too long (130 > 120)
   --> app/services/database_sync/database_filters.py:164:121
    |
162 |         return allowed, excluded
163 |
164 |     def filter_capacity_payload(self, instance: Any, payload: Sequence[dict[str, Any]]) -> tuple[list[dict[str, Any]], list[str]]:
    |                                                                                                                         ^^^^^^^^^^
165 |         """过滤容量采集结果，返回保留记录与被排除的库名。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/database_sync/database_filters.py:165:20
    |
164 |     def filter_capacity_payload(self, instance: Any, payload: Sequence[dict[str, Any]]) -> tuple[list[dict[str, Any]], list[str]]:
165 |         """过滤容量采集结果，返回保留记录与被排除的库名。.
    |                            ^^
166 |
167 |         Args:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/services/database_sync/database_sync_service.py:3:45
  |
1 | """数据库容量同步服务.
2 |
3 | 该模块提供与历史版本兼容的 `DatabaseSizeCollectorService`，内部委托
  |                                                          ^^
4 | `app.services.database_sync` 中的协调器与适配器完成工作。
5 | """
  |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/database_sync/database_sync_service.py:22:17
   |
21 | class DatabaseSizeCollectorService:
22 |     """数据库容量采集服务（兼容包装器）。.
   |                          ^^
23 |
24 |     提供与历史版本兼容的接口，内部委托给 CapacitySyncCoordinator 实现。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/database_sync/database_sync_service.py:22:23
   |
21 | class DatabaseSizeCollectorService:
22 |     """数据库容量采集服务（兼容包装器）。.
   |                                      ^^
23 |
24 |     提供与历史版本兼容的接口，内部委托给 CapacitySyncCoordinator 实现。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/database_sync/database_sync_service.py:24:17
   |
22 |     """数据库容量采集服务（兼容包装器）。.
23 |
24 |     提供与历史版本兼容的接口，内部委托给 CapacitySyncCoordinator 实现。
   |                             ^^
25 |     支持上下文管理器协议，自动管理数据库连接。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/database_sync/database_sync_service.py:25:15
   |
24 |     提供与历史版本兼容的接口，内部委托给 CapacitySyncCoordinator 实现。
25 |     支持上下文管理器协议，自动管理数据库连接。
   |                         ^^
26 |
27 |     Attributes:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/database_sync/database_sync_service.py:49:20
   |
48 |     def __enter__(self) -> Self:
49 |         """进入上下文管理器，建立数据库连接。.
   |                            ^^
50 |
51 |         Returns:
   |

ANN001 Missing type annotation for function argument `exc_type`
  --> app/services/database_sync/database_sync_service.py:58:24
   |
56 |         return self
57 |
58 |     def __exit__(self, exc_type, exc_val, exc_tb) -> None:
   |                        ^^^^^^^^
59 |         """退出上下文管理器，断开数据库连接。.
   |

ANN001 Missing type annotation for function argument `exc_val`
  --> app/services/database_sync/database_sync_service.py:58:34
   |
56 |         return self
57 |
58 |     def __exit__(self, exc_type, exc_val, exc_tb) -> None:
   |                                  ^^^^^^^
59 |         """退出上下文管理器，断开数据库连接。.
   |

ANN001 Missing type annotation for function argument `exc_tb`
  --> app/services/database_sync/database_sync_service.py:58:43
   |
56 |         return self
57 |
58 |     def __exit__(self, exc_type, exc_val, exc_tb) -> None:
   |                                           ^^^^^^
59 |         """退出上下文管理器，断开数据库连接。.
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/database_sync/database_sync_service.py:59:20
   |
58 |     def __exit__(self, exc_type, exc_val, exc_tb) -> None:
59 |         """退出上下文管理器，断开数据库连接。.
   |                            ^^
60 |
61 |         Args:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/database_sync/database_sync_service.py:79:24
   |
78 |         Returns:
79 |             连接成功返回 True，失败返回 False。
   |                              ^^
80 |
81 |         """
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/database_sync/database_sync_service.py:136:40
    |
135 |         Args:
136 |             target_databases: 目标数据库名称列表，为 None 时采集所有数据库。
    |                                                 ^^
137 |
138 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/database_sync/database_sync_service.py:166:24
    |
165 |         Returns:
166 |             保存成功返回 True，失败返回 False。
    |                              ^^
167 |
168 |         """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/database_sync/database_sync_service.py:175:24
    |
174 |         Returns:
175 |             更新成功返回 True，失败返回 False。
    |                              ^^
176 |
177 |         """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/database_sync/database_sync_service.py:196:13
    |
194 |     """采集所有活跃实例的数据库容量数据。.
195 |
196 |     遍历所有活跃实例，依次执行容量采集和保存操作。
    |                     ^^
197 |
198 |     Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/database_sync/database_sync_service.py:199:17
    |
198 |     Returns:
199 |         采集结果统计字典，包含以下字段：
    |                         ^^
200 |         {
201 |             'status': 'success' 或 'partial_success',
    |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/services/database_sync/database_sync_service.py:199:24
    |
198 |     Returns:
199 |         采集结果统计字典，包含以下字段：
    |                                       ^^
200 |         {
201 |             'status': 'success' 或 'partial_success',
    |

PLC0415 `import` should be at the top-level of a file
   --> app/services/database_sync/database_sync_service.py:209:5
    |
208 |     """
209 |     from app.models.instance import Instance
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
210 |
211 |     logger = get_system_logger()
    |

G201 Logging `.exception(...)` should be used instead of `.error(..., exc_info=True)`
   --> app/services/database_sync/database_sync_service.py:251:20
    |
249 |         except Exception as exc:
250 |             error_msg = f"实例 {instance.name} 采集失败: {exc}"
251 |             logger.error(
    |                    ^^^^^
252 |                 "capacity_collection_failed",
253 |                 instance=instance.name,
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/services/database_sync/inventory_manager.py:1:13
  |
1 | """容量同步库存管理器，实现 instance_databases 的增量更新。."""
  |                      ^^
2 |
3 | from __future__ import annotations
  |

D107 Missing docstring in `__init__`
  --> app/services/database_sync/inventory_manager.py:24:9
   |
22 |     """负责维护 instance_databases 表的增量同步逻辑。."""
23 |
24 |     def __init__(self, filter_manager=database_sync_filter_manager) -> None:
   |         ^^^^^^^^
25 |         self.logger = get_system_logger()
26 |         self.filter_manager = filter_manager
   |

ANN001 Missing type annotation for function argument `filter_manager`
  --> app/services/database_sync/inventory_manager.py:24:24
   |
22 |     """负责维护 instance_databases 表的增量同步逻辑。."""
23 |
24 |     def __init__(self, filter_manager=database_sync_filter_manager) -> None:
   |                        ^^^^^^^^^^^^^^
25 |         self.logger = get_system_logger()
26 |         self.filter_manager = filter_manager
   |

C901 `synchronize` is too complex (11 > 10)
  --> app/services/database_sync/inventory_manager.py:28:9
   |
26 |         self.filter_manager = filter_manager
27 |
28 |     def synchronize(
   |         ^^^^^^^^^^^
29 |         self,
30 |         instance: Instance,
   |

PLR0915 Too many statements (54 > 50)
  --> app/services/database_sync/inventory_manager.py:28:9
   |
26 |         self.filter_manager = filter_manager
27 |
28 |     def synchronize(
   |         ^^^^^^^^^^^
29 |         self,
30 |         instance: Instance,
   |

RUF003 Comment contains ambiguous `；` (FULLWIDTH SEMICOLON). Did you mean `;` (SEMICOLON)?
  --> app/services/database_sync/inventory_manager.py:67:34
   |
65 |             is_system = bool(item.get("is_system"))
66 |             if is_system and (instance.db_type or "").lower() != "mysql":
67 |                 # 非 MySQL 保持跳过系统库；MySQL 根据需求纳入同步
   |                                          ^^
68 |                 continue
   |

G201 Logging `.exception(...)` should be used instead of `.error(..., exc_info=True)`
   --> app/services/database_sync/inventory_manager.py:121:25
    |
119 |         except SQLAlchemyError as exc:
120 |             db.session.rollback()
121 |             self.logger.error(
    |                         ^^^^^
122 |                 "inventory_sync_commit_failed",
123 |                 instance=instance.name,
    |

D107 Missing docstring in `__init__`
  --> app/services/database_sync/persistence.py:27:9
   |
25 |     """负责容量采集相关的数据持久化。."""
26 |
27 |     def __init__(self) -> None:
   |         ^^^^^^^^
28 |         self.logger = get_system_logger()
   |

G201 Logging `.exception(...)` should be used instead of `.error(..., exc_info=True)`
   --> app/services/database_sync/persistence.py:101:25
    |
 99 |         except SQLAlchemyError as exc:
100 |             db.session.rollback()
101 |             self.logger.error(
    |                         ^^^^^
102 |                 "save_database_stats_upsert_failed",
103 |                 instance=instance.name,
    |

G201 Logging `.exception(...)` should be used instead of `.error(..., exc_info=True)`
   --> app/services/database_sync/persistence.py:118:25
    |
116 |         except SQLAlchemyError as exc:
117 |             db.session.rollback()
118 |             self.logger.error(
    |                         ^^^^^
119 |                 "save_database_stats_commit_failed",
120 |                 instance=instance.name,
    |

TRY300 Consider moving this statement to an `else` block
   --> app/services/database_sync/persistence.py:191:13
    |
189 |                 database_count=database_count,
190 |             )
191 |             return True
    |             ^^^^^^^^^^^
192 |         except SQLAlchemyError as exc:
193 |             self.logger.error(
    |

G201 Logging `.exception(...)` should be used instead of `.error(..., exc_info=True)`
   --> app/services/database_sync/persistence.py:193:25
    |
191 |             return True
192 |         except SQLAlchemyError as exc:
193 |             self.logger.error(
    |                         ^^^^^
194 |                 "save_instance_stats_failed",
195 |                 instance=instance.name,
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/database_sync/persistence.py:208:30
    |
207 |         Returns:
208 |             bool: 更新成功返回 True，缺少数据或提交失败返回 False。
    |                                    ^^
209 |
210 |         """
    |

G201 Logging `.exception(...)` should be used instead of `.error(..., exc_info=True)`
   --> app/services/database_sync/persistence.py:250:29
    |
248 |             except SQLAlchemyError as exc:
249 |                 db.session.rollback()
250 |                 self.logger.error(
    |                             ^^^^^
251 |                     "update_instance_total_size_commit_failed",
252 |                     instance=instance.name,
    |

D205 1 blank line required between summary line and description
 --> app/services/database_type_service.py:1:1
  |
1 | / """鲸落 - 数据库类型管理服务
2 | | 提供数据库类型的CRUD操作和业务逻辑.
3 | | """
  | |___^
4 |
5 |   from typing import Any
  |
help: Insert single blank line

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/database_type_service.py:41:26
   |
40 |         Args:
41 |             name: 数据库类型名称，如 'mysql'、'postgresql'。
   |                                 ^^
42 |
43 |         Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/database_type_service.py:44:23
   |
43 |         Returns:
44 |             匹配的数据库类型配置，如果不存在返回 None。
   |                                 ^^
45 |
46 |         """
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/database_type_service.py:54:26
   |
53 |         Returns:
54 |             包含表单所需字段的字典列表，格式如下：
   |                                       ^^
55 |             [
56 |                 {
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/services/database_type_service.py:54:31
   |
53 |         Returns:
54 |             包含表单所需字段的字典列表，格式如下：
   |                                                 ^^
55 |             [
56 |                 {
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/services/form_service/__init__.py:3:14
  |
1 | """表单服务模块。.
2 |
3 | 提供各种资源的表单处理服务，包括验证、清理和保存功能。
  |                           ^^
4 |
5 | 主要服务：
  |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
 --> app/services/form_service/__init__.py:5:5
  |
3 | 提供各种资源的表单处理服务，包括验证、清理和保存功能。
4 |
5 | 主要服务：
  |         ^^
6 | - BaseResourceService: 资源表单服务基类
7 | - InstanceFormService: 实例表单服务
  |

PLR0911 Too many return statements (8 > 6)
  --> app/services/form_service/classification_rule_service.py:45:9
   |
43 |         return dict(payload or {})
44 |
45 |     def validate(self, data: dict[str, Any], *, resource: ClassificationRule | None) -> ServiceResult[dict[str, Any]]:
   |         ^^^^^^^^
46 |         """校验分类规则数据。.
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/form_service/classification_rule_service.py:52:31
   |
50 |         Args:
51 |             data: 清理后的数据。
52 |             resource: 已存在的规则实例（编辑场景），创建时为 None。
   |                                       ^^
53 |
54 |         Returns:
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/form_service/classification_rule_service.py:52:36
   |
50 |         Args:
51 |             data: 清理后的数据。
52 |             resource: 已存在的规则实例（编辑场景），创建时为 None。
   |                                                 ^^
53 |
54 |         Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/form_service/classification_rule_service.py:52:37
   |
50 |         Args:
51 |             data: 清理后的数据。
52 |             resource: 已存在的规则实例（编辑场景），创建时为 None。
   |                                                   ^^
53 |
54 |         Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/form_service/classification_rule_service.py:55:17
   |
54 |         Returns:
55 |             校验结果，成功时返回规范化的数据，失败时返回错误信息。
   |                     ^^
56 |
57 |         """
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/form_service/classification_rule_service.py:55:29
   |
54 |         Returns:
55 |             校验结果，成功时返回规范化的数据，失败时返回错误信息。
   |                                             ^^
56 |
57 |         """
   |

ARG002 Unused method argument: `data`
   --> app/services/form_service/classification_rule_service.py:118:56
    |
116 |         instance.is_active = data["is_active"]
117 |
118 |     def after_save(self, instance: ClassificationRule, data: dict[str, Any]) -> None:
    |                                                        ^^^^
119 |         """保存后记录日志并清除缓存。.
    |

PLC0415 `import` should be at the top-level of a file
   --> app/services/form_service/classification_rule_service.py:129:9
    |
128 |         """
129 |         from app.utils.structlog_config import log_info
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
130 |
131 |         log_info(
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/services/form_service/classification_rule_service.py:140:16
    |
138 |             service = AccountClassificationService()
139 |             service.invalidate_cache()
140 |         except Exception as exc:
    |                ^^^^^^^^^
141 |             log_info(
142 |                 "清除分类缓存失败",
    |

ARG002 Unused method argument: `resource`
   --> app/services/form_service/classification_rule_service.py:148:32
    |
146 |             )
147 |
148 |     def build_context(self, *, resource: ClassificationRule | None) -> dict[str, Any]:
    |                                ^^^^^^^^
149 |         """构建模板渲染上下文。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/form_service/classification_rule_service.py:152:27
    |
151 |         Args:
152 |             resource: 规则实例，创建时为 None。
    |                               ^^
153 |
154 |         Returns:
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `expression`
   --> app/services/form_service/classification_rule_service.py:167:49
    |
165 |         }
166 |
167 |     def _normalize_expression(self, expression: Any) -> str:
    |                                                 ^^^
168 |         """规范化规则表达式为 JSON 字符串。.
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/services/form_service/classification_rule_service.py:171:30
    |
170 |         Args:
171 |             expression: 原始表达式（字符串或字典）。
    |                                   ^^
172 |
173 |         Returns:
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/services/form_service/classification_rule_service.py:171:37
    |
170 |         Args:
171 |             expression: 原始表达式（字符串或字典）。
    |                                                 ^^
172 |
173 |         Returns:
    |

PLR0911 Too many return statements (7 > 6)
   --> app/services/form_service/classification_rule_service.py:183:9
    |
181 |         return json.dumps(parsed, ensure_ascii=False, sort_keys=True)
182 |
183 |     def _coerce_bool(self, value: Any, *, default: bool) -> bool:
    |         ^^^^^^^^^^^^
184 |         """将值转换为布尔类型。.
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `value`
   --> app/services/form_service/classification_rule_service.py:183:35
    |
181 |         return json.dumps(parsed, ensure_ascii=False, sort_keys=True)
182 |
183 |     def _coerce_bool(self, value: Any, *, default: bool) -> bool:
    |                                   ^^^
184 |         """将值转换为布尔类型。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/form_service/classification_rule_service.py:217:25
    |
216 |         Returns:
217 |             如果值有效返回 True，否则返回 False。
    |                                ^^
218 |
219 |         """
    |

PLR0911 Too many return statements (7 > 6)
  --> app/services/form_service/classification_service.py:43:9
   |
41 |         return dict(payload or {})
42 |
43 |     def validate(self, data: dict[str, Any], *, resource: AccountClassification | None) -> ServiceResult[dict[str, Any]]:
   |         ^^^^^^^^
44 |         """校验账户分类数据。.
   |

E501 Line too long (121 > 120)
  --> app/services/form_service/classification_service.py:43:121
   |
41 |         return dict(payload or {})
42 |
43 |     def validate(self, data: dict[str, Any], *, resource: AccountClassification | None) -> ServiceResult[dict[str, Any]]:
   |                                                                                                                         ^
44 |         """校验账户分类数据。.
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/form_service/classification_service.py:50:31
   |
48 |         Args:
49 |             data: 清理后的数据。
50 |             resource: 已存在的分类实例（编辑场景），创建时为 None。
   |                                       ^^
51 |
52 |         Returns:
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/form_service/classification_service.py:50:36
   |
48 |         Args:
49 |             data: 清理后的数据。
50 |             resource: 已存在的分类实例（编辑场景），创建时为 None。
   |                                                 ^^
51 |
52 |         Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/form_service/classification_service.py:50:37
   |
48 |         Args:
49 |             data: 清理后的数据。
50 |             resource: 已存在的分类实例（编辑场景），创建时为 None。
   |                                                   ^^
51 |
52 |         Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/form_service/classification_service.py:53:17
   |
52 |         Returns:
53 |             校验结果，成功时返回规范化的数据，失败时返回错误信息。
   |                     ^^
54 |
55 |         """
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/form_service/classification_service.py:53:29
   |
52 |         Returns:
53 |             校验结果，成功时返回规范化的数据，失败时返回错误信息。
   |                                             ^^
54 |
55 |         """
   |

PLC0415 `import` should be at the top-level of a file
   --> app/services/form_service/classification_service.py:117:9
    |
115 |         """
116 |         action = "创建账户分类成功" if data.get("_is_create") else "更新账户分类成功"
117 |         from app.utils.structlog_config import log_info  # avoid circular import
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
118 |
119 |         log_info(
    |

ARG002 Unused method argument: `resource`
   --> app/services/form_service/classification_service.py:126:32
    |
124 |         )
125 |
126 |     def build_context(self, *, resource: AccountClassification | None) -> dict[str, Any]:
    |                                ^^^^^^^^
127 |         """构建模板渲染上下文。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/form_service/classification_service.py:130:27
    |
129 |         Args:
130 |             resource: 分类实例，创建时为 None。
    |                               ^^
131 |
132 |         Returns:
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `raw_value`
   --> app/services/form_service/classification_service.py:146:42
    |
144 |         }
145 |
146 |     def _parse_priority(self, raw_value: Any, default: int) -> int:
    |                                          ^^^
147 |         """解析优先级值。.
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/services/form_service/classification_service.py:154:21
    |
153 |         Returns:
154 |             解析后的优先级值（0-100）。
    |                             ^^
155 |
156 |         Raises:
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/services/form_service/classification_service.py:154:27
    |
153 |         Returns:
154 |             解析后的优先级值（0-100）。
    |                                    ^^
155 |
156 |         Raises:
    |

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
   --> app/services/form_service/classification_service.py:166:13
    |
164 |         except (TypeError, ValueError):
165 |             msg = "优先级必须为整数"
166 |             raise ValueError(msg)
    |             ^^^^^^^^^^^^^^^^^^^^^
167 |         return max(0, min(value, 100))
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/form_service/classification_service.py:177:25
    |
176 |         Returns:
177 |             如果值有效返回 True，否则返回 False。
    |                                ^^
178 |
179 |         """
    |

C901 `validate` is too complex (11 > 10)
  --> app/services/form_service/credential_service.py:50:9
   |
48 |         return sanitize_form_data(payload or {})
49 |
50 |     def validate(self, data: dict[str, Any], *, resource: Credential | None) -> ServiceResult[dict[str, Any]]:
   |         ^^^^^^^^
51 |         """校验凭据数据。.
   |

PLR0911 Too many return statements (7 > 6)
  --> app/services/form_service/credential_service.py:50:9
   |
48 |         return sanitize_form_data(payload or {})
49 |
50 |     def validate(self, data: dict[str, Any], *, resource: Credential | None) -> ServiceResult[dict[str, Any]]:
   |         ^^^^^^^^
51 |         """校验凭据数据。.
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/form_service/credential_service.py:57:31
   |
55 |         Args:
56 |             data: 清理后的数据。
57 |             resource: 已存在的凭据实例（编辑场景），创建时为 None。
   |                                       ^^
58 |
59 |         Returns:
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/form_service/credential_service.py:57:36
   |
55 |         Args:
56 |             data: 清理后的数据。
57 |             resource: 已存在的凭据实例（编辑场景），创建时为 None。
   |                                                 ^^
58 |
59 |         Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/form_service/credential_service.py:57:37
   |
55 |         Args:
56 |             data: 清理后的数据。
57 |             resource: 已存在的凭据实例（编辑场景），创建时为 None。
   |                                                   ^^
58 |
59 |         Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/form_service/credential_service.py:60:17
   |
59 |         Returns:
60 |             校验结果，成功时返回规范化的数据，失败时返回错误信息。
   |                     ^^
61 |
62 |         """
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/form_service/credential_service.py:60:29
   |
59 |         Returns:
60 |             校验结果，成功时返回规范化的数据，失败时返回错误信息。
   |                                             ^^
61 |
62 |         """
   |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/form_service/credential_service.py:99:47
    |
 97 |             query = query.filter(Credential.id != resource.id)
 98 |         if query.first():
 99 |             return ServiceResult.fail("凭据名称已存在，请使用其他名称")
    |                                                      ^^
100 |
101 |         return ServiceResult.ok(normalized)
    |

ARG002 Unused method argument: `resource`
   --> app/services/form_service/credential_service.py:147:32
    |
145 |         )
146 |
147 |     def build_context(self, *, resource: Credential | None) -> dict[str, Any]:
    |                                ^^^^^^^^
148 |         """构建模板渲染上下文。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/form_service/credential_service.py:151:27
    |
150 |         Args:
151 |             resource: 凭据实例，创建时为 None。
    |                               ^^
152 |
153 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/form_service/credential_service.py:170:31
    |
168 |         Args:
169 |             data: 原始数据。
170 |             resource: 已存在的凭据实例，创建时为 None。
    |                                       ^^
171 |
172 |         Returns:
    |

E501 Line too long (127 > 120)
   --> app/services/form_service/credential_service.py:178:121
    |
176 |         normalized: dict[str, Any] = {}
177 |         normalized["name"] = (data.get("name") or (resource.name if resource else "")).strip()
178 |         normalized["credential_type"] = (data.get("credential_type") or (resource.credential_type if resource else "")).strip()
    |                                                                                                                         ^^^^^^^
179 |         normalized["username"] = (data.get("username") or (resource.username if resource else "")).strip()
    |

PLR0911 Too many return statements (7 > 6)
   --> app/services/form_service/credential_service.py:198:9
    |
196 |         return normalized
197 |
198 |     def _coerce_bool(self, value: Any, *, default: bool) -> bool:
    |         ^^^^^^^^^^^^
199 |         """将值转换为布尔类型。.
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `value`
   --> app/services/form_service/credential_service.py:198:35
    |
196 |         return normalized
197 |
198 |     def _coerce_bool(self, value: Any, *, default: bool) -> bool:
    |                                   ^^^
199 |         """将值转换为布尔类型。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/form_service/credential_service.py:228:33
    |
227 |         Credential 模型的构造函数要求 name/credential_type/username/password
228 |         四个必填参数。表单服务在赋值阶段才会写入真实数据，因此这里
    |                                                         ^^
229 |         提供占位值以便复用基类的 upsert 流程。
230 |         """
    |

S106 Possible hardcoded password assigned to argument: "password"
   --> app/services/form_service/credential_service.py:235:13
    |
233 |             credential_type="database",
234 |             username="__pending__",
235 |             password="__pending__",
    |             ^^^^^^^^^^^^^^^^^^^^^^
236 |         )
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/services/form_service/credential_service.py:243:31
    |
241 |         Args:
242 |             payload: 原始表单数据。
243 |             resource: 已存在的凭据实例（编辑场景），创建时为 None。
    |                                       ^^
244 |
245 |         Returns:
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/services/form_service/credential_service.py:243:36
    |
241 |         Args:
242 |             payload: 原始表单数据。
243 |             resource: 已存在的凭据实例（编辑场景），创建时为 None。
    |                                                 ^^
244 |
245 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/form_service/credential_service.py:243:37
    |
241 |         Args:
242 |             payload: 原始表单数据。
243 |             resource: 已存在的凭据实例（编辑场景），创建时为 None。
    |                                                   ^^
244 |
245 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/form_service/credential_service.py:246:17
    |
245 |         Returns:
246 |             操作结果，成功时返回凭据实例，失败时返回错误信息。
    |                     ^^
247 |
248 |         """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/form_service/credential_service.py:246:27
    |
245 |         Returns:
246 |             操作结果，成功时返回凭据实例，失败时返回错误信息。
    |                                         ^^
247 |
248 |         """
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/form_service/credential_service.py:268:28
    |
266 |         lowered = message.lower()
267 |         if "unique constraint failed" in lowered or "duplicate key value" in lowered:
268 |             return "凭据名称已存在，请使用其他名称"
    |                                   ^^
269 |         if "not null constraint failed" in lowered:
270 |             return "必填字段不能为空"
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/form_service/credential_service.py:271:23
    |
269 |         if "not null constraint failed" in lowered:
270 |             return "必填字段不能为空"
271 |         return "保存凭据失败，请稍后再试"
    |                             ^^
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/form_service/instance_service.py:51:29
   |
49 |         Args:
50 |             data: 清理后的数据。
51 |             resource: 已存在的实例（编辑场景），创建时为 None。
   |                                   ^^
52 |
53 |         Returns:
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/form_service/instance_service.py:51:34
   |
49 |         Args:
50 |             data: 清理后的数据。
51 |             resource: 已存在的实例（编辑场景），创建时为 None。
   |                                             ^^
52 |
53 |         Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/form_service/instance_service.py:51:35
   |
49 |         Args:
50 |             data: 清理后的数据。
51 |             resource: 已存在的实例（编辑场景），创建时为 None。
   |                                               ^^
52 |
53 |         Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/form_service/instance_service.py:54:17
   |
53 |         Returns:
54 |             校验结果，成功时返回规范化的数据，失败时返回错误信息。
   |                     ^^
55 |
56 |         """
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/form_service/instance_service.py:54:29
   |
53 |         Returns:
54 |             校验结果，成功时返回规范化的数据，失败时返回错误信息。
   |                                             ^^
55 |
56 |         """
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/form_service/instance_service.py:128:27
    |
127 |         Args:
128 |             resource: 实例对象，创建时为 None。
    |                               ^^
129 |
130 |         Returns:
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `credential_raw`
   --> app/services/form_service/instance_service.py:150:54
    |
148 |     # Helpers
149 |     # ------------------------------------------------------------------ #
150 |     def _resolve_credential_id(self, credential_raw: Any) -> int | None:
    |                                                      ^^^
151 |         """解析凭据 ID。.
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/services/form_service/instance_service.py:154:36
    |
153 |         Args:
154 |             credential_raw: 原始凭据 ID（可能是整数、字符串或列表）。
    |                                        ^^
155 |
156 |         Returns:
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/services/form_service/instance_service.py:154:49
    |
153 |         Args:
154 |             credential_raw: 原始凭据 ID（可能是整数、字符串或列表）。
    |                                                                  ^^
155 |
156 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/form_service/instance_service.py:157:22
    |
156 |         Returns:
157 |             解析后的凭据 ID，如果为空则返回 None。
    |                            ^^
158 |
159 |         Raises:
    |

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
   --> app/services/form_service/instance_service.py:169:13
    |
167 |         except (TypeError, ValueError):
168 |             msg = "无效的凭据ID"
169 |             raise ValueError(msg)
    |             ^^^^^^^^^^^^^^^^^^^^^
170 |
171 |         credential = Credential.query.get(credential_id)
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `tag_field`
   --> app/services/form_service/instance_service.py:177:47
    |
175 |         return credential_id
176 |
177 |     def _normalize_tag_names(self, tag_field: Any) -> list[str]:
    |                                               ^^^
178 |         """规范化标签名称列表。.
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/services/form_service/instance_service.py:181:30
    |
180 |         Args:
181 |             tag_field: 原始标签字段（可能是列表或逗号分隔的字符串）。
    |                                    ^^
182 |
183 |         Returns:
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/services/form_service/instance_service.py:181:45
    |
180 |         Args:
181 |             tag_field: 原始标签字段（可能是列表或逗号分隔的字符串）。
    |                                                                  ^^
182 |
183 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/form_service/instance_service.py:216:23
    |
215 |     def _create_instance(self) -> Instance:
216 |         """提供实例模型的占位对象，便于沿用基类保存流程。."""
    |                                  ^^
217 |         return Instance(
218 |             name="__pending__",
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/services/form_service/instance_service.py:261:16
    |
259 |                     tags=added,
260 |                 )
261 |         except Exception as exc:
    |                ^^^^^^^^^
262 |             db.session.rollback()
263 |             log_error(
    |

PLR0911 Too many return statements (7 > 6)
  --> app/services/form_service/password_service.py:43:9
   |
41 |         return sanitize_form_data(payload or {})
42 |
43 |     def validate(self, data: dict[str, Any], *, resource: User | None) -> ServiceResult[dict[str, Any]]:
   |         ^^^^^^^^
44 |         """校验密码修改数据。.
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/form_service/password_service.py:53:17
   |
52 |         Returns:
53 |             校验结果，成功时返回包含新密码的数据，失败时返回错误信息。
   |                     ^^
54 |
55 |         """
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/form_service/password_service.py:53:31
   |
52 |         Returns:
53 |             校验结果，成功时返回包含新密码的数据，失败时返回错误信息。
   |                                                 ^^
54 |
55 |         """
   |

ARG002 Unused method argument: `instance`
  --> app/services/form_service/password_service.py:94:26
   |
92 |         instance.set_password(data["new_password"])
93 |
94 |     def after_save(self, instance: User, data: dict[str, Any]) -> None:
   |                          ^^^^^^^^
95 |         """保存后记录日志。.
   |

ARG002 Unused method argument: `data`
  --> app/services/form_service/password_service.py:94:42
   |
92 |         instance.set_password(data["new_password"])
93 |
94 |     def after_save(self, instance: User, data: dict[str, Any]) -> None:
   |                                          ^^^^
95 |         """保存后记录日志。.
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/form_service/password_service.py:119:17
    |
118 |         Returns:
119 |             操作结果，成功时返回用户实例，失败时返回错误信息。
    |                     ^^
120 |
121 |         """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/form_service/password_service.py:119:27
    |
118 |         Returns:
119 |             操作结果，成功时返回用户实例，失败时返回错误信息。
    |                                         ^^
120 |
121 |         """
    |

E501 Line too long (131 > 120)
   --> app/services/form_service/password_service.py:125:117
    |
123 | …rce)
124 | …
125 | …"验证失败", message_key=validation.message_key, extra=validation.extra)
    |                                                              ^^^^^^^^^^^
126 | …
127 | …
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/services/form_service/password_service.py:136:16
    |
134 |             db.session.add(instance)
135 |             db.session.commit()
136 |         except Exception as exc:
    |                ^^^^^^^^^
137 |             db.session.rollback()
138 |             return ServiceResult.fail("密码修改失败，请稍后再试", extra={"exception": str(exc)})
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/form_service/password_service.py:138:46
    |
136 |         except Exception as exc:
137 |             db.session.rollback()
138 |             return ServiceResult.fail("密码修改失败，请稍后再试", extra={"exception": str(exc)})
    |                                                    ^^
139 |
140 |         self.after_save(instance, validation.data or sanitized)
    |

D205 1 blank line required between summary line and description
 --> app/services/form_service/resource_service.py:1:1
  |
1 | / """通用资源表单服务基类.
2 | | ---------------------------------
3 | | 负责封装表单校验、模型赋值、数据库提交与统一的结果返回。
4 | | """
  | |___^
5 |
6 |   from __future__ import annotations
  |
help: Insert single blank line

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/form_service/resource_service.py:26:17
   |
24 |     """统一的服务层返回结构。.
25 |
26 |     用于封装服务层操作的结果，包含成功状态、数据、消息和额外信息。
   |                             ^^
27 |
28 |     Attributes:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/form_service/resource_service.py:30:22
   |
28 |     Attributes:
29 |         success: 操作是否成功。
30 |         data: 返回的数据对象，失败时为 None。
   |                             ^^
31 |         message: 返回消息，用于前端展示。
32 |         message_key: 消息键，用于国际化。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/form_service/resource_service.py:31:22
   |
29 |         success: 操作是否成功。
30 |         data: 返回的数据对象，失败时为 None。
31 |         message: 返回消息，用于前端展示。
   |                          ^^
32 |         message_key: 消息键，用于国际化。
33 |         extra: 额外信息字典，用于传递详细错误或调试信息。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/form_service/resource_service.py:32:25
   |
30 |         data: 返回的数据对象，失败时为 None。
31 |         message: 返回消息，用于前端展示。
32 |         message_key: 消息键，用于国际化。
   |                            ^^
33 |         extra: 额外信息字典，用于传递详细错误或调试信息。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/form_service/resource_service.py:33:22
   |
31 |         message: 返回消息，用于前端展示。
32 |         message_key: 消息键，用于国际化。
33 |         extra: 额外信息字典，用于传递详细错误或调试信息。
   |                            ^^
34 |
35 |     """
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/form_service/resource_service.py:69:32
   |
67 |         Args:
68 |             message: 错误消息。
69 |             message_key: 可选的消息键，用于国际化。
   |                                      ^^
70 |             extra: 可选的额外信息字典。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/form_service/resource_service.py:83:19
   |
81 |     """资源表单服务基类。.
82 |
83 |     提供通用的资源创建和更新流程，子类只需实现 validate、assign、after_save 等钩子即可。
   |                                 ^^
84 |
85 |     Attributes:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/form_service/resource_service.py:86:22
   |
85 |     Attributes:
86 |         model: 关联的模型类，子类必须设置。
   |                            ^^
87 |
88 |     """
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/form_service/resource_service.py:99:17
    |
 98 |         Returns:
 99 |             资源实例，不存在时返回 None。
    |                     ^^
100 |
101 |         Raises:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/form_service/resource_service.py:114:20
    |
112 |     # --------------------------------------------------------------------- #
113 |     def sanitize(self, payload: Mapping[str, Any]) -> dict[str, Any]:
114 |         """清理原始请求数据，默认转换为普通字典。.
    |                            ^^
115 |
116 |         Args:
    |

ARG002 Unused method argument: `resource`
   --> app/services/form_service/resource_service.py:125:49
    |
123 |         return dict(payload or {})
124 |
125 |     def validate(self, data: dict[str, Any], *, resource: TModel | None) -> ServiceResult[dict[str, Any]]:
    |                                                 ^^^^^^^^
126 |         """子类应该实现具体校验逻辑。.
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/services/form_service/resource_service.py:130:31
    |
128 |         Args:
129 |             data: 清理后的数据。
130 |             resource: 已存在的资源实例（编辑场景），创建时为 None。
    |                                       ^^
131 |
132 |         Returns:
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/services/form_service/resource_service.py:130:36
    |
128 |         Args:
129 |             data: 清理后的数据。
130 |             resource: 已存在的资源实例（编辑场景），创建时为 None。
    |                                                 ^^
131 |
132 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/form_service/resource_service.py:130:37
    |
128 |         Args:
129 |             data: 清理后的数据。
130 |             resource: 已存在的资源实例（编辑场景），创建时为 None。
    |                                                   ^^
131 |
132 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/form_service/resource_service.py:133:17
    |
132 |         Returns:
133 |             校验结果，成功时返回清理后的数据，失败时返回错误信息。
    |                     ^^
134 |
135 |         """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/form_service/resource_service.py:133:29
    |
132 |         Returns:
133 |             校验结果，成功时返回清理后的数据，失败时返回错误信息。
    |                                             ^^
134 |
135 |         """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/form_service/resource_service.py:139:21
    |
138 |     def assign(self, instance: TModel, data: dict[str, Any]) -> None:
139 |         """将数据写入模型实例，必须由子类实现。.
    |                              ^^
140 |
141 |         Args:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/form_service/resource_service.py:146:26
    |
145 |         Returns:
146 |             None: 赋值完成后返回，具体逻辑由子类实现。
    |                                 ^^
147 |
148 |         Raises:
    |

ARG002 Unused method argument: `instance`
   --> app/services/form_service/resource_service.py:154:26
    |
152 |         raise NotImplementedError
153 |
154 |     def after_save(self, instance: TModel, data: dict[str, Any]) -> None:
    |                          ^^^^^^^^
155 |         """保存成功后的钩子（可选）。.
    |

ARG002 Unused method argument: `data`
   --> app/services/form_service/resource_service.py:154:44
    |
152 |         raise NotImplementedError
153 |
154 |     def after_save(self, instance: TModel, data: dict[str, Any]) -> None:
    |                                            ^^^^
155 |         """保存成功后的钩子（可选）。.
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/services/form_service/resource_service.py:155:20
    |
154 |     def after_save(self, instance: TModel, data: dict[str, Any]) -> None:
155 |         """保存成功后的钩子（可选）。.
    |                            ^^
156 |
157 |         Args:
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/services/form_service/resource_service.py:155:23
    |
154 |     def after_save(self, instance: TModel, data: dict[str, Any]) -> None:
155 |         """保存成功后的钩子（可选）。.
    |                                  ^^
156 |
157 |         Args:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/form_service/resource_service.py:162:28
    |
161 |         Returns:
162 |             None: 默认不进行任何操作，子类可覆盖。
    |                                     ^^
163 |
164 |         """
    |

ARG002 Unused method argument: `resource`
   --> app/services/form_service/resource_service.py:167:32
    |
165 |         return
166 |
167 |     def build_context(self, *, resource: TModel | None) -> dict[str, Any]:
    |                                ^^^^^^^^
168 |         """提供模板渲染所需的额外上下文。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/form_service/resource_service.py:171:27
    |
170 |         Args:
171 |             resource: 资源实例，创建时为 None。
    |                               ^^
172 |
173 |         Returns:
    |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/services/form_service/resource_service.py:185:20
    |
183 |         """创建或更新资源。.
184 |
185 |         执行完整的资源保存流程：清理数据 -> 校验 -> 赋值 -> 保存 -> 后置钩子。
    |                               ^^
186 |
187 |         Args:
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/services/form_service/resource_service.py:189:29
    |
187 |         Args:
188 |             payload: 原始请求数据。
189 |             resource: 已存在的实例（编辑场景），创建时为 None。
    |                                   ^^
190 |
191 |         Returns:
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/services/form_service/resource_service.py:189:34
    |
187 |         Args:
188 |             payload: 原始请求数据。
189 |             resource: 已存在的实例（编辑场景），创建时为 None。
    |                                             ^^
190 |
191 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/form_service/resource_service.py:189:35
    |
187 |         Args:
188 |             payload: 原始请求数据。
189 |             resource: 已存在的实例（编辑场景），创建时为 None。
    |                                               ^^
190 |
191 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/form_service/resource_service.py:192:29
    |
191 |         Returns:
192 |             ServiceResult 实例，成功时包含保存后的资源对象，失败时包含错误信息。
    |                               ^^
193 |
194 |         """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/form_service/resource_service.py:192:43
    |
191 |         Returns:
192 |             ServiceResult 实例，成功时包含保存后的资源对象，失败时包含错误信息。
    |                                                           ^^
193 |
194 |         """
    |

E501 Line too long (131 > 120)
   --> app/services/form_service/resource_service.py:198:117
    |
196 | …rce)
197 | …
198 | …"验证失败", message_key=validation.message_key, extra=validation.extra)
    |                                                              ^^^^^^^^^^^
199 | …
200 | …
    |

G004 Logging statement uses f-string
   --> app/services/form_service/resource_service.py:208:42
    |
206 |         except SQLAlchemyError as exc:
207 |             db.session.rollback()
208 |             current_app.logger.exception(f"资源表单保存失败: {self.__class__.__name__}")
    |                                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
209 |             return ServiceResult.fail("保存失败，请稍后再试", extra={"exception": str(exc)})
    |
help: Convert to lazy `%` formatting

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/form_service/resource_service.py:209:44
    |
207 |             db.session.rollback()
208 |             current_app.logger.exception(f"资源表单保存失败: {self.__class__.__name__}")
209 |             return ServiceResult.fail("保存失败，请稍后再试", extra={"exception": str(exc)})
    |                                                ^^
210 |
211 |         self.after_save(instance, validation.data or sanitized)
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/services/form_service/scheduler_job_service.py:3:17
  |
1 | """定时任务表单服务。.
2 |
3 | 提供内置定时任务触发器的编辑功能，支持 Cron、Interval 和 Date 三种触发器类型。
  |                                 ^^
4 | """
  |

A004 Import `SystemError` is shadowing a Python builtin
  --> app/services/form_service/scheduler_job_service.py:15:39
   |
14 | from app.constants.scheduler_jobs import BUILTIN_TASK_IDS
15 | from app.errors import NotFoundError, SystemError, ValidationError
   |                                       ^^^^^^^^^^^
16 | from app.scheduler import get_scheduler
17 | from app.services.form_service.resource_service import BaseResourceService, ServiceResult
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/form_service/scheduler_job_service.py:28:17
   |
26 |     """定时任务表单服务。.
27 |
28 |     负责内置任务触发器的编辑，支持 Cron、Interval 和 Date 三种触发器类型。
   |                             ^^
29 |
30 |     Attributes:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/form_service/scheduler_job_service.py:31:20
   |
30 |     Attributes:
31 |         model: 占位模型，不会持久化到数据库。
   |                        ^^
32 |
33 |     Example:
   |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/form_service/scheduler_job_service.py:41:23
   |
39 |     """
40 |
41 |     model = dict  # 占位，不会持久化
   |                         ^^
42 |
43 |     def sanitize(self, payload: Mapping[str, Any]) -> dict[str, Any]:
   |

PGH003 Use specific rule codes when ignoring type issues
  --> app/services/form_service/scheduler_job_service.py:71:38
   |
70 |         """
71 |         scheduler = get_scheduler()  # type: ignore
   |                                      ^^^^^^^^^^^^^^
72 |         if not scheduler.running:
73 |             log_error("调度器未启动，无法加载任务", module="scheduler")
   |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/form_service/scheduler_job_service.py:73:30
   |
71 |         scheduler = get_scheduler()  # type: ignore
72 |         if not scheduler.running:
73 |             log_error("调度器未启动，无法加载任务", module="scheduler")
   |                                    ^^
74 |             msg = "调度器未启动"
75 |             raise SystemError(msg)
   |

ARG002 Unused method argument: `data`
   --> app/services/form_service/scheduler_job_service.py:127:52
    |
125 |         scheduler.modify_job(job.id, trigger=data["trigger"])
126 |
127 |     def after_save(self, instance: dict[str, Any], data: dict[str, Any]) -> None:
    |                                                    ^^^^
128 |         """触发器更新后的善后处理，负责记录下一次执行时间。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/form_service/scheduler_job_service.py:128:23
    |
127 |     def after_save(self, instance: dict[str, Any], data: dict[str, Any]) -> None:
128 |         """触发器更新后的善后处理，负责记录下一次执行时间。.
    |                                  ^^
129 |
130 |         Args:
    |

E501 Line too long (122 > 120)
   --> app/services/form_service/scheduler_job_service.py:149:121
    |
147 |         )
148 |
149 |     def upsert(self, payload: Mapping[str, Any], resource: dict[str, Any] | None = None) -> ServiceResult[dict[str, Any]]:
    |                                                                                                                         ^^
150 |         """更新内置任务的触发器配置。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/form_service/scheduler_job_service.py:157:52
    |
156 |         Returns:
157 |             ServiceResult[dict[str, Any]]: 成功时返回上下文，失败时返回错误信息。
    |                                                            ^^
158 |
159 |         """
    |

E501 Line too long (131 > 120)
   --> app/services/form_service/scheduler_job_service.py:163:117
    |
161 | …rce)
162 | …
163 | …"验证失败", message_key=validation.message_key, extra=validation.extra)
    |                                                              ^^^^^^^^^^^
164 | …
165 | …
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/services/form_service/scheduler_job_service.py:172:16
    |
170 |         except ValidationError:
171 |             raise
172 |         except Exception as exc:
    |                ^^^^^^^^^
173 |             log_error("更新任务触发器失败", module="scheduler", job_id=resource["job"].id, error=str(exc))
174 |             return ServiceResult.fail("更新任务触发器失败", extra={"exception": str(exc)})
    |

C901 `_build_trigger` is too complex (29 > 10)
   --> app/services/form_service/scheduler_job_service.py:179:9
    |
177 |         return ServiceResult.ok(resource)
178 |
179 |     def _build_trigger(self, data: Mapping[str, Any]) -> CronTrigger | IntervalTrigger | DateTrigger | None:
    |         ^^^^^^^^^^^^^^
180 |         """根据表单数据构建 APScheduler 触发器。.
    |

PLR0911 Too many return statements (10 > 6)
   --> app/services/form_service/scheduler_job_service.py:179:9
    |
177 |         return ServiceResult.ok(resource)
178 |
179 |     def _build_trigger(self, data: Mapping[str, Any]) -> CronTrigger | IntervalTrigger | DateTrigger | None:
    |         ^^^^^^^^^^^^^^
180 |         """根据表单数据构建 APScheduler 触发器。.
    |

PLR0912 Too many branches (25 > 12)
   --> app/services/form_service/scheduler_job_service.py:179:9
    |
177 |         return ServiceResult.ok(resource)
178 |
179 |     def _build_trigger(self, data: Mapping[str, Any]) -> CronTrigger | IntervalTrigger | DateTrigger | None:
    |         ^^^^^^^^^^^^^^
180 |         """根据表单数据构建 APScheduler 触发器。.
    |

PLR0915 Too many statements (70 > 50)
   --> app/services/form_service/scheduler_job_service.py:179:9
    |
177 |         return ServiceResult.ok(resource)
178 |
179 |     def _build_trigger(self, data: Mapping[str, Any]) -> CronTrigger | IntervalTrigger | DateTrigger | None:
    |         ^^^^^^^^^^^^^^
180 |         """根据表单数据构建 APScheduler 触发器。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/form_service/scheduler_job_service.py:186:74
    |
185 |         Returns:
186 |             CronTrigger | IntervalTrigger | DateTrigger | None: 构建成功返回触发器，否则返回 None。
    |                                                                                   ^^
187 |
188 |         """
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `pick`
   --> app/services/form_service/scheduler_job_service.py:196:37
    |
194 |             parts: list[str] = expr.split() if expr else []
195 |
196 |             def pick(*keys: str) -> Any:
    |                                     ^^^
197 |                 for key in keys:
198 |                     value = data.get(key)
    |

PLR2004 Magic value used in comparison, consider replacing `7` with a constant variable
   --> app/services/form_service/scheduler_job_service.py:212:34
    |
211 |             try:
212 |                 if len(parts) == 7:
    |                                  ^
213 |                     second, minute, hour, day, month, day_of_week, year = [
214 |                         pick_value or part for pick_value, part in zip(
    |

PLR2004 Magic value used in comparison, consider replacing `6` with a constant variable
   --> app/services/form_service/scheduler_job_service.py:218:36
    |
216 |                         )
217 |                     ]
218 |                 elif len(parts) == 6:
    |                                    ^
219 |                     second, minute, hour, day, month, day_of_week = [
220 |                         pick_value or part for pick_value, part in zip(
    |

PLR2004 Magic value used in comparison, consider replacing `5` with a constant variable
   --> app/services/form_service/scheduler_job_service.py:224:36
    |
222 |                         )
223 |                     ]
224 |                 elif len(parts) == 5:
    |                                    ^
225 |                     minute, hour, day, month, day_of_week = [
226 |                         pick_value or part for pick_value, part in zip(
    |

S110 `try`-`except`-`pass` detected, consider logging the exception
   --> app/services/form_service/scheduler_job_service.py:230:13
    |
228 |                           )
229 |                       ]
230 | /             except Exception:
231 | |                 pass
    | |____________________^
232 |
233 |               if year is not None:
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/services/form_service/scheduler_job_service.py:230:20
    |
228 |                         )
229 |                     ]
230 |             except Exception:
    |                    ^^^^^^^^^
231 |                 pass
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/services/form_service/scheduler_job_service.py:251:20
    |
249 |                 cron_kwargs["timezone"] = "Asia/Shanghai"
250 |                 return CronTrigger(**cron_kwargs)
251 |             except Exception as exc:
    |                    ^^^^^^^^^
252 |                 log_error("CronTrigger 构建失败", module="scheduler", error=str(exc))
253 |                 return None
    |

S112 `try`-`except`-`continue` detected, consider logging the exception
   --> app/services/form_service/scheduler_job_service.py:265:17
    |
263 |                       if converted > 0:
264 |                           kwargs[key] = converted
265 | /                 except Exception:
266 | |                     continue
    | |____________________________^
267 |               if not kwargs:
268 |                   return None
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/services/form_service/scheduler_job_service.py:265:24
    |
263 |                     if converted > 0:
264 |                         kwargs[key] = converted
265 |                 except Exception:
    |                        ^^^^^^^^^
266 |                     continue
267 |             if not kwargs:
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/services/form_service/scheduler_job_service.py:271:20
    |
269 |             try:
270 |                 return IntervalTrigger(**kwargs)
271 |             except Exception as exc:
    |                    ^^^^^^^^^
272 |                 log_error("IntervalTrigger 构建失败", module="scheduler", error=str(exc))
273 |                 return None
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/services/form_service/scheduler_job_service.py:282:20
    |
280 |             try:
281 |                 dt = time_utils.to_utc(str(run_date))
282 |             except Exception:
    |                    ^^^^^^^^^
283 |                 dt = None
284 |             if dt is None:
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/services/form_service/scheduler_job_service.py:288:20
    |
286 |             try:
287 |                 return DateTrigger(run_date=dt)
288 |             except Exception as exc:
    |                    ^^^^^^^^^
289 |                 log_error("DateTrigger 构建失败", module="scheduler", error=str(exc))
290 |                 return None
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/form_service/tag_service.py:53:31
   |
51 |         Args:
52 |             data: 清理后的数据。
53 |             resource: 已存在的标签实例（编辑场景），创建时为 None。
   |                                       ^^
54 |
55 |         Returns:
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/form_service/tag_service.py:53:36
   |
51 |         Args:
52 |             data: 清理后的数据。
53 |             resource: 已存在的标签实例（编辑场景），创建时为 None。
   |                                                 ^^
54 |
55 |         Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/form_service/tag_service.py:53:37
   |
51 |         Args:
52 |             data: 清理后的数据。
53 |             resource: 已存在的标签实例（编辑场景），创建时为 None。
   |                                                   ^^
54 |
55 |         Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/form_service/tag_service.py:56:17
   |
55 |         Returns:
56 |             校验结果，成功时返回规范化的数据，失败时返回错误信息。
   |                     ^^
57 |
58 |         """
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/form_service/tag_service.py:56:29
   |
55 |         Returns:
56 |             校验结果，成功时返回规范化的数据，失败时返回错误信息。
   |                                             ^^
57 |
58 |         """
   |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/form_service/tag_service.py:81:47
   |
79 |             query = query.filter(Tag.id != resource.id)
80 |         if query.first():
81 |             return ServiceResult.fail("标签代码已存在，请使用其他名称")
   |                                                      ^^
82 |
83 |         return ServiceResult.ok(normalized)
   |

ARG002 Unused method argument: `resource`
   --> app/services/form_service/tag_service.py:125:32
    |
123 |         )
124 |
125 |     def build_context(self, *, resource: Tag | None) -> dict[str, Any]:
    |                                ^^^^^^^^
126 |         """构建模板渲染上下文。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/form_service/tag_service.py:129:27
    |
128 |         Args:
129 |             resource: 标签实例，创建时为 None。
    |                               ^^
130 |
131 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/form_service/tag_service.py:156:31
    |
154 |         Args:
155 |             data: 原始数据。
156 |             resource: 已存在的标签实例，创建时为 None。
    |                                       ^^
157 |
158 |         Returns:
    |

PLR0911 Too many return statements (7 > 6)
   --> app/services/form_service/tag_service.py:175:9
    |
173 |         return normalized
174 |
175 |     def _coerce_bool(self, value: Any, *, default: bool) -> bool:
    |         ^^^^^^^^^^^^
176 |         """将值转换为布尔类型。.
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `value`
   --> app/services/form_service/tag_service.py:175:35
    |
173 |         return normalized
174 |
175 |     def _coerce_bool(self, value: Any, *, default: bool) -> bool:
    |                                   ^^^
176 |         """将值转换为布尔类型。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/form_service/tag_service.py:204:49
    |
202 |         """提供标签模型的占位实例。.
203 |
204 |         Tag 的构造函数要求传入 name/display_name/category，
    |                                                          ^^
205 |         因此前端数据尚未赋值时使用默认占位内容，随后 assign 会覆盖。
206 |         """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/form_service/tag_service.py:205:28
    |
204 |         Tag 的构造函数要求传入 name/display_name/category，
205 |         因此前端数据尚未赋值时使用默认占位内容，随后 assign 会覆盖。
    |                                               ^^
206 |         """
207 |         return Tag(
    |

RUF012 Mutable class attributes should be annotated with `typing.ClassVar`
  --> app/services/form_service/user_service.py:35:21
   |
33 |     model = User
34 |     USERNAME_PATTERN = re.compile(r"^[A-Za-z0-9_]{3,20}$")
35 |     ALLOWED_ROLES = {UserRole.ADMIN, UserRole.USER}
   |                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
36 |     MESSAGE_USERNAME_EXISTS = "USERNAME_EXISTS"
37 |     MESSAGE_LAST_ADMIN_REQUIRED = "LAST_ADMIN_REQUIRED"
   |

C901 `validate` is too complex (11 > 10)
  --> app/services/form_service/user_service.py:51:9
   |
49 |         return sanitize_form_data(payload or {})
50 |
51 |     def validate(self, data: dict[str, Any], *, resource: User | None) -> ServiceResult[dict[str, Any]]:
   |         ^^^^^^^^
52 |         """校验用户数据。.
   |

PLR0911 Too many return statements (8 > 6)
  --> app/services/form_service/user_service.py:51:9
   |
49 |         return sanitize_form_data(payload or {})
50 |
51 |     def validate(self, data: dict[str, Any], *, resource: User | None) -> ServiceResult[dict[str, Any]]:
   |         ^^^^^^^^
52 |         """校验用户数据。.
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/form_service/user_service.py:58:31
   |
56 |         Args:
57 |             data: 清理后的数据。
58 |             resource: 已存在的用户实例（编辑场景），创建时为 None。
   |                                       ^^
59 |
60 |         Returns:
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/form_service/user_service.py:58:36
   |
56 |         Args:
57 |             data: 清理后的数据。
58 |             resource: 已存在的用户实例（编辑场景），创建时为 None。
   |                                                 ^^
59 |
60 |         Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/form_service/user_service.py:58:37
   |
56 |         Args:
57 |             data: 清理后的数据。
58 |             resource: 已存在的用户实例（编辑场景），创建时为 None。
   |                                                   ^^
59 |
60 |         Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/form_service/user_service.py:61:17
   |
60 |         Returns:
61 |             校验结果，成功时返回规范化的数据，失败时返回错误信息。
   |                     ^^
62 |
63 |         """
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/form_service/user_service.py:61:29
   |
60 |         Returns:
61 |             校验结果，成功时返回规范化的数据，失败时返回错误信息。
   |                                             ^^
62 |
63 |         """
   |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/form_service/user_service.py:70:56
   |
69 |         if not self.USERNAME_PATTERN.match(normalized["username"]):
70 |             return ServiceResult.fail("用户名只能包含字母、数字和下划线，长度为3-20位")
   |                                                                        ^^
71 |
72 |         if normalized["role"] not in self.ALLOWED_ROLES:
   |

ARG002 Unused method argument: `resource`
   --> app/services/form_service/user_service.py:141:32
    |
139 |         )
140 |
141 |     def build_context(self, *, resource: User | None) -> dict[str, Any]:
    |                                ^^^^^^^^
142 |         """构建模板渲染上下文。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/form_service/user_service.py:145:27
    |
144 |         Args:
145 |             resource: 用户实例，创建时为 None。
    |                               ^^
146 |
147 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/form_service/user_service.py:166:31
    |
164 |         Args:
165 |             data: 原始数据。
166 |             resource: 已存在的用户实例，创建时为 None。
    |                                       ^^
167 |
168 |         Returns:
    |

ANN202 Missing return type annotation for private function `_user_query`
   --> app/services/form_service/user_service.py:199:9
    |
197 |         return data.get("role") == UserRole.ADMIN and bool(data.get("is_active", True))
198 |
199 |     def _user_query(self):
    |         ^^^^^^^^^^^
200 |         """暴露 user query，便于单测注入。."""
201 |         return User.query
    |
help: Add return type annotation

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/form_service/user_service.py:200:25
    |
199 |     def _user_query(self):
200 |         """暴露 user query，便于单测注入。."""
    |                           ^^
201 |         return User.query
    |

PLR0911 Too many return statements (7 > 6)
   --> app/services/form_service/user_service.py:203:9
    |
201 |         return User.query
202 |
203 |     def _coerce_bool(self, value: Any, *, default: bool) -> bool:
    |         ^^^^^^^^^^^^
204 |         """将值转换为布尔类型。.
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `value`
   --> app/services/form_service/user_service.py:203:35
    |
201 |         return User.query
202 |
203 |     def _coerce_bool(self, value: Any, *, default: bool) -> bool:
    |                                   ^^^
204 |         """将值转换为布尔类型。.
    |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/services/form_service/user_service.py:232:15
    |
230 |         """验证密码强度。.
231 |
232 |         密码必须满足：至少8位、包含大写字母、小写字母和数字。
    |                     ^^
233 |
234 |         Args:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/form_service/user_service.py:238:24
    |
237 |         Returns:
238 |             验证失败时返回错误信息，成功时返回 None。
    |                                   ^^
239 |
240 |         """
    |

PLR2004 Magic value used in comparison, consider replacing `8` with a constant variable
   --> app/services/form_service/user_service.py:241:28
    |
240 |         """
241 |         if len(password) < 8:
    |                            ^
242 |             return "密码长度至少8位"
243 |         if not any(char.isupper() for char in password):
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/services/instances/batch_service.py:1:12
  |
1 | """实例批量操作服务，集中处理创建/删除等事务。."""
  |                    ^^
2 |
3 | from __future__ import annotations
  |

A004 Import `SystemError` is shadowing a Python builtin
  --> app/services/instances/batch_service.py:12:24
   |
11 | from app import db
12 | from app.errors import SystemError, ValidationError
   |                        ^^^^^^^^^^^
13 | from app.models.account_change_log import AccountChangeLog
14 | from app.models.account_classification import AccountClassificationAssignment
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/instances/batch_service.py:36:21
   |
35 |     Returns:
36 |         包含所有删除计数器的字典，初始值均为 0。
   |                                 ^^
37 |
38 |     """
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/instances/batch_service.py:57:16
   |
55 |     """负责批量创建实例的服务。.
56 |
57 |     提供批量创建实例的功能，包括数据校验、重复检查和批量插入。
   |                           ^^
58 |     """
   |

C901 `create_instances` is too complex (11 > 10)
  --> app/services/instances/batch_service.py:60:9
   |
58 |     """
59 |
60 |     def create_instances(
   |         ^^^^^^^^^^^^^^^^
61 |         self,
62 |         instances_data: list[dict[str, Any]],
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/instances/batch_service.py:68:15
   |
66 |         """批量创建实例。.
67 |
68 |         校验实例数据，检查重复名称，批量插入数据库。
   |                     ^^
69 |
70 |         Args:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/instances/batch_service.py:68:22
   |
66 |         """批量创建实例。.
67 |
68 |         校验实例数据，检查重复名称，批量插入数据库。
   |                                   ^^
69 |
70 |         Args:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/instances/batch_service.py:71:35
   |
70 |         Args:
71 |             instances_data: 实例数据列表，每个元素包含实例的字段信息。
   |                                         ^^
72 |             operator_id: 操作者用户 ID，可选。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/instances/batch_service.py:72:34
   |
70 |         Args:
71 |             instances_data: 实例数据列表，每个元素包含实例的字段信息。
72 |             operator_id: 操作者用户 ID，可选。
   |                                       ^^
73 |
74 |         Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/instances/batch_service.py:75:22
   |
74 |         Returns:
75 |             包含创建结果的字典，格式如下：
   |                               ^^
76 |             {
77 |                 'created_count': 3,
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/services/instances/batch_service.py:75:27
   |
74 |         Returns:
75 |             包含创建结果的字典，格式如下：
   |                                         ^^
76 |             {
77 |                 'created_count': 3,
   |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/instances/batch_service.py:106:25
    |
104 |             errors.append(f"存在重复实例名称: {', '.join(duplicate_names)}")
105 |
106 |         # 查询数据库中已存在的实例名称，避免重复插入
    |                                       ^^
107 |         payload_names = [
108 |             item.get("name")
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/instances/batch_service.py:213:16
    |
211 |     """负责批量删除实例及其关联数据的服务。.
212 |
213 |     提供批量删除实例的功能，包括级联删除所有关联数据。
    |                           ^^
214 |     """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/instances/batch_service.py:224:24
    |
222 |         """批量删除实例及其关联数据。.
223 |
224 |         删除指定的实例及其所有关联数据，包括账户权限、同步记录、
    |                                       ^^
225 |         容量统计、标签关联等。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/instances/batch_service.py:229:34
    |
227 |         Args:
228 |             instance_ids: 实例 ID 列表。
229 |             operator_id: 操作者用户 ID，可选。
    |                                       ^^
230 |
231 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/instances/batch_service.py:232:22
    |
231 |         Returns:
232 |             包含删除统计的字典，格式如下：
    |                               ^^
233 |             {
234 |                 'deleted_count': 2,
    |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/services/instances/batch_service.py:232:27
    |
231 |         Returns:
232 |             包含删除统计的字典，格式如下：
    |                                         ^^
233 |             {
234 |                 'deleted_count': 2,
    |

TRY300 Consider moving this statement to an `else` block
   --> app/services/instances/batch_service.py:299:13
    |
297 |             stats["deleted_sync_data"] = stats["deleted_account_permissions"]
298 |
299 |             return stats
    |             ^^^^^^^^^^^^
300 |         except SQLAlchemyError as exc:
301 |             db.session.rollback()
    |

INP001 File `app/services/ledgers/database_ledger_service.py` is part of an implicit namespace package. Add an `__init__.py`.
--> app/services/ledgers/database_ledger_service.py:1:1

A004 Import `SystemError` is shadowing a Python builtin
  --> app/services/ledgers/database_ledger_service.py:16:39
   |
14 | from app import db
15 | from app.constants import SyncStatus
16 | from app.errors import NotFoundError, SystemError
   |                                       ^^^^^^^^^^^
17 | from app.models.database_size_stat import DatabaseSizeStat
18 | from app.models.instance import Instance
   |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `session`
  --> app/services/ledgers/database_ledger_service.py:35:36
   |
33 |     MAX_TREND_DAYS = 90
34 |
35 |     def __init__(self, *, session: Any | None = None) -> None:
   |                                    ^^^^^^^^^^
36 |         """初始化服务。.
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/ledgers/database_ledger_service.py:39:39
   |
38 |         Args:
39 |             session: 可选的 SQLAlchemy 会话，默认使用全局 db.session。
   |                                            ^^
40 |
41 |         """
   |

D417 Missing argument description in the docstring for `get_ledger`: `tags`
  --> app/services/ledgers/database_ledger_service.py:44:9
   |
42 |         self.session = session or db.session
43 |
44 |     def get_ledger(
   |         ^^^^^^^^^^
45 |         self,
46 |         *,
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/ledgers/database_ledger_service.py:56:24
   |
55 |         Args:
56 |             search: 关键字，支持数据库名称、实例名称、主机模糊匹配。
   |                           ^^
57 |             db_type: 数据库类型，传入 all/空表示不过滤。
58 |             page: 页码，起始为 1。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/ledgers/database_ledger_service.py:57:27
   |
55 |         Args:
56 |             search: 关键字，支持数据库名称、实例名称、主机模糊匹配。
57 |             db_type: 数据库类型，传入 all/空表示不过滤。
   |                                ^^
58 |             page: 页码，起始为 1。
59 |             per_page: 每页数量，默认 `DEFAULT_PAGINATION`。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/ledgers/database_ledger_service.py:58:21
   |
56 |             search: 关键字，支持数据库名称、实例名称、主机模糊匹配。
57 |             db_type: 数据库类型，传入 all/空表示不过滤。
58 |             page: 页码，起始为 1。
   |                       ^^
59 |             per_page: 每页数量，默认 `DEFAULT_PAGINATION`。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/ledgers/database_ledger_service.py:59:27
   |
57 |             db_type: 数据库类型，传入 all/空表示不过滤。
58 |             page: 页码，起始为 1。
59 |             per_page: 每页数量，默认 `DEFAULT_PAGINATION`。
   |                               ^^
60 |
61 |         Returns:
   |

TRY300 Consider moving this statement to an `else` block
   --> app/services/ledgers/database_ledger_service.py:96:13
    |
 94 |               ]
 95 |
 96 | /             return {
 97 | |                 "items": rows,
 98 | |                 "total": total,
 99 | |                 "page": page,
100 | |                 "per_page": per_page,
101 | |             }
    | |_____________^
102 |           except Exception as exc:
103 |               log_error(
    |

D417 Missing argument description in the docstring for `iterate_all`: `tags`
   --> app/services/ledgers/database_ledger_service.py:112:9
    |
110 |             raise SystemError(msg) from exc
111 |
112 |     def iterate_all(
    |         ^^^^^^^^^^^
113 |         self,
114 |         *,
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/services/ledgers/database_ledger_service.py:119:20
    |
117 |         tags: list[str] | None = None,
118 |     ) -> Iterable[dict[str, Any]]:
119 |         """遍历所有台账记录（用于导出）。.
    |                            ^^
120 |
121 |         Args:
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/services/ledgers/database_ledger_service.py:119:25
    |
117 |         tags: list[str] | None = None,
118 |     ) -> Iterable[dict[str, Any]]:
119 |         """遍历所有台账记录（用于导出）。.
    |                                      ^^
120 |
121 |         Args:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/ledgers/database_ledger_service.py:162:23
    |
160 |         Args:
161 |             database_id: InstanceDatabase 主键。
162 |             days: 查询天数，默认 30 天，最大 90 天。
    |                           ^^
163 |
164 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/ledgers/database_ledger_service.py:162:31
    |
160 |         Args:
161 |             database_id: InstanceDatabase 主键。
162 |             days: 查询天数，默认 30 天，最大 90 天。
    |                                       ^^
163 |
164 |         Returns:
    |

ANN202 Missing return type annotation for private function `_base_query`
   --> app/services/ledgers/database_ledger_service.py:217:9
    |
215 |         }
216 |
217 |     def _base_query(self):
    |         ^^^^^^^^^^^
218 |         """构造基础查询。."""
219 |         return (
    |
help: Add return type annotation

ANN202 Missing return type annotation for private function `_apply_filters`
   --> app/services/ledgers/database_ledger_service.py:229:9
    |
227 |         )
228 |
229 |     def _apply_filters(
    |         ^^^^^^^^^^^^^^
230 |         self,
231 |         query,
    |
help: Add return type annotation

ANN001 Missing type annotation for function argument `query`
   --> app/services/ledgers/database_ledger_service.py:231:9
    |
229 |     def _apply_filters(
230 |         self,
231 |         query,
    |         ^^^^^
232 |         *,
233 |         search: str = "",
    |

ANN202 Missing return type annotation for private function `_with_latest_stats`
   --> app/services/ledgers/database_ledger_service.py:263:9
    |
261 |         return query
262 |
263 |     def _with_latest_stats(self, query):
    |         ^^^^^^^^^^^^^^^^^^
264 |         """为查询附加最新容量信息。."""
265 |         latest_stats = (
    |
help: Add return type annotation

ANN001 Missing type annotation for function argument `query`
   --> app/services/ledgers/database_ledger_service.py:263:34
    |
261 |         return query
262 |
263 |     def _with_latest_stats(self, query):
    |                                  ^^^^^
264 |         """为查询附加最新容量信息。."""
265 |         latest_stats = (
    |

ANN001 Missing type annotation for function argument `collected_at`
   --> app/services/ledgers/database_ledger_service.py:303:9
    |
301 |         record: InstanceDatabase,
302 |         instance: Instance,
303 |         collected_at,
    |         ^^^^^^^^^^^^
304 |         size_mb,
305 |         tags: list[dict[str, Any]] | None = None,
    |

ANN001 Missing type annotation for function argument `size_mb`
   --> app/services/ledgers/database_ledger_service.py:304:9
    |
302 |         instance: Instance,
303 |         collected_at,
304 |         size_mb,
    |         ^^^^^^^
305 |         tags: list[dict[str, Any]] | None = None,
306 |     ) -> dict[str, Any]:
    |

ANN001 Missing type annotation for function argument `collected_at`
   --> app/services/ledgers/database_ledger_service.py:365:36
    |
363 |         return mapping
364 |
365 |     def _resolve_sync_status(self, collected_at) -> dict[str, str]:
    |                                    ^^^^^^^^^^^^
366 |         """根据采集时间生成同步状态。."""
367 |         if not collected_at:
    |

PLR2004 Magic value used in comparison, consider replacing `6` with a constant variable
   --> app/services/ledgers/database_ledger_service.py:373:27
    |
371 |         delay_hours = (now - collected_at).total_seconds() / 3600
372 |
373 |         if delay_hours <= 6:
    |                           ^
374 |             return {"value": SyncStatus.COMPLETED, "label": "已更新", "variant": "success"}
375 |         if delay_hours <= 48:
    |

PLR2004 Magic value used in comparison, consider replacing `48` with a constant variable
   --> app/services/ledgers/database_ledger_service.py:375:27
    |
373 |         if delay_hours <= 6:
374 |             return {"value": SyncStatus.COMPLETED, "label": "已更新", "variant": "success"}
375 |         if delay_hours <= 48:
    |                           ^^
376 |             return {"value": SyncStatus.RUNNING, "label": "待刷新", "variant": "warning"}
377 |         return {"value": SyncStatus.FAILED, "label": "超时", "variant": "danger"}
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/services/ledgers/database_ledger_service.py:380:15
    |
379 |     def _format_size(self, size_mb: int | None) -> str:
380 |         """将大小（MB）格式化为易读文本。."""
    |                  ^^
381 |         if size_mb is None:
382 |             return "未采集"
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/services/ledgers/database_ledger_service.py:380:18
    |
379 |     def _format_size(self, size_mb: int | None) -> str:
380 |         """将大小（MB）格式化为易读文本。."""
    |                      ^^
381 |         if size_mb is None:
382 |             return "未采集"
    |

PLR2004 Magic value used in comparison, consider replacing `1024` with a constant variable
   --> app/services/ledgers/database_ledger_service.py:383:23
    |
381 |         if size_mb is None:
382 |             return "未采集"
383 |         if size_mb >= 1024:
    |                       ^^^^
384 |             size_gb = size_mb / 1024
385 |             return f"{size_gb:.2f} GB"
    |

D205 1 blank line required between summary line and description
 --> app/services/partition_management_service.py:1:1
  |
1 | / """分区管理服务
2 | | 负责创建、清理与查询数据库容量相关表的分区信息.
3 | | """
  | |___^
4 |
5 |   from __future__ import annotations
  |
help: Insert single blank line

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/partition_management_service.py:23:17
   |
21 | @dataclass(slots=True)
22 | class PartitionAction:
23 |     """记录分区操作的结果，便于结构化日志与返回值."""
   |                          ^^
24 |
25 |     table: str
   |

D107 Missing docstring in `__init__`
  --> app/services/partition_management_service.py:45:9
   |
43 |     """PostgreSQL 分区管理服务."""
44 |
45 |     def __init__(self) -> None:
   |         ^^^^^^^^
46 |         self.tables: dict[str, dict[str, str]] = {
47 |             "stats": {
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/partition_management_service.py:83:15
   |
81 |         """创建指定日期所在月份的分区。.
82 |
83 |         为四张相关表（database_size_stats、database_size_aggregations、
   |                     ^^
84 |         instance_size_stats、instance_size_aggregations）创建月度分区。
85 |         如果分区已存在则跳过，如果创建失败则回滚所有操作。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/partition_management_service.py:84:55
   |
83 |         为四张相关表（database_size_stats、database_size_aggregations、
84 |         instance_size_stats、instance_size_aggregations）创建月度分区。
   |                                                        ^^
85 |         如果分区已存在则跳过，如果创建失败则回滚所有操作。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/partition_management_service.py:85:19
   |
83 |         为四张相关表（database_size_stats、database_size_aggregations、
84 |         instance_size_stats、instance_size_aggregations）创建月度分区。
85 |         如果分区已存在则跳过，如果创建失败则回滚所有操作。
   |                             ^^
86 |
87 |         Args:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/partition_management_service.py:88:33
   |
87 |         Args:
88 |             partition_date: 分区日期，将创建该日期所在月份的分区。
   |                                     ^^
89 |                 例如传入 2025-11-15，将创建 2025-11 月份的分区。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/partition_management_service.py:89:32
   |
87 |         Args:
88 |             partition_date: 分区日期，将创建该日期所在月份的分区。
89 |                 例如传入 2025-11-15，将创建 2025-11 月份的分区。
   |                                    ^^
90 |
91 |         Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/partition_management_service.py:92:24
   |
91 |         Returns:
92 |             包含分区创建结果的字典，格式如下：
   |                                   ^^
93 |             {
94 |                 'partition_window': {
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/services/partition_management_service.py:92:29
   |
91 |         Returns:
92 |             包含分区创建结果的字典，格式如下：
   |                                             ^^
93 |             {
94 |                 'partition_window': {
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/partition_management_service.py:111:45
    |
110 |         Raises:
111 |             DatabaseError: 当分区创建失败或提交事务失败时抛出，
    |                                                              ^^
112 |                 包含失败的分区信息和错误详情。
    |

PLC0415 `import` should be at the top-level of a file
   --> app/services/partition_management_service.py:120:13
    |
119 |         for table_key, table_config in self.tables.items():
120 |             from app.utils.time_utils import time_utils
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
121 |             partition_name = f"{table_config['partition_prefix']}{time_utils.format_china_time(month_start, '%Y_%m')}"
122 |             if self._partition_exists(partition_name):
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/partition_management_service.py:133:27
    |
131 |                 )
132 |                 log_info(
133 |                     "分区已存在，跳过创建",
    |                                ^^
134 |                     module=MODULE,
135 |                     partition_name=partition_name,
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/services/partition_management_service.py:183:20
    |
181 |                     exception=exc,
182 |                 )
183 |             except Exception as exc:  # pragma: no cover - 防御性分支
    |                    ^^^^^^^^^
184 |                 failures.append(
185 |                     {
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/partition_management_service.py:239:16
    |
237 |         """批量创建未来几个月的分区。.
238 |
239 |         从当前月份开始，创建未来指定月数的分区。如果某个月份的分区创建失败，
    |                       ^^
240 |         会继续尝试创建其他月份，最后收集所有错误并抛出异常。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/partition_management_service.py:239:42
    |
237 |         """批量创建未来几个月的分区。.
238 |
239 |         从当前月份开始，创建未来指定月数的分区。如果某个月份的分区创建失败，
    |                                                                           ^^
240 |         会继续尝试创建其他月份，最后收集所有错误并抛出异常。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/partition_management_service.py:240:20
    |
239 |         从当前月份开始，创建未来指定月数的分区。如果某个月份的分区创建失败，
240 |         会继续尝试创建其他月份，最后收集所有错误并抛出异常。
    |                               ^^
241 |
242 |         Args:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/partition_management_service.py:243:37
    |
242 |         Args:
243 |             months_ahead: 要创建的未来月份数量，默认为 3 个月。
    |                                               ^^
244 |
245 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/partition_management_service.py:246:22
    |
245 |         Returns:
246 |             包含创建结果的字典，格式如下：
    |                               ^^
247 |             {
248 |                 'months_processed': 3,
    |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/services/partition_management_service.py:246:27
    |
245 |         Returns:
246 |             包含创建结果的字典，格式如下：
    |                                         ^^
247 |             {
248 |                 'months_processed': 3,
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/partition_management_service.py:259:43
    |
258 |         Raises:
259 |             DatabaseError: 当任一月份的分区创建失败时抛出，
    |                                                          ^^
260 |                 包含所有失败的月份信息和已成功创建的月份列表。
    |

DTZ011 `datetime.date.today()` used
   --> app/services/partition_management_service.py:265:17
    |
263 |         created: list[dict[str, Any]] = []
264 |         issues: list[dict[str, Any]] = []
265 |         today = date.today()
    |                 ^^^^^^^^^^^^
266 |
267 |         for offset in range(months_ahead):
    |
help: Use `datetime.datetime.now(tz=...).date()` instead

BLE001 Do not catch blind exception: `Exception`
   --> app/services/partition_management_service.py:281:20
    |
279 |                     issues=exc.extra,
280 |                 )
281 |             except Exception as exc:
    |                    ^^^^^^^^^
282 |                 issues.append({"month": target_month.isoformat(), "message": str(exc)})
283 |                 log_error(
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/partition_management_service.py:305:19
    |
304 |         删除所有早于保留期的分区表。保留期从当前日期往前推算指定月数。
305 |         如果任何分区删除失败，会回滚所有操作并抛出异常。
    |                             ^^
306 |
307 |         Args:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/partition_management_service.py:308:35
    |
307 |         Args:
308 |             retention_months: 保留月数，默认为 12 个月。
    |                                       ^^
309 |                 例如设置为 12，则保留最近 12 个月的分区，删除更早的分区。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/partition_management_service.py:309:25
    |
307 |         Args:
308 |             retention_months: 保留月数，默认为 12 个月。
309 |                 例如设置为 12，则保留最近 12 个月的分区，删除更早的分区。
    |                              ^^
310 |
311 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/partition_management_service.py:309:40
    |
307 |         Args:
308 |             retention_months: 保留月数，默认为 12 个月。
309 |                 例如设置为 12，则保留最近 12 个月的分区，删除更早的分区。
    |                                                        ^^
310 |
311 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/partition_management_service.py:312:22
    |
311 |         Returns:
312 |             包含清理结果的字典，格式如下：
    |                               ^^
313 |             {
314 |                 'cutoff_date': '2024-11-01',
    |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/services/partition_management_service.py:312:27
    |
311 |         Returns:
312 |             包含清理结果的字典，格式如下：
    |                                         ^^
313 |             {
314 |                 'cutoff_date': '2024-11-01',
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/partition_management_service.py:328:45
    |
327 |         Raises:
328 |             DatabaseError: 当分区删除失败或提交事务失败时抛出，
    |                                                              ^^
329 |                 包含失败的分区信息和已删除的分区列表。
    |

DTZ011 `datetime.date.today()` used
   --> app/services/partition_management_service.py:332:24
    |
331 |         """
332 |         cutoff_date = (date.today() - timedelta(days=retention_months * 31)).replace(day=1)
    |                        ^^^^^^^^^^^^
333 |         dropped: list[PartitionAction] = []
334 |         failures: list[dict[str, Any]] = []
    |
help: Use `datetime.datetime.now(tz=...).date()` instead

BLE001 Do not catch blind exception: `Exception`
   --> app/services/partition_management_service.py:372:24
    |
370 |                         exception=exc,
371 |                     )
372 |                 except Exception as exc:  # pragma: no cover - 防御性分支
    |                        ^^^^^^^^^
373 |                     failures.append(
374 |                         {
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/partition_management_service.py:426:31
    |
424 |         Returns:
425 |             包含月份开始和结束日期的元组 (month_start, month_end)。
426 |             month_start 为该月第一天，month_end 为下月第一天。
    |                                     ^^
427 |
428 |         Example:
    |

PLR2004 Magic value used in comparison, consider replacing `12` with a constant variable
   --> app/services/partition_management_service.py:434:33
    |
432 |         """
433 |         month_start = target_date.replace(day=1)
434 |         if month_start.month == 12:
    |                                 ^^
435 |             month_end = month_start.replace(year=month_start.year + 1, month=1)
436 |         else:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/partition_management_service.py:444:28
    |
443 |         Args:
444 |             table_key: 表的键名，如 'stats'、'aggregations'。
    |                                ^^
445 |             table_config: 表配置字典，包含 table_name、partition_prefix 等信息。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/partition_management_service.py:445:32
    |
443 |         Args:
444 |             table_key: 表的键名，如 'stats'、'aggregations'。
445 |             table_config: 表配置字典，包含 table_name、partition_prefix 等信息。
    |                                     ^^
446 |
447 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/partition_management_service.py:448:19
    |
447 |         Returns:
448 |             分区信息列表，每个元素包含分区名称、大小、记录数、日期、状态等信息。
    |                         ^^
449 |
450 |         Raises:
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/services/partition_management_service.py:496:20
    |
494 |                     },
495 |                 )
496 |             except Exception as exc:  # pragma: no cover - 单条记录失败不影响总体
    |                    ^^^^^^^^^
497 |                 log_warning(
498 |                     "处理单个分区信息失败",
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/partition_management_service.py:521:26
    |
520 |         Returns:
521 |             如果分区存在返回 True，否则返回 False。
    |                                  ^^
522 |
523 |         Raises:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/partition_management_service.py:544:30
    |
543 |         Args:
544 |             cutoff_date: 截止日期，早于此日期的分区将被清理。
    |                                  ^^
545 |             table_config: 表配置字典，包含 table_name、partition_prefix 等信息。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/partition_management_service.py:545:32
    |
543 |         Args:
544 |             cutoff_date: 截止日期，早于此日期的分区将被清理。
545 |             table_config: 表配置字典，包含 table_name、partition_prefix 等信息。
    |                                     ^^
546 |
547 |         Returns:
    |

DTZ007 Naive datetime constructed using `datetime.datetime.strptime()` without %z
   --> app/services/partition_management_service.py:580:34
    |
578 |                 continue
579 |             try:
580 |                 partition_date = datetime.strptime(date_str, "%Y/%m/%d").date()
    |                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
581 |             except ValueError:
582 |                 continue
    |
help: Call `.replace(tzinfo=<timezone>)` or `.astimezone()` to convert to an aware datetime

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/partition_management_service.py:591:34
    |
590 |         Args:
591 |             partition_name: 分区表名称，如 'database_size_stats_2025_11'。
    |                                       ^^
592 |             prefix: 分区前缀，如 'database_size_stats_'。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/partition_management_service.py:592:25
    |
590 |         Args:
591 |             partition_name: 分区表名称，如 'database_size_stats_2025_11'。
592 |             prefix: 分区前缀，如 'database_size_stats_'。
    |                             ^^
593 |
594 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/partition_management_service.py:595:18
    |
594 |         Returns:
595 |             日期字符串，格式为 'YYYY/MM/DD'，如 '2025/11/01'。
    |                       ^^
596 |             如果解析失败返回 None。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/partition_management_service.py:595:35
    |
594 |         Returns:
595 |             日期字符串，格式为 'YYYY/MM/DD'，如 '2025/11/01'。
    |                                            ^^
596 |             如果解析失败返回 None。
    |

TRY300 Consider moving this statement to an `else` block
   --> app/services/partition_management_service.py:602:13
    |
600 |             date_part = partition_name.replace(prefix, "")
601 |             year, month, *_ = date_part.split("_")
602 |             return f"{year}/{month}/01"
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
603 |         except ValueError:
604 |             return None
    |

S608 Possible SQL injection vector through string-based query construction
   --> app/services/partition_management_service.py:616:17
    |
615 |         """
616 |         query = f"SELECT COUNT(*) FROM {partition_name};"
    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
617 |         try:
618 |             result = db.session.execute(text(query)).scalar()
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/partition_management_service.py:633:28
    |
632 |         Args:
633 |             date_str: 日期字符串，格式为 'YYYY/MM/DD'。
    |                                 ^^
634 |
635 |         Returns:
    |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/services/partition_management_service.py:636:17
    |
635 |         Returns:
636 |             分区状态：'current'（当前月）、'past'（过去月）、
    |                     ^^
637 |             'future'（未来月）或 'unknown'（无法解析）。
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/services/partition_management_service.py:636:27
    |
635 |         Returns:
636 |             分区状态：'current'（当前月）、'past'（过去月）、
    |                                ^^
637 |             'future'（未来月）或 'unknown'（无法解析）。
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/services/partition_management_service.py:636:31
    |
635 |         Returns:
636 |             分区状态：'current'（当前月）、'past'（过去月）、
    |                                        ^^
637 |             'future'（未来月）或 'unknown'（无法解析）。
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/services/partition_management_service.py:636:39
    |
635 |         Returns:
636 |             分区状态：'current'（当前月）、'past'（过去月）、
    |                                                  ^^
637 |             'future'（未来月）或 'unknown'（无法解析）。
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/services/partition_management_service.py:636:43
    |
635 |         Returns:
636 |             分区状态：'current'（当前月）、'past'（过去月）、
    |                                                          ^^
637 |             'future'（未来月）或 'unknown'（无法解析）。
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/services/partition_management_service.py:637:21
    |
635 |         Returns:
636 |             分区状态：'current'（当前月）、'past'（过去月）、
637 |             'future'（未来月）或 'unknown'（无法解析）。
    |                     ^^
638 |
639 |         """
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/services/partition_management_service.py:637:25
    |
635 |         Returns:
636 |             分区状态：'current'（当前月）、'past'（过去月）、
637 |             'future'（未来月）或 'unknown'（无法解析）。
    |                             ^^
638 |
639 |         """
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/services/partition_management_service.py:637:37
    |
635 |         Returns:
636 |             分区状态：'current'（当前月）、'past'（过去月）、
637 |             'future'（未来月）或 'unknown'（无法解析）。
    |                                           ^^
638 |
639 |         """
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/services/partition_management_service.py:637:42
    |
635 |         Returns:
636 |             分区状态：'current'（当前月）、'past'（过去月）、
637 |             'future'（未来月）或 'unknown'（无法解析）。
    |                                                     ^^
638 |
639 |         """
    |

DTZ007 Naive datetime constructed using `datetime.datetime.strptime()` without %z
   --> app/services/partition_management_service.py:643:30
    |
641 |             return "unknown"
642 |         try:
643 |             partition_date = datetime.strptime(date_str, "%Y/%m/%d").date()
    |                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
644 |         except ValueError:
645 |             return "unknown"
    |
help: Call `.replace(tzinfo=<timezone>)` or `.astimezone()` to convert to an aware datetime

DTZ011 `datetime.date.today()` used
   --> app/services/partition_management_service.py:647:17
    |
645 |             return "unknown"
646 |
647 |         today = date.today()
    |                 ^^^^^^^^^^^^
648 |         current_month = today.replace(day=1)
    |
help: Use `datetime.datetime.now(tz=...).date()` instead

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/partition_management_service.py:659:23
    |
657 |         """为分区表创建必要的索引。.
658 |
659 |         根据表类型创建不同的索引组合，以优化查询性能。
    |                                     ^^
660 |
661 |         Args:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/partition_management_service.py:663:32
    |
661 |         Args:
662 |             partition_name: 分区表名称。
663 |             table_config: 表配置字典，包含 table_name 等信息。
    |                                     ^^
664 |
665 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/partition_management_service.py:719:23
    |
718 |         Returns:
719 |             格式化后的大小字符串，如 '1.5 GB'、'256 MB'。
    |                                 ^^
720 |
721 |         """
    |

PLR2004 Magic value used in comparison, consider replacing `1024` with a constant variable
   --> app/services/partition_management_service.py:722:25
    |
721 |         """
722 |         if size_bytes < 1024:
    |                         ^^^^
723 |             return f"{size_bytes} B"
724 |         if size_bytes < 1024**2:
    |

ANN205 Missing return type annotation for staticmethod `_rollback_on_error`
   --> app/services/partition_management_service.py:731:9
    |
730 |     @staticmethod
731 |     def _rollback_on_error():
    |         ^^^^^^^^^^^^^^^^^^
732 |         """提供一个上下文管理器用于异常时自动回滚事务。.
    |
help: Add return type annotation

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/partition_management_service.py:735:21
    |
734 |         Returns:
735 |             上下文管理器对象，在退出时自动执行 db.session.rollback()。
    |                             ^^
736 |
737 |         Example:
    |

ANN204 Missing return type annotation for special method `__enter__`
   --> app/services/partition_management_service.py:743:17
    |
741 |         """
742 |         class _RollbackContext:
743 |             def __enter__(self):
    |                 ^^^^^^^^^
744 |                 return self
    |
help: Add return type annotation

ANN204 Missing return type annotation for special method `__exit__`
   --> app/services/partition_management_service.py:746:17
    |
744 |                 return self
745 |
746 |             def __exit__(self, exc_type, exc, tb):
    |                 ^^^^^^^^
747 |                 db.session.rollback()
748 |                 return False
    |
help: Add return type annotation

ANN001 Missing type annotation for function argument `exc_type`
   --> app/services/partition_management_service.py:746:32
    |
744 |                 return self
745 |
746 |             def __exit__(self, exc_type, exc, tb):
    |                                ^^^^^^^^
747 |                 db.session.rollback()
748 |                 return False
    |

ANN001 Missing type annotation for function argument `exc`
   --> app/services/partition_management_service.py:746:42
    |
744 |                 return self
745 |
746 |             def __exit__(self, exc_type, exc, tb):
    |                                          ^^^
747 |                 db.session.rollback()
748 |                 return False
    |

ANN001 Missing type annotation for function argument `tb`
   --> app/services/partition_management_service.py:746:47
    |
744 |                 return self
745 |
746 |             def __exit__(self, exc_type, exc, tb):
    |                                               ^^
747 |                 db.session.rollback()
748 |                 return False
    |

INP001 File `app/services/statistics/account_statistics_service.py` is part of an implicit namespace package. Add an `__init__.py`.
--> app/services/statistics/account_statistics_service.py:1:1

A004 Import `SystemError` is shadowing a Python builtin
  --> app/services/statistics/account_statistics_service.py:14:24
   |
12 | from app import db
13 | from app.constants import DatabaseType
14 | from app.errors import SystemError
   |                        ^^^^^^^^^^^
15 | from app.models.account_classification import (
16 |     AccountClassification,
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/statistics/account_statistics_service.py:37:23
   |
36 |     Returns:
37 |         如果账户被锁定返回 True，否则返回 False。
   |                                ^^
38 |
39 |     """
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/statistics/account_statistics_service.py:56:28
   |
54 |     """获取账户汇总统计信息。.
55 |
56 |     统计账户总数、活跃数、锁定数、正常数、已删除数，以及关联的实例统计。
   |                                                   ^^
57 |     可选择性地只统计指定实例或数据库类型的账户。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/statistics/account_statistics_service.py:61:28
   |
59 |     Args:
60 |         instance_id: 可选的实例 ID 筛选。
61 |         db_type: 可选的数据库类型筛选，如 'mysql'、'postgresql'。
   |                                      ^^
62 |
63 |     Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/statistics/account_statistics_service.py:64:23
   |
63 |     Returns:
64 |         包含账户和实例统计信息的字典，格式如下：
   |                                     ^^
65 |         {
66 |             'total_accounts': 100,       # 账户总数
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/services/statistics/account_statistics_service.py:64:28
   |
63 |     Returns:
64 |         包含账户和实例统计信息的字典，格式如下：
   |                                               ^^
65 |         {
66 |             'total_accounts': 100,       # 账户总数
   |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/statistics/account_statistics_service.py:106:28
    |
104 |                 if _is_account_locked(account, account.db_type):
105 |                     locked_accounts += 1
106 |             # 非活跃账户视为已删除/停用，计入 total 但不计入 active
    |                                        ^^
107 |
108 |         deleted_accounts = total_accounts - active_accounts
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/statistics/account_statistics_service.py:153:20
    |
152 |     Returns:
153 |         以数据库类型为键的字典，每个值包含该类型的账户统计，格式如下：
    |                               ^^
154 |         {
155 |             'mysql': {
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/statistics/account_statistics_service.py:153:34
    |
152 |     Returns:
153 |         以数据库类型为键的字典，每个值包含该类型的账户统计，格式如下：
    |                                                           ^^
154 |         {
155 |             'mysql': {
    |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/services/statistics/account_statistics_service.py:153:39
    |
152 |     Returns:
153 |         以数据库类型为键的字典，每个值包含该类型的账户统计，格式如下：
    |                                                                     ^^
154 |         {
155 |             'mysql': {
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/statistics/account_statistics_service.py:211:19
    |
210 |     Returns:
211 |         以分类名称为键的字典，每个值包含该分类的统计信息，格式如下：
    |                             ^^
212 |         {
213 |             'admin': {
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/statistics/account_statistics_service.py:211:33
    |
210 |     Returns:
211 |         以分类名称为键的字典，每个值包含该分类的统计信息，格式如下：
    |                                                         ^^
212 |         {
213 |             'admin': {
    |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/services/statistics/account_statistics_service.py:211:38
    |
210 |     Returns:
211 |         以分类名称为键的字典，每个值包含该分类的统计信息，格式如下：
    |                                                                   ^^
212 |         {
213 |             'admin': {
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/statistics/account_statistics_service.py:246:20
    |
245 |     Returns:
246 |         包含分类账户概览的字典，格式如下：
    |                               ^^
247 |         {
248 |             'total': 100,              # 已分类账户总数
    |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/services/statistics/account_statistics_service.py:246:25
    |
245 |     Returns:
246 |         包含分类账户概览的字典，格式如下：
    |                                         ^^
247 |         {
248 |             'total': 100,              # 已分类账户总数
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/statistics/account_statistics_service.py:276:30
    |
275 |     Args:
276 |         rule_ids: 可选的规则 ID 列表，如果提供则只统计这些规则。
    |                                     ^^
277 |
278 |     Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/statistics/account_statistics_service.py:279:28
    |
278 |     Returns:
279 |         以规则 ID 为键、账户数量为值的字典，格式如下：
    |                                           ^^
280 |         {
281 |             1: 50,   # 规则 1 关联 50 个账户
    |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/services/statistics/account_statistics_service.py:279:33
    |
278 |     Returns:
279 |         以规则 ID 为键、账户数量为值的字典，格式如下：
    |                                                     ^^
280 |         {
281 |             1: 50,   # 规则 1 关联 50 个账户
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/statistics/account_statistics_service.py:328:20
    |
327 |     Returns:
328 |         包含完整统计信息的字典，包含 fetch_summary、fetch_db_type_stats
    |                               ^^
329 |         和 fetch_classification_stats 的所有字段。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/statistics/account_statistics_service.py:351:25
    |
350 |     Returns:
351 |         所有统计值为 0 或空字典的字典，格式与 build_aggregated_statistics 返回值相同。
    |                                      ^^
352 |
353 |     """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/statistics/account_statistics_service.py:374:22
    |
372 |     """查询账户分类统计行。.
373 |
374 |     查询所有活跃分类及其关联的账户数量，按优先级降序排列。
    |                                       ^^
375 |
376 |     Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/statistics/account_statistics_service.py:377:16
    |
376 |     Returns:
377 |         分类统计行列表，每行包含分类名称、颜色、显示名称、优先级和账户数量。
    |                       ^^
378 |
379 |     Raises:
    |

INP001 File `app/services/statistics/database_statistics_service.py` is part of an implicit namespace package. Add an `__init__.py`.
--> app/services/statistics/database_statistics_service.py:1:1

A004 Import `SystemError` is shadowing a Python builtin
  --> app/services/statistics/database_statistics_service.py:13:24
   |
12 | from app import db
13 | from app.errors import SystemError
   |                        ^^^^^^^^^^^
14 | from app.models.database_size_aggregation import DatabaseSizeAggregation
15 | from app.models.instance import Instance
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/statistics/database_statistics_service.py:30:30
   |
29 |     Args:
30 |         instance_id: 可选的实例 ID，如果提供则仅统计该实例下的数据库。
   |                                   ^^
31 |
32 |     Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/statistics/database_statistics_service.py:33:21
   |
32 |     Returns:
33 |         包含数据库统计信息的字典，格式如下：
   |                                 ^^
34 |         {
35 |             'total_databases': 100,      # 数据库总数
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/services/statistics/database_statistics_service.py:33:26
   |
32 |     Returns:
33 |         包含数据库统计信息的字典，格式如下：
   |                                           ^^
34 |         {
35 |             'total_databases': 100,      # 数据库总数
   |

TRY300 Consider moving this statement to an `else` block
  --> app/services/statistics/database_statistics_service.py:67:9
   |
65 |           deleted_databases = deleted_databases.scalar() or 0
66 |
67 | /         return {
68 | |             "total_databases": total_databases,
69 | |             "active_databases": active_databases,
70 | |             "inactive_databases": inactive_databases,
71 | |             "deleted_databases": deleted_databases,
72 | |         }
   | |_________^
73 |       except Exception as exc:
74 |           log_error("获取数据库统计失败", module="database_statistics", exception=exc)
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/statistics/database_statistics_service.py:83:21
   |
82 |     Returns:
83 |         所有统计值为 0 的字典，格式与 fetch_summary 返回值相同。
   |                              ^^
84 |
85 |     """
   |

C901 `fetch_aggregations` is too complex (12 > 10)
  --> app/services/statistics/database_statistics_service.py:94:5
   |
94 | def fetch_aggregations(
   |     ^^^^^^^^^^^^^^^^^^
95 |     *,
96 |     instance_id: int | None,
   |

PLR0913 Too many arguments in function definition (11 > 5)
  --> app/services/statistics/database_statistics_service.py:94:5
   |
94 | def fetch_aggregations(
   |     ^^^^^^^^^^^^^^^^^^
95 |     *,
96 |     instance_id: int | None,
   |

PLR0912 Too many branches (13 > 12)
  --> app/services/statistics/database_statistics_service.py:94:5
   |
94 | def fetch_aggregations(
   |     ^^^^^^^^^^^^^^^^^^
95 |     *,
96 |     instance_id: int | None,
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/statistics/database_statistics_service.py:110:37
    |
108 |     """获取数据库容量聚合数据。.
109 |
110 |     支持多种筛选条件和分页查询。当 get_all 为 True 时，返回 Top 100 数据库的所有聚合记录。
    |                                                      ^^
111 |
112 |     Args:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/statistics/database_statistics_service.py:114:28
    |
112 |     Args:
113 |         instance_id: 可选的实例 ID 筛选。
114 |         db_type: 可选的数据库类型筛选，如 'mysql'、'postgresql'。
    |                                      ^^
115 |         database_name: 可选的数据库名称筛选。
116 |         database_id: 可选的数据库 ID 筛选，会自动解析为 database_name。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/statistics/database_statistics_service.py:116:34
    |
114 |         db_type: 可选的数据库类型筛选，如 'mysql'、'postgresql'。
115 |         database_name: 可选的数据库名称筛选。
116 |         database_id: 可选的数据库 ID 筛选，会自动解析为 database_name。
    |                                          ^^
117 |         period_type: 可选的统计周期类型筛选，如 'daily'、'weekly'、'monthly'。
118 |         start_date: 可选的开始日期筛选。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/statistics/database_statistics_service.py:117:33
    |
115 |         database_name: 可选的数据库名称筛选。
116 |         database_id: 可选的数据库 ID 筛选，会自动解析为 database_name。
117 |         period_type: 可选的统计周期类型筛选，如 'daily'、'weekly'、'monthly'。
    |                                            ^^
118 |         start_date: 可选的开始日期筛选。
119 |         end_date: 可选的结束日期筛选。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/statistics/database_statistics_service.py:120:19
    |
118 |         start_date: 可选的开始日期筛选。
119 |         end_date: 可选的结束日期筛选。
120 |         page: 当前页码，从 1 开始。
    |                       ^^
121 |         per_page: 每页记录数。
122 |         offset: 查询偏移量。
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/services/statistics/database_statistics_service.py:123:26
    |
121 |         per_page: 每页记录数。
122 |         offset: 查询偏移量。
123 |         get_all: 是否获取所有数据（Top 100 数据库）。
    |                                  ^^
124 |
125 |     Returns:
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/services/statistics/database_statistics_service.py:123:38
    |
121 |         per_page: 每页记录数。
122 |         offset: 查询偏移量。
123 |         get_all: 是否获取所有数据（Top 100 数据库）。
    |                                                  ^^
124 |
125 |     Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/statistics/database_statistics_service.py:126:23
    |
125 |     Returns:
126 |         包含聚合数据和分页信息的字典，格式如下：
    |                                     ^^
127 |         {
128 |             'data': [
    |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/services/statistics/database_statistics_service.py:126:28
    |
125 |     Returns:
126 |         包含聚合数据和分页信息的字典，格式如下：
    |                                               ^^
127 |         {
128 |             'data': [
    |

E501 Line too long (129 > 120)
   --> app/services/statistics/database_statistics_service.py:199:121
    |
197 |             pair_values = [(row.instance_id, row.database_name) for row in top_pairs]
198 |             aggregations = (
199 |                 query.filter(tuple_(DatabaseSizeAggregation.instance_id, DatabaseSizeAggregation.database_name).in_(pair_values))
    |                                                                                                                         ^^^^^^^^^
200 |                 .order_by(DatabaseSizeAggregation.period_start.asc())
201 |                 .all()
    |

C901 `fetch_aggregation_summary` is too complex (11 > 10)
   --> app/services/statistics/database_statistics_service.py:235:5
    |
235 | def fetch_aggregation_summary(
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^
236 |     *,
237 |     instance_id: int | None,
    |

PLR0913 Too many arguments in function definition (7 > 5)
   --> app/services/statistics/database_statistics_service.py:235:5
    |
235 | def fetch_aggregation_summary(
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^
236 |     *,
237 |     instance_id: int | None,
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/statistics/database_statistics_service.py:247:20
    |
245 |     """计算数据库容量聚合汇总统计。.
246 |
247 |     基于最新的聚合数据计算汇总指标，包括数据库总数、实例总数、
    |                                   ^^
248 |     总容量、平均容量、最大容量等。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/statistics/database_statistics_service.py:254:34
    |
252 |         db_type: 可选的数据库类型筛选。
253 |         database_name: 可选的数据库名称筛选。
254 |         database_id: 可选的数据库 ID 筛选，会自动解析为 database_name。
    |                                          ^^
255 |         period_type: 可选的统计周期类型筛选。
256 |         start_date: 可选的开始日期筛选。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/statistics/database_statistics_service.py:260:20
    |
259 |     Returns:
260 |         包含汇总统计信息的字典，格式如下：
    |                               ^^
261 |         {
262 |             'total_databases': 50,       # 数据库总数
    |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/services/statistics/database_statistics_service.py:260:25
    |
259 |     Returns:
260 |         包含汇总统计信息的字典，格式如下：
    |                                         ^^
261 |         {
262 |             'total_databases': 50,       # 数据库总数
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/services/statistics/database_statistics_service.py:264:47
    |
262 |             'total_databases': 50,       # 数据库总数
263 |             'total_instances': 10,       # 实例总数
264 |             'total_size_mb': 102400.5,   # 总容量（MB）
    |                                                  ^^
265 |             'avg_size_mb': 2048.01,      # 平均容量（MB）
266 |             'average_size_mb': 2048.01,  # 平均容量（MB，兼容字段）
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/services/statistics/database_statistics_service.py:264:50
    |
262 |             'total_databases': 50,       # 数据库总数
263 |             'total_instances': 10,       # 实例总数
264 |             'total_size_mb': 102400.5,   # 总容量（MB）
    |                                                      ^^
265 |             'avg_size_mb': 2048.01,      # 平均容量（MB）
266 |             'average_size_mb': 2048.01,  # 平均容量（MB，兼容字段）
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/services/statistics/database_statistics_service.py:265:48
    |
263 |             'total_instances': 10,       # 实例总数
264 |             'total_size_mb': 102400.5,   # 总容量（MB）
265 |             'avg_size_mb': 2048.01,      # 平均容量（MB）
    |                                                    ^^
266 |             'average_size_mb': 2048.01,  # 平均容量（MB，兼容字段）
267 |             'max_size_mb': 10240.0,      # 最大容量（MB）
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/services/statistics/database_statistics_service.py:265:51
    |
263 |             'total_instances': 10,       # 实例总数
264 |             'total_size_mb': 102400.5,   # 总容量（MB）
265 |             'avg_size_mb': 2048.01,      # 平均容量（MB）
    |                                                        ^^
266 |             'average_size_mb': 2048.01,  # 平均容量（MB，兼容字段）
267 |             'max_size_mb': 10240.0,      # 最大容量（MB）
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/services/statistics/database_statistics_service.py:266:48
    |
264 |             'total_size_mb': 102400.5,   # 总容量（MB）
265 |             'avg_size_mb': 2048.01,      # 平均容量（MB）
266 |             'average_size_mb': 2048.01,  # 平均容量（MB，兼容字段）
    |                                                    ^^
267 |             'max_size_mb': 10240.0,      # 最大容量（MB）
268 |             'growth_rate': 0             # 增长率（暂未实现）
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/statistics/database_statistics_service.py:266:51
    |
264 |             'total_size_mb': 102400.5,   # 总容量（MB）
265 |             'avg_size_mb': 2048.01,      # 平均容量（MB）
266 |             'average_size_mb': 2048.01,  # 平均容量（MB，兼容字段）
    |                                                        ^^
267 |             'max_size_mb': 10240.0,      # 最大容量（MB）
268 |             'growth_rate': 0             # 增长率（暂未实现）
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/services/statistics/database_statistics_service.py:266:56
    |
264 |             'total_size_mb': 102400.5,   # 总容量（MB）
265 |             'avg_size_mb': 2048.01,      # 平均容量（MB）
266 |             'average_size_mb': 2048.01,  # 平均容量（MB，兼容字段）
    |                                                                  ^^
267 |             'max_size_mb': 10240.0,      # 最大容量（MB）
268 |             'growth_rate': 0             # 增长率（暂未实现）
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/services/statistics/database_statistics_service.py:267:48
    |
265 |             'avg_size_mb': 2048.01,      # 平均容量（MB）
266 |             'average_size_mb': 2048.01,  # 平均容量（MB，兼容字段）
267 |             'max_size_mb': 10240.0,      # 最大容量（MB）
    |                                                    ^^
268 |             'growth_rate': 0             # 增长率（暂未实现）
269 |         }
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/services/statistics/database_statistics_service.py:267:51
    |
265 |             'avg_size_mb': 2048.01,      # 平均容量（MB）
266 |             'average_size_mb': 2048.01,  # 平均容量（MB，兼容字段）
267 |             'max_size_mb': 10240.0,      # 最大容量（MB）
    |                                                        ^^
268 |             'growth_rate': 0             # 增长率（暂未实现）
269 |         }
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/services/statistics/database_statistics_service.py:268:47
    |
266 |             'average_size_mb': 2048.01,  # 平均容量（MB，兼容字段）
267 |             'max_size_mb': 10240.0,      # 最大容量（MB）
268 |             'growth_rate': 0             # 增长率（暂未实现）
    |                                                  ^^
269 |         }
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/services/statistics/database_statistics_service.py:268:52
    |
266 |             'average_size_mb': 2048.01,  # 平均容量（MB，兼容字段）
267 |             'max_size_mb': 10240.0,      # 最大容量（MB）
268 |             'growth_rate': 0             # 增长率（暂未实现）
    |                                                            ^^
269 |         }
    |

INP001 File `app/services/statistics/instance_statistics_service.py` is part of an implicit namespace package. Add an `__init__.py`.
--> app/services/statistics/instance_statistics_service.py:1:1

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/services/statistics/instance_statistics_service.py:3:21
  |
1 | """实例统计服务.
2 |
3 | 封装实例数量、类型、端口、版本等统计逻辑，供仪表盘及统计页面复用。
  |                                         ^^
4 | """
  |

A004 Import `SystemError` is shadowing a Python builtin
  --> app/services/statistics/instance_statistics_service.py:12:24
   |
11 | from app import db
12 | from app.errors import SystemError
   |                        ^^^^^^^^^^^
13 | from app.models.instance import Instance
14 | from app.utils.structlog_config import log_error
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/statistics/instance_statistics_service.py:25:28
   |
24 |     Args:
25 |         db_type: 可选的数据库类型筛选，如 'mysql'、'postgresql'。
   |                                      ^^
26 |
27 |     Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/statistics/instance_statistics_service.py:28:20
   |
27 |     Returns:
28 |         包含实例统计信息的字典，格式如下：
   |                               ^^
29 |         {
30 |             'total_instances': 100,      # 实例总数
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/services/statistics/instance_statistics_service.py:28:25
   |
27 |     Returns:
28 |         包含实例统计信息的字典，格式如下：
   |                                         ^^
29 |         {
30 |             'total_instances': 100,      # 实例总数
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/statistics/instance_statistics_service.py:31:49
   |
29 |         {
30 |             'total_instances': 100,      # 实例总数
31 |             'active_instances': 85,      # 活跃实例数（未删除）
   |                                                      ^^
32 |             'normal_instances': 80,      # 正常实例数（活跃且启用）
33 |             'disabled_instances': 5,     # 禁用实例数
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/statistics/instance_statistics_service.py:31:53
   |
29 |         {
30 |             'total_instances': 100,      # 实例总数
31 |             'active_instances': 85,      # 活跃实例数（未删除）
   |                                                              ^^
32 |             'normal_instances': 80,      # 正常实例数（活跃且启用）
33 |             'disabled_instances': 5,     # 禁用实例数
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/statistics/instance_statistics_service.py:32:49
   |
30 |             'total_instances': 100,      # 实例总数
31 |             'active_instances': 85,      # 活跃实例数（未删除）
32 |             'normal_instances': 80,      # 正常实例数（活跃且启用）
   |                                                      ^^
33 |             'disabled_instances': 5,     # 禁用实例数
34 |             'deleted_instances': 15      # 已删除实例数
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/statistics/instance_statistics_service.py:32:55
   |
30 |             'total_instances': 100,      # 实例总数
31 |             'active_instances': 85,      # 活跃实例数（未删除）
32 |             'normal_instances': 80,      # 正常实例数（活跃且启用）
   |                                                                  ^^
33 |             'disabled_instances': 5,     # 禁用实例数
34 |             'deleted_instances': 15      # 已删除实例数
   |

TRY300 Consider moving this statement to an `else` block
  --> app/services/statistics/instance_statistics_service.py:55:9
   |
53 |           normal_instances = active_instances
54 |
55 | /         return {
56 | |             "total_instances": total_instances,
57 | |             "active_instances": active_instances,
58 | |             "normal_instances": normal_instances,
59 | |             "disabled_instances": disabled_instances,
60 | |             "deleted_instances": deleted_instances,
61 | |         }
   | |_________^
62 |       except Exception as exc:
63 |           log_error("获取实例汇总失败", module="instance_statistics", exception=exc)
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/statistics/instance_statistics_service.py:71:20
   |
69 |     """汇总实例容量信息。.
70 |
71 |     基于最近指定天数的容量统计数据，计算所有活跃实例的总容量。
   |                                   ^^
72 |     对每个实例取最新的一条统计记录。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/statistics/instance_statistics_service.py:75:32
   |
74 |     Args:
75 |         recent_days: 统计最近多少天的数据，默认 7 天。
   |                                          ^^
76 |
77 |     Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/statistics/instance_statistics_service.py:78:20
   |
77 |     Returns:
78 |         包含容量统计信息的字典，格式如下：
   |                               ^^
79 |         {
80 |             'total_gb': 1024.5,        # 总容量（GB）
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/services/statistics/instance_statistics_service.py:78:25
   |
77 |     Returns:
78 |         包含容量统计信息的字典，格式如下：
   |                                         ^^
79 |         {
80 |             'total_gb': 1024.5,        # 总容量（GB）
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/statistics/instance_statistics_service.py:80:45
   |
78 |         包含容量统计信息的字典，格式如下：
79 |         {
80 |             'total_gb': 1024.5,        # 总容量（GB）
   |                                                ^^
81 |             'usage_percent': 0         # 使用率（暂未实现）
82 |         }
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/statistics/instance_statistics_service.py:80:48
   |
78 |         包含容量统计信息的字典，格式如下：
79 |         {
80 |             'total_gb': 1024.5,        # 总容量（GB）
   |                                                    ^^
81 |             'usage_percent': 0         # 使用率（暂未实现）
82 |         }
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/statistics/instance_statistics_service.py:81:45
   |
79 |         {
80 |             'total_gb': 1024.5,        # 总容量（GB）
81 |             'usage_percent': 0         # 使用率（暂未实现）
   |                                                ^^
82 |         }
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/statistics/instance_statistics_service.py:81:50
   |
79 |         {
80 |             'total_gb': 1024.5,        # 总容量（GB）
81 |             'usage_percent': 0         # 使用率（暂未实现）
   |                                                          ^^
82 |         }
   |

PLC0415 `import` should be at the top-level of a file
  --> app/services/statistics/instance_statistics_service.py:89:9
   |
87 |     """
88 |     try:
89 |         from app.models.instance_size_stat import InstanceSizeStat
   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
90 |
91 |         recent_date = time_utils.now_china().date() - timedelta(days=recent_days)
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/statistics/instance_statistics_service.py:126:20
    |
125 |     Returns:
126 |         包含详细统计信息的字典，格式如下：
    |                               ^^
127 |         {
128 |             'total_instances': 100,
    |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/services/statistics/instance_statistics_service.py:126:25
    |
125 |     Returns:
126 |         包含详细统计信息的字典，格式如下：
    |                                         ^^
127 |         {
128 |             'total_instances': 100,
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/statistics/instance_statistics_service.py:211:25
    |
210 |     Returns:
211 |         所有统计值为 0 或空数组的字典，格式与 build_aggregated_statistics 返回值相同。
    |                                      ^^
212 |
213 |     """
    |

INP001 File `app/services/statistics/log_statistics_service.py` is part of an implicit namespace package. Add an `__init__.py`.
--> app/services/statistics/log_statistics_service.py:1:1

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/statistics/log_statistics_service.py:19:19
   |
17 |     """获取最近 N 天的错误/告警日志趋势。.
18 |
19 |     统计每天的错误和告警日志数量，返回时间序列数据。
   |                                 ^^
20 |
21 |     Args:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/statistics/log_statistics_service.py:22:19
   |
21 |     Args:
22 |         days: 统计天数，默认为 7 天。
   |                       ^^
23 |
24 |     Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/statistics/log_statistics_service.py:25:17
   |
24 |     Returns:
25 |         日志趋势数据列表，每个元素包含日期、错误数和告警数，格式如下：
   |                         ^^
26 |         [
27 |             {
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/statistics/log_statistics_service.py:25:34
   |
24 |     Returns:
25 |         日志趋势数据列表，每个元素包含日期、错误数和告警数，格式如下：
   |                                                           ^^
26 |         [
27 |             {
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/services/statistics/log_statistics_service.py:25:39
   |
24 |     Returns:
25 |         日志趋势数据列表，每个元素包含日期、错误数和告警数，格式如下：
   |                                                                     ^^
26 |         [
27 |             {
   |

SLF001 Private member accessed: `_mapping`
   --> app/services/statistics/log_statistics_service.py:108:26
    |
106 |             .one_or_none()
107 |         )
108 |         result_mapping = result._mapping if result is not None else {}
    |                          ^^^^^^^^^^^^^^^
109 |
110 |         trend_data: list[dict[str, int | str]] = []
    |

TRY300 Consider moving this statement to an `else` block
   --> app/services/statistics/log_statistics_service.py:120:9
    |
118 |             )
119 |
120 |         return trend_data
    |         ^^^^^^^^^^^^^^^^^
121 |     except Exception as exc:
122 |         log_error("获取日志趋势数据失败", module="log_statistics", exception=exc)
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/services/statistics/log_statistics_service.py:121:12
    |
120 |         return trend_data
121 |     except Exception as exc:
    |            ^^^^^^^^^
122 |         log_error("获取日志趋势数据失败", module="log_statistics", exception=exc)
123 |         return []
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/services/statistics/log_statistics_service.py:129:12
    |
127 |     """统计错误/告警日志级别分布。.
128 |
129 |     统计各日志级别（ERROR、WARNING、CRITICAL）的数量。
    |                   ^^
130 |
131 |     Returns:
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/services/statistics/log_statistics_service.py:129:35
    |
127 |     """统计错误/告警日志级别分布。.
128 |
129 |     统计各日志级别（ERROR、WARNING、CRITICAL）的数量。
    |                                             ^^
130 |
131 |     Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/statistics/log_statistics_service.py:132:17
    |
131 |     Returns:
132 |         日志级别分布列表，每个元素包含级别和数量，格式如下：
    |                         ^^
133 |         [
134 |             {'level': 'ERROR', 'count': 100},
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/statistics/log_statistics_service.py:132:29
    |
131 |     Returns:
132 |         日志级别分布列表，每个元素包含级别和数量，格式如下：
    |                                                 ^^
133 |         [
134 |             {'level': 'ERROR', 'count': 100},
    |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/services/statistics/log_statistics_service.py:132:34
    |
131 |     Returns:
132 |         日志级别分布列表，每个元素包含级别和数量，格式如下：
    |                                                           ^^
133 |         [
134 |             {'level': 'ERROR', 'count': 100},
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/services/statistics/log_statistics_service.py:152:12
    |
151 |         return [{"level": stat.level.value, "count": stat.count} for stat in level_stats]
152 |     except Exception as exc:
    |            ^^^^^^^^^
153 |         log_error("获取日志级别分布失败", module="log_statistics", exception=exc)
154 |         return []
    |

INP001 File `app/services/statistics/partition_statistics_service.py` is part of an implicit namespace package. Add an `__init__.py`.
--> app/services/statistics/partition_statistics_service.py:1:1

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/statistics/partition_statistics_service.py:13:35
   |
11 |     """提供分区统计相关的查询能力。.
12 |
13 |     继承自 PartitionManagementService，提供分区信息查询和统计功能。
   |                                      ^^
14 |     """
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/statistics/partition_statistics_service.py:19:19
   |
17 |         """获取所有分区的详细信息。.
18 |
19 |         查询所有表的分区信息，包括分区名称、大小、记录数等。
   |                             ^^
20 |
21 |         Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/statistics/partition_statistics_service.py:22:24
   |
21 |         Returns:
22 |             包含分区详细信息的字典，格式如下：
   |                                   ^^
23 |             {
24 |                 'partitions': [...],          # 分区列表
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/services/statistics/partition_statistics_service.py:22:29
   |
21 |         Returns:
22 |             包含分区详细信息的字典，格式如下：
   |                                             ^^
23 |             {
24 |                 'partitions': [...],          # 分区列表
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/statistics/partition_statistics_service.py:26:52
   |
24 |                 'partitions': [...],          # 分区列表
25 |                 'total_partitions': 10,       # 分区总数
26 |                 'total_size_bytes': 1024000,  # 总大小（字节）
   |                                                       ^^
27 |                 'total_size': '1.0 MB',       # 总大小（格式化）
28 |                 'total_records': 50000,       # 总记录数
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/statistics/partition_statistics_service.py:26:55
   |
24 |                 'partitions': [...],          # 分区列表
25 |                 'total_partitions': 10,       # 分区总数
26 |                 'total_size_bytes': 1024000,  # 总大小（字节）
   |                                                             ^^
27 |                 'total_size': '1.0 MB',       # 总大小（格式化）
28 |                 'total_records': 50000,       # 总记录数
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/statistics/partition_statistics_service.py:27:52
   |
25 |                 'total_partitions': 10,       # 分区总数
26 |                 'total_size_bytes': 1024000,  # 总大小（字节）
27 |                 'total_size': '1.0 MB',       # 总大小（格式化）
   |                                                       ^^
28 |                 'total_records': 50000,       # 总记录数
29 |                 'tables': ['stats', 'aggregations']  # 表名列表
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/statistics/partition_statistics_service.py:27:56
   |
25 |                 'total_partitions': 10,       # 分区总数
26 |                 'total_size_bytes': 1024000,  # 总大小（字节）
27 |                 'total_size': '1.0 MB',       # 总大小（格式化）
   |                                                               ^^
28 |                 'total_records': 50000,       # 总记录数
29 |                 'tables': ['stats', 'aggregations']  # 表名列表
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/statistics/partition_statistics_service.py:55:20
   |
53 |         """获取分区统计信息。.
54 |
55 |         获取分区的汇总统计信息，包括总记录数、总分区数、总大小等。
   |                               ^^
56 |
57 |         Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/statistics/partition_statistics_service.py:58:24
   |
57 |         Returns:
58 |             包含分区统计信息的字典，格式与 get_partition_info 返回值相同。
   |                                   ^^
59 |
60 |         """
   |

D205 1 blank line required between summary line and description
 --> app/services/sync_session_service.py:1:1
  |
1 | / """鲸落 - 同步会话服务
2 | | 管理同步会话和实例记录的业务逻辑.
3 | | """
  | |___^
4 |
5 |   from typing import Any
  |
help: Insert single blank line

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/sync_session_service.py:21:23
   |
19 |     """同步会话服务。.
20 |
21 |     管理批量同步会话和实例记录的业务逻辑，包括会话创建、实例记录管理、
   |                                         ^^
22 |     同步状态更新和统计信息维护。
   |

D107 Missing docstring in `__init__`
  --> app/services/sync_session_service.py:30:9
   |
28 |     """
29 |
30 |     def __init__(self) -> None:
   |         ^^^^^^^^
31 |         self.system_logger = get_system_logger()
32 |         self.sync_logger = get_sync_logger()
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/sync_session_service.py:35:32
   |
34 |     def _clean_sync_details(self, sync_details: dict[str, Any] | None) -> dict[str, Any] | None:
35 |         """清理同步详情中的 datetime 对象，确保 JSON 可序列化。.
   |                                          ^^
36 |
37 |         递归遍历同步详情字典，将所有 datetime 和 date 对象转换为 ISO 8601 格式字符串。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/sync_session_service.py:37:19
   |
35 |         """清理同步详情中的 datetime 对象，确保 JSON 可序列化。.
36 |
37 |         递归遍历同步详情字典，将所有 datetime 和 date 对象转换为 ISO 8601 格式字符串。
   |                             ^^
38 |
39 |         Args:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/sync_session_service.py:40:35
   |
39 |         Args:
40 |             sync_details: 原始同步详情字典，可能包含 datetime 对象。
   |                                           ^^
41 |
42 |         Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/sync_session_service.py:43:23
   |
42 |         Returns:
43 |             清理后的同步详情字典，所有 datetime 对象已转换为字符串。
   |                                 ^^
44 |             如果输入为 None，则返回 None。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/sync_session_service.py:44:23
   |
42 |         Returns:
43 |             清理后的同步详情字典，所有 datetime 对象已转换为字符串。
44 |             如果输入为 None，则返回 None。
   |                            ^^
45 |
46 |         """
   |

ANN202 Missing return type annotation for private function `clean_value`
  --> app/services/sync_session_service.py:50:13
   |
48 |             return None
49 |
50 |         def clean_value(value):
   |             ^^^^^^^^^^^
51 |             if hasattr(value, "isoformat"):  # datetime 或 date 对象
52 |                 return value.isoformat()
   |
help: Add return type annotation

ANN001 Missing type annotation for function argument `value`
  --> app/services/sync_session_service.py:50:25
   |
48 |             return None
49 |
50 |         def clean_value(value):
   |                         ^^^^^
51 |             if hasattr(value, "isoformat"):  # datetime 或 date 对象
52 |                 return value.isoformat()
   |

E501 Line too long (123 > 120)
  --> app/services/sync_session_service.py:61:121
   |
59 |         return clean_value(sync_details)
60 |
61 |     def create_session(self, sync_type: str, sync_category: str = "account", created_by: int | None = None) -> SyncSession:
   |                                                                                                                         ^^^
62 |         """创建同步会话。.
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/sync_session_service.py:64:19
   |
62 |         """创建同步会话。.
63 |
64 |         创建新的同步会话记录，并记录日志。
   |                             ^^
65 |
66 |         Args:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/sync_session_service.py:67:30
   |
66 |         Args:
67 |             sync_type: 同步操作方式，可选值：'manual_single'（手动单个）、
   |                                    ^^
68 |                 'manual_batch'（手动批量）、'manual_task'（手动任务）、
69 |                 'scheduled_task'（定时任务）。
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/services/sync_session_service.py:67:34
   |
66 |         Args:
67 |             sync_type: 同步操作方式，可选值：'manual_single'（手动单个）、
   |                                            ^^
68 |                 'manual_batch'（手动批量）、'manual_task'（手动任务）、
69 |                 'scheduled_task'（定时任务）。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/sync_session_service.py:67:50
   |
66 |         Args:
67 |             sync_type: 同步操作方式，可选值：'manual_single'（手动单个）、
   |                                                             ^^
68 |                 'manual_batch'（手动批量）、'manual_task'（手动任务）、
69 |                 'scheduled_task'（定时任务）。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/sync_session_service.py:67:55
   |
66 |         Args:
67 |             sync_type: 同步操作方式，可选值：'manual_single'（手动单个）、
   |                                                                       ^^
68 |                 'manual_batch'（手动批量）、'manual_task'（手动任务）、
69 |                 'scheduled_task'（定时任务）。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/sync_session_service.py:68:31
   |
66 |         Args:
67 |             sync_type: 同步操作方式，可选值：'manual_single'（手动单个）、
68 |                 'manual_batch'（手动批量）、'manual_task'（手动任务）、
   |                               ^^
69 |                 'scheduled_task'（定时任务）。
70 |             sync_category: 同步分类，可选值：'account'（账户）、'capacity'（容量）、
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/sync_session_service.py:68:36
   |
66 |         Args:
67 |             sync_type: 同步操作方式，可选值：'manual_single'（手动单个）、
68 |                 'manual_batch'（手动批量）、'manual_task'（手动任务）、
   |                                         ^^
69 |                 'scheduled_task'（定时任务）。
70 |             sync_category: 同步分类，可选值：'account'（账户）、'capacity'（容量）、
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/sync_session_service.py:68:51
   |
66 |         Args:
67 |             sync_type: 同步操作方式，可选值：'manual_single'（手动单个）、
68 |                 'manual_batch'（手动批量）、'manual_task'（手动任务）、
   |                                                          ^^
69 |                 'scheduled_task'（定时任务）。
70 |             sync_category: 同步分类，可选值：'account'（账户）、'capacity'（容量）、
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/sync_session_service.py:68:56
   |
66 |         Args:
67 |             sync_type: 同步操作方式，可选值：'manual_single'（手动单个）、
68 |                 'manual_batch'（手动批量）、'manual_task'（手动任务）、
   |                                                                    ^^
69 |                 'scheduled_task'（定时任务）。
70 |             sync_category: 同步分类，可选值：'account'（账户）、'capacity'（容量）、
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/sync_session_service.py:69:33
   |
67 |             sync_type: 同步操作方式，可选值：'manual_single'（手动单个）、
68 |                 'manual_batch'（手动批量）、'manual_task'（手动任务）、
69 |                 'scheduled_task'（定时任务）。
   |                                 ^^
70 |             sync_category: 同步分类，可选值：'account'（账户）、'capacity'（容量）、
71 |                 'config'（配置）、'aggregation'（聚合）、'other'（其他），默认为 'account'。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/sync_session_service.py:69:38
   |
67 |             sync_type: 同步操作方式，可选值：'manual_single'（手动单个）、
68 |                 'manual_batch'（手动批量）、'manual_task'（手动任务）、
69 |                 'scheduled_task'（定时任务）。
   |                                           ^^
70 |             sync_category: 同步分类，可选值：'account'（账户）、'capacity'（容量）、
71 |                 'config'（配置）、'aggregation'（聚合）、'other'（其他），默认为 'account'。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/sync_session_service.py:70:32
   |
68 |                 'manual_batch'（手动批量）、'manual_task'（手动任务）、
69 |                 'scheduled_task'（定时任务）。
70 |             sync_category: 同步分类，可选值：'account'（账户）、'capacity'（容量）、
   |                                    ^^
71 |                 'config'（配置）、'aggregation'（聚合）、'other'（其他），默认为 'account'。
72 |             created_by: 创建用户 ID，可选。
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/services/sync_session_service.py:70:36
   |
68 |                 'manual_batch'（手动批量）、'manual_task'（手动任务）、
69 |                 'scheduled_task'（定时任务）。
70 |             sync_category: 同步分类，可选值：'account'（账户）、'capacity'（容量）、
   |                                            ^^
71 |                 'config'（配置）、'aggregation'（聚合）、'other'（其他），默认为 'account'。
72 |             created_by: 创建用户 ID，可选。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/sync_session_service.py:70:46
   |
68 |                 'manual_batch'（手动批量）、'manual_task'（手动任务）、
69 |                 'scheduled_task'（定时任务）。
70 |             sync_category: 同步分类，可选值：'account'（账户）、'capacity'（容量）、
   |                                                       ^^
71 |                 'config'（配置）、'aggregation'（聚合）、'other'（其他），默认为 'account'。
72 |             created_by: 创建用户 ID，可选。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/sync_session_service.py:70:49
   |
68 |                 'manual_batch'（手动批量）、'manual_task'（手动任务）、
69 |                 'scheduled_task'（定时任务）。
70 |             sync_category: 同步分类，可选值：'account'（账户）、'capacity'（容量）、
   |                                                             ^^
71 |                 'config'（配置）、'aggregation'（聚合）、'other'（其他），默认为 'account'。
72 |             created_by: 创建用户 ID，可选。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/sync_session_service.py:70:61
   |
68 |                 'manual_batch'（手动批量）、'manual_task'（手动任务）、
69 |                 'scheduled_task'（定时任务）。
70 |             sync_category: 同步分类，可选值：'account'（账户）、'capacity'（容量）、
   |                                                                           ^^
71 |                 'config'（配置）、'aggregation'（聚合）、'other'（其他），默认为 'account'。
72 |             created_by: 创建用户 ID，可选。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/sync_session_service.py:70:64
   |
68 |                 'manual_batch'（手动批量）、'manual_task'（手动任务）、
69 |                 'scheduled_task'（定时任务）。
70 |             sync_category: 同步分类，可选值：'account'（账户）、'capacity'（容量）、
   |                                                                                 ^^
71 |                 'config'（配置）、'aggregation'（聚合）、'other'（其他），默认为 'account'。
72 |             created_by: 创建用户 ID，可选。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/sync_session_service.py:71:25
   |
69 |                 'scheduled_task'（定时任务）。
70 |             sync_category: 同步分类，可选值：'account'（账户）、'capacity'（容量）、
71 |                 'config'（配置）、'aggregation'（聚合）、'other'（其他），默认为 'account'。
   |                         ^^
72 |             created_by: 创建用户 ID，可选。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/sync_session_service.py:71:28
   |
69 |                 'scheduled_task'（定时任务）。
70 |             sync_category: 同步分类，可选值：'account'（账户）、'capacity'（容量）、
71 |                 'config'（配置）、'aggregation'（聚合）、'other'（其他），默认为 'account'。
   |                               ^^
72 |             created_by: 创建用户 ID，可选。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/sync_session_service.py:71:43
   |
69 |                 'scheduled_task'（定时任务）。
70 |             sync_category: 同步分类，可选值：'account'（账户）、'capacity'（容量）、
71 |                 'config'（配置）、'aggregation'（聚合）、'other'（其他），默认为 'account'。
   |                                                ^^
72 |             created_by: 创建用户 ID，可选。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/sync_session_service.py:71:46
   |
69 |                 'scheduled_task'（定时任务）。
70 |             sync_category: 同步分类，可选值：'account'（账户）、'capacity'（容量）、
71 |                 'config'（配置）、'aggregation'（聚合）、'other'（其他），默认为 'account'。
   |                                                      ^^
72 |             created_by: 创建用户 ID，可选。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/services/sync_session_service.py:71:55
   |
69 |                 'scheduled_task'（定时任务）。
70 |             sync_category: 同步分类，可选值：'account'（账户）、'capacity'（容量）、
71 |                 'config'（配置）、'aggregation'（聚合）、'other'（其他），默认为 'account'。
   |                                                                 ^^
72 |             created_by: 创建用户 ID，可选。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/services/sync_session_service.py:71:58
   |
69 |                 'scheduled_task'（定时任务）。
70 |             sync_category: 同步分类，可选值：'account'（账户）、'capacity'（容量）、
71 |                 'config'（配置）、'aggregation'（聚合）、'other'（其他），默认为 'account'。
   |                                                                       ^^
72 |             created_by: 创建用户 ID，可选。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/sync_session_service.py:71:59
   |
69 |                 'scheduled_task'（定时任务）。
70 |             sync_category: 同步分类，可选值：'account'（账户）、'capacity'（容量）、
71 |                 'config'（配置）、'aggregation'（聚合）、'other'（其他），默认为 'account'。
   |                                                                         ^^
72 |             created_by: 创建用户 ID，可选。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/services/sync_session_service.py:72:32
   |
70 |             sync_category: 同步分类，可选值：'account'（账户）、'capacity'（容量）、
71 |                 'config'（配置）、'aggregation'（聚合）、'other'（其他），默认为 'account'。
72 |             created_by: 创建用户 ID，可选。
   |                                    ^^
73 |
74 |         Returns:
   |

TRY300 Consider moving this statement to an `else` block
  --> app/services/sync_session_service.py:95:13
   |
93 |             )
94 |
95 |             return session
   |             ^^^^^^^^^^^^^^
96 |         except Exception as e:
97 |             db.session.rollback()
   |

E501 Line too long (137 > 120)
   --> app/services/sync_session_service.py:107:121
    |
105 | …
106 | …
107 | …s: list[int], sync_category: str = "account") -> list[SyncInstanceRecord]:
    |                                                           ^^^^^^^^^^^^^^^^^
108 | …
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/sync_session_service.py:110:29
    |
108 |         """为会话添加实例记录。.
109 |
110 |         根据实例 ID 列表批量创建实例同步记录，并关联到指定会话。
    |                                             ^^
111 |
112 |         Args:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/sync_session_service.py:115:32
    |
113 |             session_id: 会话 ID。
114 |             instance_ids: 实例 ID 列表。
115 |             sync_category: 同步分类，可选值：'account'、'capacity'、'config'、
    |                                    ^^
116 |                 'aggregation'、'other'，默认为 'account'。
    |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/services/sync_session_service.py:115:36
    |
113 |             session_id: 会话 ID。
114 |             instance_ids: 实例 ID 列表。
115 |             sync_category: 同步分类，可选值：'account'、'capacity'、'config'、
    |                                            ^^
116 |                 'aggregation'、'other'，默认为 'account'。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/sync_session_service.py:116:38
    |
114 |             instance_ids: 实例 ID 列表。
115 |             sync_category: 同步分类，可选值：'account'、'capacity'、'config'、
116 |                 'aggregation'、'other'，默认为 'account'。
    |                                       ^^
117 |
118 |         Returns:
    |

TRY300 Consider moving this statement to an `else` block
   --> app/services/sync_session_service.py:152:13
    |
150 |             )
151 |
152 |             return records
    |             ^^^^^^^^^^^^^^
153 |         except Exception as e:
154 |             db.session.rollback()
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/sync_session_service.py:167:22
    |
165 |         """开始实例同步。.
166 |
167 |         将实例记录状态标记为同步中，并记录开始时间。
    |                                   ^^
168 |
169 |         Args:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/sync_session_service.py:173:22
    |
172 |         Returns:
173 |             成功返回 True，失败或记录不存在返回 False。
    |                          ^^
174 |
175 |         """
    |

TRY300 Consider moving this statement to an `else` block
   --> app/services/sync_session_service.py:192:13
    |
190 |             )
191 |
192 |             return True
    |             ^^^^^^^^^^^
193 |         except Exception as e:
194 |             db.session.rollback()
    |

PLR0913 Too many arguments in function definition (6 > 5)
   --> app/services/sync_session_service.py:203:9
    |
201 |             return False
202 |
203 |     def complete_instance_sync(
    |         ^^^^^^^^^^^^^^^^^^^^^^
204 |         self,
205 |         record_id: int,
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/sync_session_service.py:214:21
    |
212 |         """完成实例同步。.
213 |
214 |         将实例记录标记为完成状态，记录同步统计信息，并更新会话统计。
    |                                 ^^
215 |
216 |         Args:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/sync_session_service.py:214:30
    |
212 |         """完成实例同步。.
213 |
214 |         将实例记录标记为完成状态，记录同步统计信息，并更新会话统计。
    |                                                   ^^
215 |
216 |         Args:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/sync_session_service.py:218:34
    |
216 |         Args:
217 |             record_id: 实例记录 ID。
218 |             items_synced: 同步的项目总数，默认为 0。
    |                                         ^^
219 |             items_created: 新增的项目数量，默认为 0。
220 |             items_updated: 更新的项目数量，默认为 0。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/sync_session_service.py:219:35
    |
217 |             record_id: 实例记录 ID。
218 |             items_synced: 同步的项目总数，默认为 0。
219 |             items_created: 新增的项目数量，默认为 0。
    |                                          ^^
220 |             items_updated: 更新的项目数量，默认为 0。
221 |             items_deleted: 删除的项目数量，默认为 0。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/sync_session_service.py:220:35
    |
218 |             items_synced: 同步的项目总数，默认为 0。
219 |             items_created: 新增的项目数量，默认为 0。
220 |             items_updated: 更新的项目数量，默认为 0。
    |                                          ^^
221 |             items_deleted: 删除的项目数量，默认为 0。
222 |             sync_details: 同步详情字典，可选。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/sync_session_service.py:221:35
    |
219 |             items_created: 新增的项目数量，默认为 0。
220 |             items_updated: 更新的项目数量，默认为 0。
221 |             items_deleted: 删除的项目数量，默认为 0。
    |                                          ^^
222 |             sync_details: 同步详情字典，可选。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/sync_session_service.py:222:33
    |
220 |             items_updated: 更新的项目数量，默认为 0。
221 |             items_deleted: 删除的项目数量，默认为 0。
222 |             sync_details: 同步详情字典，可选。
    |                                       ^^
223 |
224 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/sync_session_service.py:225:22
    |
224 |         Returns:
225 |             成功返回 True，失败或记录不存在返回 False。
    |                          ^^
226 |
227 |         """
    |

TRY300 Consider moving this statement to an `else` block
   --> app/services/sync_session_service.py:257:13
    |
255 |             )
256 |
257 |             return True
    |             ^^^^^^^^^^^
258 |         except Exception as e:
259 |             db.session.rollback()
    |

E501 Line too long (121 > 120)
   --> app/services/sync_session_service.py:268:121
    |
266 |             return False
267 |
268 |     def fail_instance_sync(self, record_id: int, error_message: str, sync_details: dict[str, Any] | None = None) -> bool:
    |                                                                                                                         ^
269 |         """标记实例同步失败。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/sync_session_service.py:271:21
    |
269 |         """标记实例同步失败。.
270 |
271 |         将实例记录标记为失败状态，记录错误信息，并更新会话统计。
    |                                 ^^
272 |
273 |         Args:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/sync_session_service.py:271:28
    |
269 |         """标记实例同步失败。.
270 |
271 |         将实例记录标记为失败状态，记录错误信息，并更新会话统计。
    |                                               ^^
272 |
273 |         Args:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/sync_session_service.py:276:33
    |
274 |             record_id: 实例记录 ID。
275 |             error_message: 错误信息描述。
276 |             sync_details: 同步详情字典，可选。
    |                                       ^^
277 |
278 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/sync_session_service.py:279:22
    |
278 |         Returns:
279 |             成功返回 True，失败或记录不存在返回 False。
    |                          ^^
280 |
281 |         """
    |

TRY300 Consider moving this statement to an `else` block
   --> app/services/sync_session_service.py:302:13
    |
300 |             )
301 |
302 |             return True
    |             ^^^^^^^^^^^
303 |         except Exception as e:
304 |             db.session.rollback()
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/sync_session_service.py:316:24
    |
314 |         """更新会话统计信息。.
315 |
316 |         统计会话中成功和失败的实例数量，并更新会话对象。
    |                                       ^^
317 |
318 |         Args:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/sync_session_service.py:368:19
    |
367 |         Returns:
368 |             实例记录列表，查询失败时返回空列表。
    |                         ^^
369 |
370 |         """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/sync_session_service.py:389:17
    |
388 |         Returns:
389 |             会话对象，不存在或查询失败时返回 None。
    |                     ^^
390 |
391 |         """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/sync_session_service.py:407:28
    |
406 |         Args:
407 |             sync_type: 同步类型，如 'manual_single'、'manual_batch'。
    |                                ^^
408 |             limit: 限制数量，默认为 50。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/sync_session_service.py:408:24
    |
406 |         Args:
407 |             sync_type: 同步类型，如 'manual_single'、'manual_batch'。
408 |             limit: 限制数量，默认为 50。
    |                            ^^
409 |
410 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/sync_session_service.py:411:17
    |
410 |         Returns:
411 |             会话列表，查询失败时返回空列表。
    |                     ^^
412 |
413 |         """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/sync_session_service.py:429:32
    |
428 |         Args:
429 |             sync_category: 同步分类，如 'account'、'capacity'。
    |                                    ^^
430 |             limit: 限制数量，默认为 50。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/sync_session_service.py:430:24
    |
428 |         Args:
429 |             sync_category: 同步分类，如 'account'、'capacity'。
430 |             limit: 限制数量，默认为 50。
    |                            ^^
431 |
432 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/sync_session_service.py:433:17
    |
432 |         Returns:
433 |             会话列表，查询失败时返回空列表。
    |                     ^^
434 |
435 |         """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/sync_session_service.py:453:24
    |
452 |         Args:
453 |             limit: 限制数量，默认为 20。
    |                            ^^
454 |
455 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/sync_session_service.py:456:17
    |
455 |         Returns:
456 |             会话列表，查询失败时返回空列表。
    |                     ^^
457 |
458 |         """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/services/sync_session_service.py:479:22
    |
478 |         Returns:
479 |             成功返回 True，失败或会话不存在返回 False。
    |                          ^^
480 |
481 |         """
    |

TRY300 Consider moving this statement to an `else` block
   --> app/services/sync_session_service.py:495:13
    |
493 |                 self.sync_logger.info("取消同步会话", module="sync_session", session_id=session_id)
494 |
495 |             return True
    |             ^^^^^^^^^^^
496 |         except Exception as e:
497 |             db.session.rollback()
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/tasks/__init__.py:3:12
  |
1 | """定时任务模块。.
2 |
3 | 包含各种定时任务的实现，由 APScheduler 调度执行。
  |                       ^^
4 |
5 | 主要任务：
  |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
 --> app/tasks/__init__.py:5:5
  |
3 | 包含各种定时任务的实现，由 APScheduler 调度执行。
4 |
5 | 主要任务：
  |         ^^
6 | - log_cleanup_tasks: 日志清理任务
7 | - accounts_sync_tasks: 账户同步任务
  |

PLR0915 Too many statements (66 > 50)
  --> app/tasks/accounts_sync_tasks.py:15:5
   |
15 | def sync_accounts(manual_run: bool = False, created_by: int | None = None, **kwargs: Any) -> None:
   |     ^^^^^^^^^^^^^
16 |     """同步账户任务 - 同步所有实例的账户信息。.
   |

FBT001 Boolean-typed positional argument in function definition
  --> app/tasks/accounts_sync_tasks.py:15:19
   |
15 | def sync_accounts(manual_run: bool = False, created_by: int | None = None, **kwargs: Any) -> None:
   |                   ^^^^^^^^^^
16 |     """同步账户任务 - 同步所有实例的账户信息。.
   |

FBT002 Boolean default positional argument in function definition
  --> app/tasks/accounts_sync_tasks.py:15:19
   |
15 | def sync_accounts(manual_run: bool = False, created_by: int | None = None, **kwargs: Any) -> None:
   |                   ^^^^^^^^^^
16 |     """同步账户任务 - 同步所有实例的账户信息。.
   |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `**kwargs`
  --> app/tasks/accounts_sync_tasks.py:15:86
   |
15 | def sync_accounts(manual_run: bool = False, created_by: int | None = None, **kwargs: Any) -> None:
   |                                                                                      ^^^
16 |     """同步账户任务 - 同步所有实例的账户信息。.
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/tasks/accounts_sync_tasks.py:18:17
   |
16 |     """同步账户任务 - 同步所有实例的账户信息。.
17 |
18 |     遍历所有启用的数据库实例，同步账户清单和权限信息。
   |                             ^^
19 |     创建同步会话记录，跟踪每个实例的同步状态和结果。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/tasks/accounts_sync_tasks.py:19:13
   |
18 |     遍历所有启用的数据库实例，同步账户清单和权限信息。
19 |     创建同步会话记录，跟踪每个实例的同步状态和结果。
   |                     ^^
20 |
21 |     Args:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/tasks/accounts_sync_tasks.py:22:28
   |
21 |     Args:
22 |         manual_run: 是否为手动触发，默认 False（定时任务）。
   |                                   ^^
23 |         created_by: 触发用户 ID，手动触发时必填。
24 |         **kwargs: 其他可选参数。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/tasks/accounts_sync_tasks.py:22:37
   |
21 |     Args:
22 |         manual_run: 是否为手动触发，默认 False（定时任务）。
   |                                               ^^
23 |         created_by: 触发用户 ID，手动触发时必填。
24 |         **kwargs: 其他可选参数。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/tasks/accounts_sync_tasks.py:22:42
   |
21 |     Args:
22 |         manual_run: 是否为手动触发，默认 False（定时任务）。
   |                                                         ^^
23 |         created_by: 触发用户 ID，手动触发时必填。
24 |         **kwargs: 其他可选参数。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/tasks/accounts_sync_tasks.py:23:28
   |
21 |     Args:
22 |         manual_run: 是否为手动触发，默认 False（定时任务）。
23 |         created_by: 触发用户 ID，手动触发时必填。
   |                                ^^
24 |         **kwargs: 其他可选参数。
   |

E501 Line too long (136 > 120)
   --> app/tasks/accounts_sync_tasks.py:115:121
    |
113 | …         continue
114 | …     except PermissionSyncError as permission_error:
115 | …         sync_session_service.fail_instance_sync(record.id, str(permission_error), sync_details=permission_error.summary)
    |                                                                                                           ^^^^^^^^^^^^^^^^
116 | …         sync_logger.exception(
117 | …             "账户同步权限阶段失败",
    |

G201 Logging `.exception(...)` should be used instead of `.error(..., exc_info=True)`
   --> app/tasks/accounts_sync_tasks.py:169:33
    |
167 |                     sync_session_service.fail_instance_sync(record.id, str(exc))
168 |
169 |                     sync_logger.error(
    |                                 ^^^^^
170 |                         "实例账户同步异常",
171 |                         module="accounts_sync",
    |

G201 Logging `.exception(...)` should be used instead of `.error(..., exc_info=True)`
   --> app/tasks/accounts_sync_tasks.py:205:25
    |
203 |                 db.session.commit()
204 |
205 |             sync_logger.error(
    |                         ^^^^^
206 |                 "账户同步任务失败",
207 |                 module="accounts_sync",
    |

D205 1 blank line required between summary line and description
 --> app/tasks/capacity_aggregation_tasks.py:1:1
  |
1 | / """数据库大小统计聚合定时任务
2 | | 负责计算每周、每月、每季度的统计聚合数据.
3 | | """
  | |___^
4 |
5 |   from collections.abc import Sequence
  |
help: Insert single blank line

ANN001 Missing type annotation for function argument `logger`
  --> app/tasks/capacity_aggregation_tasks.py:23:54
   |
23 | def _select_periods(requested: Sequence[str] | None, logger, allowed_periods: Sequence[str]) -> list[str]:
   |                                                      ^^^^^^
24 |     """根据请求的周期返回有效周期列表。.
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/tasks/capacity_aggregation_tasks.py:27:29
   |
26 |     Args:
27 |         requested: 用户指定的周期集合，None 表示全部。
   |                                      ^^
28 |         logger: 用于记录未知周期的 logger。
29 |         allowed_periods: 服务可用的周期序列。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/tasks/capacity_aggregation_tasks.py:74:16
   |
73 |     Returns:
74 |         已处理记录数量，缺失时返回 0。
   |                       ^^
75 |
76 |     """
   |

C901 `calculate_database_size_aggregations` is too complex (26 > 10)
   --> app/tasks/capacity_aggregation_tasks.py:105:5
    |
105 | def calculate_database_size_aggregations(
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
106 |     manual_run: bool = False,
107 |     periods: list[str] | None = None,
    |

PLR0912 Too many branches (30 > 12)
   --> app/tasks/capacity_aggregation_tasks.py:105:5
    |
105 | def calculate_database_size_aggregations(
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
106 |     manual_run: bool = False,
107 |     periods: list[str] | None = None,
    |

PLR0915 Too many statements (119 > 50)
   --> app/tasks/capacity_aggregation_tasks.py:105:5
    |
105 | def calculate_database_size_aggregations(
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
106 |     manual_run: bool = False,
107 |     periods: list[str] | None = None,
    |

FBT001 Boolean-typed positional argument in function definition
   --> app/tasks/capacity_aggregation_tasks.py:106:5
    |
105 | def calculate_database_size_aggregations(
106 |     manual_run: bool = False,
    |     ^^^^^^^^^^
107 |     periods: list[str] | None = None,
108 |     created_by: int | None = None,
    |

FBT002 Boolean default positional argument in function definition
   --> app/tasks/capacity_aggregation_tasks.py:106:5
    |
105 | def calculate_database_size_aggregations(
106 |     manual_run: bool = False,
    |     ^^^^^^^^^^
107 |     periods: list[str] | None = None,
108 |     created_by: int | None = None,
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/tasks/capacity_aggregation_tasks.py:110:19
    |
108 |     created_by: int | None = None,
109 | ) -> dict[str, Any]:
110 |     """计算数据库大小统计聚合（按日/周/月/季依次执行）。.
    |                              ^^
111 |
112 |     Args:
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/tasks/capacity_aggregation_tasks.py:110:32
    |
108 |     created_by: int | None = None,
109 | ) -> dict[str, Any]:
110 |     """计算数据库大小统计聚合（按日/周/月/季依次执行）。.
    |                                                     ^^
111 |
112 |     Args:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/tasks/capacity_aggregation_tasks.py:113:30
    |
112 |     Args:
113 |         manual_run: 是否由用户手动触发，True 表示手动执行。
    |                                       ^^
114 |         periods: 需要计算的聚合周期列表，取值 daily/weekly/monthly/quarterly，默认全部执行。
115 |         created_by: 手动触发时记录的用户 ID。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/tasks/capacity_aggregation_tasks.py:114:29
    |
112 |     Args:
113 |         manual_run: 是否由用户手动触发，True 表示手动执行。
114 |         periods: 需要计算的聚合周期列表，取值 daily/weekly/monthly/quarterly，默认全部执行。
    |                                        ^^
115 |         created_by: 手动触发时记录的用户 ID。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/tasks/capacity_aggregation_tasks.py:114:63
    |
112 |     Args:
113 |         manual_run: 是否由用户手动触发，True 表示手动执行。
114 |         periods: 需要计算的聚合周期列表，取值 daily/weekly/monthly/quarterly，默认全部执行。
    |                                                                             ^^
115 |         created_by: 手动触发时记录的用户 ID。
    |

PLC0415 `import` should be at the top-level of a file
   --> app/tasks/capacity_aggregation_tasks.py:121:5
    |
120 |     """
121 |     from app import create_app
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^
122 |     from app.services.sync_session_service import sync_session_service
123 |     from app.utils.structlog_config import get_sync_logger
    |

PLC0415 `import` should be at the top-level of a file
   --> app/tasks/capacity_aggregation_tasks.py:122:5
    |
120 |     """
121 |     from app import create_app
122 |     from app.services.sync_session_service import sync_session_service
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
123 |     from app.utils.structlog_config import get_sync_logger
124 |     from app.utils.time_utils import time_utils
    |

PLC0415 `import` should be at the top-level of a file
   --> app/tasks/capacity_aggregation_tasks.py:123:5
    |
121 |     from app import create_app
122 |     from app.services.sync_session_service import sync_session_service
123 |     from app.utils.structlog_config import get_sync_logger
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
124 |     from app.utils.time_utils import time_utils
    |

PLC0415 `import` should be at the top-level of a file
   --> app/tasks/capacity_aggregation_tasks.py:124:5
    |
122 |     from app.services.sync_session_service import sync_session_service
123 |     from app.utils.structlog_config import get_sync_logger
124 |     from app.utils.time_utils import time_utils
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
125 |
126 |     app = create_app(init_scheduler_on_start=False)
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/tasks/capacity_aggregation_tasks.py:162:34
    |
160 |             if not selected_periods:
161 |                 sync_logger.warning(
162 |                     "未选择任何有效的聚合周期，任务直接完成",
    |                                              ^^
163 |                     module="aggregation_sync",
164 |                     requested_periods=periods,
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/tasks/capacity_aggregation_tasks.py:168:43
    |
166 |                 return {
167 |                     "status": STATUS_SKIPPED,
168 |                     "message": "未选择有效的聚合周期，未执行统计任务",
    |                                                     ^^
169 |                     "metrics": {
170 |                         "aggregations_created": 0,
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/tasks/capacity_aggregation_tasks.py:177:24
    |
176 |             sync_logger.info(
177 |                 "找到活跃实例，准备创建同步会话",
    |                              ^^
178 |                 module="aggregation_sync",
179 |                 instance_count=len(active_instances),
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/tasks/capacity_aggregation_tasks.py:231:36
    |
229 |                 else:
230 |                     sync_logger.warning(
231 |                         "未找到实例的同步记录，跳过开始标记",
    |                                              ^^
232 |                         module="aggregation_sync",
233 |                         session_id=session.session_id,
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/tasks/capacity_aggregation_tasks.py:405:56
    |
403 |             overall_status = STATUS_COMPLETED if failed_instances == 0 else STATUS_FAILED
404 |             message = (
405 |                 f"统计聚合完成: 成功 {successful_instances} 个实例，失败 {failed_instances} 个实例"
    |                                                                   ^^
406 |                 if failed_instances
407 |                 else f"统计聚合完成，共处理 {successful_instances} 个实例"
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/tasks/capacity_aggregation_tasks.py:407:30
    |
405 |                 f"统计聚合完成: 成功 {successful_instances} 个实例，失败 {failed_instances} 个实例"
406 |                 if failed_instances
407 |                 else f"统计聚合完成，共处理 {successful_instances} 个实例"
    |                                    ^^
408 |             )
    |

SIM105 Use `contextlib.suppress(Exception)` instead of `try`-`except`-`pass`
   --> app/tasks/capacity_aggregation_tasks.py:450:17
    |
448 |               )
449 |               if session is not None:
450 | /                 try:
451 | |                     db.session.rollback()
452 | |                 except Exception:  # pragma: no cover - 防御性处理
453 | |                     pass
    | |________________________^
454 |                   # 将仍处于运行状态的实例记录标记为失败
455 |                   leftover_ids = (
    |
help: Replace `try`-`except`-`pass` with `with contextlib.suppress(Exception): ...`

S110 `try`-`except`-`pass` detected, consider logging the exception
   --> app/tasks/capacity_aggregation_tasks.py:452:17
    |
450 |                   try:
451 |                       db.session.rollback()
452 | /                 except Exception:  # pragma: no cover - 防御性处理
453 | |                     pass
    | |________________________^
454 |                   # 将仍处于运行状态的实例记录标记为失败
455 |                   leftover_ids = (
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/tasks/capacity_aggregation_tasks.py:452:24
    |
450 |                 try:
451 |                     db.session.rollback()
452 |                 except Exception:  # pragma: no cover - 防御性处理
    |                        ^^^^^^^^^
453 |                     pass
454 |                 # 将仍处于运行状态的实例记录标记为失败
    |

S112 `try`-`except`-`continue` detected, consider logging the exception
   --> app/tasks/capacity_aggregation_tasks.py:465:21
    |
463 |                               error_message=f"聚合任务异常: {exc}",
464 |                           )
465 | /                     except Exception:
466 | |                         continue
    | |________________________________^
467 |                   session.status = "failed"
468 |                   session.completed_at = time_utils.now()
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/tasks/capacity_aggregation_tasks.py:465:28
    |
463 |                             error_message=f"聚合任务异常: {exc}",
464 |                         )
465 |                     except Exception:
    |                            ^^^^^^^^^
466 |                         continue
467 |                 session.status = "failed"
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/tasks/capacity_aggregation_tasks.py:483:16
    |
481 |     """计算指定实例的统计聚合。.
482 |
483 |     为指定实例计算所有周期（日/周/月/季）的聚合数据。
    |                           ^^
484 |
485 |     Args:
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/tasks/capacity_aggregation_tasks.py:483:24
    |
481 |     """计算指定实例的统计聚合。.
482 |
483 |     为指定实例计算所有周期（日/周/月/季）的聚合数据。
    |                                        ^^
484 |
485 |     Args:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/tasks/capacity_aggregation_tasks.py:489:15
    |
488 |     Returns:
489 |         聚合结果字典，包含状态、消息和各周期的聚合详情。
    |                     ^^
490 |
491 |     """
    |

PLC0415 `import` should be at the top-level of a file
   --> app/tasks/capacity_aggregation_tasks.py:492:5
    |
491 |     """
492 |     from app import create_app
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^
493 |
494 |     app = create_app(init_scheduler_on_start=False)
    |

TRY300 Consider moving this statement to an `else` block
   --> app/tasks/capacity_aggregation_tasks.py:532:13
    |
530 |                 message=result.get("message"),
531 |             )
532 |             return result
    |             ^^^^^^^^^^^^^
533 |
534 |         except Exception as exc:
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/tasks/capacity_aggregation_tasks.py:534:16
    |
532 |             return result
533 |
534 |         except Exception as exc:
    |                ^^^^^^^^^
535 |             log_error(
536 |                 "计算实例统计聚合失败",
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/tasks/capacity_aggregation_tasks.py:552:26
    |
551 |     Args:
552 |         period_type: 周期类型（weekly=周、monthly=月、quarterly=季度）。
    |                              ^^
553 |         start_date: 周期开始日期。
554 |         end_date: 周期结束日期。
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/tasks/capacity_aggregation_tasks.py:552:58
    |
551 |     Args:
552 |         period_type: 周期类型（weekly=周、monthly=月、quarterly=季度）。
    |                                                                     ^^
553 |         start_date: 周期开始日期。
554 |         end_date: 周期结束日期。
    |

PLC0415 `import` should be at the top-level of a file
   --> app/tasks/capacity_aggregation_tasks.py:560:5
    |
559 |     """
560 |     from app import create_app
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^
561 |
562 |     app = create_app(init_scheduler_on_start=False)
    |

TRY300 Consider moving this statement to an `else` block
   --> app/tasks/capacity_aggregation_tasks.py:587:13
    |
585 |             )
586 |
587 |             return result
    |             ^^^^^^^^^^^^^
588 |
589 |         except Exception as exc:
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/tasks/capacity_aggregation_tasks.py:589:16
    |
587 |             return result
588 |
589 |         except Exception as exc:
    |                ^^^^^^^^^
590 |             log_error(
591 |                 "计算指定周期统计聚合失败",
    |

PLC0415 `import` should be at the top-level of a file
   --> app/tasks/capacity_aggregation_tasks.py:612:5
    |
611 |     """
612 |     from app import create_app
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^
613 |
614 |     app = create_app(init_scheduler_on_start=False)
    |

PLC0415 `import` should be at the top-level of a file
   --> app/tasks/capacity_aggregation_tasks.py:617:13
    |
615 |     with app.app_context():
616 |         try:
617 |             from sqlalchemy import desc, func
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
618 |
619 |             from app.models.database_size_aggregation import DatabaseSizeAggregation
    |

PLC0415 `import` should be at the top-level of a file
   --> app/tasks/capacity_aggregation_tasks.py:619:13
    |
617 |             from sqlalchemy import desc, func
618 |
619 |             from app.models.database_size_aggregation import DatabaseSizeAggregation
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
620 |
621 |             # 获取今日聚合统计
    |

DTZ011 `datetime.date.today()` used
   --> app/tasks/capacity_aggregation_tasks.py:622:21
    |
621 |             # 获取今日聚合统计
622 |             today = date.today()
    |                     ^^^^^^^^^^^^
623 |
624 |             # 获取最近聚合时间
    |
help: Use `datetime.datetime.now(tz=...).date()` instead

BLE001 Do not catch blind exception: `Exception`
   --> app/tasks/capacity_aggregation_tasks.py:646:16
    |
644 |             }
645 |
646 |         except Exception as exc:
    |                ^^^^^^^^^
647 |             log_error(
648 |                 "获取聚合状态失败",
    |

PLR2004 Magic value used in comparison, consider replacing `23` with a constant variable
   --> app/tasks/capacity_aggregation_tasks.py:675:96
    |
673 |         # 检查聚合时间配置
674 |         aggregation_hour = getattr(Config, "AGGREGATION_HOUR", 4)
675 |         if not isinstance(aggregation_hour, int) or aggregation_hour < 0 or aggregation_hour > 23:
    |                                                                                                ^^
676 |             config_issues.append("聚合时间配置无效，应为0-23之间的整数")
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/tasks/capacity_aggregation_tasks.py:676:43
    |
674 |         aggregation_hour = getattr(Config, "AGGREGATION_HOUR", 4)
675 |         if not isinstance(aggregation_hour, int) or aggregation_hour < 0 or aggregation_hour > 23:
676 |             config_issues.append("聚合时间配置无效，应为0-23之间的整数")
    |                                                   ^^
677 |
678 |         status = STATUS_COMPLETED if not config_issues else STATUS_FAILED
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/tasks/capacity_aggregation_tasks.py:691:12
    |
689 |         }
690 |
691 |     except Exception as exc:
    |            ^^^^^^^^^
692 |         log_error(
693 |             "验证聚合配置失败",
    |

D205 1 blank line required between summary line and description
 --> app/tasks/capacity_collection_tasks.py:1:1
  |
1 | / """数据库大小采集定时任务
2 | | 负责每日自动采集所有数据库实例的大小信息.
3 | | """
  | |___^
4 |
5 |   from typing import Any
  |
help: Insert single blank line

C901 `collect_database_sizes` is too complex (12 > 10)
  --> app/tasks/capacity_collection_tasks.py:14:5
   |
14 | def collect_database_sizes():
   |     ^^^^^^^^^^^^^^^^^^^^^^
15 |     """容量同步定时任务。.
   |

PLR0915 Too many statements (101 > 50)
  --> app/tasks/capacity_collection_tasks.py:14:5
   |
14 | def collect_database_sizes():
   |     ^^^^^^^^^^^^^^^^^^^^^^
15 |     """容量同步定时任务。.
   |

ANN201 Missing return type annotation for public function `collect_database_sizes`
  --> app/tasks/capacity_collection_tasks.py:14:5
   |
14 | def collect_database_sizes():
   |     ^^^^^^^^^^^^^^^^^^^^^^
15 |     """容量同步定时任务。.
   |
help: Add return type annotation

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/tasks/capacity_collection_tasks.py:17:13
   |
15 |     """容量同步定时任务。.
16 |
17 |     每天凌晨3点执行，同步所有活跃实例的数据库容量信息。
   |                    ^^
18 |     创建同步会话，遍历所有活跃实例，采集数据库大小并保存。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/tasks/capacity_collection_tasks.py:18:11
   |
17 |     每天凌晨3点执行，同步所有活跃实例的数据库容量信息。
18 |     创建同步会话，遍历所有活跃实例，采集数据库大小并保存。
   |                 ^^
19 |
20 |     Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/tasks/capacity_collection_tasks.py:18:20
   |
17 |     每天凌晨3点执行，同步所有活跃实例的数据库容量信息。
18 |     创建同步会话，遍历所有活跃实例，采集数据库大小并保存。
   |                                   ^^
19 |
20 |     Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/tasks/capacity_collection_tasks.py:21:18
   |
20 |     Returns:
21 |         包含同步结果的字典，包括成功/失败实例数、总容量等信息。
   |                           ^^
22 |
23 |     """
   |

PLC0415 `import` should be at the top-level of a file
  --> app/tasks/capacity_collection_tasks.py:24:5
   |
23 |     """
24 |     from app import create_app
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^
25 |     from app.services.sync_session_service import sync_session_service
26 |     from app.utils.time_utils import time_utils
   |

PLC0415 `import` should be at the top-level of a file
  --> app/tasks/capacity_collection_tasks.py:25:5
   |
23 |     """
24 |     from app import create_app
25 |     from app.services.sync_session_service import sync_session_service
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
26 |     from app.utils.time_utils import time_utils
27 |     # 创建Flask应用上下文，确保数据库操作正常
   |

PLC0415 `import` should be at the top-level of a file
  --> app/tasks/capacity_collection_tasks.py:26:5
   |
24 |     from app import create_app
25 |     from app.services.sync_session_service import sync_session_service
26 |     from app.utils.time_utils import time_utils
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
27 |     # 创建Flask应用上下文，确保数据库操作正常
28 |     app = create_app(init_scheduler_on_start=False)
   |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/tasks/capacity_collection_tasks.py:27:19
   |
25 |     from app.services.sync_session_service import sync_session_service
26 |     from app.utils.time_utils import time_utils
27 |     # 创建Flask应用上下文，确保数据库操作正常
   |                          ^^
28 |     app = create_app(init_scheduler_on_start=False)
29 |     with app.app_context():
   |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/tasks/capacity_collection_tasks.py:48:24
   |
47 |             sync_logger.info(
48 |                 "找到活跃实例，开始容量同步",
   |                              ^^
49 |                 module="capacity_sync",
50 |                 instance_count=len(active_instances),
   |

E501 Line too long (140 > 120)
  --> app/tasks/capacity_collection_tasks.py:69:121
   |
67 | …
68 | …]
69 | …session.session_id, instance_ids, sync_category=SyncCategory.CAPACITY.value)
   |                                                          ^^^^^^^^^^^^^^^^^^^^
70 | …
   |

G004 Logging statement uses f-string
  --> app/tasks/capacity_collection_tasks.py:88:25
   |
87 |                     sync_logger.info(
88 |                         f"开始同步实例: {instance.name} (ID: {instance.id})",
   |                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
89 |                         module="capacity_sync",
90 |                         session_id=session.session_id,
   |
help: Convert to lazy `%` formatting

PLC0415 `import` should be at the top-level of a file
  --> app/tasks/capacity_collection_tasks.py:96:21
   |
95 |                       # 调用数据库大小采集服务
96 | /                     from app.services.database_sync import (
97 | |                         DatabaseSizeCollectorService,
98 | |                     )
   | |_____________________^
99 |                       collector = DatabaseSizeCollectorService(instance)
   |

G201 Logging `.exception(...)` should be used instead of `.error(..., exc_info=True)`
   --> app/tasks/capacity_collection_tasks.py:126:41
    |
124 |                         except Exception as inventory_error:
125 |                             error_msg = f"同步数据库列表失败: {inventory_error}"
126 |                             sync_logger.error(
    |                                         ^^^^^
127 |                                 error_msg,
128 |                                 module="capacity_sync",
    |

E501 Line too long (124 > 120)
   --> app/tasks/capacity_collection_tasks.py:152:121
    |
150 | …                     items_synced=0,
151 | …                     items_created=inventory_result.get("created", 0),
152 | …                     items_updated=inventory_result.get("refreshed", 0) + inventory_result.get("reactivated", 0),
    |                                                                                                               ^^^^
153 | …                     items_deleted=inventory_result.get("deactivated", 0),
154 | …                     sync_details={
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/tasks/capacity_collection_tasks.py:173:53
    |
171 | …                         "databases": [],
172 | …                         "inventory": inventory_result,
173 | …                         "message": "未发现活跃数据库，已仅同步数据库列表",
    |                                                       ^^
174 | …                     })
175 | …                     continue
    |

G004 Logging statement uses f-string
   --> app/tasks/capacity_collection_tasks.py:203:33
    |
201 | …                     error_msg = "未采集到任何数据库大小数据"
202 | …                     sync_logger.error(
203 | …                         f"实例容量同步失败: {instance.name} - {error_msg}",
    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
204 | …                         module="capacity_sync",
205 | …                         session_id=session.session_id,
    |
help: Convert to lazy `%` formatting

G004 Logging statement uses f-string
   --> app/tasks/capacity_collection_tasks.py:250:29
    |
249 |                         sync_logger.info(
250 |                             f"实例容量同步成功: {instance.name}",
    |                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
251 |                             module="capacity_sync",
252 |                             session_id=session.session_id,
    |
help: Convert to lazy `%` formatting

G201 Logging `.exception(...)` should be used instead of `.error(..., exc_info=True)`
   --> app/tasks/capacity_collection_tasks.py:275:33
    |
273 |                 except Exception as e:
274 |                     error_msg = f"实例同步异常: {e!s}"
275 |                     sync_logger.error(
    |                                 ^^^^^
276 |                         error_msg,
277 |                         module="capacity_sync",
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/tasks/capacity_collection_tasks.py:301:57
    |
299 |             result = {
300 |                 "success": total_failed == 0,
301 |                 "message": f"容量同步完成: 成功 {total_synced} 个，失败 {total_failed} 个",
    |                                                                  ^^
302 |                 "instances_processed": total_synced,
303 |                 "total_size_mb": total_collected_size_mb,
    |

TRY300 Consider moving this statement to an `else` block
   --> app/tasks/capacity_collection_tasks.py:318:13
    |
316 |             )
317 |
318 |             return result
    |             ^^^^^^^^^^^^^
319 |
320 |         except Exception as e:
    |

G201 Logging `.exception(...)` should be used instead of `.error(..., exc_info=True)`
   --> app/tasks/capacity_collection_tasks.py:321:25
    |
320 |         except Exception as e:
321 |             sync_logger.error(
    |                         ^^^^^
322 |                 "容量同步任务执行失败",
323 |                 module="capacity_sync",
    |

C901 `collect_specific_instance_database_sizes` is too complex (11 > 10)
   --> app/tasks/capacity_collection_tasks.py:342:5
    |
342 | def collect_specific_instance_database_sizes(instance_id: int) -> dict[str, Any]:
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
343 |     """采集指定实例的数据库大小信息。.
    |

PLR0911 Too many return statements (9 > 6)
   --> app/tasks/capacity_collection_tasks.py:342:5
    |
342 | def collect_specific_instance_database_sizes(instance_id: int) -> dict[str, Any]:
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
343 |     """采集指定实例的数据库大小信息。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/tasks/capacity_collection_tasks.py:345:12
    |
343 |     """采集指定实例的数据库大小信息。.
344 |
345 |     连接到指定实例，同步数据库清单，采集容量数据并保存。
    |                   ^^
346 |     完成后自动触发当日聚合计算。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/tasks/capacity_collection_tasks.py:345:20
    |
343 |     """采集指定实例的数据库大小信息。.
344 |
345 |     连接到指定实例，同步数据库清单，采集容量数据并保存。
    |                                   ^^
346 |     完成后自动触发当日聚合计算。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/tasks/capacity_collection_tasks.py:352:15
    |
351 |     Returns:
352 |         采集结果字典，包含成功状态、数据库数量、总容量等信息。
    |                     ^^
353 |
354 |     """
    |

PLC0415 `import` should be at the top-level of a file
   --> app/tasks/capacity_collection_tasks.py:355:5
    |
354 |     """
355 |     from app import create_app
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^
356 |     from app.services.database_sync import DatabaseSizeCollectorService
    |

PLC0415 `import` should be at the top-level of a file
   --> app/tasks/capacity_collection_tasks.py:356:5
    |
354 |     """
355 |     from app import create_app
356 |     from app.services.database_sync import DatabaseSizeCollectorService
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
357 |
358 |     # 创建Flask应用上下文
    |

G201 Logging `.exception(...)` should be used instead of `.error(..., exc_info=True)`
   --> app/tasks/capacity_collection_tasks.py:397:33
    |
395 |                     inventory_result = collector.synchronize_database_inventory()
396 |                 except Exception as inventory_error:
397 |                     sync_logger.error(
    |                                 ^^^^^
398 |                         "同步数据库列表失败",
399 |                         module="capacity_sync",
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/tasks/capacity_collection_tasks.py:421:45
    |
419 |                         "instance_stat_updated": False,
420 |                         "inventory": inventory_result,
421 |                         "message": "未发现活跃数据库，已仅同步数据库列表",
    |                                                     ^^
422 |                     }
    |

G201 Logging `.exception(...)` should be used instead of `.error(..., exc_info=True)`
   --> app/tasks/capacity_collection_tasks.py:435:37
    |
433 |                         saved_count = collector.save_collected_data(databases_data)
434 |                     except Exception as save_error:
435 |                         sync_logger.error(
    |                                     ^^^^^
436 |                             "保存实例容量数据失败",
437 |                             module="capacity_sync",
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/tasks/capacity_collection_tasks.py:459:29
    |
457 |                         )
458 |
459 |                     # 更新统计聚合，确保图表与报表同步最新容量
    |                                   ^^
460 |                     try:
461 |                         from app.services.aggregation.aggregation_service import AggregationService
    |

PLC0415 `import` should be at the top-level of a file
   --> app/tasks/capacity_collection_tasks.py:461:25
    |
459 |                     # 更新统计聚合，确保图表与报表同步最新容量
460 |                     try:
461 |                         from app.services.aggregation.aggregation_service import AggregationService
    |                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
462 |
463 |                         aggregation_service = AggregationService()
    |

G201 Logging `.exception(...)` should be used instead of `.error(..., exc_info=True)`
   --> app/tasks/capacity_collection_tasks.py:467:37
    |
465 |                         aggregation_service.calculate_daily_aggregations_for_instance(instance.id)
466 |                     except Exception as agg_exc:  # pragma: no cover - 防御性日志
467 |                         sync_logger.error(
    |                                     ^^^^^
468 |                             "实例容量聚合刷新失败",
469 |                             module="capacity_sync",
    |

G201 Logging `.exception(...)` should be used instead of `.error(..., exc_info=True)`
   --> app/tasks/capacity_collection_tasks.py:496:25
    |
495 |         except Exception as e:
496 |             sync_logger.error(
    |                         ^^^^^
497 |                 "采集实例数据库大小失败",
498 |                 module="capacity_sync",
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/tasks/capacity_collection_tasks.py:514:23
    |
513 |     Args:
514 |         db_type: 数据库类型（mysql/sqlserver/postgresql/oracle）。
    |                            ^^
515 |
516 |     Returns:
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/tasks/capacity_collection_tasks.py:514:57
    |
513 |     Args:
514 |         db_type: 数据库类型（mysql/sqlserver/postgresql/oracle）。
    |                                                               ^^
515 |
516 |     Returns:
    |

PLC0415 `import` should be at the top-level of a file
   --> app/tasks/capacity_collection_tasks.py:520:5
    |
519 |     """
520 |     from app import create_app
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^
521 |
522 |     # 创建Flask应用上下文
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/tasks/capacity_collection_tasks.py:565:24
    |
563 |                     else:
564 |                         errors.append(f"实例 {instance.name}: {result['message']}")
565 |                 except Exception as e:
    |                        ^^^^^^^^^
566 |                     errors.append(f"实例 {instance.name}: {e!s}")
    |

TRY300 Consider moving this statement to an `else` block
   --> app/tasks/capacity_collection_tasks.py:568:13
    |
566 |                       errors.append(f"实例 {instance.name}: {e!s}")
567 |
568 | /             return {
569 | |                 "success": True,
570 | |                 "message": f"{db_type} 类型数据库大小采集完成",
571 | |                 "instances_processed": total_processed,
572 | |                 "total_size_mb": total_size_mb,
573 | |                 "errors": errors,
574 | |             }
    | |_____________^
575 |
576 |           except Exception as e:
    |

G201 Logging `.exception(...)` should be used instead of `.error(..., exc_info=True)`
   --> app/tasks/capacity_collection_tasks.py:577:25
    |
576 |         except Exception as e:
577 |             sync_logger.error(
    |                         ^^^^^
578 |                 "按类型采集数据库容量失败",
579 |                 module="capacity_sync",
    |

PLC0415 `import` should be at the top-level of a file
   --> app/tasks/capacity_collection_tasks.py:598:5
    |
597 |     """
598 |     from app import create_app
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^
599 |     from app.models.instance_size_stat import InstanceSizeStat
600 |     from app.utils.time_utils import time_utils
    |

PLC0415 `import` should be at the top-level of a file
   --> app/tasks/capacity_collection_tasks.py:599:5
    |
597 |     """
598 |     from app import create_app
599 |     from app.models.instance_size_stat import InstanceSizeStat
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
600 |     from app.utils.time_utils import time_utils
    |

PLC0415 `import` should be at the top-level of a file
   --> app/tasks/capacity_collection_tasks.py:600:5
    |
598 |     from app import create_app
599 |     from app.models.instance_size_stat import InstanceSizeStat
600 |     from app.utils.time_utils import time_utils
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
601 |
602 |     # 创建Flask应用上下文
    |

G201 Logging `.exception(...)` should be used instead of `.error(..., exc_info=True)`
   --> app/tasks/capacity_collection_tasks.py:629:25
    |
627 |         except Exception as e:
628 |             sync_logger = get_sync_logger()
629 |             sync_logger.error(
    |                         ^^^^^
630 |                 "获取容量采集状态失败",
631 |                 module="capacity_sync",
    |

PLC0415 `import` should be at the top-level of a file
   --> app/tasks/capacity_collection_tasks.py:658:9
    |
657 |           # 检查服务可用性
658 | /         from app.services.database_sync import (
659 | |             DatabaseSizeCollectorService,
660 | |         )
    | |_________^
661 |           DatabaseSizeCollectorService()
    |

TRY300 Consider moving this statement to an `else` block
   --> app/tasks/capacity_collection_tasks.py:663:9
    |
661 |           DatabaseSizeCollectorService()
662 |
663 | /         return {
664 | |             "success": True,
665 | |             "config": config_checks,
666 | |             "service_available": True,
667 | |             "message": "配置验证通过",
668 | |         }
    | |_________^
669 |
670 |       except Exception as e:
    |

G201 Logging `.exception(...)` should be used instead of `.error(..., exc_info=True)`
   --> app/tasks/capacity_collection_tasks.py:672:21
    |
670 |     except Exception as e:
671 |         sync_logger = get_sync_logger()
672 |         sync_logger.error(
    |                     ^^^^^
673 |             "容量采集配置验证失败",
674 |             module="capacity_sync",
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/tasks/log_cleanup_tasks.py:15:32
   |
13 |     """清理旧日志任务 - 清理30天前的日志和临时文件。.
14 |
15 |     删除 30 天前的统一日志、同步会话记录、同步实例记录，
   |                                                       ^^
16 |     并清理临时文件目录中的过期文件。
   |

PLC0415 `import` should be at the top-level of a file
  --> app/tasks/log_cleanup_tasks.py:35:13
   |
33 |             cleaned_files = _cleanup_temp_files()
34 |
35 |             from app.models.sync_instance_record import SyncInstanceRecord
   |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
36 |             from app.models.sync_session import SyncSession
   |

PLC0415 `import` should be at the top-level of a file
  --> app/tasks/log_cleanup_tasks.py:36:13
   |
35 |             from app.models.sync_instance_record import SyncInstanceRecord
36 |             from app.models.sync_session import SyncSession
   |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
37 |
38 |             deleted_sync_sessions = SyncSession.query.filter(SyncSession.created_at < cutoff_date).delete()
   |

G201 Logging `.exception(...)` should be used instead of `.error(..., exc_info=True)`
  --> app/tasks/log_cleanup_tasks.py:60:25
   |
58 |         except Exception as exc:
59 |             db.session.rollback()
60 |             task_logger.error(
   |                         ^^^^^
61 |                 "定时任务清理失败",
62 |                 module="task",
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/tasks/log_cleanup_tasks.py:73:16
   |
71 |     """清理临时文件。.
72 |
73 |     扫描日志目录和导出目录，删除 .tmp、.temp、.log.old 等临时文件。
   |                           ^^
74 |
75 |     Returns:
   |

PTH118 `os.path.join()` should be replaced by `Path` with `/` operator
  --> app/tasks/log_cleanup_tasks.py:82:19
   |
81 |     try:
82 |         log_dir = os.path.join(os.getcwd(), "userdata", "log")
   |                   ^^^^^^^^^^^^
83 |         if os.path.exists(log_dir):
84 |             for filename in os.listdir(log_dir):
   |

PTH109 `os.getcwd()` should be replaced by `Path.cwd()`
  --> app/tasks/log_cleanup_tasks.py:82:32
   |
81 |     try:
82 |         log_dir = os.path.join(os.getcwd(), "userdata", "log")
   |                                ^^^^^^^^^
83 |         if os.path.exists(log_dir):
84 |             for filename in os.listdir(log_dir):
   |
help: Replace with `Path.cwd()`

PTH110 `os.path.exists()` should be replaced by `Path.exists()`
  --> app/tasks/log_cleanup_tasks.py:83:12
   |
81 |     try:
82 |         log_dir = os.path.join(os.getcwd(), "userdata", "log")
83 |         if os.path.exists(log_dir):
   |            ^^^^^^^^^^^^^^
84 |             for filename in os.listdir(log_dir):
85 |                 if filename.endswith((".tmp", ".temp", ".log.old")):
   |
help: Replace with `Path(...).exists()`

PTH208 Use `pathlib.Path.iterdir()` instead.
  --> app/tasks/log_cleanup_tasks.py:84:29
   |
82 |         log_dir = os.path.join(os.getcwd(), "userdata", "log")
83 |         if os.path.exists(log_dir):
84 |             for filename in os.listdir(log_dir):
   |                             ^^^^^^^^^^
85 |                 if filename.endswith((".tmp", ".temp", ".log.old")):
86 |                     file_path = os.path.join(log_dir, filename)
   |

PTH118 `os.path.join()` should be replaced by `Path` with `/` operator
  --> app/tasks/log_cleanup_tasks.py:86:33
   |
84 |             for filename in os.listdir(log_dir):
85 |                 if filename.endswith((".tmp", ".temp", ".log.old")):
86 |                     file_path = os.path.join(log_dir, filename)
   |                                 ^^^^^^^^^^^^
87 |                     try:
88 |                         os.remove(file_path)
   |

PTH107 `os.remove()` should be replaced by `Path.unlink()`
  --> app/tasks/log_cleanup_tasks.py:88:25
   |
86 |                     file_path = os.path.join(log_dir, filename)
87 |                     try:
88 |                         os.remove(file_path)
   |                         ^^^^^^^^^
89 |                         cleaned_count += 1
90 |                     except OSError:
   |
help: Replace with `Path(...).unlink()`

PTH118 `os.path.join()` should be replaced by `Path` with `/` operator
  --> app/tasks/log_cleanup_tasks.py:93:22
   |
91 |                         pass
92 |
93 |         export_dir = os.path.join(os.getcwd(), "userdata", "exports")
   |                      ^^^^^^^^^^^^
94 |         if os.path.exists(export_dir):
95 |             for filename in os.listdir(export_dir):
   |

PTH109 `os.getcwd()` should be replaced by `Path.cwd()`
  --> app/tasks/log_cleanup_tasks.py:93:35
   |
91 |                         pass
92 |
93 |         export_dir = os.path.join(os.getcwd(), "userdata", "exports")
   |                                   ^^^^^^^^^
94 |         if os.path.exists(export_dir):
95 |             for filename in os.listdir(export_dir):
   |
help: Replace with `Path.cwd()`

PTH110 `os.path.exists()` should be replaced by `Path.exists()`
  --> app/tasks/log_cleanup_tasks.py:94:12
   |
93 |         export_dir = os.path.join(os.getcwd(), "userdata", "exports")
94 |         if os.path.exists(export_dir):
   |            ^^^^^^^^^^^^^^
95 |             for filename in os.listdir(export_dir):
96 |                 if filename.endswith((".tmp", ".temp")):
   |
help: Replace with `Path(...).exists()`

PTH208 Use `pathlib.Path.iterdir()` instead.
  --> app/tasks/log_cleanup_tasks.py:95:29
   |
93 |         export_dir = os.path.join(os.getcwd(), "userdata", "exports")
94 |         if os.path.exists(export_dir):
95 |             for filename in os.listdir(export_dir):
   |                             ^^^^^^^^^^
96 |                 if filename.endswith((".tmp", ".temp")):
97 |                     file_path = os.path.join(export_dir, filename)
   |

PTH118 `os.path.join()` should be replaced by `Path` with `/` operator
  --> app/tasks/log_cleanup_tasks.py:97:33
   |
95 |             for filename in os.listdir(export_dir):
96 |                 if filename.endswith((".tmp", ".temp")):
97 |                     file_path = os.path.join(export_dir, filename)
   |                                 ^^^^^^^^^^^^
98 |                     try:
99 |                         os.remove(file_path)
   |

PTH107 `os.remove()` should be replaced by `Path.unlink()`
   --> app/tasks/log_cleanup_tasks.py:99:25
    |
 97 |                     file_path = os.path.join(export_dir, filename)
 98 |                     try:
 99 |                         os.remove(file_path)
    |                         ^^^^^^^^^
100 |                         cleaned_count += 1
101 |                     except OSError:
    |
help: Replace with `Path(...).unlink()`

BLE001 Do not catch blind exception: `Exception`
   --> app/tasks/log_cleanup_tasks.py:104:12
    |
102 |                         pass
103 |
104 |     except Exception as exc:
    |            ^^^^^^^^^
105 |         get_task_logger().warning(f"清理临时文件时出错: {exc}")
    |

D205 1 blank line required between summary line and description
 --> app/tasks/partition_management_tasks.py:1:1
  |
1 | / """分区管理定时任务
2 | | 负责自动创建、清理和监控数据库大小统计表的分区.
3 | | """
  | |___^
4 |
5 |   from __future__ import annotations
  |
help: Insert single blank line

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/tasks/partition_management_tasks.py:21:24
   |
20 | def _as_app_error(error: Exception) -> AppError:
21 |     """确保返回 AppError 实例，便于统一错误上下文。.
   |                              ^^
22 |
23 |     Args:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/tasks/partition_management_tasks.py:27:37
   |
26 |     Returns:
27 |         AppError: 若已是 AppError 则原样返回，否则包装为 DatabaseError。
   |                                             ^^
28 |
29 |     """
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/tasks/partition_management_tasks.py:36:15
   |
34 |     """创建数据库大小统计表的分区。.
35 |
36 |     每天凌晨 2 点执行，创建未来 3 个月的分区，确保数据有足够的存储空间。
   |                      ^^
37 |
38 |     Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/tasks/partition_management_tasks.py:36:28
   |
34 |     """创建数据库大小统计表的分区。.
35 |
36 |     每天凌晨 2 点执行，创建未来 3 个月的分区，确保数据有足够的存储空间。
   |                                             ^^
37 |
38 |     Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/tasks/partition_management_tasks.py:39:20
   |
38 |     Returns:
39 |         包含分区创建结果的字典，包括处理的月份数和创建的分区列表。
   |                               ^^
40 |
41 |     """
   |

TRY300 Consider moving this statement to an `else` block
  --> app/tasks/partition_management_tasks.py:56:9
   |
54 |             message="分区创建任务已完成",
55 |         )
56 |         return payload
   |         ^^^^^^^^^^^^^^
57 |     except Exception as exc:
58 |         app_error = _as_app_error(exc)
   |

BLE001 Do not catch blind exception: `Exception`
  --> app/tasks/partition_management_tasks.py:57:12
   |
55 |         )
56 |         return payload
57 |     except Exception as exc:
   |            ^^^^^^^^^
58 |         app_error = _as_app_error(exc)
59 |         log_error("分区创建任务失败", module=MODULE, exception=exc)
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/tasks/partition_management_tasks.py:67:15
   |
65 |     """清理数据库大小统计表的旧分区。.
66 |
67 |     每天凌晨 3 点执行，清理保留期外的分区，释放存储空间。
   |                      ^^
68 |     保留期由配置项 DATABASE_SIZE_RETENTION_MONTHS 控制，默认 12 个月。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/tasks/partition_management_tasks.py:67:25
   |
65 |     """清理数据库大小统计表的旧分区。.
66 |
67 |     每天凌晨 3 点执行，清理保留期外的分区，释放存储空间。
   |                                          ^^
68 |     保留期由配置项 DATABASE_SIZE_RETENTION_MONTHS 控制，默认 12 个月。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/tasks/partition_management_tasks.py:68:46
   |
67 |     每天凌晨 3 点执行，清理保留期外的分区，释放存储空间。
68 |     保留期由配置项 DATABASE_SIZE_RETENTION_MONTHS 控制，默认 12 个月。
   |                                                       ^^
69 |
70 |     Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/tasks/partition_management_tasks.py:71:18
   |
70 |     Returns:
71 |         包含清理结果的字典，包括截止日期和删除的分区列表。
   |                           ^^
72 |
73 |     """
   |

TRY300 Consider moving this statement to an `else` block
  --> app/tasks/partition_management_tasks.py:93:9
   |
91 |             message="旧分区清理任务已完成",
92 |         )
93 |         return payload
   |         ^^^^^^^^^^^^^^
94 |     except Exception as exc:
95 |         app_error = _as_app_error(exc)
   |

BLE001 Do not catch blind exception: `Exception`
  --> app/tasks/partition_management_tasks.py:94:12
   |
92 |         )
93 |         return payload
94 |     except Exception as exc:
   |            ^^^^^^^^^
95 |         app_error = _as_app_error(exc)
96 |         log_error("旧分区清理任务失败", module=MODULE, exception=exc)
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/tasks/partition_management_tasks.py:104:12
    |
102 |     """监控分区健康状态。.
103 |
104 |     每小时执行一次，检查分区状态和容量。如果发现下个月的分区不存在，
    |                   ^^
105 |     会自动尝试创建。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/tasks/partition_management_tasks.py:104:36
    |
102 |     """监控分区健康状态。.
103 |
104 |     每小时执行一次，检查分区状态和容量。如果发现下个月的分区不存在，
    |                                                                   ^^
105 |     会自动尝试创建。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/tasks/partition_management_tasks.py:108:20
    |
107 |     Returns:
108 |         包含分区健康状态的字典，包括分区数量、总大小、记录数等信息。
    |                               ^^
109 |
110 |     """
    |

DTZ011 `datetime.date.today()` used
   --> app/tasks/partition_management_tasks.py:118:24
    |
116 |         stats = stats_service.get_partition_statistics()
117 |
118 |         current_date = date.today()
    |                        ^^^^^^^^^^^^
119 |         next_month = (current_date.replace(day=1) + timedelta(days=32)).replace(day=1)
120 |         from app.utils.time_utils import time_utils
    |
help: Use `datetime.datetime.now(tz=...).date()` instead

PLC0415 `import` should be at the top-level of a file
   --> app/tasks/partition_management_tasks.py:120:9
    |
118 |         current_date = date.today()
119 |         next_month = (current_date.replace(day=1) + timedelta(days=32)).replace(day=1)
120 |         from app.utils.time_utils import time_utils
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
121 |         next_partition_name = f"database_size_stats_{time_utils.format_china_time(next_month, '%Y_%m')}"
122 |         partitions = partition_info["partitions"]
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/tasks/partition_management_tasks.py:128:26
    |
126 |         if not exists:
127 |             log_warning(
128 |                 "下个月分区不存在，尝试自动创建",
    |                                  ^^
129 |                 module=MODULE,
130 |                 partition_name=next_partition_name,
    |

TRY300 Consider moving this statement to an `else` block
   --> app/tasks/partition_management_tasks.py:158:9
    |
156 |             message="分区健康监控完成",
157 |         )
158 |         return payload
    |         ^^^^^^^^^^^^^^
159 |     except Exception as exc:
160 |         app_error = _as_app_error(exc)
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/tasks/partition_management_tasks.py:159:12
    |
157 |         )
158 |         return payload
159 |     except Exception as exc:
    |            ^^^^^^^^^
160 |         app_error = _as_app_error(exc)
161 |         log_error("分区健康监控任务失败", module=MODULE, exception=exc)
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/tasks/partition_management_tasks.py:167:16
    |
166 | def get_partition_management_status() -> dict[str, object]:
167 |     """获取分区管理状态，用于 API 接口和监控页面。.
    |                        ^^
168 |
169 |     Returns:
    |

DTZ011 `datetime.date.today()` used
   --> app/tasks/partition_management_tasks.py:182:24
    |
181 |         partitions = partition_info["partitions"]
182 |         current_date = date.today()
    |                        ^^^^^^^^^^^^
183 |
184 |         required_partitions: list[str] = []
    |
help: Use `datetime.datetime.now(tz=...).date()` instead

BLE001 Do not catch blind exception: `Exception`
   --> app/tasks/partition_management_tasks.py:201:12
    |
199 |             "partitions": partitions,
200 |         }
201 |     except Exception as exc:
    |            ^^^^^^^^^
202 |         app_error = _as_app_error(exc)
203 |         log_error("获取分区管理状态失败", module=MODULE, exception=exc)
    |

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
   --> app/tasks/partition_management_tasks.py:204:9
    |
202 |         app_error = _as_app_error(exc)
203 |         log_error("获取分区管理状态失败", module=MODULE, exception=exc)
204 |         raise app_error
    |         ^^^^^^^^^^^^^^^
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/utils/__init__.py:3:14
  |
1 | """工具模块。.
2 |
3 | 包含各种实用工具和辅助函数，提供通用的功能支持。
  |                           ^^
4 |
5 | 主要工具：
  |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
 --> app/utils/__init__.py:5:5
  |
3 | 包含各种实用工具和辅助函数，提供通用的功能支持。
4 |
5 | 主要工具：
  |         ^^
6 | - data_validator: 数据验证工具
7 | - time_utils: 时间处理工具
  |

D205 1 blank line required between summary line and description
 --> app/utils/cache_utils.py:1:1
  |
1 | / """鲸落 - 缓存管理工具
2 | | 基于Flask-Caching的通用缓存管理器，提供装饰器和通用缓存功能.
3 | | """
  | |___^
4 |
5 |   import hashlib
  |
help: Insert single blank line

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/utils/cache_utils.py:2:24
  |
1 | """鲸落 - 缓存管理工具
2 | 基于Flask-Caching的通用缓存管理器，提供装饰器和通用缓存功能.
  |                                  ^^
3 | """
  |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/cache_utils.py:19:30
   |
17 |     """缓存管理器。.
18 |
19 |     基于 Flask-Caching 的通用缓存管理器，提供缓存的增删改查和装饰器功能。
   |                                        ^^
20 |
21 |     Attributes:
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/utils/cache_utils.py:23:32
   |
21 |     Attributes:
22 |         cache: Flask-Caching 实例。
23 |         default_timeout: 默认超时时间（秒），默认 300 秒。
   |                                      ^^
24 |         system_logger: 系统日志记录器。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/utils/cache_utils.py:23:34
   |
21 |     Attributes:
22 |         cache: Flask-Caching 实例。
23 |         default_timeout: 默认超时时间（秒），默认 300 秒。
   |                                          ^^
24 |         system_logger: 系统日志记录器。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/cache_utils.py:23:35
   |
21 |     Attributes:
22 |         cache: Flask-Caching 实例。
23 |         default_timeout: 默认超时时间（秒），默认 300 秒。
   |                                            ^^
24 |         system_logger: 系统日志记录器。
   |

D107 Missing docstring in `__init__`
  --> app/utils/cache_utils.py:28:9
   |
26 |     """
27 |
28 |     def __init__(self, cache: Cache) -> None:
   |         ^^^^^^^^
29 |         self.cache = cache
30 |         self.default_timeout = 300  # 5分钟默认超时
   |

ANN002 Missing type annotation for `*args`
  --> app/utils/cache_utils.py:33:42
   |
31 |         self.system_logger = get_system_logger()
32 |
33 |     def _generate_key(self, prefix: str, *args, **kwargs: Any) -> str:
   |                                          ^^^^^
34 |         """生成缓存键。.
   |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `**kwargs`
  --> app/utils/cache_utils.py:33:59
   |
31 |         self.system_logger = get_system_logger()
32 |
33 |     def _generate_key(self, prefix: str, *args, **kwargs: Any) -> str:
   |                                                           ^^^
34 |         """生成缓存键。.
   |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/utils/cache_utils.py:51:16
   |
49 |         key_string = json.dumps(key_data, sort_keys=True, default=str)
50 |
51 |         # 生成哈希值（使用SHA256替代MD5）
   |                     ^^
52 |         key_hash = hashlib.sha256(key_string.encode()).hexdigest()
   |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/utils/cache_utils.py:51:30
   |
49 |         key_string = json.dumps(key_data, sort_keys=True, default=str)
50 |
51 |         # 生成哈希值（使用SHA256替代MD5）
   |                                        ^^
52 |         key_hash = hashlib.sha256(key_string.encode()).hexdigest()
   |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `get`
  --> app/utils/cache_utils.py:56:32
   |
54 |         return f"{prefix}:{key_hash}"
55 |
56 |     def get(self, key: str) -> Any | None:
   |                                ^^^^^^^^^^
57 |         """获取缓存值。.
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/cache_utils.py:63:16
   |
62 |         Returns:
63 |             缓存值，如果不存在或获取失败返回 None。
   |                   ^^
64 |
65 |         """
   |

BLE001 Do not catch blind exception: `Exception`
  --> app/utils/cache_utils.py:68:16
   |
66 |         try:
67 |             return self.cache.get(key)
68 |         except Exception as e:
   |                ^^^^^^^^^
69 |             self.system_logger.warning("获取缓存失败", module="cache", key=key, exception=str(e))
70 |             return None
   |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `value`
  --> app/utils/cache_utils.py:72:36
   |
70 |             return None
71 |
72 |     def set(self, key: str, value: Any, timeout: int | None = None) -> bool:
   |                                    ^^^
73 |         """设置缓存值。.
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/utils/cache_utils.py:78:26
   |
76 |             key: 缓存键。
77 |             value: 缓存值。
78 |             timeout: 超时时间（秒），默认使用 default_timeout。
   |                              ^^
79 |
80 |         Returns:
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/utils/cache_utils.py:78:28
   |
76 |             key: 缓存键。
77 |             value: 缓存值。
78 |             timeout: 超时时间（秒），默认使用 default_timeout。
   |                                  ^^
79 |
80 |         Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/cache_utils.py:78:29
   |
76 |             key: 缓存键。
77 |             value: 缓存值。
78 |             timeout: 超时时间（秒），默认使用 default_timeout。
   |                                    ^^
79 |
80 |         Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/cache_utils.py:81:24
   |
80 |         Returns:
81 |             设置成功返回 True，失败返回 False。
   |                              ^^
82 |
83 |         """
   |

TRY300 Consider moving this statement to an `else` block
  --> app/utils/cache_utils.py:87:13
   |
85 |             timeout = timeout or self.default_timeout
86 |             self.cache.set(key, value, timeout=timeout)
87 |             return True
   |             ^^^^^^^^^^^
88 |         except Exception as e:
89 |             self.system_logger.warning("设置缓存失败", module="cache", key=key, exception=str(e))
   |

BLE001 Do not catch blind exception: `Exception`
  --> app/utils/cache_utils.py:88:16
   |
86 |             self.cache.set(key, value, timeout=timeout)
87 |             return True
88 |         except Exception as e:
   |                ^^^^^^^^^
89 |             self.system_logger.warning("设置缓存失败", module="cache", key=key, exception=str(e))
90 |             return False
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/cache_utils.py:99:24
    |
 98 |         Returns:
 99 |             删除成功返回 True，失败返回 False。
    |                              ^^
100 |
101 |         """
    |

TRY300 Consider moving this statement to an `else` block
   --> app/utils/cache_utils.py:104:13
    |
102 |         try:
103 |             self.cache.delete(key)
104 |             return True
    |             ^^^^^^^^^^^
105 |         except Exception:
106 |             self.system_logger.warning("删除缓存失败: {key}, 错误: {e}")
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/utils/cache_utils.py:105:16
    |
103 |             self.cache.delete(key)
104 |             return True
105 |         except Exception:
    |                ^^^^^^^^^
106 |             self.system_logger.warning("删除缓存失败: {key}, 错误: {e}")
107 |             return False
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/cache_utils.py:113:22
    |
112 |         Returns:
113 |             成功返回 True，失败返回 False。
    |                          ^^
114 |
115 |         """
    |

TRY300 Consider moving this statement to an `else` block
   --> app/utils/cache_utils.py:118:13
    |
116 |         try:
117 |             self.cache.clear()
118 |             return True
    |             ^^^^^^^^^^^
119 |         except Exception:
120 |             self.system_logger.warning("清空缓存失败: {e}")
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/utils/cache_utils.py:119:16
    |
117 |             self.cache.clear()
118 |             return True
119 |         except Exception:
    |                ^^^^^^^^^
120 |             self.system_logger.warning("清空缓存失败: {e}")
121 |             return False
    |

ANN002 Missing type annotation for `*args`
   --> app/utils/cache_utils.py:123:80
    |
121 |             return False
122 |
123 |     def get_or_set(self, key: str, func: Callable, timeout: int | None = None, *args, **kwargs: Any) -> Any:
    |                                                                                ^^^^^
124 |         """获取缓存值，如果不存在则调用函数生成并写入。.
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `**kwargs`
   --> app/utils/cache_utils.py:123:97
    |
121 |             return False
122 |
123 |     def get_or_set(self, key: str, func: Callable, timeout: int | None = None, *args, **kwargs: Any) -> Any:
    |                                                                                                 ^^^
124 |         """获取缓存值，如果不存在则调用函数生成并写入。.
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `get_or_set`
   --> app/utils/cache_utils.py:123:105
    |
121 |             return False
122 |
123 |     def get_or_set(self, key: str, func: Callable, timeout: int | None = None, *args, **kwargs: Any) -> Any:
    |                                                                                                         ^^^
124 |         """获取缓存值，如果不存在则调用函数生成并写入。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/cache_utils.py:124:17
    |
123 |     def get_or_set(self, key: str, func: Callable, timeout: int | None = None, *args, **kwargs: Any) -> Any:
124 |         """获取缓存值，如果不存在则调用函数生成并写入。.
    |                      ^^
125 |
126 |         Args:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/cache_utils.py:129:28
    |
127 |             key: 缓存键。
128 |             func: 当缓存缺失时执行的回调。
129 |             timeout: 缓存超时时间，None 表示使用默认值。
    |                                  ^^
130 |             *args: 传递给回调的可变位置参数。
131 |             **kwargs: 传递给回调的关键字参数。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/cache_utils.py:150:21
    |
149 |         Returns:
150 |             实际删除的键数量，不支持模式删除时返回 0。
    |                             ^^
151 |
152 |         """
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/cache_utils.py:155:26
    |
153 |         try:
154 |             # 这里需要根据具体的缓存后端实现
155 |             # Redis支持模式匹配，其他后端可能需要遍历
    |                                ^^
156 |             if hasattr(self.cache.cache, "delete_pattern"):
157 |                 return self.cache.cache.delete_pattern(pattern)
    |

TRY300 Consider moving this statement to an `else` block
   --> app/utils/cache_utils.py:159:13
    |
157 |                 return self.cache.cache.delete_pattern(pattern)
158 |             self.system_logger.warning("当前缓存后端不支持模式删除")
159 |             return 0
    |             ^^^^^^^^
160 |         except Exception:
161 |             self.system_logger.warning("模式删除缓存失败: {pattern}, 错误: {e}")
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/utils/cache_utils.py:160:16
    |
158 |             self.system_logger.warning("当前缓存后端不支持模式删除")
159 |             return 0
160 |         except Exception:
    |                ^^^^^^^^^
161 |             self.system_logger.warning("模式删除缓存失败: {pattern}, 错误: {e}")
162 |             return 0
    |

PLW0603 Using the global statement to update `cache_manager` is discouraged
   --> app/utils/cache_utils.py:179:12
    |
178 |     """
179 |     global cache_manager
    |            ^^^^^^^^^^^^^
180 |     cache_manager = CacheManager(cache)
181 |     system_logger = get_system_logger()
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/cache_utils.py:191:13
    |
189 |     key_func: Callable | None = None,
190 | ) -> Callable:
191 |     """缓存装饰器，自动复用函数返回值。.
    |                  ^^
192 |
193 |     Args:
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/utils/cache_utils.py:194:24
    |
193 |     Args:
194 |         timeout: 缓存超时时间（秒）。
    |                              ^^
195 |         key_prefix: 键前缀，用于区分不同函数。
196 |         unless: 条件函数，返回 True 时跳过缓存。
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/utils/cache_utils.py:194:26
    |
193 |     Args:
194 |         timeout: 缓存超时时间（秒）。
    |                                  ^^
195 |         key_prefix: 键前缀，用于区分不同函数。
196 |         unless: 条件函数，返回 True 时跳过缓存。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/cache_utils.py:195:24
    |
193 |     Args:
194 |         timeout: 缓存超时时间（秒）。
195 |         key_prefix: 键前缀，用于区分不同函数。
    |                           ^^
196 |         unless: 条件函数，返回 True 时跳过缓存。
197 |         key_func: 自定义缓存键生成函数。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/cache_utils.py:196:21
    |
194 |         timeout: 缓存超时时间（秒）。
195 |         key_prefix: 键前缀，用于区分不同函数。
196 |         unless: 条件函数，返回 True 时跳过缓存。
    |                         ^^
197 |         key_func: 自定义缓存键生成函数。
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `*args`
   --> app/utils/cache_utils.py:206:39
    |
204 |     def cache_decorator(f: Callable) -> Callable:
205 |         @wraps(f)
206 |         def decorated_function(*args: "Any", **kwargs: "Any") -> "Any":
    |                                       ^^^^^
207 |             # 检查是否跳过缓存
208 |             if unless and unless():
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `**kwargs`
   --> app/utils/cache_utils.py:206:56
    |
204 |     def cache_decorator(f: Callable) -> Callable:
205 |         @wraps(f)
206 |         def decorated_function(*args: "Any", **kwargs: "Any") -> "Any":
    |                                                        ^^^^^
207 |             # 检查是否跳过缓存
208 |             if unless and unless():
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `decorated_function`
   --> app/utils/cache_utils.py:206:66
    |
204 |     def cache_decorator(f: Callable) -> Callable:
205 |         @wraps(f)
206 |         def decorated_function(*args: "Any", **kwargs: "Any") -> "Any":
    |                                                                  ^^^^^
207 |             # 检查是否跳过缓存
208 |             if unless and unless():
    |

SLF001 Private member accessed: `_generate_key`
   --> app/utils/cache_utils.py:215:29
    |
213 |                 cache_key = key_func(*args, **kwargs)
214 |             else:
215 |                 cache_key = cache_manager._generate_key(f"{key_prefix}:{f.__name__}", *args, **kwargs)
    |                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
216 |
217 |             # 尝试获取缓存
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/cache_utils.py:238:16
    |
237 | def dashboard_cache(timeout: int = 60) -> Callable:
238 |     """仪表板缓存装饰器，绑定统一前缀。.
    |                        ^^
239 |
240 |     Args:
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/utils/cache_utils.py:241:24
    |
240 |     Args:
241 |         timeout: 缓存超时时间（秒），默认为 1 分钟。
    |                              ^^
242 |
243 |     Returns:
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/utils/cache_utils.py:241:26
    |
240 |     Args:
241 |         timeout: 缓存超时时间（秒），默认为 1 分钟。
    |                                  ^^
242 |
243 |     Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/cache_utils.py:241:27
    |
240 |     Args:
241 |         timeout: 缓存超时时间（秒），默认为 1 分钟。
    |                                    ^^
242 |
243 |     Returns:
    |

D205 1 blank line required between summary line and description
 --> app/utils/data_validator.py:1:1
  |
1 | / """数据验证工具类
2 | | 提供严格的数据验证功能，防止无效数据进入系统.
3 | | """
  | |___^
4 |
5 |   import html
  |
help: Insert single blank line

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/utils/data_validator.py:2:12
  |
1 | """数据验证工具类
2 | 提供严格的数据验证功能，防止无效数据进入系统.
  |                       ^^
3 | """
  |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/data_validator.py:18:16
   |
16 |     """数据验证器。.
17 |
18 |     提供严格的数据验证功能，防止无效数据进入系统。
   |                           ^^
19 |     支持实例数据、批量数据、表单数据的验证和清理。
   |

RUF012 Mutable class attributes should be annotated with `typing.ClassVar`
  --> app/utils/data_validator.py:34:26
   |
33 |     # 支持的数据库类型
34 |     SUPPORTED_DB_TYPES = ["mysql", "postgresql", "sqlserver", "oracle", "sqlite"]
   |                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
35 |
36 |     # 支持的凭据类型
   |

RUF012 Mutable class attributes should be annotated with `typing.ClassVar`
  --> app/utils/data_validator.py:37:34
   |
36 |     # 支持的凭据类型
37 |     SUPPORTED_CREDENTIAL_TYPES = ["database", "ssh", "windows", "api", "ldap"]
   |                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
38 |     _custom_db_types: set[str] | None = None
   |

C901 `validate_instance_data` is too complex (14 > 10)
  --> app/utils/data_validator.py:51:9
   |
50 |     @classmethod
51 |     def validate_instance_data(cls, data: dict[str, Any]) -> tuple[bool, str | None]:
   |         ^^^^^^^^^^^^^^^^^^^^^^
52 |         """验证实例数据。.
   |

PLR0911 Too many return statements (10 > 6)
  --> app/utils/data_validator.py:51:9
   |
50 |     @classmethod
51 |     def validate_instance_data(cls, data: dict[str, Any]) -> tuple[bool, str | None]:
   |         ^^^^^^^^^^^^^^^^^^^^^^
52 |         """验证实例数据。.
   |

PLR0912 Too many branches (13 > 12)
  --> app/utils/data_validator.py:51:9
   |
50 |     @classmethod
51 |     def validate_instance_data(cls, data: dict[str, Any]) -> tuple[bool, str | None]:
   |         ^^^^^^^^^^^^^^^^^^^^^^
52 |         """验证实例数据。.
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/data_validator.py:54:25
   |
52 |         """验证实例数据。.
53 |
54 |         验证实例的所有必填字段和可选字段，包括名称、数据库类型、
   |                                         ^^
55 |         主机地址、端口号、数据库名称、描述和凭据ID。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/data_validator.py:58:25
   |
57 |         Args:
58 |             data: 实例数据字典，包含实例的各项配置信息。
   |                               ^^
59 |
60 |         Returns:
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/utils/data_validator.py:61:22
   |
60 |         Returns:
61 |             包含两个元素的元组：
   |                               ^^
62 |             - 是否有效（True/False）
63 |             - 错误信息（验证失败时返回具体错误，成功时返回 None）
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/utils/data_validator.py:62:19
   |
60 |         Returns:
61 |             包含两个元素的元组：
62 |             - 是否有效（True/False）
   |                       ^^
63 |             - 错误信息（验证失败时返回具体错误，成功时返回 None）
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/utils/data_validator.py:62:30
   |
60 |         Returns:
61 |             包含两个元素的元组：
62 |             - 是否有效（True/False）
   |                                   ^^
63 |             - 错误信息（验证失败时返回具体错误，成功时返回 None）
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/utils/data_validator.py:63:19
   |
61 |             包含两个元素的元组：
62 |             - 是否有效（True/False）
63 |             - 错误信息（验证失败时返回具体错误，成功时返回 None）
   |                       ^^
64 |
65 |         """
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/data_validator.py:63:31
   |
61 |             包含两个元素的元组：
62 |             - 是否有效（True/False）
63 |             - 错误信息（验证失败时返回具体错误，成功时返回 None）
   |                                               ^^
64 |
65 |         """
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/utils/data_validator.py:63:42
   |
61 |             包含两个元素的元组：
62 |             - 是否有效（True/False）
63 |             - 错误信息（验证失败时返回具体错误，成功时返回 None）
   |                                                                ^^
64 |
65 |         """
   |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/utils/data_validator.py:93:22
   |
91 |                 return False, port_error
92 |
93 |             # 验证数据库名称（可选）
   |                             ^^
94 |             if data.get("database_name"):
95 |                 db_name_error = cls._validate_database_name(data.get("database_name"))
   |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/utils/data_validator.py:93:25
   |
91 |                 return False, port_error
92 |
93 |             # 验证数据库名称（可选）
   |                                   ^^
94 |             if data.get("database_name"):
95 |                 db_name_error = cls._validate_database_name(data.get("database_name"))
   |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/utils/data_validator.py:99:19
    |
 97 |                     return False, db_name_error
 98 |
 99 |             # 验证描述（可选）
    |                       ^^
100 |             if data.get("description"):
101 |                 desc_error = cls._validate_description(data.get("description"))
    |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/utils/data_validator.py:99:22
    |
 97 |                     return False, db_name_error
 98 |
 99 |             # 验证描述（可选）
    |                             ^^
100 |             if data.get("description"):
101 |                 desc_error = cls._validate_description(data.get("description"))
    |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/utils/data_validator.py:105:21
    |
103 |                     return False, desc_error
104 |
105 |             # 验证凭据ID（可选）
    |                         ^^
106 |             if data.get("credential_id"):
107 |                 cred_error = cls._validate_credential_id(data.get("credential_id"))
    |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/utils/data_validator.py:105:24
    |
103 |                     return False, desc_error
104 |
105 |             # 验证凭据ID（可选）
    |                               ^^
106 |             if data.get("credential_id"):
107 |                 cred_error = cls._validate_credential_id(data.get("credential_id"))
    |

TRY300 Consider moving this statement to an `else` block
   --> app/utils/data_validator.py:111:13
    |
109 |                     return False, cred_error
110 |
111 |             return True, None
    |             ^^^^^^^^^^^^^^^^^
112 |
113 |         except Exception as e:
    |

G004 Logging statement uses f-string
   --> app/utils/data_validator.py:114:30
    |
113 |         except Exception as e:
114 |             logger.exception(f"数据验证过程中发生错误: {e!s}")
    |                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
115 |             return False, f"数据验证失败: {e!s}"
    |
help: Convert to lazy `%` formatting

TRY401 Redundant exception object included in `logging.exception` call
   --> app/utils/data_validator.py:114:46
    |
113 |         except Exception as e:
114 |             logger.exception(f"数据验证过程中发生错误: {e!s}")
    |                                                         ^
115 |             return False, f"数据验证失败: {e!s}"
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `name`
   --> app/utils/data_validator.py:118:35
    |
117 |     @classmethod
118 |     def _validate_name(cls, name: Any) -> str | None:
    |                                   ^^^
119 |         """验证实例名称并返回错误信息。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/data_validator.py:122:28
    |
121 |         Args:
122 |             name: 前端提交的实例名称，可能为空或包含非法字符。
    |                                     ^^
123 |
124 |         Returns:
    |

RUF002 Docstring contains ambiguous `；` (FULLWIDTH SEMICOLON). Did you mean `;` (SEMICOLON)?
   --> app/utils/data_validator.py:125:20
    |
124 |         Returns:
125 |             字符串错误提示；若名称合法则返回 None。
    |                           ^^
126 |
127 |         """
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `db_type`
   --> app/utils/data_validator.py:145:41
    |
144 |     @classmethod
145 |     def _validate_db_type(cls, db_type: Any) -> str | None:
    |                                         ^^^
146 |         """验证数据库类型是否在受支持范围。.
    |

RUF002 Docstring contains ambiguous `；` (FULLWIDTH SEMICOLON). Did you mean `;` (SEMICOLON)?
   --> app/utils/data_validator.py:152:20
    |
151 |         Returns:
152 |             字符串错误提示；若数据库类型有效则返回 None。
    |                           ^^
153 |
154 |         """
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `host`
   --> app/utils/data_validator.py:166:35
    |
165 |     @classmethod
166 |     def _validate_host(cls, host: Any) -> str | None:
    |                                   ^^^
167 |         """验证主机地址格式。.
    |

RUF002 Docstring contains ambiguous `；` (FULLWIDTH SEMICOLON). Did you mean `;` (SEMICOLON)?
   --> app/utils/data_validator.py:173:20
    |
172 |         Returns:
173 |             字符串错误提示；若主机格式正确则返回 None。
    |                           ^^
174 |
175 |         """
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/data_validator.py:188:29
    |
186 |         # 验证IP地址或域名格式
187 |         if not cls._is_valid_host(host):
188 |             return "主机地址格式无效，请输入有效的IP地址或域名"
    |                                     ^^
189 |
190 |         return None
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `port`
   --> app/utils/data_validator.py:193:35
    |
192 |     @classmethod
193 |     def _validate_port(cls, port: Any) -> str | None:
    |                                   ^^^
194 |         """验证端口号是否处于允许范围。.
    |

RUF002 Docstring contains ambiguous `；` (FULLWIDTH SEMICOLON). Did you mean `;` (SEMICOLON)?
   --> app/utils/data_validator.py:200:20
    |
199 |         Returns:
200 |             字符串错误提示；若端口合法则返回 None。
    |                           ^^
201 |
202 |         """
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `db_name`
   --> app/utils/data_validator.py:214:47
    |
213 |     @classmethod
214 |     def _validate_database_name(cls, db_name: Any) -> str | None:
    |                                               ^^^
215 |         """验证数据库名称长度与字符集合。.
    |

RUF002 Docstring contains ambiguous `；` (FULLWIDTH SEMICOLON). Did you mean `;` (SEMICOLON)?
   --> app/utils/data_validator.py:221:20
    |
220 |         Returns:
221 |             字符串错误提示；若名称满足规范则返回 None。
    |                           ^^
222 |
223 |         """
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `description`
   --> app/utils/data_validator.py:241:49
    |
240 |     @classmethod
241 |     def _validate_description(cls, description: Any) -> str | None:
    |                                                 ^^^
242 |         """验证描述字段长度。.
    |

RUF002 Docstring contains ambiguous `；` (FULLWIDTH SEMICOLON). Did you mean `;` (SEMICOLON)?
   --> app/utils/data_validator.py:248:20
    |
247 |         Returns:
248 |             字符串错误提示；若描述合法则返回 None。
    |                           ^^
249 |
250 |         """
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `credential_id`
   --> app/utils/data_validator.py:261:53
    |
260 |     @classmethod
261 |     def _validate_credential_id(cls, credential_id: Any) -> str | None:
    |                                                     ^^^
262 |         """验证凭据 ID 是否为正整数。.
    |

RUF002 Docstring contains ambiguous `；` (FULLWIDTH SEMICOLON). Did you mean `;` (SEMICOLON)?
   --> app/utils/data_validator.py:268:20
    |
267 |         Returns:
268 |             字符串错误提示；若 ID 有效则返回 None。
    |                           ^^
269 |
270 |         """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/data_validator.py:288:32
    |
287 |         Returns:
288 |             True 表示格式匹配 IP/域名规范，否则为 False。
    |                                          ^^
289 |
290 |         """
    |

PLR2004 Magic value used in comparison, consider replacing `255` with a constant variable
   --> app/utils/data_validator.py:295:42
    |
293 |         if re.match(ip_pattern, host):
294 |             parts = host.split(".")
295 |             return all(0 <= int(part) <= 255 for part in parts)
    |                                          ^^^
296 |
297 |         # 检查域名格式
    |

E501 Line too long (123 > 120)
   --> app/utils/data_validator.py:298:121
    |
297 |         # 检查域名格式
298 |         domain_pattern = r"^[a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?(\.[a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?)*$"
    |                                                                                                                         ^^^
299 |         return bool(re.match(domain_pattern, host))
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/data_validator.py:305:23
    |
303 |         """验证批量数据。.
304 |
305 |         对数据列表中的每一项进行验证，返回有效数据和错误信息。
    |                                     ^^
306 |
307 |         Args:
    |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/utils/data_validator.py:311:22
    |
310 |         Returns:
311 |             包含两个元素的元组：
    |                               ^^
312 |             - 有效数据列表
313 |             - 错误信息列表（包含每条无效数据的错误描述）
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/utils/data_validator.py:313:21
    |
311 |             包含两个元素的元组：
312 |             - 有效数据列表
313 |             - 错误信息列表（包含每条无效数据的错误描述）
    |                           ^^
314 |
315 |         """
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/utils/data_validator.py:313:35
    |
311 |             包含两个元素的元组：
312 |             - 有效数据列表
313 |             - 错误信息列表（包含每条无效数据的错误描述）
    |                                                       ^^
314 |
315 |         """
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `value`
   --> app/utils/data_validator.py:329:37
    |
328 |     @classmethod
329 |     def sanitize_string(cls, value: Any) -> str:
    |                                     ^^^
330 |         """清理字符串，移除潜在的危险内容。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/data_validator.py:330:17
    |
328 |     @classmethod
329 |     def sanitize_string(cls, value: Any) -> str:
330 |         """清理字符串，移除潜在的危险内容。.
    |                      ^^
331 |
332 |         对输入字符串进行 HTML 转义，并移除常见的 XSS 攻击模式。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/data_validator.py:332:25
    |
330 |         """清理字符串，移除潜在的危险内容。.
331 |
332 |         对输入字符串进行 HTML 转义，并移除常见的 XSS 攻击模式。
    |                                   ^^
333 |
334 |         Args:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/data_validator.py:335:23
    |
334 |         Args:
335 |             value: 原始值，可以是任意类型。
    |                          ^^
336 |
337 |         Returns:
    |

C901 `sanitize_form_data` is too complex (12 > 10)
   --> app/utils/data_validator.py:380:9
    |
379 |     @classmethod
380 |     def sanitize_form_data(cls, data: Mapping[str, Any]) -> dict[str, Any]:
    |         ^^^^^^^^^^^^^^^^^^
381 |         """清理表单提交的数据结构。.
    |

PLR0912 Too many branches (14 > 12)
   --> app/utils/data_validator.py:380:9
    |
379 |     @classmethod
380 |     def sanitize_form_data(cls, data: Mapping[str, Any]) -> dict[str, Any]:
    |         ^^^^^^^^^^^^^^^^^^
381 |         """清理表单提交的数据结构。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/data_validator.py:383:27
    |
381 |         """清理表单提交的数据结构。.
382 |
383 |         处理 MultiDict 和普通字典，支持同名字段多值（如 checkbox）。
    |                                  ^^
384 |         对所有字符串值进行安全清理。
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/utils/data_validator.py:383:36
    |
381 |         """清理表单提交的数据结构。.
382 |
383 |         处理 MultiDict 和普通字典，支持同名字段多值（如 checkbox）。
    |                                                    ^^
384 |         对所有字符串值进行安全清理。
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/utils/data_validator.py:383:47
    |
381 |         """清理表单提交的数据结构。.
382 |
383 |         处理 MultiDict 和普通字典，支持同名字段多值（如 checkbox）。
    |                                                                 ^^
384 |         对所有字符串值进行安全清理。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/data_validator.py:387:30
    |
386 |         Args:
387 |             data: 表单或 JSON 数据，可以是 MultiDict 或普通字典。
    |                                   ^^
388 |
389 |         Returns:
    |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/utils/data_validator.py:395:33
    |
393 |         sanitized: dict[str, Any] = {}
394 |         if hasattr(data, "getlist"):
395 |             # MultiDict 支持同名字段多值（如 checkbox + hidden），需要保留全部值
    |                                         ^^
396 |             for key in data:
397 |                 values = data.getlist(key)
    |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/utils/data_validator.py:395:53
    |
393 |         sanitized: dict[str, Any] = {}
394 |         if hasattr(data, "getlist"):
395 |             # MultiDict 支持同名字段多值（如 checkbox + hidden），需要保留全部值
    |                                                               ^^
396 |             for key in data:
397 |                 values = data.getlist(key)
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/data_validator.py:395:54
    |
393 |         sanitized: dict[str, Any] = {}
394 |         if hasattr(data, "getlist"):
395 |             # MultiDict 支持同名字段多值（如 checkbox + hidden），需要保留全部值
    |                                                                 ^^
396 |             for key in data:
397 |                 values = data.getlist(key)
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/data_validator.py:413:33
    |
411 |                         cleaned_values.append(cls.sanitize_string(str(value)))
412 |
413 |                 # 只有一个值时保持原有标量行为，多个值返回列表供后续解析
    |                                               ^^
414 |                 sanitized[key] = cleaned_values[0] if len(cleaned_values) == 1 else cleaned_values
415 |         else:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/data_validator.py:431:24
    |
429 |         """验证必填字段是否存在。.
430 |
431 |         检查数据中是否包含所有必填字段，且字段值不为空。
    |                                       ^^
432 |
433 |         Args:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/data_validator.py:438:24
    |
437 |         Returns:
438 |             验证失败时返回错误信息，成功时返回 None。
    |                                   ^^
439 |
440 |         """
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `db_type`
   --> app/utils/data_validator.py:448:40
    |
447 |     @classmethod
448 |     def validate_db_type(cls, db_type: Any) -> str | None:
    |                                        ^^^
449 |         """验证数据库类型是否受支持。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/data_validator.py:455:24
    |
454 |         Returns:
455 |             验证失败时返回错误信息，成功时返回 None。
    |                                   ^^
456 |
457 |         """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/data_validator.py:483:24
    |
481 |     @classmethod
482 |     def _resolve_allowed_db_types(cls) -> set[str]:
483 |         """获取允许的数据库类型集合，优先使用数据库配置。."""
    |                                    ^^
484 |         if cls._custom_db_types is not None:
485 |             return cls._custom_db_types
    |

PLC0415 `import` should be at the top-level of a file
   --> app/utils/data_validator.py:488:13
    |
487 |         try:
488 |             from app.services.database_type_service import DatabaseTypeService
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
489 |
490 |             configs = DatabaseTypeService.get_active_types()
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/utils/data_validator.py:494:16
    |
492 |             if dynamic_types:
493 |                 return dynamic_types
494 |         except Exception as exc:
    |                ^^^^^^^^^
495 |             logger.warning("获取数据库类型配置失败，回退到静态白名单: %s", exc)
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/data_validator.py:495:40
    |
493 |                 return dynamic_types
494 |         except Exception as exc:
495 |             logger.warning("获取数据库类型配置失败，回退到静态白名单: %s", exc)
    |                                                   ^^
496 |
497 |         return {item.lower() for item in cls.SUPPORTED_DB_TYPES}
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `credential_type`
   --> app/utils/data_validator.py:500:56
    |
499 |     @classmethod
500 |     def validate_credential_type(cls, credential_type: Any) -> str | None:
    |                                                        ^^^
501 |         """验证凭据类型。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/data_validator.py:507:24
    |
506 |         Returns:
507 |             验证失败时返回错误信息，成功时返回 None。
    |                                   ^^
508 |
509 |         """
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `username`
   --> app/utils/data_validator.py:526:37
    |
525 |     @staticmethod
526 |     def validate_username(username: Any) -> str | None:
    |                                     ^^^
527 |         """验证用户名格式。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/data_validator.py:529:24
    |
527 |         """验证用户名格式。.
528 |
529 |         用户名必须是 3-50 个字符，只能包含字母、数字、下划线、连字符和点。
    |                                 ^^
530 |
531 |         Args:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/data_validator.py:535:24
    |
534 |         Returns:
535 |             验证失败时返回错误信息，成功时返回 None。
    |                                   ^^
536 |
537 |         """
    |

PLR2004 Magic value used in comparison, consider replacing `3` with a constant variable
   --> app/utils/data_validator.py:545:30
    |
544 |         normalized = username.strip()
545 |         if len(normalized) < 3:
    |                              ^
546 |             return "用户名长度至少3个字符"
    |

PLR2004 Magic value used in comparison, consider replacing `50` with a constant variable
   --> app/utils/data_validator.py:548:30
    |
546 |             return "用户名长度至少3个字符"
547 |
548 |         if len(normalized) > 50:
    |                              ^^
549 |             return "用户名长度不能超过50个字符"
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `password`
   --> app/utils/data_validator.py:557:37
    |
556 |     @staticmethod
557 |     def validate_password(password: Any) -> str | None:
    |                                     ^^^
558 |         """验证密码强度。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/data_validator.py:566:24
    |
565 |         Returns:
566 |             验证失败时返回错误信息，成功时返回 None。
    |                                   ^^
567 |
568 |         """
    |

PLR2004 Magic value used in comparison, consider replacing `6` with a constant variable
   --> app/utils/data_validator.py:575:28
    |
573 |             return "密码必须是字符串"
574 |
575 |         if len(password) < 6:
    |                            ^
576 |             return "密码长度至少6个字符"
    |

PLR2004 Magic value used in comparison, consider replacing `128` with a constant variable
   --> app/utils/data_validator.py:578:28
    |
576 |             return "密码长度至少6个字符"
577 |
578 |         if len(password) > 128:
    |                            ^^^
579 |             return "密码长度不能超过128个字符"
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/data_validator.py:587:13
    |
586 | def sanitize_form_data(data: Mapping[str, Any]) -> dict[str, Any]:
587 |     """函数式入口，委托给 `DataValidator.sanitize_form_data`。.
    |                  ^^
588 |
589 |     Args:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/data_validator.py:590:21
    |
589 |     Args:
590 |         data: 任意映射对象，包含需要清洗的实例字段。
    |                           ^^
591 |
592 |     Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/data_validator.py:593:18
    |
592 |     Returns:
593 |         归一化后的表单字典，字段值已去除空白并转换为基础类型。
    |                           ^^
594 |
595 |     """
    |

RUF002 Docstring contains ambiguous `；` (FULLWIDTH SEMICOLON). Did you mean `;` (SEMICOLON)?
   --> app/utils/data_validator.py:607:21
    |
606 |     Returns:
607 |         第一个缺失字段的错误信息；若全部存在则返回 None。
    |                                 ^^
608 |
609 |     """
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `db_type`
   --> app/utils/data_validator.py:613:31
    |
613 | def validate_db_type(db_type: Any) -> str | None:
    |                               ^^^
614 |     """函数式入口校验数据库类型。.
    |

RUF002 Docstring contains ambiguous `；` (FULLWIDTH SEMICOLON). Did you mean `;` (SEMICOLON)?
   --> app/utils/data_validator.py:620:16
    |
619 |     Returns:
620 |         字符串错误描述；当类型有效时返回 None。
    |                       ^^
621 |
622 |     """
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `credential_type`
   --> app/utils/data_validator.py:626:47
    |
626 | def validate_credential_type(credential_type: Any) -> str | None:
    |                                               ^^^
627 |     """函数式入口校验凭据类型。.
    |

RUF002 Docstring contains ambiguous `；` (FULLWIDTH SEMICOLON). Did you mean `;` (SEMICOLON)?
   --> app/utils/data_validator.py:633:16
    |
632 |     Returns:
633 |         字符串错误描述；当类型有效时返回 None。
    |                       ^^
634 |
635 |     """
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `username`
   --> app/utils/data_validator.py:639:33
    |
639 | def validate_username(username: Any) -> str | None:
    |                                 ^^^
640 |     """函数式入口校验用户名。.
    |

RUF002 Docstring contains ambiguous `；` (FULLWIDTH SEMICOLON). Did you mean `;` (SEMICOLON)?
   --> app/utils/data_validator.py:646:16
    |
645 |     Returns:
646 |         字符串错误描述；当用户名合法时返回 None。
    |                       ^^
647 |
648 |     """
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `password`
   --> app/utils/data_validator.py:652:33
    |
652 | def validate_password(password: Any) -> str | None:
    |                                 ^^^
653 |     """函数式入口校验密码。.
    |

RUF002 Docstring contains ambiguous `；` (FULLWIDTH SEMICOLON). Did you mean `;` (SEMICOLON)?
   --> app/utils/data_validator.py:659:16
    |
658 |     Returns:
659 |         字符串错误描述；当密码满足长度和字符要求时返回 None。
    |                       ^^
660 |
661 |     """
    |

D205 1 blank line required between summary line and description
 --> app/utils/database_batch_manager.py:1:1
  |
1 | / """鲸落 - 数据库批量操作管理器
2 | | 提供高效的批量提交机制，优化大量数据处理性能.
3 | | """
  | |___^
4 |
5 |   from typing import Any
  |
help: Insert single blank line

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/utils/database_batch_manager.py:2:12
  |
1 | """鲸落 - 数据库批量操作管理器
2 | 提供高效的批量提交机制，优化大量数据处理性能.
  |                       ^^
3 | """
  |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/database_batch_manager.py:15:19
   |
13 |     """数据库批量操作管理器。.
14 |
15 |     负责管理数据库操作的批量提交，提高性能并确保事务一致性。
   |                                 ^^
16 |     支持自动批量提交、手动提交和回滚操作，适用于大量数据处理场景。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/database_batch_manager.py:16:23
   |
15 |     负责管理数据库操作的批量提交，提高性能并确保事务一致性。
16 |     支持自动批量提交、手动提交和回滚操作，适用于大量数据处理场景。
   |                                         ^^
17 |
18 |     Attributes:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/database_batch_manager.py:19:25
   |
18 |     Attributes:
19 |         batch_size: 批次大小，达到此数量时自动提交。
   |                             ^^
20 |         logger: 结构化日志记录器。
21 |         instance_name: 实例名称，用于日志记录。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/database_batch_manager.py:21:28
   |
19 |         batch_size: 批次大小，达到此数量时自动提交。
20 |         logger: 结构化日志记录器。
21 |         instance_name: 实例名称，用于日志记录。
   |                                ^^
22 |         current_batch: 当前批次编号。
23 |         total_operations: 总操作数。
   |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `logger`
  --> app/utils/database_batch_manager.py:36:55
   |
34 |     """
35 |
36 |     def __init__(self, batch_size: int = 100, logger: Any | None = None, instance_name: str = "") -> None:
   |                                                       ^^^^^^^^^^
37 |         """初始化批量管理器。.
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/database_batch_manager.py:40:29
   |
39 |         Args:
40 |             batch_size: 批次大小，默认 100。达到此数量时自动提交。
   |                                 ^^
41 |             logger: 日志记录器，默认使用 structlog。
42 |             instance_name: 实例名称，用于日志记录和追踪。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/database_batch_manager.py:41:26
   |
39 |         Args:
40 |             batch_size: 批次大小，默认 100。达到此数量时自动提交。
41 |             logger: 日志记录器，默认使用 structlog。
   |                               ^^
42 |             instance_name: 实例名称，用于日志记录和追踪。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/database_batch_manager.py:42:32
   |
40 |             batch_size: 批次大小，默认 100。达到此数量时自动提交。
41 |             logger: 日志记录器，默认使用 structlog。
42 |             instance_name: 实例名称，用于日志记录和追踪。
   |                                    ^^
43 |
44 |         """
   |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `entity`
  --> app/utils/database_batch_manager.py:65:58
   |
63 |         )
64 |
65 |     def add_operation(self, operation_type: str, entity: Any, description: str = "") -> None:
   |                                                          ^^^
66 |         """添加数据库操作到批次队列。.
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/database_batch_manager.py:68:20
   |
66 |         """添加数据库操作到批次队列。.
67 |
68 |         将操作添加到待处理队列，当队列达到批次大小时自动提交。
   |                               ^^
69 |
70 |         Args:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/database_batch_manager.py:71:33
   |
70 |         Args:
71 |             operation_type: 操作类型，可选值：'add'（新增）、'update'（更新）、'delete'（删除）。
   |                                     ^^
72 |             entity: 数据库实体对象，必须是 SQLAlchemy 模型实例。
73 |             description: 操作描述，用于日志记录和错误追踪。
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/utils/database_batch_manager.py:71:37
   |
70 |         Args:
71 |             operation_type: 操作类型，可选值：'add'（新增）、'update'（更新）、'delete'（删除）。
   |                                             ^^
72 |             entity: 数据库实体对象，必须是 SQLAlchemy 模型实例。
73 |             description: 操作描述，用于日志记录和错误追踪。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/utils/database_batch_manager.py:71:43
   |
70 |         Args:
71 |             operation_type: 操作类型，可选值：'add'（新增）、'update'（更新）、'delete'（删除）。
   |                                                    ^^
72 |             entity: 数据库实体对象，必须是 SQLAlchemy 模型实例。
73 |             description: 操作描述，用于日志记录和错误追踪。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/utils/database_batch_manager.py:71:46
   |
70 |         Args:
71 |             operation_type: 操作类型，可选值：'add'（新增）、'update'（更新）、'delete'（删除）。
   |                                                          ^^
72 |             entity: 数据库实体对象，必须是 SQLAlchemy 模型实例。
73 |             description: 操作描述，用于日志记录和错误追踪。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/utils/database_batch_manager.py:71:56
   |
70 |         Args:
71 |             operation_type: 操作类型，可选值：'add'（新增）、'update'（更新）、'delete'（删除）。
   |                                                                      ^^
72 |             entity: 数据库实体对象，必须是 SQLAlchemy 模型实例。
73 |             description: 操作描述，用于日志记录和错误追踪。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/utils/database_batch_manager.py:71:59
   |
70 |         Args:
71 |             operation_type: 操作类型，可选值：'add'（新增）、'update'（更新）、'delete'（删除）。
   |                                                                            ^^
72 |             entity: 数据库实体对象，必须是 SQLAlchemy 模型实例。
73 |             description: 操作描述，用于日志记录和错误追踪。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/utils/database_batch_manager.py:71:69
   |
70 |         Args:
71 |             operation_type: 操作类型，可选值：'add'（新增）、'update'（更新）、'delete'（删除）。
   |                                                                                        ^^
72 |             entity: 数据库实体对象，必须是 SQLAlchemy 模型实例。
73 |             description: 操作描述，用于日志记录和错误追踪。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/utils/database_batch_manager.py:71:72
   |
70 |         Args:
71 |             operation_type: 操作类型，可选值：'add'（新增）、'update'（更新）、'delete'（删除）。
   |                                                                                              ^^
72 |             entity: 数据库实体对象，必须是 SQLAlchemy 模型实例。
73 |             description: 操作描述，用于日志记录和错误追踪。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/database_batch_manager.py:72:28
   |
70 |         Args:
71 |             operation_type: 操作类型，可选值：'add'（新增）、'update'（更新）、'delete'（删除）。
72 |             entity: 数据库实体对象，必须是 SQLAlchemy 模型实例。
   |                                   ^^
73 |             description: 操作描述，用于日志记录和错误追踪。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/database_batch_manager.py:73:30
   |
71 |             operation_type: 操作类型，可选值：'add'（新增）、'update'（更新）、'delete'（删除）。
72 |             entity: 数据库实体对象，必须是 SQLAlchemy 模型实例。
73 |             description: 操作描述，用于日志记录和错误追踪。
   |                                  ^^
74 |
75 |         Returns:
   |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/database_batch_manager.py:87:19
   |
85 |         self.total_operations += 1
86 |
87 |         # 如果达到批次大小，自动提交
   |                           ^^
88 |         if len(self.pending_operations) >= self.batch_size:
89 |             self.commit_batch()
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/database_batch_manager.py:94:33
   |
92 |         """提交当前批次的所有操作。.
93 |
94 |         执行队列中的所有操作并提交事务。如果任何操作失败，
   |                                                         ^^
95 |         记录错误但继续处理其他操作。如果提交失败，回滚整个批次。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/database_batch_manager.py:95:29
   |
94 |         执行队列中的所有操作并提交事务。如果任何操作失败，
95 |         记录错误但继续处理其他操作。如果提交失败，回滚整个批次。
   |                                                 ^^
96 |
97 |         Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/database_batch_manager.py:98:24
    |
 97 |         Returns:
 98 |             提交成功返回 True，失败返回 False。
    |                              ^^
 99 |
100 |         Example:
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/database_batch_manager.py:128:33
    |
126 |                         db.session.add(operation["entity"])
127 |                     elif operation["type"] == "update":
128 |                         # 对于更新操作，实体已经在session中，只需要确保修改被追踪
    |                                       ^^
129 |                         db.session.merge(operation["entity"])
130 |                     elif operation["type"] == "delete":
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/database_batch_manager.py:128:47
    |
126 |                         db.session.add(operation["entity"])
127 |                     elif operation["type"] == "update":
128 |                         # 对于更新操作，实体已经在session中，只需要确保修改被追踪
    |                                                            ^^
129 |                         db.session.merge(operation["entity"])
130 |                     elif operation["type"] == "delete":
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/database_batch_manager.py:144:31
    |
142 |                         error=str(op_error),
143 |                     )
144 |                     # 继续处理其他操作，不因单个失败而停止
    |                                       ^^
145 |
146 |             # 提交事务
    |

TRY300 Consider moving this statement to an `else` block
   --> app/utils/database_batch_manager.py:160:13
    |
158 |             # 清空当前批次
159 |             self.pending_operations.clear()
160 |             return True
    |             ^^^^^^^^^^^
161 |
162 |         except Exception as e:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/database_batch_manager.py:182:19
    |
180 |         """提交剩余的所有操作。.
181 |
182 |         在批量操作结束时调用，提交队列中剩余的未达到批次大小的操作。
    |                             ^^
183 |
184 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/database_batch_manager.py:185:24
    |
184 |         Returns:
185 |             提交成功返回 True，失败返回 False。如果队列为空返回 True。
    |                              ^^
186 |
187 |         Example:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/database_batch_manager.py:239:22
    |
238 |         Returns:
239 |             包含统计信息的字典，格式如下：
    |                               ^^
240 |             {
241 |                 'total_operations': 100,        # 总操作数
    |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/utils/database_batch_manager.py:239:27
    |
238 |         Returns:
239 |             包含统计信息的字典，格式如下：
    |                                         ^^
240 |             {
241 |                 'total_operations': 100,        # 总操作数
    |

ANN204 Missing return type annotation for special method `__enter__`
   --> app/utils/database_batch_manager.py:263:9
    |
261 |         }
262 |
263 |     def __enter__(self):
    |         ^^^^^^^^^
264 |         """上下文管理器入口。.
    |
help: Add return type annotation

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/database_batch_manager.py:267:19
    |
266 |         Returns:
267 |             返回自身实例，支持 with 语句。
    |                         ^^
268 |
269 |         """
    |

PYI036 The first argument in `__exit__` should be annotated with `object` or `type[BaseException] | None`
   --> app/utils/database_batch_manager.py:272:34
    |
270 |         return self
271 |
272 |     def __exit__(self, exc_type: Any, exc_val: Any, exc_tb: Any) -> None:
    |                                  ^^^
273 |         """上下文管理器出口。.
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `exc_type`
   --> app/utils/database_batch_manager.py:272:34
    |
270 |         return self
271 |
272 |     def __exit__(self, exc_type: Any, exc_val: Any, exc_tb: Any) -> None:
    |                                  ^^^
273 |         """上下文管理器出口。.
    |

PYI036 The second argument in `__exit__` should be annotated with `object` or `BaseException | None`
   --> app/utils/database_batch_manager.py:272:48
    |
270 |         return self
271 |
272 |     def __exit__(self, exc_type: Any, exc_val: Any, exc_tb: Any) -> None:
    |                                                ^^^
273 |         """上下文管理器出口。.
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `exc_val`
   --> app/utils/database_batch_manager.py:272:48
    |
270 |         return self
271 |
272 |     def __exit__(self, exc_type: Any, exc_val: Any, exc_tb: Any) -> None:
    |                                                ^^^
273 |         """上下文管理器出口。.
    |

PYI036 The third argument in `__exit__` should be annotated with `object` or `types.TracebackType | None`
   --> app/utils/database_batch_manager.py:272:61
    |
270 |         return self
271 |
272 |     def __exit__(self, exc_type: Any, exc_val: Any, exc_tb: Any) -> None:
    |                                                             ^^^
273 |         """上下文管理器出口。.
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `exc_tb`
   --> app/utils/database_batch_manager.py:272:61
    |
270 |         return self
271 |
272 |     def __exit__(self, exc_type: Any, exc_val: Any, exc_tb: Any) -> None:
    |                                                             ^^^
273 |         """上下文管理器出口。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/database_batch_manager.py:275:20
    |
273 |         """上下文管理器出口。.
274 |
275 |         正常退出时提交剩余操作，异常退出时回滚操作。
    |                               ^^
276 |
277 |         Args:
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/database_batch_manager.py:287:19
    |
285 |         """
286 |         if exc_type is None:
287 |             # 正常退出，提交剩余操作
    |                       ^^
288 |             self.flush_remaining()
289 |         else:
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/database_batch_manager.py:290:19
    |
288 |             self.flush_remaining()
289 |         else:
290 |             # 异常退出，回滚操作
    |                       ^^
291 |             self.rollback()
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `f`
  --> app/utils/decorators.py:18:23
   |
16 | SAFE_CSRF_METHODS = {"GET", "HEAD", "OPTIONS", "TRACE"}
17 |
18 | def admin_required(f: Any) -> Any:
   |                       ^^^
19 |     """确保被装饰函数仅允许管理员访问的装饰器。.
   |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `admin_required`
  --> app/utils/decorators.py:18:31
   |
16 | SAFE_CSRF_METHODS = {"GET", "HEAD", "OPTIONS", "TRACE"}
17 |
18 | def admin_required(f: Any) -> Any:
   |                               ^^^
19 |     """确保被装饰函数仅允许管理员访问的装饰器。.
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/decorators.py:22:11
   |
21 |     验证当前用户是否已认证且具有管理员角色。
22 |     如果验证失败，根据请求类型返回 JSON 错误或重定向到登录页。
   |                 ^^
23 |
24 |     Args:
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/utils/decorators.py:31:39
   |
30 |     Raises:
31 |         AuthenticationError: 当用户未认证时抛出（JSON 请求）。
   |                                                ^^
32 |         AuthorizationError: 当用户权限不足时抛出（JSON 请求）。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/utils/decorators.py:31:47
   |
30 |     Raises:
31 |         AuthenticationError: 当用户未认证时抛出（JSON 请求）。
   |                                                           ^^
32 |         AuthorizationError: 当用户权限不足时抛出（JSON 请求）。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/utils/decorators.py:32:39
   |
30 |     Raises:
31 |         AuthenticationError: 当用户未认证时抛出（JSON 请求）。
32 |         AuthorizationError: 当用户权限不足时抛出（JSON 请求）。
   |                                                 ^^
33 |
34 |     """
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/utils/decorators.py:32:47
   |
30 |     Raises:
31 |         AuthenticationError: 当用户未认证时抛出（JSON 请求）。
32 |         AuthorizationError: 当用户权限不足时抛出（JSON 请求）。
   |                                                            ^^
33 |
34 |     """
   |

ANN002 Missing type annotation for `*args`
  --> app/utils/decorators.py:37:28
   |
36 |     @wraps(f)
37 |     def decorated_function(*args, **kwargs: Any) -> Any:
   |                            ^^^^^
38 |         system_logger = get_system_logger()
   |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `**kwargs`
  --> app/utils/decorators.py:37:45
   |
36 |     @wraps(f)
37 |     def decorated_function(*args, **kwargs: Any) -> Any:
   |                                             ^^^
38 |         system_logger = get_system_logger()
   |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `decorated_function`
  --> app/utils/decorators.py:37:53
   |
36 |     @wraps(f)
37 |     def decorated_function(*args, **kwargs: Any) -> Any:
   |                                                     ^^^
38 |         system_logger = get_system_logger()
   |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `f`
   --> app/utils/decorators.py:111:23
    |
111 | def login_required(f: Any) -> Any:
    |                       ^^^
112 |     """要求调用者已登录的装饰器。.
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `login_required`
   --> app/utils/decorators.py:111:31
    |
111 | def login_required(f: Any) -> Any:
    |                               ^^^
112 |     """要求调用者已登录的装饰器。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/decorators.py:118:15
    |
117 |     Returns:
118 |         包装后的函数，若用户未登录将重定向或抛出异常。
    |                     ^^
119 |
120 |     """
    |

ANN002 Missing type annotation for `*args`
   --> app/utils/decorators.py:123:28
    |
122 |     @wraps(f)
123 |     def decorated_function(*args, **kwargs: Any) -> Any:
    |                            ^^^^^
124 |         system_logger = get_system_logger()
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `**kwargs`
   --> app/utils/decorators.py:123:45
    |
122 |     @wraps(f)
123 |     def decorated_function(*args, **kwargs: Any) -> Any:
    |                                             ^^^
124 |         system_logger = get_system_logger()
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `decorated_function`
   --> app/utils/decorators.py:123:53
    |
122 |     @wraps(f)
123 |     def decorated_function(*args, **kwargs: Any) -> Any:
    |                                                     ^^^
124 |         system_logger = get_system_logger()
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `permission_required`
   --> app/utils/decorators.py:168:45
    |
168 | def permission_required(permission: str) -> Any:
    |                                             ^^^
169 |     """校验指定权限（view/create/update/delete）的装饰器工厂。.
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/utils/decorators.py:169:14
    |
168 | def permission_required(permission: str) -> Any:
169 |     """校验指定权限（view/create/update/delete）的装饰器工厂。.
    |                    ^^
170 |
171 |     Args:
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/utils/decorators.py:169:40
    |
168 | def permission_required(permission: str) -> Any:
169 |     """校验指定权限（view/create/update/delete）的装饰器工厂。.
    |                                               ^^
170 |
171 |     Args:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/decorators.py:175:18
    |
174 |     Returns:
175 |         可装饰视图的校验器，未通过时会告警或抛出异常。
    |                           ^^
176 |
177 |     """
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `f`
   --> app/utils/decorators.py:179:22
    |
177 |     """
178 |
179 |     def decorator(f: Any) -> Any:
    |                      ^^^
180 |         @wraps(f)
181 |         def decorated_function(*args, **kwargs: Any) -> Any:
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `decorator`
   --> app/utils/decorators.py:179:30
    |
177 |     """
178 |
179 |     def decorator(f: Any) -> Any:
    |                              ^^^
180 |         @wraps(f)
181 |         def decorated_function(*args, **kwargs: Any) -> Any:
    |

ANN002 Missing type annotation for `*args`
   --> app/utils/decorators.py:181:32
    |
179 |     def decorator(f: Any) -> Any:
180 |         @wraps(f)
181 |         def decorated_function(*args, **kwargs: Any) -> Any:
    |                                ^^^^^
182 |             system_logger = get_system_logger()
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `**kwargs`
   --> app/utils/decorators.py:181:49
    |
179 |     def decorator(f: Any) -> Any:
180 |         @wraps(f)
181 |         def decorated_function(*args, **kwargs: Any) -> Any:
    |                                                 ^^^
182 |             system_logger = get_system_logger()
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `decorated_function`
   --> app/utils/decorators.py:181:57
    |
179 |     def decorator(f: Any) -> Any:
180 |         @wraps(f)
181 |         def decorated_function(*args, **kwargs: Any) -> Any:
    |                                                         ^^^
182 |             system_logger = get_system_logger()
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/decorators.py:266:22
    |
265 |     Returns:
266 |         提取到的 CSRF 字符串，若不存在返回 None。
    |                             ^^
267 |
268 |     """
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `f`
   --> app/utils/decorators.py:283:21
    |
283 | def require_csrf(f: Any) -> Any:
    |                     ^^^
284 |     """统一的 CSRF 校验装饰器。.
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `require_csrf`
   --> app/utils/decorators.py:283:29
    |
283 | def require_csrf(f: Any) -> Any:
    |                             ^^^
284 |     """统一的 CSRF 校验装饰器。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/decorators.py:290:15
    |
289 |     Returns:
290 |         装饰后的函数，校验失败时抛出 AuthorizationError。
    |                     ^^
291 |
292 |     """
    |

ANN002 Missing type annotation for `*args`
   --> app/utils/decorators.py:295:28
    |
294 |     @wraps(f)
295 |     def decorated_function(*args, **kwargs: Any) -> Any:
    |                            ^^^^^
296 |         if request.method.upper() in SAFE_CSRF_METHODS:
297 |             return f(*args, **kwargs)
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `**kwargs`
   --> app/utils/decorators.py:295:45
    |
294 |     @wraps(f)
295 |     def decorated_function(*args, **kwargs: Any) -> Any:
    |                                             ^^^
296 |         if request.method.upper() in SAFE_CSRF_METHODS:
297 |             return f(*args, **kwargs)
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `decorated_function`
   --> app/utils/decorators.py:295:53
    |
294 |     @wraps(f)
295 |     def decorated_function(*args, **kwargs: Any) -> Any:
    |                                                     ^^^
296 |         if request.method.upper() in SAFE_CSRF_METHODS:
297 |             return f(*args, **kwargs)
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/decorators.py:332:29
    |
330 |                 exception=str(exc),
331 |             )
332 |             msg = "CSRF 令牌无效，请刷新后重试"
    |                                 ^^
333 |             raise AuthorizationError(
334 |                 msg,
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `user`
   --> app/utils/decorators.py:347:26
    |
347 | def has_permission(user: Any, permission: str) -> bool:
    |                          ^^^
348 |     """检查给定用户是否具备指定权限。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/decorators.py:355:20
    |
354 |     Returns:
355 |         True 表示具有权限，False 表示缺失或未登录。
    |                          ^^
356 |
357 |     """
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/decorators.py:366:13
    |
365 |     # 模拟从数据库或配置中加载的用户权限
366 |     # 在真实应用中，这里应该查询数据库
    |                   ^^
367 |     user_permissions = {
368 |         "user": {
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `f`
   --> app/utils/decorators.py:382:22
    |
382 | def view_required(f: Any = None, *, permission: str = "view") -> Any:
    |                      ^^^
383 |     """校验查看权限的装饰器，可直接使用或指定自定义权限。.
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `view_required`
   --> app/utils/decorators.py:382:66
    |
382 | def view_required(f: Any = None, *, permission: str = "view") -> Any:
    |                                                                  ^^^
383 |     """校验查看权限的装饰器，可直接使用或指定自定义权限。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/decorators.py:383:18
    |
382 | def view_required(f: Any = None, *, permission: str = "view") -> Any:
383 |     """校验查看权限的装饰器，可直接使用或指定自定义权限。.
    |                            ^^
384 |
385 |     Args:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/decorators.py:386:17
    |
385 |     Args:
386 |         f: 待装饰函数，支持无参直接使用。
    |                      ^^
387 |         permission: 自定义权限名称，默认 `view`。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/decorators.py:387:28
    |
385 |     Args:
386 |         f: 待装饰函数，支持无参直接使用。
387 |         permission: 自定义权限名称，默认 `view`。
    |                                   ^^
388 |
389 |     Returns:
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `func`
   --> app/utils/decorators.py:394:25
    |
392 |     """
393 |
394 |     def decorator(func: Any) -> Any:
    |                         ^^^
395 |         return permission_required(permission)(func)
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `decorator`
   --> app/utils/decorators.py:394:33
    |
392 |     """
393 |
394 |     def decorator(func: Any) -> Any:
    |                                 ^^^
395 |         return permission_required(permission)(func)
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `f`
   --> app/utils/decorators.py:402:24
    |
402 | def create_required(f: Any = None, *, permission: str = "create") -> Any:
    |                        ^^^
403 |     """校验创建权限的装饰器。.
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `create_required`
   --> app/utils/decorators.py:402:70
    |
402 | def create_required(f: Any = None, *, permission: str = "create") -> Any:
    |                                                                      ^^^
403 |     """校验创建权限的装饰器。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/decorators.py:407:28
    |
405 |     Args:
406 |         f: 待装饰函数。
407 |         permission: 自定义权限名称，默认为 `create`。
    |                                   ^^
408 |
409 |     Returns:
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `func`
   --> app/utils/decorators.py:414:25
    |
412 |     """
413 |
414 |     def decorator(func: Any) -> Any:
    |                         ^^^
415 |         return permission_required(permission)(func)
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `decorator`
   --> app/utils/decorators.py:414:33
    |
412 |     """
413 |
414 |     def decorator(func: Any) -> Any:
    |                                 ^^^
415 |         return permission_required(permission)(func)
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `f`
   --> app/utils/decorators.py:422:24
    |
422 | def update_required(f: Any = None, *, permission: str = "update") -> Any:
    |                        ^^^
423 |     """校验更新权限的装饰器。.
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `update_required`
   --> app/utils/decorators.py:422:70
    |
422 | def update_required(f: Any = None, *, permission: str = "update") -> Any:
    |                                                                      ^^^
423 |     """校验更新权限的装饰器。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/decorators.py:427:28
    |
425 |     Args:
426 |         f: 待装饰函数。
427 |         permission: 自定义权限名称，默认为 `update`。
    |                                   ^^
428 |
429 |     Returns:
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `func`
   --> app/utils/decorators.py:434:25
    |
432 |     """
433 |
434 |     def decorator(func: Any) -> Any:
    |                         ^^^
435 |         return permission_required(permission)(func)
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `decorator`
   --> app/utils/decorators.py:434:33
    |
432 |     """
433 |
434 |     def decorator(func: Any) -> Any:
    |                                 ^^^
435 |         return permission_required(permission)(func)
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `f`
   --> app/utils/decorators.py:442:24
    |
442 | def delete_required(f: Any = None, *, permission: str = "delete") -> Any:
    |                        ^^^
443 |     """校验删除权限的装饰器。.
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `delete_required`
   --> app/utils/decorators.py:442:70
    |
442 | def delete_required(f: Any = None, *, permission: str = "delete") -> Any:
    |                                                                      ^^^
443 |     """校验删除权限的装饰器。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/decorators.py:447:28
    |
445 |     Args:
446 |         f: 待装饰函数。
447 |         permission: 自定义权限名称，默认为 `delete`。
    |                                   ^^
448 |
449 |     Returns:
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `func`
   --> app/utils/decorators.py:454:25
    |
452 |     """
453 |
454 |     def decorator(func: Any) -> Any:
    |                         ^^^
455 |         return permission_required(permission)(func)
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `decorator`
   --> app/utils/decorators.py:454:33
    |
452 |     """
453 |
454 |     def decorator(func: Any) -> Any:
    |                                 ^^^
455 |         return permission_required(permission)(func)
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `f`
   --> app/utils/decorators.py:462:32
    |
462 | def scheduler_view_required(f: Any) -> Any:
    |                                ^^^
463 |     """定时任务查看权限装饰器。.
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `scheduler_view_required`
   --> app/utils/decorators.py:462:40
    |
462 | def scheduler_view_required(f: Any) -> Any:
    |                                        ^^^
463 |     """定时任务查看权限装饰器。.
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `f`
   --> app/utils/decorators.py:475:34
    |
475 | def scheduler_manage_required(f: Any) -> Any:
    |                                  ^^^
476 |     """定时任务管理权限装饰器。.
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `scheduler_manage_required`
   --> app/utils/decorators.py:475:42
    |
475 | def scheduler_manage_required(f: Any) -> Any:
    |                                          ^^^
476 |     """定时任务管理权限装饰器。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/logging/error_adapter.py:28:28
   |
26 |     Attributes:
27 |         error: 捕获的异常对象。
28 |         request: Flask 请求对象，可选。
   |                                ^^
29 |         error_id: 唯一错误标识符，自动生成。
30 |         timestamp: 错误发生时间戳。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/logging/error_adapter.py:29:26
   |
27 |         error: 捕获的异常对象。
28 |         request: Flask 请求对象，可选。
29 |         error_id: 唯一错误标识符，自动生成。
   |                                 ^^
30 |         timestamp: 错误发生时间戳。
31 |         request_id: 请求 ID，从上下文变量获取。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/logging/error_adapter.py:31:26
   |
29 |         error_id: 唯一错误标识符，自动生成。
30 |         timestamp: 错误发生时间戳。
31 |         request_id: 请求 ID，从上下文变量获取。
   |                            ^^
32 |         user_id: 用户 ID，从上下文变量获取。
33 |         url: 请求 URL。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/logging/error_adapter.py:32:23
   |
30 |         timestamp: 错误发生时间戳。
31 |         request_id: 请求 ID，从上下文变量获取。
32 |         user_id: 用户 ID，从上下文变量获取。
   |                         ^^
33 |         url: 请求 URL。
34 |         method: HTTP 方法。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/logging/error_adapter.py:52:30
   |
50 |         """确保请求上下文信息已填充。.
51 |
52 |         如果 request 为空且在请求上下文中，则自动获取 Flask 请求对象。
   |                                          ^^
53 |         同时提取 URL、HTTP 方法、IP 地址和 User-Agent 等信息。
   |

PLC0415 `import` should be at the top-level of a file
  --> app/utils/logging/error_adapter.py:60:13
   |
58 |         """
59 |         if self.request is None and has_request_context():
60 |             from flask import request as flask_request
   |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
61 |
62 |             self.request = flask_request
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/logging/error_adapter.py:98:14
   |
96 |     """从异常对象推导错误元数据。.
97 |
98 |     根据异常类型和内容，自动判断 HTTP 状态码、错误类别、严重程度等信息。
   |                       ^^
99 |     支持 AppError、HTTPException 和通用异常的识别。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/logging/error_adapter.py:183:35
    |
181 |     """构建可对外暴露的错误上下文信息。.
182 |
183 |     从 ErrorContext 中提取安全的、可对外展示的信息，
    |                                                   ^^
184 |     包括请求 ID、用户 ID、URL、HTTP 方法等。
    |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
 --> app/utils/logging/handlers.py:1:12
  |
1 | """结构化日志处理器：负责将事件标准化并交由数据库 worker 写入。."""
  |                    ^^
2 |
3 | from __future__ import annotations
  |

FBT001 Boolean-typed positional argument in function definition
  --> app/utils/logging/handlers.py:27:24
   |
25 |     """
26 |
27 |     def __init__(self, enabled: bool = False) -> None:
   |                        ^^^^^^^
28 |         """初始化 DEBUG 过滤器。.
   |

FBT002 Boolean default positional argument in function definition
  --> app/utils/logging/handlers.py:27:24
   |
25 |     """
26 |
27 |     def __init__(self, enabled: bool = False) -> None:
   |                        ^^^^^^^
28 |         """初始化 DEBUG 过滤器。.
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/logging/handlers.py:31:35
   |
30 |         Args:
31 |             enabled: 是否启用 DEBUG 日志，默认为 False。
   |                                         ^^
32 |
33 |         """
   |

FBT001 Boolean-typed positional argument in function definition
  --> app/utils/logging/handlers.py:36:27
   |
34 |         self.enabled = enabled
35 |
36 |     def set_enabled(self, enabled: bool) -> None:
   |                           ^^^^^^^
37 |         """设置是否启用 DEBUG 日志。.
   |

ANN204 Missing return type annotation for special method `__call__`
  --> app/utils/logging/handlers.py:48:9
   |
46 |         self.enabled = enabled
47 |
48 |     def __call__(self, logger: structlog.BoundLogger, method_name: str, event_dict: dict[str, Any]):
   |         ^^^^^^^^
49 |         """处理日志事件，根据配置决定是否丢弃 DEBUG 日志。.
   |
help: Add return type annotation

ARG002 Unused method argument: `logger`
  --> app/utils/logging/handlers.py:48:24
   |
46 |         self.enabled = enabled
47 |
48 |     def __call__(self, logger: structlog.BoundLogger, method_name: str, event_dict: dict[str, Any]):
   |                        ^^^^^^
49 |         """处理日志事件，根据配置决定是否丢弃 DEBUG 日志。.
   |

ARG002 Unused method argument: `method_name`
  --> app/utils/logging/handlers.py:48:55
   |
46 |         self.enabled = enabled
47 |
48 |     def __call__(self, logger: structlog.BoundLogger, method_name: str, event_dict: dict[str, Any]):
   |                                                       ^^^^^^^^^^^
49 |         """处理日志事件，根据配置决定是否丢弃 DEBUG 日志。.
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/logging/handlers.py:49:18
   |
48 |     def __call__(self, logger: structlog.BoundLogger, method_name: str, event_dict: dict[str, Any]):
49 |         """处理日志事件，根据配置决定是否丢弃 DEBUG 日志。.
   |                        ^^
50 |
51 |         Args:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/logging/handlers.py:60:50
   |
59 |         Raises:
60 |             structlog.DropEvent: 当 DEBUG 日志未启用时抛出，丢弃该日志。
   |                                                           ^^
61 |
62 |         """
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/logging/handlers.py:70:15
   |
69 | class DatabaseLogHandler:
70 |     """将日志事件入队，由后台线程统一写入数据库的处理器。.
   |                      ^^
71 |
72 |     Attributes:
   |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `worker`
  --> app/utils/logging/handlers.py:77:32
   |
75 |     """
76 |
77 |     def __init__(self, worker: Any | None = None) -> None:
   |                                ^^^^^^^^^^
78 |         """初始化数据库日志处理器。.
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/logging/handlers.py:81:31
   |
80 |         Args:
81 |             worker: 日志队列工作线程实例，可选。
   |                                         ^^
82 |
83 |         """
   |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `worker`
  --> app/utils/logging/handlers.py:86:34
   |
84 |         self.worker = worker
85 |
86 |     def set_worker(self, worker: Any | None) -> None:
   |                                  ^^^^^^^^^^
87 |         """设置日志队列工作线程。.
   |

ANN204 Missing return type annotation for special method `__call__`
  --> app/utils/logging/handlers.py:98:9
   |
96 |         self.worker = worker
97 |
98 |     def __call__(self, logger: structlog.BoundLogger, method_name: str, event_dict: dict[str, Any]):
   |         ^^^^^^^^
99 |         """处理日志事件，将其入队等待写入数据库。.
   |
help: Add return type annotation

ARG002 Unused method argument: `logger`
  --> app/utils/logging/handlers.py:98:24
   |
96 |         self.worker = worker
97 |
98 |     def __call__(self, logger: structlog.BoundLogger, method_name: str, event_dict: dict[str, Any]):
   |                        ^^^^^^
99 |         """处理日志事件，将其入队等待写入数据库。.
   |

ARG002 Unused method argument: `method_name`
  --> app/utils/logging/handlers.py:98:55
   |
96 |         self.worker = worker
97 |
98 |     def __call__(self, logger: structlog.BoundLogger, method_name: str, event_dict: dict[str, Any]):
   |                                                       ^^^^^^^^^^^
99 |         """处理日志事件，将其入队等待写入数据库。.
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/logging/handlers.py:99:18
    |
 98 |     def __call__(self, logger: structlog.BoundLogger, method_name: str, event_dict: dict[str, Any]):
 99 |         """处理日志事件，将其入队等待写入数据库。.
    |                        ^^
100 |
101 |         Args:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/logging/handlers.py:126:18
    |
125 |     Returns:
126 |         包含日志字段的字典，如果是 DEBUG 级别则返回 None。
    |                           ^^
127 |
128 |     """
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/utils/logging/handlers.py:156:16
    |
154 |         try:
155 |             timestamp = time_utils.to_utc(timestamp)
156 |         except Exception:
    |                ^^^^^^^^^
157 |             timestamp = time_utils.now()
158 |     if timestamp is None:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/logging/handlers.py:183:15
    |
182 |     Returns:
183 |         提取的模块名，如果无法提取则返回 None。
    |                     ^^
184 |
185 |     """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/logging/handlers.py:196:23
    |
194 |     """构建日志上下文信息。.
195 |
196 |     从事件字典和请求上下文中提取相关信息，包括请求 ID、用户信息、
    |                                         ^^
197 |     URL、HTTP 方法等，并过滤掉系统字段。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/logging/handlers.py:197:17
    |
196 |     从事件字典和请求上下文中提取相关信息，包括请求 ID、用户信息、
197 |     URL、HTTP 方法等，并过滤掉系统字段。
    |                     ^^
198 |
199 |     Args:
    |

S110 `try`-`except`-`pass` detected, consider logging the exception
   --> app/utils/logging/handlers.py:230:5
    |
228 |               else:
229 |                   context["is_admin"] = bool(is_admin)
230 | /     except Exception:
231 | |         pass
    | |____________^
232 |
233 |       for key, value in event_dict.items():
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/utils/logging/handlers.py:230:12
    |
228 |             else:
229 |                 context["is_admin"] = bool(is_admin)
230 |     except Exception:
    |            ^^^^^^^^^
231 |         pass
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/utils/logging/handlers.py:241:20
    |
239 |             try:
240 |                 context[key] = value.to_dict()
241 |             except Exception:
    |                    ^^^^^^^^^
242 |                 context[key] = str(value)
243 |         else:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/logging/queue_worker.py:17:12
   |
16 | class LogQueueWorker:
17 |     """后台线程，按批次将日志写入数据库。.
   |                ^^
18 |
19 |     Attributes:
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/utils/logging/queue_worker.py:23:29
   |
21 |         queue: 日志条目队列。
22 |         batch_size: 批次大小。
23 |         flush_interval: 刷新间隔（秒）。
   |                                 ^^
24 |
25 |     """
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/utils/logging/queue_worker.py:23:31
   |
21 |         queue: 日志条目队列。
22 |         batch_size: 批次大小。
23 |         flush_interval: 刷新间隔（秒）。
   |                                     ^^
24 |
25 |     """
   |

ANN001 Missing type annotation for function argument `app`
  --> app/utils/logging/queue_worker.py:29:9
   |
27 |     def __init__(
28 |         self,
29 |         app,
   |         ^^^
30 |         *,
31 |         queue_size: int = 1000,
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/logging/queue_worker.py:39:31
   |
37 |         Args:
38 |             app: Flask 应用实例。
39 |             queue_size: 队列最大容量，默认 1000。
   |                                     ^^
40 |             batch_size: 批次大小，默认 100。
41 |             flush_interval: 刷新间隔（秒），默认 3.0。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/logging/queue_worker.py:40:29
   |
38 |             app: Flask 应用实例。
39 |             queue_size: 队列最大容量，默认 1000。
40 |             batch_size: 批次大小，默认 100。
   |                                 ^^
41 |             flush_interval: 刷新间隔（秒），默认 3.0。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/utils/logging/queue_worker.py:41:33
   |
39 |             queue_size: 队列最大容量，默认 1000。
40 |             batch_size: 批次大小，默认 100。
41 |             flush_interval: 刷新间隔（秒），默认 3.0。
   |                                     ^^
42 |
43 |         """
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/utils/logging/queue_worker.py:41:35
   |
39 |             queue_size: 队列最大容量，默认 1000。
40 |             batch_size: 批次大小，默认 100。
41 |             flush_interval: 刷新间隔（秒），默认 3.0。
   |                                         ^^
42 |
43 |         """
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/logging/queue_worker.py:41:36
   |
39 |             queue_size: 队列最大容量，默认 1000。
40 |             batch_size: 批次大小，默认 100。
41 |             flush_interval: 刷新间隔（秒），默认 3.0。
   |                                           ^^
42 |
43 |         """
   |

LOG015 `warning()` call on root logger
  --> app/utils/logging/queue_worker.py:69:13
   |
67 |               self.queue.put_nowait(log_entry)
68 |           except Full:
69 | /             logging.warning(
70 | |                 "结构化日志队列已满，丢弃一条日志", extra={"queue_size": self.queue.qsize()},
71 | |             )
   | |_____________^
72 |
73 |       def shutdown(self, timeout: float = 5.0) -> None:
   |
help: Use own logger instead

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/logging/queue_worker.py:70:27
   |
68 |         except Full:
69 |             logging.warning(
70 |                 "结构化日志队列已满，丢弃一条日志", extra={"queue_size": self.queue.qsize()},
   |                                    ^^
71 |             )
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/utils/logging/queue_worker.py:77:33
   |
76 |         Args:
77 |             timeout: 等待线程结束的超时时间（秒），默认 5.0。
   |                                            ^^
78 |
79 |         Returns:
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/utils/logging/queue_worker.py:77:35
   |
76 |         Args:
77 |             timeout: 等待线程结束的超时时间（秒），默认 5.0。
   |                                                ^^
78 |
79 |         Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/logging/queue_worker.py:77:36
   |
76 |         Args:
77 |             timeout: 等待线程结束的超时时间（秒），默认 5.0。
   |                                                  ^^
78 |
79 |         Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/logging/queue_worker.py:88:19
   |
87 |     def _run(self) -> None:
88 |         """工作线程主循环，从队列中取出日志并批量写入数据库。.
   |                          ^^
89 |
90 |         Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/logging/queue_worker.py:111:31
    |
110 |         Returns:
111 |             如果缓冲区达到批次大小或超过刷新间隔，返回 True。
    |                                                 ^^
112 |
113 |         """
    |

LOG015 `exception()` call on root logger
   --> app/utils/logging/queue_worker.py:142:13
    |
140 |                     db.session.commit()
141 |         except Exception:
142 |             logging.exception("写入结构化日志到数据库失败")
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
143 |             with contextlib.suppress(Exception):
144 |                 db.session.rollback()
    |
help: Use own logger instead

D205 1 blank line required between summary line and description
 --> app/utils/password_crypto_utils.py:1:1
  |
1 | / """密码管理工具
2 | | 用于安全地存储和获取数据库密码.
3 | | """
  | |___^
4 |
5 |   import base64
  |
help: Insert single blank line

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/password_crypto_utils.py:15:39
   |
14 |     使用 Fernet 对称加密算法安全地加密和解密数据库密码。
15 |     密钥从环境变量 PASSWORD_ENCRYPTION_KEY 读取，如果未设置则生成临时密钥。
   |                                                ^^
16 |
17 |     Attributes:
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/utils/password_crypto_utils.py:18:18
   |
17 |     Attributes:
18 |         key: 加密密钥（bytes）。
   |                      ^^
19 |         cipher: Fernet 加密器实例。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/utils/password_crypto_utils.py:18:24
   |
17 |     Attributes:
18 |         key: 加密密钥（bytes）。
   |                             ^^
19 |         cipher: Fernet 加密器实例。
   |

D107 Missing docstring in `__init__`
  --> app/utils/password_crypto_utils.py:30:9
   |
28 |     """
29 |
30 |     def __init__(self) -> None:
   |         ^^^^^^^^
31 |         self.key = self._get_or_create_key()
32 |         self.cipher = Fernet(self.key)
   |

ANN202 Missing return type annotation for private function `_get_or_create_key`
  --> app/utils/password_crypto_utils.py:34:9
   |
32 |         self.cipher = Fernet(self.key)
33 |
34 |     def _get_or_create_key(self):
   |         ^^^^^^^^^^^^^^^^^^
35 |         """获取或创建加密密钥。.
   |
help: Add return type annotation

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/password_crypto_utils.py:37:43
   |
35 |         """获取或创建加密密钥。.
36 |
37 |         从环境变量 PASSWORD_ENCRYPTION_KEY 读取密钥，如果未设置则生成新密钥。
   |                                                    ^^
38 |         生成新密钥时会记录警告日志并提示设置环境变量。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/utils/password_crypto_utils.py:41:17
   |
40 |         Returns:
41 |             加密密钥（bytes）。
   |                     ^^
42 |
43 |         """
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/utils/password_crypto_utils.py:41:23
   |
40 |         Returns:
41 |             加密密钥（bytes）。
   |                            ^^
42 |
43 |         """
   |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/password_crypto_utils.py:46:23
   |
44 |         key = os.getenv("PASSWORD_ENCRYPTION_KEY")
45 |         if not key:
46 |             # 如果没有设置密钥，生成一个新的
   |                               ^^
47 |             key = Fernet.generate_key()
48 |             # 延迟导入避免循环导入
   |

PLC0415 `import` should be at the top-level of a file
  --> app/utils/password_crypto_utils.py:50:17
   |
48 |             # 延迟导入避免循环导入
49 |             try:
50 |                 from app.utils.structlog_config import get_system_logger
   |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
51 |                 system_logger = get_system_logger()
52 |                 system_logger.warning("没有设置PASSWORD_ENCRYPTION_KEY环境变量", module="password_manager")
   |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/password_crypto_utils.py:60:31
   |
58 |                 )
59 |             except ImportError:
60 |                 # 如果无法导入logger，使用print输出
   |                                     ^^
61 |                 pass
62 |         else:
   |

PLC0415 `import` should be at the top-level of a file
   --> app/utils/password_crypto_utils.py:101:13
    |
 99 |             return decrypted.decode()
100 |         except Exception as e:
101 |             from app.utils.structlog_config import get_system_logger
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
102 |
103 |             system_logger = get_system_logger()
    |

TRY300 Consider moving this statement to an `else` block
   --> app/utils/password_crypto_utils.py:127:13
    |
125 |         try:
126 |             base64.b64decode(password.encode())
127 |             return True
    |             ^^^^^^^^^^^
128 |         except Exception:
129 |             return False
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/utils/password_crypto_utils.py:128:16
    |
126 |             base64.b64decode(password.encode())
127 |             return True
128 |         except Exception:
    |                ^^^^^^^^^
129 |             return False
    |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/utils/password_crypto_utils.py:132:12
    |
132 | # 全局密码管理器实例（延迟初始化）
    |                     ^^
133 | _password_manager = None
    |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/utils/password_crypto_utils.py:132:18
    |
132 | # 全局密码管理器实例（延迟初始化）
    |                                 ^^
133 | _password_manager = None
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/utils/password_crypto_utils.py:136:17
    |
135 | def get_password_manager() -> PasswordManager:
136 |     """获取密码管理器实例（延迟初始化）。.
    |                          ^^
137 |
138 |     Returns:
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/utils/password_crypto_utils.py:136:23
    |
135 | def get_password_manager() -> PasswordManager:
136 |     """获取密码管理器实例（延迟初始化）。.
    |                                      ^^
137 |
138 |     Returns:
    |

PLW0603 Using the global statement to update `_password_manager` is discouraged
   --> app/utils/password_crypto_utils.py:142:12
    |
141 |     """
142 |     global _password_manager
    |            ^^^^^^^^^^^^^^^^^
143 |     if _password_manager is None:
144 |         _password_manager = PasswordManager()
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/password_crypto_utils.py:147:9
    |
145 |     return _password_manager
146 |
147 | # 为了向后兼容，保留password_manager变量
    |               ^^
148 | password_manager = None
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/utils/query_filter_utils.py:3:22
  |
1 | """统一筛选器数据访问工具.
2 |
3 | 负责提供所有需要从数据库动态获取的筛选数据，避免在视图或模板中重复查询。
  |                                           ^^
4 | """
  |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/query_filter_utils.py:24:19
   |
23 | def get_active_tags() -> list[Tag]:
24 |     """获取所有激活状态的标签，按分类与显示名称排序。.
   |                              ^^
25 |
26 |     Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/query_filter_utils.py:27:15
   |
26 |     Returns:
27 |         标签对象列表，按 category、display_name、name 排序。
   |                     ^^
28 |
29 |     Example:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/query_filter_utils.py:46:15
   |
45 |     Returns:
46 |         标签选项列表，每个选项包含：
   |                     ^^
47 |         - value: 标签名称
48 |         - label: 显示名称
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/utils/query_filter_utils.py:46:22
   |
45 |     Returns:
46 |         标签选项列表，每个选项包含：
   |                                   ^^
47 |         - value: 标签名称
48 |         - label: 显示名称
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/query_filter_utils.py:73:25
   |
71 |     """获取当前存在的标签分类。.
72 |
73 |     分类展示名称优先使用 Tag 内置的映射，若找不到则退回原始分类值。
   |                                        ^^
74 |
75 |     Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/query_filter_utils.py:76:15
   |
75 |     Returns:
76 |         分类选项列表，每个选项包含：
   |                     ^^
77 |         - value: 分类值
78 |         - label: 分类显示名称
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/utils/query_filter_utils.py:76:22
   |
75 |     Returns:
76 |         分类选项列表，每个选项包含：
   |                                   ^^
77 |         - value: 分类值
78 |         - label: 分类显示名称
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/query_filter_utils.py:106:17
    |
105 | def get_classifications() -> list[AccountClassification]:
106 |     """获取可用的账户分类，按优先级与名称排序。.
    |                          ^^
107 |
108 |     Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/query_filter_utils.py:109:17
    |
108 |     Returns:
109 |         账户分类对象列表，按 priority 降序、name 升序排列。
    |                         ^^
110 |
111 |     Example:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/query_filter_utils.py:128:15
    |
127 |     Returns:
128 |         分类选项列表，每个选项包含：
    |                     ^^
129 |         - value: 分类 ID（字符串）
130 |         - label: 分类名称
    |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/utils/query_filter_utils.py:128:22
    |
127 |     Returns:
128 |         分类选项列表，每个选项包含：
    |                                   ^^
129 |         - value: 分类 ID（字符串）
130 |         - label: 分类名称
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/utils/query_filter_utils.py:129:23
    |
127 |     Returns:
128 |         分类选项列表，每个选项包含：
129 |         - value: 分类 ID（字符串）
    |                         ^^
130 |         - label: 分类名称
131 |         - color: 分类颜色
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/utils/query_filter_utils.py:129:27
    |
127 |     Returns:
128 |         分类选项列表，每个选项包含：
129 |         - value: 分类 ID（字符串）
    |                                 ^^
130 |         - label: 分类名称
131 |         - color: 分类颜色
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/query_filter_utils.py:147:14
    |
146 | def get_instances_by_db_type(db_type: str | None = None, *, include_inactive: bool = False) -> list[Instance]:
147 |     """获取实例列表，可选按数据库类型过滤。.
    |                    ^^
148 |
149 |     Args:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/query_filter_utils.py:150:25
    |
149 |     Args:
150 |         db_type: 数据库类型标识，例如 mysql、postgresql。
    |                                ^^
151 |         include_inactive: 是否包含已禁用的实例。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/query_filter_utils.py:154:23
    |
153 |     Returns:
154 |         指定过滤条件下的实例对象列表，按名称升序排列。
    |                                     ^^
155 |
156 |     """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/query_filter_utils.py:172:15
    |
171 |     Returns:
172 |         实例选项列表，每个选项包含：
    |                     ^^
173 |         - value: 实例 ID（字符串）
174 |         - label: 实例显示名称（包含数据库类型）
    |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/utils/query_filter_utils.py:172:22
    |
171 |     Returns:
172 |         实例选项列表，每个选项包含：
    |                                   ^^
173 |         - value: 实例 ID（字符串）
174 |         - label: 实例显示名称（包含数据库类型）
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/utils/query_filter_utils.py:173:23
    |
171 |     Returns:
172 |         实例选项列表，每个选项包含：
173 |         - value: 实例 ID（字符串）
    |                         ^^
174 |         - label: 实例显示名称（包含数据库类型）
175 |         - db_type: 数据库类型
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/utils/query_filter_utils.py:173:27
    |
171 |     Returns:
172 |         实例选项列表，每个选项包含：
173 |         - value: 实例 ID（字符串）
    |                                 ^^
174 |         - label: 实例显示名称（包含数据库类型）
175 |         - db_type: 数据库类型
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/utils/query_filter_utils.py:174:24
    |
172 |         实例选项列表，每个选项包含：
173 |         - value: 实例 ID（字符串）
174 |         - label: 实例显示名称（包含数据库类型）
    |                              ^^
175 |         - db_type: 数据库类型
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/utils/query_filter_utils.py:174:32
    |
172 |         实例选项列表，每个选项包含：
173 |         - value: 实例 ID（字符串）
174 |         - label: 实例显示名称（包含数据库类型）
    |                                              ^^
175 |         - db_type: 数据库类型
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/query_filter_utils.py:195:25
    |
194 | def get_databases_by_instance(instance_id: int) -> list[InstanceDatabase]:
195 |     """获取指定实例下仍然活跃的数据库列表，按名称排序。.
    |                                          ^^
196 |
197 |     Args:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/query_filter_utils.py:201:16
    |
200 |     Returns:
201 |         数据库对象列表，按 database_name 排序。
    |                       ^^
202 |
203 |     Example:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/query_filter_utils.py:225:16
    |
224 |     Returns:
225 |         数据库选项列表，每个选项包含：
    |                       ^^
226 |         - value: 数据库 ID（字符串）
227 |         - label: 数据库名称
    |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/utils/query_filter_utils.py:225:23
    |
224 |     Returns:
225 |         数据库选项列表，每个选项包含：
    |                                     ^^
226 |         - value: 数据库 ID（字符串）
227 |         - label: 数据库名称
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/utils/query_filter_utils.py:226:24
    |
224 |     Returns:
225 |         数据库选项列表，每个选项包含：
226 |         - value: 数据库 ID（字符串）
    |                           ^^
227 |         - label: 数据库名称
228 |         - name: 数据库名称
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/utils/query_filter_utils.py:226:28
    |
224 |     Returns:
225 |         数据库选项列表，每个选项包含：
226 |         - value: 数据库 ID（字符串）
    |                                   ^^
227 |         - label: 数据库名称
228 |         - name: 数据库名称
    |

RUF002 Docstring contains ambiguous `；` (FULLWIDTH SEMICOLON). Did you mean `;` (SEMICOLON)?
   --> app/utils/query_filter_utils.py:251:37
    |
250 |     Args:
251 |         limit_hours: 限制只统计最近多少小时内的日志；为 None 时无限制。
    |                                                    ^^
252 |
253 |     Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/query_filter_utils.py:254:15
    |
253 |     Returns:
254 |         模块名称列表，按字母顺序排序。
    |                     ^^
255 |
256 |     Example:
    |

PLC0415 `import` should be at the top-level of a file
   --> app/utils/query_filter_utils.py:264:9
    |
262 |     query = db.session.query(distinct(UnifiedLog.module))
263 |     if limit_hours is not None:
264 |         from datetime import timedelta
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
265 |
266 |         from app.utils.time_utils import time_utils
    |

PLC0415 `import` should be at the top-level of a file
   --> app/utils/query_filter_utils.py:266:9
    |
264 |         from datetime import timedelta
265 |
266 |         from app.utils.time_utils import time_utils
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
267 |
268 |         start_time = time_utils.now() - timedelta(hours=limit_hours)
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/rate_limiter.py:22:21
   |
20 |     """速率限制器。.
21 |
22 |     基于滑动窗口算法实现的速率限制器，支持缓存和内存两种存储方式。
   |                                     ^^
23 |     当缓存不可用时自动降级到内存模式。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/rate_limiter.py:26:34
   |
25 |     Attributes:
26 |         cache: Flask-Caching 缓存实例，可选。
   |                                      ^^
27 |         memory_store: 内存存储字典，用于无缓存环境。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/rate_limiter.py:27:29
   |
25 |     Attributes:
26 |         cache: Flask-Caching 缓存实例，可选。
27 |         memory_store: 内存存储字典，用于无缓存环境。
   |                                   ^^
28 |
29 |     Example:
   |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/rate_limiter.py:39:39
   |
37 |     def __init__(self, cache: Cache = None) -> None:
38 |         self.cache = cache
39 |         self.memory_store = {}  # 内存存储，用于无缓存环境
   |                                           ^^
40 |
41 |     def _get_key(self, identifier: str, endpoint: str) -> str:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/rate_limiter.py:45:30
   |
44 |         Args:
45 |             identifier: 唯一标识符，例如 IP 地址或用户 ID。
   |                                   ^^
46 |             endpoint: 端点名称。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/rate_limiter.py:49:19
   |
48 |         Returns:
49 |             缓存键字符串，格式：'rate_limit:endpoint:identifier'。
   |                         ^^
50 |
51 |         """
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/utils/rate_limiter.py:49:22
   |
48 |         Returns:
49 |             缓存键字符串，格式：'rate_limit:endpoint:identifier'。
   |                               ^^
50 |
51 |         """
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/rate_limiter.py:62:19
   |
61 |         Returns:
62 |             内存键字符串，格式：'endpoint:identifier'。
   |                         ^^
63 |
64 |         """
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/utils/rate_limiter.py:62:22
   |
61 |         Returns:
62 |             内存键字符串，格式：'endpoint:identifier'。
   |                               ^^
63 |
64 |         """
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/utils/rate_limiter.py:71:29
   |
70 |         Args:
71 |             identifier: 唯一标识（IP 或用户 ID）。
   |                                 ^^
72 |             endpoint: 限流的端点名称。
73 |             limit: 允许的请求次数。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/utils/rate_limiter.py:71:39
   |
70 |         Args:
71 |             identifier: 唯一标识（IP 或用户 ID）。
   |                                               ^^
72 |             endpoint: 限流的端点名称。
73 |             limit: 允许的请求次数。
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/utils/rate_limiter.py:74:25
   |
72 |             endpoint: 限流的端点名称。
73 |             limit: 允许的请求次数。
74 |             window: 时间窗口（秒）。
   |                             ^^
75 |
76 |         Returns:
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/utils/rate_limiter.py:74:27
   |
72 |             endpoint: 限流的端点名称。
73 |             limit: 允许的请求次数。
74 |             window: 时间窗口（秒）。
   |                                 ^^
75 |
76 |         Returns:
   |

BLE001 Do not catch blind exception: `Exception`
  --> app/utils/rate_limiter.py:86:20
   |
84 |             try:
85 |                 return self._check_cache(identifier, endpoint, limit, window, current_time, window_start)
86 |             except Exception as e:
   |                    ^^^^^^^^^
87 |                 system_logger = get_system_logger()
88 |                 system_logger.warning(
   |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/rate_limiter.py:89:32
   |
87 |                 system_logger = get_system_logger()
88 |                 system_logger.warning(
89 |                     "缓存速率限制检查失败，降级到内存模式",
   |                                          ^^
90 |                     module="rate_limiter",
91 |                     exception=str(e),
   |

PLR0913 Too many arguments in function definition (6 > 5)
   --> app/utils/rate_limiter.py:98:9
    |
 96 |             return self._check_memory(identifier, endpoint, limit, window, current_time, window_start)
 97 |
 98 |     def _check_cache(
    |         ^^^^^^^^^^^^
 99 |         self,
100 |         identifier: str,
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/utils/rate_limiter.py:113:25
    |
111 |             endpoint: 端点名称。
112 |             limit: 限制次数。
113 |             window: 时间窗口（秒）。
    |                             ^^
114 |             current_time: 当前时间戳。
115 |             window_start: 窗口起始时间戳。
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/utils/rate_limiter.py:113:27
    |
111 |             endpoint: 端点名称。
112 |             limit: 限制次数。
113 |             window: 时间窗口（秒）。
    |                                 ^^
114 |             current_time: 当前时间戳。
115 |             window_start: 窗口起始时间戳。
    |

PLR0913 Too many arguments in function definition (6 > 5)
   --> app/utils/rate_limiter.py:151:9
    |
149 |         }
150 |
151 |     def _check_memory(
    |         ^^^^^^^^^^^^^
152 |         self,
153 |         identifier: str,
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/rate_limiter.py:160:19
    |
158 |         window_start: int,
159 |     ) -> dict[str, Any]:
160 |         """在无缓存情况下，使用内存列表进行限流。.
    |                          ^^
161 |
162 |         Args:
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/utils/rate_limiter.py:166:25
    |
164 |             endpoint: 端点名称。
165 |             limit: 限制次数。
166 |             window: 时间窗口（秒）。
    |                             ^^
167 |             current_time: 当前时间戳。
168 |             window_start: 窗口起始时间戳。
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/utils/rate_limiter.py:166:27
    |
164 |             endpoint: 端点名称。
165 |             limit: 限制次数。
166 |             window: 时间窗口（秒）。
    |                                 ^^
167 |             current_time: 当前时间戳。
168 |             window_start: 窗口起始时间戳。
    |

ANN201 Missing return type annotation for public function `login_rate_limit`
   --> app/utils/rate_limiter.py:207:5
    |
207 | def login_rate_limit(func=None, *, limit: int | None = None, window: int | None = None):
    |     ^^^^^^^^^^^^^^^^
208 |     """登录接口速率限制装饰器。.
    |
help: Add return type annotation

ANN001 Missing type annotation for function argument `func`
   --> app/utils/rate_limiter.py:207:22
    |
207 | def login_rate_limit(func=None, *, limit: int | None = None, window: int | None = None):
    |                      ^^^^
208 |     """登录接口速率限制装饰器。.
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/utils/rate_limiter.py:213:26
    |
211 |         func: 被装饰的函数。
212 |         limit: 可选自定义限制次数。
213 |         window: 可选自定义时间窗口（秒）。
    |                                   ^^
214 |
215 |     Returns:
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/utils/rate_limiter.py:213:28
    |
211 |         func: 被装饰的函数。
212 |         limit: 可选自定义限制次数。
213 |         window: 可选自定义时间窗口（秒）。
    |                                       ^^
214 |
215 |     Returns:
    |

PLC0415 `import` should be at the top-level of a file
   --> app/utils/rate_limiter.py:219:5
    |
218 |     """
219 |     from app.config import Config
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
220 |
221 |     if limit is None:
    |

ANN202 Missing return type annotation for private function `wrapped`
   --> app/utils/rate_limiter.py:228:13
    |
226 |     def decorator(f: Callable) -> Callable:
227 |         @wraps(f)
228 |         def wrapped(*args, **kwargs):
    |             ^^^^^^^
229 |             if request.method.upper() in SAFE_METHODS:
230 |                 return f(*args, **kwargs)
    |
help: Add return type annotation

ANN002 Missing type annotation for `*args`
   --> app/utils/rate_limiter.py:228:21
    |
226 |     def decorator(f: Callable) -> Callable:
227 |         @wraps(f)
228 |         def wrapped(*args, **kwargs):
    |                     ^^^^^
229 |             if request.method.upper() in SAFE_METHODS:
230 |                 return f(*args, **kwargs)
    |

ANN003 Missing type annotation for `**kwargs`
   --> app/utils/rate_limiter.py:228:28
    |
226 |     def decorator(f: Callable) -> Callable:
227 |         @wraps(f)
228 |         def wrapped(*args, **kwargs):
    |                            ^^^^^^^^
229 |             if request.method.upper() in SAFE_METHODS:
230 |                 return f(*args, **kwargs)
    |

ANN201 Missing return type annotation for public function `password_reset_rate_limit`
   --> app/utils/rate_limiter.py:291:5
    |
291 | def password_reset_rate_limit(func=None, *, limit: int | None = None, window: int | None = None):
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^
292 |     """密码重置速率限制装饰器。.
    |
help: Add return type annotation

ANN001 Missing type annotation for function argument `func`
   --> app/utils/rate_limiter.py:291:31
    |
291 | def password_reset_rate_limit(func=None, *, limit: int | None = None, window: int | None = None):
    |                               ^^^^
292 |     """密码重置速率限制装饰器。.
    |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/utils/rate_limiter.py:294:9
    |
292 |     """密码重置速率限制装饰器。.
293 |
294 |     默认限制：3 次/小时。
    |             ^^
295 |
296 |     Args:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/rate_limiter.py:298:25
    |
296 |     Args:
297 |         func: 被装饰的函数。
298 |         limit: 可选自定义限制次数，默认 3 次。
    |                                  ^^
299 |         window: 可选自定义时间窗口（秒），默认 1 小时。
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/utils/rate_limiter.py:299:26
    |
297 |         func: 被装饰的函数。
298 |         limit: 可选自定义限制次数，默认 3 次。
299 |         window: 可选自定义时间窗口（秒），默认 1 小时。
    |                                   ^^
300 |
301 |     Returns:
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/utils/rate_limiter.py:299:28
    |
297 |         func: 被装饰的函数。
298 |         limit: 可选自定义限制次数，默认 3 次。
299 |         window: 可选自定义时间窗口（秒），默认 1 小时。
    |                                       ^^
300 |
301 |     Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/rate_limiter.py:299:29
    |
297 |         func: 被装饰的函数。
298 |         limit: 可选自定义限制次数，默认 3 次。
299 |         window: 可选自定义时间窗口（秒），默认 1 小时。
    |                                         ^^
300 |
301 |     Returns:
    |

PLC0415 `import` should be at the top-level of a file
   --> app/utils/rate_limiter.py:310:5
    |
309 |     """
310 |     from app.config import Config
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
311 |
312 |     if limit is None:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/rate_limiter.py:326:34
    |
325 |     Args:
326 |         cache: Flask-Caching 缓存实例，可选。如果不提供则使用内存模式。
    |                                      ^^
327 |
328 |     Returns:
    |

PLW0603 Using the global statement to update `rate_limiter` is discouraged
   --> app/utils/rate_limiter.py:337:12
    |
336 |     """
337 |     global rate_limiter
    |            ^^^^^^^^^^^^
338 |     rate_limiter = RateLimiter(cache)
339 |     system_logger = get_system_logger()
    |

D205 1 blank line required between summary line and description
 --> app/utils/response_utils.py:1:1
  |
1 | / """鲸落 - 统一响应工具
2 | | 提供统一的成功/错误响应结构，避免在业务层散落 JSON 拼装逻辑.
3 | | """
  | |___^
4 |
5 |   from __future__ import annotations
  |
help: Insert single blank line

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/utils/response_utils.py:2:15
  |
1 | """鲸落 - 统一响应工具
2 | 提供统一的成功/错误响应结构，避免在业务层散落 JSON 拼装逻辑.
  |                            ^^
3 | """
  |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `data`
  --> app/utils/response_utils.py:22:11
   |
21 | def unified_success_response(
22 |     data: Any | None = None,
   |           ^^^^^^^^^^
23 |     message: str | None = None,
24 |     *,
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/response_utils.py:31:19
   |
30 |     Args:
31 |         data: 响应数据，可选。
   |                       ^^
32 |         message: 成功消息，可选，默认为"操作成功"。
33 |         status: HTTP 状态码，默认为 200。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/response_utils.py:32:22
   |
30 |     Args:
31 |         data: 响应数据，可选。
32 |         message: 成功消息，可选，默认为"操作成功"。
   |                          ^^
33 |         status: HTTP 状态码，默认为 200。
34 |         meta: 元数据，可选。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/response_utils.py:32:25
   |
30 |     Args:
31 |         data: 响应数据，可选。
32 |         message: 成功消息，可选，默认为"操作成功"。
   |                                ^^
33 |         status: HTTP 状态码，默认为 200。
34 |         meta: 元数据，可选。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/response_utils.py:33:25
   |
31 |         data: 响应数据，可选。
32 |         message: 成功消息，可选，默认为"操作成功"。
33 |         status: HTTP 状态码，默认为 200。
   |                            ^^
34 |         meta: 元数据，可选。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/response_utils.py:34:18
   |
32 |         message: 成功消息，可选，默认为"操作成功"。
33 |         status: HTTP 状态码，默认为 200。
34 |         meta: 元数据，可选。
   |                     ^^
35 |
36 |     Returns:
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/utils/response_utils.py:37:18
   |
36 |     Returns:
37 |         包含两个元素的元组：
   |                           ^^
38 |         - 响应载荷字典
39 |         - HTTP 状态码
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/response_utils.py:66:30
   |
64 |     Args:
65 |         error: 异常对象。
66 |         status_code: HTTP 状态码，可选，默认根据异常类型自动映射。
   |                                 ^^
67 |         extra: 额外的错误信息，可选。
68 |         context: 错误上下文，可选。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/response_utils.py:66:33
   |
64 |     Args:
65 |         error: 异常对象。
66 |         status_code: HTTP 状态码，可选，默认根据异常类型自动映射。
   |                                       ^^
67 |         extra: 额外的错误信息，可选。
68 |         context: 错误上下文，可选。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/response_utils.py:67:23
   |
65 |         error: 异常对象。
66 |         status_code: HTTP 状态码，可选，默认根据异常类型自动映射。
67 |         extra: 额外的错误信息，可选。
   |                              ^^
68 |         context: 错误上下文，可选。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/response_utils.py:68:23
   |
66 |         status_code: HTTP 状态码，可选，默认根据异常类型自动映射。
67 |         extra: 额外的错误信息，可选。
68 |         context: 错误上下文，可选。
   |                            ^^
69 |
70 |     Returns:
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/utils/response_utils.py:71:18
   |
70 |     Returns:
71 |         包含两个元素的元组：
   |                           ^^
72 |         - 错误响应载荷字典
73 |         - HTTP 状态码
   |

ANN201 Missing return type annotation for public function `jsonify_unified_success`
  --> app/utils/response_utils.py:83:5
   |
83 | def jsonify_unified_success(*args, **kwargs):
   |     ^^^^^^^^^^^^^^^^^^^^^^^
84 |     """返回 Flask Response 对象的成功响应便捷函数。.
   |
help: Add return type annotation

ANN002 Missing type annotation for `*args`
  --> app/utils/response_utils.py:83:29
   |
83 | def jsonify_unified_success(*args, **kwargs):
   |                             ^^^^^
84 |     """返回 Flask Response 对象的成功响应便捷函数。.
   |

ANN003 Missing type annotation for `**kwargs`
  --> app/utils/response_utils.py:83:36
   |
83 | def jsonify_unified_success(*args, **kwargs):
   |                                    ^^^^^^^^
84 |     """返回 Flask Response 对象的成功响应便捷函数。.
   |

ANN201 Missing return type annotation for public function `jsonify_unified_error`
  --> app/utils/response_utils.py:98:5
   |
98 | def jsonify_unified_error(*args, **kwargs):
   |     ^^^^^^^^^^^^^^^^^^^^^
99 |     """返回 Flask Response 对象的错误响应便捷函数。.
   |
help: Add return type annotation

ANN002 Missing type annotation for `*args`
  --> app/utils/response_utils.py:98:27
   |
98 | def jsonify_unified_error(*args, **kwargs):
   |                           ^^^^^
99 |     """返回 Flask Response 对象的错误响应便捷函数。.
   |

ANN003 Missing type annotation for `**kwargs`
  --> app/utils/response_utils.py:98:34
   |
98 | def jsonify_unified_error(*args, **kwargs):
   |                                  ^^^^^^^^
99 |     """返回 Flask Response 对象的错误响应便捷函数。.
   |

PLR0913 Too many arguments in function definition (6 > 5)
   --> app/utils/response_utils.py:113:5
    |
113 | def jsonify_unified_error_message(
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
114 |     message: str,
115 |     *,
    |

ANN201 Missing return type annotation for public function `jsonify_unified_error_message`
   --> app/utils/response_utils.py:113:5
    |
113 | def jsonify_unified_error_message(
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
114 |     message: str,
115 |     *,
    |
help: Add return type annotation

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/response_utils.py:126:30
    |
124 |     Args:
125 |         message: 错误消息。
126 |         status_code: HTTP 状态码，默认为 400。
    |                                 ^^
127 |         message_key: 消息键，默认为 'INVALID_REQUEST'。
128 |         category: 错误类别，可选。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/response_utils.py:127:25
    |
125 |         message: 错误消息。
126 |         status_code: HTTP 状态码，默认为 400。
127 |         message_key: 消息键，默认为 'INVALID_REQUEST'。
    |                            ^^
128 |         category: 错误类别，可选。
129 |         severity: 错误严重程度，可选。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/response_utils.py:128:23
    |
126 |         status_code: HTTP 状态码，默认为 400。
127 |         message_key: 消息键，默认为 'INVALID_REQUEST'。
128 |         category: 错误类别，可选。
    |                           ^^
129 |         severity: 错误严重程度，可选。
130 |         extra: 额外的错误信息，可选。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/response_utils.py:129:25
    |
127 |         message_key: 消息键，默认为 'INVALID_REQUEST'。
128 |         category: 错误类别，可选。
129 |         severity: 错误严重程度，可选。
    |                               ^^
130 |         extra: 额外的错误信息，可选。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/response_utils.py:130:23
    |
128 |         category: 错误类别，可选。
129 |         severity: 错误严重程度，可选。
130 |         extra: 额外的错误信息，可选。
    |                              ^^
131 |
132 |     Returns:
    |

D205 1 blank line required between summary line and description
 --> app/utils/safe_query_builder.py:1:1
  |
1 | / """鲸落 - 安全查询构建器
2 | | 提供安全的SQL查询构建功能，防止SQL注入攻击
3 | | 支持MySQL、PostgreSQL、SQL Server、Oracle等多种数据库.
4 | | """
  | |___^
5 |
6 |   from typing import Any
  |
help: Insert single blank line

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/utils/safe_query_builder.py:2:15
  |
1 | """鲸落 - 安全查询构建器
2 | 提供安全的SQL查询构建功能，防止SQL注入攻击
  |                          ^^
3 | 支持MySQL、PostgreSQL、SQL Server、Oracle等多种数据库.
4 | """
  |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/safe_query_builder.py:14:21
   |
12 |     """安全查询构建器 - 多数据库支持版。.
13 |
14 |     提供安全的 SQL 查询构建功能，防止 SQL 注入攻击。
   |                                ^^
15 |     根据不同数据库类型使用相应的参数占位符和参数格式。
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/utils/safe_query_builder.py:17:13
   |
15 |     根据不同数据库类型使用相应的参数占位符和参数格式。
16 |
17 |     支持的数据库类型：
   |                     ^^
18 |     - MySQL: 使用 %s 占位符，返回 list 参数
19 |     - PostgreSQL: 使用 %s 占位符，返回 list 参数
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/safe_query_builder.py:18:23
   |
17 |     支持的数据库类型：
18 |     - MySQL: 使用 %s 占位符，返回 list 参数
   |                            ^^
19 |     - PostgreSQL: 使用 %s 占位符，返回 list 参数
20 |     - SQL Server: 使用 %s 占位符，返回 list 参数
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/safe_query_builder.py:19:28
   |
17 |     支持的数据库类型：
18 |     - MySQL: 使用 %s 占位符，返回 list 参数
19 |     - PostgreSQL: 使用 %s 占位符，返回 list 参数
   |                                 ^^
20 |     - SQL Server: 使用 %s 占位符，返回 list 参数
21 |     - Oracle: 使用 :name 占位符，返回 dict 参数
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/safe_query_builder.py:20:28
   |
18 |     - MySQL: 使用 %s 占位符，返回 list 参数
19 |     - PostgreSQL: 使用 %s 占位符，返回 list 参数
20 |     - SQL Server: 使用 %s 占位符，返回 list 参数
   |                                 ^^
21 |     - Oracle: 使用 :name 占位符，返回 dict 参数
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/safe_query_builder.py:21:27
   |
19 |     - PostgreSQL: 使用 %s 占位符，返回 list 参数
20 |     - SQL Server: 使用 %s 占位符，返回 list 参数
21 |     - Oracle: 使用 :name 占位符，返回 dict 参数
   |                                ^^
22 |
23 |     Attributes:
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/utils/safe_query_builder.py:26:25
   |
24 |         db_type: 数据库类型。
25 |         conditions: 查询条件列表。
26 |         parameters: 参数列表（MySQL/PostgreSQL/SQL Server）或参数字典（Oracle）。
   |                             ^^
27 |
28 |     Example:
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/utils/safe_query_builder.py:26:53
   |
24 |         db_type: 数据库类型。
25 |         conditions: 查询条件列表。
26 |         parameters: 参数列表（MySQL/PostgreSQL/SQL Server）或参数字典（Oracle）。
   |                                                          ^^
27 |
28 |     Example:
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/utils/safe_query_builder.py:26:59
   |
24 |         db_type: 数据库类型。
25 |         conditions: 查询条件列表。
26 |         parameters: 参数列表（MySQL/PostgreSQL/SQL Server）或参数字典（Oracle）。
   |                                                                      ^^
27 |
28 |     Example:
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/utils/safe_query_builder.py:26:66
   |
24 |         db_type: 数据库类型。
25 |         conditions: 查询条件列表。
26 |         parameters: 参数列表（MySQL/PostgreSQL/SQL Server）或参数字典（Oracle）。
   |                                                                              ^^
27 |
28 |     Example:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/safe_query_builder.py:40:27
   |
39 |         Args:
40 |             db_type: 数据库类型，可选值：'mysql'、'postgresql'、'sqlserver'、'oracle'。
   |                                ^^
41 |                 默认为 'mysql'。
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/utils/safe_query_builder.py:40:31
   |
39 |         Args:
40 |             db_type: 数据库类型，可选值：'mysql'、'postgresql'、'sqlserver'、'oracle'。
   |                                        ^^
41 |                 默认为 'mysql'。
   |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `*params`
  --> app/utils/safe_query_builder.py:54:54
   |
52 |             self.parameters: list[Any] = []
53 |
54 |     def add_condition(self, condition: str, *params: Any) -> "SafeQueryBuilder":
   |                                                      ^^^
55 |         """添加查询条件。.
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/safe_query_builder.py:57:59
   |
55 |         """添加查询条件。.
56 |
57 |         根据数据库类型自动转换占位符格式。MySQL/PostgreSQL/SQL Server 使用 %s，
   |                                                                              ^^
58 |         Oracle 使用 :param_N 格式。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/safe_query_builder.py:61:33
   |
60 |         Args:
61 |             condition: SQL 条件字符串，使用 %s 作为占位符。
   |                                      ^^
62 |                 例如：'username = %s' 或 'age > %s AND status = %s'。
63 |             *params: 参数值，按顺序对应条件中的占位符。
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/utils/safe_query_builder.py:62:19
   |
60 |         Args:
61 |             condition: SQL 条件字符串，使用 %s 作为占位符。
62 |                 例如：'username = %s' 或 'age > %s AND status = %s'。
   |                     ^^
63 |             *params: 参数值，按顺序对应条件中的占位符。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/safe_query_builder.py:63:25
   |
61 |             condition: SQL 条件字符串，使用 %s 作为占位符。
62 |                 例如：'username = %s' 或 'age > %s AND status = %s'。
63 |             *params: 参数值，按顺序对应条件中的占位符。
   |                            ^^
64 |
65 |         Returns:
   |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/safe_query_builder.py:74:27
   |
72 |         """
73 |         if self.db_type == DatabaseType.ORACLE:
74 |             # Oracle使用命名参数，需要转换占位符
   |                                 ^^
75 |             oracle_condition = condition
76 |             param_dict = {}
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/safe_query_builder.py:101:25
    |
100 |         Args:
101 |             count: 占位符数量，默认为 1。
    |                              ^^
102 |
103 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/safe_query_builder.py:104:19
    |
103 |         Returns:
104 |             占位符字符串，多个占位符用逗号分隔。
    |                         ^^
105 |             例如：'%s, %s, %s' 或 ':param_0, :param_1, :param_2'。
    |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/utils/safe_query_builder.py:105:15
    |
103 |         Returns:
104 |             占位符字符串，多个占位符用逗号分隔。
105 |             例如：'%s, %s, %s' 或 ':param_0, :param_1, :param_2'。
    |                 ^^
106 |
107 |         """
    |

ERA001 Found commented-out code
   --> app/utils/safe_query_builder.py:118:9
    |
116 |             # SQL Server使用%s占位符
117 |             return ", ".join(["%s"] * count)
118 |         # MySQL, PostgreSQL使用%s
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^
119 |         return ", ".join(["%s"] * count)
    |
help: Remove commented-out code

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/safe_query_builder.py:124:22
    |
122 |         """添加 IN 条件。.
123 |
124 |         生成安全的 IN 查询条件，防止 SQL 注入。
    |                               ^^
125 |
126 |         Args:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/safe_query_builder.py:127:23
    |
126 |         Args:
127 |             field: 字段名，例如 'status' 或 'user_id'。
    |                          ^^
128 |             values: 值列表，例如 ['active', 'pending'] 或 [1, 2, 3]。
129 |                 如果列表为空，不添加任何条件。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/safe_query_builder.py:128:24
    |
126 |         Args:
127 |             field: 字段名，例如 'status' 或 'user_id'。
128 |             values: 值列表，例如 ['active', 'pending'] 或 [1, 2, 3]。
    |                           ^^
129 |                 如果列表为空，不添加任何条件。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/safe_query_builder.py:129:23
    |
127 |             field: 字段名，例如 'status' 或 'user_id'。
128 |             values: 值列表，例如 ['active', 'pending'] 或 [1, 2, 3]。
129 |                 如果列表为空，不添加任何条件。
    |                             ^^
130 |
131 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/safe_query_builder.py:162:26
    |
160 |         """添加 NOT IN 条件。.
161 |
162 |         生成安全的 NOT IN 查询条件，防止 SQL 注入。
    |                                   ^^
163 |
164 |         Args:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/safe_query_builder.py:165:23
    |
164 |         Args:
165 |             field: 字段名，例如 'username' 或 'role_id'。
    |                          ^^
166 |             values: 值列表，例如 ['admin', 'root'] 或 [1, 2]。
167 |                 如果列表为空，不添加任何条件。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/safe_query_builder.py:166:24
    |
164 |         Args:
165 |             field: 字段名，例如 'username' 或 'role_id'。
166 |             values: 值列表，例如 ['admin', 'root'] 或 [1, 2]。
    |                           ^^
167 |                 如果列表为空，不添加任何条件。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/safe_query_builder.py:167:23
    |
165 |             field: 字段名，例如 'username' 或 'role_id'。
166 |             values: 值列表，例如 ['admin', 'root'] 或 [1, 2]。
167 |                 如果列表为空，不添加任何条件。
    |                             ^^
168 |
169 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/safe_query_builder.py:200:24
    |
198 |         """添加 LIKE 条件。.
199 |
200 |         生成安全的 LIKE 查询条件，防止 SQL 注入。
    |                                 ^^
201 |
202 |         Args:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/safe_query_builder.py:203:23
    |
202 |         Args:
203 |             field: 字段名，例如 'username' 或 'email'。
    |                          ^^
204 |             pattern: 模式字符串，例如 '%admin%' 或 'test_%'。
205 |                 需要包含通配符 % 或 _。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/safe_query_builder.py:204:27
    |
202 |         Args:
203 |             field: 字段名，例如 'username' 或 'email'。
204 |             pattern: 模式字符串，例如 '%admin%' 或 'test_%'。
    |                                ^^
205 |                 需要包含通配符 % 或 _。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/safe_query_builder.py:230:28
    |
228 |         """添加 NOT LIKE 条件。.
229 |
230 |         生成安全的 NOT LIKE 查询条件，防止 SQL 注入。
    |                                     ^^
231 |
232 |         Args:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/safe_query_builder.py:233:23
    |
232 |         Args:
233 |             field: 字段名，例如 'username' 或 'email'。
    |                          ^^
234 |             pattern: 模式字符串，例如 'test_%' 或 '%_backup'。
235 |                 需要包含通配符 % 或 _。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/safe_query_builder.py:234:27
    |
232 |         Args:
233 |             field: 字段名，例如 'username' 或 'email'。
234 |             pattern: 模式字符串，例如 'test_%' 或 '%_backup'。
    |                                ^^
235 |                 需要包含通配符 % 或 _。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/safe_query_builder.py:260:32
    |
258 |         """构建 WHERE 子句。.
259 |
260 |         将所有添加的条件组合成完整的 WHERE 子句，并返回对应的参数。
    |                                                ^^
261 |
262 |         Returns:
    |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/utils/safe_query_builder.py:263:26
    |
262 |         Returns:
263 |             根据数据库类型返回不同格式：
    |                                       ^^
264 |             - MySQL/PostgreSQL/SQL Server: (WHERE 子句字符串, 参数列表)
265 |             - Oracle: (WHERE 子句字符串, 参数字典)
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/safe_query_builder.py:266:19
    |
264 |             - MySQL/PostgreSQL/SQL Server: (WHERE 子句字符串, 参数列表)
265 |             - Oracle: (WHERE 子句字符串, 参数字典)
266 |             如果没有条件，返回 ('1=1', []) 或 ('1=1', {})。
    |                         ^^
267 |
268 |         Example:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/safe_query_builder.py:294:23
    |
293 |         Args:
294 |             field: 字段名，例如 'username'。
    |                          ^^
295 |             values: 排除的值列表，例如 ['admin', 'root']。
296 |             patterns: 排除的模式列表，例如 ['test_%', '%_backup']。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/safe_query_builder.py:295:27
    |
293 |         Args:
294 |             field: 字段名，例如 'username'。
295 |             values: 排除的值列表，例如 ['admin', 'root']。
    |                                 ^^
296 |             patterns: 排除的模式列表，例如 ['test_%', '%_backup']。
297 |             db_specific_rules: 数据库特定规则字典，默认为 None。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/safe_query_builder.py:296:30
    |
294 |             field: 字段名，例如 'username'。
295 |             values: 排除的值列表，例如 ['admin', 'root']。
296 |             patterns: 排除的模式列表，例如 ['test_%', '%_backup']。
    |                                     ^^
297 |             db_specific_rules: 数据库特定规则字典，默认为 None。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/safe_query_builder.py:297:41
    |
295 |             values: 排除的值列表，例如 ['admin', 'root']。
296 |             patterns: 排除的模式列表，例如 ['test_%', '%_backup']。
297 |             db_specific_rules: 数据库特定规则字典，默认为 None。
    |                                                  ^^
298 |
299 |         Returns:
    |

RUF003 Comment contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/utils/safe_query_builder.py:314:29
    |
312 |         # 处理排除用户
313 |         if values:
314 |             # PostgreSQL特殊处理：保留postgres用户
    |                                 ^^
315 |             if self.db_type == DatabaseType.POSTGRESQL and "postgres" in values:
316 |                 filtered_values = [v for v in values if v != "postgres"]
    |

RUF003 Comment contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/utils/safe_query_builder.py:324:29
    |
322 |         # 处理排除模式
323 |         for pattern in patterns:
324 |             # PostgreSQL特殊处理：pg_%模式不排除postgres用户
    |                                 ^^
325 |             if self.db_type == DatabaseType.POSTGRESQL and pattern == "pg_%":
326 |                 self.add_condition(f"({field} NOT LIKE %s OR {field} = %s)", pattern, "postgres")
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/safe_query_builder.py:335:18
    |
333 |         """重置构建器。.
334 |
335 |         清空所有条件和参数，恢复到初始状态。
    |                           ^^
336 |
337 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/safe_query_builder.py:363:23
    |
362 |     Args:
363 |         db_type: 数据库类型，可选值：'mysql'、'postgresql'、'sqlserver'、'oracle'。
    |                            ^^
364 |         username_field: 用户名字段名，例如 'username' 或 'account_name'。
365 |         filter_rules: 过滤规则字典，格式如下：
    |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/utils/safe_query_builder.py:363:27
    |
362 |     Args:
363 |         db_type: 数据库类型，可选值：'mysql'、'postgresql'、'sqlserver'、'oracle'。
    |                                    ^^
364 |         username_field: 用户名字段名，例如 'username' 或 'account_name'。
365 |         filter_rules: 过滤规则字典，格式如下：
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/safe_query_builder.py:364:31
    |
362 |     Args:
363 |         db_type: 数据库类型，可选值：'mysql'、'postgresql'、'sqlserver'、'oracle'。
364 |         username_field: 用户名字段名，例如 'username' 或 'account_name'。
    |                                     ^^
365 |         filter_rules: 过滤规则字典，格式如下：
366 |             {
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/safe_query_builder.py:365:29
    |
363 |         db_type: 数据库类型，可选值：'mysql'、'postgresql'、'sqlserver'、'oracle'。
364 |         username_field: 用户名字段名，例如 'username' 或 'account_name'。
365 |         filter_rules: 过滤规则字典，格式如下：
    |                                   ^^
366 |             {
367 |                 'mysql': {
    |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/utils/safe_query_builder.py:365:34
    |
363 |         db_type: 数据库类型，可选值：'mysql'、'postgresql'、'sqlserver'、'oracle'。
364 |         username_field: 用户名字段名，例如 'username' 或 'account_name'。
365 |         filter_rules: 过滤规则字典，格式如下：
    |                                             ^^
366 |             {
367 |                 'mysql': {
    |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/utils/safe_query_builder.py:374:22
    |
373 |     Returns:
374 |         根据数据库类型返回不同格式：
    |                                   ^^
375 |         - MySQL/PostgreSQL/SQL Server: (WHERE 子句, 参数列表)
376 |         - Oracle: (WHERE 子句, 参数字典)
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/safe_query_builder.py:395:9
    |
395 | # 为了向后兼容，添加一个便捷函数返回list格式的参数
    |               ^^
396 | def build_safe_filter_conditions_list(
397 |     db_type: str, username_field: str, filter_rules: dict[str, Any],
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/utils/safe_query_builder.py:399:32
    |
397 |     db_type: str, username_field: str, filter_rules: dict[str, Any],
398 | ) -> tuple[str, list[Any]]:
399 |     """构建安全的过滤条件 - 返回 list 格式参数（向后兼容）。.
    |                                               ^^
400 |
401 |     与 build_safe_filter_conditions 功能相同，但始终返回列表格式的参数。
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/utils/safe_query_builder.py:399:37
    |
397 |     db_type: str, username_field: str, filter_rules: dict[str, Any],
398 | ) -> tuple[str, list[Any]]:
399 |     """构建安全的过滤条件 - 返回 list 格式参数（向后兼容）。.
    |                                                         ^^
400 |
401 |     与 build_safe_filter_conditions 功能相同，但始终返回列表格式的参数。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/safe_query_builder.py:401:40
    |
399 |     """构建安全的过滤条件 - 返回 list 格式参数（向后兼容）。.
400 |
401 |     与 build_safe_filter_conditions 功能相同，但始终返回列表格式的参数。
    |                                             ^^
402 |     用于向后兼容不支持字典参数的代码。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/safe_query_builder.py:405:23
    |
404 |     Args:
405 |         db_type: 数据库类型，可选值：'mysql'、'postgresql'、'sqlserver'、'oracle'。
    |                            ^^
406 |         username_field: 用户名字段名，例如 'username' 或 'account_name'。
407 |         filter_rules: 过滤规则字典。
    |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/utils/safe_query_builder.py:405:27
    |
404 |     Args:
405 |         db_type: 数据库类型，可选值：'mysql'、'postgresql'、'sqlserver'、'oracle'。
    |                                    ^^
406 |         username_field: 用户名字段名，例如 'username' 或 'account_name'。
407 |         filter_rules: 过滤规则字典。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/safe_query_builder.py:406:31
    |
404 |     Args:
405 |         db_type: 数据库类型，可选值：'mysql'、'postgresql'、'sqlserver'、'oracle'。
406 |         username_field: 用户名字段名，例如 'username' 或 'account_name'。
    |                                     ^^
407 |         filter_rules: 过滤规则字典。
    |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/utils/safe_query_builder.py:410:28
    |
409 |     Returns:
410 |         (WHERE 子句, 参数列表)。注意：Oracle 的命名参数会被转换为列表。
    |                                     ^^
411 |
412 |     Example:
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/safe_query_builder.py:420:23
    |
418 |     where_clause, params = build_safe_filter_conditions(db_type, username_field, filter_rules)
419 |
420 |     # 如果是Oracle返回的dict，转换为list（虽然会丢失命名信息，但保持兼容性）
    |                             ^^
421 |     if isinstance(params, dict):
422 |         return where_clause, list(params.values())
    |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/utils/safe_query_builder.py:420:31
    |
418 |     where_clause, params = build_safe_filter_conditions(db_type, username_field, filter_rules)
419 |
420 |     # 如果是Oracle返回的dict，转换为list（虽然会丢失命名信息，但保持兼容性）
    |                                         ^^
421 |     if isinstance(params, dict):
422 |         return where_clause, list(params.values())
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/safe_query_builder.py:420:41
    |
418 |     where_clause, params = build_safe_filter_conditions(db_type, username_field, filter_rules)
419 |
420 |     # 如果是Oracle返回的dict，转换为list（虽然会丢失命名信息，但保持兼容性）
    |                                                             ^^
421 |     if isinstance(params, dict):
422 |         return where_clause, list(params.values())
    |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/utils/safe_query_builder.py:420:48
    |
418 |     where_clause, params = build_safe_filter_conditions(db_type, username_field, filter_rules)
419 |
420 |     # 如果是Oracle返回的dict，转换为list（虽然会丢失命名信息，但保持兼容性）
    |                                                                           ^^
421 |     if isinstance(params, dict):
422 |         return where_clause, list(params.values())
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/utils/sensitive_data.py:3:34
  |
1 | """敏感字段脱敏工具。.
2 |
3 | 提供通用的 `scrub_sensitive_fields` 方法，用于在写日志或回显
  |                                         ^^
4 | payload 前统一替换密码、令牌等敏感内容，避免泄露。
5 | """
  |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/utils/sensitive_data.py:4:24
  |
3 | 提供通用的 `scrub_sensitive_fields` 方法，用于在写日志或回显
4 | payload 前统一替换密码、令牌等敏感内容，避免泄露。
  |                                       ^^
5 | """
  |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/sensitive_data.py:31:14
   |
29 |     mask: str = "***",
30 | ) -> dict[str, Any]:
31 |     """脱敏敏感字段，返回新的字典副本。.
   |                    ^^
32 |
33 |     Args:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/sensitive_data.py:34:22
   |
33 |     Args:
34 |         payload: 原始数据，可以是 dict 或 MultiDict。
   |                          ^^
35 |         extra_keys: 额外需要脱敏的字段名集合。
36 |         mask: 替换后的掩码字符串。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/sensitive_data.py:39:15
   |
38 |     Returns:
39 |         已脱敏的字典，不会修改原始对象。
   |                     ^^
40 |
41 |     """
   |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `value`
  --> app/utils/sensitive_data.py:49:23
   |
47 |         normalized_keys.update(str(key).lower() for key in extra_keys)
48 |
49 |     def _scrub(value: Any, *, field_name: str | None = None) -> Any:
   |                       ^^^
50 |         key_lower = field_name.lower() if field_name else None
51 |         if key_lower and key_lower in normalized_keys:
   |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `_scrub`
  --> app/utils/sensitive_data.py:49:65
   |
47 |         normalized_keys.update(str(key).lower() for key in extra_keys)
48 |
49 |     def _scrub(value: Any, *, field_name: str | None = None) -> Any:
   |                                                                 ^^^
50 |         key_lower = field_name.lower() if field_name else None
51 |         if key_lower and key_lower in normalized_keys:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/utils/sqlserver_connection_utils.py:3:24
  |
1 | """SQL Server 连接诊断工具。.
2 |
3 | 分析 SQL Server 连接失败的具体原因，提供诊断信息和解决方案建议。
  |                                   ^^
4 | """
  |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/sqlserver_connection_utils.py:15:28
   |
13 |     """SQL Server 连接诊断工具。.
14 |
15 |     提供 SQL Server 连接错误的诊断功能，包括错误类型识别、网络检查、
   |                                       ^^
16 |     端口可达性测试和连接字符串建议。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/sqlserver_connection_utils.py:36:15
   |
34 |         """诊断 SQL Server 连接错误。.
35 |
36 |         分析错误消息，识别错误类型，执行网络和端口检查，提供可能的原因和解决方案。
   |                     ^^
37 |
38 |         Args:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/sqlserver_connection_utils.py:36:22
   |
34 |         """诊断 SQL Server 连接错误。.
35 |
36 |         分析错误消息，识别错误类型，执行网络和端口检查，提供可能的原因和解决方案。
   |                                   ^^
37 |
38 |         Args:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/sqlserver_connection_utils.py:36:32
   |
34 |         """诊断 SQL Server 连接错误。.
35 |
36 |         分析错误消息，识别错误类型，执行网络和端口检查，提供可能的原因和解决方案。
   |                                                       ^^
37 |
38 |         Args:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/sqlserver_connection_utils.py:44:19
   |
43 |         Returns:
44 |             诊断结果字典，包含以下字段：
   |                         ^^
45 |             - host: 主机地址
46 |             - port: 端口号
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/utils/sqlserver_connection_utils.py:44:26
   |
43 |         Returns:
44 |             诊断结果字典，包含以下字段：
   |                                       ^^
45 |             - host: 主机地址
46 |             - port: 端口号
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/utils/sqlserver_connection_utils.py:48:31
   |
46 |             - port: 端口号
47 |             - error_message: 错误消息
48 |             - error_type: 错误类型（authentication_failed、connection_failed、timeout 等）
   |                                   ^^
49 |             - possible_causes: 可能的原因列表
50 |             - solutions: 解决方案建议列表
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/utils/sqlserver_connection_utils.py:48:81
   |
46 |             - port: 端口号
47 |             - error_message: 错误消息
48 |             - error_type: 错误类型（authentication_failed、connection_failed、timeout 等）
   |                                                                                         ^^
49 |             - possible_causes: 可能的原因列表
50 |             - solutions: 解决方案建议列表
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/sqlserver_connection_utils.py:145:26
    |
144 |         Returns:
145 |             如果主机可达返回 True，否则返回 False。
    |                                  ^^
146 |
147 |         """
    |

TRY300 Consider moving this statement to an `else` block
   --> app/utils/sqlserver_connection_utils.py:150:13
    |
148 |         try:
149 |             socket.gethostbyname(host)
150 |             return True
    |             ^^^^^^^^^^^
151 |         except socket.gaierror:
152 |             return False
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/sqlserver_connection_utils.py:164:27
    |
163 |         Returns:
164 |             如果端口可访问返回 True，否则返回 False。
    |                                    ^^
165 |
166 |         """
    |

TRY300 Consider moving this statement to an `else` block
   --> app/utils/sqlserver_connection_utils.py:172:13
    |
170 |             result = sock.connect_ex((host, port))
171 |             sock.close()
172 |             return result == 0
    |             ^^^^^^^^^^^^^^^^^^
173 |         except Exception:
174 |             return False
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/utils/sqlserver_connection_utils.py:173:16
    |
171 |             sock.close()
172 |             return result == 0
173 |         except Exception:
    |                ^^^^^^^^^
174 |             return False
    |

E501 Line too long (124 > 120)
   --> app/utils/sqlserver_connection_utils.py:176:121
    |
174 |             return False
175 |
176 |     def get_connection_string_suggestions(self, host: str, port: int, username: str, database: str = "master") -> list[str]:
    |                                                                                                                         ^^^^
177 |         """获取连接字符串建议。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/sqlserver_connection_utils.py:179:34
    |
177 |         """获取连接字符串建议。.
178 |
179 |         生成多种 SQL Server 连接字符串配置建议，包括基本连接、带超时、
    |                                               ^^
180 |         带加密和带重试的配置。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/sqlserver_connection_utils.py:186:28
    |
184 |             port: 端口号。
185 |             username: 用户名。
186 |             database: 数据库名称，默认为 'master'。
    |                                 ^^
187 |
188 |         Returns:
    |

E501 Line too long (126 > 120)
   --> app/utils/sqlserver_connection_utils.py:204:121
    |
203 |         # 带超时的连接字符串
204 |         suggestions.append(f"Server={host},{port};Database={database};User Id={username};Password=***;Connection Timeout=60;")
    |                                                                                                                         ^^^^^^
205 |
206 |         # 带加密的连接字符串
    |

E501 Line too long (145 > 120)
   --> app/utils/sqlserver_connection_utils.py:207:121
    |
206 | …
207 | …e};User Id={username};Password=***;Encrypt=True;TrustServerCertificate=True;")
    |                                                       ^^^^^^^^^^^^^^^^^^^^^^^^^
208 | …
209 | …
    |

E501 Line too long (146 > 120)
   --> app/utils/sqlserver_connection_utils.py:210:121
    |
209 | …
210 | …e};User Id={username};Password=***;Connection Timeout=60;Command Timeout=300;")
    |                                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^
211 | …
212 | …
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/sqlserver_connection_utils.py:223:19
    |
222 |         Returns:
223 |             错误模式字典，包含以下布尔字段：
    |                         ^^
224 |             - has_network_error: 是否包含网络错误
225 |             - has_auth_error: 是否包含认证错误
    |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/utils/sqlserver_connection_utils.py:223:28
    |
222 |         Returns:
223 |             错误模式字典，包含以下布尔字段：
    |                                           ^^
224 |             - has_network_error: 是否包含网络错误
225 |             - has_auth_error: 是否包含认证错误
    |

E501 Line too long (138 > 120)
   --> app/utils/sqlserver_connection_utils.py:237:121
    |
235 | …
236 | …
237 | …ower() for keyword in ["timeout", "connection", "network", "unreachable"]),
    |                                                           ^^^^^^^^^^^^^^^^^^
238 | …r() for keyword in ["login", "authentication", "password", "user"]),
239 | …wer() for keyword in ["server", "service", "database", "sql"]),
    |

E501 Line too long (131 > 120)
   --> app/utils/sqlserver_connection_utils.py:238:121
    |
236 | …
237 | …e.lower() for keyword in ["timeout", "connection", "network", "unreachable"]),
238 | …ower() for keyword in ["login", "authentication", "password", "user"]),
    |                                                              ^^^^^^^^^^^
239 | ….lower() for keyword in ["server", "service", "database", "sql"]),
240 | …sage.lower() for keyword in ["permission", "access", "denied", "unauthorized"]),
    |

E501 Line too long (126 > 120)
   --> app/utils/sqlserver_connection_utils.py:239:121
    |
237 | …         "has_network_error": any(keyword in error_message.lower() for keyword in ["timeout", "connection", "network", "unreachable"…
238 | …         "has_auth_error": any(keyword in error_message.lower() for keyword in ["login", "authentication", "password", "user"]),
239 | …         "has_server_error": any(keyword in error_message.lower() for keyword in ["server", "service", "database", "sql"]),
    |                                                                                                                       ^^^^^^
240 | …         "has_permission_error": any(keyword in error_message.lower() for keyword in ["permission", "access", "denied", "unauthorize…
241 | …     }
    |

E501 Line too long (140 > 120)
   --> app/utils/sqlserver_connection_utils.py:240:121
    |
238 | …() for keyword in ["login", "authentication", "password", "user"]),
239 | …er() for keyword in ["server", "service", "database", "sql"]),
240 | ….lower() for keyword in ["permission", "access", "denied", "unauthorized"]),
    |                                                          ^^^^^^^^^^^^^^^^^^^^
241 | …
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/structlog_config.py:33:27
   |
31 |     """structlog 配置核心类。.
32 |
33 |     负责配置和管理 structlog 日志系统，包括处理器、过滤器和工作线程。
   |                                      ^^
34 |     支持数据库日志持久化、异步批量写入和调试日志过滤。
   |

ANN001 Missing type annotation for function argument `app`
  --> app/utils/structlog_config.py:55:25
   |
53 |         self.configured = False
54 |
55 |     def configure(self, app=None) -> None:
   |                         ^^^
56 |         """初始化 structlog 处理器（幂等）。.
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/utils/structlog_config.py:56:29
   |
55 |     def configure(self, app=None) -> None:
56 |         """初始化 structlog 处理器（幂等）。.
   |                                   ^^
57 |
58 |         配置 structlog 的处理器链、上下文管理和日志工厂。
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/utils/structlog_config.py:56:32
   |
55 |     def configure(self, app=None) -> None:
56 |         """初始化 structlog 处理器（幂等）。.
   |                                         ^^
57 |
58 |         配置 structlog 的处理器链、上下文管理和日志工厂。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/structlog_config.py:59:15
   |
58 |         配置 structlog 的处理器链、上下文管理和日志工厂。
59 |         可以多次调用，只会配置一次。
   |                     ^^
60 |
61 |         Args:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/structlog_config.py:62:28
   |
61 |         Args:
62 |             app: Flask 应用实例，可选。如果提供，将附加应用特定配置。
   |                                ^^
63 |
64 |         Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/structlog_config.py:62:36
   |
61 |         Args:
62 |             app: Flask 应用实例，可选。如果提供，将附加应用特定配置。
   |                                                ^^
63 |
64 |         Returns:
   |

ANN001 Missing type annotation for function argument `app`
  --> app/utils/structlog_config.py:93:27
   |
91 |             self._attach_app(app)
92 |
93 |     def _attach_app(self, app) -> None:
   |                           ^^^
94 |         """绑定位于 Flask 应用上的队列配置。.
   |

ANN202 Missing return type annotation for private function `_add_request_context`
   --> app/utils/structlog_config.py:118:9
    |
116 |         self.debug_filter.set_enabled(enable_debug)
117 |
118 |     def _add_request_context(self, logger, method_name, event_dict):
    |         ^^^^^^^^^^^^^^^^^^^^
119 |         """向事件字典写入请求上下文。.
    |
help: Add return type annotation

ANN001 Missing type annotation for function argument `logger`
   --> app/utils/structlog_config.py:118:36
    |
116 |         self.debug_filter.set_enabled(enable_debug)
117 |
118 |     def _add_request_context(self, logger, method_name, event_dict):
    |                                    ^^^^^^
119 |         """向事件字典写入请求上下文。.
    |

ARG002 Unused method argument: `logger`
   --> app/utils/structlog_config.py:118:36
    |
116 |         self.debug_filter.set_enabled(enable_debug)
117 |
118 |     def _add_request_context(self, logger, method_name, event_dict):
    |                                    ^^^^^^
119 |         """向事件字典写入请求上下文。.
    |

ANN001 Missing type annotation for function argument `method_name`
   --> app/utils/structlog_config.py:118:44
    |
116 |         self.debug_filter.set_enabled(enable_debug)
117 |
118 |     def _add_request_context(self, logger, method_name, event_dict):
    |                                            ^^^^^^^^^^^
119 |         """向事件字典写入请求上下文。.
    |

ARG002 Unused method argument: `method_name`
   --> app/utils/structlog_config.py:118:44
    |
116 |         self.debug_filter.set_enabled(enable_debug)
117 |
118 |     def _add_request_context(self, logger, method_name, event_dict):
    |                                            ^^^^^^^^^^^
119 |         """向事件字典写入请求上下文。.
    |

ANN001 Missing type annotation for function argument `event_dict`
   --> app/utils/structlog_config.py:118:57
    |
116 |         self.debug_filter.set_enabled(enable_debug)
117 |
118 |     def _add_request_context(self, logger, method_name, event_dict):
    |                                                         ^^^^^^^^^^
119 |         """向事件字典写入请求上下文。.
    |

ANN202 Missing return type annotation for private function `_add_user_context`
   --> app/utils/structlog_config.py:135:9
    |
133 |         return event_dict
134 |
135 |     def _add_user_context(self, logger, method_name, event_dict):
    |         ^^^^^^^^^^^^^^^^^
136 |         """附加当前用户上下文。.
    |
help: Add return type annotation

ANN001 Missing type annotation for function argument `logger`
   --> app/utils/structlog_config.py:135:33
    |
133 |         return event_dict
134 |
135 |     def _add_user_context(self, logger, method_name, event_dict):
    |                                 ^^^^^^
136 |         """附加当前用户上下文。.
    |

ARG002 Unused method argument: `logger`
   --> app/utils/structlog_config.py:135:33
    |
133 |         return event_dict
134 |
135 |     def _add_user_context(self, logger, method_name, event_dict):
    |                                 ^^^^^^
136 |         """附加当前用户上下文。.
    |

ANN001 Missing type annotation for function argument `method_name`
   --> app/utils/structlog_config.py:135:41
    |
133 |         return event_dict
134 |
135 |     def _add_user_context(self, logger, method_name, event_dict):
    |                                         ^^^^^^^^^^^
136 |         """附加当前用户上下文。.
    |

ARG002 Unused method argument: `method_name`
   --> app/utils/structlog_config.py:135:41
    |
133 |         return event_dict
134 |
135 |     def _add_user_context(self, logger, method_name, event_dict):
    |                                         ^^^^^^^^^^^
136 |         """附加当前用户上下文。.
    |

ANN001 Missing type annotation for function argument `event_dict`
   --> app/utils/structlog_config.py:135:54
    |
133 |         return event_dict
134 |
135 |     def _add_user_context(self, logger, method_name, event_dict):
    |                                                      ^^^^^^^^^^
136 |         """附加当前用户上下文。.
    |

S110 `try`-`except`-`pass` detected, consider logging the exception
   --> app/utils/structlog_config.py:151:9
    |
149 |                   event_dict["current_user_id"] = getattr(current_user, "id", None)
150 |                   event_dict["current_username"] = getattr(current_user, "username", None)
151 | /         except Exception:
152 | |             pass
    | |________________^
153 |           return event_dict
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/utils/structlog_config.py:151:16
    |
149 |                 event_dict["current_user_id"] = getattr(current_user, "id", None)
150 |                 event_dict["current_username"] = getattr(current_user, "username", None)
151 |         except Exception:
    |                ^^^^^^^^^
152 |             pass
153 |         return event_dict
    |

ANN202 Missing return type annotation for private function `_add_global_context`
   --> app/utils/structlog_config.py:155:9
    |
153 |         return event_dict
154 |
155 |     def _add_global_context(self, logger, method_name, event_dict):
    |         ^^^^^^^^^^^^^^^^^^^
156 |         """附加环境、版本等全局上下文。.
    |
help: Add return type annotation

ANN001 Missing type annotation for function argument `logger`
   --> app/utils/structlog_config.py:155:35
    |
153 |         return event_dict
154 |
155 |     def _add_global_context(self, logger, method_name, event_dict):
    |                                   ^^^^^^
156 |         """附加环境、版本等全局上下文。.
    |

ANN001 Missing type annotation for function argument `method_name`
   --> app/utils/structlog_config.py:155:43
    |
153 |         return event_dict
154 |
155 |     def _add_global_context(self, logger, method_name, event_dict):
    |                                           ^^^^^^^^^^^
156 |         """附加环境、版本等全局上下文。.
    |

ARG002 Unused method argument: `method_name`
   --> app/utils/structlog_config.py:155:43
    |
153 |         return event_dict
154 |
155 |     def _add_global_context(self, logger, method_name, event_dict):
    |                                           ^^^^^^^^^^^
156 |         """附加环境、版本等全局上下文。.
    |

ANN001 Missing type annotation for function argument `event_dict`
   --> app/utils/structlog_config.py:155:56
    |
153 |         return event_dict
154 |
155 |     def _add_global_context(self, logger, method_name, event_dict):
    |                                                        ^^^^^^^^^^
156 |         """附加环境、版本等全局上下文。.
    |

ANN202 Missing return type annotation for private function `_get_console_renderer`
   --> app/utils/structlog_config.py:181:9
    |
179 |         return event_dict
180 |
181 |     def _get_console_renderer(self):
    |         ^^^^^^^^^^^^^^^^^^^^^
182 |         """根据终端能力返回渲染器。.
    |
help: Add return type annotation

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/structlog_config.py:185:31
    |
184 |         Returns:
185 |             structlog renderer，用于控制台输出。
    |                               ^^
186 |
187 |         """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/structlog_config.py:198:19
    |
196 |         """关闭日志系统。.
197 |
198 |         停止日志队列工作线程，刷新所有待处理的日志。
    |                             ^^
199 |         通常在应用退出时自动调用。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/structlog_config.py:219:22
    |
218 |     Args:
219 |         name: 日志记录器名称，通常使用模块名。
    |                             ^^
220 |
221 |     Returns:
    |

ANN001 Missing type annotation for function argument `app`
   --> app/utils/structlog_config.py:233:25
    |
233 | def configure_structlog(app) -> None:
    |                         ^^^
234 |     """配置 structlog 并注册 Flask 钩子。.
    |

ANN001 Missing type annotation for function argument `exception`
   --> app/utils/structlog_config.py:246:28
    |
245 |     @app.teardown_appcontext
246 |     def log_teardown_error(exception) -> None:
    |                            ^^^^^^^^^
247 |         if exception:
248 |             get_logger("app").error("应用请求处理异常", module="system", exception=str(exception))
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/structlog_config.py:255:24
    |
254 |     Returns:
255 |         如果启用调试日志返回 True，否则返回 False。
    |                                  ^^
256 |
257 |     """
    |

ANN003 Missing type annotation for `**kwargs`
   --> app/utils/structlog_config.py:264:49
    |
264 | def log_info(message: str, module: str = "app", **kwargs) -> None:
    |                                                 ^^^^^^^^
265 |     """记录信息级别日志。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/structlog_config.py:269:21
    |
267 |     Args:
268 |         message: 日志消息。
269 |         module: 模块名称，默认为 'app'。
    |                         ^^
270 |         **kwargs: 额外的上下文信息。
    |

ANN003 Missing type annotation for `**kwargs`
   --> app/utils/structlog_config.py:283:88
    |
283 | def log_warning(message: str, module: str = "app", exception: Exception | None = None, **kwargs) -> None:
    |                                                                                        ^^^^^^^^
284 |     """记录警告级别日志。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/structlog_config.py:288:21
    |
286 |     Args:
287 |         message: 日志消息。
288 |         module: 模块名称，默认为 'app'。
    |                         ^^
289 |         exception: 可选的异常对象。
290 |         **kwargs: 额外的上下文信息。
    |

ANN003 Missing type annotation for `**kwargs`
   --> app/utils/structlog_config.py:306:86
    |
306 | def log_error(message: str, module: str = "app", exception: Exception | None = None, **kwargs) -> None:
    |                                                                                      ^^^^^^^^
307 |     """记录错误级别日志。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/structlog_config.py:311:21
    |
309 |     Args:
310 |         message: 日志消息。
311 |         module: 模块名称，默认为 'app'。
    |                         ^^
312 |         exception: 可选的异常对象，会记录堆栈信息。
313 |         **kwargs: 额外的上下文信息。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/structlog_config.py:312:27
    |
310 |         message: 日志消息。
311 |         module: 模块名称，默认为 'app'。
312 |         exception: 可选的异常对象，会记录堆栈信息。
    |                                  ^^
313 |         **kwargs: 额外的上下文信息。
    |

ANN003 Missing type annotation for `**kwargs`
   --> app/utils/structlog_config.py:332:89
    |
332 | def log_critical(message: str, module: str = "app", exception: Exception | None = None, **kwargs) -> None:
    |                                                                                         ^^^^^^^^
333 |     """记录严重错误级别日志。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/structlog_config.py:337:21
    |
335 |     Args:
336 |         message: 日志消息。
337 |         module: 模块名称，默认为 'app'。
    |                         ^^
338 |         exception: 可选的异常对象，会记录堆栈信息。
339 |         **kwargs: 额外的上下文信息。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/structlog_config.py:338:27
    |
336 |         message: 日志消息。
337 |         module: 模块名称，默认为 'app'。
338 |         exception: 可选的异常对象，会记录堆栈信息。
    |                                  ^^
339 |         **kwargs: 额外的上下文信息。
    |

ANN003 Missing type annotation for `**kwargs`
   --> app/utils/structlog_config.py:355:50
    |
355 | def log_debug(message: str, module: str = "app", **kwargs) -> None:
    |                                                  ^^^^^^^^
356 |     """记录调试级别日志。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/structlog_config.py:362:21
    |
360 |     Args:
361 |         message: 日志消息。
362 |         module: 模块名称，默认为 'app'。
    |                         ^^
363 |         **kwargs: 额外的上下文信息。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/structlog_config.py:446:19
    |
444 |     """增强的错误处理器。.
445 |
446 |     将异常转换为结构化的错误响应，包含错误分类、严重级别和建议。
    |                                 ^^
447 |
448 |     Args:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/structlog_config.py:450:23
    |
448 |     Args:
449 |         error: 异常对象。
450 |         context: 错误上下文，可选。如果未提供会自动创建。
    |                            ^^
451 |         extra: 额外的上下文信息，可选。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/structlog_config.py:451:24
    |
449 |         error: 异常对象。
450 |         context: 错误上下文，可选。如果未提供会自动创建。
451 |         extra: 额外的上下文信息，可选。
    |                                ^^
452 |
453 |     Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/structlog_config.py:454:19
    |
453 |     Returns:
454 |         结构化的错误响应字典，包含以下字段：
    |                             ^^
455 |         - error_id: 错误唯一标识
456 |         - category: 错误分类
    |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/utils/structlog_config.py:454:26
    |
453 |     Returns:
454 |         结构化的错误响应字典，包含以下字段：
    |                                           ^^
455 |         - error_id: 错误唯一标识
456 |         - category: 错误分类
    |

ANN201 Missing return type annotation for public function `error_handler`
   --> app/utils/structlog_config.py:530:5
    |
530 | def error_handler(func: Callable):
    |     ^^^^^^^^^^^^^
531 |     """Flask 视图装饰器，统一捕获异常并输出结构化日志。.
    |
help: Add return type annotation

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/structlog_config.py:531:19
    |
530 | def error_handler(func: Callable):
531 |     """Flask 视图装饰器，统一捕获异常并输出结构化日志。.
    |                        ^^
532 |
533 |     Args:
    |

PLC0415 `import` should be at the top-level of a file
   --> app/utils/structlog_config.py:540:5
    |
539 |     """
540 |     from functools import wraps
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^
541 |
542 |     from flask import jsonify
    |

PLC0415 `import` should be at the top-level of a file
   --> app/utils/structlog_config.py:542:5
    |
540 |     from functools import wraps
541 |
542 |     from flask import jsonify
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^
543 |
544 |     @wraps(func)
    |

ANN202 Missing return type annotation for private function `wrapper`
   --> app/utils/structlog_config.py:545:9
    |
544 |     @wraps(func)
545 |     def wrapper(*args, **kwargs):
    |         ^^^^^^^
546 |         try:
547 |             return func(*args, **kwargs)
    |
help: Add return type annotation

ANN002 Missing type annotation for `*args`
   --> app/utils/structlog_config.py:545:17
    |
544 |     @wraps(func)
545 |     def wrapper(*args, **kwargs):
    |                 ^^^^^
546 |         try:
547 |             return func(*args, **kwargs)
    |

ANN003 Missing type annotation for `**kwargs`
   --> app/utils/structlog_config.py:545:24
    |
544 |     @wraps(func)
545 |     def wrapper(*args, **kwargs):
    |                        ^^^^^^^^
546 |         try:
547 |             return func(*args, **kwargs)
    |

BLE001 Do not catch blind exception: `Exception`
   --> app/utils/structlog_config.py:548:16
    |
546 |         try:
547 |             return func(*args, **kwargs)
548 |         except Exception as error:
    |                ^^^^^^^^^
549 |             context = ErrorContext(error)
550 |             payload = enhanced_error_handler(error, context)
    |

D205 1 blank line required between summary line and description
 --> app/utils/time_utils.py:1:1
  |
1 | / """统一时间处理工具模块
2 | | 基于Python 3.9+的zoneinfo模块，提供一致的时间处理功能.
3 | | """
  | |___^
4 |
5 |   from datetime import UTC, date, datetime
  |
help: Insert single blank line

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/utils/time_utils.py:2:25
  |
1 | """统一时间处理工具模块
2 | 基于Python 3.9+的zoneinfo模块，提供一致的时间处理功能.
  |                              ^^
3 | """
  |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/time_utils.py:40:16
   |
38 |     """统一时间处理工具类。.
39 |
40 |     提供一致的时间处理功能，包括时区转换、时间格式化、
   |                           ^^
41 |     相对时间计算等。基于 Python 3.9+ 的 zoneinfo 模块。
42 |     """
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/time_utils.py:69:23
   |
68 |         Args:
69 |             dt: 待转换的时间，可以是字符串、date 或 datetime 对象。
   |                             ^^
70 |
71 |         Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/time_utils.py:72:23
   |
71 |         Returns:
72 |             转换后的中国时区时间，转换失败时返回 None。
   |                                 ^^
73 |
74 |         """
   |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/time_utils.py:88:27
   |
87 |             if dt.tzinfo is None:
88 |                 # 如果没有时区信息，假设为UTC
   |                                   ^^
89 |                 dt = dt.replace(tzinfo=UTC_TZ)
   |

PLC0415 `import` should be at the top-level of a file
  --> app/utils/time_utils.py:93:13
   |
91 |             return dt.astimezone(CHINA_TZ)
92 |         except (ValueError, TypeError) as e:
93 |             from app.utils.structlog_config import get_system_logger
   |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
94 |
95 |             get_system_logger().warning(f"时间转换错误: {e}")
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/time_utils.py:103:23
    |
102 |         Args:
103 |             dt: 待转换的时间，可以是字符串、date 或 datetime 对象。
    |                             ^^
104 |
105 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/time_utils.py:106:26
    |
105 |         Returns:
106 |             转换后的 UTC 时区时间，转换失败时返回 None。
    |                                  ^^
107 |
108 |         """
    |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/time_utils.py:121:27
    |
120 |             if dt.tzinfo is None:
121 |                 # 如果没有时区信息，假设为中国时间
    |                                   ^^
122 |                 dt = dt.replace(tzinfo=CHINA_TZ)
    |

PLC0415 `import` should be at the top-level of a file
   --> app/utils/time_utils.py:126:13
    |
124 |             return dt.astimezone(UTC_TZ)
125 |         except (ValueError, TypeError) as e:
126 |             from app.utils.structlog_config import get_system_logger
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
127 |
128 |             get_system_logger().warning(f"时间转换错误: {e}")
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/time_utils.py:139:32
    |
137 |         Args:
138 |             dt: 待格式化的时间。
139 |             format_str: 时间格式字符串，默认为 '%Y-%m-%d %H:%M:%S'。
    |                                       ^^
140 |
141 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/time_utils.py:142:23
    |
141 |         Returns:
142 |             格式化后的时间字符串，失败时返回 '-'。
    |                                 ^^
143 |
144 |         """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/time_utils.py:160:38
    |
158 |         Args:
159 |             dt: 待格式化的日期时间对象或 ISO 字符串。
160 |             format_str: strftime 兼容格式，默认为 `%Y-%m-%d %H:%M:%S`。
    |                                          ^^
161 |
162 |         Returns:
    |

RUF002 Docstring contains ambiguous `；` (FULLWIDTH SEMICOLON). Did you mean `;` (SEMICOLON)?
   --> app/utils/time_utils.py:163:31
    |
162 |         Returns:
163 |             成功时返回格式化后的 UTC 字符串；转换失败时返回 `-`。
    |                                            ^^
164 |
165 |         """
    |

PLR0911 Too many return statements (7 > 6)
   --> app/utils/time_utils.py:176:9
    |
175 |     @staticmethod
176 |     def get_relative_time(dt: str | date | datetime | None) -> str:
    |         ^^^^^^^^^^^^^^^^^
177 |         """获取相对时间描述。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/time_utils.py:179:26
    |
177 |         """获取相对时间描述。.
178 |
179 |         将时间转换为人类可读的相对时间描述，如"刚刚"、"5分钟前"、"2小时前"等。
    |                                           ^^
180 |
181 |         Args:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/time_utils.py:185:22
    |
184 |         Returns:
185 |             相对时间描述字符串，失败时返回 '-'。
    |                               ^^
186 |
187 |         """
    |

PLR2004 Magic value used in comparison, consider replacing `60` with a constant variable
   --> app/utils/time_utils.py:196:39
    |
194 |             diff = now - china_dt
195 |
196 |             if diff.total_seconds() < 60:
    |                                       ^^
197 |                 return "刚刚"
198 |             if diff.total_seconds() < TimeConstants.ONE_HOUR:
    |

PLR2004 Magic value used in comparison, consider replacing `7` with a constant variable
   --> app/utils/time_utils.py:204:28
    |
202 |                 hours = int(diff.total_seconds() / TimeConstants.ONE_HOUR)
203 |                 return f"{hours}小时前"
204 |             if diff.days < 7:
    |                            ^
205 |                 return f"{diff.days}天前"
206 |             return TimeUtils.format_china_time(china_dt)
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/utils/time_utils.py:212:24
    |
210 |     @staticmethod
211 |     def is_today(dt: str | date | datetime | None) -> bool:
212 |         """判断给定时间是否属于今天（以中国时区为准）。.
    |                                    ^^
213 |
214 |         Args:
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/utils/time_utils.py:212:32
    |
210 |     @staticmethod
211 |     def is_today(dt: str | date | datetime | None) -> bool:
212 |         """判断给定时间是否属于今天（以中国时区为准）。.
    |                                                    ^^
213 |
214 |         Args:
    |

RUF002 Docstring contains ambiguous `；` (FULLWIDTH SEMICOLON). Did you mean `;` (SEMICOLON)?
   --> app/utils/time_utils.py:218:28
    |
217 |         Returns:
218 |             True 表示在当前中国日期内；无法解析或不属于今天则为 False。
    |                                      ^^
219 |
220 |         """
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/time_utils.py:236:28
    |
235 |         Args:
236 |             hours: 向前追溯的小时数，默认 24 小时。
    |                                    ^^
237 |
238 |         Returns:
    |

PLR2004 Magic value used in comparison, consider replacing `24` with a constant variable
   --> app/utils/time_utils.py:244:20
    |
242 |         now = TimeUtils.now_china()
243 |         start = now.replace(hour=0, minute=0, second=0, microsecond=0)
244 |         if hours < 24:
    |                    ^^
245 |             start = now.replace(hour=now.hour - hours, minute=0, second=0, microsecond=0)
    |

RUF002 Docstring contains ambiguous `；` (FULLWIDTH SEMICOLON). Did you mean `;` (SEMICOLON)?
   --> app/utils/time_utils.py:262:22
    |
261 |         Returns:
262 |             ISO 格式字符串；若无法转换则返回 None。
    |                           ^^
263 |
264 |         """
    |

TRY300 Consider moving this statement to an `else` block
   --> app/utils/time_utils.py:275:13
    |
273 |             if isinstance(dt, date):
274 |                 return dt.isoformat()
275 |             return None
    |             ^^^^^^^^^^^
276 |         except (ValueError, TypeError):
277 |             return None
    |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> app/utils/time_utils.py:287:5
    |
287 | # 常量（向后兼容）
    |       ^^
288 | # UTC_TZ 已在文件顶部定义
    |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> app/utils/time_utils.py:287:10
    |
287 | # 常量（向后兼容）
    |                 ^^
288 | # UTC_TZ 已在文件顶部定义
    |

EXE001 Shebang is present but file is not executable
 --> app/utils/version_parser.py:1:1
  |
1 | #!/usr/bin/env python3
  | ^^^^^^^^^^^^^^^^^^^^^^
2 | """数据库版本解析工具
3 | 使用正则表达式提取简洁的版本信息.
  |

D205 1 blank line required between summary line and description
 --> app/utils/version_parser.py:2:1
  |
1 |   #!/usr/bin/env python3
2 | / """数据库版本解析工具
3 | | 使用正则表达式提取简洁的版本信息.
4 | | """
  | |___^
5 |
6 |   import re
  |
help: Insert single blank line

RUF012 Mutable class attributes should be annotated with `typing.ClassVar`
  --> app/utils/version_parser.py:29:24
   |
28 |       # 版本提取正则表达式
29 |       VERSION_PATTERNS = {
   |  ________________________^
30 | |         "mysql": [
31 | |             r"(\d+\.\d+\.\d+)",  # 8.0.32
32 | |             r"(\d+\.\d+)",  # 8.0
33 | |         ],
34 | |         "postgresql": [
35 | |             r"PostgreSQL\s+(\d+\.\d+)",  # PostgreSQL 13.4
36 | |             r"(\d+\.\d+)",  # 13.4
37 | |         ],
38 | |         "sqlserver": [
39 | |             r"Microsoft SQL Server \d+\s+\([^)]+\)\s+\([^)]+\)\s+-\s+(\d+\.\d+\.\d+\.\d+)",  # 14.0.3465.1
40 | |             r"(\d+\.\d+\.\d+\.\d+)",  # 14.0.3465.1
41 | |         ],
42 | |         "oracle": [
43 | |             r"Oracle Database \d+g Release (\d+\.\d+\.\d+\.\d+\.\d+)",  # Oracle Database 11g Release 11.2.0.1.0
44 | |             r"(\d+\.\d+\.\d+\.\d+\.\d+)",  # 11.2.0.1.0
45 | |         ],
46 | |     }
   | |_____^
47 |
48 |       @classmethod
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/version_parser.py:55:27
   |
54 |         Args:
55 |             db_type: 数据库类型，可选值：'mysql'、'postgresql'、'sqlserver'、'oracle'。
   |                                ^^
56 |             version_string: 原始版本字符串，例如 'MySQL 8.0.32-community'。
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/utils/version_parser.py:55:31
   |
54 |         Args:
55 |             db_type: 数据库类型，可选值：'mysql'、'postgresql'、'sqlserver'、'oracle'。
   |                                        ^^
56 |             version_string: 原始版本字符串，例如 'MySQL 8.0.32-community'。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/version_parser.py:56:36
   |
54 |         Args:
55 |             db_type: 数据库类型，可选值：'mysql'、'postgresql'、'sqlserver'、'oracle'。
56 |             version_string: 原始版本字符串，例如 'MySQL 8.0.32-community'。
   |                                           ^^
57 |
58 |         Returns:
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> app/utils/version_parser.py:59:22
   |
58 |         Returns:
59 |             包含以下字段的字典：
   |                               ^^
60 |             - main_version: 主版本号，例如 '8.0'
61 |             - detailed_version: 详细版本号，例如 '8.0.32'
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/version_parser.py:60:33
   |
58 |         Returns:
59 |             包含以下字段的字典：
60 |             - main_version: 主版本号，例如 '8.0'
   |                                     ^^
61 |             - detailed_version: 详细版本号，例如 '8.0.32'
62 |             - original: 原始版本字符串
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/version_parser.py:61:38
   |
59 |             包含以下字段的字典：
60 |             - main_version: 主版本号，例如 '8.0'
61 |             - detailed_version: 详细版本号，例如 '8.0.32'
   |                                           ^^
62 |             - original: 原始版本字符串
   |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/version_parser.py:84:18
   |
82 |                 return {"main_version": main_version, "detailed_version": version, "original": version_string}
83 |
84 |         # 如果没有匹配到，返回原始字符串
   |                         ^^
85 |         return {
86 |             "main_version": "未知",
   |

PLR2004 Magic value used in comparison, consider replacing `50` with a constant variable
  --> app/utils/version_parser.py:87:86
   |
85 |         return {
86 |             "main_version": "未知",
87 |             "detailed_version": version_string[:50] + "..." if len(version_string) > 50 else version_string,
   |                                                                                      ^^
88 |             "original": version_string,
89 |         }
   |

C901 `_extract_main_version` is too complex (11 > 10)
  --> app/utils/version_parser.py:92:9
   |
91 |     @classmethod
92 |     def _extract_main_version(cls, version: str, db_type: str) -> str:
   |         ^^^^^^^^^^^^^^^^^^^^^
93 |         """提取主版本号。.
   |

PLR0911 Too many return statements (11 > 6)
  --> app/utils/version_parser.py:92:9
   |
91 |     @classmethod
92 |     def _extract_main_version(cls, version: str, db_type: str) -> str:
   |         ^^^^^^^^^^^^^^^^^^^^^
93 |         """提取主版本号。.
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/utils/version_parser.py:95:29
   |
93 |         """提取主版本号。.
94 |
95 |         根据数据库类型从详细版本号中提取主版本号（通常是前两位）。
   |                                                 ^^
96 |
97 |         Args:
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/utils/version_parser.py:95:36
   |
93 |         """提取主版本号。.
94 |
95 |         根据数据库类型从详细版本号中提取主版本号（通常是前两位）。
   |                                                               ^^
96 |
97 |         Args:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/utils/version_parser.py:98:27
   |
97 |         Args:
98 |             version: 详细版本号，例如 '8.0.32' 或 '11.2.0.1.0'。
   |                                ^^
99 |             db_type: 数据库类型。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/version_parser.py:102:17
    |
101 |         Returns:
102 |             主版本号，例如 '8.0' 或 '11.2'。
    |                     ^^
103 |
104 |         Example:
    |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
   --> app/utils/version_parser.py:116:30
    |
114 |             # MySQL: 8.0.32 -> 8.0
115 |             parts = version.split(".")
116 |             if len(parts) >= 2:
    |                              ^
117 |                 return f"{parts[0]}.{parts[1]}"
118 |             return version
    |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
   --> app/utils/version_parser.py:123:30
    |
121 |             # PostgreSQL: 13.4 -> 13.4
122 |             parts = version.split(".")
123 |             if len(parts) >= 2:
    |                              ^
124 |                 return f"{parts[0]}.{parts[1]}"
125 |             return version
    |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
   --> app/utils/version_parser.py:130:30
    |
128 |             # SQL Server: 14.0.3465.1 -> 14.0
129 |             parts = version.split(".")
130 |             if len(parts) >= 2:
    |                              ^
131 |                 return f"{parts[0]}.{parts[1]}"
132 |             return version
    |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
   --> app/utils/version_parser.py:137:30
    |
135 |             # Oracle: 11.2.0.1.0 -> 11.2
136 |             parts = version.split(".")
137 |             if len(parts) >= 2:
    |                              ^
138 |                 return f"{parts[0]}.{parts[1]}"
139 |             return version
    |

RUF003 Comment contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> app/utils/version_parser.py:141:15
    |
139 |             return version
140 |
141 |         # 默认情况：取前两个部分
    |                   ^^
142 |         parts = version.split(".")
143 |         if len(parts) >= 2:
    |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
   --> app/utils/version_parser.py:143:26
    |
141 |         # 默认情况：取前两个部分
142 |         parts = version.split(".")
143 |         if len(parts) >= 2:
    |                          ^
144 |             return f"{parts[0]}.{parts[1]}"
145 |         return version
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/utils/version_parser.py:158:36
    |
157 |         Returns:
158 |             格式化后的版本字符串。如果主版本和详细版本相同，只返回主版本；
    |                                                           ^^
159 |             否则返回 '主版本 (详细版本)' 格式。
    |

RUF002 Docstring contains ambiguous `；` (FULLWIDTH SEMICOLON). Did you mean `;` (SEMICOLON)?
   --> app/utils/version_parser.py:158:43
    |
157 |         Returns:
158 |             格式化后的版本字符串。如果主版本和详细版本相同，只返回主版本；
    |                                                                         ^^
159 |             否则返回 '主版本 (详细版本)' 格式。
    |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
 --> app/views/__init__.py:5:5
  |
3 | 提供视图相关的辅助功能和混入类。
4 |
5 | 主要组件：
  |         ^^
6 | - mixins: 视图混入类集合
7 | """
  |

ANN202 Missing return type annotation for private function `_resolve_success_redirect`
  --> app/views/classification_forms.py:20:9
   |
18 |     form_definition = CLASSIFICATION_FORM_DEFINITION
19 |
20 |     def _resolve_success_redirect(self, instance):
   |         ^^^^^^^^^^^^^^^^^^^^^^^^^
21 |         """解析成功后的重定向地址。.
   |
help: Add return type annotation

ANN001 Missing type annotation for function argument `instance`
  --> app/views/classification_forms.py:20:41
   |
18 |     form_definition = CLASSIFICATION_FORM_DEFINITION
19 |
20 |     def _resolve_success_redirect(self, instance):
   |                                         ^^^^^^^^
21 |         """解析成功后的重定向地址。.
   |

ARG002 Unused method argument: `instance`
  --> app/views/classification_forms.py:20:41
   |
18 |     form_definition = CLASSIFICATION_FORM_DEFINITION
19 |
20 |     def _resolve_success_redirect(self, instance):
   |                                         ^^^^^^^^
21 |         """解析成功后的重定向地址。.
   |

ANN202 Missing return type annotation for private function `_success_redirect_kwargs`
  --> app/views/classification_forms.py:32:9
   |
30 |         return url_for("account_classification.index")
31 |
32 |     def _success_redirect_kwargs(self, instance):
   |         ^^^^^^^^^^^^^^^^^^^^^^^^
33 |         """获取重定向的额外参数。.
   |
help: Add return type annotation

ANN001 Missing type annotation for function argument `instance`
  --> app/views/classification_forms.py:32:40
   |
30 |         return url_for("account_classification.index")
31 |
32 |     def _success_redirect_kwargs(self, instance):
   |                                        ^^^^^^^^
33 |         """获取重定向的额外参数。.
   |

ARG002 Unused method argument: `instance`
  --> app/views/classification_forms.py:32:40
   |
30 |         return url_for("account_classification.index")
31 |
32 |     def _success_redirect_kwargs(self, instance):
   |                                        ^^^^^^^^
33 |         """获取重定向的额外参数。.
   |

ANN001 Missing type annotation for function argument `instance`
  --> app/views/classification_forms.py:44:35
   |
42 |         return {}
43 |
44 |     def get_success_message(self, instance) -> str:
   |                                   ^^^^^^^^
45 |         """获取成功消息。.
   |

ARG002 Unused method argument: `instance`
  --> app/views/classification_forms.py:44:35
   |
42 |         return {}
43 |
44 |     def get_success_message(self, instance) -> str:
   |                                   ^^^^^^^^
45 |         """获取成功消息。.
   |

ANN202 Missing return type annotation for private function `_resolve_success_redirect`
  --> app/views/classification_forms.py:67:9
   |
65 |     form_definition = CLASSIFICATION_RULE_FORM_DEFINITION
66 |
67 |     def _resolve_success_redirect(self, instance):
   |         ^^^^^^^^^^^^^^^^^^^^^^^^^
68 |         """解析成功后的重定向地址。.
   |
help: Add return type annotation

ANN001 Missing type annotation for function argument `instance`
  --> app/views/classification_forms.py:67:41
   |
65 |     form_definition = CLASSIFICATION_RULE_FORM_DEFINITION
66 |
67 |     def _resolve_success_redirect(self, instance):
   |                                         ^^^^^^^^
68 |         """解析成功后的重定向地址。.
   |

ARG002 Unused method argument: `instance`
  --> app/views/classification_forms.py:67:41
   |
65 |     form_definition = CLASSIFICATION_RULE_FORM_DEFINITION
66 |
67 |     def _resolve_success_redirect(self, instance):
   |                                         ^^^^^^^^
68 |         """解析成功后的重定向地址。.
   |

ANN001 Missing type annotation for function argument `instance`
  --> app/views/classification_forms.py:79:35
   |
77 |         return url_for("account_classification.index")
78 |
79 |     def get_success_message(self, instance) -> str:
   |                                   ^^^^^^^^
80 |         """获取成功消息。.
   |

ARG002 Unused method argument: `instance`
  --> app/views/classification_forms.py:79:35
   |
77 |         return url_for("account_classification.index")
78 |
79 |     def get_success_message(self, instance) -> str:
   |                                   ^^^^^^^^
80 |         """获取成功消息。.
   |

ANN202 Missing return type annotation for private function `_resolve_success_redirect`
  --> app/views/credential_forms.py:19:9
   |
17 |     form_definition = CREDENTIAL_FORM_DEFINITION
18 |
19 |     def _resolve_success_redirect(self, instance):
   |         ^^^^^^^^^^^^^^^^^^^^^^^^^
20 |         """解析成功后的重定向地址。.
   |
help: Add return type annotation

ANN001 Missing type annotation for function argument `instance`
  --> app/views/credential_forms.py:19:41
   |
17 |     form_definition = CREDENTIAL_FORM_DEFINITION
18 |
19 |     def _resolve_success_redirect(self, instance):
   |                                         ^^^^^^^^
20 |         """解析成功后的重定向地址。.
   |

ANN001 Missing type annotation for function argument `instance`
  --> app/views/credential_forms.py:33:35
   |
31 |         return super()._resolve_success_redirect(instance)
32 |
33 |     def get_success_message(self, instance) -> str:
   |                                   ^^^^^^^^
34 |         """获取成功消息。.
   |

ARG002 Unused method argument: `instance`
  --> app/views/credential_forms.py:33:35
   |
31 |         return super()._resolve_success_redirect(instance)
32 |
33 |     def get_success_message(self, instance) -> str:
   |                                   ^^^^^^^^
34 |         """获取成功消息。.
   |

RUF001 String contains ambiguous `！` (FULLWIDTH EXCLAMATION MARK). Did you mean `!` (EXCLAMATION MARK)?
  --> app/views/credential_forms.py:44:27
   |
42 |         """
43 |         if request.view_args and request.view_args.get("credential_id"):
44 |             return "凭据更新成功！"
   |                                 ^^
45 |         return "凭据创建成功！"
   |

RUF001 String contains ambiguous `！` (FULLWIDTH EXCLAMATION MARK). Did you mean `!` (EXCLAMATION MARK)?
  --> app/views/credential_forms.py:45:23
   |
43 |         if request.view_args and request.view_args.get("credential_id"):
44 |             return "凭据更新成功！"
45 |         return "凭据创建成功！"
   |                             ^^
   |

ANN202 Missing return type annotation for private function `_resolve_success_redirect`
  --> app/views/instance_forms.py:19:9
   |
17 |     form_definition = INSTANCE_FORM_DEFINITION
18 |
19 |     def _resolve_success_redirect(self, instance):
   |         ^^^^^^^^^^^^^^^^^^^^^^^^^
20 |         """解析成功后的重定向地址。.
   |
help: Add return type annotation

ANN001 Missing type annotation for function argument `instance`
  --> app/views/instance_forms.py:19:41
   |
17 |     form_definition = INSTANCE_FORM_DEFINITION
18 |
19 |     def _resolve_success_redirect(self, instance):
   |                                         ^^^^^^^^
20 |         """解析成功后的重定向地址。.
   |

ANN001 Missing type annotation for function argument `instance`
  --> app/views/instance_forms.py:33:35
   |
31 |         return super()._resolve_success_redirect(instance)
32 |
33 |     def get_success_message(self, instance) -> str:
   |                                   ^^^^^^^^
34 |         """获取成功消息。.
   |

ARG002 Unused method argument: `instance`
  --> app/views/instance_forms.py:33:35
   |
31 |         return super()._resolve_success_redirect(instance)
32 |
33 |     def get_success_message(self, instance) -> str:
   |                                   ^^^^^^^^
34 |         """获取成功消息。.
   |

RUF001 String contains ambiguous `！` (FULLWIDTH EXCLAMATION MARK). Did you mean `!` (EXCLAMATION MARK)?
  --> app/views/instance_forms.py:44:27
   |
42 |         """
43 |         if request.view_args and (request.view_args.get("resource_id") or request.view_args.get("instance_id")):
44 |             return "实例更新成功！"
   |                                 ^^
45 |         return "实例创建成功！"
   |

RUF001 String contains ambiguous `！` (FULLWIDTH EXCLAMATION MARK). Did you mean `!` (EXCLAMATION MARK)?
  --> app/views/instance_forms.py:45:23
   |
43 |         if request.view_args and (request.view_args.get("resource_id") or request.view_args.get("instance_id")):
44 |             return "实例更新成功！"
45 |         return "实例创建成功！"
   |                             ^^
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/views/mixins/__init__.py:3:12
  |
1 | """视图混入类模块。.
2 |
3 | 提供可复用的视图混入类，用于扩展视图功能。
  |                       ^^
4 | """
  |

D205 1 blank line required between summary line and description
 --> app/views/mixins/resource_forms.py:1:1
  |
1 | / """通用资源表单视图.
2 | | ------------------
3 | | 集成 GET/POST 逻辑，依赖 ResourceFormDefinition 与 BaseResourceService。
4 | | """
  | |___^
5 |
6 |   from __future__ import annotations
  |
help: Insert single blank line

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> app/views/mixins/resource_forms.py:3:15
  |
1 | """通用资源表单视图.
2 | ------------------
3 | 集成 GET/POST 逻辑，依赖 ResourceFormDefinition 与 BaseResourceService。
  |                   ^^
4 | """
  |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/views/mixins/resource_forms.py:30:22
   |
29 | class ResourceFormView(MethodView):
30 |     """通用 GET/POST 视图，子类只需设置 form_definition。.
   |                          ^^
31 |
32 |     提供统一的资源表单处理逻辑，包括 GET 显示表单和 POST 提交表单。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/views/mixins/resource_forms.py:32:18
   |
30 |     """通用 GET/POST 视图，子类只需设置 form_definition。.
31 |
32 |     提供统一的资源表单处理逻辑，包括 GET 显示表单和 POST 提交表单。
   |                               ^^
33 |     子类只需配置 form_definition 即可使用。
   |

ANN003 Missing type annotation for `**kwargs`
  --> app/views/mixins/resource_forms.py:58:51
   |
56 |     # HTTP Methods
57 |     # ------------------------------------------------------------------ #
58 |     def get(self, resource_id: int | None = None, **kwargs) -> str:
   |                                                   ^^^^^^^^
59 |         """GET 请求处理，显示表单。.
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/views/mixins/resource_forms.py:59:20
   |
57 |     # ------------------------------------------------------------------ #
58 |     def get(self, resource_id: int | None = None, **kwargs) -> str:
59 |         """GET 请求处理，显示表单。.
   |                        ^^
60 |
61 |         Args:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/views/mixins/resource_forms.py:62:31
   |
61 |         Args:
62 |             resource_id: 资源 ID，如果为 None 则为创建模式。
   |                                 ^^
63 |             **kwargs: 额外的关键字参数。
   |

ANN003 Missing type annotation for `**kwargs`
  --> app/views/mixins/resource_forms.py:73:52
   |
71 |         return render_template(self.form_definition.template, **context)
72 |
73 |     def post(self, resource_id: int | None = None, **kwargs) -> str | Response:
   |                                                    ^^^^^^^^
74 |         """POST 请求处理，提交表单。.
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/views/mixins/resource_forms.py:74:21
   |
73 |     def post(self, resource_id: int | None = None, **kwargs) -> str | Response:
74 |         """POST 请求处理，提交表单。.
   |                         ^^
75 |
76 |         Args:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/views/mixins/resource_forms.py:77:31
   |
76 |         Args:
77 |             resource_id: 资源 ID，如果为 None 则为创建模式。
   |                                 ^^
78 |             **kwargs: 额外的关键字参数。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/views/mixins/resource_forms.py:81:23
   |
80 |         Returns:
81 |             成功时返回重定向响应，失败时返回渲染的 HTML 字符串。
   |                                 ^^
82 |
83 |         """
   |

ANN202 Missing return type annotation for private function `_load_resource`
   --> app/views/mixins/resource_forms.py:102:9
    |
100 |     # Helpers
101 |     # ------------------------------------------------------------------ #
102 |     def _load_resource(self, resource_id: int | None):
    |         ^^^^^^^^^^^^^^
103 |         """加载资源对象。.
    |
help: Add return type annotation

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/views/mixins/resource_forms.py:106:31
    |
105 |         Args:
106 |             resource_id: 资源 ID，如果为 None 则返回 None。
    |                                 ^^
107 |
108 |         Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> app/views/mixins/resource_forms.py:119:20
    |
117 |         """解析资源 ID。.
118 |
119 |         从参数中提取资源 ID，支持多种命名方式。
    |                            ^^
120 |
121 |         Args:
    |

ANN001 Missing type annotation for function argument `req`
   --> app/views/mixins/resource_forms.py:136:32
    |
134 |         return None
135 |
136 |     def _extract_payload(self, req) -> Mapping[str, Any]:
    |                                ^^^
137 |         """提取请求负载数据。.
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `resource`
   --> app/views/mixins/resource_forms.py:152:19
    |
150 |     def _build_context(
151 |         self,
152 |         resource: Any | None,
    |                   ^^^^^^^^^^
153 |         form_data: Mapping[str, Any] | None,
154 |         errors: str | None = None,
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `instance`
   --> app/views/mixins/resource_forms.py:185:51
    |
183 |         return base_context
184 |
185 |     def _resolve_success_redirect(self, instance: Any) -> str:
    |                                                   ^^^
186 |         """解析成功后的重定向地址。.
    |

ARG002 Unused method argument: `instance`
   --> app/views/mixins/resource_forms.py:200:40
    |
198 |         return url_for(endpoint, **self._success_redirect_kwargs(instance))
199 |
200 |     def _success_redirect_kwargs(self, instance: Any) -> dict[str, Any]:
    |                                        ^^^^^^^^
201 |         """获取重定向的额外参数。.
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `instance`
   --> app/views/mixins/resource_forms.py:200:50
    |
198 |         return url_for(endpoint, **self._success_redirect_kwargs(instance))
199 |
200 |     def _success_redirect_kwargs(self, instance: Any) -> dict[str, Any]:
    |                                                  ^^^
201 |         """获取重定向的额外参数。.
    |

ARG002 Unused method argument: `instance`
   --> app/views/mixins/resource_forms.py:212:35
    |
210 |         return {}
211 |
212 |     def get_success_message(self, instance: Any) -> str:
    |                                   ^^^^^^^^
213 |         """获取成功消息。.
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `instance`
   --> app/views/mixins/resource_forms.py:212:45
    |
210 |         return {}
211 |
212 |     def get_success_message(self, instance: Any) -> str:
    |                                             ^^^
213 |         """获取成功消息。.
    |

ANN202 Missing return type annotation for private function `_load_resource`
  --> app/views/password_forms.py:19:9
   |
17 |     form_definition = CHANGE_PASSWORD_FORM_DEFINITION
18 |
19 |     def _load_resource(self, resource_id):
   |         ^^^^^^^^^^^^^^
20 |         """加载用户资源。.
   |
help: Add return type annotation

ANN001 Missing type annotation for function argument `resource_id`
  --> app/views/password_forms.py:19:30
   |
17 |     form_definition = CHANGE_PASSWORD_FORM_DEFINITION
18 |
19 |     def _load_resource(self, resource_id):
   |                              ^^^^^^^^^^^
20 |         """加载用户资源。.
   |

ARG002 Unused method argument: `resource_id`
  --> app/views/password_forms.py:19:30
   |
17 |     form_definition = CHANGE_PASSWORD_FORM_DEFINITION
18 |
19 |     def _load_resource(self, resource_id):
   |                              ^^^^^^^^^^^
20 |         """加载用户资源。.
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/views/password_forms.py:23:31
   |
22 |         Args:
23 |             resource_id: 资源 ID（未使用）。
   |                                 ^^
24 |
25 |         Returns:
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/views/password_forms.py:23:35
   |
22 |         Args:
23 |             resource_id: 资源 ID（未使用）。
   |                                         ^^
24 |
25 |         Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/views/password_forms.py:26:21
   |
25 |         Returns:
26 |             当前登录用户对象，如果未登录则返回 None。
   |                             ^^
27 |
28 |         """
   |

A004 Import `SystemError` is shadowing a Python builtin
 --> app/views/scheduler_forms.py:7:39
  |
5 | from flask import Response, request
6 |
7 | from app.errors import NotFoundError, SystemError, ValidationError
  |                                       ^^^^^^^^^^^
8 | from app.forms.definitions.scheduler_job import SCHEDULER_JOB_FORM_DEFINITION
9 | from app.utils.response_utils import jsonify_unified_error_message, jsonify_unified_success
  |

ANN002 Missing type annotation for `*args`
  --> app/views/scheduler_forms.py:23:19
   |
21 |     form_definition = SCHEDULER_JOB_FORM_DEFINITION
22 |
23 |     def get(self, *args, **kwargs) -> Never:
   |                   ^^^^^
24 |         """GET 请求处理（不支持）。.
   |

ARG002 Unused method argument: `args`
  --> app/views/scheduler_forms.py:23:20
   |
21 |     form_definition = SCHEDULER_JOB_FORM_DEFINITION
22 |
23 |     def get(self, *args, **kwargs) -> Never:
   |                    ^^^^
24 |         """GET 请求处理（不支持）。.
   |

ANN003 Missing type annotation for `**kwargs`
  --> app/views/scheduler_forms.py:23:26
   |
21 |     form_definition = SCHEDULER_JOB_FORM_DEFINITION
22 |
23 |     def get(self, *args, **kwargs) -> Never:
   |                          ^^^^^^^^
24 |         """GET 请求处理（不支持）。.
   |

ARG002 Unused method argument: `kwargs`
  --> app/views/scheduler_forms.py:23:28
   |
21 |     form_definition = SCHEDULER_JOB_FORM_DEFINITION
22 |
23 |     def get(self, *args, **kwargs) -> Never:
   |                            ^^^^^^
24 |         """GET 请求处理（不支持）。.
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/views/scheduler_forms.py:24:20
   |
23 |     def get(self, *args, **kwargs) -> Never:
24 |         """GET 请求处理（不支持）。.
   |                        ^^
25 |
26 |         Raises:
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/views/scheduler_forms.py:24:24
   |
23 |     def get(self, *args, **kwargs) -> Never:
24 |         """GET 请求处理（不支持）。.
   |                                ^^
25 |
26 |         Raises:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/views/scheduler_forms.py:27:32
   |
26 |         Raises:
27 |             NotFoundError: 始终抛出，因为不支持此操作。
   |                                    ^^
28 |
29 |         Returns:
   |

ANN002 Missing type annotation for `*args`
  --> app/views/scheduler_forms.py:36:20
   |
34 |         raise NotFoundError(msg)
35 |
36 |     def post(self, *args, **kwargs) -> Never:
   |                    ^^^^^
37 |         """POST 请求处理（不支持）。.
   |

ARG002 Unused method argument: `args`
  --> app/views/scheduler_forms.py:36:21
   |
34 |         raise NotFoundError(msg)
35 |
36 |     def post(self, *args, **kwargs) -> Never:
   |                     ^^^^
37 |         """POST 请求处理（不支持）。.
   |

ANN003 Missing type annotation for `**kwargs`
  --> app/views/scheduler_forms.py:36:27
   |
34 |         raise NotFoundError(msg)
35 |
36 |     def post(self, *args, **kwargs) -> Never:
   |                           ^^^^^^^^
37 |         """POST 请求处理（不支持）。.
   |

ARG002 Unused method argument: `kwargs`
  --> app/views/scheduler_forms.py:36:29
   |
34 |         raise NotFoundError(msg)
35 |
36 |     def post(self, *args, **kwargs) -> Never:
   |                             ^^^^^^
37 |         """POST 请求处理（不支持）。.
   |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> app/views/scheduler_forms.py:37:21
   |
36 |     def post(self, *args, **kwargs) -> Never:
37 |         """POST 请求处理（不支持）。.
   |                         ^^
38 |
39 |         Raises:
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> app/views/scheduler_forms.py:37:25
   |
36 |     def post(self, *args, **kwargs) -> Never:
37 |         """POST 请求处理（不支持）。.
   |                                 ^^
38 |
39 |         Raises:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/views/scheduler_forms.py:40:32
   |
39 |         Raises:
40 |             NotFoundError: 始终抛出，因为不支持此操作。
   |                                    ^^
41 |
42 |         Returns:
   |

ANN003 Missing type annotation for `**kwargs`
  --> app/views/scheduler_forms.py:49:32
   |
47 |         raise NotFoundError(msg)
48 |
49 |     def put(self, job_id: str, **kwargs) -> Response:
   |                                ^^^^^^^^
50 |         """PUT 请求处理，更新定时任务。.
   |

ARG002 Unused method argument: `kwargs`
  --> app/views/scheduler_forms.py:49:34
   |
47 |         raise NotFoundError(msg)
48 |
49 |     def put(self, job_id: str, **kwargs) -> Response:
   |                                  ^^^^^^
50 |         """PUT 请求处理，更新定时任务。.
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> app/views/scheduler_forms.py:50:20
   |
49 |     def put(self, job_id: str, **kwargs) -> Response:
50 |         """PUT 请求处理，更新定时任务。.
   |                        ^^
51 |
52 |         Args:
   |

BLE001 Do not catch blind exception: `Exception`
  --> app/views/scheduler_forms.py:78:16
   |
76 |         except (NotFoundError, ValidationError, SystemError):
77 |             raise
78 |         except Exception as exc:
   |                ^^^^^^^^^
79 |             return jsonify_unified_error_message(message="任务更新失败", extra={"exception": str(exc)})
   |

ANN202 Missing return type annotation for private function `_load_resource`
  --> app/views/scheduler_forms.py:81:9
   |
79 |             return jsonify_unified_error_message(message="任务更新失败", extra={"exception": str(exc)})
80 |
81 |     def _load_resource(self, job_id):
   |         ^^^^^^^^^^^^^^
82 |         """加载任务资源。.
   |
help: Add return type annotation

ANN001 Missing type annotation for function argument `job_id`
  --> app/views/scheduler_forms.py:81:30
   |
79 |             return jsonify_unified_error_message(message="任务更新失败", extra={"exception": str(exc)})
80 |
81 |     def _load_resource(self, job_id):
   |                              ^^^^^^
82 |         """加载任务资源。.
   |

ANN202 Missing return type annotation for private function `_resolve_success_redirect`
  --> app/views/tag_forms.py:19:9
   |
17 |     form_definition = TAG_FORM_DEFINITION
18 |
19 |     def _resolve_success_redirect(self, instance):
   |         ^^^^^^^^^^^^^^^^^^^^^^^^^
20 |         """解析成功后的重定向地址。.
   |
help: Add return type annotation

ANN001 Missing type annotation for function argument `instance`
  --> app/views/tag_forms.py:19:41
   |
17 |     form_definition = TAG_FORM_DEFINITION
18 |
19 |     def _resolve_success_redirect(self, instance):
   |                                         ^^^^^^^^
20 |         """解析成功后的重定向地址。.
   |

ANN001 Missing type annotation for function argument `instance`
  --> app/views/tag_forms.py:33:35
   |
31 |         return super()._resolve_success_redirect(instance)
32 |
33 |     def get_success_message(self, instance) -> str:
   |                                   ^^^^^^^^
34 |         """获取成功消息。.
   |

ARG002 Unused method argument: `instance`
  --> app/views/tag_forms.py:33:35
   |
31 |         return super()._resolve_success_redirect(instance)
32 |
33 |     def get_success_message(self, instance) -> str:
   |                                   ^^^^^^^^
34 |         """获取成功消息。.
   |

ANN001 Missing type annotation for function argument `instance`
  --> app/views/user_forms.py:19:35
   |
17 |     form_definition = USER_FORM_DEFINITION
18 |
19 |     def get_success_message(self, instance) -> str:
   |                                   ^^^^^^^^
20 |         """获取成功消息。.
   |

ARG002 Unused method argument: `instance`
  --> app/views/user_forms.py:19:35
   |
17 |     form_definition = USER_FORM_DEFINITION
18 |
19 |     def get_success_message(self, instance) -> str:
   |                                   ^^^^^^^^
20 |         """获取成功消息。.
   |

INP001 File `examples/logging/unified_logging_example.py` is part of an implicit namespace package. Add an `__init__.py`.
--> examples/logging/unified_logging_example.py:1:1

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
 --> examples/logging/unified_logging_example.py:3:5
  |
1 | """Unified logging 示例脚本。.
2 |
3 | 执行方式：
  |         ^^
4 |     $ python examples/logging/unified_logging_example.py
  |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> examples/logging/unified_logging_example.py:6:34
  |
4 |     $ python examples/logging/unified_logging_example.py
5 |
6 | 示例展示了如何在业务代码中使用统一的 structlog 日志工具，包括：
  |                                                        ^^
7 | 1. 绑定/清理全局上下文
8 | 2. 绑定请求上下文（request_id、用户信息等）
  |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
 --> examples/logging/unified_logging_example.py:6:37
  |
4 |     $ python examples/logging/unified_logging_example.py
5 |
6 | 示例展示了如何在业务代码中使用统一的 structlog 日志工具，包括：
  |                                                              ^^
7 | 1. 绑定/清理全局上下文
8 | 2. 绑定请求上下文（request_id、用户信息等）
  |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> examples/logging/unified_logging_example.py:8:11
   |
 6 | 示例展示了如何在业务代码中使用统一的 structlog 日志工具，包括：
 7 | 1. 绑定/清理全局上下文
 8 | 2. 绑定请求上下文（request_id、用户信息等）
   |                  ^^
 9 | 3. 使用 log_info/log_warning/log_error 等快捷方法
10 | 4. 结合自定义异常记录结构化错误日志
   |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> examples/logging/unified_logging_example.py:8:28
   |
 6 | 示例展示了如何在业务代码中使用统一的 structlog 日志工具，包括：
 7 | 1. 绑定/清理全局上下文
 8 | 2. 绑定请求上下文（request_id、用户信息等）
   |                                          ^^
 9 | 3. 使用 log_info/log_warning/log_error 等快捷方法
10 | 4. 结合自定义异常记录结构化错误日志
   |

S311 Standard pseudo-random generators are not suitable for cryptographic purposes
  --> examples/logging/unified_logging_example.py:43:15
   |
41 |     """模拟一次请求处理生命周期."""
42 |     request_id = str(uuid.uuid4())
43 |     user_id = random.randint(1, 100)
   |               ^^^^^^^^^^^^^^^^^^^^^^
44 |
45 |     bind_request_context(request_id=request_id, user_id=user_id)
   |

S311 Standard pseudo-random generators are not suitable for cryptographic purposes
  --> examples/logging/unified_logging_example.py:50:37
   |
48 |     try:
49 |         # 模拟业务校验
50 |         validate_payload({"amount": random.choice([10, -5, 20])})
   |                                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^
51 |
52 |         # 模拟业务逻辑与外部调用
   |

BLE001 Do not catch blind exception: `Exception`
  --> examples/logging/unified_logging_example.py:65:12
   |
63 |             payload=exc.extra,
64 |         )
65 |     except Exception as exc:
   |            ^^^^^^^^^
66 |         log_error(
67 |             "请求处理发生未预期错误",
   |

D103 Missing docstring in public function
  --> examples/logging/unified_logging_example.py:94:5
   |
94 | def main() -> None:
   |     ^^^^
95 |     bootstrap_logging()
96 |     for path in ("/api/accounts", "/api/databases", "/api/aggregations"):
   |

INP001 File `examples/time/unified_time_example.py` is part of an implicit namespace package. Add an `__init__.py`.
--> examples/time/unified_time_example.py:1:1

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
 --> examples/time/unified_time_example.py:3:5
  |
1 | """Unified time processing 示例脚本。.
2 |
3 | 执行方式：
  |         ^^
4 |     $ python examples/time/unified_time_example.py
  |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> examples/time/unified_time_example.py:6:25
  |
4 |     $ python examples/time/unified_time_example.py
5 |
6 | 示例展示了如何在业务代码中使用统一的时间处理工具，包括：
  |                                                 ^^
7 | 1. 统一的时间获取和转换
8 | 2. 统一的时间格式化和显示
  |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
 --> examples/time/unified_time_example.py:6:28
  |
4 |     $ python examples/time/unified_time_example.py
5 |
6 | 示例展示了如何在业务代码中使用统一的时间处理工具，包括：
  |                                                       ^^
7 | 1. 统一的时间获取和转换
8 | 2. 统一的时间格式化和显示
  |

PLC0415 `import` should be at the top-level of a file
   --> examples/time/unified_time_example.py:209:5
    |
207 | def demonstrate_performance_considerations() -> None:
208 |     """演示性能考虑."""
209 |     import time as time_module
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^
210 |
211 |     # 测试批量时间格式化性能
    |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> examples/time/unified_time_example.py:230:11
    |
229 | def main() -> None:
230 |     """主函数：运行所有演示."""
    |              ^^
231 |     # 运行所有演示
232 |     demonstrate_basic_time_operations()
    |

INP001 File `examples/validation/standard_api_templates.py` is part of an implicit namespace package. Add an `__init__.py`.
--> examples/validation/standard_api_templates.py:1:1

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> examples/validation/standard_api_templates.py:3:21
  |
1 | """标准API接口实现模板.
2 |
3 | 这些模板展示了统一验证规范的标准实现方式，可以作为开发新接口或重构旧接口的参考。
  |                                         ^^
4 | """
  |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> examples/validation/standard_api_templates.py:18:15
   |
17 | # ============================================================================
18 | # 模板1: JSON写接口（POST）
   |                    ^^
19 | # ============================================================================
   |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> examples/validation/standard_api_templates.py:18:20
   |
17 | # ============================================================================
18 | # 模板1: JSON写接口（POST）
   |                          ^^
19 | # ============================================================================
   |

ANN201 Missing return type annotation for public function `create_resource`
  --> examples/validation/standard_api_templates.py:23:5
   |
21 | @blueprint.route("/api/resources", methods=["POST"])
22 | @create_required
23 | def create_resource():
   |     ^^^^^^^^^^^^^^^
24 |     """创建资源接口模板.
   |
help: Add return type annotation

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> examples/validation/standard_api_templates.py:26:10
   |
24 |     """创建资源接口模板.
25 |
26 |     装饰器顺序：
   |               ^^
27 |     1. @create_required - 验证创建权限
28 |     """
   |

ERA001 Found commented-out code
  --> examples/validation/standard_api_templates.py:50:5
   |
49 |     # 4. 业务逻辑
50 |     # resource = Resource(**data)
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
51 |     # db.session.add(resource)
52 |     # db.session.commit()
   |
help: Remove commented-out code

ERA001 Found commented-out code
  --> examples/validation/standard_api_templates.py:51:5
   |
49 |     # 4. 业务逻辑
50 |     # resource = Resource(**data)
51 |     # db.session.add(resource)
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^
52 |     # db.session.commit()
   |
help: Remove commented-out code

ERA001 Found commented-out code
  --> examples/validation/standard_api_templates.py:52:5
   |
50 |     # resource = Resource(**data)
51 |     # db.session.add(resource)
52 |     # db.session.commit()
   |     ^^^^^^^^^^^^^^^^^^^^^
53 |
54 |     # 5. 返回成功响应
   |
help: Remove commented-out code

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> examples/validation/standard_api_templates.py:62:12
   |
61 | # ============================================================================
62 | # 模板2: 查询接口（GET）
   |                  ^^
63 | # ============================================================================
   |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> examples/validation/standard_api_templates.py:62:16
   |
61 | # ============================================================================
62 | # 模板2: 查询接口（GET）
   |                       ^^
63 | # ============================================================================
   |

ANN201 Missing return type annotation for public function `list_resources`
  --> examples/validation/standard_api_templates.py:67:5
   |
65 | @blueprint.route("/api/resources")
66 | @view_required
67 | def list_resources():
   |     ^^^^^^^^^^^^^^
68 |     """查询资源列表接口模板.
   |
help: Add return type annotation

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> examples/validation/standard_api_templates.py:70:7
   |
68 |     """查询资源列表接口模板.
69 |
70 |     特点：
   |         ^^
71 |     - 使用 type 参数安全转换类型
72 |     - 参数验证使用异常抛出
   |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> examples/validation/standard_api_templates.py:75:14
   |
73 |     - 统一的分页响应格式
74 |     """
75 |     # 1. 获取参数（使用 type 参数安全转换）
   |                  ^^
76 |     page = request.args.get("page", 1, type=int)
77 |     per_page = request.args.get("per_page", 20, type=int)
   |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> examples/validation/standard_api_templates.py:75:29
   |
73 |     - 统一的分页响应格式
74 |     """
75 |     # 1. 获取参数（使用 type 参数安全转换）
   |                                          ^^
76 |     page = request.args.get("page", 1, type=int)
77 |     per_page = request.args.get("per_page", 20, type=int)
   |

PLR2004 Magic value used in comparison, consider replacing `100` with a constant variable
  --> examples/validation/standard_api_templates.py:85:35
   |
83 |         msg = "页码必须大于0"
84 |         raise ValidationError(msg)
85 |     if per_page < 1 or per_page > 100:
   |                                   ^^^
86 |         msg = "每页数量必须在1-100之间"
87 |         raise ValidationError(msg)
   |

ERA001 Found commented-out code
  --> examples/validation/standard_api_templates.py:90:5
   |
89 |     # 3. 构建查询
90 |     # query = Resource.query
   |     ^^^^^^^^^^^^^^^^^^^^^^^^
91 |     #
92 |     # if search:
   |
help: Remove commented-out code

ERA001 Found commented-out code
  --> examples/validation/standard_api_templates.py:93:5
   |
91 |     #
92 |     # if search:
93 |     #     query = query.filter(Resource.name.contains(search))
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
94 |     #
95 |     # if status:
   |
help: Remove commented-out code

ERA001 Found commented-out code
  --> examples/validation/standard_api_templates.py:96:5
   |
94 |     #
95 |     # if status:
96 |     #     query = query.filter(Resource.status == status)
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
97 |
98 |     # 4. 分页
   |
help: Remove commented-out code

ERA001 Found commented-out code
   --> examples/validation/standard_api_templates.py:99:5
    |
 98 |     # 4. 分页
 99 |     # pagination = query.paginate(
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
100 |     #     page=page,
101 |     #     per_page=per_page,
    |
help: Remove commented-out code

ERA001 Found commented-out code
   --> examples/validation/standard_api_templates.py:100:5
    |
 98 |     # 4. 分页
 99 |     # pagination = query.paginate(
100 |     #     page=page,
    |     ^^^^^^^^^^^^^^^^
101 |     #     per_page=per_page,
102 |     #     error_out=False
    |
help: Remove commented-out code

ERA001 Found commented-out code
   --> examples/validation/standard_api_templates.py:101:5
    |
 99 |     # pagination = query.paginate(
100 |     #     page=page,
101 |     #     per_page=per_page,
    |     ^^^^^^^^^^^^^^^^^^^^^^^^
102 |     #     error_out=False
103 |     # )
    |
help: Remove commented-out code

ERA001 Found commented-out code
   --> examples/validation/standard_api_templates.py:102:5
    |
100 |     #     page=page,
101 |     #     per_page=per_page,
102 |     #     error_out=False
    |     ^^^^^^^^^^^^^^^^^^^^^
103 |     # )
    |
help: Remove commented-out code

ERA001 Found commented-out code
   --> examples/validation/standard_api_templates.py:103:5
    |
101 |     #     per_page=per_page,
102 |     #     error_out=False
103 |     # )
    |     ^^^
104 |
105 |     # 5. 返回响应
    |
help: Remove commented-out code

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> examples/validation/standard_api_templates.py:122:12
    |
121 | # ============================================================================
122 | # 模板3: 更新接口（PUT/PATCH）
    |                  ^^
123 | # ============================================================================
    |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> examples/validation/standard_api_templates.py:122:22
    |
121 | # ============================================================================
122 | # 模板3: 更新接口（PUT/PATCH）
    |                             ^^
123 | # ============================================================================
    |

ANN201 Missing return type annotation for public function `update_resource`
   --> examples/validation/standard_api_templates.py:127:5
    |
125 | @blueprint.route("/api/resources/<int:resource_id>", methods=["PUT"])
126 | @update_required
127 | def update_resource(resource_id: int):
    |     ^^^^^^^^^^^^^^^
128 |     """更新资源接口模板.
    |
help: Add return type annotation

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> examples/validation/standard_api_templates.py:130:7
    |
128 |     """更新资源接口模板.
129 |
130 |     特点：
    |         ^^
131 |     - 先检查资源是否存在
132 |     - 验证数据后再更新
    |

ERA001 Found commented-out code
   --> examples/validation/standard_api_templates.py:136:5
    |
134 |     """
135 |     # 1. 查找资源
136 |     # resource = Resource.query.get(resource_id)
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
137 |     # if not resource:
138 |     #     raise NotFoundError("资源不存在")
    |
help: Remove commented-out code

ERA001 Found commented-out code
   --> examples/validation/standard_api_templates.py:138:5
    |
136 |     # resource = Resource.query.get(resource_id)
137 |     # if not resource:
138 |     #     raise NotFoundError("资源不存在")
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
139 |
140 |     # 2. 获取并清理数据
    |
help: Remove commented-out code

ERA001 Found commented-out code
   --> examples/validation/standard_api_templates.py:159:5
    |
157 |     # for key, value in data.items():
158 |     #     if hasattr(resource, key):
159 |     #         setattr(resource, key, value)
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
160 |     #
161 |     # db.session.commit()
    |
help: Remove commented-out code

ERA001 Found commented-out code
   --> examples/validation/standard_api_templates.py:161:5
    |
159 |     #         setattr(resource, key, value)
160 |     #
161 |     # db.session.commit()
    |     ^^^^^^^^^^^^^^^^^^^^^
162 |
163 |     # 5. 返回成功响应
    |
help: Remove commented-out code

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> examples/validation/standard_api_templates.py:171:12
    |
170 | # ============================================================================
171 | # 模板4: 删除接口（DELETE）
    |                  ^^
172 | # ============================================================================
    |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> examples/validation/standard_api_templates.py:171:19
    |
170 | # ============================================================================
171 | # 模板4: 删除接口（DELETE）
    |                          ^^
172 | # ============================================================================
    |

ANN201 Missing return type annotation for public function `delete_resource`
   --> examples/validation/standard_api_templates.py:176:5
    |
174 | @blueprint.route("/api/resources/<int:resource_id>", methods=["DELETE"])
175 | @delete_required
176 | def delete_resource(resource_id: int):
    |     ^^^^^^^^^^^^^^^
177 |     """删除资源接口模板.
    |
help: Add return type annotation

ARG001 Unused function argument: `resource_id`
   --> examples/validation/standard_api_templates.py:176:21
    |
174 | @blueprint.route("/api/resources/<int:resource_id>", methods=["DELETE"])
175 | @delete_required
176 | def delete_resource(resource_id: int):
    |                     ^^^^^^^^^^^
177 |     """删除资源接口模板.
    |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> examples/validation/standard_api_templates.py:179:7
    |
177 |     """删除资源接口模板.
178 |
179 |     特点：
    |         ^^
180 |     - 简洁的删除逻辑
181 |     - 使用 NotFoundError 处理资源不存在
    |

ERA001 Found commented-out code
   --> examples/validation/standard_api_templates.py:185:5
    |
183 |     """
184 |     # 1. 查找资源
185 |     # resource = Resource.query.get(resource_id)
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
186 |     # if not resource:
187 |     #     raise NotFoundError("资源不存在")
    |
help: Remove commented-out code

ERA001 Found commented-out code
   --> examples/validation/standard_api_templates.py:187:5
    |
185 |     # resource = Resource.query.get(resource_id)
186 |     # if not resource:
187 |     #     raise NotFoundError("资源不存在")
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
188 |
189 |     # 2. 删除资源
    |
help: Remove commented-out code

ERA001 Found commented-out code
   --> examples/validation/standard_api_templates.py:190:5
    |
189 |     # 2. 删除资源
190 |     # db.session.delete(resource)
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
191 |     # db.session.commit()
    |
help: Remove commented-out code

ERA001 Found commented-out code
   --> examples/validation/standard_api_templates.py:191:5
    |
189 |     # 2. 删除资源
190 |     # db.session.delete(resource)
191 |     # db.session.commit()
    |     ^^^^^^^^^^^^^^^^^^^^^
192 |
193 |     # 3. 返回成功响应
    |
help: Remove commented-out code

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> examples/validation/standard_api_templates.py:198:14
    |
197 | # ============================================================================
198 | # 模板5: 批量操作接口（POST）
    |                      ^^
199 | # ============================================================================
    |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> examples/validation/standard_api_templates.py:198:19
    |
197 | # ============================================================================
198 | # 模板5: 批量操作接口（POST）
    |                            ^^
199 | # ============================================================================
    |

ANN201 Missing return type annotation for public function `batch_operation`
   --> examples/validation/standard_api_templates.py:203:5
    |
201 | @blueprint.route("/api/resources/batch", methods=["POST"])
202 | @update_required
203 | def batch_operation():
    |     ^^^^^^^^^^^^^^^
204 |     """批量操作接口模板.
    |
help: Add return type annotation

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> examples/validation/standard_api_templates.py:206:7
    |
204 |     """批量操作接口模板.
205 |
206 |     特点：
    |         ^^
207 |     - 验证批量数据
208 |     - 统计操作结果
    |

ERA001 Found commented-out code
   --> examples/validation/standard_api_templates.py:240:5
    |
239 |     # for resource_id in ids:
240 |     #     try:
    |     ^^^^^^^^^^
241 |     #         resource = Resource.query.get(resource_id)
242 |     #         if resource:
    |
help: Remove commented-out code

ERA001 Found commented-out code
   --> examples/validation/standard_api_templates.py:241:5
    |
239 |     # for resource_id in ids:
240 |     #     try:
241 |     #         resource = Resource.query.get(resource_id)
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
242 |     #         if resource:
243 |     #             if action == "enable":
    |
help: Remove commented-out code

ERA001 Found commented-out code
   --> examples/validation/standard_api_templates.py:244:5
    |
242 |     #         if resource:
243 |     #             if action == "enable":
244 |     #                 resource.is_active = True
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
245 |     #             elif action == "disable":
246 |     #                 resource.is_active = False
    |
help: Remove commented-out code

ERA001 Found commented-out code
   --> examples/validation/standard_api_templates.py:245:5
    |
243 |     #             if action == "enable":
244 |     #                 resource.is_active = True
245 |     #             elif action == "disable":
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
246 |     #                 resource.is_active = False
247 |     #             elif action == "delete":
    |
help: Remove commented-out code

ERA001 Found commented-out code
   --> examples/validation/standard_api_templates.py:246:5
    |
244 |     #                 resource.is_active = True
245 |     #             elif action == "disable":
246 |     #                 resource.is_active = False
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
247 |     #             elif action == "delete":
248 |     #                 db.session.delete(resource)
    |
help: Remove commented-out code

ERA001 Found commented-out code
   --> examples/validation/standard_api_templates.py:247:5
    |
245 |     #             elif action == "disable":
246 |     #                 resource.is_active = False
247 |     #             elif action == "delete":
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
248 |     #                 db.session.delete(resource)
249 |     #             success_count += 1
    |
help: Remove commented-out code

ERA001 Found commented-out code
   --> examples/validation/standard_api_templates.py:248:5
    |
246 |     #                 resource.is_active = False
247 |     #             elif action == "delete":
248 |     #                 db.session.delete(resource)
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
249 |     #             success_count += 1
250 |     #         else:
    |
help: Remove commented-out code

ERA001 Found commented-out code
   --> examples/validation/standard_api_templates.py:249:5
    |
247 |     #             elif action == "delete":
248 |     #                 db.session.delete(resource)
249 |     #             success_count += 1
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
250 |     #         else:
251 |     #             failed_count += 1
    |
help: Remove commented-out code

ERA001 Found commented-out code
   --> examples/validation/standard_api_templates.py:250:5
    |
248 |     #                 db.session.delete(resource)
249 |     #             success_count += 1
250 |     #         else:
    |     ^^^^^^^^^^^^^^^
251 |     #             failed_count += 1
252 |     #     except Exception:
    |
help: Remove commented-out code

ERA001 Found commented-out code
   --> examples/validation/standard_api_templates.py:251:5
    |
249 |     #             success_count += 1
250 |     #         else:
251 |     #             failed_count += 1
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
252 |     #     except Exception:
253 |     #         failed_count += 1
    |
help: Remove commented-out code

ERA001 Found commented-out code
   --> examples/validation/standard_api_templates.py:252:5
    |
250 |     #         else:
251 |     #             failed_count += 1
252 |     #     except Exception:
    |     ^^^^^^^^^^^^^^^^^^^^^^^
253 |     #         failed_count += 1
254 |     #
    |
help: Remove commented-out code

ERA001 Found commented-out code
   --> examples/validation/standard_api_templates.py:253:5
    |
251 |     #             failed_count += 1
252 |     #     except Exception:
253 |     #         failed_count += 1
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^
254 |     #
255 |     # db.session.commit()
    |
help: Remove commented-out code

ERA001 Found commented-out code
   --> examples/validation/standard_api_templates.py:255:5
    |
253 |     #         failed_count += 1
254 |     #
255 |     # db.session.commit()
    |     ^^^^^^^^^^^^^^^^^^^^^
256 |
257 |     # 4. 返回操作结果
    |
help: Remove commented-out code

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> examples/validation/standard_api_templates.py:264:25
    |
262 |             "failed": failed_count,
263 |         },
264 |         message=f"批量操作完成，成功 {success_count} 个，失败 {failed_count} 个",
    |                               ^^
265 |     )
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> examples/validation/standard_api_templates.py:264:46
    |
262 |             "failed": failed_count,
263 |         },
264 |         message=f"批量操作完成，成功 {success_count} 个，失败 {failed_count} 个",
    |                                                        ^^
265 |     )
    |

RUF003 Comment contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> examples/validation/standard_api_templates.py:269:7
    |
268 | # ============================================================================
269 | # 反面示例：不要这样写
    |           ^^
270 | # ============================================================================
    |

ANN201 Missing return type annotation for public function `bad_example_create`
   --> examples/validation/standard_api_templates.py:272:5
    |
270 | # ============================================================================
271 |
272 | def bad_example_create():
    |     ^^^^^^^^^^^^^^^^^^
273 |     """❌ 错误示例：不要这样写.
    |
help: Add return type annotation

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> examples/validation/standard_api_templates.py:273:14
    |
272 | def bad_example_create():
273 |     """❌ 错误示例：不要这样写.
    |                   ^^
274 |
275 |     问题：
    |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> examples/validation/standard_api_templates.py:275:7
    |
273 |     """❌ 错误示例：不要这样写.
274 |
275 |     问题：
    |         ^^
276 |     1. 缺少装饰器验证
277 |     2. 使用内联错误返回
    |

ERA001 Found commented-out code
   --> examples/validation/standard_api_templates.py:293:5
    |
292 |     # ❌ 没有数据清理
293 |     # resource = Resource(**data)
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
294 |
295 |     return {"success": True, "data": {}}, 200
    |
help: Remove commented-out code

ANN201 Missing return type annotation for public function `bad_example_list`
   --> examples/validation/standard_api_templates.py:298:5
    |
298 | def bad_example_list():
    |     ^^^^^^^^^^^^^^^^
299 |     """❌ 错误示例：不要这样写.
    |
help: Add return type annotation

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> examples/validation/standard_api_templates.py:299:14
    |
298 | def bad_example_list():
299 |     """❌ 错误示例：不要这样写.
    |                   ^^
300 |
301 |     问题：
    |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> examples/validation/standard_api_templates.py:301:7
    |
299 |     """❌ 错误示例：不要这样写.
300 |
301 |     问题：
    |         ^^
302 |     1. 不安全的类型转换
303 |     2. 没有参数验证
    |

RUF003 Comment contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> examples/validation/standard_api_templates.py:306:17
    |
304 |     3. 响应格式不统一
305 |     """
306 |     # ❌ 不安全的类型转换（可能抛出 ValueError）
    |                          ^^
307 |     int(request.args.get("page", 1))
308 |     int(request.args.get("per_page", 20))
    |

RUF003 Comment contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> examples/validation/standard_api_templates.py:306:33
    |
304 |     3. 响应格式不统一
305 |     """
306 |     # ❌ 不安全的类型转换（可能抛出 ValueError）
    |                                               ^^
307 |     int(request.args.get("page", 1))
308 |     int(request.args.get("per_page", 20))
    |

ERA001 Found commented-out code
   --> examples/validation/standard_api_templates.py:311:5
    |
310 |     # ❌ 没有参数验证
311 |     # query = Resource.query.paginate(page=page, per_page=per_page)
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
312 |
313 |     # ❌ 响应格式不统一
    |
help: Remove commented-out code

INP001 File `migrations/env.py` is part of an implicit namespace package. Add an `__init__.py`.
--> migrations/env.py:1:1

D100 Missing docstring in public module
--> migrations/env.py:1:1

ANN201 Missing return type annotation for public function `get_engine`
  --> migrations/env.py:17:5
   |
17 | def get_engine():
   |     ^^^^^^^^^^
18 |     try:
19 |         # this works with Flask-SQLAlchemy<3 and Alchemical
   |
help: Add return type annotation

D103 Missing docstring in public function
  --> migrations/env.py:17:5
   |
17 | def get_engine():
   |     ^^^^^^^^^^
18 |     try:
19 |         # this works with Flask-SQLAlchemy<3 and Alchemical
   |

ANN201 Missing return type annotation for public function `get_engine_url`
  --> migrations/env.py:26:5
   |
26 | def get_engine_url():
   |     ^^^^^^^^^^^^^^
27 |     try:
28 |         return get_engine().url.render_as_string(hide_password=False).replace(
   |
help: Add return type annotation

D103 Missing docstring in public function
  --> migrations/env.py:26:5
   |
26 | def get_engine_url():
   |     ^^^^^^^^^^^^^^
27 |     try:
28 |         return get_engine().url.render_as_string(hide_password=False).replace(
   |

ERA001 Found commented-out code
  --> migrations/env.py:36:1
   |
34 | # add your model's MetaData object here
35 | # for 'autogenerate' support
36 | # from myapp import mymodel
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^
37 | # target_metadata = mymodel.Base.metadata
38 | config.set_main_option("sqlalchemy.url", get_engine_url())
   |
help: Remove commented-out code

ERA001 Found commented-out code
  --> migrations/env.py:37:1
   |
35 | # for 'autogenerate' support
36 | # from myapp import mymodel
37 | # target_metadata = mymodel.Base.metadata
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
38 | config.set_main_option("sqlalchemy.url", get_engine_url())
39 | target_db = current_app.extensions["migrate"].db
   |
help: Remove commented-out code

ERA001 Found commented-out code
  --> migrations/env.py:43:1
   |
41 | # other values from the config, defined by the needs of env.py,
42 | # can be acquired:
43 | # my_important_option = config.get_main_option("my_important_option")
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
44 | # ... etc.
   |
help: Remove commented-out code

ANN201 Missing return type annotation for public function `get_metadata`
  --> migrations/env.py:47:5
   |
47 | def get_metadata():
   |     ^^^^^^^^^^^^
48 |     if hasattr(target_db, "metadatas"):
49 |         return target_db.metadatas[None]
   |
help: Add return type annotation

D103 Missing docstring in public function
  --> migrations/env.py:47:5
   |
47 | def get_metadata():
   |     ^^^^^^^^^^^^
48 |     if hasattr(target_db, "metadatas"):
49 |         return target_db.metadatas[None]
   |

ANN001 Missing type annotation for function argument `context`
  --> migrations/env.py:85:37
   |
83 |     # when there are no changes to the schema
84 |     # reference: http://alembic.zzzcomputing.com/en/latest/cookbook.html
85 |     def process_revision_directives(context, revision, directives) -> None:
   |                                     ^^^^^^^
86 |         if getattr(config.cmd_opts, "autogenerate", False):
87 |             script = directives[0]
   |

ARG001 Unused function argument: `context`
  --> migrations/env.py:85:37
   |
83 |     # when there are no changes to the schema
84 |     # reference: http://alembic.zzzcomputing.com/en/latest/cookbook.html
85 |     def process_revision_directives(context, revision, directives) -> None:
   |                                     ^^^^^^^
86 |         if getattr(config.cmd_opts, "autogenerate", False):
87 |             script = directives[0]
   |

ANN001 Missing type annotation for function argument `revision`
  --> migrations/env.py:85:46
   |
83 |     # when there are no changes to the schema
84 |     # reference: http://alembic.zzzcomputing.com/en/latest/cookbook.html
85 |     def process_revision_directives(context, revision, directives) -> None:
   |                                              ^^^^^^^^
86 |         if getattr(config.cmd_opts, "autogenerate", False):
87 |             script = directives[0]
   |

ARG001 Unused function argument: `revision`
  --> migrations/env.py:85:46
   |
83 |     # when there are no changes to the schema
84 |     # reference: http://alembic.zzzcomputing.com/en/latest/cookbook.html
85 |     def process_revision_directives(context, revision, directives) -> None:
   |                                              ^^^^^^^^
86 |         if getattr(config.cmd_opts, "autogenerate", False):
87 |             script = directives[0]
   |

ANN001 Missing type annotation for function argument `directives`
  --> migrations/env.py:85:56
   |
83 |     # when there are no changes to the schema
84 |     # reference: http://alembic.zzzcomputing.com/en/latest/cookbook.html
85 |     def process_revision_directives(context, revision, directives) -> None:
   |                                                        ^^^^^^^^^^
86 |         if getattr(config.cmd_opts, "autogenerate", False):
87 |             script = directives[0]
   |

INP001 File `nginx/gunicorn/gunicorn-dev.conf.py` is part of an implicit namespace package. Add an `__init__.py`.
--> nginx/gunicorn/gunicorn-dev.conf.py:1:1

D100 Missing docstring in public module
--> nginx/gunicorn/gunicorn-dev.conf.py:1:1

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> nginx/gunicorn/gunicorn-dev.conf.py:9:33
   |
 7 | # 工作进程 - 开发环境简化配置
 8 | workers = 1  # 开发环境使用单进程
 9 | worker_class = "sync"  # 使用同步工作器，便于调试
   |                                        ^^
10 | timeout = 60  # 开发环境超时时间更长
11 | keepalive = 2
   |

INP001 File `nginx/gunicorn/gunicorn-prod.conf.py` is part of an implicit namespace package. Add an `__init__.py`.
--> nginx/gunicorn/gunicorn-prod.conf.py:1:1

D100 Missing docstring in public module
--> nginx/gunicorn/gunicorn-prod.conf.py:1:1

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> nginx/gunicorn/gunicorn-prod.conf.py:8:22
   |
 7 | # 工作进程 - 简化配置
 8 | workers = 1  # 固定2个进程，避免复杂配置
   |                           ^^
 9 | worker_class = "gevent"  # 使用gevent工作器，支持异步
10 | worker_connections = 1000  # gevent工作器连接数
   |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> nginx/gunicorn/gunicorn-prod.conf.py:9:39
   |
 7 | # 工作进程 - 简化配置
 8 | workers = 1  # 固定2个进程，避免复杂配置
 9 | worker_class = "gevent"  # 使用gevent工作器，支持异步
   |                                            ^^
10 | worker_connections = 1000  # gevent工作器连接数
11 | timeout = 120
   |

RUF003 Comment contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> nginx/gunicorn/gunicorn-prod.conf.py:22:30
   |
20 | accesslog = "/app/userdata/logs/gunicorn_access.log"
21 | errorlog = "/app/userdata/logs/gunicorn_error.log"
22 | loglevel = "info"  # 改为info级别，减少日志量
   |                                  ^^
23 | access_log_format = '%(h)s %(l)s %(u)s %(t)s "%(r)s" %(s)s %(b)s "%(f)s" "%(a)s" %(D)s'
   |

S108 Probable insecure usage of temporary file or directory: "/dev/shm"
  --> nginx/gunicorn/gunicorn-prod.conf.py:48:18
   |
47 | # Gevent特定配置
48 | worker_tmp_dir = "/dev/shm"  # 使用内存文件系统提高性能
   |                  ^^^^^^^^^^
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> scripts/audit_colors.py:2:17
  |
1 | #!/usr/bin/env python3
2 | """扫描静态资源中的硬编码颜色，辅助色彩收敛专项。.
  |                              ^^
3 |
4 | 默认扫描 `app/static/css` 与 `app/static/js`，忽略 vendor 目录以及
  |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> scripts/audit_colors.py:4:40
  |
2 | """扫描静态资源中的硬编码颜色，辅助色彩收敛专项。.
3 |
4 | 默认扫描 `app/static/css` 与 `app/static/js`，忽略 vendor 目录以及
  |                                             ^^
5 | `variables.css`/`theme-orange.css` 等 token 定义文件。可通过参数
6 | `--json` 输出机器可读的结果，使用 `--strict` 在发现违规时返回非零状态。
  |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> scripts/audit_colors.py:6:19
  |
4 | 默认扫描 `app/static/css` 与 `app/static/js`，忽略 vendor 目录以及
5 | `variables.css`/`theme-orange.css` 等 token 定义文件。可通过参数
6 | `--json` 输出机器可读的结果，使用 `--strict` 在发现违规时返回非零状态。
  |                            ^^
7 | """
8 | from __future__ import annotations
  |

D103 Missing docstring in public function
  --> scripts/audit_colors.py:38:5
   |
38 | def iter_files(paths: Sequence[Path]) -> Sequence[Path]:
   |     ^^^^^^^^^^
39 |     for base in paths:
40 |         if not base.exists():
   |

D103 Missing docstring in public function
  --> scripts/audit_colors.py:54:5
   |
54 | def scan_file(path: Path) -> list[tuple[int, str]]:
   |     ^^^^^^^^^
55 |     if path in ALLOWLIST:
56 |         return []
   |

D103 Missing docstring in public function
  --> scripts/audit_colors.py:76:5
   |
76 | def format_report(results: dict[str, list[tuple[int, str]]]) -> str:
   |     ^^^^^^^^^^^^^
77 |     lines: list[str] = []
78 |     for path, entries in sorted(results.items()):
   |

D103 Missing docstring in public function
  --> scripts/audit_colors.py:86:5
   |
86 | def main(argv: Sequence[str]) -> int:
   |     ^^^^
87 |     parser = argparse.ArgumentParser(description=__doc__)
88 |     parser.add_argument("paths", nargs="*", type=Path, default=DEFAULT_SCAN_ROOTS,
   |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> scripts/audit_colors.py:89:39
   |
87 |     parser = argparse.ArgumentParser(description=__doc__)
88 |     parser.add_argument("paths", nargs="*", type=Path, default=DEFAULT_SCAN_ROOTS,
89 |                         help="待扫描目录或文件，默认检查 app/static/css, app/static/js")
   |                                               ^^
90 |     parser.add_argument("--json", action="store_true", dest="as_json",
91 |                         help="以 JSON 形式输出结果")
   |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> scripts/audit_colors.py:118:31
    |
116 |         LOGGER.info("%s", format_report(findings))
117 |     else:
118 |         LOGGER.info("未检测到硬编码颜色，已全部引用 token ✅")
    |                                        ^^
119 |
120 |     if args.strict and findings:
    |

EXE001 Shebang is present but file is not executable
 --> scripts/check_missing_docs_smart.py:1:1
  |
1 | #!/usr/bin/env python3
  | ^^^^^^^^^^^^^^^^^^^^^^
2 | """Docstring 缺失检测脚本。.
  |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> scripts/check_missing_docs_smart.py:4:22
  |
2 | """Docstring 缺失检测脚本。.
3 |
4 | 该脚本扫描指定目录下的 Python 文件，识别缺失 docstring 的模块、类、
  |                                   ^^
5 | 函数，并生成 Markdown 报告，帮助团队持续对齐 Google 风格文档规范。
  |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> scripts/check_missing_docs_smart.py:5:3
  |
4 | 该脚本扫描指定目录下的 Python 文件，识别缺失 docstring 的模块、类、
5 | 函数，并生成 Markdown 报告，帮助团队持续对齐 Google 风格文档规范。
  |     ^^
6 |
7 | Typical usage example::
  |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> scripts/check_missing_docs_smart.py:5:19
  |
4 | 该脚本扫描指定目录下的 Python 文件，识别缺失 docstring 的模块、类、
5 | 函数，并生成 Markdown 报告，帮助团队持续对齐 Google 风格文档规范。
  |                           ^^
6 |
7 | Typical usage example::
  |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> scripts/check_missing_docs_smart.py:52:25
   |
50 |         name: 需要补充文档的对象名称。
51 |         line: 该对象在源文件中的行号。
52 |         details: 缺失部分的列表，例如 Args 或 @returns。
   |                                ^^
53 |
54 |     """
   |

C901 `analyze_python_file` is too complex (16 > 10)
   --> scripts/check_missing_docs_smart.py:141:5
    |
141 | def analyze_python_file(path: Path) -> MissingDocReport | None:
    |     ^^^^^^^^^^^^^^^^^^^
142 |     """Create a missing docstring report for a single Python file.
    |

PLR0912 Too many branches (17 > 12)
   --> scripts/check_missing_docs_smart.py:141:5
    |
141 | def analyze_python_file(path: Path) -> MissingDocReport | None:
    |     ^^^^^^^^^^^^^^^^^^^
142 |     """Create a missing docstring report for a single Python file.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> scripts/check_missing_docs_smart.py:208:22
    |
206 |     """返回函数文档缺失的 Google 风格段落。.
207 |
208 |     读取函数定义的 docstring，并检查是否包含 Args 与 Returns 区块，
    |                             ^^
209 |     以便报告脚本能够精准提示缺失项目。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> scripts/check_missing_docs_smart.py:208:48
    |
206 |     """返回函数文档缺失的 Google 风格段落。.
207 |
208 |     读取函数定义的 docstring，并检查是否包含 Args 与 Returns 区块，
    |                                                                  ^^
209 |     以便报告脚本能够精准提示缺失项目。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> scripts/check_missing_docs_smart.py:216:29
    |
215 |     Returns:
216 |         list[str]: 缺失的段落名称列表，例如 ``"Args"`` 或 ``"Returns"``。
    |                                      ^^
217 |
218 |     """
    |

C901 `analyze_js_file` is too complex (18 > 10)
   --> scripts/check_missing_docs_smart.py:241:5
    |
241 | def analyze_js_file(path: Path) -> MissingDocReport | None:
    |     ^^^^^^^^^^^^^^^
242 |     """Create a missing JSDoc report for a JavaScript file.
    |

PLR0912 Too many branches (19 > 12)
   --> scripts/check_missing_docs_smart.py:241:5
    |
241 | def analyze_js_file(path: Path) -> MissingDocReport | None:
    |     ^^^^^^^^^^^^^^^
242 |     """Create a missing JSDoc report for a JavaScript file.
    |

PLR0915 Too many statements (59 > 50)
   --> scripts/check_missing_docs_smart.py:241:5
    |
241 | def analyze_js_file(path: Path) -> MissingDocReport | None:
    |     ^^^^^^^^^^^^^^^
242 |     """Create a missing JSDoc report for a JavaScript file.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> scripts/check_missing_docs_smart.py:346:21
    |
344 |     """判断匹配的 JavaScript 函数是否声明参数。.
345 |
346 |     通过解析函数定义所在行及其后续行，拼合完整签名并检测括号内的
    |                                     ^^
347 |     字符是否为空，以此决定是否需要 @param 提示。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> scripts/check_missing_docs_smart.py:347:11
    |
346 |     通过解析函数定义所在行及其后续行，拼合完整签名并检测括号内的
347 |     字符是否为空，以此决定是否需要 @param 提示。
    |                 ^^
348 |
349 |     Args:
    |

RUF002 Docstring contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> scripts/check_missing_docs_smart.py:380:10
    |
379 | def _collect_js_signature(lines: Sequence[str], start_index: int) -> str:
380 |     """收集（可能跨行的）函数签名文本。.
    |            ^^
381 |
382 |     Args:
    |

RUF002 Docstring contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> scripts/check_missing_docs_smart.py:380:16
    |
379 | def _collect_js_signature(lines: Sequence[str], start_index: int) -> str:
380 |     """收集（可能跨行的）函数签名文本。.
    |                        ^^
381 |
382 |     Args:
    |

DTZ005 `datetime.datetime.now()` called without a `tz` argument
   --> scripts/check_missing_docs_smart.py:423:17
    |
421 |     missing_classes = sum(len(rpt.classes) for rpt in results.values())
422 |     missing_functions = sum(len(rpt.functions) for rpt in results.values())
423 |     timestamp = dt.datetime.now().strftime("%Y-%m-%d %H:%M:%S")
    |                 ^^^^^^^^^^^^^^^^^
424 |     lines = [
425 |         "# 缺失 Docstring 统计报告",
    |
help: Pass a `datetime.timezone` object to the `tz` parameter

RUF001 String contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> scripts/check_missing_docs_smart.py:427:17
    |
425 |         "# 缺失 Docstring 统计报告",
426 |         "",
427 |         f"- 生成时间：{timestamp}",
    |                     ^^
428 |         f"- 扫描文件：{scanned_files}",
429 |         f"- 模块缺失：{missing_modules}",
    |

RUF001 String contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> scripts/check_missing_docs_smart.py:428:17
    |
426 |         "",
427 |         f"- 生成时间：{timestamp}",
428 |         f"- 扫描文件：{scanned_files}",
    |                     ^^
429 |         f"- 模块缺失：{missing_modules}",
430 |         f"- 类缺失：{missing_classes}",
    |

RUF001 String contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> scripts/check_missing_docs_smart.py:429:17
    |
427 |         f"- 生成时间：{timestamp}",
428 |         f"- 扫描文件：{scanned_files}",
429 |         f"- 模块缺失：{missing_modules}",
    |                     ^^
430 |         f"- 类缺失：{missing_classes}",
431 |         f"- 函数/方法缺失：{missing_functions}",
    |

RUF001 String contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> scripts/check_missing_docs_smart.py:430:16
    |
428 |         f"- 扫描文件：{scanned_files}",
429 |         f"- 模块缺失：{missing_modules}",
430 |         f"- 类缺失：{missing_classes}",
    |                   ^^
431 |         f"- 函数/方法缺失：{missing_functions}",
432 |         "",
    |

RUF001 String contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> scripts/check_missing_docs_smart.py:431:20
    |
429 |         f"- 模块缺失：{missing_modules}",
430 |         f"- 类缺失：{missing_classes}",
431 |         f"- 函数/方法缺失：{missing_functions}",
    |                          ^^
432 |         "",
433 |         "> 说明：仅统计对外/公共定义（排除了私有、`__init__`、测试函数等），请按需补充 docstring。",
    |

RUF001 String contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> scripts/check_missing_docs_smart.py:433:14
    |
431 |         f"- 函数/方法缺失：{missing_functions}",
432 |         "",
433 |         "> 说明：仅统计对外/公共定义（排除了私有、`__init__`、测试函数等），请按需补充 docstring。",
    |                ^^
434 |         "",
435 |     ]
    |

RUF001 String contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> scripts/check_missing_docs_smart.py:433:25
    |
431 |         f"- 函数/方法缺失：{missing_functions}",
432 |         "",
433 |         "> 说明：仅统计对外/公共定义（排除了私有、`__init__`、测试函数等），请按需补充 docstring。",
    |                                     ^^
434 |         "",
435 |     ]
    |

RUF001 String contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> scripts/check_missing_docs_smart.py:433:48
    |
431 |         f"- 函数/方法缺失：{missing_functions}",
432 |         "",
433 |         "> 说明：仅统计对外/公共定义（排除了私有、`__init__`、测试函数等），请按需补充 docstring。",
    |                                                                         ^^
434 |         "",
435 |     ]
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> scripts/check_missing_docs_smart.py:433:49
    |
431 |         f"- 函数/方法缺失：{missing_functions}",
432 |         "",
433 |         "> 说明：仅统计对外/公共定义（排除了私有、`__init__`、测试函数等），请按需补充 docstring。",
    |                                                                           ^^
434 |         "",
435 |     ]
    |

RUF001 String contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> scripts/check_missing_docs_smart.py:445:45
    |
443 |             lines.append(f"- 模块缺少 {doc_label}")
444 |         if rpt.classes:
445 |             lines.append(f"- 类缺少 {doc_label}：")
    |                                                ^^
446 |             for entry in rpt.classes:
447 |                 lines.append(f"  - `{entry.name}` (行 {entry.line})")
    |

PERF401 Use `list.extend` to create a transformed list
   --> scripts/check_missing_docs_smart.py:447:17
    |
445 |             lines.append(f"- 类缺少 {doc_label}：")
446 |             for entry in rpt.classes:
447 |                 lines.append(f"  - `{entry.name}` (行 {entry.line})")
    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
448 |         if rpt.functions:
449 |             lines.append(f"- 函数/方法缺少 {doc_label}：")
    |
help: Replace for loop with list.extend

RUF001 String contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> scripts/check_missing_docs_smart.py:449:49
    |
447 |                 lines.append(f"  - `{entry.name}` (行 {entry.line})")
448 |         if rpt.functions:
449 |             lines.append(f"- 函数/方法缺少 {doc_label}：")
    |                                                       ^^
450 |             for entry in rpt.functions:
451 |                 lines.append(f"  - `{entry.name}` (行 {entry.line})")
    |

PERF401 Use `list.extend` to create a transformed list
   --> scripts/check_missing_docs_smart.py:451:17
    |
449 |             lines.append(f"- 函数/方法缺少 {doc_label}：")
450 |             for entry in rpt.functions:
451 |                 lines.append(f"  - `{entry.name}` (行 {entry.line})")
    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
452 |         if rpt.function_sections:
453 |             lines.append("- 函数/方法文档不完整：")
    |
help: Replace for loop with list.extend

RUF001 String contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> scripts/check_missing_docs_smart.py:453:39
    |
451 |                 lines.append(f"  - `{entry.name}` (行 {entry.line})")
452 |         if rpt.function_sections:
453 |             lines.append("- 函数/方法文档不完整：")
    |                                                ^^
454 |             for entry in rpt.function_sections:
455 |                 detail = ", ".join(entry.details)
    |

RUF001 String contains ambiguous `！` (FULLWIDTH EXCLAMATION MARK). Did you mean `!` (EXCLAMATION MARK)?
   --> scripts/check_missing_docs_smart.py:460:48
    |
459 |     if not results:
460 |         lines.append("🎉 所有被扫描的文件 docstring 均已完善！")
    |                                                             ^^
461 |
462 |     return "\n".join(lines)
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> scripts/check_missing_docs_smart.py:468:12
    |
466 |     """Docstring 扫描 CLI 的入口函数。.
467 |
468 |     解析命令行参数，遍历 Python 与 JavaScript 文件并生成 Markdown 报告，
    |                   ^^
469 |     供团队对照修复缺失的文档条目。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> scripts/check_missing_docs_smart.py:468:53
    |
466 |     """Docstring 扫描 CLI 的入口函数。.
467 |
468 |     解析命令行参数，遍历 Python 与 JavaScript 文件并生成 Markdown 报告，
    |                                                                       ^^
469 |     供团队对照修复缺失的文档条目。
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> scripts/check_missing_docs_smart.py:472:27
    |
471 |     Returns:
472 |         None: 函数以副作用执行 I/O，不返回任何值。
    |                                   ^^
473 |
474 |     """
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> scripts/check_missing_docs_smart.py:480:21
    |
478 |         nargs="*",
479 |         default=DEFAULT_INCLUDE,
480 |         help="要扫描的目录，默认 app scripts tests",
    |                           ^^
481 |     )
482 |     parser.add_argument(
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> scripts/check_missing_docs_smart.py:486:33
    |
484 |         nargs="*",
485 |         default=DEFAULT_JS_INCLUDE,
486 |         help="要扫描的 JavaScript 目录，默认 static/js",
    |                                       ^^
487 |     )
488 |     parser.add_argument(
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> scripts/check_missing_docs_smart.py:491:28
    |
489 |         "--skip-js",
490 |         action="store_true",
491 |         help="仅扫描 Python 文件，不检测 JSDoc",
    |                                 ^^
492 |     )
493 |     parser.add_argument(
    |

RUF001 String contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> scripts/check_missing_docs_smart.py:523:17
    |
521 |     output_path.write_text(markdown, encoding="utf-8")
522 |     summary_parts = [
523 |         f"✅ 扫描完成：共 {total_files} 个文件",
    |                      ^^
524 |         f"Python：{len(python_files)}",
525 |     ]
    |

RUF001 String contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> scripts/check_missing_docs_smart.py:524:17
    |
522 |     summary_parts = [
523 |         f"✅ 扫描完成：共 {total_files} 个文件",
524 |         f"Python：{len(python_files)}",
    |                 ^^
525 |     ]
526 |     if js_files:
    |

RUF001 String contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> scripts/check_missing_docs_smart.py:527:42
    |
525 |     ]
526 |     if js_files:
527 |         summary_parts.append(f"JavaScript：{len(js_files)}")
    |                                          ^^
528 |     LOGGER.info("%s，发现 %d 个文件缺少文档。", "，".join(summary_parts), len(results))
529 |     LOGGER.info("📄 详细结果已保存到 %s", output_path)
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> scripts/check_missing_docs_smart.py:528:20
    |
526 |     if js_files:
527 |         summary_parts.append(f"JavaScript：{len(js_files)}")
528 |     LOGGER.info("%s，发现 %d 个文件缺少文档。", "，".join(summary_parts), len(results))
    |                    ^^
529 |     LOGGER.info("📄 详细结果已保存到 %s", output_path)
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> scripts/check_missing_docs_smart.py:528:39
    |
526 |     if js_files:
527 |         summary_parts.append(f"JavaScript：{len(js_files)}")
528 |     LOGGER.info("%s，发现 %d 个文件缺少文档。", "，".join(summary_parts), len(results))
    |                                                  ^^
529 |     LOGGER.info("📄 详细结果已保存到 %s", output_path)
    |

D205 1 blank line required between summary line and description
 --> scripts/code/analyze_code.py:2:1
  |
1 |   #!/usr/bin/env python3
2 | / """代码统计分析脚本
3 | | 用于生成项目代码的详细统计报告.
4 | | """
  | |___^
5 |
6 |   import json
  |
help: Insert single blank line

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> scripts/code/analyze_code.py:14:23
   |
13 | def _echo(message: str = "") -> None:
14 |     """向 stdout 输出一行文本，替代 print 避免 Ruff T201。."""
   |                              ^^
15 |     sys.stdout.write(f"{message}\n")
   |

ANN201 Missing return type annotation for public function `count_lines`
  --> scripts/code/analyze_code.py:18:5
   |
18 | def count_lines(filepath):
   |     ^^^^^^^^^^^
19 |     """统计指定文件的有效行数。.
   |
help: Add return type annotation

ANN001 Missing type annotation for function argument `filepath`
  --> scripts/code/analyze_code.py:18:17
   |
18 | def count_lines(filepath):
   |                 ^^^^^^^^
19 |     """统计指定文件的有效行数。.
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> scripts/code/analyze_code.py:22:28
   |
21 |     Args:
22 |         filepath: 需要统计的文件路径，可以是绝对路径或相对路径。
   |                                     ^^
23 |
24 |     Returns:
   |

RUF002 Docstring contains ambiguous `；` (FULLWIDTH SEMICOLON). Did you mean `;` (SEMICOLON)?
  --> scripts/code/analyze_code.py:25:18
   |
24 |     Returns:
25 |         int: 文件行数；当文件不可读或解码失败时返回 0。
   |                      ^^
26 |
27 |     """
   |

PTH123 `open()` should be replaced by `Path.open()`
  --> scripts/code/analyze_code.py:29:14
   |
27 |     """
28 |     try:
29 |         with open(filepath, encoding="utf-8") as f:
   |              ^^^^
30 |             return len(f.readlines())
31 |     except:
   |
help: Replace with `Path.open()`

E722 Do not use bare `except`
  --> scripts/code/analyze_code.py:31:5
   |
29 |         with open(filepath, encoding="utf-8") as f:
30 |             return len(f.readlines())
31 |     except:
   |     ^^^^^^
32 |         return 0
   |

ANN201 Missing return type annotation for public function `analyze_directory`
  --> scripts/code/analyze_code.py:34:5
   |
32 |         return 0
33 |
34 | def analyze_directory(base_dir, exclude_patterns=None):
   |     ^^^^^^^^^^^^^^^^^
35 |     """分析目录结构和代码统计.
   |
help: Add return type annotation

ANN001 Missing type annotation for function argument `base_dir`
  --> scripts/code/analyze_code.py:34:23
   |
32 |         return 0
33 |
34 | def analyze_directory(base_dir, exclude_patterns=None):
   |                       ^^^^^^^^
35 |     """分析目录结构和代码统计.
   |

ANN001 Missing type annotation for function argument `exclude_patterns`
  --> scripts/code/analyze_code.py:34:33
   |
32 |         return 0
33 |
34 | def analyze_directory(base_dir, exclude_patterns=None):
   |                                 ^^^^^^^^^^^^^^^^
35 |     """分析目录结构和代码统计.
   |

PTH118 `os.path.join()` should be replaced by `Path` with `/` operator
  --> scripts/code/analyze_code.py:63:28
   |
61 |         for file in files:
62 |             if file.endswith(valid_extensions):
63 |                 filepath = os.path.join(root, file)
   |                            ^^^^^^^^^^^^
64 |                 lines = count_lines(filepath)
65 |                 rel_path = os.path.relpath(filepath, base_dir)
   |

PTH122 `os.path.splitext()` should be replaced by `Path.suffix`, `Path.stem`, and `Path.parent`
  --> scripts/code/analyze_code.py:66:23
   |
64 |                 lines = count_lines(filepath)
65 |                 rel_path = os.path.relpath(filepath, base_dir)
66 |                 ext = os.path.splitext(file)[1]
   |                       ^^^^^^^^^^^^^^^^
67 |
68 |                 # 获取目录
   |

PTH120 `os.path.dirname()` should be replaced by `Path.parent`
  --> scripts/code/analyze_code.py:69:28
   |
68 |                 # 获取目录
69 |                 dir_path = os.path.dirname(rel_path) if os.path.dirname(rel_path) else "根目录"
   |                            ^^^^^^^^^^^^^^^
70 |
71 |                 files_by_dir[dir_path].append({
   |
help: Replace with `Path(...).parent`

PTH120 `os.path.dirname()` should be replaced by `Path.parent`
  --> scripts/code/analyze_code.py:69:57
   |
68 |                 # 获取目录
69 |                 dir_path = os.path.dirname(rel_path) if os.path.dirname(rel_path) else "根目录"
   |                                                         ^^^^^^^^^^^^^^^
70 |
71 |                 files_by_dir[dir_path].append({
   |
help: Replace with `Path(...).parent`

ANN001 Missing type annotation for function argument `stats`
  --> scripts/code/analyze_code.py:90:19
   |
88 |     }
89 |
90 | def print_summary(stats) -> None:
   |                   ^^^^^
91 |     """打印汇总统计信息。.
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> scripts/code/analyze_code.py:97:25
   |
96 |     Returns:
97 |         None: 仅向标准输出打印结果，不返回值。
   |                                   ^^
98 |
99 |     """
   |

ANN001 Missing type annotation for function argument `stats`
   --> scripts/code/analyze_code.py:115:21
    |
113 |     _echo("")
114 |
115 | def print_top_files(stats, top_n=20) -> None:
    |                     ^^^^^
116 |     """展示行数最多的文件列表。.
    |

ANN001 Missing type annotation for function argument `top_n`
   --> scripts/code/analyze_code.py:115:28
    |
113 |     _echo("")
114 |
115 | def print_top_files(stats, top_n=20) -> None:
    |                            ^^^^^
116 |     """展示行数最多的文件列表。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> scripts/code/analyze_code.py:120:25
    |
118 |     Args:
119 |         stats: 包含 ``files_by_dir`` 的聚合统计数据。
120 |         top_n: 需要展示的文件数量，默认 20 个。
    |                                  ^^
121 |
122 |     Returns:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> scripts/code/analyze_code.py:123:24
    |
122 |     Returns:
123 |         None: 结果打印到标准输出，不返回值。
    |                                 ^^
124 |
125 |     """
    |

PERF401 Use `list.extend` to create a transformed list
   --> scripts/code/analyze_code.py:129:13
    |
127 |       for files in stats["files_by_dir"].values():
128 |           for file_info in files:
129 | /             all_files.append({
130 | |                 "path": file_info["name"],
131 | |                 "lines": file_info["lines"],
132 | |             })
    | |______________^
133 |
134 |       all_files.sort(key=lambda x: x["lines"], reverse=True)
    |
help: Replace for loop with list.extend

ANN001 Missing type annotation for function argument `stats`
   --> scripts/code/analyze_code.py:142:20
    |
140 |     _echo("")
141 |
142 | def export_to_json(stats, output_file) -> None:
    |                    ^^^^^
143 |     """将统计结果导出为 JSON 文件。.
    |

ANN001 Missing type annotation for function argument `output_file`
   --> scripts/code/analyze_code.py:142:27
    |
140 |     _echo("")
141 |
142 | def export_to_json(stats, output_file) -> None:
    |                           ^^^^^^^^^^^
143 |     """将统计结果导出为 JSON 文件。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> scripts/code/analyze_code.py:150:27
    |
149 |     Returns:
150 |         None: 以写文件的方式产生副作用，不返回值。
    |                                       ^^
151 |
152 |     """
    |

PTH123 `open()` should be replaced by `Path.open()`
   --> scripts/code/analyze_code.py:153:10
    |
152 |     """
153 |     with open(output_file, "w", encoding="utf-8") as f:
    |          ^^^^
154 |         json.dump(stats, f, indent=2, ensure_ascii=False)
155 |     _echo(f"统计结果已导出到: {output_file}")
    |
help: Replace with `Path.open()`

ANN001 Missing type annotation for function argument `stats`
   --> scripts/code/analyze_code.py:157:30
    |
155 |     _echo(f"统计结果已导出到: {output_file}")
156 |
157 | def generate_markdown_report(stats, output_file) -> None:
    |                              ^^^^^
158 |     """生成 Markdown 版本的代码统计报告。.
    |

ANN001 Missing type annotation for function argument `output_file`
   --> scripts/code/analyze_code.py:157:37
    |
155 |     _echo(f"统计结果已导出到: {output_file}")
156 |
157 | def generate_markdown_report(stats, output_file) -> None:
    |                                     ^^^^^^^^^^^
158 |     """生成 Markdown 版本的代码统计报告。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> scripts/code/analyze_code.py:165:24
    |
164 |     Returns:
165 |         None: 结果写入到文件系统，不返回值。
    |                                 ^^
166 |
167 |     """
    |

PTH123 `open()` should be replaced by `Path.open()`
   --> scripts/code/analyze_code.py:168:10
    |
167 |     """
168 |     with open(output_file, "w", encoding="utf-8") as f:
    |          ^^^^
169 |         f.write("# 代码统计报告\n\n")
170 |         f.write(f"生成时间: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}\n\n")
    |
help: Replace with `Path.open()`

DTZ005 `datetime.datetime.now()` called without a `tz` argument
   --> scripts/code/analyze_code.py:170:26
    |
168 |     with open(output_file, "w", encoding="utf-8") as f:
169 |         f.write("# 代码统计报告\n\n")
170 |         f.write(f"生成时间: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}\n\n")
    |                              ^^^^^^^^^^^^^^
171 |
172 |         f.write("## 总体统计\n\n")
    |
help: Pass a `datetime.timezone` object to the `tz` parameter

E501 Line too long (150 > 120)
   --> scripts/code/analyze_code.py:195:121
    |
193 | …
194 | …
195 | …s']} |\n" for file_info in sorted(files, key=lambda x: x["lines"], reverse=True))
    |                                                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
196 | …
    |

INP001 File `scripts/code/safe_update_code_analysis.py` is part of an implicit namespace package. Add an `__init__.py`.
--> scripts/code/safe_update_code_analysis.py:1:1

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> scripts/code/safe_update_code_analysis.py:3:19
  |
1 | """维护 docs/reports/code_analysis_report.md 的静态代码分析脚本。.
2 |
3 | 扫描 app 目录统计文件数量与行数，生成 Markdown 表格并写回报告。
  |                                ^^
4 | """
  |

PTH100 `os.path.abspath()` should be replaced by `Path.resolve()`
  --> scripts/code/safe_update_code_analysis.py:13:11
   |
12 | # --- CONFIGURATION ---
13 | APP_DIR = os.path.abspath(os.path.join(os.path.dirname(__file__), "../app"))
   |           ^^^^^^^^^^^^^^^
14 | REPORT_PATH = os.path.abspath(os.path.join(os.path.dirname(__file__), "../docs/reports/code_analysis_report.md"))
15 | EXCLUDE_DIRS = [os.path.join(APP_DIR, "static/vendor")]
   |
help: Replace with `Path(...).resolve()`

PTH118 `os.path.join()` should be replaced by `Path` with `/` operator
  --> scripts/code/safe_update_code_analysis.py:13:27
   |
12 | # --- CONFIGURATION ---
13 | APP_DIR = os.path.abspath(os.path.join(os.path.dirname(__file__), "../app"))
   |                           ^^^^^^^^^^^^
14 | REPORT_PATH = os.path.abspath(os.path.join(os.path.dirname(__file__), "../docs/reports/code_analysis_report.md"))
15 | EXCLUDE_DIRS = [os.path.join(APP_DIR, "static/vendor")]
   |

PTH120 `os.path.dirname()` should be replaced by `Path.parent`
  --> scripts/code/safe_update_code_analysis.py:13:40
   |
12 | # --- CONFIGURATION ---
13 | APP_DIR = os.path.abspath(os.path.join(os.path.dirname(__file__), "../app"))
   |                                        ^^^^^^^^^^^^^^^
14 | REPORT_PATH = os.path.abspath(os.path.join(os.path.dirname(__file__), "../docs/reports/code_analysis_report.md"))
15 | EXCLUDE_DIRS = [os.path.join(APP_DIR, "static/vendor")]
   |
help: Replace with `Path(...).parent`

PTH100 `os.path.abspath()` should be replaced by `Path.resolve()`
  --> scripts/code/safe_update_code_analysis.py:14:15
   |
12 | # --- CONFIGURATION ---
13 | APP_DIR = os.path.abspath(os.path.join(os.path.dirname(__file__), "../app"))
14 | REPORT_PATH = os.path.abspath(os.path.join(os.path.dirname(__file__), "../docs/reports/code_analysis_report.md"))
   |               ^^^^^^^^^^^^^^^
15 | EXCLUDE_DIRS = [os.path.join(APP_DIR, "static/vendor")]
16 | FILE_EXTENSIONS = (".py", ".js", ".html", ".css", ".yaml", ".yml")
   |
help: Replace with `Path(...).resolve()`

PTH118 `os.path.join()` should be replaced by `Path` with `/` operator
  --> scripts/code/safe_update_code_analysis.py:14:31
   |
12 | # --- CONFIGURATION ---
13 | APP_DIR = os.path.abspath(os.path.join(os.path.dirname(__file__), "../app"))
14 | REPORT_PATH = os.path.abspath(os.path.join(os.path.dirname(__file__), "../docs/reports/code_analysis_report.md"))
   |                               ^^^^^^^^^^^^
15 | EXCLUDE_DIRS = [os.path.join(APP_DIR, "static/vendor")]
16 | FILE_EXTENSIONS = (".py", ".js", ".html", ".css", ".yaml", ".yml")
   |

PTH120 `os.path.dirname()` should be replaced by `Path.parent`
  --> scripts/code/safe_update_code_analysis.py:14:44
   |
12 | # --- CONFIGURATION ---
13 | APP_DIR = os.path.abspath(os.path.join(os.path.dirname(__file__), "../app"))
14 | REPORT_PATH = os.path.abspath(os.path.join(os.path.dirname(__file__), "../docs/reports/code_analysis_report.md"))
   |                                            ^^^^^^^^^^^^^^^
15 | EXCLUDE_DIRS = [os.path.join(APP_DIR, "static/vendor")]
16 | FILE_EXTENSIONS = (".py", ".js", ".html", ".css", ".yaml", ".yml")
   |
help: Replace with `Path(...).parent`

PTH118 `os.path.join()` should be replaced by `Path` with `/` operator
  --> scripts/code/safe_update_code_analysis.py:15:17
   |
13 | APP_DIR = os.path.abspath(os.path.join(os.path.dirname(__file__), "../app"))
14 | REPORT_PATH = os.path.abspath(os.path.join(os.path.dirname(__file__), "../docs/reports/code_analysis_report.md"))
15 | EXCLUDE_DIRS = [os.path.join(APP_DIR, "static/vendor")]
   |                 ^^^^^^^^^^^^
16 | FILE_EXTENSIONS = (".py", ".js", ".html", ".css", ".yaml", ".yml")
   |

ANN201 Missing return type annotation for public function `analyze_directory`
  --> scripts/code/safe_update_code_analysis.py:23:5
   |
21 | # --- ANALYSIS FUNCTIONS ---
22 |
23 | def analyze_directory(path, exclude_dirs, extensions):
   |     ^^^^^^^^^^^^^^^^^
24 |     """扫描目录并应用排除与扩展名过滤规则。.
   |
help: Add return type annotation

ANN001 Missing type annotation for function argument `path`
  --> scripts/code/safe_update_code_analysis.py:23:23
   |
21 | # --- ANALYSIS FUNCTIONS ---
22 |
23 | def analyze_directory(path, exclude_dirs, extensions):
   |                       ^^^^
24 |     """扫描目录并应用排除与扩展名过滤规则。.
   |

ANN001 Missing type annotation for function argument `exclude_dirs`
  --> scripts/code/safe_update_code_analysis.py:23:29
   |
21 | # --- ANALYSIS FUNCTIONS ---
22 |
23 | def analyze_directory(path, exclude_dirs, extensions):
   |                             ^^^^^^^^^^^^
24 |     """扫描目录并应用排除与扩展名过滤规则。.
   |

ANN001 Missing type annotation for function argument `extensions`
  --> scripts/code/safe_update_code_analysis.py:23:43
   |
21 | # --- ANALYSIS FUNCTIONS ---
22 |
23 | def analyze_directory(path, exclude_dirs, extensions):
   |                                           ^^^^^^^^^^
24 |     """扫描目录并应用排除与扩展名过滤规则。.
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> scripts/code/safe_update_code_analysis.py:29:31
   |
27 |         path: 需要分析的应用目录绝对路径。
28 |         exclude_dirs: 需要忽略的子目录前缀列表。
29 |         extensions: 允许统计的文件扩展名，包含开头的点。
   |                                         ^^
30 |
31 |     Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> scripts/code/safe_update_code_analysis.py:33:27
   |
31 |     Returns:
32 |         tuple[dict[str, dict[str, int]], list[dict[str, int]]]:
33 |         第一个元素按扩展名聚合文件数量与行数，第二个元素列出单个文件
   |                                             ^^
34 |         的路径和行数，供后续报告生成使用。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> scripts/code/safe_update_code_analysis.py:34:15
   |
32 |         tuple[dict[str, dict[str, int]], list[dict[str, int]]]:
33 |         第一个元素按扩展名聚合文件数量与行数，第二个元素列出单个文件
34 |         的路径和行数，供后续报告生成使用。
   |                     ^^
35 |
36 |     """
   |

PTH118 `os.path.join()` should be replaced by `Path` with `/` operator
  --> scripts/code/safe_update_code_analysis.py:48:25
   |
46 |                 continue
47 |
48 |             file_path = os.path.join(root, file)
   |                         ^^^^^^^^^^^^
49 |             try:
50 |                 with open(file_path, encoding="utf-8", errors="ignore") as f:
   |

PTH123 `open()` should be replaced by `Path.open()`
  --> scripts/code/safe_update_code_analysis.py:50:22
   |
48 |             file_path = os.path.join(root, file)
49 |             try:
50 |                 with open(file_path, encoding="utf-8", errors="ignore") as f:
   |                      ^^^^
51 |                     line_count = sum(1 for _ in f)
52 |             except OSError:
   |
help: Replace with `Path.open()`

PTH122 `os.path.splitext()` should be replaced by `Path.suffix`, `Path.stem`, and `Path.parent`
  --> scripts/code/safe_update_code_analysis.py:55:19
   |
53 |                 line_count = 0
54 |
55 |             ext = os.path.splitext(file)[1].upper().replace(".", "")
   |                   ^^^^^^^^^^^^^^^^
56 |             if ext == "YML": ext = "YAML"
   |

E701 Multiple statements on one line (colon)
  --> scripts/code/safe_update_code_analysis.py:56:28
   |
55 |             ext = os.path.splitext(file)[1].upper().replace(".", "")
56 |             if ext == "YML": ext = "YAML"
   |                            ^
57 |
58 |             file_stats[ext]["count"] += 1
   |

ANN201 Missing return type annotation for public function `get_directory_breakdown`
  --> scripts/code/safe_update_code_analysis.py:67:5
   |
65 |     return dict(file_stats), detailed_files
66 |
67 | def get_directory_breakdown(detailed_files):
   |     ^^^^^^^^^^^^^^^^^^^^^^^
68 |     """按子目录聚合文件统计数据。.
   |
help: Add return type annotation

ANN001 Missing type annotation for function argument `detailed_files`
  --> scripts/code/safe_update_code_analysis.py:67:29
   |
65 |     return dict(file_stats), detailed_files
66 |
67 | def get_directory_breakdown(detailed_files):
   |                             ^^^^^^^^^^^^^^
68 |     """按子目录聚合文件统计数据。.
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> scripts/code/safe_update_code_analysis.py:71:56
   |
70 |     Args:
71 |         detailed_files: ``analyze_directory`` 返回的文件信息列表，包含相对
   |                                                                 ^^
72 |             路径与行数。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> scripts/code/safe_update_code_analysis.py:75:50
   |
74 |     Returns:
75 |         dict[str, dict[str, object]]: 以目录名为键的统计结果，记录文件数、
   |                                                             ^^
76 |         行数以及排序后的文件详情。
   |

PTH120 `os.path.dirname()` should be replaced by `Path.parent`
  --> scripts/code/safe_update_code_analysis.py:81:20
   |
79 |     breakdown = defaultdict(lambda: {"count": 0, "lines": 0, "files": []})
80 |     for file_info in detailed_files:
81 |         dir_name = os.path.dirname(file_info["path"])
   |                    ^^^^^^^^^^^^^^^
82 |         dir_name = "app 根目录" if dir_name == "" else f"app/{dir_name}"
   |
help: Replace with `Path(...).parent`

ANN201 Missing return type annotation for public function `generate_file_type_table`
  --> scripts/code/safe_update_code_analysis.py:96:5
   |
94 | # --- MARKDOWN GENERATION ---
95 |
96 | def generate_file_type_table(stats, total_files, total_lines):
   |     ^^^^^^^^^^^^^^^^^^^^^^^^
97 |     """生成文件类型分布的 Markdown 表格。.
   |
help: Add return type annotation

ANN001 Missing type annotation for function argument `stats`
  --> scripts/code/safe_update_code_analysis.py:96:30
   |
94 | # --- MARKDOWN GENERATION ---
95 |
96 | def generate_file_type_table(stats, total_files, total_lines):
   |                              ^^^^^
97 |     """生成文件类型分布的 Markdown 表格。.
   |

ANN001 Missing type annotation for function argument `total_files`
  --> scripts/code/safe_update_code_analysis.py:96:37
   |
94 | # --- MARKDOWN GENERATION ---
95 |
96 | def generate_file_type_table(stats, total_files, total_lines):
   |                                     ^^^^^^^^^^^
97 |     """生成文件类型分布的 Markdown 表格。.
   |

ANN001 Missing type annotation for function argument `total_lines`
  --> scripts/code/safe_update_code_analysis.py:96:50
   |
94 | # --- MARKDOWN GENERATION ---
95 |
96 | def generate_file_type_table(stats, total_files, total_lines):
   |                                                  ^^^^^^^^^^^
97 |     """生成文件类型分布的 Markdown 表格。.
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> scripts/code/safe_update_code_analysis.py:100:27
    |
 99 |     Args:
100 |         stats: 以扩展名为键的统计字典，包含 ``count`` 与 ``lines``。
    |                                      ^^
101 |         total_files: 所有扩展名的文件总数。
102 |         total_lines: 所有扩展名的总行数。
    |

ANN201 Missing return type annotation for public function `generate_directory_detail_table`
   --> scripts/code/safe_update_code_analysis.py:118:5
    |
116 |     return "\n".join(table)
117 |
118 | def generate_directory_detail_table(file_list):
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
119 |     """生成单个目录的文件明细表格。.
    |
help: Add return type annotation

ANN001 Missing type annotation for function argument `file_list`
   --> scripts/code/safe_update_code_analysis.py:118:37
    |
116 |     return "\n".join(table)
117 |
118 | def generate_directory_detail_table(file_list):
    |                                     ^^^^^^^^^
119 |     """生成单个目录的文件明细表格。.
    |

PERF401 Use `list.extend` to create a transformed list
   --> scripts/code/safe_update_code_analysis.py:132:9
    |
130 |         # In a real scenario, you might have a way to get descriptions.
131 |         # For now, we leave it blank.
132 |         table.append(f"| `app/{file_info['path']}` | {file_info['lines']} |          |")
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
133 |     return "\n".join(table)
    |
help: Replace for loop with list.extend

ANN001 Missing type annotation for function argument `report_path`
   --> scripts/code/safe_update_code_analysis.py:137:19
    |
135 | # --- REPORT UPDATE FUNCTION ---
136 |
137 | def update_report(report_path, content) -> None:
    |                   ^^^^^^^^^^^
138 |     """将生成的报告内容写回磁盘。.
    |

ANN001 Missing type annotation for function argument `content`
   --> scripts/code/safe_update_code_analysis.py:137:32
    |
135 | # --- REPORT UPDATE FUNCTION ---
136 |
137 | def update_report(report_path, content) -> None:
    |                                ^^^^^^^
138 |     """将生成的报告内容写回磁盘。.
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> scripts/code/safe_update_code_analysis.py:145:25
    |
144 |     Returns:
145 |         None: 通过写文件产生副作用，不返回值。
    |                                   ^^
146 |
147 |     """
    |

PTH123 `open()` should be replaced by `Path.open()`
   --> scripts/code/safe_update_code_analysis.py:149:14
    |
147 |     """
148 |     try:
149 |         with open(report_path, "w", encoding="utf-8") as f:
    |              ^^^^
150 |             f.write(content)
151 |         LOGGER.info("报告已成功更新: %s", report_path)
    |
help: Replace with `Path.open()`

RUF001 String contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> scripts/code/safe_update_code_analysis.py:153:29
    |
151 |         LOGGER.info("报告已成功更新: %s", report_path)
152 |     except OSError as e:
153 |         LOGGER.exception("错误：无法写入报告文件 %s。错误信息: %s", report_path, e)
    |                               ^^
154 |
155 | def main() -> None:
    |

TRY401 Redundant exception object included in `logging.exception` call
   --> scripts/code/safe_update_code_analysis.py:153:66
    |
151 |         LOGGER.info("报告已成功更新: %s", report_path)
152 |     except OSError as e:
153 |         LOGGER.exception("错误：无法写入报告文件 %s。错误信息: %s", report_path, e)
    |                                                                                  ^
154 |
155 | def main() -> None:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> scripts/code/safe_update_code_analysis.py:159:25
    |
158 |     Returns:
159 |         None: 以 CLI 形式运行，仅打印日志并写入文件。
    |                              ^^
160 |
161 |     """
    |

PTH123 `open()` should be replaced by `Path.open()`
   --> scripts/code/safe_update_code_analysis.py:170:14
    |
168 |     LOGGER.info("正在读取原始报告...")
169 |     try:
170 |         with open(REPORT_PATH, encoding="utf-8") as f:
    |              ^^^^
171 |             original_content = f.read()
172 |     except FileNotFoundError:
    |
help: Replace with `Path.open()`

RUF001 String contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> scripts/code/safe_update_code_analysis.py:177:63
    |
176 |     # --- Replace Project Overview ---
177 |     overview_section = f"## 项目概览\n- **总文件数**: {total_files}个文件（仅统计代码文件，不包含 `app/static/vendor`）\n- **总代码行                           …
    |                                                                          ^^
178 |     new_content = re.sub(r"## 项目概览\n- \*\*总文件数\*\*:.*?行（.*?）", overview_section, original_content, flags=re.DOTALL)
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> scripts/code/safe_update_code_analysis.py:177:71
    |
176 |     # --- Replace Project Overview ---
177 |     overview_section = f"## 项目概览\n- **总文件数**: {total_files}个文件（仅统计代码文件，不包含 `app/static/vendor`）\n- **总代码行                           …
    |                                                                                          ^^
178 |     new_content = re.sub(r"## 项目概览\n- \*\*总文件数\*\*:.*?行（.*?）", overview_section, original_content, flags=re.DOTALL)
    |

RUF001 String contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> scripts/code/safe_update_code_analysis.py:177:95
    |
176 |     # --- Replace Project Overview ---
177 |     overview_section = f"## 项目概览\n- **总文件数**: {total_files}个文件（仅统计代码文件，不包含 `app/static/vendor`）\n- **总代码行                           …
    |                                                                                                                      ^^
178 |     new_content = re.sub(r"## 项目概览\n- \*\*总文件数\*\*:.*?行（.*?）", overview_section, original_content, flags=re.DOTALL)
    |

E501 Line too long (190 > 120)
   --> scripts/code/safe_update_code_analysis.py:177:97
    |
176 | …
177 | …ndor`）\n- **总代码行数**: {total_lines:,}行（.py/.html/.js/.css/.yaml/.yml）"
    |          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
178 | …_content, flags=re.DOTALL)
    |

RUF001 String contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> scripts/code/safe_update_code_analysis.py:177:127
    |
176 | …
177 | …or`）\n- **总代码行数**: {total_lines:,}行（.py/.html/.js/.css/.yaml/.yml）"
    |                                            ^^
178 | …ontent, flags=re.DOTALL)
    |

RUF001 String contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> scripts/code/safe_update_code_analysis.py:177:157
    |
176 | …
177 | …:,}行（.py/.html/.js/.css/.yaml/.yml）"
    |                                      ^^
178 | …
    |

RUF001 String contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> scripts/code/safe_update_code_analysis.py:178:56
    |
176 |     # --- Replace Project Overview ---
177 |     overview_section = f"## 项目概览\n- **总文件数**: {total_files}个文件（仅统计代码文件，不包含 `app/static/vendor`）\n- **总代码行                           …
178 |     new_content = re.sub(r"## 项目概览\n- \*\*总文件数\*\*:.*?行（.*?）", overview_section, original_content, flags=re.DOTALL)
    |                                                                 ^^
179 |
180 |     # --- Replace File Type Distribution Table ---
    |

RUF001 String contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> scripts/code/safe_update_code_analysis.py:178:60
    |
176 |     # --- Replace Project Overview ---
177 |     overview_section = f"## 项目概览\n- **总文件数**: {total_files}个文件（仅统计代码文件，不包含 `app/static/vendor`）\n- **总代码行                           …
178 |     new_content = re.sub(r"## 项目概览\n- \*\*总文件数\*\*:.*?行（.*?）", overview_section, original_content, flags=re.DOTALL)
    |                                                                      ^^
179 |
180 |     # --- Replace File Type Distribution Table ---
    |

E501 Line too long (126 > 120)
   --> scripts/code/safe_update_code_analysis.py:178:110
    |
176 |     # --- Replace Project Overview ---
177 |     overview_section = f"## 项目概览\n- **总文件数**: {total_files}个文件（仅统计代码文件，不包含 `app/static/vendor`）\n- **总代码行                           …
178 |     new_content = re.sub(r"## 项目概览\n- \*\*总文件数\*\*:.*?行（.*?）", overview_section, original_content, flags=re.DOTALL)
    |                                                                                                                         ^^^^^^
179 |
180 |     # --- Replace File Type Distribution Table ---
    |

E501 Line too long (123 > 120)
   --> scripts/code/safe_update_code_analysis.py:183:115
    |
181 |     file_type_table = generate_file_type_table(file_stats, total_files, total_lines)
182 |     dist_header = "### 文件类型分布"
183 |     new_content = re.sub(f"({dist_header}\n)(\\| 文件类型.*?\\|.*?\\|\n(?:\\|---.*?\\|\n)+)(?:\\| \\*\\*总计\\*\\*.*?\\|)",
    |                                                                                                                         ^^^
184 |                          f"\1{file_type_table}", new_content, flags=re.DOTALL)
    |

RUF001 String contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> scripts/code/safe_update_code_analysis.py:189:43
    |
187 |     dir_breakdown = get_directory_breakdown(detailed_files)
188 |
189 |     dir_analysis_start_marker = "## 目录结构分析（app/）"
    |                                                 ^^
190 |     quality_analysis_start_marker = "## 代码质量分析"
    |

RUF001 String contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> scripts/code/safe_update_code_analysis.py:189:48
    |
187 |     dir_breakdown = get_directory_breakdown(detailed_files)
188 |
189 |     dir_analysis_start_marker = "## 目录结构分析（app/）"
    |                                                       ^^
190 |     quality_analysis_start_marker = "## 代码质量分析"
    |

E501 Line too long (122 > 120)
   --> scripts/code/safe_update_code_analysis.py:202:118
    |
201 |         # Manually order some key directories first
202 |         order = ["app 根目录", "app/routes", "app/models", "app/services", "app/utils", "app/static/js", "app/static/css"]
    |                                                                                                                         ^^
203 |         sorted_dir_keys = [d for d in order if d in dir_breakdown] + [d for d in sorted(dir_breakdown.keys()) if d not in order]
    |

E501 Line too long (128 > 120)
   --> scripts/code/safe_update_code_analysis.py:203:121
    |
201 |         # Manually order some key directories first
202 |         order = ["app 根目录", "app/routes", "app/models", "app/services", "app/utils", "app/static/js", "app/static/css"]
203 |         sorted_dir_keys = [d for d in order if d in dir_breakdown] + [d for d in sorted(dir_breakdown.keys()) if d not in order]
    |                                                                                                                         ^^^^^^^^
204 |
205 |         for i, dir_name in enumerate(sorted_dir_keys, 1):
    |

RUF001 String contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> scripts/code/safe_update_code_analysis.py:209:39
    |
207 |             display_name = dir_name.replace("app/", "").replace("app ", "")
208 |             if display_name == "根目录":
209 |                 display_name = "核心应用文件（app 根目录）"
    |                                             ^^
210 |             else:
211 |                 display_name = f"{display_name.replace('/', ' ').title()}模块（{dir_name}/）"
    |

RUF001 String contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> scripts/code/safe_update_code_analysis.py:209:47
    |
207 |             display_name = dir_name.replace("app/", "").replace("app ", "")
208 |             if display_name == "根目录":
209 |                 display_name = "核心应用文件（app 根目录）"
    |                                                         ^^
210 |             else:
211 |                 display_name = f"{display_name.replace('/', ' ').title()}模块（{dir_name}/）"
    |

RUF001 String contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> scripts/code/safe_update_code_analysis.py:211:76
    |
209 |                 display_name = "核心应用文件（app 根目录）"
210 |             else:
211 |                 display_name = f"{display_name.replace('/', ' ').title()}模块（{dir_name}/）"
    |                                                                              ^^
212 |
213 |             new_dir_analysis_section.append(f"### {i}. {display_name}")
    |

RUF001 String contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> scripts/code/safe_update_code_analysis.py:211:88
    |
209 |                 display_name = "核心应用文件（app 根目录）"
210 |             else:
211 |                 display_name = f"{display_name.replace('/', ' ').title()}模块（{dir_name}/）"
    |                                                                                           ^^
212 |
213 |             new_dir_analysis_section.append(f"### {i}. {display_name}")
    |

DTZ005 `datetime.datetime.now()` called without a `tz` argument
   --> scripts/code/safe_update_code_analysis.py:224:36
    |
223 |         # Add a timestamp before the final appendix
224 |         timestamp = f"\n*报告最后更新于: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}*\n"
    |                                           ^^^^^^^^^^^^^^
225 |         final_content = final_content.replace("## 附录", f"{timestamp}\n## 附录")
    |
help: Pass a `datetime.timezone` object to the `tz` parameter

RUF001 String contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> scripts/code/safe_update_code_analysis.py:230:55
    |
229 |     except ValueError:
230 |         LOGGER.exception("错误: 无法在报告中找到预期的标记 '## 目录结构分析（app/）' 或 '## 代码质量分析'。更新中止。")
    |                                                                            ^^
231 |
232 | if __name__ == "__main__":
    |

RUF001 String contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> scripts/code/safe_update_code_analysis.py:230:60
    |
229 |     except ValueError:
230 |         LOGGER.exception("错误: 无法在报告中找到预期的标记 '## 目录结构分析（app/）' 或 '## 代码质量分析'。更新中止。")
    |                                                                                  ^^
231 |
232 | if __name__ == "__main__":
    |

EXE001 Shebang is present but file is not executable
 --> scripts/crud_smoke.py:1:1
  |
1 | #!/usr/bin/env python3
  | ^^^^^^^^^^^^^^^^^^^^^^
2 | """CRUD 场景烟雾测试脚本。.
  |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
 --> scripts/crud_smoke.py:4:36
  |
2 | """CRUD 场景烟雾测试脚本。.
3 |
4 | 该脚本通过配置化方式对指定资源完成“新增-查询-更新-删除”全链路校验，
  |                                                                  ^^
5 | 默认调用正在运行的 Flask 服务接口：
  |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
 --> scripts/crud_smoke.py:5:21
  |
4 | 该脚本通过配置化方式对指定资源完成“新增-查询-更新-删除”全链路校验，
5 | 默认调用正在运行的 Flask 服务接口：
  |                                  ^^
6 |
7 | 1. 先获取 CSRF 令牌并完成登录；
  |

RUF002 Docstring contains ambiguous `；` (FULLWIDTH SEMICOLON). Did you mean `;` (SEMICOLON)?
 --> scripts/crud_smoke.py:7:20
  |
5 | 默认调用正在运行的 Flask 服务接口：
6 |
7 | 1. 先获取 CSRF 令牌并完成登录；
  |                              ^^
8 | 2. 根据 YAML 场景配置逐步发送请求，自动替换变量、写入上下文；
9 | 3. 校验 HTTP 状态码以及关键 JSON 字段；
  |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> scripts/crud_smoke.py:8:22
   |
 7 | 1. 先获取 CSRF 令牌并完成登录；
 8 | 2. 根据 YAML 场景配置逐步发送请求，自动替换变量、写入上下文；
   |                                  ^^
 9 | 3. 校验 HTTP 状态码以及关键 JSON 字段；
10 | 4. 将每一步的结果打印为中文报告，失败时返回非零状态码。
   |

RUF002 Docstring contains ambiguous `；` (FULLWIDTH SEMICOLON). Did you mean `;` (SEMICOLON)?
  --> scripts/crud_smoke.py:8:35
   |
 7 | 1. 先获取 CSRF 令牌并完成登录；
 8 | 2. 根据 YAML 场景配置逐步发送请求，自动替换变量、写入上下文；
   |                                                            ^^
 9 | 3. 校验 HTTP 状态码以及关键 JSON 字段；
10 | 4. 将每一步的结果打印为中文报告，失败时返回非零状态码。
   |

RUF002 Docstring contains ambiguous `；` (FULLWIDTH SEMICOLON). Did you mean `;` (SEMICOLON)?
  --> scripts/crud_smoke.py:9:27
   |
 7 | 1. 先获取 CSRF 令牌并完成登录；
 8 | 2. 根据 YAML 场景配置逐步发送请求，自动替换变量、写入上下文；
 9 | 3. 校验 HTTP 状态码以及关键 JSON 字段；
   |                                      ^^
10 | 4. 将每一步的结果打印为中文报告，失败时返回非零状态码。
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> scripts/crud_smoke.py:10:18
   |
 8 | 2. 根据 YAML 场景配置逐步发送请求，自动替换变量、写入上下文；
 9 | 3. 校验 HTTP 状态码以及关键 JSON 字段；
10 | 4. 将每一步的结果打印为中文报告，失败时返回非零状态码。
   |                                ^^
11 |
12 | 示例用法：
   |

RUF002 Docstring contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
  --> scripts/crud_smoke.py:12:5
   |
10 | 4. 将每一步的结果打印为中文报告，失败时返回非零状态码。
11 |
12 | 示例用法：
   |         ^^
13 |
14 |     python scripts/crud_smoke.py \
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> scripts/crud_smoke.py:19:27
   |
17 |         --username admin --password secret
18 |
19 | 可以配合 `--dry-run` 先验证配置是否正确，再连接真实环境执行。
   |                                        ^^
20 | """
   |

TRY004 Prefer `TypeError` exception for invalid type
  --> scripts/crud_smoke.py:81:9
   |
79 |     if not isinstance(scenarios, list):
80 |         msg = "'scenarios' 必须是列表"
81 |         raise ValueError(msg)
   |         ^^^^^^^^^^^^^^^^^^^^^
82 |     return [s for s in scenarios if isinstance(s, Mapping)]
   |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `value`
  --> scripts/crud_smoke.py:85:28
   |
85 | def render_template(value: Any, context: Mapping[str, Any]) -> Any:
   |                            ^^^
86 |     """递归替换模板占位符。."""
87 |     if isinstance(value, str) and "{{" in value and "}}" in value:
   |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `render_template`
  --> scripts/crud_smoke.py:85:64
   |
85 | def render_template(value: Any, context: Mapping[str, Any]) -> Any:
   |                                                                ^^^
86 |     """递归替换模板占位符。."""
87 |     if isinstance(value, str) and "{{" in value and "}}" in value:
   |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `payload`
   --> scripts/crud_smoke.py:107:28
    |
107 | def extract_value(payload: Any, path: str) -> Any:
    |                            ^^^
108 |     """通过简单路径语法从 JSON 结构中提取值。."""
109 |     if not path:
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `extract_value`
   --> scripts/crud_smoke.py:107:47
    |
107 | def extract_value(payload: Any, path: str) -> Any:
    |                                               ^^^
108 |     """通过简单路径语法从 JSON 结构中提取值。."""
109 |     if not path:
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `current`
   --> scripts/crud_smoke.py:119:26
    |
119 | def _walk_token(current: Any, token: str) -> Any:
    |                          ^^^
120 |     """处理 `foo[0]` 这类 token。."""
121 |     while token:
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `_walk_token`
   --> scripts/crud_smoke.py:119:46
    |
119 | def _walk_token(current: Any, token: str) -> Any:
    |                                              ^^^
120 |     """处理 `foo[0]` 这类 token。."""
121 |     while token:
    |

PLR0913 Too many arguments in function definition (10 > 5)
   --> scripts/crud_smoke.py:140:9
    |
138 |     """根据配置执行 CRUD 场景的执行器。."""
139 |
140 |     def __init__(
    |         ^^^^^^^^
141 |         self,
142 |         *,
    |

D107 Missing docstring in `__init__`
   --> scripts/crud_smoke.py:140:9
    |
138 |     """根据配置执行 CRUD 场景的执行器。."""
139 |
140 |     def __init__(
    |         ^^^^^^^^
141 |         self,
142 |         *,
    |

RUF001 String contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> scripts/crud_smoke.py:181:42
    |
179 |                 continue
180 |             if not scenario.get("enabled", True):
181 |                 LOGGER.info("⚪️ 跳过场景 `%s`（enabled=false）", name)
    |                                              ^^
182 |                 continue
183 |             LOGGER.info("")
    |

RUF001 String contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> scripts/crud_smoke.py:181:56
    |
179 |                 continue
180 |             if not scenario.get("enabled", True):
181 |                 LOGGER.info("⚪️ 跳过场景 `%s`（enabled=false）", name)
    |                                                             ^^
182 |                 continue
183 |             LOGGER.info("")
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> scripts/crud_smoke.py:193:33
    |
191 |                 self._run_step(name, step, context)
192 |                 if self.stop_on_failure and self.results and not self.results[-1].success:
193 |                     msg = "检测到失败，已根据参数中止执行"
    |                                      ^^
194 |                     raise CrudScenarioError(msg)
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> scripts/crud_smoke.py:208:28
    |
206 |         self._ensure_success_response(resp, expected_status=200, step_name="登录")
207 |         self._refresh_csrf_token()
208 |         LOGGER.info("✅ 登录成功，开始执行 CRUD 场景")
    |                                 ^^
209 |
210 |     def _run_step(self, scenario_name: str, step_cfg: Mapping[str, Any], context: MutableMapping[str, Any]) -> None:
    |

RUF001 String contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> scripts/crud_smoke.py:214:38
    |
212 |         step_name = str(step_cfg.get("name") or f"step_{len(self.results) + 1}")
213 |         if not step_cfg.get("enabled", True):
214 |             LOGGER.info("  ⚪️ 跳过步骤 %s（enabled=false）", step_name)
    |                                          ^^
215 |             return
    |

RUF001 String contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> scripts/crud_smoke.py:214:52
    |
212 |         step_name = str(step_cfg.get("name") or f"step_{len(self.results) + 1}")
213 |         if not step_cfg.get("enabled", True):
214 |             LOGGER.info("  ⚪️ 跳过步骤 %s（enabled=false）", step_name)
    |                                                         ^^
215 |             return
    |

TRY401 Redundant exception object included in `logging.exception` call
   --> scripts/crud_smoke.py:295:55
    |
293 |                 ),
294 |             )
295 |             LOGGER.exception("  ❌ %s: %s", step_name, exc)
    |                                                        ^^^
296 |
297 |     # ------------------------------------------------------------------
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> scripts/crud_smoke.py:308:31
    |
306 |             token = str(payload["data"]["csrf_token"])
307 |         except Exception as exc:
308 |             msg = "CSRF 接口返回异常，缺少 data.csrf_token"
    |                                     ^^
309 |             raise ValueError(msg) from exc
310 |         self.current_csrf = token
    |

PLR0913 Too many arguments in function definition (6 > 5)
   --> scripts/crud_smoke.py:313:9
    |
311 |         return token
312 |
313 |     def _ensure_success_response(
    |         ^^^^^^^^^^^^^^^^^^^^^^^^
314 |         self,
315 |         response: requests.Response,
    |

ARG002 Unused method argument: `step_name`
   --> scripts/crud_smoke.py:318:9
    |
316 |         *,
317 |         expected_status: int,
318 |         step_name: str,
    |         ^^^^^^^^^
319 |         expect_json: Mapping[str, Any] | None = None,
320 |         store: Mapping[str, str] | None = None,
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> scripts/crud_smoke.py:325:44
    |
323 |         """校验状态码与 JSON 内容。."""
324 |         if response.status_code != expected_status:
325 |             msg = f"期望状态码 {expected_status}，实得 {response.status_code}，响应体: {response.text}"
    |                                                 ^^
326 |             raise AssertionError(
327 |                 msg,
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> scripts/crud_smoke.py:325:70
    |
323 |         """校验状态码与 JSON 内容。."""
324 |         if response.status_code != expected_status:
325 |             msg = f"期望状态码 {expected_status}，实得 {response.status_code}，响应体: {response.text}"
    |                                                                              ^^
326 |             raise AssertionError(
327 |                 msg,
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> scripts/crud_smoke.py:340:47
    |
338 |                 rendered_expected = render_template(expected, context or {}) if context else expected
339 |                 if actual != rendered_expected:
340 |                     msg = f"字段 {raw_path} 校验失败，期望 {rendered_expected}，实得 {actual}"
    |                                                     ^^
341 |                     raise AssertionError(
342 |                         msg,
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> scripts/crud_smoke.py:340:70
    |
338 |                 rendered_expected = render_template(expected, context or {}) if context else expected
339 |                 if actual != rendered_expected:
340 |                     msg = f"字段 {raw_path} 校验失败，期望 {rendered_expected}，实得 {actual}"
    |                                                                               ^^
341 |                     raise AssertionError(
342 |                         msg,
    |

ANN401 Dynamically typed expressions (typing.Any) are disallowed in `_safe_json`
   --> scripts/crud_smoke.py:349:58
    |
347 |                 context[str(alias)] = extract_value(payload, str(raw_path))
348 |
349 |     def _safe_json(self, response: requests.Response) -> Any:
    |                                                          ^^^
350 |         """解析 JSON，失败时抛出详细异常。."""
351 |         try:
    |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> scripts/crud_smoke.py:350:19
    |
349 |     def _safe_json(self, response: requests.Response) -> Any:
350 |         """解析 JSON，失败时抛出详细异常。."""
    |                     ^^
351 |         try:
352 |             return response.json()
    |

RUF001 String contains ambiguous `：` (FULLWIDTH COLON). Did you mean `:` (COLON)?
   --> scripts/crud_smoke.py:354:30
    |
352 |             return response.json()
353 |         except json.JSONDecodeError as exc:
354 |             msg = f"响应并非 JSON：{response.text[:200]}"
    |                                  ^^
355 |             raise ValueError(msg) from exc
    |

PLC0415 `import` should be at the top-level of a file
   --> scripts/crud_smoke.py:359:9
    |
357 |     def _build_base_context(self, scenario: Mapping[str, Any]) -> MutableMapping[str, Any]:
358 |         """构建每个场景的基础上下文。."""
359 |         from datetime import datetime
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
360 |         from uuid import uuid4
    |

PLC0415 `import` should be at the top-level of a file
   --> scripts/crud_smoke.py:360:9
    |
358 |         """构建每个场景的基础上下文。."""
359 |         from datetime import datetime
360 |         from uuid import uuid4
    |         ^^^^^^^^^^^^^^^^^^^^^^
361 |
362 |         ctx: MutableMapping[str, Any] = {
    |

DTZ003 `datetime.datetime.utcnow()` used
   --> scripts/crud_smoke.py:365:26
    |
363 |             "uuid": uuid4().hex,
364 |             "rand_suffix": uuid4().hex[:8],
365 |             "timestamp": datetime.utcnow().isoformat(),
    |                          ^^^^^^^^^^^^^^^^^
366 |         }
367 |         extra_vars = scenario.get("variables")
    |
help: Use `datetime.datetime.now(tz=...)` instead

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> scripts/crud_smoke.py:379:30
    |
377 |         step_name: str,
378 |     ) -> None:
379 |         """将 store 字段转换为假的占位符，便于 dry-run 渲染。."""
    |                                         ^^
380 |         store_cfg = step_cfg.get("store")
381 |         if not isinstance(store_cfg, Mapping):
    |

RUF001 String contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
   --> scripts/crud_smoke.py:395:76
    |
393 |     parser.add_argument("--password", help="登录密码")
394 |     parser.add_argument("--only", nargs="*", metavar="NAME", help="只执行指定场景名称")
395 |     parser.add_argument("--timeout", type=float, default=20.0, help="请求超时时间（秒）")
    |                                                                                  ^^
396 |     parser.add_argument("--stop-on-failure", action="store_true", help="遇到失败立即停止")
397 |     parser.add_argument("--dry-run", action="store_true", help="仅打印步骤，不发送请求")
    |

RUF001 String contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
   --> scripts/crud_smoke.py:395:78
    |
393 |     parser.add_argument("--password", help="登录密码")
394 |     parser.add_argument("--only", nargs="*", metavar="NAME", help="只执行指定场景名称")
395 |     parser.add_argument("--timeout", type=float, default=20.0, help="请求超时时间（秒）")
    |                                                                                      ^^
396 |     parser.add_argument("--stop-on-failure", action="store_true", help="遇到失败立即停止")
397 |     parser.add_argument("--dry-run", action="store_true", help="仅打印步骤，不发送请求")
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> scripts/crud_smoke.py:397:70
    |
395 |     parser.add_argument("--timeout", type=float, default=20.0, help="请求超时时间（秒）")
396 |     parser.add_argument("--stop-on-failure", action="store_true", help="遇到失败立即停止")
397 |     parser.add_argument("--dry-run", action="store_true", help="仅打印步骤，不发送请求")
    |                                                                           ^^
398 |     parser.add_argument("--login-path", default="/auth/api/login", help="登录接口路径")
399 |     parser.add_argument("--csrf-path", default="/auth/api/csrf-token", help="CSRF 接口路径")
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> scripts/crud_smoke.py:409:34
    |
408 |     if not args.dry_run and (not args.username or not args.password):
409 |         LOGGER.error("❌ 未提供用户名/密码，无法执行登录")
    |                                           ^^
410 |         return 2
    |

TRY401 Redundant exception object included in `logging.exception` call
   --> scripts/crud_smoke.py:428:34
    |
426 |         runner.run()
427 |     except CrudScenarioError as exc:
428 |         LOGGER.exception("❌ %s", exc)
    |                                   ^^^
429 |     except Exception as exc:
430 |         LOGGER.exception("❌ 执行过程中出现异常: %s", exc)
    |

TRY401 Redundant exception object included in `logging.exception` call
   --> scripts/crud_smoke.py:430:45
    |
428 |         LOGGER.exception("❌ %s", exc)
429 |     except Exception as exc:
430 |         LOGGER.exception("❌ 执行过程中出现异常: %s", exc)
    |                                                       ^^^
431 |
432 |     failed = [result for result in runner.results if not result.success]
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> scripts/crud_smoke.py:451:35
    |
449 |     if failed:
450 |         LOGGER.error("")
451 |         LOGGER.error("❌ 共 %d 个步骤失败，请查看上方日志。", len(failed))
    |                                          ^^
452 |         return 1
    |

RUF001 String contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
   --> scripts/crud_smoke.py:455:28
    |
454 |     LOGGER.info("")
455 |     LOGGER.info("✅ 所有步骤执行完成，无失败。")
    |                                     ^^
456 |     return 0
    |

D205 1 blank line required between summary line and description
 --> scripts/password/reset_admin_password.py:2:1
  |
1 |   #!/usr/bin/env python3
2 | / """重置管理员密码的脚本
3 | | 可以生成新的随机密码或设置指定密码.
4 | | """
  | |___^
5 |
6 |   import argparse
  |
help: Insert single blank line

ANN201 Missing return type annotation for public function `generate_random_password`
  --> scripts/password/reset_admin_password.py:21:5
   |
21 | def generate_random_password(length=12):
   |     ^^^^^^^^^^^^^^^^^^^^^^^^
22 |     """生成满足复杂度要求的随机密码。.
   |
help: Add return type annotation

ANN001 Missing type annotation for function argument `length`
  --> scripts/password/reset_admin_password.py:21:30
   |
21 | def generate_random_password(length=12):
   |                              ^^^^^^
22 |     """生成满足复杂度要求的随机密码。.
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> scripts/password/reset_admin_password.py:25:21
   |
24 |     Args:
25 |         length: 密码长度，默认为 12 个字符，可按需调整。
   |                         ^^
26 |
27 |     Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> scripts/password/reset_admin_password.py:25:32
   |
24 |     Args:
25 |         length: 密码长度，默认为 12 个字符，可按需调整。
   |                                           ^^
26 |
27 |     Returns:
   |

ANN001 Missing type annotation for function argument `new_password`
  --> scripts/password/reset_admin_password.py:34:26
   |
32 |     return "".join(secrets.choice(alphabet) for _ in range(length))
33 |
34 | def reset_admin_password(new_password=None) -> None:
   |                          ^^^^^^^^^^^^
35 |     """重置管理员账户密码。.
   |

RUF002 Docstring contains ambiguous `；` (FULLWIDTH SEMICOLON). Did you mean `;` (SEMICOLON)?
  --> scripts/password/reset_admin_password.py:38:29
   |
37 |     Args:
38 |         new_password: 指定的新密码；如果为空则自动生成随机密码。
   |                                   ^^
39 |
40 |     Returns:
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> scripts/password/reset_admin_password.py:41:32
   |
40 |     Returns:
41 |         None: 通过数据库事务与日志记录产生副作用，不返回值。
   |                                                 ^^
42 |
43 |     """
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> scripts/password/reset_admin_password.py:84:24
   |
83 |     Returns:
84 |         None: 作为 CLI 入口，仅调度辅助函数。
   |                            ^^
85 |
86 |     """
   |

RUF001 String contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> scripts/password/reset_admin_password.py:88:56
   |
86 |     """
87 |     parser = argparse.ArgumentParser(description="重置管理员密码")
88 |     parser.add_argument("--password", "-p", help="指定新密码（不指定则生成随机密码）")
   |                                                             ^^
89 |     parser.add_argument("--length", "-l", type=int, default=12, help="随机密码长度（默认12位）")
   |

RUF001 String contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> scripts/password/reset_admin_password.py:88:67
   |
86 |     """
87 |     parser = argparse.ArgumentParser(description="重置管理员密码")
88 |     parser.add_argument("--password", "-p", help="指定新密码（不指定则生成随机密码）")
   |                                                                                   ^^
89 |     parser.add_argument("--length", "-l", type=int, default=12, help="随机密码长度（默认12位）")
   |

RUF001 String contains ambiguous `（` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?
  --> scripts/password/reset_admin_password.py:89:77
   |
87 |     parser = argparse.ArgumentParser(description="重置管理员密码")
88 |     parser.add_argument("--password", "-p", help="指定新密码（不指定则生成随机密码）")
89 |     parser.add_argument("--length", "-l", type=int, default=12, help="随机密码长度（默认12位）")
   |                                                                                   ^^
90 |
91 |     args = parser.parse_args()
   |

RUF001 String contains ambiguous `）` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?
  --> scripts/password/reset_admin_password.py:89:83
   |
87 |     parser = argparse.ArgumentParser(description="重置管理员密码")
88 |     parser.add_argument("--password", "-p", help="指定新密码（不指定则生成随机密码）")
89 |     parser.add_argument("--length", "-l", type=int, default=12, help="随机密码长度（默认12位）")
   |                                                                                             ^^
90 |
91 |     args = parser.parse_args()
   |

EXE001 Shebang is present but file is not executable
 --> scripts/password/show_admin_password.py:1:1
  |
1 | #!/usr/bin/env python3
  | ^^^^^^^^^^^^^^^^^^^^^^
2 | """展示默认管理员凭据的辅助脚本。."""
  |

INP001 File `tests/conftest.py` is part of an implicit namespace package. Add an `__init__.py`.
--> tests/conftest.py:1:1

D100 Missing docstring in public module
--> tests/conftest.py:1:1

INP001 File `tests/unit/services/test_aggregation_service_periods.py` is part of an implicit namespace package. Add an `__init__.py`.
--> tests/unit/services/test_aggregation_service_periods.py:1:1

ANN202 Missing return type annotation for private function `aggregate_period`
  --> tests/unit/services/test_aggregation_service_periods.py:20:9
   |
18 |         self.calls: list[tuple[str, date, date]] = []
19 |
20 |     def aggregate_period(self, period_type, start_date, end_date, **_):
   |         ^^^^^^^^^^^^^^^^
21 |         self.calls.append((period_type, start_date, end_date))
22 |         return {
   |
help: Add return type annotation

ANN001 Missing type annotation for function argument `period_type`
  --> tests/unit/services/test_aggregation_service_periods.py:20:32
   |
18 |         self.calls: list[tuple[str, date, date]] = []
19 |
20 |     def aggregate_period(self, period_type, start_date, end_date, **_):
   |                                ^^^^^^^^^^^
21 |         self.calls.append((period_type, start_date, end_date))
22 |         return {
   |

ANN001 Missing type annotation for function argument `start_date`
  --> tests/unit/services/test_aggregation_service_periods.py:20:45
   |
18 |         self.calls: list[tuple[str, date, date]] = []
19 |
20 |     def aggregate_period(self, period_type, start_date, end_date, **_):
   |                                             ^^^^^^^^^^
21 |         self.calls.append((period_type, start_date, end_date))
22 |         return {
   |

ANN001 Missing type annotation for function argument `end_date`
  --> tests/unit/services/test_aggregation_service_periods.py:20:57
   |
18 |         self.calls: list[tuple[str, date, date]] = []
19 |
20 |     def aggregate_period(self, period_type, start_date, end_date, **_):
   |                                                         ^^^^^^^^
21 |         self.calls.append((period_type, start_date, end_date))
22 |         return {
   |

ANN003 Missing type annotation for `**_`
  --> tests/unit/services/test_aggregation_service_periods.py:20:67
   |
18 |         self.calls: list[tuple[str, date, date]] = []
19 |
20 |     def aggregate_period(self, period_type, start_date, end_date, **_):
   |                                                                   ^^^
21 |         self.calls.append((period_type, start_date, end_date))
22 |         return {
   |

ANN001 Missing type annotation for function argument `monkeypatch`
  --> tests/unit/services/test_aggregation_service_periods.py:29:57
   |
28 | @pytest.mark.unit
29 | def test_aggregate_database_periods_uses_previous_daily(monkeypatch) -> None:
   |                                                         ^^^^^^^^^^^
30 |     """验证覆盖配置后，日聚合会使用上一日窗口。."""
31 |     calc = PeriodCalculator(now_func=lambda: date(2025, 12, 1))
   |

ARG001 Unused function argument: `monkeypatch`
  --> tests/unit/services/test_aggregation_service_periods.py:29:57
   |
28 | @pytest.mark.unit
29 | def test_aggregate_database_periods_uses_previous_daily(monkeypatch) -> None:
   |                                                         ^^^^^^^^^^^
30 |     """验证覆盖配置后，日聚合会使用上一日窗口。."""
31 |     calc = PeriodCalculator(now_func=lambda: date(2025, 12, 1))
   |

RUF002 Docstring contains ambiguous `，` (FULLWIDTH COMMA). Did you mean `,` (COMMA)?
  --> tests/unit/services/test_aggregation_service_periods.py:30:15
   |
28 | @pytest.mark.unit
29 | def test_aggregate_database_periods_uses_previous_daily(monkeypatch) -> None:
30 |     """验证覆盖配置后，日聚合会使用上一日窗口。."""
   |                      ^^
31 |     calc = PeriodCalculator(now_func=lambda: date(2025, 12, 1))
32 |     service = AggregationService(period_calculator=calc)
   |

ANN001 Missing type annotation for function argument `monkeypatch`
  --> tests/unit/services/test_aggregation_service_periods.py:49:47
   |
48 | @pytest.mark.unit
49 | def test_instance_aggregations_daily_override(monkeypatch) -> None:
   |                                               ^^^^^^^^^^^
50 |     """calculate_instance_aggregations 接收覆盖配置后会向下游透传。."""
51 |     calc = PeriodCalculator(now_func=lambda: date(2025, 12, 1))
   |

ANN202 Missing return type annotation for private function `get`
  --> tests/unit/services/test_aggregation_service_periods.py:57:13
   |
56 |     class _Query:
57 |         def get(self, _instance_id):
   |             ^^^
58 |             return stub_instance
   |
help: Add return type annotation

ANN001 Missing type annotation for function argument `_instance_id`
  --> tests/unit/services/test_aggregation_service_periods.py:57:23
   |
56 |     class _Query:
57 |         def get(self, _instance_id):
   |                       ^^^^^^^^^^^^
58 |             return stub_instance
   |

ANN202 Missing return type annotation for private function `_fake_daily`
  --> tests/unit/services/test_aggregation_service_periods.py:64:9
   |
62 |     captured = {}
63 |
64 |     def _fake_daily(self, instance_id, *, use_current_period=True):
   |         ^^^^^^^^^^^
65 |         captured["instance_id"] = instance_id
66 |         captured["use_current_period"] = use_current_period
   |
help: Add return type annotation

ANN001 Missing type annotation for function argument `self`
  --> tests/unit/services/test_aggregation_service_periods.py:64:21
   |
62 |     captured = {}
63 |
64 |     def _fake_daily(self, instance_id, *, use_current_period=True):
   |                     ^^^^
65 |         captured["instance_id"] = instance_id
66 |         captured["use_current_period"] = use_current_period
   |

ARG001 Unused function argument: `self`
  --> tests/unit/services/test_aggregation_service_periods.py:64:21
   |
62 |     captured = {}
63 |
64 |     def _fake_daily(self, instance_id, *, use_current_period=True):
   |                     ^^^^
65 |         captured["instance_id"] = instance_id
66 |         captured["use_current_period"] = use_current_period
   |

ANN001 Missing type annotation for function argument `instance_id`
  --> tests/unit/services/test_aggregation_service_periods.py:64:27
   |
62 |     captured = {}
63 |
64 |     def _fake_daily(self, instance_id, *, use_current_period=True):
   |                           ^^^^^^^^^^^
65 |         captured["instance_id"] = instance_id
66 |         captured["use_current_period"] = use_current_period
   |

ANN001 Missing type annotation for function argument `use_current_period`
  --> tests/unit/services/test_aggregation_service_periods.py:64:43
   |
62 |     captured = {}
63 |
64 |     def _fake_daily(self, instance_id, *, use_current_period=True):
   |                                           ^^^^^^^^^^^^^^^^^^
65 |         captured["instance_id"] = instance_id
66 |         captured["use_current_period"] = use_current_period
   |

INP001 File `tests/unit/services/test_classification_form_service.py` is part of an implicit namespace package. Add an `__init__.py`.
--> tests/unit/services/test_classification_form_service.py:1:1

D100 Missing docstring in public module
--> tests/unit/services/test_classification_form_service.py:1:1

D103 Missing docstring in public function
  --> tests/unit/services/test_classification_form_service.py:11:5
   |
10 | @pytest.mark.unit
11 | def test_validate_flags_duplicate_name(monkeypatch) -> None:
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
12 |     service = ClassificationFormService()
   |

ANN001 Missing type annotation for function argument `monkeypatch`
  --> tests/unit/services/test_classification_form_service.py:11:40
   |
10 | @pytest.mark.unit
11 | def test_validate_flags_duplicate_name(monkeypatch) -> None:
   |                                        ^^^^^^^^^^^
12 |     service = ClassificationFormService()
   |

ARG005 Unused lambda argument: `self`
  --> tests/unit/services/test_classification_form_service.py:17:16
   |
15 |         ClassificationFormService,
16 |         "_name_exists",
17 |         lambda self, name, resource: True,
   |                ^^^^
18 |         raising=False,
19 |     )
   |

ARG005 Unused lambda argument: `name`
  --> tests/unit/services/test_classification_form_service.py:17:22
   |
15 |         ClassificationFormService,
16 |         "_name_exists",
17 |         lambda self, name, resource: True,
   |                      ^^^^
18 |         raising=False,
19 |     )
   |

ARG005 Unused lambda argument: `resource`
  --> tests/unit/services/test_classification_form_service.py:17:28
   |
15 |         ClassificationFormService,
16 |         "_name_exists",
17 |         lambda self, name, resource: True,
   |                            ^^^^^^^^
18 |         raising=False,
19 |     )
   |

D103 Missing docstring in public function
  --> tests/unit/services/test_classification_form_service.py:38:5
   |
37 | @pytest.mark.unit
38 | def test_validate_sets_is_create_flag(monkeypatch) -> None:
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
39 |     service = ClassificationFormService()
   |

ANN001 Missing type annotation for function argument `monkeypatch`
  --> tests/unit/services/test_classification_form_service.py:38:39
   |
37 | @pytest.mark.unit
38 | def test_validate_sets_is_create_flag(monkeypatch) -> None:
   |                                       ^^^^^^^^^^^
39 |     service = ClassificationFormService()
   |

ARG005 Unused lambda argument: `self`
  --> tests/unit/services/test_classification_form_service.py:44:16
   |
42 |         ClassificationFormService,
43 |         "_name_exists",
44 |         lambda self, name, resource: False,
   |                ^^^^
45 |         raising=False,
46 |     )
   |

ARG005 Unused lambda argument: `name`
  --> tests/unit/services/test_classification_form_service.py:44:22
   |
42 |         ClassificationFormService,
43 |         "_name_exists",
44 |         lambda self, name, resource: False,
   |                      ^^^^
45 |         raising=False,
46 |     )
   |

ARG005 Unused lambda argument: `resource`
  --> tests/unit/services/test_classification_form_service.py:44:28
   |
42 |         ClassificationFormService,
43 |         "_name_exists",
44 |         lambda self, name, resource: False,
   |                            ^^^^^^^^
45 |         raising=False,
46 |     )
   |

INP001 File `tests/unit/services/test_classification_rule_form_service.py` is part of an implicit namespace package. Add an `__init__.py`.
--> tests/unit/services/test_classification_rule_form_service.py:1:1

D100 Missing docstring in public module
--> tests/unit/services/test_classification_rule_form_service.py:1:1

D103 Missing docstring in public function
  --> tests/unit/services/test_classification_rule_form_service.py:12:5
   |
11 | @pytest.mark.unit
12 | def test_validate_uses_dynamic_db_types(monkeypatch) -> None:
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
13 |     service = ClassificationRuleFormService()
   |

ANN001 Missing type annotation for function argument `monkeypatch`
  --> tests/unit/services/test_classification_rule_form_service.py:12:41
   |
11 | @pytest.mark.unit
12 | def test_validate_uses_dynamic_db_types(monkeypatch) -> None:
   |                                         ^^^^^^^^^^^
13 |     service = ClassificationRuleFormService()
   |

PLC0415 `import` should be at the top-level of a file
  --> tests/unit/services/test_classification_rule_form_service.py:15:5
   |
13 |     service = ClassificationRuleFormService()
14 |
15 |     from app.services import database_type_service
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
16 |
17 |     monkeypatch.setattr(
   |

ARG005 Unused lambda argument: `self`
  --> tests/unit/services/test_classification_rule_form_service.py:34:16
   |
32 |         ClassificationRuleFormService,
33 |         "_get_classification_by_id",
34 |         lambda self, _: SimpleNamespace(id=1),
   |                ^^^^
35 |         raising=False,
36 |     )
   |

ARG005 Unused lambda argument: `self`
  --> tests/unit/services/test_classification_rule_form_service.py:41:16
   |
39 |         ClassificationRuleFormService,
40 |         "_rule_name_exists",
41 |         lambda self, data, resource: False,
   |                ^^^^
42 |         raising=False,
43 |     )
   |

ARG005 Unused lambda argument: `data`
  --> tests/unit/services/test_classification_rule_form_service.py:41:22
   |
39 |         ClassificationRuleFormService,
40 |         "_rule_name_exists",
41 |         lambda self, data, resource: False,
   |                      ^^^^
42 |         raising=False,
43 |     )
   |

ARG005 Unused lambda argument: `resource`
  --> tests/unit/services/test_classification_rule_form_service.py:41:28
   |
39 |         ClassificationRuleFormService,
40 |         "_rule_name_exists",
41 |         lambda self, data, resource: False,
   |                            ^^^^^^^^
42 |         raising=False,
43 |     )
   |

ARG005 Unused lambda argument: `self`
  --> tests/unit/services/test_classification_rule_form_service.py:47:16
   |
45 |         ClassificationRuleFormService,
46 |         "_expression_exists",
47 |         lambda self, expr, classification_id, resource: False,
   |                ^^^^
48 |         raising=False,
49 |     )
   |

ARG005 Unused lambda argument: `expr`
  --> tests/unit/services/test_classification_rule_form_service.py:47:22
   |
45 |         ClassificationRuleFormService,
46 |         "_expression_exists",
47 |         lambda self, expr, classification_id, resource: False,
   |                      ^^^^
48 |         raising=False,
49 |     )
   |

ARG005 Unused lambda argument: `classification_id`
  --> tests/unit/services/test_classification_rule_form_service.py:47:28
   |
45 |         ClassificationRuleFormService,
46 |         "_expression_exists",
47 |         lambda self, expr, classification_id, resource: False,
   |                            ^^^^^^^^^^^^^^^^^
48 |         raising=False,
49 |     )
   |

ARG005 Unused lambda argument: `resource`
  --> tests/unit/services/test_classification_rule_form_service.py:47:47
   |
45 |         ClassificationRuleFormService,
46 |         "_expression_exists",
47 |         lambda self, expr, classification_id, resource: False,
   |                                               ^^^^^^^^
48 |         raising=False,
49 |     )
   |

D103 Missing docstring in public function
  --> tests/unit/services/test_classification_rule_form_service.py:57:5
   |
56 | @pytest.mark.unit
57 | def test_validate_blocks_duplicate_rules(monkeypatch) -> None:
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
58 |     service = ClassificationRuleFormService()
   |

ANN001 Missing type annotation for function argument `monkeypatch`
  --> tests/unit/services/test_classification_rule_form_service.py:57:42
   |
56 | @pytest.mark.unit
57 | def test_validate_blocks_duplicate_rules(monkeypatch) -> None:
   |                                          ^^^^^^^^^^^
58 |     service = ClassificationRuleFormService()
   |

ARG005 Unused lambda argument: `self`
  --> tests/unit/services/test_classification_rule_form_service.py:63:16
   |
61 |         ClassificationRuleFormService,
62 |         "_get_classification_by_id",
63 |         lambda self, _: SimpleNamespace(id=1),
   |                ^^^^
64 |         raising=False,
65 |     )
   |

ARG005 Unused lambda argument: `self`
  --> tests/unit/services/test_classification_rule_form_service.py:69:16
   |
67 |         ClassificationRuleFormService,
68 |         "_get_db_type_options",
69 |         lambda self: [{"value": "mysql"}],
   |                ^^^^
70 |         raising=False,
71 |     )
   |

ARG005 Unused lambda argument: `self`
  --> tests/unit/services/test_classification_rule_form_service.py:75:16
   |
73 |         ClassificationRuleFormService,
74 |         "_rule_name_exists",
75 |         lambda self, data, resource: True,
   |                ^^^^
76 |         raising=False,
77 |     )
   |

ARG005 Unused lambda argument: `data`
  --> tests/unit/services/test_classification_rule_form_service.py:75:22
   |
73 |         ClassificationRuleFormService,
74 |         "_rule_name_exists",
75 |         lambda self, data, resource: True,
   |                      ^^^^
76 |         raising=False,
77 |     )
   |

ARG005 Unused lambda argument: `resource`
  --> tests/unit/services/test_classification_rule_form_service.py:75:28
   |
73 |         ClassificationRuleFormService,
74 |         "_rule_name_exists",
75 |         lambda self, data, resource: True,
   |                            ^^^^^^^^
76 |         raising=False,
77 |     )
   |

INP001 File `tests/unit/services/test_database_ledger_service.py` is part of an implicit namespace package. Add an `__init__.py`.
--> tests/unit/services/test_database_ledger_service.py:1:1

D100 Missing docstring in public module
--> tests/unit/services/test_database_ledger_service.py:1:1

D103 Missing docstring in public function
  --> tests/unit/services/test_database_ledger_service.py:14:5
   |
13 | @pytest.mark.unit
14 | def test_format_size_handles_megabytes() -> None:
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
15 |     service = DatabaseLedgerService(session=object())
16 |     assert service._format_size(None) == "未采集"
   |

SLF001 Private member accessed: `_format_size`
  --> tests/unit/services/test_database_ledger_service.py:16:12
   |
14 | def test_format_size_handles_megabytes() -> None:
15 |     service = DatabaseLedgerService(session=object())
16 |     assert service._format_size(None) == "未采集"
   |            ^^^^^^^^^^^^^^^^^^^^
17 |     assert service._format_size(512) == "512 MB"
18 |     assert service._format_size(2048) == "2.00 GB"
   |

SLF001 Private member accessed: `_format_size`
  --> tests/unit/services/test_database_ledger_service.py:17:12
   |
15 |     service = DatabaseLedgerService(session=object())
16 |     assert service._format_size(None) == "未采集"
17 |     assert service._format_size(512) == "512 MB"
   |            ^^^^^^^^^^^^^^^^^^^^
18 |     assert service._format_size(2048) == "2.00 GB"
   |

SLF001 Private member accessed: `_format_size`
  --> tests/unit/services/test_database_ledger_service.py:18:12
   |
16 |     assert service._format_size(None) == "未采集"
17 |     assert service._format_size(512) == "512 MB"
18 |     assert service._format_size(2048) == "2.00 GB"
   |            ^^^^^^^^^^^^^^^^^^^^
   |

D103 Missing docstring in public function
  --> tests/unit/services/test_database_ledger_service.py:22:5
   |
21 | @pytest.mark.unit
22 | def test_resolve_sync_status_recent(monkeypatch) -> None:
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
23 |     service = DatabaseLedgerService(session=object())
24 |     now = datetime.datetime(2025, 11, 27, 12, 0, tzinfo=datetime.UTC)
   |

ANN001 Missing type annotation for function argument `monkeypatch`
  --> tests/unit/services/test_database_ledger_service.py:22:37
   |
21 | @pytest.mark.unit
22 | def test_resolve_sync_status_recent(monkeypatch) -> None:
   |                                     ^^^^^^^^^^^
23 |     service = DatabaseLedgerService(session=object())
24 |     now = datetime.datetime(2025, 11, 27, 12, 0, tzinfo=datetime.UTC)
   |

SLF001 Private member accessed: `_resolve_sync_status`
  --> tests/unit/services/test_database_ledger_service.py:26:14
   |
24 |     now = datetime.datetime(2025, 11, 27, 12, 0, tzinfo=datetime.UTC)
25 |     monkeypatch.setattr("app.services.ledgers.database_ledger_service.time_utils.now", lambda: now)
26 |     status = service._resolve_sync_status(now - datetime.timedelta(hours=2))
   |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
27 |     assert status["value"] == SyncStatus.COMPLETED
   |

D103 Missing docstring in public function
  --> tests/unit/services/test_database_ledger_service.py:31:5
   |
30 | @pytest.mark.unit
31 | def test_resolve_sync_status_timeout(monkeypatch) -> None:
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
32 |     service = DatabaseLedgerService(session=object())
33 |     now = datetime.datetime(2025, 11, 27, 12, 0, tzinfo=datetime.UTC)
   |

ANN001 Missing type annotation for function argument `monkeypatch`
  --> tests/unit/services/test_database_ledger_service.py:31:38
   |
30 | @pytest.mark.unit
31 | def test_resolve_sync_status_timeout(monkeypatch) -> None:
   |                                      ^^^^^^^^^^^
32 |     service = DatabaseLedgerService(session=object())
33 |     now = datetime.datetime(2025, 11, 27, 12, 0, tzinfo=datetime.UTC)
   |

SLF001 Private member accessed: `_resolve_sync_status`
  --> tests/unit/services/test_database_ledger_service.py:35:14
   |
33 |     now = datetime.datetime(2025, 11, 27, 12, 0, tzinfo=datetime.UTC)
34 |     monkeypatch.setattr("app.services.ledgers.database_ledger_service.time_utils.now", lambda: now)
35 |     status = service._resolve_sync_status(now - datetime.timedelta(days=3))
   |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
36 |     assert status["value"] == SyncStatus.FAILED
   |

INP001 File `tests/unit/services/test_user_form_service.py` is part of an implicit namespace package. Add an `__init__.py`.
--> tests/unit/services/test_user_form_service.py:1:1

D100 Missing docstring in public module
--> tests/unit/services/test_user_form_service.py:1:1

ANN202 Missing return type annotation for private function `filter`
  --> tests/unit/services/test_user_form_service.py:13:9
   |
12 | class _DummyQuery:
13 |     def filter(self, *args, **kwargs):
   |         ^^^^^^
14 |         return self
   |
help: Add return type annotation

ANN002 Missing type annotation for `*args`
  --> tests/unit/services/test_user_form_service.py:13:22
   |
12 | class _DummyQuery:
13 |     def filter(self, *args, **kwargs):
   |                      ^^^^^
14 |         return self
   |

ARG002 Unused method argument: `args`
  --> tests/unit/services/test_user_form_service.py:13:23
   |
12 | class _DummyQuery:
13 |     def filter(self, *args, **kwargs):
   |                       ^^^^
14 |         return self
   |

ANN003 Missing type annotation for `**kwargs`
  --> tests/unit/services/test_user_form_service.py:13:29
   |
12 | class _DummyQuery:
13 |     def filter(self, *args, **kwargs):
   |                             ^^^^^^^^
14 |         return self
   |

ARG002 Unused method argument: `kwargs`
  --> tests/unit/services/test_user_form_service.py:13:31
   |
12 | class _DummyQuery:
13 |     def filter(self, *args, **kwargs):
   |                               ^^^^^^
14 |         return self
   |

ANN202 Missing return type annotation for private function `filter_by`
  --> tests/unit/services/test_user_form_service.py:16:9
   |
14 |         return self
15 |
16 |     def filter_by(self, *args, **kwargs):
   |         ^^^^^^^^^
17 |         return self
   |
help: Add return type annotation

ANN002 Missing type annotation for `*args`
  --> tests/unit/services/test_user_form_service.py:16:25
   |
14 |         return self
15 |
16 |     def filter_by(self, *args, **kwargs):
   |                         ^^^^^
17 |         return self
   |

ARG002 Unused method argument: `args`
  --> tests/unit/services/test_user_form_service.py:16:26
   |
14 |         return self
15 |
16 |     def filter_by(self, *args, **kwargs):
   |                          ^^^^
17 |         return self
   |

ANN003 Missing type annotation for `**kwargs`
  --> tests/unit/services/test_user_form_service.py:16:32
   |
14 |         return self
15 |
16 |     def filter_by(self, *args, **kwargs):
   |                                ^^^^^^^^
17 |         return self
   |

ARG002 Unused method argument: `kwargs`
  --> tests/unit/services/test_user_form_service.py:16:34
   |
14 |         return self
15 |
16 |     def filter_by(self, *args, **kwargs):
   |                                  ^^^^^^
17 |         return self
   |

D103 Missing docstring in public function
  --> tests/unit/services/test_user_form_service.py:24:5
   |
23 | @pytest.mark.unit
24 | def test_validate_prevents_disabling_last_admin(monkeypatch) -> None:
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
25 |     service = UserFormService()
26 |     admin = User(username="root", role=UserRole.ADMIN)
   |

ANN001 Missing type annotation for function argument `monkeypatch`
  --> tests/unit/services/test_user_form_service.py:24:49
   |
23 | @pytest.mark.unit
24 | def test_validate_prevents_disabling_last_admin(monkeypatch) -> None:
   |                                                 ^^^^^^^^^^^
25 |     service = UserFormService()
26 |     admin = User(username="root", role=UserRole.ADMIN)
   |

ARG005 Unused lambda argument: `self`
  --> tests/unit/services/test_user_form_service.py:30:64
   |
28 |     admin.is_active = True
29 |
30 |     monkeypatch.setattr(UserFormService, "_user_query", lambda self: _DummyQuery(), raising=False)
   |                                                                ^^^^
31 |     monkeypatch.setattr(
32 |         User,
   |

ARG005 Unused lambda argument: `cls`
  --> tests/unit/services/test_user_form_service.py:34:28
   |
32 |         User,
33 |         "active_admin_count",
34 |         classmethod(lambda cls, *, exclude_user_id=None: 0),
   |                            ^^^
35 |     )
   |

ARG005 Unused lambda argument: `exclude_user_id`
  --> tests/unit/services/test_user_form_service.py:34:36
   |
32 |         User,
33 |         "active_admin_count",
34 |         classmethod(lambda cls, *, exclude_user_id=None: 0),
   |                                    ^^^^^^^^^^^^^^^
35 |     )
   |

D103 Missing docstring in public function
  --> tests/unit/services/test_user_form_service.py:51:5
   |
50 | @pytest.mark.unit
51 | def test_validate_allows_change_when_other_admin_exists(monkeypatch) -> None:
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
52 |     service = UserFormService()
53 |     admin = User(username="root", role=UserRole.ADMIN)
   |

ANN001 Missing type annotation for function argument `monkeypatch`
  --> tests/unit/services/test_user_form_service.py:51:57
   |
50 | @pytest.mark.unit
51 | def test_validate_allows_change_when_other_admin_exists(monkeypatch) -> None:
   |                                                         ^^^^^^^^^^^
52 |     service = UserFormService()
53 |     admin = User(username="root", role=UserRole.ADMIN)
   |

ARG005 Unused lambda argument: `self`
  --> tests/unit/services/test_user_form_service.py:57:64
   |
55 |     admin.is_active = True
56 |
57 |     monkeypatch.setattr(UserFormService, "_user_query", lambda self: _DummyQuery(), raising=False)
   |                                                                ^^^^
58 |     monkeypatch.setattr(
59 |         User,
   |

ARG005 Unused lambda argument: `cls`
  --> tests/unit/services/test_user_form_service.py:61:28
   |
59 |         User,
60 |         "active_admin_count",
61 |         classmethod(lambda cls, *, exclude_user_id=None: 1),
   |                            ^^^
62 |     )
   |

ARG005 Unused lambda argument: `exclude_user_id`
  --> tests/unit/services/test_user_form_service.py:61:36
   |
59 |         User,
60 |         "active_admin_count",
61 |         classmethod(lambda cls, *, exclude_user_id=None: 1),
   |                                    ^^^^^^^^^^^^^^^
62 |     )
   |

INP001 File `tests/unit/utils/test_data_validator.py` is part of an implicit namespace package. Add an `__init__.py`.
--> tests/unit/utils/test_data_validator.py:1:1

D100 Missing docstring in public module
--> tests/unit/utils/test_data_validator.py:1:1

D103 Missing docstring in public function
  --> tests/unit/utils/test_data_validator.py:12:5
   |
11 | @pytest.mark.unit
12 | def test_validate_db_type_uses_dynamic_configs(monkeypatch) -> None:
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
13 |     from app.services import database_type_service
   |

ANN001 Missing type annotation for function argument `monkeypatch`
  --> tests/unit/utils/test_data_validator.py:12:48
   |
11 | @pytest.mark.unit
12 | def test_validate_db_type_uses_dynamic_configs(monkeypatch) -> None:
   |                                                ^^^^^^^^^^^
13 |     from app.services import database_type_service
   |

PLC0415 `import` should be at the top-level of a file
  --> tests/unit/utils/test_data_validator.py:13:5
   |
11 | @pytest.mark.unit
12 | def test_validate_db_type_uses_dynamic_configs(monkeypatch) -> None:
13 |     from app.services import database_type_service
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
14 |
15 |     monkeypatch.setattr(
   |

D103 Missing docstring in public function
  --> tests/unit/utils/test_data_validator.py:25:5
   |
24 | @pytest.mark.unit
25 | def test_validate_db_type_with_custom_override() -> None:
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
26 |     DataValidator.set_custom_db_types(["clickhouse"])
27 |     try:
   |

INP001 File `tests/unit/utils/test_sensitive_data.py` is part of an implicit namespace package. Add an `__init__.py`.
--> tests/unit/utils/test_sensitive_data.py:1:1

D400 First line should end with a period
 --> tests/unit/utils/test_sensitive_data.py:1:1
  |
1 | """敏感字段脱敏工具函数的单元测试。"""
  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2 |
3 | import pytest
  |
help: Add period

D415 First line should end with a period, question mark, or exclamation point
 --> tests/unit/utils/test_sensitive_data.py:1:1
  |
1 | """敏感字段脱敏工具函数的单元测试。"""
  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2 |
3 | import pytest
  |
help: Add closing punctuation

D202 [*] No blank lines allowed after function docstring (found 1)
  --> tests/unit/utils/test_sensitive_data.py:12:5
   |
10 | @pytest.mark.unit
11 | def test_scrub_sensitive_fields_masks_nested_values() -> None:
12 |     """验证嵌套字段会统一替换为自定义掩码。"""
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
13 |
14 |     payload = {
   |
help: Remove blank line(s) after function docstring

D400 First line should end with a period
  --> tests/unit/utils/test_sensitive_data.py:12:5
   |
10 | @pytest.mark.unit
11 | def test_scrub_sensitive_fields_masks_nested_values() -> None:
12 |     """验证嵌套字段会统一替换为自定义掩码。"""
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
13 |
14 |     payload = {
   |
help: Add period

D415 First line should end with a period, question mark, or exclamation point
  --> tests/unit/utils/test_sensitive_data.py:12:5
   |
10 | @pytest.mark.unit
11 | def test_scrub_sensitive_fields_masks_nested_values() -> None:
12 |     """验证嵌套字段会统一替换为自定义掩码。"""
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
13 |
14 |     payload = {
   |
help: Add closing punctuation

D202 [*] No blank lines allowed after function docstring (found 1)
  --> tests/unit/utils/test_sensitive_data.py:31:5
   |
29 | @pytest.mark.unit
30 | def test_scrub_sensitive_fields_supports_extra_keys() -> None:
31 |     """验证可通过 extra_keys 参数扩展脱敏字段。"""
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
32 |
33 |     payload = {"custom": "value", "api_key": "key"}
   |
help: Remove blank line(s) after function docstring

D400 First line should end with a period
  --> tests/unit/utils/test_sensitive_data.py:31:5
   |
29 | @pytest.mark.unit
30 | def test_scrub_sensitive_fields_supports_extra_keys() -> None:
31 |     """验证可通过 extra_keys 参数扩展脱敏字段。"""
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
32 |
33 |     payload = {"custom": "value", "api_key": "key"}
   |
help: Add period

D415 First line should end with a period, question mark, or exclamation point
  --> tests/unit/utils/test_sensitive_data.py:31:5
   |
29 | @pytest.mark.unit
30 | def test_scrub_sensitive_fields_supports_extra_keys() -> None:
31 |     """验证可通过 extra_keys 参数扩展脱敏字段。"""
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
32 |
33 |     payload = {"custom": "value", "api_key": "key"}
   |
help: Add closing punctuation

Found 4312 errors.
[*] 4 fixable with the `--fix` option (12 hidden fixes can be enabled with the `--unsafe-fixes` option).
