D202 [*] No blank lines allowed after function docstring (found 1)
  --> app/api/__init__.py:16:5
   |
15 |   def register_api_blueprints(app: Flask, settings: Settings) -> None:
16 | /     """按 Settings 注册 API blueprints.
17 | |
18 | |     说明:
19 | |     - `/api/v1/**` 为唯一可用的对外 JSON API.
20 | |     """
   | |_______^
21 |
22 |       from app.api.v1 import create_api_v1_blueprint  # noqa: PLC0415
   |
help: Remove blank line(s) after function docstring

D102 Missing docstring in public method
  --> app/api/v1/api.py:34:9
   |
32 |         )
33 |
34 |     def handle_error(self, e: Exception) -> Response:  # type: ignore[override]
   |         ^^^^^^^^^^^^
35 |         payload, status_code = unified_error_response(e, context=ErrorContext(e, request))
36 |         response = jsonify(payload)
   |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/accounts.py:333:7
    |
332 | @ns.route("/ledgers")
333 | class AccountsLedgersResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^
334 |     method_decorators = [api_login_required, api_permission_required("view")]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/accounts.py:340:9
    |
338 |     @ns.response(403, "Forbidden", ErrorEnvelope)
339 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
340 |     def get(self):
    |         ^^^
341 |         filters = _parse_account_filters(allow_query_db_type=True)
342 |         sort_field = request.args.get("sort", "username")
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/accounts.py:381:7
    |
380 | @ns.route("/ledgers/<int:account_id>/permissions")
381 | class AccountsLedgersPermissionsResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
382 |     method_decorators = [api_login_required, api_permission_required("view")]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/accounts.py:388:9
    |
386 |     @ns.response(403, "Forbidden", ErrorEnvelope)
387 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
388 |     def get(self, account_id: int):
    |         ^^^
389 |         def _execute():
390 |             result = AccountsLedgerPermissionsService().get_permissions(account_id)
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/accounts.py:407:7
    |
406 | @ns.route("/statistics")
407 | class AccountsStatisticsResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^
408 |     method_decorators = [api_login_required, api_permission_required("view")]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/accounts.py:414:9
    |
412 |     @ns.response(403, "Forbidden", ErrorEnvelope)
413 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
414 |     def get(self):
    |         ^^^
415 |         def _execute():
416 |             result = AccountsStatisticsReadService().build_statistics()
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/accounts.py:429:7
    |
428 | @ns.route("/statistics/summary")
429 | class AccountsStatisticsSummaryResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
430 |     method_decorators = [api_login_required, api_permission_required("view")]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/accounts.py:436:9
    |
434 |     @ns.response(403, "Forbidden", ErrorEnvelope)
435 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
436 |     def get(self):
    |         ^^^
437 |         instance_id = request.args.get("instance_id", type=int)
438 |         db_type = request.args.get("db_type", type=str)
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/accounts.py:454:7
    |
453 | @ns.route("/statistics/db-types")
454 | class AccountsStatisticsByDbTypeResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
455 |     method_decorators = [api_login_required, api_permission_required("view")]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/accounts.py:461:9
    |
459 |     @ns.response(403, "Forbidden", ErrorEnvelope)
460 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
461 |     def get(self):
    |         ^^^
462 |         def _execute():
463 |             stats = AccountsStatisticsReadService().fetch_db_type_stats()
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/accounts.py:475:7
    |
474 | @ns.route("/statistics/classifications")
475 | class AccountsStatisticsByClassificationResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
476 |     method_decorators = [api_login_required, api_permission_required("view")]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/accounts.py:482:9
    |
480 |     @ns.response(403, "Forbidden", ErrorEnvelope)
481 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
482 |     def get(self):
    |         ^^^
483 |         def _execute():
484 |             stats = AccountsStatisticsReadService().fetch_classification_stats()
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/accounts.py:496:7
    |
495 | @ns.route("/actions/sync-all")
496 | class AccountsSyncAllActionResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
497 |     method_decorators = [api_login_required, api_permission_required("update")]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/accounts.py:505:9
    |
503 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
504 |     @require_csrf
505 |     def post(self):
    |         ^^^^
506 |         created_by = getattr(current_user, "id", None)
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/accounts.py:536:7
    |
535 | @ns.route("/actions/sync")
536 | class AccountsSyncInstanceActionResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
537 |     method_decorators = [api_login_required, api_permission_required("update")]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/accounts.py:547:9
    |
545 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
546 |     @require_csrf
547 |     def post(self):
    |         ^^^^
548 |         payload = _parse_sync_payload()
549 |         instance_id_raw = payload.get("instance_id")
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/accounts_classifications.py:334:7
    |
333 | @ns.route("/colors")
334 | class AccountClassificationColorsResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
335 |     method_decorators = [api_login_required, api_permission_required("view")]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/accounts_classifications.py:341:9
    |
339 |     @ns.response(403, "Forbidden", ErrorEnvelope)
340 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
341 |     def get(self):
    |         ^^^
342 |         def _execute():
343 |             data = {
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/accounts_classifications.py:359:7
    |
358 | @ns.route("")
359 | class AccountClassificationsResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
360 |     method_decorators = [api_login_required]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/accounts_classifications.py:367:9
    |
365 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
366 |     @api_permission_required("view")
367 |     def get(self):
    |         ^^^
368 |         def _execute():
369 |             classifications = _read_service.list_classifications()
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/accounts_classifications.py:388:9
    |
386 |     @api_permission_required("create")
387 |     @require_csrf
388 |     def post(self):
    |         ^^^^
389 |         payload = _parse_json_payload()
390 |         operator_id = getattr(current_user, "id", None)
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/accounts_classifications.py:410:7
    |
409 | @ns.route("/<int:classification_id>")
410 | class AccountClassificationDetailResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
411 |     method_decorators = [api_login_required]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/accounts_classifications.py:419:9
    |
417 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
418 |     @api_permission_required("view")
419 |     def get(self, classification_id: int):
    |         ^^^
420 |         def _execute():
421 |             classification = AccountClassification.query.get_or_404(classification_id)
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/accounts_classifications.py:443:9
    |
441 |     @api_permission_required("update")
442 |     @require_csrf
443 |     def put(self, classification_id: int):
    |         ^^^
444 |         classification = AccountClassification.query.get_or_404(classification_id)
445 |         payload = _parse_json_payload()
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/accounts_classifications.py:472:9
    |
470 |     @api_permission_required("delete")
471 |     @require_csrf
472 |     def delete(self, classification_id: int):
    |         ^^^^^^
473 |         classification = AccountClassification.query.get_or_404(classification_id)
474 |         operator_id = getattr(current_user, "id", None)
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/accounts_classifications.py:503:7
    |
502 | @ns.route("/rules")
503 | class AccountClassificationRulesResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
504 |     method_decorators = [api_login_required]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/accounts_classifications.py:511:9
    |
509 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
510 |     @api_permission_required("view")
511 |     def get(self):
    |         ^^^
512 |         def _execute():
513 |             rules = _read_service.list_rules()
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/accounts_classifications.py:545:9
    |
543 |     @api_permission_required("create")
544 |     @require_csrf
545 |     def post(self):
    |         ^^^^
546 |         payload = _parse_json_payload()
547 |         operator_id = getattr(current_user, "id", None)
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/accounts_classifications.py:570:7
    |
569 | @ns.route("/rules/filter")
570 | class AccountClassificationRulesFilterResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
571 |     method_decorators = [api_login_required, api_permission_required("view")]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/accounts_classifications.py:577:9
    |
575 |     @ns.response(403, "Forbidden", ErrorEnvelope)
576 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
577 |     def get(self):
    |         ^^^
578 |         classification_id = request.args.get("classification_id", type=int)
579 |         db_type = request.args.get("db_type")
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/accounts_classifications.py:599:7
    |
598 | @ns.route("/rules/actions/validate-expression")
599 | class AccountClassificationRuleExpressionValidateResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
600 |     method_decorators = [api_login_required, api_permission_required("view")]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/accounts_classifications.py:609:9
    |
607 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
608 |     @require_csrf
609 |     def post(self):
    |         ^^^^
610 |         payload = _parse_json_payload()
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/accounts_classifications.py:646:7
    |
645 | @ns.route("/rules/stats")
646 | class AccountClassificationRulesStatsResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
647 |     method_decorators = [api_login_required, api_permission_required("view")]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/accounts_classifications.py:654:9
    |
652 |     @ns.response(403, "Forbidden", ErrorEnvelope)
653 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
654 |     def get(self):
    |         ^^^
655 |         rule_ids = _parse_rule_ids_param(request.args.get("rule_ids"))
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/accounts_classifications.py:672:7
    |
671 | @ns.route("/rules/<int:rule_id>")
672 | class AccountClassificationRuleDetailResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
673 |     method_decorators = [api_login_required]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/accounts_classifications.py:681:9
    |
679 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
680 |     @api_permission_required("view")
681 |     def get(self, rule_id: int):
    |         ^^^
682 |         def _execute():
683 |             rule = ClassificationRule.query.get_or_404(rule_id)
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/accounts_classifications.py:706:9
    |
704 |     @api_permission_required("update")
705 |     @require_csrf
706 |     def put(self, rule_id: int):
    |         ^^^
707 |         rule = ClassificationRule.query.get_or_404(rule_id)
708 |         payload = _parse_json_payload()
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/accounts_classifications.py:730:9
    |
728 |     @api_permission_required("delete")
729 |     @require_csrf
730 |     def delete(self, rule_id: int):
    |         ^^^^^^
731 |         rule = ClassificationRule.query.get_or_404(rule_id)
732 |         operator_id = getattr(current_user, "id", None)
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/accounts_classifications.py:748:7
    |
747 | @ns.route("/assignments")
748 | class AccountClassificationAssignmentsResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
749 |     method_decorators = [api_login_required, api_permission_required("view")]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/accounts_classifications.py:755:9
    |
753 |     @ns.response(403, "Forbidden", ErrorEnvelope)
754 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
755 |     def get(self):
    |         ^^^
756 |         def _execute():
757 |             assignments = _read_service.list_assignments()
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/accounts_classifications.py:773:7
    |
772 | @ns.route("/assignments/<int:assignment_id>")
773 | class AccountClassificationAssignmentResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
774 |     method_decorators = [api_login_required]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/accounts_classifications.py:783:9
    |
781 |     @api_permission_required("delete")
782 |     @require_csrf
783 |     def delete(self, assignment_id: int):
    |         ^^^^^^
784 |         assignment = AccountClassificationAssignment.query.get_or_404(assignment_id)
785 |         operator_id = getattr(current_user, "id", None)
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/accounts_classifications.py:801:7
    |
800 | @ns.route("/permissions/<string:db_type>")
801 | class AccountClassificationPermissionsResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
802 |     method_decorators = [api_login_required, api_permission_required("view")]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/accounts_classifications.py:808:9
    |
806 |     @ns.response(403, "Forbidden", ErrorEnvelope)
807 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
808 |     def get(self, db_type: str):
    |         ^^^
809 |         def _execute():
810 |             permissions = _read_service.get_permissions(db_type)
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/accounts_classifications.py:827:7
    |
826 | @ns.route("/actions/auto-classify")
827 | class AccountClassificationAutoClassifyActionResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
828 |     method_decorators = [api_login_required]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/accounts_classifications.py:838:9
    |
836 |     @api_permission_required("update")
837 |     @require_csrf
838 |     def post(self):
    |         ^^^^
839 |         payload_snapshot = _parse_json_payload()
840 |         created_by = current_user.id if current_user.is_authenticated else None
    |

D101 Missing docstring in public class
  --> app/api/v1/namespaces/admin.py:27:7
   |
26 | @ns.route("/app-info")
27 | class AdminAppInfoResource(BaseResource):
   |       ^^^^^^^^^^^^^^^^^^^^
28 |     @ns.response(200, "OK", AppInfoSuccessEnvelope)
29 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
   |

D102 Missing docstring in public method
  --> app/api/v1/namespaces/admin.py:30:9
   |
28 |     @ns.response(200, "OK", AppInfoSuccessEnvelope)
29 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
30 |     def get(self):
   |         ^^^
31 |         app_name = current_app.config.get("APP_NAME") or "鲸落"
32 |         app_version = current_app.config.get("APP_VERSION") or "unknown"
   |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/auth.py:122:7
    |
121 | @ns.route("/csrf-token")
122 | class CsrfTokenResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^
123 |     @ns.response(200, "OK", CsrfTokenSuccessEnvelope)
124 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/auth.py:125:9
    |
123 |     @ns.response(200, "OK", CsrfTokenSuccessEnvelope)
124 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
125 |     def get(self):
    |         ^^^
126 |         return self.success(
127 |             data={"csrf_token": generate_csrf()},
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/auth.py:133:7
    |
132 | @ns.route("/login")
133 | class LoginResource(BaseResource):
    |       ^^^^^^^^^^^^^
134 |     @ns.expect(LoginPayload, validate=False)
135 |     @ns.response(200, "OK", LoginSuccessEnvelope)
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/auth.py:143:9
    |
141 |     @login_rate_limit()
142 |     @require_csrf
143 |     def post(self):
    |         ^^^^
144 |         payload = _parse_payload()
145 |         username = (payload.get("username") or "").strip() if hasattr(payload, "get") else ""
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/auth.py:183:7
    |
182 | @ns.route("/logout")
183 | class LogoutResource(BaseResource):
    |       ^^^^^^^^^^^^^^
184 |     @ns.response(200, "OK", EmptySuccessEnvelope)
185 |     @ns.response(401, "Unauthorized", ErrorEnvelope)
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/auth.py:190:9
    |
188 |     @api_login_required
189 |     @require_csrf
190 |     def post(self):
    |         ^^^^
191 |         logout_user()
192 |         return self.success(message=SuccessMessages.LOGOUT_SUCCESS)
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/auth.py:196:7
    |
195 | @ns.route("/change-password")
196 | class ChangePasswordResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^
197 |     @ns.expect(ChangePasswordPayload, validate=False)
198 |     @ns.response(200, "OK", EmptySuccessEnvelope)
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/auth.py:207:9
    |
205 |     @password_reset_rate_limit()
206 |     @require_csrf
207 |     def post(self):
    |         ^^^^
208 |         payload = _parse_payload()
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/auth.py:224:7
    |
223 | @ns.route("/refresh")
224 | class RefreshResource(BaseResource):
    |       ^^^^^^^^^^^^^^^
225 |     @ns.response(200, "OK", RefreshSuccessEnvelope)
226 |     @ns.response(401, "Unauthorized", ErrorEnvelope)
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/auth.py:231:9
    |
229 |     @require_csrf
230 |     @jwt_required(refresh=True)
231 |     def post(self):
    |         ^^^^
232 |         def _execute():
233 |             current_user_id = get_jwt_identity()
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/auth.py:254:7
    |
253 | @ns.route("/me")
254 | class MeResource(BaseResource):
    |       ^^^^^^^^^^
255 |     @ns.response(200, "OK", MeSuccessEnvelope)
256 |     @ns.response(401, "Unauthorized", ErrorEnvelope)
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/auth.py:260:9
    |
258 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
259 |     @jwt_required()
260 |     def get(self):
    |         ^^^
261 |         current_user_id = get_jwt_identity()
262 |         try:
    |

D101 Missing docstring in public class
  --> app/api/v1/namespaces/cache.py:66:7
   |
65 | @ns.route("/stats")
66 | class CacheStatsResource(BaseResource):
   |       ^^^^^^^^^^^^^^^^^^
67 |     method_decorators = [api_login_required]
   |

D102 Missing docstring in public method
  --> app/api/v1/namespaces/cache.py:72:9
   |
70 |     @ns.response(401, "Unauthorized", ErrorEnvelope)
71 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
72 |     def get(self):
   |         ^^^
73 |         def _execute():
74 |             manager = _require_cache_service()
   |

D101 Missing docstring in public class
  --> app/api/v1/namespaces/cache.py:97:7
   |
96 | @ns.route("/clear/user")
97 | class CacheClearUserResource(BaseResource):
   |       ^^^^^^^^^^^^^^^^^^^^^^
98 |     method_decorators = [api_login_required, api_permission_required("admin")]
   |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/cache.py:109:9
    |
107 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
108 |     @require_csrf
109 |     def post(self):
    |         ^^^^
110 |         payload = request.get_json(silent=True) or {}
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/cache.py:155:7
    |
154 | @ns.route("/clear/instance")
155 | class CacheClearInstanceResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^
156 |     method_decorators = [api_login_required, api_permission_required("admin")]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/cache.py:167:9
    |
165 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
166 |     @require_csrf
167 |     def post(self):
    |         ^^^^
168 |         payload = request.get_json(silent=True) or {}
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/cache.py:203:7
    |
202 | @ns.route("/clear/all")
203 | class CacheClearAllResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^
204 |     method_decorators = [api_login_required, api_permission_required("admin")]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/cache.py:211:9
    |
209 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
210 |     @require_csrf
211 |     def post(self):
    |         ^^^^
212 |         def _execute():
213 |             manager = _require_cache_service()
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/cache.py:252:7
    |
251 | @ns.route("/classification/clear")
252 | class CacheClearClassificationResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
253 |     method_decorators = [api_login_required, api_permission_required("update")]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/cache.py:261:9
    |
259 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
260 |     @require_csrf
261 |     def post(self):
    |         ^^^^
262 |         def _execute():
263 |             result = AccountClassificationService().invalidate_cache()
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/cache.py:285:7
    |
284 | @ns.route("/classification/clear/<string:db_type>")
285 | class CacheClearDbTypeClassificationResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
286 |     method_decorators = [api_login_required, api_permission_required("update")]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/cache.py:295:9
    |
293 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
294 |     @require_csrf
295 |     def post(self, db_type: str):
    |         ^^^^
296 |         def _execute():
297 |             valid_db_types = {"mysql", "postgresql", "sqlserver", "oracle"}
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/cache.py:324:7
    |
323 | @ns.route("/classification/stats")
324 | class CacheClassificationStatsResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
325 |     method_decorators = [api_login_required, api_permission_required("view")]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/cache.py:331:9
    |
329 |     @ns.response(403, "Forbidden", ErrorEnvelope)
330 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
331 |     def get(self):
    |         ^^^
332 |         def _execute():
333 |             manager = _require_cache_service()
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/capacity.py:195:7
    |
194 | @ns.route("/aggregations/current")
195 | class CapacityCurrentAggregationResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
196 |     method_decorators = [api_login_required, api_permission_required("view")]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/capacity.py:205:9
    |
203 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
204 |     @require_csrf
205 |     def post(self):
    |         ^^^^
206 |         payload = request.get_json(silent=True) if request.is_json else None
207 |         payload_dict = payload if isinstance(payload, dict) else {}
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/capacity.py:236:7
    |
235 | @ns.route("/databases")
236 | class CapacityDatabasesAggregationsResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
237 |     method_decorators = [api_login_required, api_permission_required("view")]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/capacity.py:244:9
    |
242 |     @ns.response(403, "Forbidden", ErrorEnvelope)
243 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
244 |     def get(self):
    |         ^^^
245 |         query_params = request.args.to_dict(flat=False)
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/capacity.py:296:7
    |
295 | @ns.route("/databases/summary")
296 | class CapacityDatabasesSummaryResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
297 |     method_decorators = [api_login_required, api_permission_required("view")]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/capacity.py:304:9
    |
302 |     @ns.response(403, "Forbidden", ErrorEnvelope)
303 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
304 |     def get(self):
    |         ^^^
305 |         query_params = request.args.to_dict(flat=False)
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/capacity.py:340:7
    |
339 | @ns.route("/instances")
340 | class CapacityInstancesAggregationsResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
341 |     method_decorators = [api_login_required, api_permission_required("view")]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/capacity.py:348:9
    |
346 |     @ns.response(403, "Forbidden", ErrorEnvelope)
347 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
348 |     def get(self):
    |         ^^^
349 |         query_params = request.args.to_dict(flat=False)
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/capacity.py:395:7
    |
394 | @ns.route("/instances/summary")
395 | class CapacityInstancesSummaryResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
396 |     method_decorators = [api_login_required, api_permission_required("view")]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/capacity.py:403:9
    |
401 |     @ns.response(403, "Forbidden", ErrorEnvelope)
402 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
403 |     def get(self):
    |         ^^^
404 |         query_params = request.args.to_dict(flat=False)
    |

D101 Missing docstring in public class
  --> app/api/v1/namespaces/common.py:72:7
   |
71 | @ns.route("/instances/options")
72 | class CommonInstancesOptionsResource(BaseResource):
   |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
73 |     method_decorators = [api_login_required, api_permission_required("view")]
   |

D102 Missing docstring in public method
  --> app/api/v1/namespaces/common.py:80:9
   |
78 |     @ns.response(403, "Forbidden", ErrorEnvelope)
79 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
80 |     def get(self):
   |         ^^^
81 |         db_type = (request.args.get("db_type") or "").strip() or None
   |

D101 Missing docstring in public class
  --> app/api/v1/namespaces/common.py:98:7
   |
97 | @ns.route("/databases/options")
98 | class CommonDatabasesOptionsResource(BaseResource):
   |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
99 |     method_decorators = [api_login_required, api_permission_required("view")]
   |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/common.py:107:9
    |
105 |     @ns.response(404, "Not Found", ErrorEnvelope)
106 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
107 |     def get(self):
    |         ^^^
108 |         def _execute():
109 |             instance_id = request.args.get("instance_id", type=int)
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/common.py:143:7
    |
142 | @ns.route("/database-types/options")
143 | class CommonDatabaseTypesOptionsResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
144 |     method_decorators = [api_login_required, api_permission_required("view")]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/common.py:150:9
    |
148 |     @ns.response(403, "Forbidden", ErrorEnvelope)
149 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
150 |     def get(self):
    |         ^^^
151 |         def _execute():
152 |             result = FilterOptionsService().get_common_database_types_options()
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/connections.py:305:7
    |
304 | @ns.route("/actions/test")
305 | class ConnectionsTestResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^
306 |     method_decorators: ClassVar[list] = [api_login_required, api_permission_required("view")]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/connections.py:317:9
    |
315 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
316 |     @require_csrf
317 |     def post(self):
    |         ^^^^
318 |         data = _parse_payload()
319 |         if not data:
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/connections.py:350:7
    |
349 | @ns.route("/actions/validate-params")
350 | class ConnectionsValidateParamsResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
351 |     method_decorators: ClassVar[list] = [api_login_required, api_permission_required("view")]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/connections.py:361:9
    |
359 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
360 |     @require_csrf
361 |     def post(self):
    |         ^^^^
362 |         data = _parse_payload()
363 |         if not data:
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/connections.py:380:7
    |
379 | @ns.route("/actions/batch-test")
380 | class ConnectionsBatchTestResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
381 |     method_decorators: ClassVar[list] = [api_login_required, api_permission_required("view")]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/connections.py:390:9
    |
388 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
389 |     @require_csrf
390 |     def post(self):
    |         ^^^^
391 |         data = _parse_payload()
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/connections.py:431:7
    |
430 | @ns.route("/status/<int:instance_id>")
431 | class ConnectionsStatusResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^
432 |     method_decorators: ClassVar[list] = [api_login_required, api_permission_required("view")]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/connections.py:439:9
    |
437 |     @ns.response(404, "Not Found", ErrorEnvelope)
438 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
439 |     def get(self, instance_id: int):
    |         ^^^
440 |         def _execute():
441 |             payload = InstanceConnectionStatusService().get_status(instance_id)
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/credentials.py:154:7
    |
153 | @ns.route("")
154 | class CredentialsResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^
155 |     method_decorators = [api_login_required]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/credentials.py:162:9
    |
160 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
161 |     @api_permission_required("view")
162 |     def get(self):
    |         ^^^
163 |         filters = _build_filters(allow_sort=True)
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/credentials.py:205:9
    |
203 |     @api_permission_required("create")
204 |     @require_csrf
205 |     def post(self):
    |         ^^^^
206 |         payload = _parse_payload()
207 |         operator_id = getattr(current_user, "id", None)
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/credentials.py:227:7
    |
226 | @ns.route("/<int:credential_id>")
227 | class CredentialDetailResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^
228 |     method_decorators = [api_login_required]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/credentials.py:236:9
    |
234 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
235 |     @api_permission_required("view")
236 |     def get(self, credential_id: int):
    |         ^^^
237 |         def _execute():
238 |             credential = CredentialsRepository().get_by_id(credential_id)
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/credentials.py:264:9
    |
262 |     @api_permission_required("update")
263 |     @require_csrf
264 |     def put(self, credential_id: int):
    |         ^^^
265 |         payload = _parse_payload()
266 |         operator_id = getattr(current_user, "id", None)
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/credentials.py:285:7
    |
284 | @ns.route("/<int:credential_id>/delete")
285 | class CredentialDeleteResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^
286 |     method_decorators = [api_login_required]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/credentials.py:295:9
    |
293 |     @api_permission_required("delete")
294 |     @require_csrf
295 |     def post(self, credential_id: int):
    |         ^^^^
296 |         operator_id = getattr(current_user, "id", None)
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/dashboard.py:217:7
    |
216 | @ns.route("/overview")
217 | class DashboardOverviewResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^
218 |     method_decorators = [api_login_required]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/dashboard.py:223:9
    |
221 |     @ns.response(401, "Unauthorized", ErrorEnvelope)
222 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
223 |     def get(self):
    |         ^^^
224 |         def _execute():
225 |             overview = get_system_overview()
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/dashboard.py:240:7
    |
239 | @ns.route("/charts")
240 | class DashboardChartsResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^
241 |     method_decorators = [api_login_required]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/dashboard.py:246:9
    |
244 |     @ns.response(401, "Unauthorized", ErrorEnvelope)
245 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
246 |     def get(self):
    |         ^^^
247 |         chart_type = request.args.get("type", "all", type=str)
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/dashboard.py:268:7
    |
267 | @ns.route("/activities")
268 | class DashboardActivitiesResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
269 |     method_decorators = [api_login_required]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/dashboard.py:274:9
    |
272 |     @ns.response(401, "Unauthorized", ErrorEnvelope)
273 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
274 |     def get(self):
    |         ^^^
275 |         def _execute():
276 |             return self.success(data=[], message=SuccessMessages.OPERATION_SUCCESS)
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/dashboard.py:287:7
    |
286 | @ns.route("/status")
287 | class DashboardStatusResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^
288 |     method_decorators = [api_login_required]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/dashboard.py:293:9
    |
291 |     @ns.response(401, "Unauthorized", ErrorEnvelope)
292 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
293 |     def get(self):
    |         ^^^
294 |         def _execute():
295 |             status = get_system_status()
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/databases.py:127:7
    |
126 | @ns.route("/ledgers")
127 | class DatabaseLedgersResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^
128 |     method_decorators = [api_login_required, api_permission_required("database_ledger.view")]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/databases.py:134:9
    |
132 |     @ns.response(403, "Forbidden", ErrorEnvelope)
133 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
134 |     def get(self):
    |         ^^^
135 |         search = (request.args.get("search") or "").strip()
136 |         db_type = request.args.get("db_type", "all")
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/databases.py:181:7
    |
180 | @ns.route("/ledgers/<int:database_id>/capacity-trend")
181 | class DatabaseLedgerCapacityTrendResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
182 |     method_decorators = [api_login_required, api_permission_required("database_ledger.view")]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/databases.py:189:9
    |
187 |     @ns.response(404, "Not Found", ErrorEnvelope)
188 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
189 |     def get(self, database_id: int):
    |         ^^^
190 |         days = request.args.get("days", DatabaseLedgerService.DEFAULT_TREND_DAYS, type=int)
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/files.py:130:7
    |
129 | @ns.route("/account-export")
130 | class FilesAccountExportResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^
131 |     method_decorators = [api_login_required]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/files.py:138:9
    |
136 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
137 |     @api_permission_required("view")
138 |     def get(self):
    |         ^^^
139 |         filters = _parse_account_export_filters()
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/files.py:163:7
    |
162 | @ns.route("/instance-export")
163 | class FilesInstanceExportResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
164 |     method_decorators = [api_login_required]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/files.py:171:9
    |
169 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
170 |     @api_permission_required("view")
171 |     def get(self):
    |         ^^^
172 |         search = request.args.get("search", "", type=str)
173 |         db_type = request.args.get("db_type", "", type=str)
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/files.py:193:7
    |
192 | @ns.route("/database-ledger-export")
193 | class FilesDatabaseLedgerExportResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
194 |     method_decorators = [api_login_required]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/files.py:201:9
    |
199 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
200 |     @api_permission_required("database_ledger.view")
201 |     def get(self):
    |         ^^^
202 |         search = (request.args.get("search", "", type=str) or "").strip()
203 |         db_type = request.args.get("db_type", "all", type=str)
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/files.py:272:7
    |
271 | @ns.route("/log-export")
272 | class FilesLogsExportResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^
273 |     method_decorators = [api_admin_required]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/files.py:280:9
    |
278 |     @ns.response(403, "Forbidden", ErrorEnvelope)
279 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
280 |     def get(self):
    |         ^^^
281 |         format_type = request.args.get("format", "json")
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/files.py:304:7
    |
303 | @ns.route("/template-download")
304 | class FilesTemplateDownloadResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
305 |     method_decorators = [api_login_required]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/files.py:312:9
    |
310 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
311 |     @api_permission_required("view")
312 |     def get(self):
    |         ^^^
313 |         def _execute() -> Response:
314 |             output = io.StringIO()
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/health.py:107:7
    |
106 | @ns.route("/ping")
107 | class HealthPingResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^
108 |     @ns.response(200, "OK", PingSuccessEnvelope)
109 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/health.py:110:9
    |
108 |     @ns.response(200, "OK", PingSuccessEnvelope)
109 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
110 |     def get(self):
    |         ^^^
111 |         return self.success({"status": "ok"}, message="健康检查成功")
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/health.py:115:7
    |
114 | @ns.route("/basic")
115 | class HealthBasicResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^
116 |     @ns.response(200, "OK", BasicSuccessEnvelope)
117 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/health.py:118:9
    |
116 |     @ns.response(200, "OK", BasicSuccessEnvelope)
117 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
118 |     def get(self):
    |         ^^^
119 |         return self.safe_call(
120 |             lambda: self.success(
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/health.py:131:7
    |
130 | @ns.route("/health")
131 | class HealthCheckResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^
132 |     @ns.response(200, "OK", HealthSuccessEnvelope)
133 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/health.py:134:9
    |
132 |     @ns.response(200, "OK", HealthSuccessEnvelope)
133 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
134 |     def get(self):
    |         ^^^
135 |         def _execute():
136 |             start_time = time.time()
    |

D103 Missing docstring in public function
   --> app/api/v1/namespaces/health.py:178:5
    |
178 | def check_database_health() -> dict[str, object]:
    |     ^^^^^^^^^^^^^^^^^^^^^
179 |     try:
180 |         HealthRepository.ping_database()
    |

D103 Missing docstring in public function
   --> app/api/v1/namespaces/health.py:186:5
    |
186 | def check_cache_health() -> dict[str, object]:
    |     ^^^^^^^^^^^^^^^^^^
187 |     manager = _get_cache_service()
188 |     try:
    |

D103 Missing docstring in public function
   --> app/api/v1/namespaces/health.py:195:5
    |
195 | def check_system_health() -> dict[str, object]:
    |     ^^^^^^^^^^^^^^^^^^^
196 |     return {"healthy": True, "status": "ok"}
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/health.py:200:7
    |
199 | @ns.route("/cache")
200 | class HealthCacheResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^
201 |     method_decorators = [api_login_required]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/health.py:206:9
    |
204 |     @ns.response(401, "Unauthorized", ErrorEnvelope)
205 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
206 |     def get(self):
    |         ^^^
207 |         def _execute():
208 |             result = check_cache_health()
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/health.py:223:7
    |
222 | @ns.route("/detailed")
223 | class HealthDetailedResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^
224 |     @ns.response(200, "OK", HealthDetailedSuccessEnvelope)
225 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/health.py:226:9
    |
224 |     @ns.response(200, "OK", HealthDetailedSuccessEnvelope)
225 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
226 |     def get(self):
    |         ^^^
227 |         def _execute():
228 |             components = {
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/history_logs.py:148:7
    |
147 | @ns.route("/list")
148 | class HistoryLogsListResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^
149 |     method_decorators = [api_login_required, api_permission_required("admin")]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/history_logs.py:156:9
    |
154 |     @ns.response(403, "Forbidden", ErrorEnvelope)
155 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
156 |     def get(self):
    |         ^^^
157 |         def _execute():
158 |             filters = _extract_log_search_filters(request.args)
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/history_logs.py:183:7
    |
182 | @ns.route("/search")
183 | class HistoryLogsSearchResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^
184 |     method_decorators = [api_login_required, api_permission_required("admin")]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/history_logs.py:191:9
    |
189 |     @ns.response(403, "Forbidden", ErrorEnvelope)
190 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
191 |     def get(self):
    |         ^^^
192 |         def _execute():
193 |             filters = _extract_log_search_filters(request.args)
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/history_logs.py:218:7
    |
217 | @ns.route("/statistics")
218 | class HistoryLogStatisticsResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
219 |     method_decorators = [api_login_required, api_permission_required("admin")]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/history_logs.py:225:9
    |
223 |     @ns.response(403, "Forbidden", ErrorEnvelope)
224 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
225 |     def get(self):
    |         ^^^
226 |         def _execute():
227 |             hours = resolve_page_size(  # reuse for integer parsing with caps
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/history_logs.py:255:7
    |
254 | @ns.route("/modules")
255 | class HistoryLogModulesResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^
256 |     method_decorators = [api_login_required, api_permission_required("admin")]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/history_logs.py:262:9
    |
260 |     @ns.response(403, "Forbidden", ErrorEnvelope)
261 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
262 |     def get(self):
    |         ^^^
263 |         def _execute():
264 |             modules = HistoryLogsExtrasService().list_modules()
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/history_logs.py:278:7
    |
277 | @ns.route("/detail/<int:log_id>")
278 | class HistoryLogDetailResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^
279 |     method_decorators = [api_login_required, api_permission_required("admin")]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/history_logs.py:286:9
    |
284 |     @ns.response(404, "Not Found", ErrorEnvelope)
285 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
286 |     def get(self, log_id: int):
    |         ^^^
287 |         def _execute():
288 |             log_entry = HistoryLogsExtrasService().get_log_detail(log_id)
    |

D101 Missing docstring in public class
  --> app/api/v1/namespaces/history_sessions.py:50:7
   |
49 | @ns.route("")
50 | class HistorySessionsListResource(BaseResource):
   |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
51 |     method_decorators = [api_login_required, api_permission_required("view")]
   |

D102 Missing docstring in public method
  --> app/api/v1/namespaces/history_sessions.py:57:9
   |
55 |     @ns.response(403, "Forbidden", ErrorEnvelope)
56 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
57 |     def get(self):
   |         ^^^
58 |         sync_type = (request.args.get("sync_type", "") or "").strip()
59 |         sync_category = (request.args.get("sync_category", "") or "").strip()
   |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/history_sessions.py:106:7
    |
105 | @ns.route("/<string:session_id>")
106 | class HistorySessionDetailResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
107 |     method_decorators = [api_login_required, api_permission_required("view")]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/history_sessions.py:114:9
    |
112 |     @ns.response(404, "Not Found", ErrorEnvelope)
113 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
114 |     def get(self, session_id: str):
    |         ^^^
115 |         def _execute():
116 |             result = HistorySessionsReadService().get_session_detail(session_id)
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/history_sessions.py:131:7
    |
130 | @ns.route("/<string:session_id>/error-logs")
131 | class HistorySessionErrorLogsResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
132 |     method_decorators = [api_login_required, api_permission_required("view")]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/history_sessions.py:139:9
    |
137 |     @ns.response(404, "Not Found", ErrorEnvelope)
138 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
139 |     def get(self, session_id: str):
    |         ^^^
140 |         def _execute():
141 |             result = HistorySessionsReadService().get_session_error_logs(session_id)
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/history_sessions.py:156:7
    |
155 | @ns.route("/<string:session_id>/cancel")
156 | class HistorySessionCancelResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
157 |     method_decorators = [api_login_required, api_permission_required("view")]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/history_sessions.py:165:9
    |
163 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
164 |     @require_csrf
165 |     def post(self, session_id: str):
    |         ^^^^
166 |         def _execute():
167 |             success = sync_session_service.cancel_session(session_id)
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/instances.py:433:7
    |
432 | @ns.route("")
433 | class InstancesResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^
434 |     method_decorators = [api_login_required]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/instances.py:441:9
    |
439 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
440 |     @api_permission_required("view")
441 |     def get(self):
    |         ^^^
442 |         def _execute():
443 |             filters = _parse_instance_filters()
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/instances.py:477:9
    |
475 |     @api_permission_required("create")
476 |     @require_csrf
477 |     def post(self):
    |         ^^^^
478 |         payload = _parse_payload()
479 |         operator_id = getattr(current_user, "id", None)
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/instances.py:512:7
    |
511 | @ns.route("/<int:instance_id>")
512 | class InstanceDetailResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^
513 |     method_decorators = [api_login_required]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/instances.py:520:9
    |
518 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
519 |     @api_permission_required("view")
520 |     def get(self, instance_id: int):
    |         ^^^
521 |         def _execute():
522 |             instance = InstanceDetailReadService().get_active_instance(instance_id)
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/instances.py:544:9
    |
542 |     @api_permission_required("update")
543 |     @require_csrf
544 |     def put(self, instance_id: int):
    |         ^^^
545 |         payload = _parse_payload()
546 |         operator_id = getattr(current_user, "id", None)
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/instances.py:565:7
    |
564 | @ns.route("/<int:instance_id>/actions/sync-capacity")
565 | class InstanceSyncCapacityActionResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
566 |     method_decorators = [api_login_required, api_permission_required("instance_management.instance_list.sync_capacity")]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/instances.py:575:9
    |
573 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
574 |     @require_csrf
575 |     def post(self, instance_id: int):
    |         ^^^^
576 |         def _execute():
577 |             instance = Instance.query.filter_by(id=instance_id).first()
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/instances.py:666:7
    |
665 | @ns.route("/<int:instance_id>/delete")
666 | class InstanceDeleteResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^
667 |     method_decorators = [api_login_required]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/instances.py:676:9
    |
674 |     @api_permission_required("delete")
675 |     @require_csrf
676 |     def post(self, instance_id: int):
    |         ^^^^
677 |         operator_id = getattr(current_user, "id", None)
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/instances.py:701:7
    |
700 | @ns.route("/<int:instance_id>/restore")
701 | class InstanceRestoreResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^
702 |     method_decorators = [api_login_required]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/instances.py:711:9
    |
709 |     @api_permission_required("update")
710 |     @require_csrf
711 |     def post(self, instance_id: int):
    |         ^^^^
712 |         operator_id = getattr(current_user, "id", None)
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/instances.py:737:7
    |
736 | @ns.route("/<int:instance_id>/accounts")
737 | class InstanceAccountsResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^
738 |     method_decorators = [api_login_required]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/instances.py:746:9
    |
744 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
745 |     @api_permission_required("view")
746 |     def get(self, instance_id: int):
    |         ^^^
747 |         filters = _parse_account_list_filters(instance_id)
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/instances.py:784:7
    |
783 | @ns.route("/<int:instance_id>/accounts/<int:account_id>/permissions")
784 | class InstanceAccountPermissionsResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
785 |     method_decorators = [api_login_required]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/instances.py:793:9
    |
791 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
792 |     @api_permission_required("view")
793 |     def get(self, instance_id: int, account_id: int):
    |         ^^^
794 |         def _execute():
795 |             result = InstanceAccountsService().get_account_permissions(instance_id, account_id)
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/instances.py:812:7
    |
811 | @ns.route("/<int:instance_id>/accounts/<int:account_id>/change-history")
812 | class InstanceAccountChangeHistoryResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
813 |     method_decorators = [api_login_required]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/instances.py:821:9
    |
819 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
820 |     @api_permission_required("view")
821 |     def get(self, instance_id: int, account_id: int):
    |         ^^^
822 |         def _execute():
823 |             result = InstanceAccountsService().get_change_history(instance_id, account_id)
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/instances.py:840:7
    |
839 | @ns.route("/<int:instance_id>/databases/sizes")
840 | class InstanceDatabaseSizesResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
841 |     method_decorators = [api_login_required]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/instances.py:850:9
    |
848 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
849 |     @api_permission_required("view")
850 |     def get(self, instance_id: int):
    |         ^^^
851 |         query_snapshot = request.args.to_dict(flat=False)
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/instances.py:924:7
    |
923 | @ns.route("/batch-create")
924 | class InstancesBatchCreateResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
925 |     method_decorators = [api_login_required]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/instances.py:934:9
    |
932 |     @api_permission_required("create")
933 |     @require_csrf
934 |     def post(self):
    |         ^^^^
935 |         uploaded_file = request.files.get("file")
936 |         operator_id = getattr(current_user, "id", None)
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/instances.py:968:7
    |
967 | @ns.route("/batch-delete")
968 | class InstancesBatchDeleteResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
969 |     method_decorators = [api_login_required]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/instances.py:979:9
    |
977 |     @api_permission_required("delete")
978 |     @require_csrf
979 |     def post(self):
    |         ^^^^
980 |         payload = request.get_json(silent=True) or {}
981 |         operator_id = getattr(current_user, "id", None)
    |

D101 Missing docstring in public class
    --> app/api/v1/namespaces/instances.py:1012:7
     |
1011 | @ns.route("/statistics")
1012 | class InstancesStatisticsResource(BaseResource):
     |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
1013 |     method_decorators = [api_login_required]
     |

D102 Missing docstring in public method
    --> app/api/v1/namespaces/instances.py:1020:9
     |
1018 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
1019 |     @api_permission_required("view")
1020 |     def get(self):
     |         ^^^
1021 |         def _execute():
1022 |             return self.success(
     |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/partition.py:116:7
    |
115 | @ns.route("/info")
116 | class PartitionInfoResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^
117 |     method_decorators = [api_login_required, api_permission_required("view")]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/partition.py:123:9
    |
121 |     @ns.response(403, "Forbidden", ErrorEnvelope)
122 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
123 |     def get(self):
    |         ^^^
124 |         def _execute():
125 |             log_info("开始获取分区信息", module="partition", user_id=getattr(current_user, "id", None))
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/partition.py:143:7
    |
142 | @ns.route("/status")
143 | class PartitionStatusResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^
144 |     method_decorators = [api_login_required, api_permission_required("view")]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/partition.py:150:9
    |
148 |     @ns.response(403, "Forbidden", ErrorEnvelope)
149 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
150 |     def get(self):
    |         ^^^
151 |         def _execute():
152 |             snapshot = _partition_read_service.get_partition_status_snapshot()
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/partition.py:177:7
    |
176 | @ns.route("/partitions")
177 | class PartitionsListResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^
178 |     method_decorators = [api_login_required, api_permission_required("view")]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/partition.py:184:9
    |
182 |     @ns.response(403, "Forbidden", ErrorEnvelope)
183 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
184 |     def get(self):
    |         ^^^
185 |         search_term = request.args.get("search", "", type=str) or ""
186 |         table_type = request.args.get("table_type", "", type=str) or ""
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/partition.py:253:7
    |
252 | @ns.route("/create")
253 | class PartitionCreateResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^
254 |     method_decorators = [api_login_required, api_permission_required("admin")]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/partition.py:263:9
    |
261 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
262 |     @require_csrf
263 |     def post(self):
    |         ^^^^
264 |         data = request.get_json(silent=True) or {}
265 |         partition_date_str = data.get("date")
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/partition.py:314:7
    |
313 | @ns.route("/cleanup")
314 | class PartitionCleanupResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^
315 |     method_decorators = [api_login_required, api_permission_required("admin")]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/partition.py:324:9
    |
322 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
323 |     @require_csrf
324 |     def post(self):
    |         ^^^^
325 |         data = request.get_json(silent=True) or {}
326 |         raw_retention = data.get("retention_months", 12)
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/partition.py:356:7
    |
355 | @ns.route("/statistics")
356 | class PartitionStatisticsResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
357 |     method_decorators = [api_login_required, api_permission_required("view")]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/partition.py:363:9
    |
361 |     @ns.response(403, "Forbidden", ErrorEnvelope)
362 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
363 |     def get(self):
    |         ^^^
364 |         def _execute():
365 |             result = PartitionStatisticsService().get_partition_statistics()
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/partition.py:379:7
    |
378 | @ns.route("/aggregations/core-metrics")
379 | class PartitionCoreMetricsResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
380 |     method_decorators = [api_login_required, api_permission_required("view")]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/partition.py:387:9
    |
385 |     @ns.response(403, "Forbidden", ErrorEnvelope)
386 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
387 |     def get(self):
    |         ^^^
388 |         requested_period_type = (request.args.get("period_type") or "daily").lower()
389 |         requested_days = request.args.get("days", 7, type=int)
    |

D101 Missing docstring in public class
  --> app/api/v1/namespaces/scheduler.py:79:7
   |
78 | @ns.route("/jobs")
79 | class SchedulerJobsResource(BaseResource):
   |       ^^^^^^^^^^^^^^^^^^^^^
80 |     method_decorators = [api_login_required, api_permission_required("scheduler.view")]
   |

D102 Missing docstring in public method
  --> app/api/v1/namespaces/scheduler.py:87:9
   |
85 |     @ns.response(409, "Conflict", ErrorEnvelope)
86 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
87 |     def get(self):
   |         ^^^
88 |         def _execute():
89 |             jobs = SchedulerJobsReadService().list_jobs()
   |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/scheduler.py:105:7
    |
104 | @ns.route("/jobs/<string:job_id>")
105 | class SchedulerJobDetailResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^
106 |     method_decorators = [api_login_required]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/scheduler.py:115:9
    |
113 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
114 |     @api_permission_required("scheduler.view")
115 |     def get(self, job_id: str):
    |         ^^^
116 |         def _execute():
117 |             job = SchedulerJobsReadService().get_job(job_id)
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/scheduler.py:140:9
    |
138 |     @api_permission_required("scheduler.manage")
139 |     @require_csrf
140 |     def put(self, job_id: str):
    |         ^^^
141 |         payload = request.get_json(silent=True) or {}
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/scheduler.py:159:7
    |
158 | @ns.route("/jobs/<string:job_id>/pause")
159 | class SchedulerJobPauseResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^
160 |     method_decorators = [api_login_required, api_permission_required("scheduler.manage")]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/scheduler.py:168:9
    |
166 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
167 |     @require_csrf
168 |     def post(self, job_id: str):
    |         ^^^^
169 |         def _execute():
170 |             scheduler = _ensure_scheduler_running()
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/scheduler.py:186:7
    |
185 | @ns.route("/jobs/<string:job_id>/resume")
186 | class SchedulerJobResumeResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^
187 |     method_decorators = [api_login_required, api_permission_required("scheduler.manage")]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/scheduler.py:195:9
    |
193 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
194 |     @require_csrf
195 |     def post(self, job_id: str):
    |         ^^^^
196 |         def _execute():
197 |             scheduler = _ensure_scheduler_running()
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/scheduler.py:213:7
    |
212 | @ns.route("/jobs/<string:job_id>/run")
213 | class SchedulerJobRunResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^
214 |     method_decorators = [api_login_required, api_permission_required("scheduler.manage")]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/scheduler.py:223:9
    |
221 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
222 |     @require_csrf
223 |     def post(self, job_id: str):
    |         ^^^^
224 |         def _execute():
225 |             scheduler = _ensure_scheduler_running()
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/scheduler.py:286:7
    |
285 | @ns.route("/jobs/reload")
286 | class SchedulerJobsReloadResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
287 |     method_decorators = [api_login_required, api_permission_required("scheduler.manage")]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/scheduler.py:295:9
    |
293 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
294 |     @require_csrf
295 |     def post(self):
    |         ^^^^
296 |         def _execute():
297 |             scheduler = _ensure_scheduler_running()
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/tags.py:160:7
    |
159 | @ns.route("")
160 | class TagsResource(BaseResource):
    |       ^^^^^^^^^^^^
161 |     method_decorators = [api_login_required]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/tags.py:168:9
    |
166 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
167 |     @api_permission_required("view")
168 |     def get(self):
    |         ^^^
169 |         def _execute():
170 |             filters = _build_tag_list_filters()
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/tags.py:204:9
    |
202 |     @api_permission_required("create")
203 |     @require_csrf
204 |     def post(self):
    |         ^^^^
205 |         payload = _parse_payload()
206 |         operator_id = getattr(current_user, "id", None)
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/tags.py:226:7
    |
225 | @ns.route("/options")
226 | class TagOptionsResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^
227 |     method_decorators = [api_login_required, api_permission_required("view")]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/tags.py:233:9
    |
231 |     @ns.response(403, "Forbidden", ErrorEnvelope)
232 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
233 |     def get(self):
    |         ^^^
234 |         category = request.args.get("category", "", type=str)
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/tags.py:256:7
    |
255 | @ns.route("/categories")
256 | class TagCategoriesResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^
257 |     method_decorators = [api_login_required, api_permission_required("view")]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/tags.py:263:9
    |
261 |     @ns.response(403, "Forbidden", ErrorEnvelope)
262 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
263 |     def get(self):
    |         ^^^
264 |         def _execute():
265 |             categories = TagOptionsService().list_categories()
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/tags.py:278:7
    |
277 | @ns.route("/by-name/<string:tag_name>")
278 | class TagByNameResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^
279 |     method_decorators = [api_login_required]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/tags.py:287:9
    |
285 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
286 |     @api_permission_required("view")
287 |     def get(self, tag_name: str):
    |         ^^^
288 |         def _execute():
289 |             tag = Tag.get_tag_by_name(tag_name)
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/tags.py:308:7
    |
307 | @ns.route("/<int:tag_id>")
308 | class TagDetailResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^
309 |     method_decorators = [api_login_required]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/tags.py:317:9
    |
315 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
316 |     @api_permission_required("view")
317 |     def get(self, tag_id: int):
    |         ^^^
318 |         def _execute():
319 |             tag = Tag.query.get_or_404(tag_id)
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/tags.py:342:9
    |
340 |     @api_permission_required("update")
341 |     @require_csrf
342 |     def put(self, tag_id: int):
    |         ^^^
343 |         payload = _parse_payload()
344 |         operator_id = getattr(current_user, "id", None)
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/tags.py:363:7
    |
362 | @ns.route("/<int:tag_id>/delete")
363 | class TagDeleteResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^
364 |     method_decorators = [api_login_required]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/tags.py:374:9
    |
372 |     @api_permission_required("delete")
373 |     @require_csrf
374 |     def post(self, tag_id: int):
    |         ^^^^
375 |         operator_id = getattr(current_user, "id", None)
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/tags.py:401:7
    |
400 | @ns.route("/batch-delete")
401 | class TagBatchDeleteResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^
402 |     method_decorators = [api_login_required]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/tags.py:413:9
    |
411 |     @api_permission_required("delete")
412 |     @require_csrf
413 |     def post(self):
    |         ^^^^
414 |         payload = request.get_json(silent=True) or {}
415 |         operator_id = getattr(current_user, "id", None)
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/tags_bulk.py:116:7
    |
115 | @ns.route("/instances")
116 | class TagsBulkInstancesResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^
117 |     method_decorators = [api_login_required, api_permission_required("view")]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/tags_bulk.py:123:9
    |
121 |     @ns.response(403, "Forbidden", ErrorEnvelope)
122 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
123 |     def get(self):
    |         ^^^
124 |         def _execute():
125 |             result = TagOptionsService().list_taggable_instances()
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/tags_bulk.py:139:7
    |
138 | @ns.route("/tags")
139 | class TagsBulkTagsResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^
140 |     method_decorators = [api_login_required, api_permission_required("view")]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/tags_bulk.py:146:9
    |
144 |     @ns.response(403, "Forbidden", ErrorEnvelope)
145 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
146 |     def get(self):
    |         ^^^
147 |         def _execute():
148 |             result = TagOptionsService().list_all_tags()
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/tags_bulk.py:168:7
    |
167 | @ns.route("/assign")
168 | class TagsBulkAssignResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^
169 |     method_decorators = [api_login_required, api_permission_required("create")]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/tags_bulk.py:179:9
    |
177 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
178 |     @require_csrf
179 |     def post(self):
    |         ^^^^
180 |         payload = request.get_json(silent=True) or {}
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/tags_bulk.py:248:7
    |
247 | @ns.route("/remove")
248 | class TagsBulkRemoveResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^
249 |     method_decorators = [api_login_required, api_permission_required("create")]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/tags_bulk.py:259:9
    |
257 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
258 |     @require_csrf
259 |     def post(self):
    |         ^^^^
260 |         payload = request.get_json(silent=True) or {}
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/tags_bulk.py:318:7
    |
317 | @ns.route("/instance-tags")
318 | class TagsBulkInstanceTagsResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
319 |     method_decorators = [api_login_required, api_permission_required("view")]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/tags_bulk.py:329:9
    |
327 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
328 |     @require_csrf
329 |     def post(self):
    |         ^^^^
330 |         data = request.get_json(silent=True) or {}
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/tags_bulk.py:371:7
    |
370 | @ns.route("/remove-all")
371 | class TagsBulkRemoveAllResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^
372 |     method_decorators = [api_login_required, api_permission_required("create")]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/tags_bulk.py:382:9
    |
380 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
381 |     @require_csrf
382 |     def post(self):
    |         ^^^^
383 |         payload = request.get_json(silent=True) or {}
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/users.py:148:7
    |
147 | @ns.route("")
148 | class UsersResource(BaseResource):
    |       ^^^^^^^^^^^^^
149 |     method_decorators = [api_login_required]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/users.py:156:9
    |
154 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
155 |     @api_permission_required("view")
156 |     def get(self):
    |         ^^^
157 |         filters = _parse_user_list_filters()
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/users.py:198:9
    |
196 |     @api_permission_required("create")
197 |     @require_csrf
198 |     def post(self):
    |         ^^^^
199 |         payload = _parse_payload()
200 |         sanitized = scrub_sensitive_fields(payload)
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/users.py:227:7
    |
226 | @ns.route("/<int:user_id>")
227 | class UserDetailResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^
228 |     method_decorators = [api_login_required]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/users.py:236:9
    |
234 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
235 |     @api_permission_required("view")
236 |     def get(self, user_id: int):
    |         ^^^
237 |         def _execute():
238 |             data = _get_user_or_error(user_id)
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/users.py:260:9
    |
258 |     @api_permission_required("update")
259 |     @require_csrf
260 |     def put(self, user_id: int):
    |         ^^^
261 |         payload = _parse_payload()
262 |         sanitized = scrub_sensitive_fields(payload)
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/users.py:294:9
    |
292 |     @api_permission_required("delete")
293 |     @require_csrf
294 |     def delete(self, user_id: int):
    |         ^^^^^^
295 |         def _execute():
296 |             UserWriteService().delete(user_id, operator_id=current_user.id)
    |

D101 Missing docstring in public class
   --> app/api/v1/namespaces/users.py:309:7
    |
308 | @ns.route("/stats")
309 | class UsersStatsResource(BaseResource):
    |       ^^^^^^^^^^^^^^^^^^
310 |     method_decorators = [api_login_required]
    |

D102 Missing docstring in public method
   --> app/api/v1/namespaces/users.py:317:9
    |
315 |     @ns.response(500, "Internal Server Error", ErrorEnvelope)
316 |     @api_permission_required("view")
317 |     def get(self):
    |         ^^^
318 |         def _execute():
319 |             data = UsersStatsService().get_stats()
    |

D102 Missing docstring in public method
  --> app/api/v1/resources/base.py:25:9
   |
23 |     """统一封套与 safe_route_call 适配."""
24 |
25 |     def success(
   |         ^^^^^^^
26 |         self,
27 |         data: object | None = None,
   |

D102 Missing docstring in public method
  --> app/api/v1/resources/base.py:35:9
   |
33 |         return unified_success_response(data=data, message=message, status=status, meta=meta)
34 |
35 |     def error_message(
   |         ^^^^^^^^^^^^^
36 |         self,
37 |         message: str,
   |

D102 Missing docstring in public method
  --> app/api/v1/resources/base.py:56:9
   |
54 |         return response
55 |
56 |     def safe_call(
   |         ^^^^^^^^^
57 |         self,
58 |         func: Callable[[], R],
   |

D102 Missing docstring in public method
  --> app/forms/definitions/base.py:73:9
   |
71 |     """
72 |
73 |     def load(self, resource_id: ResourceIdentifier) -> ResourceModelT | None: ...
   |         ^^^^
74 |
75 |     def upsert(self, payload: ResourcePayload, resource: ResourceModelT | None = None) -> ResourceModelT: ...
   |

D102 Missing docstring in public method
  --> app/forms/definitions/base.py:75:9
   |
73 |     def load(self, resource_id: ResourceIdentifier) -> ResourceModelT | None: ...
74 |
75 |     def upsert(self, payload: ResourcePayload, resource: ResourceModelT | None = None) -> ResourceModelT: ...
   |         ^^^^^^
76 |
77 |     def build_context(self, *, resource: ResourceModelT | None) -> ResourceContext: ...
   |

D102 Missing docstring in public method
  --> app/forms/definitions/base.py:77:9
   |
75 |     def upsert(self, payload: ResourcePayload, resource: ResourceModelT | None = None) -> ResourceModelT: ...
76 |
77 |     def build_context(self, *, resource: ResourceModelT | None) -> ResourceContext: ...
   |         ^^^^^^^^^^^^^
   |

D107 Missing docstring in `__init__`
  --> app/forms/handlers/account_classification_form_handler.py:18:9
   |
16 |     """账户分类表单处理器."""
17 |
18 |     def __init__(self, service: AccountClassificationsWriteService | None = None) -> None:
   |         ^^^^^^^^
19 |         self._service = service or AccountClassificationsWriteService()
   |

D102 Missing docstring in public method
  --> app/forms/handlers/account_classification_form_handler.py:21:9
   |
19 |         self._service = service or AccountClassificationsWriteService()
20 |
21 |     def load(self, resource_id: ResourceIdentifier) -> AccountClassification | None:
   |         ^^^^
22 |         if not isinstance(resource_id, int):
23 |             return None
   |

D102 Missing docstring in public method
  --> app/forms/handlers/account_classification_form_handler.py:26:9
   |
24 |         return cast("AccountClassification | None", AccountClassification.query.get(resource_id))
25 |
26 |     def upsert(
   |         ^^^^^^
27 |         self,
28 |         payload: ResourcePayload,
   |

D102 Missing docstring in public method
  --> app/forms/handlers/account_classification_form_handler.py:36:9
   |
34 |         return self._service.update_classification(resource, sanitized)
35 |
36 |     def build_context(self, *, resource: AccountClassification | None) -> ResourceContext:
   |         ^^^^^^^^^^^^^
37 |         del resource
38 |         color_options = [
   |

D107 Missing docstring in `__init__`
  --> app/forms/handlers/account_classification_rule_form_handler.py:18:9
   |
16 |     """账户分类规则表单处理器."""
17 |
18 |     def __init__(self, service: AccountClassificationsWriteService | None = None) -> None:
   |         ^^^^^^^^
19 |         self._service = service or AccountClassificationsWriteService()
   |

D102 Missing docstring in public method
  --> app/forms/handlers/account_classification_rule_form_handler.py:21:9
   |
19 |         self._service = service or AccountClassificationsWriteService()
20 |
21 |     def load(self, resource_id: ResourceIdentifier) -> ClassificationRule | None:
   |         ^^^^
22 |         if not isinstance(resource_id, int):
23 |             return None
   |

D102 Missing docstring in public method
  --> app/forms/handlers/account_classification_rule_form_handler.py:26:9
   |
24 |         return cast("ClassificationRule | None", ClassificationRule.query.get(resource_id))
25 |
26 |     def upsert(
   |         ^^^^^^
27 |         self,
28 |         payload: ResourcePayload,
   |

D102 Missing docstring in public method
  --> app/forms/handlers/account_classification_rule_form_handler.py:36:9
   |
34 |         return self._service.update_rule(resource, sanitized)
35 |
36 |     def build_context(self, *, resource: ClassificationRule | None) -> ResourceContext:
   |         ^^^^^^^^^^^^^
37 |         del resource
38 |         classifications = (
   |

D107 Missing docstring in `__init__`
  --> app/forms/handlers/change_password_form_handler.py:15:9
   |
13 |     """修改密码表单处理器."""
14 |
15 |     def __init__(self, service: ChangePasswordService | None = None) -> None:
   |         ^^^^^^^^
16 |         self._service = service or ChangePasswordService()
   |

D102 Missing docstring in public method
  --> app/forms/handlers/change_password_form_handler.py:18:9
   |
16 |         self._service = service or ChangePasswordService()
17 |
18 |     def load(self, resource_id: ResourceIdentifier) -> User | None:
   |         ^^^^
19 |         if not isinstance(resource_id, int):
20 |             return None
   |

D102 Missing docstring in public method
  --> app/forms/handlers/change_password_form_handler.py:23:9
   |
21 |         return cast("User | None", User.query.get(resource_id))
22 |
23 |     def upsert(self, payload: ResourcePayload, resource: User | None = None) -> User:
   |         ^^^^^^
24 |         return self._service.change_password(payload, user=resource)
   |

D102 Missing docstring in public method
  --> app/forms/handlers/change_password_form_handler.py:26:9
   |
24 |         return self._service.change_password(payload, user=resource)
25 |
26 |     def build_context(self, *, resource: User | None) -> ResourceContext:
   |         ^^^^^^^^^^^^^
27 |         del resource
28 |         return {}
   |

D107 Missing docstring in `__init__`
  --> app/forms/handlers/credential_form_handler.py:17:9
   |
15 |     """凭据表单处理器."""
16 |
17 |     def __init__(self, service: CredentialWriteService | None = None) -> None:
   |         ^^^^^^^^
18 |         self._service = service or CredentialWriteService()
   |

D102 Missing docstring in public method
  --> app/forms/handlers/credential_form_handler.py:20:9
   |
18 |         self._service = service or CredentialWriteService()
19 |
20 |     def load(self, resource_id: ResourceIdentifier) -> Credential | None:
   |         ^^^^
21 |         if not isinstance(resource_id, int):
22 |             return None
   |

D102 Missing docstring in public method
  --> app/forms/handlers/credential_form_handler.py:25:9
   |
23 |         return cast("Credential | None", Credential.query.get(resource_id))
24 |
25 |     def upsert(self, payload: ResourcePayload, resource: Credential | None = None) -> Credential:
   |         ^^^^^^
26 |         sanitized = cast("dict[str, object]", DataValidator.sanitize_form_data(payload or {}))
27 |         if resource is None:
   |

D102 Missing docstring in public method
  --> app/forms/handlers/credential_form_handler.py:31:9
   |
29 |         return self._service.update(resource.id, sanitized)
30 |
31 |     def build_context(self, *, resource: Credential | None) -> ResourceContext:
   |         ^^^^^^^^^^^^^
32 |         del resource
33 |         return {
   |

D107 Missing docstring in `__init__`
  --> app/forms/handlers/instance_form_handler.py:19:9
   |
17 |     """实例表单处理器."""
18 |
19 |     def __init__(self, service: InstanceWriteService | None = None) -> None:
   |         ^^^^^^^^
20 |         self._service = service or InstanceWriteService()
   |

D102 Missing docstring in public method
  --> app/forms/handlers/instance_form_handler.py:22:9
   |
20 |         self._service = service or InstanceWriteService()
21 |
22 |     def load(self, resource_id: ResourceIdentifier) -> Instance | None:
   |         ^^^^
23 |         if not isinstance(resource_id, int):
24 |             return None
   |

D102 Missing docstring in public method
  --> app/forms/handlers/instance_form_handler.py:27:9
   |
25 |         return cast("Instance | None", Instance.query.get(resource_id))
26 |
27 |     def upsert(self, payload: ResourcePayload, resource: Instance | None = None) -> Instance:
   |         ^^^^^^
28 |         sanitized = cast("dict[str, object]", DataValidator.sanitize_form_data(payload or {}))
29 |         raw_tag_names = sanitized.get("tag_names")
   |

D102 Missing docstring in public method
  --> app/forms/handlers/instance_form_handler.py:36:9
   |
34 |         return self._service.update(resource.id, sanitized)
35 |
36 |     def build_context(self, *, resource: Instance | None) -> ResourceContext:
   |         ^^^^^^^^^^^^^
37 |         credentials = Credential.query.filter_by(is_active=True).all()
38 |         credential_options = [
   |

D107 Missing docstring in `__init__`
  --> app/forms/handlers/scheduler_job_form_handler.py:12:9
   |
10 |     """定时任务表单处理器."""
11 |
12 |     def __init__(self, service: SchedulerJobWriteService | None = None) -> None:
   |         ^^^^^^^^
13 |         self._service = service or SchedulerJobWriteService()
   |

D102 Missing docstring in public method
  --> app/forms/handlers/scheduler_job_form_handler.py:15:9
   |
13 |         self._service = service or SchedulerJobWriteService()
14 |
15 |     def load(self, resource_id: ResourceIdentifier) -> SchedulerJobResource:
   |         ^^^^
16 |         return self._service.load(resource_id)
   |

D102 Missing docstring in public method
  --> app/forms/handlers/scheduler_job_form_handler.py:18:9
   |
16 |         return self._service.load(resource_id)
17 |
18 |     def upsert(
   |         ^^^^^^
19 |         self,
20 |         payload: ResourcePayload,
   |

D102 Missing docstring in public method
  --> app/forms/handlers/scheduler_job_form_handler.py:25:9
   |
23 |         return self._service.upsert(payload, resource)
24 |
25 |     def build_context(self, *, resource: SchedulerJobResource | None) -> ResourceContext:
   |         ^^^^^^^^^^^^^
26 |         del resource
27 |         return {}
   |

D107 Missing docstring in `__init__`
  --> app/forms/handlers/tag_form_handler.py:17:9
   |
15 |     """标签表单处理器."""
16 |
17 |     def __init__(self, service: TagWriteService | None = None) -> None:
   |         ^^^^^^^^
18 |         self._service = service or TagWriteService()
   |

D102 Missing docstring in public method
  --> app/forms/handlers/tag_form_handler.py:20:9
   |
18 |         self._service = service or TagWriteService()
19 |
20 |     def load(self, resource_id: ResourceIdentifier) -> Tag | None:
   |         ^^^^
21 |         if not isinstance(resource_id, int):
22 |             return None
   |

D102 Missing docstring in public method
  --> app/forms/handlers/tag_form_handler.py:25:9
   |
23 |         return cast("Tag | None", Tag.query.get(resource_id))
24 |
25 |     def upsert(self, payload: ResourcePayload, resource: Tag | None = None) -> Tag:
   |         ^^^^^^
26 |         sanitized = cast("dict[str, object]", DataValidator.sanitize_form_data(payload or {}))
27 |         if resource is None:
   |

D102 Missing docstring in public method
  --> app/forms/handlers/tag_form_handler.py:31:9
   |
29 |         return self._service.update(resource.id, sanitized)
30 |
31 |     def build_context(self, *, resource: Tag | None) -> ResourceContext:
   |         ^^^^^^^^^^^^^
32 |         del resource
33 |         color_options = [
   |

D107 Missing docstring in `__init__`
  --> app/forms/handlers/user_form_handler.py:17:9
   |
15 |     """用户表单处理器."""
16 |
17 |     def __init__(self, service: UserWriteService | None = None) -> None:
   |         ^^^^^^^^
18 |         self._service = service or UserWriteService()
   |

D102 Missing docstring in public method
  --> app/forms/handlers/user_form_handler.py:20:9
   |
18 |         self._service = service or UserWriteService()
19 |
20 |     def load(self, resource_id: ResourceIdentifier) -> User | None:
   |         ^^^^
21 |         if not isinstance(resource_id, int):
22 |             return None
   |

D102 Missing docstring in public method
  --> app/forms/handlers/user_form_handler.py:25:9
   |
23 |         return cast("User | None", User.query.get(resource_id))
24 |
25 |     def upsert(self, payload: ResourcePayload, resource: User | None = None) -> User:
   |         ^^^^^^
26 |         sanitized = cast("dict[str, object]", DataValidator.sanitize_form_data(payload or {}))
27 |         if resource is None:
   |

D102 Missing docstring in public method
  --> app/forms/handlers/user_form_handler.py:31:9
   |
29 |         return self._service.update(resource.id, sanitized)
30 |
31 |     def build_context(self, *, resource: User | None) -> ResourceContext:
   |         ^^^^^^^^^^^^^
32 |         del resource
33 |         return {
   |

D102 Missing docstring in public method
  --> app/models/account_permission.py:91:9
   |
90 |     @hybrid_property
91 |     def is_superuser(self) -> bool:
   |         ^^^^^^^^^^^^
92 |         return "SUPERUSER" in self._capabilities_from_facts(getattr(self, "permission_facts", None))
   |

D102 Missing docstring in public method
  --> app/models/account_permission.py:95:9
   |
94 |     @is_superuser.expression
95 |     def is_superuser(cls):  # type: ignore[no-redef]
   |         ^^^^^^^^^^^^
96 |         return cls._capability_expression("SUPERUSER")
   |

D102 Missing docstring in public method
   --> app/models/account_permission.py:99:9
    |
 98 |     @hybrid_property
 99 |     def is_locked(self) -> bool:
    |         ^^^^^^^^^
100 |         return "LOCKED" in self._capabilities_from_facts(getattr(self, "permission_facts", None))
    |

D102 Missing docstring in public method
   --> app/models/account_permission.py:103:9
    |
102 |     @is_locked.expression
103 |     def is_locked(cls):  # type: ignore[no-redef]
    |         ^^^^^^^^^
104 |         return cls._capability_expression("LOCKED")
    |

I001 [*] Import block is un-sorted or un-formatted
  --> app/models/unified_log.py:6:1
   |
 4 |   """
 5 |
 6 | / from dataclasses import dataclass
 7 | | from datetime import datetime, timedelta
 8 | | from typing import TYPE_CHECKING, Any
 9 | |
10 | | from sqlalchemy import (
11 | |     JSON,
12 | |     Column,
13 | |     DateTime,
14 | | )
15 | | from sqlalchemy import Enum as SQLEnum
16 | | from sqlalchemy import (
17 | |     Index,
18 | |     Integer,
19 | |     String,
20 | |     Text,
21 | |     func,
22 | | )
23 | |
24 | | from app import db
25 | | from app.constants.system_constants import LogLevel
26 | | from app.utils.time_utils import UTC_TZ, time_utils
   | |___________________________________________________^
   |
help: Organize imports

D102 Missing docstring in public method
  --> app/repositories/account_statistics_repository.py:26:9
   |
25 |     @staticmethod
26 |     def fetch_classification_overview() -> dict[str, Any]:
   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
27 |         rows = AccountStatisticsRepository._query_classification_rows()
28 |         total_classified_accounts = sum(int(row.get("count", 0) or 0) for row in rows)
   |

D102 Missing docstring in public method
  --> app/repositories/account_statistics_repository.py:37:9
   |
36 |     @staticmethod
37 |     def fetch_summary(*, instance_id: int | None = None, db_type: str | None = None) -> dict[str, int]:
   |         ^^^^^^^^^^^^^
38 |         counts_query = (
39 |             db.session.query(
   |

D102 Missing docstring in public method
   --> app/repositories/account_statistics_repository.py:111:9
    |
110 |     @staticmethod
111 |     def fetch_db_type_stats() -> dict[str, dict[str, int]]:
    |         ^^^^^^^^^^^^^^^^^^^
112 |         db_type_stats: dict[str, dict[str, int]] = {}
113 |         for db_type in ["mysql", "postgresql", "oracle", "sqlserver"]:
    |

D102 Missing docstring in public method
   --> app/repositories/account_statistics_repository.py:146:9
    |
145 |     @staticmethod
146 |     def fetch_classification_stats() -> dict[str, dict[str, Any]]:
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^
147 |         rows = AccountStatisticsRepository._query_classification_rows()
148 |         classification_stats: dict[str, dict[str, Any]] = {}
    |

D102 Missing docstring in public method
   --> app/repositories/account_statistics_repository.py:158:9
    |
157 |     @staticmethod
158 |     def fetch_rule_match_stats(rule_ids: Sequence[int] | None = None) -> dict[int, int]:
    |         ^^^^^^^^^^^^^^^^^^^^^^
159 |         rule_query = ClassificationRule.query.filter(ClassificationRule.is_active.is_(True))
160 |         if rule_ids:
    |

D102 Missing docstring in public method
  --> app/repositories/accounts_classifications_repository.py:29:9
   |
27 |     """账户分类管理查询 Repository."""
28 |
29 |     def fetch_active_classifications(self) -> list[AccountClassification]:
   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
30 |         return (
31 |             AccountClassification.query.filter_by(is_active=True)
   |

D102 Missing docstring in public method
  --> app/repositories/accounts_classifications_repository.py:39:9
   |
37 |         )
38 |
39 |     def fetch_rule_counts(self, classification_ids: Sequence[int]) -> dict[int, int]:
   |         ^^^^^^^^^^^^^^^^^
40 |         if not classification_ids:
41 |             return {}
   |

D102 Missing docstring in public method
  --> app/repositories/accounts_classifications_repository.py:57:9
   |
55 |         return {classification_id: int(count) for classification_id, count in rows}
56 |
57 |     def fetch_active_rules(
   |         ^^^^^^^^^^^^^^^^^^
58 |         self,
59 |         *,
   |

D102 Missing docstring in public method
  --> app/repositories/accounts_classifications_repository.py:74:9
   |
72 |         return query.order_by(ClassificationRule.created_at.desc()).all()
73 |
74 |     def fetch_active_assignments(self) -> list[tuple[AccountClassificationAssignment, AccountClassification]]:
   |         ^^^^^^^^^^^^^^^^^^^^^^^^
75 |         query = db.session.query(AccountClassificationAssignment, AccountClassification)
76 |         typed_query = cast(Query[tuple[AccountClassificationAssignment, AccountClassification]], query)
   |

D102 Missing docstring in public method
  --> app/repositories/accounts_classifications_repository.py:86:9
   |
84 |         )
85 |
86 |     def fetch_rule_match_stats(self, rule_ids: Sequence[int] | None = None) -> dict[int, int]:
   |         ^^^^^^^^^^^^^^^^^^^^^^
87 |         rule_query = ClassificationRule.query.filter(ClassificationRule.is_active.is_(True))
88 |         if rule_ids:
   |

D102 Missing docstring in public method
   --> app/repositories/accounts_classifications_repository.py:109:9
    |
107 |         return {rule.id: int(assignment_map.get(rule.id, 0) or 0) for rule in rules}
108 |
109 |     def fetch_permissions_by_db_type(self, db_type: str) -> dict[str, list[dict[str, str | None]]]:
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
110 |         return PermissionConfig.get_permissions_by_db_type(db_type)
    |

D102 Missing docstring in public method
   --> app/repositories/accounts_classifications_repository.py:113:9
    |
112 |     @staticmethod
113 |     def delete_classification(classification: AccountClassification) -> None:
    |         ^^^^^^^^^^^^^^^^^^^^^
114 |         db.session.delete(classification)
    |

D102 Missing docstring in public method
   --> app/repositories/accounts_classifications_repository.py:117:9
    |
116 |     @staticmethod
117 |     def add_classification(classification: AccountClassification) -> AccountClassification:
    |         ^^^^^^^^^^^^^^^^^^
118 |         db.session.add(classification)
119 |         db.session.flush()
    |

D102 Missing docstring in public method
   --> app/repositories/accounts_classifications_repository.py:123:9
    |
122 |     @staticmethod
123 |     def delete_rule(rule: ClassificationRule) -> None:
    |         ^^^^^^^^^^^
124 |         db.session.delete(rule)
    |

D102 Missing docstring in public method
   --> app/repositories/accounts_classifications_repository.py:127:9
    |
126 |     @staticmethod
127 |     def add_rule(rule: ClassificationRule) -> ClassificationRule:
    |         ^^^^^^^^
128 |         db.session.add(rule)
129 |         db.session.flush()
    |

D102 Missing docstring in public method
   --> app/repositories/accounts_classifications_repository.py:133:9
    |
132 |     @staticmethod
133 |     def add_assignment(assignment: AccountClassificationAssignment) -> AccountClassificationAssignment:
    |         ^^^^^^^^^^^^^^
134 |         db.session.add(assignment)
135 |         db.session.flush()
    |

D107 Missing docstring in `__init__`
  --> app/repositories/capacity_databases_repository.py:25:9
   |
23 |     """数据库容量聚合查询 Repository."""
24 |
25 |     def __init__(self, *, session: Session | None = None) -> None:
   |         ^^^^^^^^
26 |         self._session = session or db.session
   |

D102 Missing docstring in public method
  --> app/repositories/capacity_databases_repository.py:41:9
   |
39 |         return int(getattr(row, "id", 0) or 0) or None
40 |
41 |     def list_aggregations(
   |         ^^^^^^^^^^^^^^^^^
42 |         self,
43 |         filters: DatabaseAggregationsFilters,
   |

D102 Missing docstring in public method
  --> app/repositories/capacity_databases_repository.py:85:9
   |
83 |         return cast("list[tuple[DatabaseSizeAggregation, Instance]]", rows), int(total or 0)
84 |
85 |     def summarize_latest_aggregations(
   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
86 |         self,
87 |         filters: DatabaseAggregationsSummaryFilters,
   |

D107 Missing docstring in `__init__`
  --> app/repositories/capacity_instances_repository.py:25:9
   |
23 |     """实例容量聚合查询 Repository."""
24 |
25 |     def __init__(self, *, session: Session | None = None) -> None:
   |         ^^^^^^^^
26 |         self._session = session or db.session
   |

D102 Missing docstring in public method
  --> app/repositories/capacity_instances_repository.py:28:9
   |
26 |         self._session = session or db.session
27 |
28 |     def list_aggregations(
   |         ^^^^^^^^^^^^^^^^^
29 |         self,
30 |         filters: InstanceAggregationsFilters,
   |

D102 Missing docstring in public method
  --> app/repositories/credentials_repository.py:28:9
   |
26 |     """凭据查询 Repository."""
27 |
28 |     def get_by_id(self, credential_id: int) -> Credential | None:
   |         ^^^^^^^^^
29 |         return cast("Credential | None", Credential.query.get(credential_id))
   |

D102 Missing docstring in public method
  --> app/repositories/credentials_repository.py:31:9
   |
29 |         return cast("Credential | None", Credential.query.get(credential_id))
30 |
31 |     def get_by_name(self, name: str) -> Credential | None:
   |         ^^^^^^^^^^^
32 |         normalized = name.strip()
33 |         if not normalized:
   |

D102 Missing docstring in public method
  --> app/repositories/credentials_repository.py:37:9
   |
35 |         return cast("Credential | None", Credential.query.filter_by(name=normalized).first())
36 |
37 |     def add(self, credential: Credential) -> Credential:
   |         ^^^
38 |         db.session.add(credential)
39 |         db.session.flush()
   |

D102 Missing docstring in public method
  --> app/repositories/credentials_repository.py:42:9
   |
40 |         return credential
41 |
42 |     def delete(self, credential: Credential) -> None:
   |         ^^^^^^
43 |         db.session.delete(credential)
   |

D102 Missing docstring in public method
  --> app/repositories/credentials_repository.py:46:9
   |
45 |     @staticmethod
46 |     def list_active_credentials() -> list[Credential]:
   |         ^^^^^^^^^^^^^^^^^^^^^^^
47 |         return Credential.query.filter_by(is_active=True).order_by(Credential.created_at.desc()).all()
   |

D102 Missing docstring in public method
  --> app/repositories/credentials_repository.py:49:9
   |
47 |         return Credential.query.filter_by(is_active=True).order_by(Credential.created_at.desc()).all()
48 |
49 |     def list_credentials(self, filters: CredentialListFilters) -> PaginatedResult[CredentialListRowProjection]:
   |         ^^^^^^^^^^^^^^^^
50 |         instance_count_expr = db.func.count(Instance.id)
51 |         query = db.session.query(Credential, instance_count_expr.label("instance_count")).outerjoin(
   |

D102 Missing docstring in public method
  --> app/repositories/database_statistics_repository.py:19:9
   |
18 |     @staticmethod
19 |     def fetch_summary(*, instance_id: int | None = None) -> dict[str, int]:
   |         ^^^^^^^^^^^^^
20 |         query = InstanceDatabase.query.join(Instance, Instance.id == InstanceDatabase.instance_id).filter(
21 |             Instance.is_active.is_(True),
   |

D102 Missing docstring in public method
  --> app/repositories/database_type_repository.py:17:9
   |
16 |     @staticmethod
17 |     def list_all_types() -> list[DatabaseTypeConfig]:
   |         ^^^^^^^^^^^^^^
18 |         return DatabaseTypeConfig.query.order_by(DatabaseTypeConfig.sort_order, DatabaseTypeConfig.name).all()
   |

D102 Missing docstring in public method
  --> app/repositories/database_type_repository.py:21:9
   |
20 |     @staticmethod
21 |     def list_active_types() -> list[DatabaseTypeConfig]:
   |         ^^^^^^^^^^^^^^^^^
22 |         return DatabaseTypeConfig.get_active_types()
   |

D102 Missing docstring in public method
  --> app/repositories/database_type_repository.py:25:9
   |
24 |     @staticmethod
25 |     def get_by_name(name: str) -> DatabaseTypeConfig | None:
   |         ^^^^^^^^^^^
26 |         return DatabaseTypeConfig.get_by_name(name)
   |

D102 Missing docstring in public method
  --> app/repositories/filter_options_repository.py:26:9
   |
25 |     @staticmethod
26 |     def list_active_instances(*, db_type: str | None = None) -> list[Instance]:
   |         ^^^^^^^^^^^^^^^^^^^^^
27 |         active_filter = cast(Any, Instance.is_active).is_(True)
28 |         query = cast("Query", Instance.query).filter(active_filter)
   |

D102 Missing docstring in public method
  --> app/repositories/filter_options_repository.py:37:9
   |
36 |     @staticmethod
37 |     def list_databases_by_instance(
   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^
38 |         instance_id: int,
39 |         *,
   |

D102 Missing docstring in public method
  --> app/repositories/filter_options_repository.py:56:9
   |
55 |     @staticmethod
56 |     def list_active_databases_by_instance(instance_id: int) -> list[InstanceDatabase]:
   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
57 |         active_filter = cast(Any, InstanceDatabase.is_active).is_(True)
58 |         query = InstanceDatabase.query.filter(
   |

D102 Missing docstring in public method
  --> app/repositories/filter_options_repository.py:65:9
   |
64 |     @staticmethod
65 |     def list_active_tags() -> list[Tag]:
   |         ^^^^^^^^^^^^^^^^
66 |         return cast("list[Tag]", Tag.get_active_tags())
   |

D102 Missing docstring in public method
  --> app/repositories/filter_options_repository.py:69:9
   |
68 |     @staticmethod
69 |     def list_active_tag_categories() -> list[str]:
   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^
70 |         category_column = cast(Any, Tag.category)
71 |         active_filter = cast(Any, Tag.is_active).is_(True)
   |

D102 Missing docstring in public method
  --> app/repositories/filter_options_repository.py:76:9
   |
75 |     @staticmethod
76 |     def list_active_account_classifications() -> list[AccountClassification]:
   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
77 |         return (
78 |             AccountClassification.query.filter(AccountClassification.is_active.is_(True))
   |

D102 Missing docstring in public method
  --> app/repositories/health_repository.py:19:9
   |
18 |     @staticmethod
19 |     def ping_database() -> None:
   |         ^^^^^^^^^^^^^
20 |         db.session.execute(text("SELECT 1"))
   |

I001 [*] Import block is un-sorted or un-formatted
  --> app/repositories/history_logs_repository.py:8:1
   |
 6 |   """
 7 |
 8 | / from __future__ import annotations
 9 | |
10 | | from datetime import datetime, timedelta
11 | | from typing import Any, cast
12 | |
13 | | from sqlalchemy import Text, asc
14 | | from sqlalchemy import cast as sa_cast
15 | | from sqlalchemy import desc, distinct, func, or_
16 | | from sqlalchemy.orm import Query
17 | |
18 | | from app import db
19 | | from app.constants.system_constants import LogLevel
20 | | from app.models.unified_log import UnifiedLog
21 | | from app.types.history_logs import LogSearchFilters
22 | | from app.types.listing import PaginatedResult
23 | | from app.utils.time_utils import time_utils
   | |___________________________________________^
   |
help: Organize imports

D102 Missing docstring in public method
  --> app/repositories/history_logs_repository.py:29:9
   |
27 |     """历史日志查询 Repository."""
28 |
29 |     def list_logs(self, filters: LogSearchFilters) -> PaginatedResult[UnifiedLog]:
   |         ^^^^^^^^^
30 |         query: Query[Any] = cast(Query[Any], UnifiedLog.query)
31 |         query = self._apply_time_filters(
   |

D102 Missing docstring in public method
  --> app/repositories/history_logs_repository.py:63:9
   |
62 |     @staticmethod
63 |     def list_modules() -> list[str]:
   |         ^^^^^^^^^^^^
64 |         rows = db.session.query(distinct(UnifiedLog.module).label("module")).order_by(UnifiedLog.module).all()
65 |         return [row.module for row in rows]
   |

D102 Missing docstring in public method
  --> app/repositories/history_logs_repository.py:68:9
   |
67 |     @staticmethod
68 |     def fetch_statistics(
   |         ^^^^^^^^^^^^^^^^
69 |         *,
70 |         start_time: datetime,
   |

D102 Missing docstring in public method
  --> app/repositories/history_logs_repository.py:98:9
   |
97 |     @staticmethod
98 |     def get_log(log_id: int) -> UnifiedLog:
   |         ^^^^^^^
99 |         return UnifiedLog.query.get_or_404(log_id)
   |

D102 Missing docstring in public method
  --> app/repositories/history_sessions_repository.py:24:9
   |
22 |     """同步会话查询 Repository."""
23 |
24 |     def list_sessions(self, filters: HistorySessionsListFilters) -> PaginatedResult[SyncSession]:
   |         ^^^^^^^^^^^^^
25 |         started_at_column = cast("ColumnElement[Any]", SyncSession.started_at)
26 |         completed_at_column = cast("ColumnElement[Any]", SyncSession.completed_at)
   |

D102 Missing docstring in public method
  --> app/repositories/history_sessions_repository.py:58:9
   |
57 |     @staticmethod
58 |     def get_session(session_id: str) -> SyncSession:
   |         ^^^^^^^^^^^
59 |         session = SyncSession.query.filter_by(session_id=session_id).first()
60 |         if not session:
   |

D102 Missing docstring in public method
  --> app/repositories/history_sessions_repository.py:66:9
   |
65 |     @staticmethod
66 |     def list_session_records(session_id: str) -> list[SyncInstanceRecord]:
   |         ^^^^^^^^^^^^^^^^^^^^
67 |         return SyncInstanceRecord.get_records_by_session(session_id)
   |

D102 Missing docstring in public method
  --> app/repositories/instance_accounts_repository.py:28:9
   |
27 |     @staticmethod
28 |     def get_instance(instance_id: int) -> Instance:
   |         ^^^^^^^^^^^^
29 |         return Instance.query.filter(
30 |             Instance.id == instance_id,
   |

D102 Missing docstring in public method
  --> app/repositories/instance_accounts_repository.py:35:9
   |
34 |     @staticmethod
35 |     def get_account(*, instance_id: int, account_id: int) -> AccountPermission:
   |         ^^^^^^^^^^^
36 |         return AccountPermission.query.filter_by(id=account_id, instance_id=instance_id).first_or_404()
   |

D102 Missing docstring in public method
  --> app/repositories/instance_accounts_repository.py:39:9
   |
38 |     @staticmethod
39 |     def fetch_summary(instance_id: int) -> InstanceAccountSummary:
   |         ^^^^^^^^^^^^^
40 |         summary_row = (
41 |             db.session.query(
   |

D102 Missing docstring in public method
  --> app/repositories/instance_accounts_repository.py:62:9
   |
61 |     @staticmethod
62 |     def list_accounts(filters: InstanceAccountListFilters) -> PaginatedResult[AccountPermission]:
   |         ^^^^^^^^^^^^^
63 |         sort_columns = {
64 |             "id": AccountPermission.id,
   |

D102 Missing docstring in public method
   --> app/repositories/instance_accounts_repository.py:119:9
    |
118 |     @staticmethod
119 |     def list_change_logs(
    |         ^^^^^^^^^^^^^^^^
120 |         *, instance_id: int, username: str, db_type: str | None, limit: int = 50
121 |     ) -> list[AccountChangeLog]:
    |

D102 Missing docstring in public method
  --> app/repositories/instance_database_sizes_repository.py:87:9
   |
85 |         )
86 |
87 |     def fetch_latest(self, options: InstanceDatabaseSizesQuery) -> InstanceDatabaseSizesLatestResult:
   |         ^^^^^^^^^^^^
88 |         query = self._build_capacity_query(options)
   |

D102 Missing docstring in public method
   --> app/repositories/instance_database_sizes_repository.py:208:9
    |
206 |         )
207 |
208 |     def fetch_history(self, options: InstanceDatabaseSizesQuery) -> InstanceDatabaseSizesHistoryResult:
    |         ^^^^^^^^^^^^^
209 |         query = self._build_capacity_query(options)
    |

D102 Missing docstring in public method
  --> app/repositories/instance_statistics_repository.py:21:9
   |
20 |     @staticmethod
21 |     def fetch_summary(*, db_type: str | None = None) -> dict[str, int]:
   |         ^^^^^^^^^^^^^
22 |         query = Instance.query
23 |         if db_type:
   |

D102 Missing docstring in public method
  --> app/repositories/instance_statistics_repository.py:44:9
   |
43 |     @staticmethod
44 |     def fetch_db_type_stats() -> list[object]:
   |         ^^^^^^^^^^^^^^^^^^^
45 |         return (
46 |             db.session.query(Instance.db_type, db.func.count(Instance.id).label("count"))
   |

D102 Missing docstring in public method
  --> app/repositories/instance_statistics_repository.py:52:9
   |
51 |     @staticmethod
52 |     def fetch_port_stats(limit: int = 10) -> list[object]:
   |         ^^^^^^^^^^^^^^^^
53 |         return (
54 |             db.session.query(Instance.port, db.func.count(Instance.id).label("count"))
   |

D102 Missing docstring in public method
  --> app/repositories/instance_statistics_repository.py:62:9
   |
61 |     @staticmethod
62 |     def fetch_version_stats() -> list[object]:
   |         ^^^^^^^^^^^^^^^^^^^
63 |         return (
64 |             db.session.query(
   |

D102 Missing docstring in public method
  --> app/repositories/instances_repository.py:36:9
   |
35 |     @staticmethod
36 |     def get_active_instance(instance_id: int) -> Instance:
   |         ^^^^^^^^^^^^^^^^^^^
37 |         return Instance.query.filter(
38 |             Instance.id == instance_id,
   |

D102 Missing docstring in public method
  --> app/repositories/instances_repository.py:43:9
   |
42 |     @staticmethod
43 |     def get_instance(instance_id: int) -> Instance | None:
   |         ^^^^^^^^^^^^
44 |         return cast("Instance | None", Instance.query.get(instance_id))
   |

D102 Missing docstring in public method
  --> app/repositories/instances_repository.py:47:9
   |
46 |     @staticmethod
47 |     def get_instance_or_404(instance_id: int) -> Instance:
   |         ^^^^^^^^^^^^^^^^^^^
48 |         return cast("Instance", Instance.query.get_or_404(instance_id))
   |

D102 Missing docstring in public method
  --> app/repositories/instances_repository.py:50:9
   |
48 |         return cast("Instance", Instance.query.get_or_404(instance_id))
49 |
50 |     def add(self, instance: Instance) -> Instance:
   |         ^^^
51 |         db.session.add(instance)
52 |         db.session.flush()
   |

D102 Missing docstring in public method
  --> app/repositories/instances_repository.py:77:9
   |
76 |     @staticmethod
77 |     def fetch_tags_map(instance_ids: list[int]) -> dict[int, list[TagSummary]]:
   |         ^^^^^^^^^^^^^^
78 |         normalized_ids = [instance_id for instance_id in instance_ids if instance_id]
79 |         if not normalized_ids:
   |

D102 Missing docstring in public method
  --> app/repositories/ledgers/accounts_ledger_repository.py:44:9
   |
42 |         return cast(AccountPermission, query.first_or_404())
43 |
44 |     def list_accounts(
   |         ^^^^^^^^^^^^^
45 |         self,
46 |         filters: AccountFilters,
   |

D107 Missing docstring in `__init__`
  --> app/repositories/ledgers/database_ledger_repository.py:32:9
   |
30 |     """数据库台账查询 Repository."""
31 |
32 |     def __init__(self, *, session: Session | None = None) -> None:
   |         ^^^^^^^^
33 |         self._session = session or db.session
   |

D102 Missing docstring in public method
  --> app/repositories/ledgers/database_ledger_repository.py:35:9
   |
33 |         self._session = session or db.session
34 |
35 |     def list_ledger(self, filters: DatabaseLedgerFilters) -> PaginatedResult[DatabaseLedgerRowProjection]:
   |         ^^^^^^^^^^^
36 |         per_page = max(filters.per_page, 1)
37 |         page = max(filters.page, 1)
   |

D102 Missing docstring in public method
  --> app/repositories/ledgers/database_ledger_repository.py:70:9
   |
68 |         return PaginatedResult(items=rows, total=total, page=page, pages=pages, limit=per_page)
69 |
70 |     def iterate_all(self, filters: DatabaseLedgerFilters) -> list[DatabaseLedgerRowProjection]:
   |         ^^^^^^^^^^^
71 |         base_query = self._apply_filters(self._base_query(), filters)
72 |         results = (
   |

D101 Missing docstring in public class
  --> app/repositories/log_statistics_repository.py:20:7
   |
19 | @dataclass(frozen=True, slots=True)
20 | class LogTrendBucketSpec:
   |       ^^^^^^^^^^^^^^^^^^
21 |     start_utc: datetime
22 |     end_utc: datetime
   |

D102 Missing docstring in public method
  --> app/repositories/log_statistics_repository.py:31:9
   |
30 |     @staticmethod
31 |     def fetch_trend_counts(bucket_specs: list[LogTrendBucketSpec]) -> dict[str, int]:
   |         ^^^^^^^^^^^^^^^^^^
32 |         if not bucket_specs:
33 |             return {}
   |

D102 Missing docstring in public method
  --> app/repositories/log_statistics_repository.py:86:9
   |
85 |     @staticmethod
86 |     def fetch_level_distribution() -> list[object]:
   |         ^^^^^^^^^^^^^^^^^^^^^^^^
87 |         return (
88 |             db.session.query(UnifiedLog.level, db.func.count(UnifiedLog.id).label("count"))
   |

D102 Missing docstring in public method
  --> app/repositories/partition_repository.py:27:9
   |
26 |     @staticmethod
27 |     def fetch_partition_info() -> dict[str, Any]:
   |         ^^^^^^^^^^^^^^^^^^^^
28 |         return PartitionStatisticsService().get_partition_info()
   |

D102 Missing docstring in public method
  --> app/repositories/partition_repository.py:31:9
   |
30 |     @staticmethod
31 |     def fetch_core_metric_counts(
   |         ^^^^^^^^^^^^^^^^^^^^^^^^
32 |         *,
33 |         period_type: str,
   |

D102 Missing docstring in public method
  --> app/repositories/scheduler_jobs_repository.py:27:9
   |
25 |     """调度器任务查询 Repository."""
26 |
27 |     def ensure_scheduler_running(self) -> BackgroundScheduler:
   |         ^^^^^^^^^^^^^^^^^^^^^^^^
28 |         scheduler = get_scheduler()
29 |         if scheduler is None or not scheduler.running:
   |

D102 Missing docstring in public method
  --> app/repositories/scheduler_jobs_repository.py:35:9
   |
34 |     @staticmethod
35 |     def lookup_job_last_run(*, job_name: str) -> str | None:
   |         ^^^^^^^^^^^^^^^^^^^
36 |         try:
37 |             recent_log = (
   |

D102 Missing docstring in public method
  --> app/repositories/scheduler_jobs_repository.py:58:9
   |
57 |     @staticmethod
58 |     def resolve_session_last_run(*, category: str | None, limit: int = 10) -> str | None:
   |         ^^^^^^^^^^^^^^^^^^^^^^^^
59 |         if not category:
60 |             return None
   |

D102 Missing docstring in public method
  --> app/repositories/tags_options_repository.py:18:9
   |
17 |     @staticmethod
18 |     def list_instances() -> list[Instance]:
   |         ^^^^^^^^^^^^^^
19 |         return Instance.query.all()
   |

D102 Missing docstring in public method
  --> app/repositories/tags_options_repository.py:22:9
   |
21 |     @staticmethod
22 |     def list_all_tags() -> list[Tag]:
   |         ^^^^^^^^^^^^^
23 |         return Tag.query.all()
   |

D102 Missing docstring in public method
  --> app/repositories/tags_options_repository.py:26:9
   |
25 |     @staticmethod
26 |     def list_active_tags(*, category: str | None = None) -> list[Tag]:
   |         ^^^^^^^^^^^^^^^^
27 |         normalized = (category or "").strip()
28 |         if normalized:
   |

D102 Missing docstring in public method
  --> app/repositories/tags_options_repository.py:33:9
   |
32 |     @staticmethod
33 |     def list_categories() -> list:
   |         ^^^^^^^^^^^^^^^
34 |         return Tag.get_category_choices()
   |

D102 Missing docstring in public method
  --> app/repositories/tags_repository.py:28:9
   |
26 |     """标签查询 Repository."""
27 |
28 |     def get_by_id(self, tag_id: int) -> Tag | None:
   |         ^^^^^^^^^
29 |         return Tag.query.get(tag_id)
   |

D102 Missing docstring in public method
  --> app/repositories/tags_repository.py:31:9
   |
29 |         return Tag.query.get(tag_id)
30 |
31 |     def get_by_name(self, name: str) -> Tag | None:
   |         ^^^^^^^^^^^
32 |         normalized = name.strip()
33 |         if not normalized:
   |

D102 Missing docstring in public method
  --> app/repositories/tags_repository.py:37:9
   |
35 |         return Tag.query.filter_by(name=normalized).first()
36 |
37 |     def add(self, tag: Tag) -> Tag:
   |         ^^^
38 |         db.session.add(tag)
39 |         db.session.flush()
   |

D102 Missing docstring in public method
  --> app/repositories/tags_repository.py:42:9
   |
40 |         return tag
41 |
42 |     def delete(self, tag: Tag) -> None:
   |         ^^^^^^
43 |         if getattr(tag, "id", None) is not None:
44 |             db.session.execute(instance_tags.delete().where(instance_tags.c.tag_id == tag.id))
   |

D102 Missing docstring in public method
  --> app/repositories/tags_repository.py:47:9
   |
45 |         db.session.delete(tag)
46 |
47 |     def sync_instance_tags(self, instance: Instance, tag_names: Sequence[str]) -> list[str]:
   |         ^^^^^^^^^^^^^^^^^^
48 |         instance_id = getattr(instance, "id", None)
49 |         if instance_id is not None:
   |

D102 Missing docstring in public method
  --> app/repositories/tags_repository.py:63:9
   |
61 |         return added
62 |
63 |     def list_tags(self, filters: TagListFilters) -> tuple[PaginatedResult[TagListRowProjection], TagStats]:
   |         ^^^^^^^^^
64 |         instance_count_expr = db.func.count(instance_tags.c.instance_id)
65 |         query = db.session.query(Tag, instance_count_expr.label("instance_count")).outerjoin(
   |

D102 Missing docstring in public method
   --> app/repositories/tags_repository.py:118:9
    |
117 |     @staticmethod
118 |     def get_stats() -> TagStats:
    |         ^^^^^^^^^
119 |         tag_id_column = cast(ColumnElement[int], Tag.id)
120 |         is_active_column = cast(ColumnElement[bool], Tag.is_active)
    |

D107 Missing docstring in `__init__`
  --> app/repositories/unified_logs_repository.py:22:9
   |
20 |     """UnifiedLog 查询 Repository."""
21 |
22 |     def __init__(self, *, session: Session | None = None) -> None:
   |         ^^^^^^^^
23 |         self._session = session or db.session
   |

D102 Missing docstring in public method
  --> app/repositories/unified_logs_repository.py:25:9
   |
23 |         self._session = session or db.session
24 |
25 |     def list_logs_for_export(
   |         ^^^^^^^^^^^^^^^^^^^^
26 |         self,
27 |         *,
   |

D102 Missing docstring in public method
  --> app/repositories/users_repository.py:26:9
   |
24 |     """用户查询 Repository."""
25 |
26 |     def get_by_id(self, user_id: int) -> User | None:
   |         ^^^^^^^^^
27 |         return cast("User | None", User.query.get(user_id))
   |

D102 Missing docstring in public method
  --> app/repositories/users_repository.py:29:9
   |
27 |         return cast("User | None", User.query.get(user_id))
28 |
29 |     def get_by_username(self, username: str) -> User | None:
   |         ^^^^^^^^^^^^^^^
30 |         normalized = (username or "").strip()
31 |         if not normalized:
   |

D102 Missing docstring in public method
  --> app/repositories/users_repository.py:35:9
   |
33 |         return cast("User | None", User.query.filter_by(username=normalized).first())
34 |
35 |     def add(self, user: User) -> User:
   |         ^^^
36 |         db.session.add(user)
37 |         db.session.flush()
   |

D102 Missing docstring in public method
  --> app/repositories/users_repository.py:40:9
   |
38 |         return user
39 |
40 |     def delete(self, user: User) -> None:
   |         ^^^^^^
41 |         db.session.delete(user)
   |

D102 Missing docstring in public method
  --> app/repositories/users_repository.py:44:9
   |
43 |     @staticmethod
44 |     def count_users() -> int:
   |         ^^^^^^^^^^^
45 |         return int(User.query.count() or 0)
   |

D102 Missing docstring in public method
  --> app/repositories/users_repository.py:48:9
   |
47 |     @staticmethod
48 |     def fetch_stats() -> dict[str, int]:
   |         ^^^^^^^^^^^
49 |         total_users = int(User.query.count() or 0)
50 |         active_users = int(User.query.filter_by(is_active=True).count() or 0)
   |

D102 Missing docstring in public method
  --> app/repositories/users_repository.py:62:9
   |
60 |         }
61 |
62 |     def list_users(self, filters: UserListFilters) -> PaginatedResult[User]:
   |         ^^^^^^^^^^
63 |         query: Query[Any] = cast(Query[Any], User.query)
64 |         username_column = cast(ColumnElement[str], User.username)
   |

D417 Missing argument descriptions in the docstring for `add_job`: `executor`, `jobstore`, `replace_existing`
   --> app/scheduler.py:214:9
    |
212 |             logger.info("定时任务调度器已停止")
213 |
214 |     def add_job(
    |         ^^^^^^^
215 |         self,
216 |         func: JobFunc,
    |

D413 [*] Missing blank line after last section ("Notes")
  --> app/services/account_classification/dsl_v4.py:23:1
   |
21 | - has_privilege(name: str, scope: str, database?: str)
22 |
23 | Notes:
   | ^^^^^
24 | - Unknown function / invalid args should fail closed (return False).
25 | - AND/OR must short-circuit like Python `and` / `or`.
   |
help: Add blank line after "Notes"

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/account_classification/dsl_v4.py:41:5
   |
40 |   try:  # pragma: no cover - optional dependency
41 | /     from prometheus_client import Counter as _Counter
42 | |     from prometheus_client import Histogram as _Histogram
   | |_________________________________________________________^
43 |   except ModuleNotFoundError:  # pragma: no cover - optional dependency
44 |       _Counter = None
   |
help: Organize imports

D103 Missing docstring in public function
  --> app/services/account_classification/dsl_v4.py:83:5
   |
83 | def is_dsl_v4_expression(expression: object) -> bool:
   |     ^^^^^^^^^^^^^^^^^^^^
84 |     if not isinstance(expression, Mapping):
85 |         return False
   |

D101 Missing docstring in public class
   --> app/services/account_classification/dsl_v4.py:188:7
    |
187 | @dataclass(slots=True)
188 | class DslEvaluationOutcome:
    |       ^^^^^^^^^^^^^^^^^^^^
189 |     matched: bool
190 |     errors: list[str]
    |

D107 Missing docstring in `__init__`
   --> app/services/account_classification/dsl_v4.py:196:9
    |
194 |     """Evaluate DSL v4 expression against permission facts."""
195 |
196 |     def __init__(self, *, facts: Mapping[str, object] | None) -> None:
    |         ^^^^^^^^
197 |         self._facts = facts if isinstance(facts, Mapping) else {}
198 |         self._errors: list[str] = []
    |

D102 Missing docstring in public method
   --> app/services/account_classification/dsl_v4.py:200:9
    |
198 |         self._errors: list[str] = []
199 |
200 |     def evaluate(self, expression: object) -> DslEvaluationOutcome:
    |         ^^^^^^^^
201 |         if not is_dsl_v4_expression(expression):
202 |             self._record_error(
    |

D107 Missing docstring in `__init__`
  --> app/services/accounts/account_classifications_read_service.py:26:9
   |
24 |     """账户分类管理读取服务."""
25 |
26 |     def __init__(self, repository: AccountsClassificationsRepository | None = None) -> None:
   |         ^^^^^^^^
27 |         self._repository = repository or AccountsClassificationsRepository()
   |

D102 Missing docstring in public method
  --> app/services/accounts/account_classifications_read_service.py:29:9
   |
27 |         self._repository = repository or AccountsClassificationsRepository()
28 |
29 |     def list_classifications(self) -> list[AccountClassificationListItem]:
   |         ^^^^^^^^^^^^^^^^^^^^
30 |         try:
31 |             classifications = self._repository.fetch_active_classifications()
   |

D102 Missing docstring in public method
  --> app/services/accounts/account_classifications_read_service.py:57:9
   |
55 |         return items
56 |
57 |     def build_classification_detail(self, classification: AccountClassification) -> AccountClassificationListItem:
   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^
58 |         try:
59 |             rules_count_map = self._repository.fetch_rule_counts([classification.id])
   |

D102 Missing docstring in public method
  --> app/services/accounts/account_classifications_read_service.py:80:9
   |
78 |         )
79 |
80 |     def list_rules(self) -> list[AccountClassificationRuleListItem]:
   |         ^^^^^^^^^^
81 |         try:
82 |             rules = self._repository.fetch_active_rules()
   |

D102 Missing docstring in public method
   --> app/services/accounts/account_classifications_read_service.py:106:9
    |
104 |         return items
105 |
106 |     def filter_rules(
    |         ^^^^^^^^^^^^
107 |         self,
108 |         *,
    |

D102 Missing docstring in public method
   --> app/services/accounts/account_classifications_read_service.py:136:9
    |
134 |         return items
135 |
136 |     def list_assignments(self) -> list[AccountClassificationAssignmentItem]:
    |         ^^^^^^^^^^^^^^^^
137 |         try:
138 |             assignments = self._repository.fetch_active_assignments()
    |

D102 Missing docstring in public method
   --> app/services/accounts/account_classifications_read_service.py:157:9
    |
155 |         return items
156 |
157 |     def get_rule_stats(self, *, rule_ids: list[int] | None) -> list[AccountClassificationRuleStatItem]:
    |         ^^^^^^^^^^^^^^
158 |         try:
159 |             stats_map = self._repository.fetch_rule_match_stats(rule_ids)
    |

D102 Missing docstring in public method
   --> app/services/accounts/account_classifications_read_service.py:169:9
    |
167 |         ]
168 |
169 |     def get_permissions(self, db_type: str) -> dict[str, list[dict[str, str | None]]]:
    |         ^^^^^^^^^^^^^^^
170 |         try:
171 |             return self._repository.fetch_permissions_by_db_type(db_type)
    |

D101 Missing docstring in public class
  --> app/services/accounts/account_classifications_write_service.py:36:7
   |
35 | @dataclass(slots=True)
36 | class AccountClassificationDeleteOutcome:
   |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
37 |     classification_id: int
38 |     classification_name: str
   |

D101 Missing docstring in public class
  --> app/services/accounts/account_classifications_write_service.py:42:7
   |
41 | @dataclass(slots=True)
42 | class ClassificationRuleDeleteOutcome:
   |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
43 |     rule_id: int
44 |     rule_name: str
   |

D101 Missing docstring in public class
  --> app/services/accounts/account_classifications_write_service.py:48:7
   |
47 | @dataclass(slots=True)
48 | class AccountClassificationAssignmentDeactivateOutcome:
   |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
49 |     assignment_id: int
50 |     account_id: int
   |

D107 Missing docstring in `__init__`
  --> app/services/accounts/account_classifications_write_service.py:57:9
   |
55 |     """账户分类管理写操作服务."""
56 |
57 |     def __init__(self, repository: AccountsClassificationsRepository | None = None) -> None:
   |         ^^^^^^^^
58 |         self._repository = repository or AccountsClassificationsRepository()
   |

D102 Missing docstring in public method
  --> app/services/accounts/account_classifications_write_service.py:60:9
   |
58 |         self._repository = repository or AccountsClassificationsRepository()
59 |
60 |     def create_classification(
   |         ^^^^^^^^^^^^^^^^^^^^^
61 |         self,
62 |         payload: dict[str, object] | None,
   |

D102 Missing docstring in public method
  --> app/services/accounts/account_classifications_write_service.py:93:9
   |
91 |         return classification
92 |
93 |     def update_classification(
   |         ^^^^^^^^^^^^^^^^^^^^^
94 |         self,
95 |         classification: AccountClassification,
   |

D102 Missing docstring in public method
   --> app/services/accounts/account_classifications_write_service.py:125:9
    |
123 |         return classification
124 |
125 |     def create_rule(
    |         ^^^^^^^^^^^
126 |         self,
127 |         payload: dict[str, object] | None,
    |

D102 Missing docstring in public method
   --> app/services/accounts/account_classifications_write_service.py:158:9
    |
156 |         return rule
157 |
158 |     def update_rule(
    |         ^^^^^^^^^^^
159 |         self,
160 |         rule: ClassificationRule,
    |

D102 Missing docstring in public method
   --> app/services/accounts/account_classifications_write_service.py:191:9
    |
189 |         return rule
190 |
191 |     def delete_classification(
    |         ^^^^^^^^^^^^^^^^^^^^^
192 |         self,
193 |         classification: AccountClassification,
    |

D102 Missing docstring in public method
   --> app/services/accounts/account_classifications_write_service.py:222:9
    |
220 |         return outcome
221 |
222 |     def delete_rule(
    |         ^^^^^^^^^^^
223 |         self,
224 |         rule: ClassificationRule,
    |

D102 Missing docstring in public method
   --> app/services/accounts/account_classifications_write_service.py:250:9
    |
248 |         return outcome
249 |
250 |     def deactivate_assignment(
    |         ^^^^^^^^^^^^^^^^^^^^^
251 |         self,
252 |         assignment: AccountClassificationAssignment,
    |

D107 Missing docstring in `__init__`
  --> app/services/accounts/accounts_statistics_read_service.py:19:9
   |
17 |     """账户统计读取服务."""
18 |
19 |     def __init__(self, repository: AccountStatisticsRepository | None = None) -> None:
   |         ^^^^^^^^
20 |         self._repository = repository or AccountStatisticsRepository()
   |

D102 Missing docstring in public method
  --> app/services/accounts/accounts_statistics_read_service.py:22:9
   |
20 |         self._repository = repository or AccountStatisticsRepository()
21 |
22 |     def build_statistics(self) -> AccountStatisticsResult:
   |         ^^^^^^^^^^^^^^^^
23 |         summary = self._repository.fetch_summary()
24 |         db_type_stats = self._repository.fetch_db_type_stats()
   |

D102 Missing docstring in public method
  --> app/services/accounts/accounts_statistics_read_service.py:43:9
   |
41 |         )
42 |
43 |     def fetch_summary(self, *, instance_id: int | None, db_type: str | None) -> dict[str, int]:
   |         ^^^^^^^^^^^^^
44 |         return self._repository.fetch_summary(instance_id=instance_id, db_type=db_type)
   |

D102 Missing docstring in public method
  --> app/services/accounts/accounts_statistics_read_service.py:46:9
   |
44 |         return self._repository.fetch_summary(instance_id=instance_id, db_type=db_type)
45 |
46 |     def fetch_db_type_stats(self) -> dict[str, dict[str, int]]:
   |         ^^^^^^^^^^^^^^^^^^^
47 |         return self._repository.fetch_db_type_stats()
   |

D102 Missing docstring in public method
  --> app/services/accounts/accounts_statistics_read_service.py:49:9
   |
47 |         return self._repository.fetch_db_type_stats()
48 |
49 |     def fetch_classification_stats(self) -> dict[str, dict[str, Any]]:
   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^
50 |         return self._repository.fetch_classification_stats()
   |

D102 Missing docstring in public method
  --> app/services/accounts/accounts_statistics_read_service.py:53:9
   |
52 |     @staticmethod
53 |     def empty_statistics() -> AccountStatisticsResult:
   |         ^^^^^^^^^^^^^^^^
54 |         return AccountStatisticsResult(
55 |             total_accounts=0,
   |

D202 [*] No blank lines allowed after function docstring (found 1)
   --> app/services/accounts_permissions/facts_builder.py:127:5
    |
125 |       snapshot: Mapping[str, object] | None = None,
126 |   ) -> JsonDict:
127 | /     """Build a stable, query-friendly permission facts payload.
128 | |
129 | |     Notes:
130 | |     - Prefer snapshot categories when available (v4).
131 | |     """
    | |_______^
132 |
133 |       db_type = str(getattr(record, "db_type", "") or "").lower()
    |
help: Remove blank line(s) after function docstring

D413 [*] Missing blank line after last section ("Notes")
   --> app/services/accounts_permissions/facts_builder.py:129:5
    |
127 |     """Build a stable, query-friendly permission facts payload.
128 |
129 |     Notes:
    |     ^^^^^
130 |     - Prefer snapshot categories when available (v4).
131 |     """
    |
help: Add blank line after "Notes"

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/accounts_sync/permission_manager.py:76:5
   |
75 |   try:  # pragma: no cover - optional dependency
76 | /     from prometheus_client import Counter as _Counter
77 | |     from prometheus_client import Histogram as _Histogram
   | |_________________________________________________________^
78 |   except ModuleNotFoundError:  # pragma: no cover - optional dependency
79 |       _Counter = None
   |
help: Organize imports

D102 Missing docstring in public method
  --> app/services/auth/change_password_service.py:28:9
   |
26 |     """修改密码写服务."""
27 |
28 |     def change_password(self, payload: PayloadMapping, *, user: User | None) -> User:
   |         ^^^^^^^^^^^^^^^
29 |         if user is None:
30 |             raise ValidationError("用户未登录")
   |

D101 Missing docstring in public class
  --> app/services/capacity/capacity_databases_page_service.py:18:7
   |
17 | @dataclass(frozen=True, slots=True)
18 | class CapacityDatabasesPageContext:
   |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
19 |     database_type_options: list[dict[str, str]]
20 |     instance_options: list[dict[str, str]]
   |

D107 Missing docstring in `__init__`
  --> app/services/capacity/capacity_databases_page_service.py:31:9
   |
29 |     """数据库容量页面读取服务."""
30 |
31 |     def __init__(
   |         ^^^^^^^^
32 |         self,
33 |         *,
   |

D102 Missing docstring in public method
  --> app/services/capacity/capacity_databases_page_service.py:40:9
   |
38 |         self._filter_options_service = filter_options_service or FilterOptionsService()
39 |
40 |     def build_context(
   |         ^^^^^^^^^^^^^
41 |         self,
42 |         *,
   |

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/capacity/current_aggregation_service.py:8:1
   |
 6 |   """
 7 |
 8 | / from __future__ import annotations
 9 | |
10 | | from dataclasses import dataclass
11 | | from typing import TYPE_CHECKING, Any
12 | |
13 | | from flask_login import current_user
14 | |
15 | | from app import db
16 | | from app.constants import SyncStatus
17 | | from app.constants.sync_constants import SyncCategory, SyncOperationType
18 | | from app.errors import SystemError as AppSystemError
19 | | from app.errors import ValidationError
20 | | from app.models.instance import Instance
21 | | from app.services.aggregation.aggregation_service import AggregationService
22 | | from app.services.aggregation.results import AggregationStatus
23 | | from app.services.sync_session_service import SyncItemStats, sync_session_service
24 | | from app.types.capacity_aggregations import CurrentAggregationRequest
25 | | from app.utils.structlog_config import log_info
26 | | from app.utils.time_utils import time_utils
   | |___________________________________________^
27 |
28 |   if TYPE_CHECKING:
   |
help: Organize imports

D102 Missing docstring in public method
  --> app/services/capacity/current_aggregation_service.py:86:9
   |
84 |     """手动触发当前周期聚合服务."""
85 |
86 |     def aggregate_current(self, request: CurrentAggregationRequest) -> dict[str, Any]:
   |         ^^^^^^^^^^^^^^^^^
87 |         period_type = "daily"
88 |         scope = _validate_scope((request.scope or "all").lower())
   |

D107 Missing docstring in `__init__`
  --> app/services/capacity/database_aggregations_read_service.py:24:9
   |
22 |     """数据库容量聚合读取服务."""
23 |
24 |     def __init__(self, repository: CapacityDatabasesRepository | None = None) -> None:
   |         ^^^^^^^^
25 |         self._repository = repository or CapacityDatabasesRepository()
   |

D102 Missing docstring in public method
  --> app/services/capacity/database_aggregations_read_service.py:27:9
   |
25 |         self._repository = repository or CapacityDatabasesRepository()
26 |
27 |     def list_aggregations(self, filters: DatabaseAggregationsFilters) -> DatabaseAggregationsListResult:
   |         ^^^^^^^^^^^^^^^^^
28 |         rows, total = self._repository.list_aggregations(filters)
   |

D102 Missing docstring in public method
   --> app/services/capacity/database_aggregations_read_service.py:113:9
    |
111 |         )
112 |
113 |     def build_summary(self, filters: DatabaseAggregationsSummaryFilters) -> DatabaseAggregationsSummary:
    |         ^^^^^^^^^^^^^
114 |         total_databases, total_instances, total_size_mb, avg_size_mb, max_size_mb = (
115 |             self._repository.summarize_latest_aggregations(filters)
    |

D107 Missing docstring in `__init__`
  --> app/services/capacity/instance_aggregations_read_service.py:24:9
   |
22 |     """实例容量聚合读取服务."""
23 |
24 |     def __init__(self, repository: CapacityInstancesRepository | None = None) -> None:
   |         ^^^^^^^^
25 |         self._repository = repository or CapacityInstancesRepository()
   |

D102 Missing docstring in public method
  --> app/services/capacity/instance_aggregations_read_service.py:27:9
   |
25 |         self._repository = repository or CapacityInstancesRepository()
26 |
27 |     def list_aggregations(self, filters: InstanceAggregationsFilters) -> InstanceAggregationsListResult:
   |         ^^^^^^^^^^^^^^^^^
28 |         rows, total = self._repository.list_aggregations(filters)
   |

D102 Missing docstring in public method
  --> app/services/capacity/instance_aggregations_read_service.py:95:9
   |
93 |         )
94 |
95 |     def build_summary(self, filters: InstanceAggregationsSummaryFilters) -> InstanceAggregationsSummary:
   |         ^^^^^^^^^^^^^
96 |         total_instances, total_size_mb, avg_size_mb, max_size_mb = self._repository.summarize_latest_stats(filters)
97 |         return InstanceAggregationsSummary(
   |

D107 Missing docstring in `__init__`
  --> app/services/common/filter_options_service.py:36:9
   |
34 |     """筛选器选项读取服务."""
35 |
36 |     def __init__(self, repository: FilterOptionsRepository | None = None) -> None:
   |         ^^^^^^^^
37 |         self._repository = repository or FilterOptionsRepository()
   |

D102 Missing docstring in public method
  --> app/services/common/filter_options_service.py:39:9
   |
37 |         self._repository = repository or FilterOptionsRepository()
38 |
39 |     def list_active_tag_options(self) -> list[dict[str, str]]:
   |         ^^^^^^^^^^^^^^^^^^^^^^^
40 |         tags = self._repository.list_active_tags()
41 |         return build_tag_options(tags)
   |

D102 Missing docstring in public method
  --> app/services/common/filter_options_service.py:43:9
   |
41 |         return build_tag_options(tags)
42 |
43 |     def list_tag_categories(self) -> list[dict[str, str]]:
   |         ^^^^^^^^^^^^^^^^^^^
44 |         label_mapping = dict(Tag.get_category_choices())
45 |         categories_raw = self._repository.list_active_tag_categories()
   |

D102 Missing docstring in public method
  --> app/services/common/filter_options_service.py:48:9
   |
46 |         return build_category_options(categories_raw, label_mapping)
47 |
48 |     def list_classification_options(self) -> list[dict[str, str]]:
   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^
49 |         classifications = self._repository.list_active_account_classifications()
50 |         return build_classification_options(classifications)
   |

D102 Missing docstring in public method
  --> app/services/common/filter_options_service.py:52:9
   |
50 |         return build_classification_options(classifications)
51 |
52 |     def list_instance_select_options(self, db_type: str | None = None) -> list[dict[str, str]]:
   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
53 |         instances = self._repository.list_active_instances(db_type=db_type)
54 |         return build_instance_select_options(instances)
   |

D102 Missing docstring in public method
  --> app/services/common/filter_options_service.py:56:9
   |
54 |         return build_instance_select_options(instances)
55 |
56 |     def list_database_select_options(self, instance_id: int) -> list[dict[str, str]]:
   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
57 |         databases = self._repository.list_active_databases_by_instance(instance_id)
58 |         return build_database_select_options(databases)
   |

D102 Missing docstring in public method
  --> app/services/common/filter_options_service.py:60:9
   |
58 |         return build_database_select_options(databases)
59 |
60 |     def get_common_instances_options(self, db_type: str | None = None) -> CommonInstancesOptionsResult:
   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
61 |         instances = self._repository.list_active_instances(db_type=db_type)
62 |         items: list[CommonInstanceOptionItem] = []
   |

D102 Missing docstring in public method
  --> app/services/common/filter_options_service.py:76:9
   |
74 |         return CommonInstancesOptionsResult(instances=items)
75 |
76 |     def get_common_databases_options(self, filters: CommonDatabasesOptionsFilters) -> CommonDatabasesOptionsResult:
   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
77 |         databases, total_count = self._repository.list_databases_by_instance(
78 |             filters.instance_id,
   |

D102 Missing docstring in public method
   --> app/services/common/filter_options_service.py:105:9
    |
103 |         )
104 |
105 |     def get_common_database_types_options(self) -> CommonDatabaseTypesOptionsResult:
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
106 |         options: list[CommonDatabaseTypeOptionItem] = []
107 |         for db_type in DatabaseType.RELATIONAL:
    |

D107 Missing docstring in `__init__`
  --> app/services/connection_adapters/adapters/base.py:45:9
   |
43 |     """数据库连接抽象基类."""
44 |
45 |     def __init__(self, instance: Instance) -> None:
   |         ^^^^^^^^
46 |         self.instance = instance
47 |         self.db_logger = get_db_logger()
   |

D107 Missing docstring in `__init__`
  --> app/services/connections/instance_connection_status_service.py:21:9
   |
19 |     """实例连接状态读取服务."""
20 |
21 |     def __init__(self, repository: InstancesRepository | None = None) -> None:
   |         ^^^^^^^^
22 |         self._repository = repository or InstancesRepository()
   |

D102 Missing docstring in public method
  --> app/services/connections/instance_connection_status_service.py:24:9
   |
22 |         self._repository = repository or InstancesRepository()
23 |
24 |     def get_status(self, instance_id: int) -> JsonDict:
   |         ^^^^^^^^^^
25 |         instance = self._repository.get_instance(instance_id)
26 |         if not instance:
   |

D101 Missing docstring in public class
  --> app/services/credentials/credential_write_service.py:31:7
   |
30 | @dataclass(slots=True)
31 | class CredentialDeleteOutcome:
   |       ^^^^^^^^^^^^^^^^^^^^^^^
32 |     credential_id: int
33 |     credential_name: str
   |

D107 Missing docstring in `__init__`
  --> app/services/credentials/credential_write_service.py:40:9
   |
38 |     """凭据写操作服务."""
39 |
40 |     def __init__(self, repository: CredentialsRepository | None = None) -> None:
   |         ^^^^^^^^
41 |         self._repository = repository or CredentialsRepository()
   |

D102 Missing docstring in public method
  --> app/services/credentials/credential_write_service.py:43:9
   |
41 |         self._repository = repository or CredentialsRepository()
42 |
43 |     def create(self, payload: ResourcePayload, *, operator_id: int | None = None) -> Credential:
   |         ^^^^^^
44 |         sanitized = self._sanitize(payload)
45 |         self._validate_payload_fields(sanitized, require_password=True)
   |

D102 Missing docstring in public method
  --> app/services/credentials/credential_write_service.py:68:9
   |
66 |         return credential
67 |
68 |     def update(self, credential_id: int, payload: ResourcePayload, *, operator_id: int | None = None) -> Credential:
   |         ^^^^^^
69 |         credential = self._get_or_error(credential_id)
70 |         sanitized = self._sanitize(payload)
   |

D102 Missing docstring in public method
  --> app/services/credentials/credential_write_service.py:84:9
   |
82 |         return credential
83 |
84 |     def delete(self, credential_id: int, *, operator_id: int | None = None) -> CredentialDeleteOutcome:
   |         ^^^^^^
85 |         credential = self._get_or_error(credential_id)
86 |         outcome = CredentialDeleteOutcome(
   |

D107 Missing docstring in `__init__`
  --> app/services/credentials/credentials_list_service.py:19:9
   |
17 |     """凭据列表业务编排服务."""
18 |
19 |     def __init__(self, repository: CredentialsRepository | None = None) -> None:
   |         ^^^^^^^^
20 |         self._repository = repository or CredentialsRepository()
   |

D102 Missing docstring in public method
  --> app/services/credentials/credentials_list_service.py:22:9
   |
20 |         self._repository = repository or CredentialsRepository()
21 |
22 |     def list_credentials(self, filters: CredentialListFilters) -> PaginatedResult[CredentialListItem]:
   |         ^^^^^^^^^^^^^^^^
23 |         page_result = self._repository.list_credentials(filters)
   |

D103 Missing docstring in public function
  --> app/services/dashboard/dashboard_charts_service.py:17:5
   |
16 | @dashboard_cache(timeout=300)
17 | def get_log_trend_data() -> list[dict[str, int | str]]:
   |     ^^^^^^^^^^^^^^^^^^
18 |     return fetch_log_trend_data()
   |

D103 Missing docstring in public function
  --> app/services/dashboard/dashboard_charts_service.py:22:5
   |
21 | @dashboard_cache(timeout=300)
22 | def get_log_level_distribution() -> list[dict[str, int | str]]:
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^
23 |     return fetch_log_level_distribution()
   |

D103 Missing docstring in public function
  --> app/services/dashboard/dashboard_charts_service.py:27:5
   |
26 | @dashboard_cache(timeout=60)
27 | def get_task_status_distribution() -> list[dict[str, int | str]]:
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
28 |     scheduler = get_scheduler()
29 |     if scheduler is None:
   |

D103 Missing docstring in public function
  --> app/services/dashboard/dashboard_charts_service.py:42:5
   |
41 | @dashboard_cache(timeout=300)
42 | def get_sync_trend_data(*, days: int = 7) -> list[dict[str, int | str]]:
   |     ^^^^^^^^^^^^^^^^^^^
43 |     return DashboardChartsRepository().fetch_sync_trend(days=days)
   |

D103 Missing docstring in public function
  --> app/services/dashboard/dashboard_charts_service.py:47:5
   |
46 | @dashboard_cache(timeout=180)
47 | def get_chart_data(chart_type: str = "all") -> dict[str, Any]:
   |     ^^^^^^^^^^^^^^
48 |     chart_type_normalized = (chart_type or "all").lower()
49 |     charts: dict[str, Any] = {}
   |

D101 Missing docstring in public class
  --> app/services/database_sync/inventory_manager.py:27:7
   |
26 | @dataclass(slots=True)
27 | class InventorySyncStats:
   |       ^^^^^^^^^^^^^^^^^^
28 |     created: int = 0
29 |     refreshed: int = 0
   |

D101 Missing docstring in public class
  --> app/services/files/account_export_service.py:22:7
   |
21 | @dataclass(frozen=True, slots=True)
22 | class CsvExportResult:
   |       ^^^^^^^^^^^^^^^
23 |     filename: str
24 |     content: str
   |

D107 Missing docstring in `__init__`
  --> app/services/files/account_export_service.py:31:9
   |
29 |     """账户导出读取服务."""
30 |
31 |     def __init__(self, repository: AccountsLedgerRepository | None = None) -> None:
   |         ^^^^^^^^
32 |         self._repository = repository or AccountsLedgerRepository()
   |

D102 Missing docstring in public method
  --> app/services/files/account_export_service.py:34:9
   |
32 |         self._repository = repository or AccountsLedgerRepository()
33 |
34 |     def export_accounts_csv(self, filters: AccountFilters) -> CsvExportResult:
   |         ^^^^^^^^^^^^^^^^^^^
35 |         accounts, metrics = self._repository.list_all_accounts(filters, sort_field="username", sort_order="asc")
36 |         csv_content = self._render_accounts_csv(accounts, metrics)
   |

D101 Missing docstring in public class
  --> app/services/files/instances_export_service.py:20:7
   |
19 | @dataclass(frozen=True, slots=True)
20 | class CsvExportResult:
   |       ^^^^^^^^^^^^^^^
21 |     filename: str
22 |     content: str
   |

D107 Missing docstring in `__init__`
  --> app/services/files/instances_export_service.py:29:9
   |
27 |     """实例导出读取服务."""
28 |
29 |     def __init__(self, repository: InstancesRepository | None = None) -> None:
   |         ^^^^^^^^
30 |         self._repository = repository or InstancesRepository()
   |

D102 Missing docstring in public method
  --> app/services/files/instances_export_service.py:32:9
   |
30 |         self._repository = repository or InstancesRepository()
31 |
32 |     def export_instances_csv(self, *, search: str, db_type: str) -> CsvExportResult:
   |         ^^^^^^^^^^^^^^^^^^^^
33 |         instances = self._repository.list_instances_for_export(search=search, db_type=db_type)
34 |         tags_map = self._repository.fetch_tags_map([instance.id for instance in instances])
   |

D107 Missing docstring in `__init__`
  --> app/services/files/logs_export_service.py:21:9
   |
19 |     """日志导出读取服务."""
20 |
21 |     def __init__(self, repository: UnifiedLogsRepository | None = None) -> None:
   |         ^^^^^^^^
22 |         self._repository = repository or UnifiedLogsRepository()
   |

D102 Missing docstring in public method
  --> app/services/files/logs_export_service.py:24:9
   |
22 |         self._repository = repository or UnifiedLogsRepository()
23 |
24 |     def list_logs(self, params: Mapping[str, str]) -> list[UnifiedLog]:
   |         ^^^^^^^^^
25 |         start_time = params.get("start_time")
26 |         end_time = params.get("end_time")
   |

D107 Missing docstring in `__init__`
  --> app/services/history_logs/history_logs_extras_service.py:18:9
   |
16 |     """日志模块/统计/详情读取服务."""
17 |
18 |     def __init__(self, repository: HistoryLogsRepository | None = None) -> None:
   |         ^^^^^^^^
19 |         self._repository = repository or HistoryLogsRepository()
   |

D102 Missing docstring in public method
  --> app/services/history_logs/history_logs_extras_service.py:21:9
   |
19 |         self._repository = repository or HistoryLogsRepository()
20 |
21 |     def list_modules(self) -> list[str]:
   |         ^^^^^^^^^^^^
22 |         return self._repository.list_modules()
   |

D102 Missing docstring in public method
  --> app/services/history_logs/history_logs_extras_service.py:24:9
   |
22 |         return self._repository.list_modules()
23 |
24 |     def get_statistics(self, *, hours: int) -> HistoryLogStatistics:
   |         ^^^^^^^^^^^^^^
25 |         window_hours = max(1, min(int(hours), 24 * 90))
26 |         start_time = time_utils.now() - timedelta(hours=window_hours)
   |

D102 Missing docstring in public method
  --> app/services/history_logs/history_logs_extras_service.py:48:9
   |
46 |         )
47 |
48 |     def get_log_detail(self, log_id: int) -> HistoryLogListItem:
   |         ^^^^^^^^^^^^^^
49 |         log_entry = self._repository.get_log(log_id)
50 |         china_timestamp = time_utils.to_china(log_entry.timestamp) if log_entry.timestamp else None
   |

D107 Missing docstring in `__init__`
  --> app/services/history_logs/history_logs_list_service.py:19:9
   |
17 |     """历史日志列表业务编排服务."""
18 |
19 |     def __init__(self, repository: HistoryLogsRepository | None = None) -> None:
   |         ^^^^^^^^
20 |         self._repository = repository or HistoryLogsRepository()
   |

D102 Missing docstring in public method
  --> app/services/history_logs/history_logs_list_service.py:22:9
   |
20 |         self._repository = repository or HistoryLogsRepository()
21 |
22 |     def list_logs(self, filters: LogSearchFilters) -> PaginatedResult[HistoryLogListItem]:
   |         ^^^^^^^^^
23 |         page_result = self._repository.list_logs(filters)
24 |         items: list[HistoryLogListItem] = []
   |

D107 Missing docstring in `__init__`
  --> app/services/history_sessions/history_sessions_read_service.py:28:9
   |
26 |     """同步会话读取服务."""
27 |
28 |     def __init__(self, repository: HistorySessionsRepository | None = None) -> None:
   |         ^^^^^^^^
29 |         self._repository = repository or HistorySessionsRepository()
   |

D102 Missing docstring in public method
  --> app/services/history_sessions/history_sessions_read_service.py:31:9
   |
29 |         self._repository = repository or HistorySessionsRepository()
30 |
31 |     def list_sessions(self, filters: HistorySessionsListFilters) -> PaginatedResult[SyncSessionItem]:
   |         ^^^^^^^^^^^^^
32 |         page_result = self._repository.list_sessions(filters)
33 |         items: list[SyncSessionItem] = []
   |

D102 Missing docstring in public method
  --> app/services/history_sessions/history_sessions_read_service.py:44:9
   |
42 |         )
43 |
44 |     def get_session_detail(self, session_id: str) -> SyncSessionDetailResult:
   |         ^^^^^^^^^^^^^^^^^^
45 |         session = self._repository.get_session(session_id)
46 |         records = self._repository.list_session_records(session_id)
   |

D102 Missing docstring in public method
  --> app/services/history_sessions/history_sessions_read_service.py:69:9
   |
67 |         return SyncSessionDetailResult(session=session_item)
68 |
69 |     def get_session_error_logs(self, session_id: str) -> SyncSessionErrorLogsResult:
   |         ^^^^^^^^^^^^^^^^^^^^^^
70 |         session = self._repository.get_session(session_id)
71 |         records = self._repository.list_session_records(session_id)
   |

D107 Missing docstring in `__init__`
  --> app/services/instances/instance_accounts_service.py:32:9
   |
30 |     """实例详情账户读取服务."""
31 |
32 |     def __init__(self, repository: InstanceAccountsRepository | None = None) -> None:
   |         ^^^^^^^^
33 |         self._repository = repository or InstanceAccountsRepository()
   |

D102 Missing docstring in public method
  --> app/services/instances/instance_accounts_service.py:35:9
   |
33 |         self._repository = repository or InstanceAccountsRepository()
34 |
35 |     def list_accounts(self, filters: InstanceAccountListFilters) -> InstanceAccountListResult:
   |         ^^^^^^^^^^^^^
36 |         instance = self._repository.get_instance(filters.instance_id)
37 |         summary = self._repository.fetch_summary(filters.instance_id)
   |

D102 Missing docstring in public method
   --> app/services/instances/instance_accounts_service.py:105:9
    |
103 |         )
104 |
105 |     def get_account_permissions(self, instance_id: int, account_id: int) -> InstanceAccountPermissionsResult:
    |         ^^^^^^^^^^^^^^^^^^^^^^^
106 |         instance = self._repository.get_instance(instance_id)
107 |         account = self._repository.get_account(instance_id=instance_id, account_id=account_id)
    |

D102 Missing docstring in public method
   --> app/services/instances/instance_accounts_service.py:136:9
    |
134 |         )
135 |
136 |     def get_change_history(self, instance_id: int, account_id: int) -> InstanceAccountChangeHistoryResult:
    |         ^^^^^^^^^^^^^^^^^^
137 |         instance = self._repository.get_instance(instance_id)
138 |         account = self._repository.get_account(instance_id=instance_id, account_id=account_id)
    |

D107 Missing docstring in `__init__`
  --> app/services/instances/instance_database_sizes_service.py:21:9
   |
19 |     """实例数据库容量读取服务."""
20 |
21 |     def __init__(self, repository: InstanceDatabaseSizesRepository | None = None) -> None:
   |         ^^^^^^^^
22 |         self._repository = repository or InstanceDatabaseSizesRepository()
   |

D102 Missing docstring in public method
  --> app/services/instances/instance_database_sizes_service.py:24:9
   |
22 |         self._repository = repository or InstanceDatabaseSizesRepository()
23 |
24 |     def fetch_sizes(
   |         ^^^^^^^^^^^
25 |         self,
26 |         options: InstanceDatabaseSizesQuery,
   |

D101 Missing docstring in public class
  --> app/services/instances/instance_detail_page_service.py:23:7
   |
22 | @dataclass(slots=True)
23 | class InstanceDetailPageContext:
   |       ^^^^^^^^^^^^^^^^^^^^^^^^^
24 |     instance: Instance
25 |     tags: list[TagSummary]
   |

D107 Missing docstring in `__init__`
  --> app/services/instances/instance_detail_page_service.py:34:9
   |
32 |     """实例详情页面读取服务."""
33 |
34 |     def __init__(
   |         ^^^^^^^^
35 |         self,
36 |         *,
   |

D102 Missing docstring in public method
  --> app/services/instances/instance_detail_page_service.py:45:9
   |
43 |         self._credentials_repository = credentials_repository or CredentialsRepository()
44 |
45 |     def build_context(self, instance_id: int) -> InstanceDetailPageContext:
   |         ^^^^^^^^^^^^^
46 |         instance = self._instances_repository.get_active_instance(instance_id)
47 |         tags_map = self._instances_repository.fetch_tags_map([instance_id])
   |

D107 Missing docstring in `__init__`
  --> app/services/instances/instance_detail_read_service.py:17:9
   |
15 |     """实例详情读取服务."""
16 |
17 |     def __init__(self, repository: InstancesRepository | None = None) -> None:
   |         ^^^^^^^^
18 |         self._repository = repository or InstancesRepository()
   |

D102 Missing docstring in public method
  --> app/services/instances/instance_detail_read_service.py:20:9
   |
18 |         self._repository = repository or InstancesRepository()
19 |
20 |     def get_active_instance(self, instance_id: int) -> Instance:
   |         ^^^^^^^^^^^^^^^^^^^
21 |         return self._repository.get_active_instance(instance_id)
   |

D107 Missing docstring in `__init__`
  --> app/services/instances/instance_list_service.py:18:9
   |
16 |     """实例列表业务编排服务."""
17 |
18 |     def __init__(self, repository: InstancesRepository | None = None) -> None:
   |         ^^^^^^^^
19 |         self._repository = repository or InstancesRepository()
   |

D102 Missing docstring in public method
  --> app/services/instances/instance_list_service.py:21:9
   |
19 |         self._repository = repository or InstancesRepository()
20 |
21 |     def list_instances(self, filters: InstanceListFilters) -> PaginatedResult[InstanceListItem]:
   |         ^^^^^^^^^^^^^^
22 |         page_result, metrics = self._repository.list_instances(filters)
23 |         items: list[InstanceListItem] = []
   |

D107 Missing docstring in `__init__`
  --> app/services/instances/instance_statistics_read_service.py:24:9
   |
22 |     """实例统计读取服务."""
23 |
24 |     def __init__(self, repository: InstanceStatisticsRepository | None = None) -> None:
   |         ^^^^^^^^
25 |         self._repository = repository or InstanceStatisticsRepository()
   |

D102 Missing docstring in public method
  --> app/services/instances/instance_statistics_read_service.py:27:9
   |
25 |         self._repository = repository or InstanceStatisticsRepository()
26 |
27 |     def build_statistics(self) -> InstanceStatisticsResult:
   |         ^^^^^^^^^^^^^^^^
28 |         totals = self._repository.fetch_summary()
29 |         db_type_rows = self._repository.fetch_db_type_stats()
   |

D102 Missing docstring in public method
  --> app/services/instances/instance_statistics_read_service.py:70:9
   |
69 |     @staticmethod
70 |     def empty_statistics() -> InstanceStatisticsResult:
   |         ^^^^^^^^^^^^^^^^
71 |         return InstanceStatisticsResult(
72 |             total_instances=0,
   |

D101 Missing docstring in public class
  --> app/services/instances/instance_write_service.py:28:7
   |
27 | @dataclass(slots=True)
28 | class InstanceSoftDeleteOutcome:
   |       ^^^^^^^^^^^^^^^^^^^^^^^^^
29 |     instance: Instance
30 |     deletion_mode: Literal["soft"]
   |

D101 Missing docstring in public class
  --> app/services/instances/instance_write_service.py:34:7
   |
33 | @dataclass(slots=True)
34 | class InstanceRestoreOutcome:
   |       ^^^^^^^^^^^^^^^^^^^^^^
35 |     instance: Instance
36 |     restored: bool
   |

D107 Missing docstring in `__init__`
  --> app/services/instances/instance_write_service.py:42:9
   |
40 |     """实例写操作服务."""
41 |
42 |     def __init__(self, repository: InstancesRepository | None = None) -> None:
   |         ^^^^^^^^
43 |         self._repository = repository or InstancesRepository()
   |

D102 Missing docstring in public method
  --> app/services/instances/instance_write_service.py:45:9
   |
43 |         self._repository = repository or InstancesRepository()
44 |
45 |     def create(self, payload: Mapping[str, object] | None, *, operator_id: int | None = None) -> Instance:
   |         ^^^^^^
46 |         sanitized = self._sanitize(payload or {})
47 |         is_valid, validation_error = DataValidator.validate_instance_data(sanitized)
   |

D102 Missing docstring in public method
  --> app/services/instances/instance_write_service.py:97:9
   |
95 |         return instance
96 |
97 |     def update(
   |         ^^^^^^
98 |         self,
99 |         instance_id: int,
   |

D102 Missing docstring in public method
   --> app/services/instances/instance_write_service.py:165:9
    |
163 |         return instance
164 |
165 |     def soft_delete(self, instance_id: int, *, operator_id: int | None = None) -> InstanceSoftDeleteOutcome:
    |         ^^^^^^^^^^^
166 |         instance = self._repository.get_instance_or_404(instance_id)
167 |         if not instance.deleted_at:
    |

D102 Missing docstring in public method
   --> app/services/instances/instance_write_service.py:182:9
    |
180 |         return InstanceSoftDeleteOutcome(instance=instance, deletion_mode="soft")
181 |
182 |     def restore(self, instance_id: int, *, operator_id: int | None = None) -> InstanceRestoreOutcome:
    |         ^^^^^^^
183 |         instance = self._repository.get_instance_or_404(instance_id)
184 |         if not instance.deleted_at:
    |

D107 Missing docstring in `__init__`
  --> app/services/ledgers/accounts_ledger_list_service.py:18:9
   |
16 |     """账户台账列表业务编排服务."""
17 |
18 |     def __init__(self, repository: AccountsLedgerRepository | None = None) -> None:
   |         ^^^^^^^^
19 |         self._repository = repository or AccountsLedgerRepository()
   |

D102 Missing docstring in public method
  --> app/services/ledgers/accounts_ledger_list_service.py:21:9
   |
19 |         self._repository = repository or AccountsLedgerRepository()
20 |
21 |     def list_accounts(
   |         ^^^^^^^^^^^^^
22 |         self,
23 |         filters: AccountFilters,
   |

D107 Missing docstring in `__init__`
  --> app/services/ledgers/accounts_ledger_permissions_service.py:25:9
   |
23 |     """账户台账-权限详情读取服务."""
24 |
25 |     def __init__(self, repository: AccountsLedgerRepository | None = None) -> None:
   |         ^^^^^^^^
26 |         self._repository = repository or AccountsLedgerRepository()
   |

D102 Missing docstring in public method
  --> app/services/ledgers/accounts_ledger_permissions_service.py:28:9
   |
26 |         self._repository = repository or AccountsLedgerRepository()
27 |
28 |     def get_permissions(self, account_id: int) -> AccountLedgerPermissionsResult:
   |         ^^^^^^^^^^^^^^^
29 |         account = self._repository.get_account_with_instance(account_id)
30 |         instance = getattr(account, "instance", None)
   |

D107 Missing docstring in `__init__`
  --> app/services/partition/partition_read_service.py:32:9
   |
30 |     """分区管理读取服务."""
31 |
32 |     def __init__(self, repository: PartitionRepository | None = None) -> None:
   |         ^^^^^^^^
33 |         self._repository = repository or PartitionRepository()
   |

D102 Missing docstring in public method
  --> app/services/partition/partition_read_service.py:35:9
   |
33 |         self._repository = repository or PartitionRepository()
34 |
35 |     def get_partition_info_snapshot(self) -> PartitionInfoSnapshot:
   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^
36 |         try:
37 |             info = self._repository.fetch_partition_info()
   |

D102 Missing docstring in public method
  --> app/services/partition/partition_read_service.py:56:9
   |
54 |         )
55 |
56 |     def get_partition_status_snapshot(self) -> PartitionStatusSnapshot:
   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
57 |         try:
58 |             info = self._repository.fetch_partition_info()
   |

D102 Missing docstring in public method
  --> app/services/partition/partition_read_service.py:74:9
   |
72 |         )
73 |
74 |     def list_partitions(
   |         ^^^^^^^^^^^^^^^
75 |         self,
76 |         *,
   |

D102 Missing docstring in public method
   --> app/services/partition/partition_read_service.py:126:9
    |
124 |         return PaginatedResult(items=items, total=total, page=normalized_page, pages=pages, limit=normalized_limit)
125 |
126 |     def build_core_metrics(self, *, period_type: str, days: int) -> PartitionCoreMetricsResult:
    |         ^^^^^^^^^^^^^^^^^^
127 |         normalized_type = self._normalize_period_type(period_type)
128 |         requested_days = max(int(days), 1)
    |

D105 Missing docstring in magic method
  --> app/services/scheduler/scheduler_job_write_service.py:49:9
   |
47 |     id: ResourceIdentifier = field(init=False)
48 |
49 |     def __post_init__(self) -> None:
   |         ^^^^^^^^^^^^^
50 |         if not hasattr(self.job, "id"):
51 |             raise ValidationError("任务对象缺少 id")
   |

D102 Missing docstring in public method
  --> app/services/scheduler/scheduler_job_write_service.py:58:9
   |
56 |     """定时任务触发器写服务."""
57 |
58 |     def load(self, resource_id: ResourceIdentifier) -> SchedulerJobResource:
   |         ^^^^
59 |         job_id = str(resource_id)
60 |         scheduler = cast("BaseScheduler | None", get_scheduler())
   |

D102 Missing docstring in public method
  --> app/services/scheduler/scheduler_job_write_service.py:71:9
   |
69 |         return SchedulerJobResource(scheduler=scheduler, job=job)
70 |
71 |     def upsert(self, payload: PayloadMapping, resource: SchedulerJobResource | None = None) -> SchedulerJobResource:
   |         ^^^^^^
72 |         if resource is None:
73 |             raise NotFoundError("任务不存在")
   |

D107 Missing docstring in `__init__`
  --> app/services/scheduler/scheduler_jobs_read_service.py:44:9
   |
42 |     """调度器任务读取服务."""
43 |
44 |     def __init__(self, repository: SchedulerJobsRepository | None = None) -> None:
   |         ^^^^^^^^
45 |         self._repository = repository or SchedulerJobsRepository()
   |

D102 Missing docstring in public method
  --> app/services/scheduler/scheduler_jobs_read_service.py:47:9
   |
45 |         self._repository = repository or SchedulerJobsRepository()
46 |
47 |     def list_jobs(self) -> list[SchedulerJobListItem]:
   |         ^^^^^^^^^
48 |         try:
49 |             scheduler = self._repository.ensure_scheduler_running()
   |

D102 Missing docstring in public method
  --> app/services/scheduler/scheduler_jobs_read_service.py:59:9
   |
57 |         return items
58 |
59 |     def get_job(self, job_id: str) -> SchedulerJobDetail:
   |         ^^^^^^^
60 |         try:
61 |             scheduler = self._repository.ensure_scheduler_running()
   |

D417 Missing argument description in the docstring for `create_session`: `session_id`
  --> app/services/sync_session_service.py:75:9
   |
73 |         return cast("dict[str, Any]", clean_value(sync_details))
74 |
75 |     def create_session(
   |         ^^^^^^^^^^^^^^
76 |         self,
77 |         sync_type: str,
   |

D107 Missing docstring in `__init__`
  --> app/services/tags/tag_list_service.py:18:9
   |
16 |     """标签列表业务编排服务."""
17 |
18 |     def __init__(self, repository: TagsRepository | None = None) -> None:
   |         ^^^^^^^^
19 |         self._repository = repository or TagsRepository()
   |

D102 Missing docstring in public method
  --> app/services/tags/tag_list_service.py:21:9
   |
19 |         self._repository = repository or TagsRepository()
20 |
21 |     def list_tags(self, filters: TagListFilters) -> tuple[PaginatedResult[TagListItem], TagStats]:
   |         ^^^^^^^^^
22 |         page_result, stats = self._repository.list_tags(filters)
23 |         items: list[TagListItem] = []
   |

D107 Missing docstring in `__init__`
  --> app/services/tags/tag_options_service.py:23:9
   |
21 |     """标签选项读取服务."""
22 |
23 |     def __init__(self, repository: TagsOptionsRepository | None = None) -> None:
   |         ^^^^^^^^
24 |         self._repository = repository or TagsOptionsRepository()
   |

D102 Missing docstring in public method
  --> app/services/tags/tag_options_service.py:26:9
   |
24 |         self._repository = repository or TagsOptionsRepository()
25 |
26 |     def list_taggable_instances(self) -> TagsBulkInstancesResult:
   |         ^^^^^^^^^^^^^^^^^^^^^^^
27 |         instances = self._repository.list_instances()
28 |         return TagsBulkInstancesResult(
   |

D102 Missing docstring in public method
  --> app/services/tags/tag_options_service.py:32:9
   |
30 |         )
31 |
32 |     def list_all_tags(self) -> TagsBulkTagsResult:
   |         ^^^^^^^^^^^^^
33 |         tags = self._repository.list_all_tags()
34 |         category_names = dict(self._repository.list_categories())
   |

D102 Missing docstring in public method
  --> app/services/tags/tag_options_service.py:40:9
   |
38 |         )
39 |
40 |     def list_tag_options(self, category: str | None) -> TagOptionsResult:
   |         ^^^^^^^^^^^^^^^^
41 |         tags = self._repository.list_active_tags(category=category)
42 |         normalized_category = (category or "").strip() or None
   |

D102 Missing docstring in public method
  --> app/services/tags/tag_options_service.py:48:9
   |
46 |         )
47 |
48 |     def list_categories(self) -> list:
   |         ^^^^^^^^^^^^^^^
49 |         return self._repository.list_categories()
   |

D107 Missing docstring in `__init__`
  --> app/services/tags/tag_stats_service.py:17:9
   |
15 |     """标签统计读取服务."""
16 |
17 |     def __init__(self, repository: TagsRepository | None = None) -> None:
   |         ^^^^^^^^
18 |         self._repository = repository or TagsRepository()
   |

D102 Missing docstring in public method
  --> app/services/tags/tag_stats_service.py:20:9
   |
18 |         self._repository = repository or TagsRepository()
19 |
20 |     def get_stats(self) -> TagStats:
   |         ^^^^^^^^^
21 |         return self._repository.get_stats()
   |

D101 Missing docstring in public class
  --> app/services/tags/tag_write_service.py:35:7
   |
34 | @dataclass(slots=True)
35 | class TagDeleteOutcome:
   |       ^^^^^^^^^^^^^^^^
36 |     tag_id: int
37 |     display_name: str
   |

D101 Missing docstring in public class
  --> app/services/tags/tag_write_service.py:43:7
   |
42 | @dataclass(slots=True)
43 | class TagBatchDeleteOutcome:
   |       ^^^^^^^^^^^^^^^^^^^^^
44 |     results: list[dict[str, object]]
45 |     has_failure: bool
   |

D107 Missing docstring in `__init__`
  --> app/services/tags/tag_write_service.py:53:9
   |
51 |     NAME_PATTERN = re.compile(r"^[A-Za-z0-9_-]+$")
52 |
53 |     def __init__(self, repository: TagsRepository | None = None) -> None:
   |         ^^^^^^^^
54 |         self._repository = repository or TagsRepository()
   |

D102 Missing docstring in public method
  --> app/services/tags/tag_write_service.py:56:9
   |
54 |         self._repository = repository or TagsRepository()
55 |
56 |     def create(self, payload: ResourcePayload, *, operator_id: int | None = None) -> Tag:
   |         ^^^^^^
57 |         sanitized = self._sanitize(payload)
58 |         normalized = self._validate_and_normalize(sanitized, resource=None)
   |

D102 Missing docstring in public method
  --> app/services/tags/tag_write_service.py:77:9
   |
75 |         return tag
76 |
77 |     def update(self, tag_id: int, payload: ResourcePayload, *, operator_id: int | None = None) -> Tag:
   |         ^^^^^^
78 |         tag = self._repository.get_by_id(tag_id)
79 |         if not tag:
   |

D102 Missing docstring in public method
  --> app/services/tags/tag_write_service.py:95:9
   |
93 |         return tag
94 |
95 |     def delete(self, tag_id: int, *, operator_id: int | None = None) -> TagDeleteOutcome:
   |         ^^^^^^
96 |         tag = self._repository.get_by_id(tag_id)
97 |         if not tag:
   |

D102 Missing docstring in public method
   --> app/services/tags/tag_write_service.py:118:9
    |
116 |         )
117 |
118 |     def batch_delete(self, tag_ids: Sequence[object], *, operator_id: int | None = None) -> TagBatchDeleteOutcome:
    |         ^^^^^^^^^^^^
119 |         results: list[dict[str, object]] = []
120 |         has_failure = False
    |

D101 Missing docstring in public class
  --> app/services/users/user_write_service.py:31:7
   |
30 | @dataclass(slots=True)
31 | class UserDeleteOutcome:
   |       ^^^^^^^^^^^^^^^^^
32 |     user_id: int
33 |     username: str
   |

D107 Missing docstring in `__init__`
  --> app/services/users/user_write_service.py:45:9
   |
43 |     ALLOWED_ROLES: ClassVar[set[str]] = {UserRole.ADMIN, UserRole.USER}
44 |
45 |     def __init__(self, repository: UsersRepository | None = None) -> None:
   |         ^^^^^^^^
46 |         self._repository = repository or UsersRepository()
   |

D102 Missing docstring in public method
  --> app/services/users/user_write_service.py:48:9
   |
46 |         self._repository = repository or UsersRepository()
47 |
48 |     def create(self, payload: ResourcePayload, *, operator_id: int | None = None) -> User:
   |         ^^^^^^
49 |         sanitized = self._sanitize(payload)
50 |         normalized = self._normalize_payload(sanitized, resource=None)
   |

D102 Missing docstring in public method
  --> app/services/users/user_write_service.py:69:9
   |
67 |         return user
68 |
69 |     def update(self, user_id: int, payload: ResourcePayload, *, operator_id: int | None = None) -> User:
   |         ^^^^^^
70 |         user = self._get_or_error(user_id)
71 |         sanitized = self._sanitize(payload)
   |

D102 Missing docstring in public method
  --> app/services/users/user_write_service.py:84:9
   |
82 |         return user
83 |
84 |     def delete(self, user_id: int, *, operator_id: int | None = None) -> UserDeleteOutcome:
   |         ^^^^^^
85 |         user = self._get_or_error(user_id)
   |

D107 Missing docstring in `__init__`
  --> app/services/users/users_list_service.py:18:9
   |
16 |     """用户列表业务编排服务."""
17 |
18 |     def __init__(self, repository: UsersRepository | None = None) -> None:
   |         ^^^^^^^^
19 |         self._repository = repository or UsersRepository()
   |

D102 Missing docstring in public method
  --> app/services/users/users_list_service.py:21:9
   |
19 |         self._repository = repository or UsersRepository()
20 |
21 |     def list_users(self, filters: UserListFilters) -> PaginatedResult[UserListItem]:
   |         ^^^^^^^^^^
22 |         page_result = self._repository.list_users(filters)
   |

D107 Missing docstring in `__init__`
  --> app/services/users/users_stats_service.py:16:9
   |
14 |     """用户统计读取服务."""
15 |
16 |     def __init__(self, repository: UsersRepository | None = None) -> None:
   |         ^^^^^^^^
17 |         self._repository = repository or UsersRepository()
   |

D102 Missing docstring in public method
  --> app/services/users/users_stats_service.py:19:9
   |
17 |         self._repository = repository or UsersRepository()
18 |
19 |     def get_stats(self) -> dict[str, int]:
   |         ^^^^^^^^^
20 |         return self._repository.fetch_stats()
   |

D102 Missing docstring in public method
   --> app/settings.py:568:9
    |
567 |     @property
568 |     def is_production(self) -> bool:
    |         ^^^^^^^^^^^^^
569 |         return self.environment.strip().lower() == "production"
    |

D102 Missing docstring in public method
   --> app/settings.py:572:9
    |
571 |     @property
572 |     def preferred_url_scheme(self) -> str:
    |         ^^^^^^^^^^^^^^^^^^^^
573 |         return "https" if self.force_https else "http"
    |

D102 Missing docstring in public method
   --> app/settings.py:576:9
    |
575 |     @property
576 |     def sqlalchemy_engine_options(self) -> dict[str, object]:
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^
577 |         if self.database_url.startswith("sqlite"):
578 |             return {"pool_pre_ping": True, "connect_args": {"check_same_thread": False}}
    |

D101 Missing docstring in public class
  --> app/types/accounts_permissions.py:10:7
   |
 9 | @dataclass(slots=True)
10 | class AccountLedgerPermissionAccount:
   |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
11 |     id: int
12 |     username: str
   |

D101 Missing docstring in public class
  --> app/types/accounts_permissions.py:18:7
   |
17 | @dataclass(slots=True)
18 | class AccountLedgerPermissions:
   |       ^^^^^^^^^^^^^^^^^^^^^^^^
19 |     db_type: str
20 |     username: str
   |

D101 Missing docstring in public class
  --> app/types/accounts_permissions.py:28:7
   |
27 | @dataclass(slots=True)
28 | class AccountLedgerPermissionsResult:
   |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
29 |     permissions: AccountLedgerPermissions
30 |     account: AccountLedgerPermissionAccount
   |

D101 Missing docstring in public class
  --> app/types/accounts_statistics.py:10:7
   |
 9 | @dataclass(slots=True)
10 | class AccountStatisticsResult:
   |       ^^^^^^^^^^^^^^^^^^^^^^^
11 |     total_accounts: int
12 |     active_accounts: int
   |

D101 Missing docstring in public class
  --> app/types/common_filter_options.py:9:7
   |
 8 | @dataclass(slots=True)
 9 | class CommonInstanceOptionItem:
   |       ^^^^^^^^^^^^^^^^^^^^^^^^
10 |     id: int
11 |     name: str
   |

D101 Missing docstring in public class
  --> app/types/common_filter_options.py:17:7
   |
16 | @dataclass(slots=True)
17 | class CommonInstancesOptionsResult:
   |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
18 |     instances: list[CommonInstanceOptionItem]
   |

D101 Missing docstring in public class
  --> app/types/common_filter_options.py:22:7
   |
21 | @dataclass(slots=True)
22 | class CommonDatabasesOptionsFilters:
   |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
23 |     instance_id: int
24 |     limit: int
   |

D101 Missing docstring in public class
  --> app/types/common_filter_options.py:29:7
   |
28 | @dataclass(slots=True)
29 | class CommonDatabaseOptionItem:
   |       ^^^^^^^^^^^^^^^^^^^^^^^^
30 |     id: int
31 |     database_name: str
   |

D101 Missing docstring in public class
  --> app/types/common_filter_options.py:39:7
   |
38 | @dataclass(slots=True)
39 | class CommonDatabasesOptionsResult:
   |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
40 |     databases: list[CommonDatabaseOptionItem]
41 |     total_count: int
   |

D101 Missing docstring in public class
  --> app/types/common_filter_options.py:47:7
   |
46 | @dataclass(slots=True)
47 | class CommonDatabaseTypeOptionItem:
   |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
48 |     value: str
49 |     text: str
   |

D101 Missing docstring in public class
  --> app/types/common_filter_options.py:55:7
   |
54 | @dataclass(slots=True)
55 | class CommonDatabaseTypesOptionsResult:
   |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
56 |     options: list[CommonDatabaseTypeOptionItem]
   |

D101 Missing docstring in public class
  --> app/types/history_logs.py:43:7
   |
42 | @dataclass(slots=True)
43 | class HistoryLogTopModule:
   |       ^^^^^^^^^^^^^^^^^^^
44 |     module: str
45 |     count: int
   |

D101 Missing docstring in public class
  --> app/types/history_logs.py:49:7
   |
48 | @dataclass(slots=True)
49 | class HistoryLogStatistics:
   |       ^^^^^^^^^^^^^^^^^^^^
50 |     total_logs: int
51 |     error_count: int
   |

D101 Missing docstring in public class
  --> app/types/history_sessions.py:10:7
   |
 9 | @dataclass(slots=True)
10 | class HistorySessionsListFilters:
   |       ^^^^^^^^^^^^^^^^^^^^^^^^^^
11 |     sync_type: str
12 |     sync_category: str
   |

D101 Missing docstring in public class
  --> app/types/history_sessions.py:21:7
   |
20 | @dataclass(slots=True)
21 | class SyncSessionItem:
   |       ^^^^^^^^^^^^^^^
22 |     id: int
23 |     session_id: str
   |

D101 Missing docstring in public class
  --> app/types/history_sessions.py:38:7
   |
37 | @dataclass(slots=True)
38 | class SyncInstanceRecordItem:
   |       ^^^^^^^^^^^^^^^^^^^^^^
39 |     id: int
40 |     session_id: str
   |

D101 Missing docstring in public class
  --> app/types/history_sessions.py:57:7
   |
56 | @dataclass(slots=True)
57 | class SyncSessionDetailItem(SyncSessionItem):
   |       ^^^^^^^^^^^^^^^^^^^^^
58 |     instance_records: list[SyncInstanceRecordItem]
59 |     progress_percentage: float
   |

D101 Missing docstring in public class
  --> app/types/history_sessions.py:63:7
   |
62 | @dataclass(slots=True)
63 | class SyncSessionDetailResult:
   |       ^^^^^^^^^^^^^^^^^^^^^^^
64 |     session: SyncSessionDetailItem
   |

D101 Missing docstring in public class
  --> app/types/history_sessions.py:68:7
   |
67 | @dataclass(slots=True)
68 | class SyncSessionErrorLogsResult:
   |       ^^^^^^^^^^^^^^^^^^^^^^^^^^
69 |     session: SyncSessionItem
70 |     error_records: list[SyncInstanceRecordItem]
   |

D101 Missing docstring in public class
  --> app/types/instance_statistics.py:9:7
   |
 8 | @dataclass(slots=True)
 9 | class InstanceDbTypeStat:
   |       ^^^^^^^^^^^^^^^^^^
10 |     db_type: str
11 |     count: int
   |

D101 Missing docstring in public class
  --> app/types/instance_statistics.py:15:7
   |
14 | @dataclass(slots=True)
15 | class InstancePortStat:
   |       ^^^^^^^^^^^^^^^^
16 |     port: int | None
17 |     count: int
   |

D101 Missing docstring in public class
  --> app/types/instance_statistics.py:21:7
   |
20 | @dataclass(slots=True)
21 | class InstanceVersionStat:
   |       ^^^^^^^^^^^^^^^^^^^
22 |     db_type: str
23 |     version: str
   |

PLC0105 `TypeVar` name "T_co" does not reflect its invariance; consider renaming it to "T"
 --> app/types/query_protocols.py:8:8
  |
7 | # 协变会导致部分 SQLAlchemy stub 触发 pyright 协变警告,此处改为默认不变
8 | T_co = TypeVar("T_co")
  |        ^^^^^^^
  |

I001 [*] Import block is un-sorted or un-formatted
  --> app/types/routes.py:6:1
   |
 4 |   """
 5 |
 6 | / from __future__ import annotations
 7 | |
 8 | | from collections.abc import Awaitable, Callable
 9 | | from typing import ParamSpec, TypeAlias
10 | |
11 | | from flask.typing import ResponseReturnValue
12 | | from flask.typing import RouteCallable as FlaskRouteCallable
   | |____________________________________________________________^
13 |
14 |   P = ParamSpec("P")
   |
help: Organize imports

PLC0105 `TypeVar` name "_T" does not reflect its covariance; consider renaming it to "_T_co"
 --> app/types/stubs/sqlalchemy/orm.pyi:6:6
  |
4 | from typing import Any, Generic, Mapping, Protocol, TypeVar, overload
5 |
6 | _T = TypeVar("_T", covariant=True)
  |      ^^^^^^^
7 |
8 | class InstrumentedAttribute(Protocol[_T]):
  |

D101 Missing docstring in public class
  --> app/types/tags_options.py:9:7
   |
 8 | @dataclass(slots=True)
 9 | class TagOptionItem:
   |       ^^^^^^^^^^^^^
10 |     id: int
11 |     name: str
   |

D101 Missing docstring in public class
  --> app/types/tags_options.py:24:7
   |
23 | @dataclass(slots=True)
24 | class TaggableInstance:
   |       ^^^^^^^^^^^^^^^^
25 |     id: int
26 |     name: str
   |

D101 Missing docstring in public class
  --> app/types/tags_options.py:33:7
   |
32 | @dataclass(slots=True)
33 | class TagsBulkInstancesResult:
   |       ^^^^^^^^^^^^^^^^^^^^^^^
34 |     instances: list[TaggableInstance]
   |

D101 Missing docstring in public class
  --> app/types/tags_options.py:38:7
   |
37 | @dataclass(slots=True)
38 | class TagsBulkTagsResult:
   |       ^^^^^^^^^^^^^^^^^^
39 |     tags: list[TagOptionItem]
40 |     category_names: dict[str, str]
   |

D101 Missing docstring in public class
  --> app/types/tags_options.py:44:7
   |
43 | @dataclass(slots=True)
44 | class TagOptionsResult:
   |       ^^^^^^^^^^^^^^^^
45 |     tags: list[TagOptionItem]
46 |     category: str | None
   |

D417 Missing argument description in the docstring for `invalidate_pattern`: `self`
   --> app/utils/cache_utils.py:190:5
    |
190 | def invalidate_pattern(self, pattern: str) -> int:
    |     ^^^^^^^^^^^^^^^^^^
191 |     """根据模式批量删除缓存项.
    |

D107 Missing docstring in `__init__`
  --> app/utils/proxy_fix_middleware.py:35:9
   |
33 |     """
34 |
35 |     def __init__(
   |         ^^^^^^^^
36 |         self,
37 |         app: WSGIApplication,
   |

D102 Missing docstring in public method
  --> app/utils/proxy_fix_middleware.py:57:9
   |
55 |         )
56 |
57 |     def __call__(self, environ: WSGIEnvironment, start_response: StartResponse) -> Iterable[bytes]:
   |         ^^^^^^^^
58 |         remote_addr = environ.get("REMOTE_ADDR")
59 |         if isinstance(remote_addr, str) and remote_addr in self._trusted_proxy_ips:
   |

D301 Use `r"""` if any backslashes in a docstring
  --> app/utils/redirect_safety.py:12:5
   |
11 |   def is_safe_redirect_target(target: str) -> bool:
12 | /     """判断重定向目标是否安全.
13 | |
14 | |     安全定义(最小策略):
15 | |     - 仅允许以 `/` 开头的站内路径(不允许 scheme/netloc).
16 | |     - 禁止以 `//` 开头,避免被浏览器解析为 scheme-relative URL.
17 | |     - 禁止包含 CR/LF 等控制字符,避免响应头注入类风险.
18 | |     - 禁止反斜杠,防止部分客户端对 `\\` 的 URL 归一化产生绕过.
19 | |
20 | |     Args:
21 | |         target: 目标 URL.
22 | |
23 | |     Returns:
24 | |         True 表示允许跳转,False 表示应当拒绝并回退到安全地址.
25 | |
26 | |     """
   | |_______^
27 |       normalized = target.strip()
28 |       if not normalized:
   |
help: Add `r` prefix

D202 [*] No blank lines allowed after function docstring (found 1)
  --> app/utils/response_utils.py:25:5
   |
24 |   def _ensure_json_serializable(value: object) -> object:
25 | /     """将常见对象转换为可 JSON 序列化的结构.
26 | |
27 | |     目前主要处理 date/datetime,用于兼容 Flask-RESTX 默认 `json.dumps` 序列化器.
28 | |     """
   | |_______^
29 |
30 |       if isinstance(value, (datetime, date)):
   |
help: Remove blank line(s) after function docstring

D417 Missing argument description in the docstring for `safe_route_call`: `func_args`
  --> app/utils/route_safety.py:76:5
   |
76 | def safe_route_call(
   |     ^^^^^^^^^^^^^^^
77 |     func: Callable[..., R],
78 |     *,
   |

I001 [*] Import block is un-sorted or un-formatted
  --> migrations/versions/20251219161048_baseline_production_schema.py:13:1
   |
11 |   """
12 |
13 | / from __future__ import annotations
14 | |
15 | | from alembic import op
   | |______________________^
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> migrations/versions/20251224120000_drop_credentials_instance_ids.py:9:1
   |
 7 |   """
 8 |
 9 | / from __future__ import annotations
10 | |
11 | | import sqlalchemy as sa
12 | | from alembic import op
13 | | from sqlalchemy.dialects import postgresql
   | |__________________________________________^
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> migrations/versions/20251224134000_convert_aggregation_timestamps_to_timestamptz.py:9:1
   |
 7 |   """
 8 |
 9 | / from __future__ import annotations
10 | |
11 | | import sqlalchemy as sa
12 | | from alembic import op
   | |______________________^
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> migrations/versions/20251224152000_unify_sync_sessions_status_default_and_check.py:9:1
   |
 7 |   """
 8 |
 9 | / from __future__ import annotations
10 | |
11 | | import sqlalchemy as sa
12 | | from alembic import op
   | |______________________^
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> migrations/versions/20251224164000_add_primary_keys_to_partitioned_capacity_tables.py:9:1
   |
 7 |   """
 8 |
 9 | / from __future__ import annotations
10 | |
11 | | from alembic import op
   | |______________________^
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> migrations/versions/20251230180000_add_account_permission_snapshot_v4_columns.py:9:1
   |
 7 |   """
 8 |
 9 | / from __future__ import annotations
10 | |
11 | | import sqlalchemy as sa
12 | | from alembic import op
13 | | from sqlalchemy.dialects import postgresql
   | |__________________________________________^
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> migrations/versions/20251230183000_add_account_permission_facts_column_drop_snapshot_version.py:9:1
   |
 7 |   """
 8 |
 9 | / from __future__ import annotations
10 | |
11 | | import sqlalchemy as sa
12 | | from alembic import op
13 | | from sqlalchemy.dialects import postgresql
   | |__________________________________________^
   |
help: Organize imports

D202 [*] No blank lines allowed after function docstring (found 1)
  --> migrations/versions/20251230183000_add_account_permission_facts_column_drop_snapshot_version.py:24:5
   |
23 |   def upgrade() -> None:
24 | /     """执行升级迁移.
25 | |
26 | |     - 新增 `permission_facts` (jsonb, nullable): 事实层(用于统计/查询)。
27 | |     - 移除 `permission_snapshot_version`: 快照 schema 版本以 JSON payload 内的 `version` 为准。
28 | |     """
   | |_______^
29 |
30 |       op.add_column(
   |
help: Remove blank line(s) after function docstring

D202 [*] No blank lines allowed after function docstring (found 1)
  --> migrations/versions/20251230183000_add_account_permission_facts_column_drop_snapshot_version.py:38:5
   |
37 | def downgrade() -> None:
38 |     """执行降级迁移."""
   |     ^^^^^^^^^^^^^^^^^^^
39 |
40 |     op.add_column(
   |
help: Remove blank line(s) after function docstring

I001 [*] Import block is un-sorted or un-formatted
  --> migrations/versions/20251230190000_drop_account_permission_legacy_permission_columns.py:9:1
   |
 7 |   """
 8 |
 9 | / from __future__ import annotations
10 | |
11 | | import sqlalchemy as sa
12 | | from alembic import op
13 | | from sqlalchemy.dialects import postgresql
   | |__________________________________________^
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> migrations/versions/20251230211000_update_permission_configs_drop_tablespace_and_quotas.py:12:1
   |
10 |   """
11 |
12 | / from __future__ import annotations
13 | |
14 | | from alembic import op
   | |______________________^
   |
help: Organize imports

D103 Missing docstring in public function
  --> migrations/versions/20251230211000_update_permission_configs_drop_tablespace_and_quotas.py:24:5
   |
24 | def upgrade() -> None:
   |     ^^^^^^^
25 |     # PostgreSQL: 不再提供 tablespace_privileges 配置.
26 |     op.execute(
   |

D103 Missing docstring in public function
  --> migrations/versions/20251230211000_update_permission_configs_drop_tablespace_and_quotas.py:67:5
   |
67 | def downgrade() -> None:
   |     ^^^^^^^^^
68 |     # PostgreSQL: 恢复 tablespace_privileges 配置项.
69 |     op.execute(
   |

I001 [*] Import block is un-sorted or un-formatted
  --> migrations/versions/20251231120000_drop_account_permission_status_columns_add_capabilities_index.py:9:1
   |
 7 |   """
 8 |
 9 | / from __future__ import annotations
10 | |
11 | | import sqlalchemy as sa
12 | | from alembic import op
   | |______________________^
   |
help: Organize imports

D202 [*] No blank lines allowed after function docstring (found 1)
  --> migrations/versions/20251231120000_drop_account_permission_status_columns_add_capabilities_index.py:23:5
   |
22 | def upgrade() -> None:
23 |     """Execute upgrade migration."""
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
24 |
25 |     op.execute('DROP INDEX IF EXISTS "ix_account_permission_is_locked"')
   |
help: Remove blank line(s) after function docstring

D202 [*] No blank lines allowed after function docstring (found 1)
  --> migrations/versions/20251231120000_drop_account_permission_status_columns_add_capabilities_index.py:35:5
   |
34 | def downgrade() -> None:
35 |     """Execute downgrade migration."""
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
36 |
37 |     op.execute("DROP INDEX IF EXISTS idx_account_permission_facts_capabilities")
   |
help: Remove blank line(s) after function docstring

I001 [*] Import block is un-sorted or un-formatted
  --> migrations/versions/20251231120100_add_permission_configs_introduced_in_major.py:11:1
   |
 9 |   """
10 |
11 | / from __future__ import annotations
12 | |
13 | | from alembic import op
14 | | import sqlalchemy as sa
   | |_______________________^
   |
help: Organize imports

D103 Missing docstring in public function
  --> migrations/versions/20251231120100_add_permission_configs_introduced_in_major.py:24:5
   |
24 | def upgrade() -> None:
   |     ^^^^^^^
25 |     op.add_column(
26 |         "permission_configs",
   |

D103 Missing docstring in public function
  --> migrations/versions/20251231120100_add_permission_configs_introduced_in_major.py:31:5
   |
31 | def downgrade() -> None:
   |     ^^^^^^^^^
32 |     op.drop_column("permission_configs", "introduced_in_major")
   |

D400 First line should end with a period
 --> migrations/versions/__init__.py:1:1
  |
1 | """数据库迁移版本包初始化模块。"""
  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  |
help: Add period

D415 First line should end with a period, question mark, or exclamation point
 --> migrations/versions/__init__.py:1:1
  |
1 | """数据库迁移版本包初始化模块。"""
  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  |
help: Add closing punctuation

Found 602 errors.
[*] 26 fixable with the `--fix` option (3 hidden fixes can be enabled with the `--unsafe-fixes` option).
