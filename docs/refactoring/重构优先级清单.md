# å‘½åè§„èŒƒé‡æ„ä¼˜å…ˆçº§æ¸…å•

> å¿«é€Ÿå‚è€ƒï¼šæŒ‰ä¼˜å…ˆçº§æ’åºçš„é‡æ„ä»»åŠ¡æ¸…å•

## ğŸ”´ é«˜ä¼˜å…ˆçº§ï¼ˆç«‹å³æ‰§è¡Œï¼‰

### åç«¯æ–‡ä»¶é‡å‘½å

```bash
# è·¯ç”±æ–‡ä»¶
app/routes/database_aggr.py â†’ app/routes/database_aggregations.py
app/routes/instance_aggr.py â†’ app/routes/instance_aggregations.py

# è¡¨å•è§†å›¾æ–‡ä»¶
app/routes/account_classification_form_view.py â†’ app/routes/classification_forms.py
app/routes/change_password_form_view.py â†’ app/routes/password_forms.py
app/routes/credential_form_view.py â†’ app/routes/credential_forms.py
app/routes/instance_form_view.py â†’ app/routes/instance_forms.py
app/routes/scheduler_job_form_view.py â†’ app/routes/scheduler_forms.py
app/routes/tag_form_view.py â†’ app/routes/tag_forms.py
app/routes/user_form_view.py â†’ app/routes/user_forms.py
```

### åç«¯å‡½æ•°é‡å‘½å

```python
# routes/users.py - ç§»é™¤å†—ä½™çš„ api_ å‰ç¼€
api_get_users() â†’ get_users()
api_create_user() â†’ create_user()
api_update_user() â†’ update_user()
api_delete_user() â†’ delete_user()
api_get_user() â†’ get_user()
api_get_stats() â†’ get_stats()

# routes/instance.py
api_list() â†’ list_instances()
api_detail() â†’ get_instance()
api_get_accounts() â†’ get_accounts()

# routes/credentials.py
api_list() â†’ list_credentials()
api_detail() â†’ get_credential()

# routes/tags.py
api_tags() â†’ list_tags()
api_tag_detail() â†’ get_tag()
api_categories() â†’ list_categories()

# routes/database_aggr.py
get_databases_aggregations() â†’ get_database_aggregations()  # ä¿®å¤è¯­æ³•é”™è¯¯
get_databases_aggregations_summary() â†’ get_database_aggregations_summary()

# routes/instance_aggr.py
get_instances_aggregations() â†’ get_instance_aggregations()  # ä¿®å¤è¯­æ³•é”™è¯¯
get_instances_aggregations_summary() â†’ get_instance_aggregations_summary()

# services/account_classification/orchestrator.py - ç§»é™¤ _optimized åç¼€
auto_classify_accounts_optimized() â†’ auto_classify_accounts()
_find_accounts_matching_rule_optimized() â†’ _find_matching_accounts()
_classify_accounts_by_db_type_optimized() â†’ _classify_by_db_type()
```

### å‰ç«¯ç›®å½•é‡å‘½å

```bash
# å‰ç«¯ç›®å½• - ä¸‹åˆ’çº¿æ”¹ä¸ºè¿å­—ç¬¦
app/static/css/pages/capacity_stats/ â†’ capacity-stats/
app/static/js/common/capacity_stats/ â†’ capacity-stats/
app/static/js/pages/capacity_stats/ â†’ capacity-stats/
app/static/js/pages/accounts/classification_rules/ â†’ classification-rules/
app/templates/accounts/classification_rules/ â†’ classification-rules/
```

### å‰ç«¯æ–‡ä»¶é‡å‘½å

```bash
# JavaScript æ–‡ä»¶ - ä¸‹åˆ’çº¿æ”¹ä¸ºè¿å­—ç¬¦
static/js/common/permission_policy_center.js â†’ permission-policy-center.js
static/js/common/chart_renderer.js â†’ chart-renderer.js
static/js/common/data_source.js â†’ data-source.js
static/js/common/summary_cards.js â†’ summary-cards.js
static/js/components/tag_selector.js â†’ tag-selector.js
static/js/components/filter_utils.js â†’ filter-utils.js
static/js/components/connection-manager.js â†’ connection-manager.js
static/js/components/permission-button.js â†’ permission-button.js

# CSS æ–‡ä»¶
static/css/components/filter_common.css â†’ filter-common.css
static/css/components/tag_selector.css â†’ tag-selector.css
```

## ğŸŸ¡ ä¸­ä¼˜å…ˆçº§ï¼ˆè®¡åˆ’æ‰§è¡Œï¼‰

### åç«¯ç±»é‡å‘½å

```python
# services/instances/batch_service.py
InstanceBatchCreationService â†’ BatchInstanceCreator
InstanceBatchDeletionService â†’ BatchInstanceDeleter

# services/database_sync/database_sync_service.py
DatabaseSizeCollectorService â†’ DatabaseSizeCollector

# services/account_classification/orchestrator.py
# è€ƒè™‘ç®€åŒ–ï¼ˆå¦‚æœåœ¨ç‹¬ç«‹åŒ…å†…ï¼‰
AccountClassificationService â†’ ClassificationService
```

### å˜é‡å‘½åä¼˜åŒ–

```python
# é¿å…ç¼©å†™
db_type â†’ database_type
inst_id â†’ instance_id
cred â†’ credential
aggr_data â†’ aggregation_data

# å¸ƒå°”å˜é‡ä½¿ç”¨å‰ç¼€
active â†’ is_active
locked â†’ is_locked
valid â†’ is_valid
permission â†’ has_permission
```

### å‰ç«¯ç±»å’Œå‡½æ•°é‡å‘½å

```javascript
// ç±»åä½¿ç”¨ PascalCase
class permission_policy_center â†’ class PermissionPolicyCenter
class chart_renderer â†’ class ChartRenderer
class data_source â†’ class DataSource

// å‡½æ•°åä½¿ç”¨ camelCase
function get_data() â†’ function fetchData()
function set_data() â†’ function updateData()
function init_chart() â†’ function initializeChart()
```

## ğŸŸ¢ ä½ä¼˜å…ˆçº§ï¼ˆå¯é€‰ä¼˜åŒ–ï¼‰

### æ–‡æ¡£å’Œæ³¨é‡Š

- ä¸ºæ‰€æœ‰å…¬å…± API æ·»åŠ  docstring
- ç»Ÿä¸€æ³¨é‡Šé£æ ¼ï¼ˆä¸­æ–‡/è‹±æ–‡ï¼‰
- æ›´æ–°å†…è”æ³¨é‡Š

### ä»£ç ç»„ç»‡

- æŒ‰åŠŸèƒ½æ¨¡å—é‡æ–°ç»„ç»‡æ–‡ä»¶ç»“æ„
- æå–é‡å¤ä»£ç åˆ°å·¥å…·å‡½æ•°
- ä¼˜åŒ–å¯¼å…¥é¡ºåº

## å¿«é€Ÿæ‰§è¡Œè„šæœ¬

### åç«¯æ–‡ä»¶é‡å‘½åè„šæœ¬

```bash
#!/bin/bash
# rename_backend_files.sh

# è·¯ç”±æ–‡ä»¶
git mv app/routes/database_aggr.py app/routes/database_aggregations.py
git mv app/routes/instance_aggr.py app/routes/instance_aggregations.py
git mv app/routes/account_classification_form_view.py app/routes/classification_forms.py
git mv app/routes/change_password_form_view.py app/routes/password_forms.py
git mv app/routes/credential_form_view.py app/routes/credential_forms.py
git mv app/routes/instance_form_view.py app/routes/instance_forms.py
git mv app/routes/scheduler_job_form_view.py app/routes/scheduler_forms.py
git mv app/routes/tag_form_view.py app/routes/tag_forms.py
git mv app/routes/user_form_view.py app/routes/user_forms.py

echo "åç«¯æ–‡ä»¶é‡å‘½åå®Œæˆ"
```

### å‰ç«¯æ–‡ä»¶é‡å‘½åè„šæœ¬

```bash
#!/bin/bash
# rename_frontend_files.sh

# ç›®å½•é‡å‘½å
git mv app/static/css/pages/capacity_stats app/static/css/pages/capacity-stats
git mv app/static/js/common/capacity_stats app/static/js/common/capacity-stats
git mv app/static/js/pages/capacity_stats app/static/js/pages/capacity-stats
git mv app/static/js/pages/accounts/classification_rules app/static/js/pages/accounts/classification-rules
git mv app/templates/accounts/classification_rules app/templates/accounts/classification-rules

# JavaScript æ–‡ä»¶
git mv static/js/common/permission_policy_center.js static/js/common/permission-policy-center.js
git mv static/js/common/chart_renderer.js static/js/common/chart-renderer.js
git mv static/js/common/data_source.js static/js/common/data-source.js
git mv static/js/common/summary_cards.js static/js/common/summary-cards.js
git mv static/js/components/tag_selector.js static/js/components/tag-selector.js
git mv static/js/components/filter_utils.js static/js/components/filter-utils.js

# CSS æ–‡ä»¶
git mv static/css/components/filter_common.css static/css/components/filter-common.css
git mv static/css/components/tag_selector.css static/css/components/tag-selector.css

echo "å‰ç«¯æ–‡ä»¶é‡å‘½åå®Œæˆ"
```

### æ›´æ–°å¯¼å…¥è·¯å¾„è„šæœ¬

```bash
#!/bin/bash
# update_imports.sh

# æ›´æ–°åç«¯å¯¼å…¥
find app -name "*.py" -type f -exec sed -i '' \
  -e 's/from app.routes.database_aggr/from app.routes.database_aggregations/g' \
  -e 's/from app.routes.instance_aggr/from app.routes.instance_aggregations/g' \
  -e 's/from app.routes.account_classification_form_view/from app.routes.classification_forms/g' \
  -e 's/from app.routes.change_password_form_view/from app.routes.password_forms/g' \
  -e 's/from app.routes.credential_form_view/from app.routes.credential_forms/g' \
  -e 's/from app.routes.instance_form_view/from app.routes.instance_forms/g' \
  -e 's/from app.routes.scheduler_job_form_view/from app.routes.scheduler_forms/g' \
  -e 's/from app.routes.tag_form_view/from app.routes.tag_forms/g' \
  -e 's/from app.routes.user_form_view/from app.routes.user_forms/g' \
  {} +

# æ›´æ–°å‰ç«¯å¼•ç”¨
find templates -name "*.html" -type f -exec sed -i '' \
  -e 's/permission_policy_center\.js/permission-policy-center.js/g' \
  -e 's/chart_renderer\.js/chart-renderer.js/g' \
  -e 's/data_source\.js/data-source.js/g' \
  -e 's/summary_cards\.js/summary-cards.js/g' \
  -e 's/tag_selector\.js/tag-selector.js/g' \
  -e 's/filter_utils\.js/filter-utils.js/g' \
  -e 's/filter_common\.css/filter-common.css/g' \
  -e 's/tag_selector\.css/tag-selector.css/g' \
  {} +

echo "å¯¼å…¥è·¯å¾„æ›´æ–°å®Œæˆ"
```

## éªŒè¯æ¸…å•

### é‡å‘½ååå¿…é¡»éªŒè¯

- [ ] è¿è¡Œ `make test` ç¡®ä¿æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] è¿è¡Œ `make quality` ç¡®ä¿ä»£ç è´¨é‡æ£€æŸ¥é€šè¿‡
- [ ] æ‰‹åŠ¨æµ‹è¯•ä¸»è¦åŠŸèƒ½æ¨¡å—
- [ ] æ£€æŸ¥å‰ç«¯é¡µé¢æ˜¯å¦æ­£å¸¸åŠ è½½
- [ ] éªŒè¯ API ç«¯ç‚¹æ˜¯å¦æ­£å¸¸å·¥ä½œ
- [ ] æ£€æŸ¥æ—¥å¿—æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯

### æ–‡æ¡£æ›´æ–°

- [ ] é‡æ–°ç”Ÿæˆ API è·¯ç”±æ–‡æ¡£
- [ ] æ›´æ–°æœåŠ¡å’Œå·¥å…·å‡½æ•°ç´¢å¼•
- [ ] æ›´æ–° README.md
- [ ] æ›´æ–° AGENTS.md

## é¢„è®¡æ—¶é—´

| é˜¶æ®µ | ä»»åŠ¡ | é¢„è®¡æ—¶é—´ |
|-----|------|---------|
| å‡†å¤‡ | åˆ›å»ºåˆ†æ”¯ã€å¤‡ä»½ã€ç¼–å†™è„šæœ¬ | 1-2 å¤© |
| åç«¯ | æ–‡ä»¶é‡å‘½åã€å‡½æ•°é‡å‘½åã€ç±»é‡å‘½å | 3-5 å¤© |
| å‰ç«¯ | æ–‡ä»¶é‡å‘½åã€ç±»å‡½æ•°é‡å‘½å | 2-3 å¤© |
| æµ‹è¯• | å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€æ‰‹åŠ¨æµ‹è¯• | 2-3 å¤© |
| æ–‡æ¡£ | æ›´æ–°æ–‡æ¡£ã€æ³¨é‡Š | 1-2 å¤© |
| éƒ¨ç½² | ä»£ç å®¡æŸ¥ã€åˆå¹¶ã€éƒ¨ç½² | 1 å¤© |
| **æ€»è®¡** | | **10-16 å¤©** |

## é£é™©è¯„ä¼°

### é«˜é£é™©é¡¹

- æ–‡ä»¶é‡å‘½åå¯èƒ½å¯¼è‡´å¯¼å…¥è·¯å¾„é”™è¯¯
- å‡½æ•°é‡å‘½åå¯èƒ½å½±å“ç°æœ‰è°ƒç”¨
- å‰ç«¯æ–‡ä»¶é‡å‘½åå¯èƒ½å¯¼è‡´é¡µé¢åŠ è½½å¤±è´¥

### é£é™©ç¼“è§£æªæ–½

1. åˆ›å»ºå¤‡ä»½åˆ†æ”¯å’Œæ ‡ç­¾
2. ä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬å‡å°‘äººä¸ºé”™è¯¯
3. åˆ†é˜¶æ®µæ‰§è¡Œï¼Œæ¯é˜¶æ®µåè¿è¡Œæµ‹è¯•
4. ä¿æŒæ—§åç§°çš„å…¼å®¹æ€§ï¼ˆè¿‡æ¸¡æœŸï¼‰
5. å……åˆ†çš„æµ‹è¯•è¦†ç›–

## å›æ»šè®¡åˆ’

å¦‚æœé‡æ„å‡ºç°é—®é¢˜ï¼š

```bash
# å›æ»šåˆ°é‡æ„å‰çš„çŠ¶æ€
git reset --hard backup-before-refactor

# æˆ–è€…å›æ»šç‰¹å®šæ–‡ä»¶
git checkout backup-before-refactor -- <file_path>
```

---

*ä½¿ç”¨æ­¤æ¸…å•ç¡®ä¿é‡æ„è¿‡ç¨‹æœ‰åºè¿›è¡Œ*
