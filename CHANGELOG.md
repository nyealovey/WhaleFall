# 更新日志

## [1.2.0] - 2025-10-31

### 重大调整
- ⚠️ **服务命名变更**：`DatabaseSizeAggregationService` 重命名为 `AggregationService`，模块路径更新为 `app.services.aggregation.aggregation_service.AggregationService`。请同步调整外部引用。

### 新增
- 🗂️ **聚合维度标记**：同步会话记录新增 `scope`（instance/database）字段，聚合进度面板可区分维度。
- 📄 **文档与部署脚本**：README、部署手册、脚本页脚等全局版本信息同步更新至 `v1.2.0`。

### 优化
- 🔄 **手动聚合流程统一**：`/aggregations/api/aggregate-current` 按请求 scope 注册回调，实例与数据库聚合与定时任务保持一致的串行顺序与日志输出。
- 🗓️ **前端周期计算改进**：容量统计页面使用自然周期结束日（周日/月末/季末），并在触发手动聚合时显式传递 `scope`。
- 📦 **服务职责梳理**：聚合服务移除分区依赖入口（保留钩子），与 Runner 之间的接口保持稳定。

### 修复
- ✅ 解决数据库维度手动聚合长期停留在 `running/pending` 的问题，现在状态会根据实际回调及时更新。
- ✅ 修复同步会话开始时间全部相同的问题，实例记录以真实执行顺序记录开始时间。

## [1.1.4] - 2025-10-17

### 重构优化
- 🔧 **统一时间设置** - 全面统一应用时间处理机制
  - 统一使用 time_utils 模块处理所有时间相关操作
  - 修复前后端时间格式不一致问题
  - 优化时区处理，统一使用中国时区
  - 修复聚合API中date对象格式化错误
  - 改进日志中心显示布局，修复内容截断问题

## [1.1.3] - 2025-10-14

### 新增功能
- ✨ **容量统计功能** - 新增完整的容量统计和分析功能
  - 数据库容量统计页面
  - 实例容量统计页面  
  - 容量趋势图表和数据分析
  - 支持按时间范围筛选和聚合

### 功能优化
- 🎨 **日志中心显示优化**
  - 修复日志条目对齐问题，为级别徽章、模块徽章、时间戳设置固定宽度
  - 优化日志容器显示逻辑，内容不足时底部对齐，上方留白
  - 改进滚动行为，最新日志在顶部，老日志在底部

### 重构优化
- 🔧 **统计功能职责重新分配**
  - 将database_stats.py和instance_stats.py的功能按正确职责重新分配
  - database_stats专注数据库维度统计
  - instance_stats专注实例维度统计

- 🛡️ **CSRF Token统一处理**
  - 删除16个文件中重复的getCSRFToken函数
  - 统一使用csrf-utils.js中的全局函数
  - 减少约90行重复代码

### 问题修复
- 🐛 **前端API调用修复**
  - 修复重构后的API调用路径问题
  - 确保所有功能正常可用
  - 修复database_stats.py中的模型导入问题和字段引用错误

### 文档更新
- 📚 **版本信息同步更新**
  - 更新README.md中的版本徽章
  - 更新about页面的版本信息和更新日志
  - 更新环境配置文件中的版本号
  - 更新部署脚本中的版本信息
  - 更新页脚版本显示

## [1.1.2] - 2025-10-13

### 功能优化
- 🎨 版本统一更新、样式优化、文档同步更新

## [1.1.1] - 2025-10-09

### 新增功能
- ✨ 新增容量同步修复脚本
- 📊 数据库容量统计页面
- 📈 容量趋势图交互优化

### 问题修复
- 🐛 分区与仪表板稳定性修复

## [1.1.0] - 2025-09-25

### 问题修复
- 🐛 修复自动分类功能BUG
- 🎨 优化标签管理页面
- 🐛 修复Jinja2模板语法错误
- 🐛 解决JavaScript重复加载问题
- 🎨 优化实例显示布局

## [1.0.8] - 2025-09-24

### 新增功能
- ✨ 新增批量标签管理功能
- 📊 标签分组显示
- 🏷️ 实例分组管理
- 🎯 简化移除模式
- 📝 日志页面优化

## [1.0.7] - 2025-09-24

### 问题修复
- 🐛 修复自动分类规则匹配BUG
- ⏰ 定时任务问题修复
- 👥 用户管理功能增强
- 🔧 代码分离优化

## [1.0.6] - 2025-09-22

### 问题修复
- 🔑 权限API修复
- 🗄️ SQL Server重复权限修复
- 🏷️ 标签日志优化
- 🐘 PostgreSQL枚举类型修复
- 🔧 权限模态框修复

## [1.0.5] - 2025-09-21

### 新增功能
- 📄 账户分类分页功能
- 🗄️ SQL Server权限修复
- 🚀 生产环境优化
- ℹ️ 关于页面

## [1.0.2] - 2025-09-20

### 功能优化
- 🔢 版本升级
- 🚀 生产环境部署
- 📱 页脚版本号显示

## [1.0.0] - 2025-09-19

### 里程碑
- 🎉 正式版本发布
- 🔢 统一版本号
- 📦 依赖升级

---

## 版本说明

- **主版本号**: 重大功能更新或架构变更
- **次版本号**: 新功能添加或重要优化
- **修订版本号**: 问题修复和小幅改进

## 图标说明

- ✨ 新增功能
- 🎨 界面优化
- 🐛 问题修复
- 🔧 重构优化
- 📚 文档更新
- 🚀 性能优化
- 🛡️ 安全更新
- 📊 数据相关
- 🏷️ 标签功能
- ⏰ 定时任务
- 👥 用户管理
- 🔑 权限相关
- 🗄️ 数据库相关
- 📱 界面相关
- 🎉 里程碑
- 🔢 版本相关
- 📦 依赖相关
