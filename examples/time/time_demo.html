<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç»Ÿä¸€æ—¶é—´å¤„ç†æ¼”ç¤º</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            background-color: #f5f5f5;
        }
        
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        
        h2 {
            color: #34495e;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
            margin-top: 30px;
        }
        
        .demo-section {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-left: 4px solid #3498db;
            border-radius: 4px;
        }
        
        .time-display {
            font-family: 'Monaco', 'Menlo', monospace;
            background: #2c3e50;
            color: #ecf0f1;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        
        .time-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .time-card {
            background: white;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #ddd;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .time-card h4 {
            margin: 0 0 10px 0;
            color: #2c3e50;
        }
        
        .time-value {
            font-family: monospace;
            font-size: 14px;
            color: #27ae60;
            font-weight: bold;
        }
        
        .error {
            color: #e74c3c;
            background: #fdf2f2;
            padding: 10px;
            border-radius: 4px;
            border-left: 4px solid #e74c3c;
        }
        
        .success {
            color: #27ae60;
            background: #f0f9f0;
            padding: 10px;
            border-radius: 4px;
            border-left: 4px solid #27ae60;
        }
        
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        
        button:hover {
            background: #2980b9;
        }
        
        .live-demo {
            background: #e8f5e8;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .api-demo {
            background: #f0f8ff;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        pre {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }
        
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-success { background: #27ae60; }
        .status-warning { background: #f39c12; }
        .status-error { background: #e74c3c; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ•’ ç»Ÿä¸€æ—¶é—´å¤„ç†å·¥å…·æ¼”ç¤º</h1>
        <p style="text-align: center; color: #7f8c8d;">
            åŸºäº <code>timezone_and_loglevel_unification.md</code> å¼ºåˆ¶ç»Ÿä¸€ç­–ç•¥
        </p>
        
        <div id="status-check" class="demo-section">
            <h2>ç³»ç»ŸçŠ¶æ€æ£€æŸ¥</h2>
            <div id="timeutils-status"></div>
        </div>
    </div>

    <div class="container">
        <h2>1. åŸºç¡€æ—¶é—´æ ¼å¼åŒ–</h2>
        <div class="demo-section">
            <p>å½“å‰æ—¶é—´çš„ä¸åŒæ ¼å¼æ˜¾ç¤ºï¼š</p>
            <div class="time-grid" id="basic-formatting">
                <!-- åŠ¨æ€ç”Ÿæˆ -->
            </div>
            <button onclick="updateBasicFormatting()">ğŸ”„ åˆ·æ–°æ—¶é—´</button>
        </div>
    </div>

    <div class="container">
        <h2>2. ç›¸å¯¹æ—¶é—´è®¡ç®—</h2>
        <div class="demo-section">
            <p>ä¸åŒæ—¶é—´ç‚¹çš„ç›¸å¯¹æ—¶é—´æ˜¾ç¤ºï¼š</p>
            <div class="time-grid" id="relative-time">
                <!-- åŠ¨æ€ç”Ÿæˆ -->
            </div>
            <button onclick="updateRelativeTime()">ğŸ”„ æ›´æ–°ç›¸å¯¹æ—¶é—´</button>
        </div>
    </div>

    <div class="container">
        <h2>3. å®æ—¶æ—¶é—´æ›´æ–°</h2>
        <div class="live-demo">
            <p>å®æ—¶æ›´æ–°çš„æ—¶é—´æ˜¾ç¤ºï¼ˆæ¯ç§’æ›´æ–°ï¼‰ï¼š</p>
            <div class="time-display" id="live-time">
                <!-- å®æ—¶æ›´æ–° -->
            </div>
            <div>
                <button onclick="startLiveUpdate()">â–¶ï¸ å¼€å§‹å®æ—¶æ›´æ–°</button>
                <button onclick="stopLiveUpdate()">â¸ï¸ åœæ­¢æ›´æ–°</button>
            </div>
        </div>
    </div>

    <div class="container">
        <h2>4. API æ•°æ®æ—¶é—´å¤„ç†</h2>
        <div class="api-demo">
            <p>æ¨¡æ‹Ÿå¤„ç†åç«¯ API è¿”å›çš„æ—¶é—´æ•°æ®ï¼š</p>
            <button onclick="simulateApiCall()">ğŸ“¡ æ¨¡æ‹Ÿ API è°ƒç”¨</button>
            <div id="api-result"></div>
        </div>
    </div>

    <div class="container">
        <h2>5. æ—¶é—´éªŒè¯å’Œé”™è¯¯å¤„ç†</h2>
        <div class="demo-section">
            <p>æµ‹è¯•å„ç§è¾“å…¥çš„æ—¶é—´å¤„ç†ï¼š</p>
            <div>
                <input type="text" id="time-input" placeholder="è¾“å…¥æ—¶é—´å­—ç¬¦ä¸²..." style="width: 300px; padding: 8px;">
                <button onclick="validateTimeInput()">ğŸ” éªŒè¯æ—¶é—´</button>
            </div>
            <div id="validation-result"></div>
            
            <h4>é¢„è®¾æµ‹è¯•ç”¨ä¾‹ï¼š</h4>
            <div>
                <button onclick="testTimeInput('2025-01-17T10:30:00Z')">ISO æ ¼å¼</button>
                <button onclick="testTimeInput('2025-01-17 18:30:00')">æ ‡å‡†æ ¼å¼</button>
                <button onclick="testTimeInput('invalid-date')">æ— æ•ˆè¾“å…¥</button>
                <button onclick="testTimeInput('')">ç©ºå­—ç¬¦ä¸²</button>
                <button onclick="testTimeInput(null)">null å€¼</button>
            </div>
        </div>
    </div>

    <div class="container">
        <h2>6. æ—¶é—´èŒƒå›´å¤„ç†</h2>
        <div class="demo-section">
            <p>è·å–ä¸åŒæ—¶é—´èŒƒå›´ï¼š</p>
            <div>
                <button onclick="showTimeRange(1)">æœ€è¿‘1å°æ—¶</button>
                <button onclick="showTimeRange(6)">æœ€è¿‘6å°æ—¶</button>
                <button onclick="showTimeRange(24)">æœ€è¿‘24å°æ—¶</button>
                <button onclick="showTimeRange(168)">æœ€è¿‘7å¤©</button>
            </div>
            <div id="time-range-result"></div>
        </div>
    </div>

    <div class="container">
        <h2>7. æ€§èƒ½æµ‹è¯•</h2>
        <div class="demo-section">
            <p>æµ‹è¯•æ‰¹é‡æ—¶é—´å¤„ç†æ€§èƒ½ï¼š</p>
            <div>
                <button onclick="performanceTest(100)">æµ‹è¯• 100 ä¸ªæ—¶é—´</button>
                <button onclick="performanceTest(1000)">æµ‹è¯• 1000 ä¸ªæ—¶é—´</button>
                <button onclick="performanceTest(5000)">æµ‹è¯• 5000 ä¸ªæ—¶é—´</button>
            </div>
            <div id="performance-result"></div>
        </div>
    </div>

    <!-- å¼•å…¥æ—¶é—´å·¥å…· -->
    <script src="../../app/static/js/common/time-utils.js"></script>
    
    <script>
        // å…¨å±€å˜é‡
        let liveUpdateInterval = null;
        
        // æ£€æŸ¥ timeUtils çŠ¶æ€
        function checkTimeUtilsStatus() {
            const statusEl = document.getElementById('timeutils-status');
            
            if (typeof timeUtils !== 'undefined') {
                statusEl.innerHTML = `
                    <div class="success">
                        <span class="status-indicator status-success"></span>
                        âœ… timeUtils å·²æˆåŠŸåŠ è½½å¹¶å¯ç”¨
                    </div>
                `;
                return true;
            } else {
                statusEl.innerHTML = `
                    <div class="error">
                        <span class="status-indicator status-error"></span>
                        âŒ timeUtils æœªåŠ è½½ï¼Œè¯·æ£€æŸ¥ time-utils.js æ–‡ä»¶è·¯å¾„
                    </div>
                `;
                return false;
            }
        }
        
        // æ›´æ–°åŸºç¡€æ ¼å¼åŒ–æ¼”ç¤º
        function updateBasicFormatting() {
            if (!checkTimeUtilsStatus()) return;
            
            const container = document.getElementById('basic-formatting');
            const now = new Date();
            
            const formats = [
                { name: 'æ ‡å‡†æ—¥æœŸæ—¶é—´', type: 'datetime' },
                { name: 'ä»…æ—¥æœŸ', type: 'date' },
                { name: 'ä»…æ—¶é—´', type: 'time' },
                { name: 'ä¸­æ–‡æ ¼å¼', type: 'chinese' }
            ];
            
            container.innerHTML = formats.map(format => `
                <div class="time-card">
                    <h4>${format.name}</h4>
                    <div class="time-value">${timeUtils.formatTime(now, format.type)}</div>
                </div>
            `).join('');
        }
        
        // æ›´æ–°ç›¸å¯¹æ—¶é—´æ¼”ç¤º
        function updateRelativeTime() {
            if (!checkTimeUtilsStatus()) return;
            
            const container = document.getElementById('relative-time');
            const now = new Date();
            
            const timePoints = [
                { name: 'åˆšåˆš', time: new Date(now.getTime() - 30 * 1000) },
                { name: '5åˆ†é’Ÿå‰', time: new Date(now.getTime() - 5 * 60 * 1000) },
                { name: '2å°æ—¶å‰', time: new Date(now.getTime() - 2 * 60 * 60 * 1000) },
                { name: '1å¤©å‰', time: new Date(now.getTime() - 24 * 60 * 60 * 1000) },
                { name: '1å‘¨å‰', time: new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000) },
                { name: '1ä¸ªæœˆå‰', time: new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000) }
            ];
            
            container.innerHTML = timePoints.map(point => `
                <div class="time-card">
                    <h4>${point.name}</h4>
                    <div class="time-value">
                        ${timeUtils.formatRelativeTime(point.time)}<br>
                        <small style="color: #7f8c8d;">${timeUtils.formatDateTime(point.time)}</small>
                    </div>
                </div>
            `).join('');
        }
        
        // å¼€å§‹å®æ—¶æ›´æ–°
        function startLiveUpdate() {
            if (!checkTimeUtilsStatus()) return;
            
            stopLiveUpdate(); // å…ˆåœæ­¢ä¹‹å‰çš„æ›´æ–°
            
            const updateLiveTime = () => {
                const liveTimeEl = document.getElementById('live-time');
                const now = new Date();
                
                liveTimeEl.innerHTML = `
                    <div>å½“å‰æ—¶é—´: ${timeUtils.formatDateTime(now)}</div>
                    <div>ç›¸å¯¹æ—¶é—´: ${timeUtils.formatRelativeTime(new Date(now.getTime() - 5 * 60 * 1000))}</div>
                    <div>æ™ºèƒ½æ˜¾ç¤º: ${timeUtils.formatSmartTime(now)}</div>
                    <div>æ—¶é—´æˆ³: ${now.getTime()}</div>
                `;
            };
            
            updateLiveTime(); // ç«‹å³æ›´æ–°ä¸€æ¬¡
            liveUpdateInterval = setInterval(updateLiveTime, 1000);
        }
        
        // åœæ­¢å®æ—¶æ›´æ–°
        function stopLiveUpdate() {
            if (liveUpdateInterval) {
                clearInterval(liveUpdateInterval);
                liveUpdateInterval = null;
            }
        }
        
        // æ¨¡æ‹Ÿ API è°ƒç”¨
        function simulateApiCall() {
            if (!checkTimeUtilsStatus()) return;
            
            const resultEl = document.getElementById('api-result');
            
            // æ¨¡æ‹Ÿ API å“åº”
            const mockResponse = {
                success: true,
                data: [
                    {
                        id: 1,
                        name: 'æµ‹è¯•å®ä¾‹1',
                        created_at: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString(),
                        updated_at: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString(),
                        last_connected: new Date(Date.now() - 30 * 60 * 1000).toISOString()
                    },
                    {
                        id: 2,
                        name: 'æµ‹è¯•å®ä¾‹2',
                        created_at: new Date(Date.now() - 10 * 24 * 60 * 60 * 1000).toISOString(),
                        updated_at: new Date(Date.now() - 1 * 60 * 60 * 1000).toISOString(),
                        last_connected: null
                    }
                ]
            };
            
            // å¤„ç†æ—¶é—´æ•°æ®
            const processedData = mockResponse.data.map(item => ({
                ...item,
                created_at_formatted: timeUtils.formatDateTime(item.created_at),
                updated_at_formatted: timeUtils.formatDateTime(item.updated_at),
                last_connected_formatted: item.last_connected 
                    ? timeUtils.formatDateTime(item.last_connected)
                    : 'ä»æœªè¿æ¥',
                created_at_relative: timeUtils.formatRelativeTime(item.created_at),
                updated_at_relative: timeUtils.formatRelativeTime(item.updated_at),
                last_connected_relative: item.last_connected
                    ? timeUtils.formatRelativeTime(item.last_connected)
                    : 'ä»æœªè¿æ¥'
            }));
            
            resultEl.innerHTML = `
                <h4>åŸå§‹ API å“åº”ï¼š</h4>
                <pre>${JSON.stringify(mockResponse, null, 2)}</pre>
                
                <h4>å¤„ç†åçš„æ•°æ®ï¼š</h4>
                ${processedData.map(item => `
                    <div class="time-card">
                        <h4>${item.name} (ID: ${item.id})</h4>
                        <div>
                            <strong>åˆ›å»ºæ—¶é—´:</strong> ${item.created_at_formatted} (${item.created_at_relative})<br>
                            <strong>æ›´æ–°æ—¶é—´:</strong> ${item.updated_at_formatted} (${item.updated_at_relative})<br>
                            <strong>æœ€åè¿æ¥:</strong> ${item.last_connected_formatted} (${item.last_connected_relative})
                        </div>
                    </div>
                `).join('')}
            `;
        }
        
        // éªŒè¯æ—¶é—´è¾“å…¥
        function validateTimeInput() {
            const input = document.getElementById('time-input').value;
            testTimeInput(input);
        }
        
        // æµ‹è¯•æ—¶é—´è¾“å…¥
        function testTimeInput(input) {
            if (!checkTimeUtilsStatus()) return;
            
            const resultEl = document.getElementById('validation-result');
            
            try {
                const isValid = timeUtils.isValidTime(input);
                
                if (isValid) {
                    const parsed = timeUtils.parseTime(input);
                    const formatted = timeUtils.formatDateTime(parsed);
                    const relative = timeUtils.formatRelativeTime(parsed);
                    const smart = timeUtils.formatSmartTime(parsed);
                    
                    resultEl.innerHTML = `
                        <div class="success">
                            <h4>âœ… æœ‰æ•ˆæ—¶é—´è¾“å…¥</h4>
                            <div><strong>è¾“å…¥:</strong> ${input}</div>
                            <div><strong>è§£æç»“æœ:</strong> ${parsed}</div>
                            <div><strong>æ ‡å‡†æ ¼å¼:</strong> ${formatted}</div>
                            <div><strong>ç›¸å¯¹æ—¶é—´:</strong> ${relative}</div>
                            <div><strong>æ™ºèƒ½æ˜¾ç¤º:</strong> ${smart}</div>
                        </div>
                    `;
                } else {
                    const formatted = timeUtils.formatDateTime(input);
                    const relative = timeUtils.formatRelativeTime(input);
                    
                    resultEl.innerHTML = `
                        <div class="error">
                            <h4>âŒ æ— æ•ˆæ—¶é—´è¾“å…¥</h4>
                            <div><strong>è¾“å…¥:</strong> ${input}</div>
                            <div><strong>æ ¼å¼åŒ–ç»“æœ:</strong> ${formatted}</div>
                            <div><strong>ç›¸å¯¹æ—¶é—´:</strong> ${relative}</div>
                            <div><em>æ³¨æ„ï¼štimeUtils ä¼šä¼˜é›…å¤„ç†æ— æ•ˆè¾“å…¥ï¼Œè¿”å›é»˜è®¤å€¼</em></div>
                        </div>
                    `;
                }
            } catch (error) {
                resultEl.innerHTML = `
                    <div class="error">
                        <h4>ğŸ’¥ å¤„ç†é”™è¯¯</h4>
                        <div><strong>è¾“å…¥:</strong> ${input}</div>
                        <div><strong>é”™è¯¯:</strong> ${error.message}</div>
                    </div>
                `;
            }
        }
        
        // æ˜¾ç¤ºæ—¶é—´èŒƒå›´
        function showTimeRange(hours) {
            if (!checkTimeUtilsStatus()) return;
            
            const resultEl = document.getElementById('time-range-result');
            const range = timeUtils.getTimeRange(hours);
            
            resultEl.innerHTML = `
                <div class="time-card">
                    <h4>æœ€è¿‘ ${hours} å°æ—¶çš„æ—¶é—´èŒƒå›´</h4>
                    <div>
                        <strong>å¼€å§‹æ—¶é—´:</strong> ${range.startFormatted}<br>
                        <strong>ç»“æŸæ—¶é—´:</strong> ${range.endFormatted}<br>
                        <strong>å¼€å§‹æ—¥æœŸ:</strong> ${range.startDate}<br>
                        <strong>ç»“æŸæ—¥æœŸ:</strong> ${range.endDate}<br>
                        <strong>ISO å¼€å§‹:</strong> ${range.start}<br>
                        <strong>ISO ç»“æŸ:</strong> ${range.end}
                    </div>
                </div>
            `;
        }
        
        // æ€§èƒ½æµ‹è¯•
        function performanceTest(count) {
            if (!checkTimeUtilsStatus()) return;
            
            const resultEl = document.getElementById('performance-result');
            
            // ç”Ÿæˆæµ‹è¯•æ•°æ®
            const testTimes = Array.from({ length: count }, (_, i) => 
                new Date(Date.now() - i * 60 * 1000).toISOString()
            );
            
            // æµ‹è¯•æ ¼å¼åŒ–æ€§èƒ½
            const start1 = performance.now();
            const formatted = testTimes.map(time => timeUtils.formatDateTime(time));
            const end1 = performance.now();
            
            // æµ‹è¯•ç›¸å¯¹æ—¶é—´æ€§èƒ½
            const start2 = performance.now();
            const relatives = testTimes.map(time => timeUtils.formatRelativeTime(time));
            const end2 = performance.now();
            
            // æµ‹è¯•éªŒè¯æ€§èƒ½
            const start3 = performance.now();
            const validations = testTimes.map(time => timeUtils.isValidTime(time));
            const end3 = performance.now();
            
            resultEl.innerHTML = `
                <div class="time-card">
                    <h4>æ€§èƒ½æµ‹è¯•ç»“æœ (${count} ä¸ªæ—¶é—´)</h4>
                    <div>
                        <strong>æ ¼å¼åŒ–è€—æ—¶:</strong> ${(end1 - start1).toFixed(2)} ms<br>
                        <strong>ç›¸å¯¹æ—¶é—´è€—æ—¶:</strong> ${(end2 - start2).toFixed(2)} ms<br>
                        <strong>éªŒè¯è€—æ—¶:</strong> ${(end3 - start3).toFixed(2)} ms<br>
                        <strong>å¹³å‡æ¯ä¸ª:</strong> ${((end1 - start1) / count).toFixed(4)} ms<br>
                        <strong>å¤„ç†é€Ÿåº¦:</strong> ${Math.round(count / ((end1 - start1) / 1000))} ä¸ª/ç§’
                    </div>
                    <div style="margin-top: 10px;">
                        <small>
                            <strong>ç¤ºä¾‹ç»“æœ:</strong><br>
                            æ ¼å¼åŒ–: ${formatted.slice(0, 3).join(', ')}...<br>
                            ç›¸å¯¹æ—¶é—´: ${relatives.slice(0, 3).join(', ')}...<br>
                            éªŒè¯ç»“æœ: ${validations.slice(0, 10).join(', ')}...
                        </small>
                    </div>
                </div>
            `;
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // æ£€æŸ¥çŠ¶æ€
            if (checkTimeUtilsStatus()) {
                // åˆå§‹åŒ–æ¼”ç¤º
                updateBasicFormatting();
                updateRelativeTime();
                
                // è®¾ç½®ä¸€äº›é¢„è®¾å€¼
                document.getElementById('time-input').value = '2025-01-17T10:30:00Z';
            }
        });
        
        // é¡µé¢å¸è½½æ—¶æ¸…ç†
        window.addEventListener('beforeunload', function() {
            stopLiveUpdate();
        });
    </script>
</body>
</html>