# 聚合统计死代码清理设计文档

## Overview

本设计文档描述了聚合统计功能的死代码清理方案。通过静态代码分析和动态引用检查，系统性地识别和删除未使用的代码，减少代码库复杂度，降低维护成本。清理范围包括服务方法、API端点、任务函数、辅助函数、模型字段和导入语句。

## Architecture

### 清理流程架构

```
┌─────────────────────────────────────────────────────────────┐
│                    死代码识别阶段                              │
├─────────────────────────────────────────────────────────────┤
│  1. 静态分析工具扫描                                          │
│     - AST 解析识别所有定义                                    │
│     - 引用关系图构建                                          │
│     - 未使用代码标记                                          │
│                                                              │
│  2. 动态引用检查                                              │
│     - 前端代码搜索 API 调用                                   │
│     - 调度器配置检查任务注册                                  │
│     - 测试代码引用验证                                        │
│                                                              │
│  3. 特殊场景识别                                              │
│     - 重复方法检测                                            │
│     - 未使用字段分析                                          │
│     - 导入语句清理                                            │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│                    死代码分类阶段                              │
├─────────────────────────────────────────────────────────────┤
│  高优先级：完全未使用且安全删除                                │
│  中优先级：可能未使用但需要进一步验证                          │
│  低优先级：使用频率低但可能有特殊用途                          │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│                    安全性验证阶段                              │
├─────────────────────────────────────────────────────────────┤
│  - 运行单元测试                                               │
│  - 检查外部依赖                                               │
│  - 数据库迁移影响分析                                         │
│  - Git 历史引用搜索                                           │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│                    代码清理执行阶段                            │
├─────────────────────────────────────────────────────────────┤
│  1. 按优先级顺序删除                                          │
│  2. 清理相关导入                                              │
│  3. 更新路由注册                                              │
│  4. 创建数据库迁移（如需要）                                  │
│  5. 运行测试验证                                              │
│  6. 生成变更日志                                              │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│                    结果验证阶段                                │
├─────────────────────────────────────────────────────────────┤
│  - 自动测试验证                                               │
│  - 手工验证关键功能                                           │
│  - 监控指标确认                                               │
└─────────────────────────────────────────────────────────────┘

```

## Target Components

（内容省略，详见原始设计文档）
