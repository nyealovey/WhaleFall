# 聚合统计功能重构需求文档

本文档概述聚合统计模块的重构需求，重点包括：

1. **死代码清理**：识别并移除未被调用的服务方法、任务函数和路由；清理未使用的导入与模型字段。
2. **重复逻辑合并**：统一周期计算、实例/数据库聚合逻辑，提取公共代码。
3. **服务层重构**：使用参数化方法与策略模式简化聚合服务；封装分区管理与同步会话。
4. **任务调度简化**：合并重复的调度函数，统一日志与错误处理。
5. **API 精简**：定位未被前端调用的端点，保留核心接口。
6. **数据层优化**：分析索引、查询性能，避免 N+1 查询。
7. **错误处理与日志**：结构化日志，区分异常类型，提升诊断能力。
8. **文档与注释**：补充文档字符串、流程注释及模块级 README。
9. **工具函数沉淀**：提取日期范围、统计指标、变化率等通用函数。
10. **测试覆盖提升**：单元/集成/回归测试，覆盖率目标 ≥ 80%。
