app/services/accounts/account_classifications_write_service.py	classification = AccountClassification.query.get(classification_id)
app/services/accounts/account_classifications_write_service.py	query = AccountClassification.query.filter(AccountClassification.name == name)
app/services/accounts/account_classifications_write_service.py	query = ClassificationRule.query.filter_by(
app/services/accounts/account_classifications_write_service.py	query = ClassificationRule.query.filter_by(
app/services/accounts/account_classifications_write_service.py	return bool(db.session.query(query.exists()).scalar())
app/services/accounts/account_classifications_write_service.py	return bool(db.session.query(query.exists()).scalar())
app/services/accounts/account_classifications_write_service.py	return bool(db.session.query(query.exists()).scalar())
app/services/accounts_sync/account_query_service.py	AccountPermission.query.join(instance_account_rel)
app/services/accounts_sync/accounts_sync_actions_service.py	active_count = Instance.query.filter_by(is_active=True).count()
app/services/accounts_sync/accounts_sync_actions_service.py	instance = Instance.query.filter_by(id=instance_id).first()
app/services/accounts_sync/accounts_sync_task_service.py	- 为 tasks 提供最小的读取能力(例如活跃实例列表),避免 tasks 直接 `.query`
app/services/accounts_sync/inventory_manager.py	existing_accounts = InstanceAccount.query.filter_by(instance_id=instance.id).all()
app/services/accounts_sync/permission_manager.py	existing = AccountPermission.query.filter_by(
app/services/accounts_sync/permission_manager.py	existing = AccountPermission.query.filter_by(instance_account_id=account.id).first()
app/services/aggregation/aggregation_service.py	instance = Instance.query.get(instance_id)
app/services/aggregation/aggregation_tasks_read_service.py	- 为 `app/tasks/capacity_aggregation_tasks.py` 提供最小读能力,避免 tasks 直接 `.query/db.session.query`
app/services/aggregation/aggregation_tasks_read_service.py	db.session.query(
app/services/aggregation/aggregation_tasks_read_service.py	db.session.query(DatabaseSizeAggregation.id)
app/services/aggregation/aggregation_tasks_read_service.py	db.session.query(InstanceSizeAggregation.id)
app/services/aggregation/aggregation_tasks_read_service.py	latest = DatabaseSizeAggregation.query.order_by(desc(DatabaseSizeAggregation.calculated_at)).first()
app/services/aggregation/aggregation_tasks_read_service.py	return Instance.query.get(instance_id)
app/services/aggregation/aggregation_tasks_read_service.py	return int(Instance.query.filter_by(is_active=True).count() or 0)
app/services/aggregation/database_aggregation_runner.py	db.session.query(
app/services/aggregation/database_aggregation_runner.py	db.session.query(
app/services/aggregation/database_aggregation_runner.py	existing = DatabaseSizeAggregation.query.filter(
app/services/aggregation/database_aggregation_runner.py	instances = Instance.query.filter_by(is_active=True).all()
app/services/aggregation/instance_aggregation_runner.py	aggregation = InstanceSizeAggregation.query.filter(
app/services/aggregation/instance_aggregation_runner.py	instances = Instance.query.filter_by(is_active=True).all()
app/services/aggregation/instance_aggregation_runner.py	prev_stats = InstanceSizeStat.query.filter(
app/services/aggregation/instance_aggregation_runner.py	return InstanceSizeStat.query.filter(
app/services/aggregation/query_service.py	query = DatabaseSizeAggregation.query.filter(
app/services/aggregation/query_service.py	query = InstanceSizeAggregation.query.filter(
app/services/auth/auth_me_read_service.py	user = User.query.get(user_id)
app/services/auth/login_service.py	user = User.query.filter_by(username=username).first()
app/services/cache/cache_actions_service.py	instance = Instance.query.get(instance_id)
app/services/cache/cache_actions_service.py	instance = Instance.query.get(instance_id)
app/services/cache/cache_actions_service.py	instances = Instance.query.filter_by(is_active=True).all()
app/services/capacity/capacity_tasks_read_service.py	- 为 `app/tasks/capacity_*` 提供最小读能力,避免 tasks 直接 `.query`
app/services/capacity/current_aggregation_service.py	active_instances = Instance.query.filter_by(is_active=True).all()
app/services/capacity/instance_capacity_sync_actions_service.py	instance = Instance.query.filter_by(id=instance_id).first()
app/services/credentials/credential_write_service.py	query = Credential.query.filter(Credential.name == name)
app/services/database_sync/database_sync_service.py	instances = Instance.query.filter_by(is_active=True).all()
app/services/database_sync/inventory_manager.py	existing_records: list[InstanceDatabase] = InstanceDatabase.query.filter_by(
app/services/database_sync/persistence.py	DatabaseSizeStat.query.outerjoin(
app/services/database_sync/persistence.py	db.session.execute(upsert_stmt)
app/services/database_sync/persistence.py	db.session.execute(upsert_stmt)
app/services/database_sync/table_size_coordinator.py	db.session.execute(insert_stmt)
app/services/database_sync/table_size_coordinator.py	query = DatabaseTableSizeStat.query.filter(
app/services/instances/batch_service.py	for row in db.session.execute(
app/services/instances/batch_service.py	instances = Instance.query.filter(Instance.id.in_(unique_ids)).all()
app/services/instances/batch_service.py	stats["deleted_account_permissions"] += AccountPermission.query.filter_by(
app/services/instances/batch_service.py	stats["deleted_assignments"] += AccountClassificationAssignment.query.filter(
app/services/instances/batch_service.py	stats["deleted_change_logs"] += AccountChangeLog.query.filter_by(
app/services/instances/batch_service.py	stats["deleted_database_size_aggregations"] += DatabaseSizeAggregation.query.filter_by(
app/services/instances/batch_service.py	stats["deleted_database_size_stats"] += DatabaseSizeStat.query.filter_by(
app/services/instances/batch_service.py	stats["deleted_instance_accounts"] += InstanceAccount.query.filter_by(
app/services/instances/batch_service.py	stats["deleted_instance_databases"] += InstanceDatabase.query.filter_by(
app/services/instances/batch_service.py	stats["deleted_instance_size_aggregations"] += InstanceSizeAggregation.query.filter_by(
app/services/instances/batch_service.py	stats["deleted_instance_size_stats"] += InstanceSizeStat.query.filter_by(
app/services/instances/batch_service.py	stats["deleted_sync_records"] += SyncInstanceRecord.query.filter_by(
app/services/instances/batch_service.py	tag_delete_result = db.session.execute(
app/services/partition_management_service.py	db.session.execute(text(comment_sql))
app/services/partition_management_service.py	db.session.execute(text(create_sql))
app/services/partition_management_service.py	db.session.execute(text(drop_sql))
app/services/partition_management_service.py	result = db.session.execute(stmt).scalar()
app/services/partition_management_service.py	result = db.session.execute(text(query), {"partition_name": partition_name}).scalar()
app/services/partition_management_service.py	rows = db.session.execute(
app/services/partition_management_service.py	rows = db.session.execute(text(query), {"pattern": pattern}).fetchall()
app/services/statistics/accounts_statistics_page_service.py	return Instance.query.filter_by(is_active=True).all()
app/services/statistics/accounts_statistics_page_service.py	return SyncSession.query.order_by(SyncSession.created_at.desc()).limit(limit).all()
app/services/tags/tags_bulk_actions_service.py	instances = Instance.query.filter(Instance.id.in_(instance_ids)).all()
app/services/tags/tags_bulk_actions_service.py	tags = Tag.query.filter(Tag.id.in_(tag_ids)).all()
app/services/users/user_write_service.py	admin_count = User.query.filter_by(role=UserRole.ADMIN).count()
