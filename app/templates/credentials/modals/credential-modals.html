{% set credential_modal_body %}
<form id="credentialModalForm" class="crud-modal" data-form-mode="create">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
    <input type="hidden" name="credential_id" id="credentialIdInput" />

    <div class="crud-modal__header">
        <span class="chip-outline chip-outline--brand">
            <i class="fas fa-key" aria-hidden="true"></i>
            <span>凭据配置</span>
        </span>
        <span class="status-pill status-pill--muted" id="credentialModalMetaPill">
            <i class="fas fa-sparkles" aria-hidden="true"></i>
            <span id="credentialModalMeta">新建</span>
        </span>
    </div>

    <div class="crud-modal__sections">
        <section class="crud-modal__section">
            <div class="crud-modal__section-title">
                <span class="chip-outline chip-outline--muted">
                    <i class="fas fa-layer-group" aria-hidden="true"></i>
                    <span>基础信息</span>
                </span>
                <span class="crud-modal__muted-text">用于标识凭据的名称与类型</span>
            </div>
            <div class="row g-3">
                <div class="col-md-6 col-12">
                    <label for="credentialName" class="form-label">凭据名称 <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" id="credentialName" name="name" placeholder="请输入凭据名称" required />
                </div>
                <div class="col-md-6 col-12">
                    <label for="credentialType" class="form-label">凭据类型 <span class="text-danger">*</span></label>
                    <select class="form-select" id="credentialType" name="credential_type" required>
                        <option value="">请选择类型</option>
                        {% for option in credential_type_options %}
                        {% if option.value != 'all' %}
                        <option value="{{ option.value }}">{{ option.label }}</option>
                        {% endif %}
                        {% endfor %}
                    </select>
                </div>
            </div>
        </section>

        <section class="crud-modal__section">
            <div class="crud-modal__section-title">
                <span class="chip-outline chip-outline--muted">
                    <i class="fas fa-user-lock" aria-hidden="true"></i>
                    <span>凭据主体</span>
                </span>
                <span class="crud-modal__muted-text">输入登录账号与口令</span>
            </div>
            <div class="row g-3">
                <div class="col-md-6 col-12">
                    <label for="credentialUsername" class="form-label">用户名 <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" id="credentialUsername" name="username" placeholder="请输入用户名" required autocomplete="username" />
                </div>
                <div class="col-md-6 col-12">
                    <label for="credentialPassword" class="form-label">密码 <span class="text-danger">*</span></label>
                    <div class="input-group">
                        <input type="password" class="form-control" id="credentialPassword" name="password" placeholder="请输入密码" required autocomplete="current-password" />
                        <button class="btn btn-outline-secondary" type="button" id="credentialTogglePassword" aria-label="显示或隐藏密码">
                            <i class="fas fa-eye" aria-hidden="true"></i>
                        </button>
                    </div>
                    <div class="crud-modal__hint chip-outline chip-outline--muted mt-2">
                        <i class="fas fa-shield-halved" aria-hidden="true"></i>
                        <span>密码仅用于连接验证，数据将加密存储</span>
                    </div>
                </div>
            </div>
        </section>

        <section class="crud-modal__section">
            <div class="crud-modal__section-title">
                <span class="chip-outline chip-outline--muted">
                    <i class="fas fa-sliders" aria-hidden="true"></i>
                    <span>可选设置</span>
                </span>
                <span class="crud-modal__muted-text">按需选择数据库类型与描述</span>
            </div>
            <div class="row g-3 align-items-start">
                <div class="col-md-6 col-12" id="credentialDbTypeField">
                    <label for="credentialDbType" class="form-label">数据库类型</label>
                    <select class="form-select" id="credentialDbType" name="db_type">
                        <option value="">请选择数据库类型</option>
                        {% for option in db_type_options %}
                        <option value="{{ option.value }}">{{ option.label }}</option>
                        {% endfor %}
                    </select>
                    <div class="crud-modal__muted-text mt-2">仅当凭据类型为“数据库”时需要选择</div>
                </div>
                <div class="col-md-6 col-12">
                    <label for="credentialDescription" class="form-label">描述</label>
                    <textarea class="form-control" id="credentialDescription" name="description" rows="3" placeholder="请输入凭据描述"></textarea>
                </div>
            </div>
        </section>
    </div>
</form>
{% endset %}

{% set credential_modal_footer %}
<div class="me-auto">
    <div class="form-check form-switch mb-0">
        <input class="form-check-input" type="checkbox" role="switch" id="credentialIsActive" name="is_active" value="1" checked form="credentialModalForm" />
        <label class="form-check-label" for="credentialIsActive">启用此凭据</label>
    </div>
</div>
<button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal" aria-label="取消并关闭模态">取消</button>
<button type="submit" class="btn btn-primary" data-modal-confirm id="credentialModalSubmit" form="credentialModalForm" aria-label="提交新凭据">添加凭据</button>
{% endset %}

{% with
    modal_id='credentialModal',
    modal_label_id='credentialModalLabel',
    title='<i class="fas fa-key me-2"></i><span id="credentialModalTitle">添加凭据</span>',
    body=credential_modal_body,
    footer=credential_modal_footer,
    size='lg',
    body_class='p-4'
%}
    {% include 'components/ui/modal.html' %}
{% endwith %}
