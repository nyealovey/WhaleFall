<!-- 编辑任务模态框 -->
<div class="modal fade" id="editJobModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-edit me-2"></i>编辑定时任务
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form id="editJobForm">
                <div class="modal-body">
                    <div class="crud-modal">
                        <input type="hidden" id="editJobId" name="job_id" />
                        <input type="hidden" name="editTriggerType" value="cron">

                        <div class="crud-modal__header">
                            <span class="chip-outline chip-outline--brand"><i class="fas fa-tasks me-2"></i>任务配置</span>
                            <span class="status-pill status-pill--info">编辑</span>
                        </div>

                        <div class="crud-modal__sections">
                            <section class="crud-modal__section">
                                <div class="crud-modal__section-title chip-outline chip-outline--muted">
                                    <i class="fas fa-info-circle me-2"></i>基础信息
                                </div>
                                <div class="row g-3">
                                    <div class="col-md-6 col-12">
                                        <label for="editJobName" class="form-label">任务名称 <span class="text-danger">*</span></label>
                                        <input type="text" class="form-control" id="editJobName" name="name" required>
                                        <div class="crud-modal__hint chip-outline chip-outline--muted">
                                            <i class="fas fa-tag"></i>建议使用可读性强的任务描述名称
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-12">
                                        <label for="editJobFunction" class="form-label">执行函数 <span class="text-danger">*</span></label>
                                        <select class="form-select" id="editJobFunction" name="func" required>
                                            <option value="">请选择函数</option>
                                            <option value="sync_accounts">同步所有账户</option>
                                            <option value="cleanup_old_logs">清理旧日志</option>
                                            <option value="monitor_partition_health">监控分区健康状态</option>
                                            <option value="collect_database_sizes">容量同步</option>
                                            <option value="calculate_database_size_aggregations">统计聚合</option>
                                        </select>
                                        <div class="crud-modal__hint chip-outline chip-outline--muted">
                                            <i class="fas fa-code"></i>函数名称由后端注册，编辑时仅可查看
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <label for="editJobDescription" class="form-label">任务描述</label>
                                        <textarea class="form-control" id="editJobDescription" name="description" rows="2" placeholder="可选，记录任务用途与风险提示"></textarea>
                                    </div>
                                </div>
                            </section>

                            <section class="crud-modal__section edit-trigger-config show" id="editCronConfig">
                                <div class="crud-modal__section-title chip-outline chip-outline--muted">
                                    <i class="fas fa-clock me-2"></i>Cron 调度
                                </div>
                                <div class="row g-3">
                                    <div class="col-6 col-md-4 col-lg-3">
                                        <label for="editCronSecond" class="form-label">秒 <span class="text-danger">*</span></label>
                                        <input type="text" class="form-control" id="editCronSecond" name="cron_second" placeholder="0-59" value="0">
                                    </div>
                                    <div class="col-6 col-md-4 col-lg-3">
                                        <label for="editCronMinute" class="form-label">分钟 <span class="text-danger">*</span></label>
                                        <input type="text" class="form-control" id="editCronMinute" name="cron_minute" placeholder="0-59" value="0">
                                    </div>
                                    <div class="col-6 col-md-4 col-lg-3">
                                        <label for="editCronHour" class="form-label">小时 <span class="text-danger">*</span></label>
                                        <input type="text" class="form-control" id="editCronHour" name="cron_hour" placeholder="0-23" value="0">
                                    </div>
                                    <div class="col-6 col-md-4 col-lg-3">
                                        <label for="editCronDay" class="form-label">日 <span class="text-danger">*</span></label>
                                        <input type="text" class="form-control" id="editCronDay" name="cron_day" placeholder="1-31" value="*">
                                    </div>
                                    <div class="col-6 col-md-4 col-lg-3">
                                        <label for="editCronMonth" class="form-label">月份 <span class="text-danger">*</span></label>
                                        <input type="text" class="form-control" id="editCronMonth" name="cron_month" placeholder="1-12" value="*">
                                    </div>
                                    <div class="col-6 col-md-4 col-lg-3">
                                        <label for="editCronWeekday" class="form-label">星期 <span class="text-danger">*</span></label>
                                        <input type="text" class="form-control" id="editCronWeekday" name="cron_weekday" placeholder="0-6" value="*">
                                    </div>
                                    <div class="col-12 col-md-4 col-lg-3">
                                        <label for="editCronYear" class="form-label">年份</label>
                                        <input type="text" class="form-control" id="editCronYear" name="year" placeholder="2025 或 *" value="*">
                                    </div>
                                </div>
                                <div class="crud-modal__toggle mt-3">
                                    <div>
                                        <span class="chip-outline chip-outline--muted">Cron 预览</span>
                                        <p class="mb-0 crud-modal__muted-text">实时展示当前表达式</p>
                                    </div>
                                    <input type="text" class="form-control form-control-sm" id="editCronPreview" readonly placeholder="生成的 Cron 表达式">
                                </div>
                                <div class="crud-modal__hint chip-outline chip-outline--muted mt-3">
                                    <i class="fas fa-lightbulb"></i>使用 * 表示任意值，"," 分隔多个值，"-" 表示范围，"/" 表示步长
                                </div>
                            </section>

                            <section id="editIntervalConfig" class="crud-modal__section edit-trigger-config" style="display:none;">
                                <div class="crud-modal__section-title chip-outline chip-outline--muted">
                                    <i class="fas fa-redo me-2"></i>间隔调度
                                </div>
                                <div class="row g-3">
                                    <div class="col-md-4 col-6">
                                        <label for="editIntervalMinutes" class="form-label">间隔（分钟）</label>
                                        <input type="number" min="0" class="form-control" id="editIntervalMinutes" name="interval_minutes" value="0">
                                    </div>
                                    <div class="col-md-4 col-6">
                                        <label for="editIntervalSeconds" class="form-label">间隔（秒）</label>
                                        <input type="number" min="0" class="form-control" id="editIntervalSeconds" name="interval_seconds" value="0">
                                    </div>
                                </div>
                                <div class="crud-modal__hint chip-outline chip-outline--muted mt-2">
                                    <i class="fas fa-info-circle"></i>分钟与秒可同时配置，最终由 APScheduler IntervalTrigger 解析
                                </div>
                            </section>

                            <section id="editDateConfig" class="crud-modal__section edit-trigger-config" style="display:none;">
                                <div class="crud-modal__section-title chip-outline chip-outline--muted">
                                    <i class="fas fa-flag-checkered me-2"></i>单次调度
                                </div>
                                <div class="row g-3">
                                    <div class="col-md-6 col-12">
                                        <label for="editRunDate" class="form-label">运行时间</label>
                                        <input type="datetime-local" class="form-control" id="editRunDate" name="run_date">
                                        <div class="crud-modal__hint chip-outline chip-outline--muted">
                                            <i class="fas fa-calendar"></i>请选择未来时间，格式 YYYY-MM-DD HH:mm
                                        </div>
                                    </div>
                                </div>
                            </section>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="submit" class="btn btn-primary">保存修改</button>
                </div>
            </form>
        </div>
    </div>
</div>
