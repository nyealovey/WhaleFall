{% macro render_field(field, value=None) -%}
    <div class="mb-3" data-field="{{ field.name }}">
        {% if field.component in ['text', 'number'] %}
            <label for="{{ field.name }}" class="form-label">
                {{ field.label }}
                {% if field.required %}<span class="text-danger">*</span>{% endif %}
            </label>
            <input
                type="{{ 'number' if field.component == 'number' else 'text' }}"
                class="form-control"
                id="{{ field.name }}"
                name="{{ field.name }}"
                value="{{ value if value is not none else field.default or '' }}"
                {% if field.placeholder %}placeholder="{{ field.placeholder }}"{% endif %}
                {% if field.required %}required{% endif %}
            >
        {% elif field.component == 'textarea' %}
            <label for="{{ field.name }}" class="form-label">
                {{ field.label }}
                {% if field.required %}<span class="text-danger">*</span>{% endif %}
            </label>
            <textarea
                class="form-control"
                id="{{ field.name }}"
                name="{{ field.name }}"
                rows="{{ field.props.get('rows', 3) }}"
                {% if field.placeholder %}placeholder="{{ field.placeholder }}"{% endif %}
                {% if field.required %}required{% endif %}
            >{{ value if value is not none else field.default or '' }}</textarea>
        {% elif field.component == 'select' %}
            <label for="{{ field.name }}" class="form-label">
                {{ field.label }}
                {% if field.required %}<span class="text-danger">*</span>{% endif %}
            </label>
            <select
                class="form-select"
                id="{{ field.name }}"
                name="{{ field.name }}"
                {% if field.required %}required{% endif %}
            >
                {% if field.props.get('allow_empty', True) %}
                <option value="">{{ field.placeholder or '请选择' }}</option>
                {% endif %}
                {% for option in field.options %}
                {% set selected = (value|string) == (option.value|string) %}
                <option value="{{ option.value }}" {% if selected %}selected{% endif %}>
                    {{ option.label }}
                </option>
                {% endfor %}
            </select>
        {% elif field.component in ['checkbox', 'switch'] %}
            <div class="form-check form-switch">
                <input
                    class="form-check-input"
                    type="checkbox"
                    id="{{ field.name }}"
                    name="{{ field.name }}"
                    value="1"
                    {% if value or field.default %}checked{% endif %}
                >
                <label class="form-check-label" for="{{ field.name }}">
                    {{ field.label }}
                </label>
            </div>
        {% endif %}
        {% if field.help_text %}
            <div class="form-text">{{ field.help_text }}</div>
        {% endif %}
    </div>
{%- endmacro %}

{% macro render_fields(fields, data) -%}
    {% for field in fields %}
        {{ render_field(field, data.get(field.name)) }}
    {% endfor %}
{%- endmacro %}
