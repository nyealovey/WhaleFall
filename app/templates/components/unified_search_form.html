<!-- 统一搜索表单组件 -->
<div class="card search-filter-card">
    <div class="card-body">
        <form method="GET" class="unified-search-form" id="{{ form_id|default('unified-search-form') }}" action="{{ form_action|default('') }}">
            <div class="row g-3 align-items-end">
                <!-- 左侧筛选条件区域 -->
                <div class="col-md-10">
                    <div class="row g-3">
                        <!-- 搜索输入框 -->
                        {% if show_search_input|default(true) %}
                        <div class="col-md-3">
                            <label for="{{ search_field_id|default('search') }}" class="form-label">搜索</label>
                            <input type="text" 
                                   class="form-control unified-input" 
                                   id="{{ search_field_id|default('search') }}"
                                   name="{{ search_field_name|default('search') }}"
                                   placeholder="{{ search_placeholder|default('搜索关键词') }}"
                                   value="{{ search_value|default('') }}">
                        </div>
                        {% endif %}
                
                        <!-- 数据库类型筛选 -->
                        {% if show_db_type_filter|default(false) %}
                        <div class="col-md-2 filter-db-type">
                            <label for="db_type" class="form-label">数据库类型</label>
                            <select class="form-select unified-select" id="db_type" name="db_type">
                                <option value="">全部类型</option>
                                {% for db_type_config in database_types|default([]) %}
                                <option value="{{ db_type_config.name }}" 
                                        {% if db_type == db_type_config.name %}selected{% endif %}>
                                    {{ db_type_config.display_name }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                        {% endif %}
                
                        <!-- 实例筛选 -->
                        {% if show_instance_filter|default(false) %}
                        <div class="col-md-2 filter-instance">
                            <label for="instance" class="form-label">实例</label>
                            <select class="form-select unified-select" id="instance" name="instance">
                                <option value="">所有实例</option>
                                {% for instance_item in instances_list|default([]) %}
                                <option value="{{ instance_item.id }}" 
                                        {% if instance == instance_item.id|string %}selected{% endif %}>
                                    {{ instance_item.name }} ({{ instance_item.db_type }})
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                        {% endif %}
                
                        <!-- 数据库筛选 -->
                        {% if show_database_filter|default(false) %}
                        <div class="col-md-2 filter-database">
                            <label for="database" class="form-label">数据库</label>
                            <select class="form-select unified-select" id="database" name="database_id" data-initial-value="{{ database_id|default(database|default('')) }}">
                                <option value="">所有数据库</option>
                                {% for db_name in databases_list|default([]) %}
                                <option value="{{ db_name }}" {% if database == db_name %}selected{% endif %}>
                                    {{ db_name }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                        {% endif %}
                
                        <!-- 统计周期筛选 -->
                        {% if show_period_type_filter|default(false) %}
                        <div class="col-md-2 filter-period-type">
                            <label for="period_type" class="form-label">统计周期</label>
                            <select class="form-select unified-select" id="period_type" name="period_type">
                                <option value="daily" {% if period_type == 'daily' or period_type == '' %}selected{% endif %}>日统计</option>
                                <option value="weekly" {% if period_type == 'weekly' %}selected{% endif %}>周统计</option>
                                <option value="monthly" {% if period_type == 'monthly' %}selected{% endif %}>月统计</option>
                                <option value="quarterly" {% if period_type == 'quarterly' %}selected{% endif %}>季统计</option>
                            </select>
                        </div>
                        {% endif %}
                
                        <!-- 分类筛选 -->
                        {% if show_classification_filter|default(false) %}
                        <div class="col-md-2 filter-classification">
                            <label for="classification" class="form-label">分类筛选</label>
                            <select class="form-select unified-select" id="classification" name="classification">
                                <option value="">全部分类</option>
                                {% for classification_item in classifications_list|default([]) %}
                                <option value="{{ classification_item.id }}" 
                                        {% if classification == classification_item.id|string %}selected{% endif %}>
                                    {{ classification_item.name }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                        {% endif %}
                
                        <!-- 凭据类型筛选 -->
                        {% if show_credential_type_filter|default(false) %}
                        <div class="col-md-2 filter-credential-type">
                            <label for="credential_type" class="form-label">凭据类型</label>
                            <select class="form-select unified-select" id="credential_type" name="credential_type">
                                <option value="">全部类型</option>
                                <option value="database" {% if credential_type == 'database' %}selected{% endif %}>数据库凭据</option>
                                <option value="api" {% if credential_type == 'api' %}selected{% endif %}>API凭据</option>
                                <option value="ssh" {% if credential_type == 'ssh' %}selected{% endif %}>SSH凭据</option>
                            </select>
                        </div>
                        {% endif %}
                
                        <!-- 标签分类筛选 -->
                        {% if show_tag_category_filter|default(false) %}
                        <div class="col-md-2 filter-category">
                            <label for="category" class="form-label">分类</label>
                            <select class="form-select unified-select" id="category" name="category">
                                <option value="">全部分类</option>
                                {% for cat_value, cat_name in categories|default([]) %}
                                <option value="{{ cat_value }}" {% if category == cat_value %}selected{% endif %}>
                                    {{ cat_name }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                        {% endif %}
                
                        <!-- 同步分类筛选 -->
                        {% if show_sync_category_filter|default(false) %}
                        <div class="col-md-2 filter-sync-category">
                            <label for="sync_category" class="form-label">同步分类</label>
                            <select class="form-select unified-select" id="sync_category" name="sync_category">
                                <option value="">全部分类</option>
                                <option value="account" {% if sync_category == 'account' %}selected{% endif %}>账户同步</option>
                                <option value="capacity" {% if sync_category == 'capacity' %}selected{% endif %}>容量同步</option>
                                <option value="config" {% if sync_category == 'config' %}selected{% endif %}>配置同步</option>
                                <option value="aggregation" {% if sync_category == 'aggregation' %}selected{% endif %}>聚合统计</option>
                                <option value="other" {% if sync_category == 'other' %}selected{% endif %}>其他</option>
                            </select>
                        </div>
                        {% endif %}
                
                        <!-- 同步操作方式筛选 -->
                        {% if show_sync_type_filter|default(false) %}
                        <div class="col-md-2 filter-sync-type">
                            <label for="sync_type" class="form-label">操作方式</label>
                            <select class="form-select unified-select" id="sync_type" name="sync_type">
                                <option value="">全部方式</option>
                                <option value="manual_single" {% if sync_type == 'manual_single' %}selected{% endif %}>手动单台</option>
                                <option value="manual_batch" {% if sync_type == 'manual_batch' %}selected{% endif %}>手动批量</option>
                                <option value="manual_task" {% if sync_type == 'manual_task' %}selected{% endif %}>手动任务</option>
                                <option value="scheduled_task" {% if sync_type == 'scheduled_task' %}selected{% endif %}>定时任务</option>
                            </select>
                        </div>
                        {% endif %}
                
                        <!-- 状态筛选 -->
                        {% if show_status_filter|default(false) %}
                        <div class="col-md-2 filter-status">
                            <label for="status" class="form-label">状态</label>
                            <select class="form-select unified-select" id="status" name="status">
                                {% if status_filter_type == 'sync_session' %}
                                <!-- 同步会话状态选项 -->
                                <option value="" {% if status == '' %}selected{% endif %}>全部状态</option>
                                <option value="running" {% if status == 'running' %}selected{% endif %}>running</option>
                                <option value="completed" {% if status == 'completed' %}selected{% endif %}>completed</option>
                                <option value="failed" {% if status == 'failed' %}selected{% endif %}>failed</option>
                                <option value="cancelled" {% if status == 'cancelled' %}selected{% endif %}>cancelled</option>
                                {% elif status_filter_type == 'sync_record' %}
                                <!-- 同步记录状态选项 -->
                                <option value="" {% if status == '' %}selected{% endif %}>全部状态</option>
                                <option value="running" {% if status == 'running' %}selected{% endif %}>running</option>
                                <option value="completed" {% if status == 'completed' %}selected{% endif %}>completed</option>
                                <option value="failed" {% if status == 'failed' %}selected{% endif %}>failed</option>
                                <option value="cancelled" {% if status == 'cancelled' %}selected{% endif %}>cancelled</option>
                                {% else %}
                                <!-- 默认状态选项 -->
                                <option value="all" {% if status == 'all' %}selected{% endif %}>全部状态</option>
                                <option value="active" {% if status == 'active' %}selected{% endif %}>激活</option>
                                <option value="inactive" {% if status == 'inactive' %}selected{% endif %}>禁用</option>
                                {% endif %}
                            </select>
                        </div>
                        {% endif %}
                
                        <!-- 日志级别筛选 -->
                        {% if show_level_filter|default(false) %}
                        <div class="col-md-2 filter-level">
                            <label for="levelFilter" class="form-label">日志级别</label>
                            <select class="form-select unified-select" id="levelFilter" name="level">
                                <option value="">全部级别</option>
                                <option value="DEBUG" {% if level == 'DEBUG' %}selected{% endif %}>DEBUG</option>
                                <option value="INFO" {% if level == 'INFO' %}selected{% endif %}>INFO</option>
                                <option value="WARNING" {% if level == 'WARNING' %}selected{% endif %}>WARNING</option>
                                <option value="ERROR" {% if level == 'ERROR' %}selected{% endif %}>ERROR</option>
                                <option value="CRITICAL" {% if level == 'CRITICAL' %}selected{% endif %}>CRITICAL</option>
                            </select>
                        </div>
                        {% endif %}
                
                        <!-- 模块筛选 -->
                        {% if show_module_filter|default(false) %}
                        <div class="col-md-2 filter-module">
                            <label for="moduleFilter" class="form-label">模块</label>
                            <select class="form-select unified-select" id="moduleFilter" name="module">
                                <option value="">全部模块</option>
                                {% for module_name in modules_list|default([]) %}
                                <option value="{{ module_name }}" {% if module == module_name %}selected{% endif %}>
                                    {{ module_name }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                        {% endif %}
                
                        <!-- 时间范围筛选 -->
                        {% if show_time_range_filter|default(false) %}
                        <div class="col-md-2 filter-time-range">
                            <label for="timeRange" class="form-label">时间范围</label>
                            <select class="form-select unified-select" id="timeRange" name="time_range">
                                <option value="7" {% if time_range == '7' or time_range == '' %}selected{% endif %}>最近7天</option>
                                <option value="30" {% if time_range == '30' %}selected{% endif %}>最近30天</option>
                                <option value="3" {% if time_range == '3' %}selected{% endif %}>最近3个月</option>
                                <option value="6" {% if time_range == '6' %}selected{% endif %}>最近6个月</option>
                                <option value="12" {% if time_range == '12' %}selected{% endif %}>最近1年</option>
                                <option value="24" {% if time_range == '24' %}selected{% endif %}>最近2年</option>
                            </select>
                        </div>
                        {% endif %}
                
                        <!-- 标签选择按钮 -->
                        {% if show_tag_filter|default(true) %}
                        <div class="col-md-4 filter-tags">
                            <label class="form-label">标签筛选</label>
                            <div class="d-flex align-items-center gap-2 tag-filter-container">
                                <button type="button" class="btn tag-selector-btn" id="open-tag-filter-btn">
                                    <i class="fas fa-tags me-2"></i>选择标签
                                </button>
                                <div class="d-flex flex-wrap gap-1 align-items-center flex-grow-1" id="selected-tags-chips">
                                </div>
                            </div>
                            <input type="hidden" id="selected-tag-names" name="tags" value="{{ selected_tags|join(',') }}">
                        </div>
                        {% endif %}
                    </div>
                </div>
                
                <!-- 右侧操作按钮区域 -->
                <div class="col-md-2">
                    <div class="d-grid gap-2">
                        <button type="button" id="applyFilters" class="btn unified-search-btn">
                            <i class="fas fa-filter me-1"></i>{{ search_button_text|default('筛选') }}
                        </button>
                        <button type="button" class="btn unified-clear-btn" onclick="clearUnifiedSearch()">
                            <i class="fas fa-times me-1"></i>清除
                        </button>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- 标签选择器模态框由各个页面自己包含 -->
