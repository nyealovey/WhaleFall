{% macro classification_form(form_id, ids, color_options, color_preview_id, hidden_id=None, default_risk='medium') -%}
<form id="{{ form_id }}">
    {% if hidden_id %}
    <input type="hidden" id="{{ hidden_id }}">
    {% endif %}
    <div class="mb-3">
        <label for="{{ ids.name }}" class="form-label">分类名称 <span class="text-danger">*</span></label>
        <input type="text" class="form-control" id="{{ ids.name }}" required>
    </div>
    <div class="mb-3">
        <label for="{{ ids.description }}" class="form-label">描述</label>
        <textarea class="form-control" id="{{ ids.description }}" rows="3"></textarea>
    </div>
    <div class="row">
        <div class="col-6">
            <div class="mb-3">
                <label for="{{ ids.risk }}" class="form-label">风险等级</label>
                <select class="form-select" id="{{ ids.risk }}">
                    {% for value, label in [('low', '低风险'), ('medium', '中风险'), ('high', '高风险'), ('critical', '极高风险')] %}
                    <option value="{{ value }}" {% if value == default_risk %}selected{% endif %}>{{ label }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
        <div class="col-6">
            <div class="mb-3">
                <label for="{{ ids.color }}" class="form-label">显示颜色</label>
                <select class="form-select" id="{{ ids.color }}" required>
                    <option value="">请选择颜色</option>
                    {% for key, info in color_options.items() %}
                    <option value="{{ key }}" data-color="{{ info.value }}">
                        {{ info.name }} - {{ info.description }}
                    </option>
                    {% endfor %}
                </select>
                <div class="form-text">
                    <div id="{{ color_preview_id }}" class="color-preview-container mt-2" style="display: none;">
                        <span class="color-preview-dot"></span>
                        <span class="color-preview-text"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="mb-3">
        <label class="form-label">图标选择</label>
        <div class="row">
            {% for icon, label, color in [
                ('fa-crown', '皇冠', 'text-warning'),
                ('fa-shield-alt', '盾牌', 'text-primary'),
                ('fa-exclamation-triangle', '警告', 'text-danger'),
                ('fa-user', '用户', 'text-info'),
                ('fa-eye', '眼睛', 'text-success'),
                ('fa-tag', '标签', 'text-secondary')
            ] %}
            <div class="col-2">
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="{{ ids.icon }}" id="{{ ids.icon }}{{ loop.index }}" value="{{ icon }}" {% if icon == 'fa-tag' %}checked{% endif %}>
                    <label class="form-check-label" for="{{ ids.icon }}{{ loop.index }}">
                        <i class="fas {{ icon }} {{ color }}"></i> {{ label }}
                    </label>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    <div class="mb-3">
        <label for="{{ ids.priority }}" class="form-label">优先级</label>
        <input type="number" class="form-control" id="{{ ids.priority }}" value="0" min="0" max="100">
        <div class="form-text">数字越大优先级越高，用于控制显示与匹配顺序</div>
    </div>
</form>
{%- endmacro %}

{% macro rule_form(form_id, ids, disable_db_type=False, hidden_id=None, permissions_container_id='permissionsConfig') -%}
<form id="{{ form_id }}">
    {% if hidden_id %}
    <input type="hidden" id="{{ hidden_id }}">
    {% endif %}
    <div class="row">
        <div class="col-6">
            <div class="mb-3">
                <label for="{{ ids.classification }}" class="form-label">分类 <span class="text-danger">*</span></label>
                <select class="form-select" id="{{ ids.classification }}" required>
                    <option value="">请选择分类</option>
                </select>
            </div>
        </div>
        <div class="col-6">
            <div class="mb-3">
                <label for="{{ ids.name }}" class="form-label">规则名称 <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="{{ ids.name }}" required>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-6">
            <div class="mb-3">
                <label for="{{ ids.db_type }}" class="form-label">数据库类型 <span class="text-danger">*</span></label>
                <select class="form-select" id="{{ ids.db_type }}" {% if disable_db_type %}disabled{% endif %} required>
                    <option value="">请选择数据库类型</option>
                    {% for value, label in [('mysql','MySQL'), ('postgresql','PostgreSQL'), ('sqlserver','SQL Server'), ('oracle','Oracle')] %}
                    <option value="{{ value }}">{{ label }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
        <div class="col-6">
            <div class="mb-3">
                <label for="{{ ids.operator }}" class="form-label">匹配逻辑 <span class="text-danger">*</span></label>
                <select class="form-select" id="{{ ids.operator }}" required>
                    <option value="OR">OR (任一条件满足)</option>
                    <option value="AND">AND (全部条件满足)</option>
                </select>
                <div class="form-text">选择权限匹配的逻辑关系</div>
            </div>
        </div>
    </div>
    <div class="mb-3">
        <label class="form-label">权限配置</label>
        <div id="{{ permissions_container_id }}">
            <div class="text-center text-muted py-3">
                <i class="fas fa-info-circle me-2"></i>请先选择数据库类型
            </div>
        </div>
    </div>
</form>
{%- endmacro %}
