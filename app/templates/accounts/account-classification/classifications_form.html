{% extends "base.html" %}
{% set page_id = 'AccountClassificationFormPage' %}

{% from 'components/ui/page_header.html' import page_header %}

{% set is_edit = form_mode == 'edit' %}
{% set form_values = form_data if form_data else {} %}
{% set is_system = resource.is_system if resource else False %}

{% block title %}{{ '编辑账户分类' if is_edit else '创建账户分类' }} - 鲸落{% endblock %}

{% block content_outer %}
{{ page_header('fas fa-tags', '编辑账户分类' if is_edit else '创建账户分类', '配置分类标识、风险等级与展示信息') }}

<section class="page-section">
    <div class="layout-shell">
        <div class="layout-shell-inner">
            <div class="row justify-content-center">
                <div class="col-12 col-lg-8">
                    <div class="card">
                        <div class="card-body p-4 p-lg-5">
                            {% if form_errors %}
                            <div class="alert alert-danger" role="alert">
                                <i class="fas fa-exclamation-circle me-2" aria-hidden="true"></i>{{ form_errors }}
                            </div>
                            {% endif %}

                            <form method="POST">
                                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />

                                <div class="mb-3">
                                    <label for="code" class="form-label">分类标识(code) <span class="text-danger">*</span></label>
                                    <input
                                        type="text"
                                        class="form-control"
                                        id="code"
                                        name="code"
                                        required
                                        placeholder="例如: super (全小写,创建后不可修改)"
                                        value="{{ form_values.get('code') if form_values.get('code') is not none else (resource.code if resource else '') }}"
                                        {% if is_edit %}disabled{% endif %}
                                    />
                                </div>

                                <div class="mb-3">
                                    <label for="display_name" class="form-label">分类名称</label>
                                    <input
                                        type="text"
                                        class="form-control"
                                        id="display_name"
                                        name="display_name"
                                        placeholder="例如: 超高风险"
                                        value="{{ form_values.get('display_name') if form_values.get('display_name') is not none else (resource.display_name if resource else '') }}"
                                    />
                                </div>

                                <div class="mb-3">
                                    <label for="description" class="form-label">描述</label>
                                    <textarea class="form-control" id="description" name="description" rows="3" placeholder="可选, 用于补充说明">{{ form_values.get('description') if form_values.get('description') is not none else (resource.description if resource else '') }}</textarea>
                                </div>

                                {% set selected_risk = form_values.get('risk_level') if form_values.get('risk_level') is not none else (resource.risk_level if resource else 4) %}
                                <div class="mb-3">
                                    <label for="risk_level" class="form-label">风险等级</label>
                                    <select class="form-select" id="risk_level" name="risk_level" {% if is_system %}disabled{% endif %}>
                                        {% for option in risk_level_options or [] %}
                                        <option value="{{ option.value }}" {% if option.value|string == selected_risk|string %}selected{% endif %}>{{ option.label }}</option>
                                        {% endfor %}
                                    </select>
                                </div>

                                {% set selected_icon = form_values.get('icon_name') if form_values.get('icon_name') is not none else (resource.icon_name if resource else 'fa-tag') %}
                                <div class="mb-3">
                                    <label for="icon_name" class="form-label">图标</label>
                                    <select class="form-select" id="icon_name" name="icon_name" {% if is_system %}disabled{% endif %}>
                                        {% for option in icon_options or [] %}
                                        <option value="{{ option.value }}" {% if option.value == selected_icon %}selected{% endif %}>{{ option.label }}</option>
                                        {% endfor %}
                                    </select>
                                </div>

                                {% set priority_value = form_values.get('priority') if form_values.get('priority') is not none else (resource.priority if resource else 0) %}
                                <div class="mb-4">
                                    <label for="priority" class="form-label">优先级</label>
                                    <input
                                        type="number"
                                        class="form-control"
                                        id="priority"
                                        name="priority"
                                        min="0"
                                        max="100"
                                        value="{{ priority_value }}"
                                    />
                                    <div class="form-text">数字越大优先级越高,仅影响排序</div>
                                </div>

                                <div class="d-flex flex-wrap gap-2">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save me-2" aria-hidden="true"></i>{{ '保存' if is_edit else '创建' }}
                                    </button>
                                    <a class="btn btn-outline-secondary" href="{{ url_for('accounts_classifications.index') }}">
                                        <i class="fas fa-arrow-left me-2" aria-hidden="true"></i>返回
                                    </a>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}
