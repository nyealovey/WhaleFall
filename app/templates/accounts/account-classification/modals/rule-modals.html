{# 规则新建/编辑模态 #}
{% set create_rule_modal_body %}
    <form id="createRuleForm">
        <div class="row">
            <div class="col-6">
                <div class="mb-3">
                    <label for="ruleClassification" class="form-label">分类 <span class="text-danger">*</span></label>
                    <select class="form-select" id="ruleClassification" required>
                        <option value="">请选择分类</option>
                    </select>
                </div>
            </div>
            <div class="col-6">
                <div class="mb-3">
                    <label for="ruleName" class="form-label">规则名称 <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" id="ruleName" required>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-6">
                <div class="mb-3">
                    <label for="ruleDbType" class="form-label">数据库类型 <span class="text-danger">*</span></label>
                    <select class="form-select" id="ruleDbType" required onchange="loadPermissions()">
                        <option value="">请选择数据库类型</option>
                        <option value="mysql">MySQL</option>
                        <option value="postgresql">PostgreSQL</option>
                        <option value="sqlserver">SQL Server</option>
                        <option value="oracle">Oracle</option>
                    </select>
                </div>
            </div>
            <div class="col-6">
                <div class="mb-3">
                    <label for="ruleOperator" class="form-label">匹配逻辑 <span class="text-danger">*</span></label>
                    <select class="form-select" id="ruleOperator" required>
                        <option value="OR">OR (任一条件满足即可)</option>
                        <option value="AND">AND (所有条件都必须满足)</option>
                    </select>
                    <div class="form-text">选择权限匹配的逻辑关系</div>
                </div>
            </div>
        </div>
        <div class="mb-3">
            <label class="form-label">权限配置</label>
            {% with permissions_id='permissionsConfig' %}
                {% include 'accounts/account-classification/permissions/policy-center-view.html' %}
            {% endwith %}
        </div>
    </form>
{% endset %}
{% set create_rule_modal_footer %}
    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-modal-cancel>取消</button>
    <button type="button" class="btn btn-primary" data-modal-confirm id="createRuleConfirm">创建</button>
{% endset %}
{% with
    modal_id='createRuleModal',
    modal_label_id='createRuleModalLabel',
    title='<i class="fas fa-cogs me-2"></i>新建分类规则',
    body=create_rule_modal_body,
    footer=create_rule_modal_footer,
    size='lg'
%}
    {% include 'components/ui/modal.html' %}
{% endwith %}

{% set edit_rule_modal_body %}
    <form id="editRuleForm">
        <input type="hidden" id="editRuleId">
        <div class="row">
            <div class="col-6">
                <div class="mb-3">
                    <label for="editRuleClassification" class="form-label">分类 <span class="text-danger">*</span></label>
                    <select class="form-select" id="editRuleClassification" required>
                        <option value="">请选择分类</option>
                    </select>
                </div>
            </div>
            <div class="col-6">
                <div class="mb-3">
                    <label for="editRuleName" class="form-label">规则名称 <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" id="editRuleName" required>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-6">
                <div class="mb-3">
                    <label for="editRuleDbType" class="form-label">数据库类型 <span class="text-danger">*</span></label>
                    <select class="form-select" id="editRuleDbType" required disabled>
                        <option value="mysql">MySQL</option>
                        <option value="postgresql">PostgreSQL</option>
                        <option value="sqlserver">SQL Server</option>
                        <option value="oracle">Oracle</option>
                    </select>
                    <input type="hidden" id="editRuleDbTypeHidden">
                </div>
            </div>
            <div class="col-6">
                <div class="mb-3">
                    <label for="editRuleOperator" class="form-label">匹配逻辑 <span class="text-danger">*</span></label>
                    <select class="form-select" id="editRuleOperator" required>
                        <option value="OR">OR (任一条件满足即可)</option>
                        <option value="AND">AND (所有条件都必须满足)</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="mb-3">
            <label class="form-label">权限配置</label>
            {% with permissions_id='editPermissionsConfig' %}
                {% include 'accounts/account-classification/permissions/policy-center-view.html' %}
            {% endwith %}
        </div>
    </form>
{% endset %}
{% set edit_rule_modal_footer %}
    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-modal-cancel>取消</button>
    <button type="button" class="btn btn-primary" data-modal-confirm id="editRuleConfirm">保存</button>
{% endset %}
{% with
    modal_id='editRuleModal',
    modal_label_id='editRuleModalLabel',
    title='<i class="fas fa-edit me-2"></i>编辑分类规则',
    body=edit_rule_modal_body,
    footer=edit_rule_modal_footer,
    size='lg'
%}
    {% include 'components/ui/modal.html' %}
{% endwith %}
