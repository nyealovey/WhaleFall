{% extends "base.html" %}
{% set page_id = 'LogsPage' %}
{% set page_density = 'compact' %}
{% from 'components/filters/macros.html' import filter_card, search_input, log_level_filter, module_filter, time_range_filter %}
{% from 'components/ui/macros.html' import metric_card %}
{% from 'components/ui/page_header.html' import page_header %}

{% block title %}日志中心{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/history/logs.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/history/logs-detail.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='vendor/gridjs/mermaid.min.css') }}">
{% endblock %}

{% block content_outer %}
<div id="logs-page-root">
{{ page_header('fas fa-chart-line', '日志中心', '查看系统日志和操作记录') }}

<section class="page-section">
    <div class="layout-shell">
        <div class="layout-shell-inner">
            <div class="row row-cols-1 row-cols-md-2 row-cols-xl-4 g-3 log-stats-row">
                <div class="col">
                    {% call metric_card('总日志数', value=0, value_id='totalLogs', icon_class='fas fa-list') %}
                        <span class="chip-outline chip-outline--muted" title="Top 模块" aria-label="Top 模块">
                            <i class="fas fa-cube" aria-hidden="true"></i><span id="logsMetaTopModule" aria-hidden="true">-</span>
                        </span>
                        <span class="chip-outline chip-outline--muted" title="Top 模块日志量" aria-label="Top 模块日志量">
                            <i class="fas fa-hashtag" aria-hidden="true"></i><span id="logsMetaTopModuleCount" aria-hidden="true">0</span>
                        </span>
                        <span class="chip-outline chip-outline--muted" title="窗口" aria-label="窗口">
                            <i class="fas fa-clock" aria-hidden="true"></i><span id="logsMetaWindowHours" aria-hidden="true">24h</span>
                        </span>
                    {% endcall %}
                </div>
                <div class="col">
                    {% call metric_card('错误日志', value=0, value_id='errorLogs', icon_class='fas fa-exclamation-triangle', tone='danger') %}
                        <span class="chip-outline chip-outline--muted" title="错误率" aria-label="错误率">
                            <i class="fas fa-percent" aria-hidden="true"></i><span id="logsMetaErrorRate" aria-hidden="true">0%</span>
                        </span>
                        <span class="status-pill status-pill--danger" title="严重" aria-label="严重">
                            <i class="fas fa-times-circle" aria-hidden="true"></i><span id="logsMetaCriticalCount" aria-hidden="true">0</span>
                        </span>
                        <span class="chip-outline chip-outline--muted" title="错误/小时" aria-label="错误/小时">
                            <i class="fas fa-bolt" aria-hidden="true"></i><span id="logsMetaErrorPerHour" aria-hidden="true">0</span>
                        </span>
                    {% endcall %}
                </div>
                <div class="col">
                    {% call metric_card('警告日志', value=0, value_id='warningLogs', icon_class='fas fa-exclamation-circle', tone='warning') %}
                        <span class="chip-outline chip-outline--muted" title="占比" aria-label="占比">
                            <i class="fas fa-chart-pie" aria-hidden="true"></i><span id="logsMetaWarningRate" aria-hidden="true">0%</span>
                        </span>
                        <span class="chip-outline chip-outline--muted" title="告警/小时" aria-label="告警/小时">
                            <i class="fas fa-bolt" aria-hidden="true"></i><span id="logsMetaWarningPerHour" aria-hidden="true">0</span>
                        </span>
                    {% endcall %}
                </div>
                <div class="col">
                    {% call metric_card('信息日志', value=0, value_id='infoLogs', icon_class='fas fa-info-circle', tone='muted') %}
                        <span class="chip-outline chip-outline--muted" title="调试" aria-label="调试">
                            <i class="fas fa-bug" aria-hidden="true"></i><span id="logsMetaDebugCount" aria-hidden="true">0</span>
                        </span>
                    {% endcall %}
                </div>
            </div>
        </div>
    </div>
</section>

<section class="page-section page-section--stacked">
    <div class="layout-shell">
        <div class="layout-shell-inner">
            {% call filter_card(form_id='logs-filter-form', action=url_for('history_logs.logs_dashboard'), auto_register=False) %}
                {{ search_input(placeholder='输入搜索关键词', col_class='col-md-2 col-12') }}
                {{ log_level_filter(log_level_options, col_class='col-md-2 col-12') }}
                {{ module_filter(module_options, col_class='col-md-2 col-12') }}
                {{ time_range_filter(time_range_options, '1d', col_class='col-md-2 col-12') }}
            {% endcall %}
        </div>
    </div>
</section>

<section class="page-section page-section--stacked">
    <div class="layout-shell">
        <div class="layout-shell-inner">
            <div class="card logs-container">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-list"></i> 日志列表</h5>
                </div>
                <div class="card-body">
                    <div id="logs-grid"></div>
                </div>
            </div>
        </div>
    </div>
</section>

{% include 'history/logs/modals/log-detail-modal.html' %}
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/modules/services/logs_service.js') }}"></script>
<script src="{{ url_for('static', filename='js/modules/stores/logs_store.js') }}"></script>
<script src="{{ url_for('static', filename='js/modules/views/history/logs/log-detail.js') }}"></script>
<script src="{{ url_for('static', filename='js/modules/views/history/logs/modals/log-detail-modal.js') }}"></script>
<script src="{{ url_for('static', filename='vendor/gridjs/gridjs.umd.js') }}"></script>
<script src="{{ url_for('static', filename='js/common/grid-wrapper.js') }}"></script>
<script src="{{ url_for('static', filename='js/modules/ui/ui-helpers.js') }}"></script>
<script src="{{ url_for('static', filename='js/common/grid-row-meta.js') }}"></script>
<script src="{{ url_for('static', filename='js/modules/views/grid-page.js') }}"></script>
<script src="{{ url_for('static', filename='js/modules/views/grid-plugins/filter-card.js') }}"></script>
<script src="{{ url_for('static', filename='js/modules/views/grid-plugins/action-delegation.js') }}"></script>
<script src="{{ url_for('static', filename='js/modules/views/history/logs/logs.js') }}"></script>
{% endblock %}
