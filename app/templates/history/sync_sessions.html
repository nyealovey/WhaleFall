{% extends "base.html" %}
{% from 'components/filters/macros.html' import filter_card, sync_type_filter, sync_category_filter, status_sync_filter %}

{% block title %}会话中心 - 鲸落{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/history/sync-sessions.css') }}">
{% endblock %}

{% block content %}
<!-- 页面头部 -->
<div class="page-header">
    <div class="container">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h2><i class="fas fa-sync-alt me-2"></i>会话中心</h2>
                <p class="mb-0">查看和管理数据同步会话记录</p>
            </div>

        </div>
    </div>
</div>

<div class="container-fluid">


            <!-- 搜索和筛选 -->
            <div class="sync-sessions-page">
                {% call filter_card(form_id='sync-sessions-filter-form', action=url_for('sync_sessions.index'), auto_register=False) %}
                    {{ sync_type_filter(sync_type_options, '', col_class='col-3') }}
                    {{ sync_category_filter(sync_category_options, '', col_class='col-3') }}
                    {{ status_sync_filter(status_options, '', col_class='col-3') }}
                {% endcall %}
            </div>

            <!-- 会话列表 -->
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-list"></i> 同步会话列表</h5>
                </div>
                <div class="card-body">
                    <div id="sessions-loading" class="text-center py-4">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">加载中...</span>
                        </div>
                        <p class="mt-2">正在加载会话数据...</p>
                    </div>
                    <div id="sessions-container" style="display: none;">
                        <!-- 会话列表将在这里动态加载 -->
                    </div>
                    <div id="pagination-container" class="d-flex justify-content-center mt-4" style="display: none;">
                        <!-- 分页控件将在这里动态加载 -->
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 会话详情模态框 -->
{% set session_detail_modal_body %}
    <div id="session-detail-content">
        <!-- 会话详情将在这里动态加载 -->
    </div>
{% endset %}
{% set session_detail_modal_footer %}
    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-modal-cancel>关闭</button>
{% endset %}
{% with
    modal_id='sessionDetailModal',
    modal_label_id='sessionDetailModalLabel',
    title='会话详情',
    body=session_detail_modal_body,
    footer=session_detail_modal_footer,
    size='xl'
%}
    {% include 'components/ui/modal.html' %}
{% endwith %}

<!-- 错误日志模态框 -->
{% set error_logs_modal_body %}
    <div id="error-logs-content">
        <!-- 错误日志将在这里动态加载 -->
    </div>
{% endset %}
{% set error_logs_modal_footer %}
    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-modal-cancel>关闭</button>
{% endset %}
{% with
    modal_id='errorLogsModal',
    modal_label_id='errorLogsModalLabel',
    title='<i class=\"fas fa-exclamation-triangle me-2\"></i>错误',
    body=error_logs_modal_body,
    footer=error_logs_modal_footer,
    size='xl',
    header_class='bg-danger text-white',
    close_button_class='btn-close-white'
%}
    {% include 'components/ui/modal.html' %}
{% endwith %}
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/modules/services/sync_sessions_service.js') }}"></script>
<script src="{{ url_for('static', filename='js/modules/stores/sync_sessions_store.js') }}"></script>
<script src="{{ url_for('static', filename='js/modules/views/history/sync_sessions.js') }}"></script>
<script src="{{ url_for('static', filename='js/bootstrap/history/sync-sessions.js') }}"></script>
{% endblock %}
