{% extends "base.html" %}
{% set page_id = 'SyncSessionsPage' %}
{% set page_density = 'compact' %}
{% from 'components/filters/macros.html' import filter_card, task_run_trigger_source_filter, task_run_category_filter, status_active_filter %}
{% from 'components/ui/page_header.html' import page_header %}

{% block title %}运行中心 - 鲸落{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='vendor/gridjs/mermaid.min.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/history/sync-sessions.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/history/session-detail.css') }}">
{% endblock %}

{% block content_outer %}
<div id="task-runs-page-root">
{{ page_header('fas fa-tasks', '运行中心', '查看和管理后台任务运行记录') }}

<section class="page-section page-section--stacked">
    <div class="layout-shell">
        <div class="layout-shell-inner">
            {% call filter_card(form_id='task-runs-filter-form', action=url_for('history_sessions.index'), auto_register=False) %}
                {{ task_run_trigger_source_filter(trigger_source_options, '', col_class='col-md-2 col-12') }}
                {{ task_run_category_filter(task_category_options, '', col_class='col-md-2 col-12') }}
                {{ status_active_filter(status_options, '', col_class='col-md-2 col-12') }}
            {% endcall %}
        </div>
    </div>
</section>

<section class="page-section page-section--stacked">
    <div class="layout-shell">
        <div class="layout-shell-inner">
            <div class="card">
                <div class="card-header">
                    <div class="d-flex align-items-center justify-content-between gap-3 flex-wrap">
                        <h5 class="mb-0"><i class="fas fa-list"></i> 任务运行列表</h5>
                        <span class="chip-outline chip-outline--muted" id="taskRunsTotalCount">共 0 条</span>
                    </div>
                </div>
                <div class="card-body">
                    <div id="task-runs-grid"></div>
                </div>
            </div>
        </div>
    </div>
</section>

{% include 'history/sessions/modals/session-detail-modal.html' %}
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='vendor/gridjs/gridjs.umd.js') }}"></script>
<script src="{{ url_for('static', filename='js/common/grid-wrapper.js') }}"></script>
<script src="{{ url_for('static', filename='js/modules/ui/ui-helpers.js') }}"></script>
<script src="{{ url_for('static', filename='js/common/grid-row-meta.js') }}"></script>
<script src="{{ url_for('static', filename='js/modules/views/grid-page.js') }}"></script>
<script src="{{ url_for('static', filename='js/modules/views/grid-plugins/filter-card.js') }}"></script>
<script src="{{ url_for('static', filename='js/modules/views/grid-plugins/action-delegation.js') }}"></script>
<script src="{{ url_for('static', filename='js/modules/services/task_runs_service.js') }}"></script>
<script src="{{ url_for('static', filename='js/modules/stores/task_runs_store.js') }}"></script>
<script src="{{ url_for('static', filename='js/modules/views/history/sessions/session-detail.js') }}"></script>
<script src="{{ url_for('static', filename='js/modules/views/history/sessions/modals/session-detail-modal.js') }}"></script>
<script src="{{ url_for('static', filename='js/modules/views/history/sessions/sync-sessions.js') }}"></script>
{% endblock %}
